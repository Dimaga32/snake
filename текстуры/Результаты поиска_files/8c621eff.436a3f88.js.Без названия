"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[48274],{725772:(e,t,r)=>{r.d(t,{Icon12Lock:()=>i});var i=(0,r(844990).makeIcon)("Icon12Lock","lock_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="lock_12"><path d="M6 .5c1.657 0 3 1.337 3 2.992v1.507L9.748 5c.415 0 .752.34.752.76v4.48a.76.76 0 0 1-.752.76H2.252a.756.756 0 0 1-.752-.76V5.76c0-.42.342-.76.752-.76L3 4.999V3.501A3.003 3.003 0 0 1 5.824.505zM6 2l-.145.007A1.496 1.496 0 0 0 4.5 3.5V5h3V3.5C7.5 2.666 6.828 2 6 2" /></symbol>',12,12,!1,void 0)},644746:(e,t,r)=>{r.d(t,{Icon24FavoriteOutline:()=>i});var i=(0,r(844990).makeIcon)("Icon24FavoriteOutline","favorite_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="favorite_outline_24"><path fill-rule="evenodd" d="M12.554 4.694a.6.6 0 0 0-1.108 0l-1.614 3.9a.9.9 0 0 1-.774.554l-4.125.266a.6.6 0 0 0-.357 1.05l3.267 2.859a.9.9 0 0 1 .282.888l-.93 3.852a.6.6 0 0 0 .883.66l3.472-2.003a.9.9 0 0 1 .9 0l3.472 2.004a.6.6 0 0 0 .883-.661l-.93-3.852a.9.9 0 0 1 .282-.888l3.267-2.858a.6.6 0 0 0-.357-1.05l-4.125-.267a.9.9 0 0 1-.774-.554zm-2.772-.689c.818-1.976 3.618-1.976 4.436 0l1.4 3.383 3.565.23c2.136.138 3.037 2.792 1.426 4.201l-2.856 2.5.802 3.322c.494 2.05-1.706 3.696-3.533 2.642L12 18.539l-3.022 1.744C7.15 21.337 4.95 19.69 5.445 17.64l.802-3.322-2.856-2.5c-1.611-1.41-.71-4.063 1.426-4.201l3.566-.23z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},85775:(e,t,r)=>{r.d(t,{Icon24UnfavoriteOutline:()=>i});var i=(0,r(844990).makeIcon)("Icon24UnfavoriteOutline","unfavorite_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="unfavorite_outline_24"><path fill-rule="evenodd" d="M9.782 4.005c.818-1.976 3.618-1.976 4.436 0l1.4 3.383 3.565.23c2.136.138 3.037 2.792 1.426 4.201l-1.477 1.292a.9.9 0 0 1-1.185-1.354l1.477-1.292a.6.6 0 0 0-.357-1.05l-4.125-.267a.9.9 0 0 1-.774-.554l-1.614-3.9a.6.6 0 0 0-1.108 0c-.204.492-.68.835-1.227.609-.545-.226-.64-.805-.437-1.298M12 18.539l3.022 1.744c1.456.84 3.149-.035 3.526-1.462l1.416 1.415a.9.9 0 1 0 1.272-1.272l-15.2-15.2a.9.9 0 0 0-1.272 1.272l2.428 2.429-2.375.153C2.68 7.756 1.78 10.41 3.39 11.819l2.856 2.5-.802 3.322c-.495 2.05 1.706 3.696 3.533 2.642zM4.933 9.414a.6.6 0 0 0-.357 1.05l3.267 2.859a.9.9 0 0 1 .282.888l-.93 3.852a.6.6 0 0 0 .883.66l3.472-2.003a.9.9 0 0 1 .9 0l3.472 2.004a.6.6 0 0 0 .883-.661l-.284-1.176a1 1 0 0 1-.02-.113L8.886 9.159z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},818515:(e,t,r)=>{r.d(t,{Icon28ListCheckOutline:()=>i});var i=(0,r(844990).makeIcon)("Icon28ListCheckOutline","list_check_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="list_check_outline_28"><path fill="currentColor" fill-rule="evenodd" d="M26.701 15.287a1 1 0 0 1 .095 1.319l-6.945 7.095a1 1 0 0 1-1.33.086l-4.232-4.272a1 1 0 0 1 1.329-1.49l3.517 3.55 6.152-6.276a1 1 0 0 1 1.414-.012M10 18a1 1 0 1 1 0 2H4a1 1 0 1 1 0-2zm12-6a1 1 0 1 1 0 2H4a1 1 0 1 1 0-2zm0-6a1 1 0 1 1 0 2H4a1 1 0 0 1 0-2z" clip-rule="evenodd" /></symbol>',28,28,!1,void 0)},116135:(e,t,r)=>{r.d(t,{Icon28MoreVertical:()=>i});var i=(0,r(844990).makeIcon)("Icon28MoreVertical","more_vertical_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="more_vertical_28"><path fill="currentColor" d="M16.25 7a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0m0 7a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0m0 7a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0" /></symbol>',28,28,!1,void 0)},304045:(e,t,r)=>{r.d(t,{default:()=>i});const i={subtitle:"PrivacySetting-module__subtitle--szgLW",subtitleIcon:"PrivacySetting-module__subtitleIcon--OQInF"}},336583:(e,t,r)=>{r.d(t,{default:()=>i});const i={scroll:"PrivacyFriendsForm-module__scroll--rpGzp",scrollContainer:"PrivacyFriendsForm-module__scrollContainer--mkv1I",loading:"PrivacyFriendsForm-module__loading--pJCBV",status:"PrivacyFriendsForm-module__status--LT4fq"}},657282:(e,t,r)=>{function i(e){e.preventDefault(),e.stopPropagation()}r.d(t,{cancelEvent:()=>i})},310142:(e,t,r)=>{r.d(t,{VideoPlaylistsProvider:()=>p});var i,o=r(331635),s=r(327813),n=r(127126),a=r(847891),l=r(470297),d=r(968788),c=r(5281),u=r(594556),v=r(900357);let p=i=class{set(e){const t=new u.VideoPlaylist(e,this.ownerProvider);this.playlistMap.set(t.rawId,t)}createVideoPlaylistFromApi(e){const t=new u.VideoPlaylist(e,this.ownerProvider);return this.playlistMap.set(t.rawId,t),t}createVideoPlaylistsFromApi(e){return e.reduce(((e,t)=>{const r=this.createVideoPlaylistFromApi(t);return e.push(r),e}),[])}getPlaylist(e){return this.playlistMap.get(e)}async fetch(e,t){const r={count:e.count,offset:e.offset,need_system:(0,v.convertToBooleanParam)(e.needSystem),group_id:e.groupId,owner_id:e.ownerId,extended:(0,v.convertToBooleanParam)(!0)},i=Object.fromEntries(Object.entries(r).filter((([,e])=>void 0!==e))),{count:o,items:s}=await this.videoApi.getAlbums(i,t);return{count:o,items:this.createVideoPlaylistsFromApi(s)}}addVideoToPlaylist(e,t){return this.videoApi.addToAlbum(e,t)}async fetchById(e,t){const r=await this.videoApi.getAlbumById(i.prepareFetchByIdParams(e),t),[o]=this.createVideoPlaylistsFromApi([r]);return o}async delete({id:e,ownerId:t},r){const i={album_id:e};a.Ranges.isGroupId(t)?i.group_id=t:i.owner_id=t;const o=Boolean(await this.videoApi.deleteAlbum(i,r));return o&&this.playlistMap.delete(u.VideoPlaylist.createRawId({id:e,ownerId:t})),o}static prepareFetchByIdParams(e){if("number"==typeof e)return{album_id:e};const{accessKey:t,id:r,ownerId:i}="string"==typeof e?(0,l.parseRawId)(e):e,o={album_id:r};return void 0!==i&&(o.owner_id=i),void 0!==t&&(o.access_key=t),o}constructor(e,t){this.videoApi=e,this.ownerProvider=t,this.playlistMap=new Map,(0,s.makeAutoObservable)(this)}};p=i=(0,o.__decorate)([n.scope.container(),(0,o.__metadata)("design:paramtypes",[d.VideoApi,c.VideoOwnerProvider])],p)},594556:(e,t,r)=>{r.d(t,{VideoPlaylist:()=>s});var i=r(327813),o=r(643010);class s{static createRawId(e){return(0,o.getIdentityRawId)(e)}get rawId(){const{id:e,owner_id:t}=this.data;return s.createRawId({id:e,ownerId:t})}get data(){return this._data}get owner(){return this.ownerProvider?.getOwner(this._data.owner_id)}constructor(e,t){this._data=e,this.ownerProvider=t,(0,i.makeAutoObservable)(this,{},{autoBind:!0})}}},673483:(e,t,r)=>{r.d(t,{VideoGroupsProvider:()=>a});var i=r(331635),o=r(327813),s=r(127126),n=r(559967);let a=class{getGroup(e){return this.groupsMap.get(e)}createGroupsFromApi(e){return e.map((e=>{const t=new n.VideoGroup(e);return this.groupsMap.set(e.id,t),t}))}constructor(){this.groupsMap=new Map,(0,o.makeAutoObservable)(this)}};a=(0,i.__decorate)([s.scope.transient(),(0,i.__metadata)("design:paramtypes",[])],a)},5281:(e,t,r)=>{r.d(t,{VideoOwnerProvider:()=>u});var i=r(331635),o=r(327813),s=r(847891),n=r(127126),a=r(559967),l=r(673483),d=r(822311),c=r(117163);let u=class{static isVideoGroup(e){return e instanceof a.VideoGroup}static isVideoUser(e){return e instanceof d.VideoUser}createGroupsFromApi(e){return this.groupsProvider.createGroupsFromApi(e)}createUsersFromApi(e){return this.usersProvider.createUsersFromApi(e)}getOwner(e){return s.Ranges.isGroupId(e)?this.groupsProvider.getGroup(s.Ranges.convertOwnerIdToGroupId(e)):s.Ranges.isUserId(e)?this.usersProvider.getUser(e):void 0}constructor(e,t){this.groupsProvider=e,this.usersProvider=t,(0,o.makeAutoObservable)(this)}};u=(0,i.__decorate)([n.scope.transient(),(0,i.__metadata)("design:paramtypes",[l.VideoGroupsProvider,c.VideoUsersProvider])],u)},896845:(e,t,r)=>{r.d(t,{VideoUsersFetchProvider:()=>d});var i,o=r(331635),s=r(327813),n=r(127126),a=r(420429),l=r(26823);let d=i=class{async fetch(e,t){const r=this.getPending(e);if(r)return r;const o=this.userApi.get(i.getApiParams(e),t),n=i.getKey(e);this.pendingMap.set(n,o);try{const t=await o;return this.userStoreFactory.ensureByFields(e.fields??[]).createFromApi(t),t}finally{(0,s.runInAction)((()=>{this.pendingMap.delete(n)}))}}isPending(e){return Boolean(this.getPending(e))}getPending(e){return this.pendingMap.get(i.getKey(e))}static getApiParams(e){const t={access_keys:e.accessKeys?.sort().join(","),domains:e.domains?.sort().join(","),fields:e.fields?.sort().join(","),from_group_id:e.fromGroupId,name_case:e.nameCase,user_ids:e.userIds?.sort().join(",")};return Object.fromEntries(Object.entries(t).filter((([,e])=>void 0!==e)))}static getKey(e){return JSON.stringify(Object.entries(i.getApiParams(e)).sort((([e],[t])=>e<t?-1:1)))}constructor(e,t){this.userApi=e,this.userStoreFactory=t,this.pendingMap=new Map,(0,s.makeAutoObservable)(this)}};d=i=(0,o.__decorate)([n.scope.container(),(0,o.__metadata)("design:paramtypes",[a.UsersApi,l.VideoUsersStoreFactory])],d)},117163:(e,t,r)=>{r.d(t,{VideoUsersProvider:()=>l});var i=r(331635),o=r(327813),s=r(127126),n=r(420429),a=r(822311);let l=class{getUser(e){return this.usersMap.get(e)}createUsersFromApi(e){return e.map((e=>{const t=new a.VideoUser(e);return this.usersMap.set(e.id,t),t}))}async fetchUserById(e,t){const r=await this.userApi.get({user_ids:e.toString(),fields:t.join()});if(r.length)return new a.VideoUser(r[0])}constructor(e){this.userApi=e,this.usersMap=new Map,(0,o.makeAutoObservable)(this)}};l=(0,i.__decorate)([s.scope.container(),(0,i.__metadata)("design:paramtypes",[n.UsersApi])],l)},160721:(e,t,r)=>{r.d(t,{VideoUsersStore:()=>s});var i=r(822311),o=r(327813);class s{createFromApi(e){const t=e=>{const t=new i.VideoUser(e);return this.usersMap.set(e.id,t),t};return Array.isArray(e)?e.map(t):t(e)}getById(e){return this.usersMap.get(e)}constructor(){this.usersMap=new Map,(0,o.makeAutoObservable)(this)}}},26823:(e,t,r)=>{r.d(t,{VideoUsersStoreFactory:()=>d});var i,o=r(331635),s=r(327813),n=r(127126),a=r(160721),l=r(818354);let d=i=class{static filterFields(e){const t=l.VIDEO_USER_OPTIONAL_FIELDS;return e.filter((e=>t.includes(e)))}ensureByFields(e){const t=i.getKey(e);return this.stores.get(t)??this.create(t)}create(e){const t=new a.VideoUsersStore;return this.stores.set(e,t),t}static getKey(e){return[...new Set(e)].sort().join(",")}constructor(){this.stores=new Map,(0,s.makeAutoObservable)(this)}};d=i=(0,o.__decorate)([n.scope.container(),(0,o.__metadata)("design:paramtypes",[])],d)},818354:(e,t,r)=>{r.d(t,{VIDEO_USER_OPTIONAL_FIELDS:()=>i});const i=["about","activities","bdate","blacklisted","blacklisted_by_me","books","can_post","can_see_all_posts","can_see_audio","can_send_friend_request","can_write_private_message","career","city","common_count","connections","contacts","counters","country","crop_photo","deactivated","domain","education","exports","first_name_nom","first_name_gen","first_name_dat","first_name_acc","first_name_ins","first_name_abl","followers_count","friend_status","games","has_mobile","has_photo","home_town","interests","is_favorite","is_friend","is_hidden_from_feed","is_no_index","is_verified","last_name_nom","last_name_gen","last_name_dat","last_name_acc","last_name_ins","last_name_abl","last_seen","lists","maiden_name","military","movies","music","nickname","occupation","online","personal","photo_50","photo_100","photo_200_orig","photo_200","photo_400_orig","photo_id","photo_max","photo_max_orig","quotes","relatives","relation","schools","screen_name","sex","site","status","timezone","trending","tv","universities","verified","wall_default"]},900357:(e,t,r)=>{r.d(t,{convertToBooleanParam:()=>i});const i=e=>{if(void 0!==e)return e?1:0}},903709:(e,t,r)=>{r.d(t,{storeFieldProperty:()=>i});const i=Symbol.for("_isEffectorStore")},605967:(e,t,r)=>{r.d(t,{adapter:()=>o});var i=r(903709);const o=()=>e=>new Proxy(e,{construct:(e,t)=>new Proxy(new e(...t),{get(e,t){if(t in e){const r=e[t];return r[i.storeFieldProperty]?r():r}},set(e,t,r){if(t in e&&e[t][i.storeFieldProperty])throw new Error("The effector store is readonly!");return e[t]=r,!0}})})},614502:(e,t,r)=>{r.d(t,{effect:()=>n,event:()=>s,store:()=>o});var i=r(536739);const o=e=>(0,i.wrapEvent)(e.updates,e.getState()),s=e=>t=>{e(t)},n=e=>t=>e(t)},536739:(e,t,r)=>{r.d(t,{wrapEvent:()=>n});var i=r(327813),o=r(903709);const s=()=>{},n=(e,t)=>{let r=t,n=s;const a=(0,i.createAtom)("effector-store",(()=>{n=e.watch((e=>{r!==e&&(r=e,a.reportChanged())}))}),(()=>{n(),n=s})),l=()=>(a.reportObserved(),r);return Object.defineProperty(l,o.storeFieldProperty,{get:()=>!0}),l}},420429:(e,t,r)=>{r.d(t,{UsersApi:()=>n});var i=r(331635),o=r(609897),s=r(127126);let n=class extends o.ApiNamespace{get namespace(){return"users"}constructor(){super(...arguments),this.get=this.makeMethod("get"),this.search=this.makeMethod("search")}};n=(0,i.__decorate)([s.scope.global()],n)},968788:(e,t,r)=>{r.d(t,{VideoApi:()=>n});var i=r(331635),o=r(127126),s=r(609897);let n=class extends s.ApiNamespace{get namespace(){return"video"}constructor(){super(...arguments),this.get=this.makeMethod("get"),this.search=this.makeMethod("search"),this.edit=this.makeMethod("edit"),this.save=this.makeMethod("save"),this.delete=this.makeMethod("delete"),this.add=this.makeMethod("add"),this.getAlbums=this.makeMethod("getAlbums"),this.getAlbumById=this.makeMethod("getAlbumById"),this.getAlbumsByVideo=this.makeMethod("getAlbumsByVideo"),this.addToAlbum=this.makeMethod("addToAlbum"),this.deleteAlbum=this.makeMethod("deleteAlbum"),this.removeFromAlbum=this.makeMethod("removeFromAlbum"),this.getGroupsForUploading=this.makeMethod("getGroupsForUploading"),this.encodeProgress=this.makeMethod("encodeProgress"),this.getPrivacyDictionary=this.makeMethod("getPrivacyDictionary"),this.reportComment=this.makeMethod("reportComment"),this.getPlaylistThumbUploadUrl=this.makeMethod("getPlaylistThumbUploadUrl"),this.savePlaylistThumb=this.makeMethod("savePlaylistThumb"),this.savePlaylistAdditionalThumb=this.makeMethod("savePlaylistAdditionalThumb"),this.getGroupSettings=this.makeMethod("getGroupSettings"),this.restore=this.makeMethod("restore"),this.stopStreaming=this.makeMethod("stopStreaming"),this.getComments=this.makeMethod("getComments"),this.saveGroupSettings=this.makeMethod("saveGroupSettings"),this.deleteComment=this.makeMethod("deleteComment"),this.restoreComment=this.makeMethod("restoreComment"),this.editComment=this.makeMethod("editComment"),this.createComment=this.makeMethod("createComment")}};n=(0,i.__decorate)([o.scope.global()],n)},851436:(e,t,r)=>{r.d(t,{useIsMounted:()=>o});var i=r(296540);const o=()=>{const e=(0,i.useRef)(!1);return(0,i.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),(0,i.useCallback)((()=>e.current),[])}},489617:(e,t,r)=>{r.d(t,{createFriendsAddFx:()=>l,createFriendsAddListFx:()=>p,createFriendsDeleteBulkFx:()=>c,createFriendsDeleteFx:()=>d,createFriendsDeleteListFx:()=>m,createFriendsDeleteSubscriberFx:()=>h,createFriendsEditListFx:()=>g,createFriendsGetCountersFx:()=>S,createFriendsGetFollowersFx:()=>y,createFriendsGetFriendsDeletionSuggestionsFx:()=>n,createFriendsGetFx:()=>s,createFriendsGetListsFx:()=>o,createFriendsGetMutualFx:()=>E,createFriendsGetOnlineFx:()=>v,createFriendsGetRecentFx:()=>b,createFriendsGetRecommendationsFx:()=>a,createFriendsGetRequestsFx:()=>u,createFriendsRequestsToSubscribersFx:()=>f,createFriendsSearchFx:()=>_});var i=r(66044);const o=e=>(0,i.createApiEffect)("friends.getLists",e),s=e=>(0,i.createApiEffect)("friends.get",e),n=e=>(0,i.createApiEffect)("friends.getFriendsDeletionSuggestions",e),a=e=>(0,i.createApiEffect)("friends.getRecommendations",e),l=e=>(0,i.createApiEffect)("friends.add",e),d=e=>(0,i.createApiEffect)("friends.delete",e),c=e=>(0,i.createApiEffect)("friends.deleteBulk",e),u=e=>(0,i.createApiEffect)("friends.getRequests",e),v=e=>(0,i.createApiEffect)("friends.getOnline",e),p=e=>(0,i.createApiEffect)("friends.addList",e),m=e=>(0,i.createApiEffect)("friends.deleteList",e),g=e=>(0,i.createApiEffect)("friends.editList",e),_=e=>(0,i.createApiEffect)("friends.search",e),h=e=>(0,i.createApiEffect)("friends.deleteSubscriber",e),y=e=>(0,i.createApiEffect)("friends.getFollowers",e),f=e=>(0,i.createApiEffect)("friends.requestsToSubscribers",e),S=e=>(0,i.createApiEffect)("friends.getCounters",e),b=e=>(0,i.createApiEffect)("friends.getRecent",e),E=e=>(0,i.createApiEffect)("friends.getMutual",e)},455234:(e,t,r)=>{r.d(t,{createGroupsEditFx:()=>a,createGroupsGetByIdFx:()=>o,createGroupsGetMembersFx:()=>u,createGroupsInviteFx:()=>d,createGroupsIsMemberFx:()=>l,createGroupsJoinFx:()=>s,createGroupsLeaveFx:()=>n,createGroupsRecallInvitationFx:()=>c});var i=r(66044);const o=e=>(0,i.createApiEffect)("groups.getById",e),s=e=>(0,i.createApiEffect)("groups.join",e),n=e=>(0,i.createApiEffect)("groups.leave",e),a=e=>(0,i.createApiEffect)("groups.edit",e),l=e=>(0,i.createApiEffect)("groups.isMember",e),d=e=>(0,i.createApiEffect)("groups.invite",e),c=e=>(0,i.createApiEffect)("groups.recallInvitation",e),u=e=>(0,i.createApiEffect)("groups.getMembers",e)},717788:(e,t,r)=>{r.d(t,{createUsersGetFx:()=>o,createUsersSearchFx:()=>s});var i=r(66044);const o=e=>(0,i.createApiEffect)("users.get",e),s=e=>(0,i.createApiEffect)("users.search",e)},304525:(e,t,r)=>{r.d(t,{createUtilsResolveScreenNameFx:()=>o});var i=r(66044);const o=e=>(0,i.createApiEffect)("utils.resolveScreenName",e)},887815:(e,t,r)=>{r.d(t,{createVideoAddAlbumFx:()=>w,createVideoAddFx:()=>o,createVideoAddToAlbumFx:()=>v,createVideoCreateCommentFx:()=>f,createVideoDeleteAlbumFx:()=>g,createVideoDeleteCommentFx:()=>S,createVideoDeleteFx:()=>P,createVideoEditAlbumFx:()=>I,createVideoEditCommentFx:()=>E,createVideoFeedVideosForYouBlockItemsFx:()=>c,createVideoGetAlbumByIdFx:()=>n,createVideoGetAlbumsByVideoFx:()=>m,createVideoGetAlbumsExtendedFx:()=>u,createVideoGetBlockItemsFx:()=>a,createVideoGetCommentsExtendedFx:()=>y,createVideoGetFx:()=>s,createVideoGetGroupsForStreamingFx:()=>_,createVideoGetVideoDiscoverFx:()=>h,createVideoPinVideoFx:()=>F,createVideoRemoveFromAlbumFx:()=>p,createVideoReorderVideosFx:()=>A,createVideoRestoreCommentFx:()=>b,createVideoRestoreFx:()=>V,createVideoSubscribeToAlbum:()=>l,createVideoUnpinVideoFx:()=>k,createVideoUnsubscribeFromAlbum:()=>d});var i=r(66044);const o=e=>(0,i.createApiEffect)("video.add",e),s=e=>(0,i.createApiEffect)("video.get",e),n=e=>(0,i.createApiEffect)("video.getAlbumById",e),a=e=>(0,i.createApiEffect)("video.getCatalogBlockItems",e),l=e=>(0,i.createApiEffect)("video.subscribeToAlbum",e),d=e=>(0,i.createApiEffect)("video.unsubscribeFromAlbum",e),c=e=>(0,i.createApiEffect)("video.feedVideosForYouBlockItems",e),u=e=>(0,i.createApiEffect)("video.getAlbums",e),v=e=>(0,i.createApiEffect)("video.addToAlbum",e),p=e=>(0,i.createApiEffect)("video.removeFromAlbum",e),m=e=>(0,i.createApiEffect)("video.getAlbumsByVideo",e),g=e=>(0,i.createApiEffect)("video.deleteAlbum",e),_=e=>(0,i.createApiEffect)("video.getGroupsForStreaming",e),h=e=>(0,i.createApiEffect)("video.getVideoDiscover",e),y=e=>(0,i.createApiEffect)("video.getComments",e),f=e=>(0,i.createApiEffect)("video.createComment",e),S=e=>(0,i.createApiEffect)("video.deleteComment",e),b=e=>(0,i.createApiEffect)("video.restoreComment",e),E=e=>(0,i.createApiEffect)("video.editComment",e),I=e=>(0,i.createApiEffect)("video.editAlbum",e),w=e=>(0,i.createApiEffect)("video.addAlbum",e),A=e=>(0,i.createApiEffect)("video.reorderVideos",e),P=e=>(0,i.createApiEffect)("video.delete",e),V=e=>(0,i.createApiEffect)("video.restore",e),F=e=>(0,i.createApiEffect)("video.pinVideo",e),k=e=>(0,i.createApiEffect)("video.unpinVideo",e)},267283:(e,t,r)=>{r.d(t,{listActions:()=>o});var i=r(32489);const o=({domain:e,$entitiesListIds:t,$entitiesCount:r})=>{const o=(0,i.createEvent)({domain:e}),s=(0,i.createEvent)({domain:e}),n=(0,i.createEvent)({domain:e}),a=e=>({entitiesCount:t,entitiesListIds:r},{entityKey:i,itemKeys:o})=>[].concat(i??Object.keys(r)).reduce(((i,s)=>{const n=t[s],a=r[s];if("number"!=typeof n||!a)return i;const l=1===e,d=o.reduce(((t,r)=>{const i=a.includes(r);return l?i?t:t+e:i?t+e:t}),0);return t[s]!==n||(i[s]=n+d),i}),{...t}),l=e=>(t,{entityKey:r,itemKeys:i})=>[].concat(r??Object.keys(t)).reduce(((r,o)=>{const s=t[o];if(!s)return r;const n=i.filter((e=>!s.includes(e)));return n.length?(r[o]="push"===e?[...s,...n]:[...n,...s],r):r}),{...t});return(0,i.sample)({clock:[n],source:{entitiesCount:r,entitiesListIds:t},fn:a(-1),target:r}),(0,i.sample)({clock:[o,s],source:{entitiesCount:r,entitiesListIds:t},fn:a(1),target:r}),(0,i.sample)({clock:[o],source:t,fn:l("push"),target:t}),(0,i.sample)({clock:[s],source:t,fn:l("unshift"),target:t}),(0,i.sample)({clock:[n],source:t,fn:function(e,{entityKey:t,itemKeys:r}){return[].concat(t??Object.keys(e)).reduce(((t,i)=>{const o=e[i];if(!o)return t;const s=o.filter((e=>!r.includes(e)));return s.length===o.length||(t[i]=s),t}),{...e})},target:t}),{pushItemsEvent:o,unshiftItemsEvent:s,deleteItemsEvent:n}}},301173:(e,t,r)=>{r.d(t,{createFactoryLists:()=>d});var i=r(32489),o=r(8520),s=r(873469),n=r(421290),a=r(398837),l=r(267283);const d=({domain:e,fetchFx:t,$entitiesItems:r,getListKey:d,getList:c,getListCount:u,getListNextFrom:v,getItemKey:p,getEntityKey:m,getOffset:g=(e=>Number(e.query.offset)||0),getCount:_=(e=>Number(e.query.count)||0),mapNextListQuery:h=(({count:e,offset:t,start_from:r})=>({count:e,offset:t,start_from:r}))})=>{const y=e.createEvent(),f=e.createEvent(),S=e.createStore({}),b=e.createStore({}),E=e.createStore({}),I=e.createStore({}),w=e.createStore({}),A=e.createStore({}),P=e.createStore({}),V=e.createStore({}),{pushItemsEvent:F,unshiftItemsEvent:k,deleteItemsEvent:C}=(0,l.listActions)({domain:e,$entitiesCount:I,$entitiesListIds:A});return[S,b,E,I,w,A,P].forEach((e=>{e.on(y,s.resetEntities)})),S.on(t.done,((e,{params:t})=>(0,n.setEntity)(e,d(t),t))),b.on(t,((e,t)=>t.query.offset?e:(0,n.setEntity)(e,d(t),!1))).on(t.done,((e,{params:t,result:r})=>{const i=d(t),o=u(r),s=g(t)+_(t),a=v?.(r);return(0,n.setEntity)(e,i,s>=o&&!a)})),E.on(t,((e,t)=>(0,n.setEntity)(e,d(t),!0))).on(t.finally,((e,t)=>t.params.controller?.signal.aborted?e:(0,n.setEntity)(e,d(t.params),!1))),V.on(y,((e,t)=>(t?e[t]?.abort():Object.keys(e).forEach((t=>{e[t]?.abort()})),(0,s.resetEntities)(e,t)))).on(t,((e,t)=>{const r=d(t);return e[r]?.abort(),t.controller?(0,n.setEntity)(e,r,t.controller):e})),I.on(t,((e,t)=>t.query.offset?e:(0,s.resetEntities)(e,d(t)))).on(t.done,((e,t)=>(0,n.setEntity)(e,d(t.params),u(t.result)))),"function"==typeof v&&w.on(t,((e,t)=>t.query.start_from?e:(0,s.resetEntities)(e,d(t)))).on(t.done,((e,t)=>(0,n.setEntity)(e,d(t.params),v(t.result)))),A.on(t,((e,t)=>t.query.offset?e:(0,s.resetEntities)(e,d(t)))).on(t.done,((e,t)=>{const r=d(t.params),i=c(t.result),s=(0,o.uniqueArray)([...e[r]||[],...i.map(p)]);return(0,n.setEntity)(e,r,s)})),P.on(t,((e,t)=>t.query.offset?e:(0,s.resetEntities)(e,d(t)))).on(t.fail,((e,t)=>t.params.controller?.signal.aborted?e:(0,n.setEntity)(e,d(t.params),t.error))),(0,i.sample)({clock:t.done,source:r,fn:(e,t)=>(0,a.mapToEntity)(e,c(t.result),m),target:r}),(0,i.sample)({clock:f,source:{entitiesFullyLoaded:b,entitiesLoading:E,entitiesParams:S,nextFrom:w},filter:(e,{entityKey:t})=>!e.entitiesLoading[t]&&!e.entitiesFullyLoaded[t]&&!!e.entitiesParams[t],fn:(e,{count:t,entityKey:r})=>{const i=e.entitiesParams[r];if(!i)throw new Error("FactoryLists: Empty request params");const o=t||_(i),s=e.nextFrom[r]||"";return{...i,query:{...i.query,...h({count:o,offset:g(i)+o,start_from:s})},controller:new AbortController}},target:t}),{resetEvent:y,fetchMoreEvent:f,pushItemsEvent:F,unshiftItemsEvent:k,deleteItemsEvent:C,fetchFx:t,$entitiesFullyLoaded:b,$entitiesLoading:E,$entitiesListIds:A,$entitiesCount:I,$entitiesError:P,selectStores:e=>{const t=(e,t)=>t[e]??null;return{$count:(0,i.combine)(e,I,t),$listIds:(0,i.combine)(e,A,t),$error:(0,i.combine)(e,P,t),$loading:(0,i.combine)(e,E,t),$fullyLoaded:(0,i.combine)(e,b,t)}}}}},396062:(e,t,r)=>{r.d(t,{createEntitiesCatalogSectionsService:()=>a});var i=r(32489),o=r(679005),s=r(373627),n=r(398837);const a=({domain:e})=>{const t=(0,s.createCatalogGetSectionFx)({domain:e}),r=e.createEvent(),a=e.createEvent(),l=e.createStore({}),d=e.createStore([]).reset(r),c=e.createStore({}),u=e.createStore({}).reset(r);return(0,i.sample)({clock:a,source:l,fn:(e,t)=>(0,n.mapToEntity)(e,t),target:l}),(0,i.sample)({clock:r,source:l,fn:(e,t)=>(0,n.mapToEntity)(e,t.catalog?.sections??[]),target:l}),(0,i.sample)({clock:r,source:d,fn:(e,t)=>[...e,...t.catalog?.sections.map((({id:e})=>e))??[]],target:d}),c.on(t,((e,t)=>{const r=t.query.section_id;return r?{...e,[r]:!0}:e})),c.on(t.finally,((e,t)=>{const r=t.params.query.section_id;return r?{...e,[r]:!1}:e})),u.on(t,((e,t)=>(0,o.produce)(e,(e=>{const r=t.query.section_id;r&&(e[r]=null)})))),u.on(t.fail,((e,t)=>{const r=t.params.query.section_id;return r?{...e,[r]:t.error}:e})),{initCatalog:r,$entitiesCatalogSections:l,$entitiesCatalogSectionIds:d,$entitiesSectionsErrors:u,$entitiesSectionsLoading:c,catalogGetSectionFx:t,setCatalogGetSectionsEvent:a}}},348388:(e,t,r)=>{r.d(t,{createEntitiesCatalogVideoService:()=>d});var i=r(32489),o=r(373627),s=r(467486),n=r(404101),a=r(405095);const l=({query:e})=>e.url??e.owner_id??"",d=({domain:e,entitiesCatalogSectionsService:t,entitiesGroupsService:r,entitiesUsersService:d,entitiesVideoAlbumsService:c,entitiesVideoService:u,entitiesPlaceholdersService:v})=>{const p=(0,o.createCatalogGetVideoFx)({domain:e}),m=(0,s.errors)({effect:p,getKey:l,store:e.createStore({})}),g=(0,n.pendings)({effect:p,getKey:l,store:e.createStore({})}),_=e.createEvent(),h=e.createStore({}),{$entitiesCatalogSections:y,catalogGetSectionFx:f,initCatalog:S,setCatalogGetSectionsEvent:b}=t;(0,i.sample)({clock:p.doneData,target:S}),(0,i.sample)({clock:p.done,source:h,fn:(e,{params:t,result:r})=>({...e,[l(t)]:r.catalog}),target:h}),(0,i.sample)({clock:[f.doneData,_],source:y,filter:(e,{section:t})=>Boolean(t?.id),fn:(e,{section:t})=>{if(!t)return[];const r=e[t.id];if(!r)return[t];return[{...t,actions:r.actions&&t.actions?[...r.actions,...t.actions]:t.actions,blocks:(0,a.mergeCatalogVideoSectionBlocks)(r.blocks,t.blocks)}]},target:b});const E=(0,i.sample)({clock:[p.doneData,f.doneData,_]});return(0,i.sample)({clock:E,filter:({albums:e})=>Boolean(e?.length),fn:({albums:e=[]})=>e,target:c.setVideoAlbumsEvent}),(0,i.sample)({clock:E,filter:({groups:e})=>Boolean(e?.length),fn:({groups:e=[]})=>e,target:r.setGroupsEvent}),(0,i.sample)({clock:E,filter:({profiles:e})=>Boolean(e?.length),fn:({profiles:e=[]})=>e,target:d.setUsersEvent}),(0,i.sample)({clock:E,filter:({videos:e})=>Boolean(e?.length),fn:({videos:e=[]})=>e,target:u.setVideosEvent}),(0,i.sample)({clock:E,filter:({placeholders:e})=>Boolean(e?.length),fn:({placeholders:e=[]})=>e,target:v.setPlaceholdersEvent}),{$entitiesCatalogVideo:h,$entitiesCatalogVideoErrors:m,$entitiesCatalogVideoLoading:g,catalogGetVideoFx:p,updateSectionEvent:_}}},779215:(e,t,r)=>{r.d(t,{createEntitiesPlaceholdersService:()=>s});var i=r(32489),o=r(398837);const s=({domain:e})=>{const t=e.createStore({}),r=e.createEvent();return(0,i.sample)({clock:r,source:t,fn:(e,t)=>(0,o.mapToEntity)(e,t),target:t}),{$entitiesPlaceholders:t,setPlaceholdersEvent:r}}},405095:(e,t,r)=>{r.d(t,{mergeCatalogVideoSectionBlocks:()=>o});const i=["videos_ids","albums_ids","item_badges","search_author_items"],o=(e,t)=>t?e?t.reduce(((e,t)=>{const r=e.findIndex((({id:e})=>e===t.id));return e[r]?(i.forEach((i=>{if(!t[i])return;const o=e[r][i]??[],s=t[i]??[];e[r]={...e[r],[i]:[...o,...s]}})),e):(e.push(t),e)}),[...e]):t??[]:e??[]},927588:(e,t,r)=>{r.d(t,{createEntitiesFaveVideoService:()=>c});var i=r(32489),o=r(112268),s=r(668882),n=r(467486),a=r(404101);const l=({query:e})=>(0,o.joinRawId)({ownerId:e.owner_id,itemId:e.id}),d=(e,{query:t},r)=>({...e,[(0,o.joinRawId)({ownerId:t.owner_id,itemId:t.id})]:r}),c=({domain:e})=>{const t=(0,s.createFaveAddVideoFx)({domain:e}),r=(0,s.createFaveRemoveVideoFx)({domain:e}),o=(0,n.errors)({effect:t,getKey:l,store:e.createStore({})}),c=(0,a.pendings)({effect:t,getKey:l,store:e.createStore({})}),u=(0,n.errors)({effect:r,getKey:l,store:e.createStore({})}),v=(0,a.pendings)({effect:r,getKey:l,store:e.createStore({})}),p=e.createStore({}),m=e.createEvent();return p.on(m,((e,{id:t,value:r})=>({...e,[t]:r}))),(0,i.sample)({clock:t.done,source:p,filter:(e,{result:t})=>Boolean(t),fn:(e,{params:t})=>d(e,t,!0),target:p}),(0,i.sample)({clock:r.done,source:p,filter:(e,{result:t})=>Boolean(t),fn:(e,{params:t})=>d(e,t,!1),target:p}),{$entitiesFaveAddVideoErrors:o,$entitiesFaveAddVideoLoading:c,$entitiesFaveRemoveVideoErrors:u,$entitiesFaveRemoveVideoLoading:v,$entitiesFaveVideo:p,faveAddVideoFx:t,faveRemoveVideoFx:r,setFaveVideoByIdEvent:m}}},872587:(e,t,r)=>{r.d(t,{createEntitiesGroupsService:()=>c});var i=r(32489),o=r(455234),s=r(887815),n=r(398837),a=r(41489),l=r(467486),d=r(404101);const c=({domain:e})=>{const t=(0,o.createGroupsGetByIdFx)({domain:e}),r=(0,o.createGroupsGetMembersFx)({domain:e}),c=(0,o.createGroupsJoinFx)({domain:e}),u=(0,o.createGroupsLeaveFx)({domain:e}),v=(0,o.createGroupsEditFx)({domain:e}),p=(0,i.createEffect)({handler:e=>{const{groupIds:r,...i}=e.query;return t({...e,query:{...i,group_ids:r.join(",")}})},domain:e}),m=(0,i.createEffect)({handler:e=>r(e),domain:e}),g=(0,s.createVideoGetGroupsForStreamingFx)({domain:e}),_=(0,i.createStore)({},{domain:e}),h=(0,i.createStore)({},{domain:e}),y=(0,i.createStore)({},{domain:e}),f=(0,i.createEvent)({domain:e}),S=e.createEvent();return(0,l.errors)({effect:p,getKey:e=>e.query.groupIds,store:h}),(0,d.pendings)({effect:p,getKey:e=>e.query.groupIds,store:y}),(0,i.sample)({clock:p.done,fn:e=>e.result.groups||[],target:f}),(0,i.sample)({clock:g.done,fn:e=>e.result||[],target:f}),(0,i.sample)({clock:f,source:_,fn:(e,t)=>(0,n.mapToEntity)(e,t),target:_}),(0,a.sampleEntityUpdater)({store:_,fx:c,key:e=>String(e.params.query.group_id),fn:e=>e?{...e,is_member:1}:null}),(0,a.sampleEntityUpdater)({store:_,fx:u,key:e=>String(e.params.query.group_id),fn:e=>e?{...e,is_member:0}:null}),(0,i.sample)({clock:S,fn:()=>({}),target:_}),{$entitiesGroups:_,$entitiesGroupsLoading:y,$entitiesGroupsErrors:h,groupsGetByIdFx:p,getGroupsForStreamingFx:g,setGroupsEvent:f,groupsJoinFx:c,groupsLeaveFx:u,groupsEditFx:v,clearGroupsEvent:S,groupsGetMembersFx:m}}},800729:(e,t,r)=>{r.d(t,{PrivacyServiceAdapter:()=>n});var i=r(331635),o=r(614502),s=r(605967);let n=class{constructor(e){this.searchExcludedFriends=(0,o.store)(e.$searchExcludedFriends),this.searchAllowedFriends=(0,o.store)(e.$searchAllowedFriends),this.privacyFriends=(0,o.store)(e.$privacyFriends),this.friendLists=(0,o.store)(e.$friendLists),this.someFriends=(0,o.store)(e.$someFriends),this.someFriendsTotalCount=(0,o.store)(e.$someFriendsTotalCount),this.getFriendLists=(0,o.event)(e.getFriendLists),this.getFriendListsPending=(0,o.store)(e.$getFriendListsPending),this.getFriendListsError=(0,o.store)(e.$getFriendListsError),this.getSearchExcludedFriends=(0,o.event)(e.searchExcludedFriends),this.getSearchAllowedFriends=(0,o.event)(e.searchAllowedFriends),this.getUsersByIds=(0,o.event)(e.getUsersByIds),this.getUsersByIdsPending=(0,o.store)(e.$getUsersByIdsPending),this.getUsersByIdsError=(0,o.store)(e.$getUsersByIdsError),this.setPrivacyFriends=(0,o.event)(e.setPrivacyFriends),this.searchSomeFriends=(0,o.event)(e.searchSomeFriends),this.searchSomeFriendsReset=(0,o.event)(e.searchSomeFriendsReset),this.dispose=(0,o.event)(e.resetStores)}};n=(0,i.__decorate)([(0,s.adapter)(),(0,i.__metadata)("design:paramtypes",[Object])],n)},596240:(e,t,r)=>{r.d(t,{OTHER_FRIENDS_LIMIT_COUNT:()=>a,createPrivacyService:()=>l});var i=r(32489),o=r(489617),s=r(717788);const n="photo_50",a=3,l=(e,t)=>{const r=e.createEvent("reset");e.onCreateStore((e=>{e.reset(r)}));const l=(0,o.createFriendsSearchFx)({domain:e}),d=(0,s.createUsersGetFx)({domain:e}),c=(0,o.createFriendsGetListsFx)({domain:e}),u=(0,o.createFriendsGetFx)({domain:e}),v=e.createStore(null),p=e.createStore(null),m=e.createStore(null),g=e.createStore(null),_=e.createStore([]),h=e.createStore(null),y=e.createEvent(),f=e.createEvent(),S=e.createEvent(),b=e.createEvent(),E=e.createEvent(),I=e.createEvent(),w=e.createEvent(),A=(0,i.attach)({effect:l,mapParams:({user_id:e,q:t,fields:r,...i})=>({query:{user_id:e,q:t,fields:r},...i})}),P=(0,i.attach)({effect:l,mapParams:({user_id:e,q:t,fields:r,...i})=>({query:{user_id:e,q:t,fields:r},...i})}),V=(0,i.attach)({effect:l,mapParams:({params:e,options:t})=>{const{user_id:r,q:i,offset:o,count:s,fields:n}=e;return{query:{user_id:r,q:i,offset:o,count:s,fields:n},options:t}}}),F=(0,i.attach)({effect:d,mapParams:({user_ids:e,...t})=>({query:{user_ids:e},...t})}),k=(0,i.createEffect)((async({user_id:e,...t})=>{const r={user_id:e,...t,return_system:1},{items:i}=await c({query:r});return await Promise.all(i.map((({id:t,name:r})=>u({query:{user_id:e,list_id:t,fields:n,count:a}}).then((({items:e,count:i})=>({id:t,name:r,count:i,friends:e}))))))})),C=k.pending,x=(0,i.restore)(k.failData,null);x.reset(k),_.reset(w),h.reset(w),(0,i.sample)({clock:f,source:t,fn:(e,t)=>({user_id:e?.id,q:t,fields:n}),target:A}),(0,i.sample)({clock:A.doneData,source:t,fn:(e,t)=>t.items.filter((({id:t})=>t!==e?.id)),target:v}),(0,i.sample)({clock:S,source:t,fn:(e,t)=>({user_id:e?.id,q:t,fields:n}),target:P}),(0,i.sample)({clock:P.doneData,source:t,fn:(e,t)=>t.items.filter((({id:t})=>t!==e?.id)),target:p}),(0,i.sample)({clock:I,source:{owner:t,someFriends:_,friendsTotalCount:h},filter:({someFriends:e,friendsTotalCount:t})=>null===t||e.length<t,fn:({owner:e,someFriends:t},{query:r,signal:i})=>({params:{user_id:e?.id,q:r,offset:t.length,count:50,fields:n},options:{signal:i}}),target:V}),_.on(V.doneData,((e,t)=>e.concat(t.items))),h.on(V.doneData,((e,t)=>t.count)),(0,i.sample)({clock:b,fn:e=>({user_ids:e.join(",")}),target:F});const T=F.pending,L=(0,i.restore)(F.failData,null);return L.reset(F),m.on(F.doneData,((e,t)=>t)),m.on(E,((e,t)=>{const r=new Set;return Array.from([...e||[],...t].filter((e=>!r.has(e.id)&&(r.add(e.id),!0)),r))})),(0,i.sample)({clock:y,source:t,fn:e=>({user_id:e?.id||0}),target:k}),g.on(k.doneData,((e,t)=>t)),{$searchExcludedFriends:v,$searchAllowedFriends:p,$privacyFriends:m,$friendLists:g,$someFriends:_,$someFriendsTotalCount:h,searchExcludedFriends:f,searchAllowedFriends:S,getUsersByIds:b,$getUsersByIdsPending:T,$getUsersByIdsError:L,setPrivacyFriends:E,searchSomeFriends:I,searchSomeFriendsReset:w,resetStores:r,searchExcludedFriendsFx:A,searchAllowedFriendsFx:P,searchSomeFriendsFx:V,getUsersFx:F,getFriendListsFx:k,getFriendLists:y,$getFriendListsPending:C,$getFriendListsError:x}}},946927:(e,t,r)=>{r.d(t,{createEntitiesUsersService:()=>a});var i=r(32489),o=r(828686),s=r(398837),n=r(717788);const a=e=>{const t=(0,n.createUsersGetFx)(e),{domain:r}=e,a=r.createStore({}),l=r.createStore({}),d=r.createStore({}),c=r.createEvent(),u=r.createEvent();return d.on(t,((e,{query:t})=>(0,o.updateEntitiesBy)(e,t.user_ids,!0))),d.on(t.finally,((e,{params:t})=>(0,o.updateEntitiesBy)(e,t.query.user_ids,!1))),l.on(t,((e,{query:t})=>(0,o.updateEntitiesBy)(e,t.user_ids,null))),l.on(t.fail,((e,{error:t,params:r})=>(0,o.updateEntitiesBy)(e,r.query.user_ids,t))),(0,i.sample)({clock:t.done,filter:({result:e})=>Boolean(e),fn:({result:e})=>e,target:c}),(0,i.sample)({clock:c,source:a,fn:(e,t)=>(0,s.mapToEntity)(e,t),target:a}),(0,i.sample)({clock:u,fn:()=>({}),target:a}),{$entitiesUsers:a,$entitiesUsersErrors:l,$entitiesUsersLoading:d,getUsersFx:t,setUsersEvent:c,clearUsersEvent:u}}},900348:(e,t,r)=>{r.d(t,{EntitiesVideoAlbumsServiceAdapter:()=>n});var i=r(331635),o=r(614502),s=r(605967);let n=class{constructor(e){this.videoAlbums=(0,o.store)(e.$entitiesVideoAlbums),this.videoAlbumsErrors=(0,o.store)(e.$entitiesVideoAlbumsErrors),this.videoAlbumsLoading=(0,o.store)(e.$entitiesVideoAlbumsLoading),this.videoDeletedAlbums=(0,o.store)(e.$entitiesVideoDeletedAlbums),this.videoDeletedAlbumsErrors=(0,o.store)(e.$entitiesVideoDeletedAlbumsErrors),this.videoDeletedAlbumsPending=(0,o.store)(e.$entitiesVideoDeletedAlbumsPending),this.videoEditedAlbumsErrors=(0,o.store)(e.$entitiesVideoEditedAlbumsErrors),this.videoEditedAlbumsPending=(0,o.store)(e.$entitiesVideoEditedAlbumsPending),this.createVideoAlbumPending=(0,o.store)(e.$createVideoAlbumPending),this.patchVideoAlbums=(0,o.event)(e.patchVideoAlbumsEvent),this.setVideoAlbums=(0,o.event)(e.setVideoAlbumsEvent),this.createVideoAlbum=(0,o.effect)(e.createVideoAlbumFx),this.abortCreateRequest=(0,o.event)(e.abortCreateRequestEvent),this.editVideoAlbumById=(0,o.effect)(e.editVideoAlbumByIdFx),this.abortEditRequest=(0,o.event)(e.abortEditRequestEvent),this.deleteVideoAlbumById=(0,o.effect)(e.deleteVideoAlbumByIdFx),this.getVideoAlbumById=(0,o.effect)(e.getVideoAlbumByIdFx),this.subscribeToVideoAlbum=(0,o.effect)(e.subscribeToVideoAlbumFx),this.unsubscribeFromVideoAlbum=(0,o.effect)(e.unsubscribeFromVideoAlbumFx),this.getVideoAlbums=(0,o.effect)(e.getVideoAlbumsFx),this.addVideoToAlbum=(0,o.effect)(e.addVideoToAlbumFx),this.removeVideoFromAlbum=(0,o.effect)(e.removeVideoFromAlbumFx)}};n=(0,i.__decorate)([(0,s.adapter)(),(0,i.__metadata)("design:paramtypes",[Object])],n)},143735:(e,t,r)=>{r.d(t,{createEntitiesVideoAlbumService:()=>g});var i=r(32489),o=r(112268),s=r(757459),n=r(279506),a=r(887815),l=r(62289),d=r(828686),c=r(728926),u=r(154030),v=r(990950),p=r(847891);const m=({album_id:e,owner_id:t=0})=>(0,o.joinRawId)({ownerId:t,itemId:e}),g=e=>{const t=(0,a.createVideoDeleteAlbumFx)(e),r=(0,a.createVideoEditAlbumFx)(e),g=(0,a.createVideoAddAlbumFx)(e),_=(0,a.createVideoGetAlbumByIdFx)(e),h=(0,a.createVideoGetAlbumsExtendedFx)(e),y=(0,a.createVideoAddToAlbumFx)(e),f=(0,a.createVideoRemoveFromAlbumFx)(e),{domain:S}=e,b=S.createStore({}),E=S.createStore({}),I=S.createStore({}),w=S.createStore({}),A=S.createStore({}),P=S.createStore({}),V=S.createStore({}),F=S.createStore({}),k=S.createEvent(),C=S.createEvent(),[x,T]=(0,c.createAbortControllerField)(S),[L,R]=(0,c.createAbortControllerField)(S),M=(0,i.attach)({effect:t,mapParams:({id:e,...t})=>{const{itemId:r,ownerId:i}=(0,s.splitRawId)(e);return{...t,query:p.Ranges.isGroupId(i)?{album_id:r,group_id:p.Ranges.convertOwnerIdToGroupId(i)}:{album_id:r,owner_id:i}}}}),O=(0,i.attach)({effect:r,source:x,mapParams:({ownerId:e,itemId:t,title:r,privacy:i,photoId:o,photoHash:s,verticalPhotoTag:n,verticalPhotoHash:a,...d},c)=>{const u={album_id:t,title:r};return void 0!==o&&(u.photo_id=o,u.photo_hash=s),void 0!==n&&(u.vertical_photo_tag=n,u.vertical_photo_hash=a),i&&(u.privacy=(0,l.stringifyBasePrivacy)(i)),p.Ranges.isGroupId(e)&&(u.group_id=p.Ranges.convertOwnerIdToGroupId(e)),{...d,query:u,controller:c??void 0}}});(0,i.sample)({clock:O,source:x,fn:e=>(e?.abort(),new AbortController),target:x});const B=(0,i.attach)({effect:g,source:L,mapParams:({ownerId:e,title:t,privacy:r,photoId:i,photoHash:o,verticalPhotoTag:s,verticalPhotoHash:n,...a},d)=>{const c={title:t};return void 0!==i&&(c.photo_id=i,c.photo_hash=o),void 0!==s&&(c.vertical_photo_tag=s,c.vertical_photo_hash=n),r&&(c.privacy=(0,l.stringifyBasePrivacy)(r)),p.Ranges.isGroupId(e)&&(c.group_id=p.Ranges.convertOwnerIdToGroupId(e)),{...a,query:c,controller:d??void 0}}});(0,i.sample)({clock:B,source:L,fn:e=>(e?.abort(),new AbortController),target:L});const $=B.pending,G=(0,u.createVideoAlbumSubscriptionEffect)((0,a.createVideoSubscribeToAlbum)(e),k,!0),D=(0,u.createVideoAlbumSubscriptionEffect)((0,a.createVideoUnsubscribeFromAlbum)(e),k,!1);return(0,v.registerEntitiesSetSample)(C,b),I.on(_,((e,{query:t})=>(0,d.updateEntitiesBy)(e,m(t),!0))),I.on(_.finally,((e,{params:t})=>(0,d.updateEntitiesBy)(e,m(t.query),!1))),E.on(_,((e,{query:t})=>(0,d.updateEntitiesBy)(e,m(t),null))),E.on(_.fail,((e,{error:t,params:r})=>(0,d.updateEntitiesBy)(e,m(r.query),t))),b.on(_.done,((e,{params:t,result:r})=>(0,d.updateEntitiesBy)(e,m(t.query),r))),P.on(M,((e,{id:t})=>(0,d.updateEntitiesBy)(e,t,!0))),P.on(M.finally,((e,{params:t})=>(0,d.updateEntitiesBy)(e,t.id,!1))),A.on(M,((e,{id:t})=>(0,d.updateEntitiesBy)(e,t,null))),A.on(M.fail,((e,{error:t,params:r})=>(0,d.updateEntitiesBy)(e,r.id,t))),w.on(M.done,((e,{params:t,result:r})=>r?(0,d.updateEntitiesBy)(e,t.id,!0):e)),F.on(O,((e,{ownerId:t,itemId:r})=>(0,d.updateEntitiesBy)(e,(0,o.joinRawId)({itemId:r,ownerId:t}),!0))),F.on(O.finally,((e,{params:t})=>(0,d.updateEntitiesBy)(e,(0,o.joinRawId)({itemId:t.itemId,ownerId:t.ownerId}),!1))),V.on(O,((e,{ownerId:t,itemId:r})=>(0,d.updateEntitiesBy)(e,(0,o.joinRawId)({itemId:r,ownerId:t}),null))),V.on(O.fail,((e,{error:t,params:r})=>(0,d.updateEntitiesBy)(e,(0,o.joinRawId)({itemId:r.itemId,ownerId:r.ownerId}),t))),(0,i.sample)({clock:O.done,fn:({params:e})=>[{owner_id:e.ownerId,id:e.itemId,title:e.title,privacy:e.privacy}],target:k}),(0,i.sample)({clock:k,source:b,fn:(e,t)=>t.reduce(((t,r)=>{const i=(0,o.joinRawId)({ownerId:r.owner_id,itemId:r.id}),s={...e[i],...r};return(0,n.isVideoVideoAlbumFull)(s)&&t.push(s),t}),[]),target:C}),{$entitiesVideoAlbums:b,$entitiesVideoAlbumsErrors:E,$entitiesVideoAlbumsLoading:I,$entitiesVideoDeletedAlbums:w,$entitiesVideoDeletedAlbumsErrors:A,$entitiesVideoDeletedAlbumsPending:P,$entitiesVideoEditedAlbumsErrors:V,$entitiesVideoEditedAlbumsPending:F,patchVideoAlbumsEvent:k,setVideoAlbumsEvent:C,editVideoAlbumByIdFx:O,abortEditRequestEvent:T,createVideoAlbumFx:B,abortCreateRequestEvent:R,$createVideoAlbumPending:$,deleteVideoAlbumByIdFx:M,getVideoAlbumByIdFx:_,subscribeToVideoAlbumFx:G,unsubscribeFromVideoAlbumFx:D,getVideoAlbumsFx:h,addVideoToAlbumFx:y,removeVideoFromAlbumFx:f}}},169135:(e,t,r)=>{r.d(t,{createEntitiesVideoService:()=>l});var i=r(32489),o=r(112268),s=r(887815),n=r(828686),a=r(990950);const l=({domain:e,entitiesGroupsService:t,entitiesUsersService:r})=>{const l=(0,s.createVideoGetFx)({domain:e}),d=(0,s.createVideoGetVideoDiscoverFx)({domain:e}),c=(0,s.createVideoFeedVideosForYouBlockItemsFx)({domain:e}),u=(0,s.createVideoAddFx)({domain:e}),v=(0,s.createVideoDeleteFx)({domain:e}),p=(0,s.createVideoRestoreFx)({domain:e}),m=e.createStore({}),g=e.createStore({}),_=e.createStore({}),h=e.createEvent(),y=e.createEvent(),f=e.createEvent();_.on(l,((e,{query:t})=>(0,n.updateEntitiesBy)(e,t.videos,!0))),_.on(l.finally,((e,{params:t})=>(0,n.updateEntitiesBy)(e,t.query.videos,!1))),g.on(l,((e,{query:t})=>(0,n.updateEntitiesBy)(e,t.videos,void 0))),g.on(l.fail,((e,{error:t,params:r})=>(0,n.updateEntitiesBy)(e,r.query.videos,t)));const S=(0,i.attach)({effect:l,mapParams:({id:e,extended:t,group_id:r,...i})=>({...i,query:{count:1,videos:e,extended:t,group_id:r}})});return(0,i.sample)({clock:[l.done,d.done,c.done],filter:({result:e})=>Boolean(e.items),fn:({result:e})=>e.items,target:h}),t?.setGroupsEvent&&(0,i.sample)({clock:[l.done,d.done,c.done],filter:({result:e})=>Boolean(e.groups?.length),fn:({result:e})=>e.groups??[],target:t?.setGroupsEvent}),r?.setUsersEvent&&(0,i.sample)({clock:[l.done,d.done,c.done],filter:({result:e})=>Boolean(e.profiles?.length),fn:({result:e})=>e.profiles??[],target:r.setUsersEvent}),(0,i.sample)({clock:f,source:m,fn:(e,t)=>t.map((t=>{const r=(0,o.joinRawId)({ownerId:t.owner_id,itemId:t.id});return{...e[r],...t}})),target:h}),(0,a.registerEntitiesSetSample)(h,m),(0,i.sample)({clock:y,fn:()=>({}),target:m}),{$entitiesVideo:m,$entitiesVideoLoading:_,$entitiesVideoErrors:g,patchVideosEvent:f,setVideosEvent:h,clearVideosEvent:y,videoAddFx:u,videoGetFx:l,videoGetByIdFx:S,videoGetVideoDiscoverFx:d,videoDeleteFx:v,videoRestoreFx:p,videoFeedVideosForYouBlockItemsFx:c}}},637774:(e,t,r)=>{r.d(t,{createListsVideosAlbumsService:()=>a});var i=r(112268),o=r(887815),s=r(301173);const n=({id:e,owner_id:t})=>void 0===e||void 0===t?"":(0,i.joinRawId)({itemId:e,ownerId:t}),a=({domain:e,entitiesVideoAlbumService:t})=>{const r=(0,o.createVideoGetAlbumsExtendedFx)({domain:e}),i=e.createEffect(r),a=(0,s.createFactoryLists)({$entitiesItems:t.$entitiesVideoAlbums,domain:e,fetchFx:i,getItemKey:n,getList:({items:e})=>e,getListCount:({count:e})=>e,getListKey:({entityKey:e})=>e,getEntityKey:n});return{resetVideosAlbumsEvent:a.resetEvent,fetchMoreVideosAlbumsEvent:a.fetchMoreEvent,fetchVideosAlbumsFx:a.fetchFx,$videosAlbumsFullyLoaded:a.$entitiesFullyLoaded,$videosAlbumsLoading:a.$entitiesLoading,$videosAlbumsIds:a.$entitiesListIds,$videosAlbumsCount:a.$entitiesCount,$videosAlbumsError:a.$entitiesError,selectStores:a.selectStores}}},265498:(e,t,r)=>{r.d(t,{createListsVideosService:()=>n});var i=r(112268),o=r(301173);const s=({id:e,owner_id:t})=>void 0===e||void 0===t?"":(0,i.joinRawId)({itemId:e,ownerId:t}),n=({domain:e,entitiesVideoService:t})=>{const r=e.createEffect(t.videoGetFx),i=(0,o.createFactoryLists)({$entitiesItems:t.$entitiesVideo,domain:e,fetchFx:r,getItemKey:s,getList:({items:e})=>e,getListCount:({count:e})=>e,getListKey:({entityKey:e})=>e,getEntityKey:s});return{resetVideosEvent:i.resetEvent,fetchMoreVideosEvent:i.fetchMoreEvent,fetchVideosFx:i.fetchFx,$videosFullyLoaded:i.$entitiesFullyLoaded,$videosLoading:i.$entitiesLoading,$videosIds:i.$entitiesListIds,$videosCount:i.$entitiesCount,$videosError:i.$entitiesError,selectStores:i.selectStores}}},728926:(e,t,r)=>{r.d(t,{createAbortControllerField:()=>o});var i=r(32489);const o=e=>{const t=e.createStore(null),r=e.createEvent();return(0,i.sample)({clock:r,source:t,fn:e=>!1===e?.signal.aborted?(e.abort(),null):e,target:t}),[t,r]}},154030:(e,t,r)=>{r.d(t,{createVideoAlbumSubscriptionEffect:()=>o});var i=r(32489);const o=(e,t,r)=>{const o=(0,i.createEffect)((({optimistic:t,...r})=>e(r)));return(0,i.sample)({clock:o,filter:({optimistic:e=!1,query:t})=>e&&void 0!==t.album_id,fn:({query:e})=>[{owner_id:e.owner_id,id:Number(e.album_id),is_subscribed:r}],target:t}),(0,i.sample)({clock:o.fail,filter:({params:e})=>Boolean(e.optimistic)&&void 0!==e.query.album_id,fn:({params:e})=>[{owner_id:e.query.owner_id,id:Number(e.query.album_id),is_subscribed:!r}],target:t}),(0,i.sample)({clock:o.done,filter:({params:e})=>!e.optimistic&&void 0!==e.query.album_id,fn:({params:e})=>[{owner_id:e.query.owner_id,id:Number(e.query.album_id),is_subscribed:r}],target:t}),o}},990950:(e,t,r)=>{r.d(t,{registerEntitiesSetSample:()=>n});var i=r(32489),o=r(112268),s=r(398837);const n=(e,t)=>{(0,i.sample)({clock:e,source:t,fn:(e,t)=>{const r=t.filter((e=>void 0!==e.owner_id&&void 0!==e.id));return r.length?(0,s.mapToEntity)(e,r,(e=>(0,o.joinRawId)({ownerId:e.owner_id,itemId:e.id}))):e},target:t})}},41489:(e,t,r)=>{r.d(t,{sampleEntityUpdater:()=>i});const i=e=>{const{fx:t,key:r,store:i,fn:o}=e;return i.on(t.done,((e,t)=>{const i="function"==typeof r?r(t):t.params.query[r],s=e[i];return{...e,[i]:o(s,t)}})),i}},467486:(e,t,r)=>{r.d(t,{errors:()=>o});var i=r(679005);function o({effect:e,getKey:t,store:r}){return r.on(e,((e,r)=>(0,i.produce)(e,(e=>{const i=t(r);Array.isArray(i)?i.forEach((t=>e[t]=null)):i&&(e[i]=null)})))),r.on(e.fail,((e,{error:r,params:o})=>(0,i.produce)(e,(e=>{const i=t(o);Array.isArray(i)?i.forEach((t=>e[t]=r)):i&&(e[i]=r)})))),r}},398837:(e,t,r)=>{r.d(t,{mapToEntity:()=>i});const i=(e,t,r="id")=>{const i={...e};return t.reduce(((e,t)=>(e["function"==typeof r?r(t):t[r]]=t,e)),i)}},404101:(e,t,r)=>{r.d(t,{pendings:()=>o});var i=r(679005);function o({effect:e,getKey:t,store:r}){return r.on(e,((e,r)=>(0,i.produce)(e,(e=>{const i=t(r);Array.isArray(i)?i.forEach((t=>e[t]=!0)):i&&(e[i]=!0)})))),r.on(e.finally,((e,{params:r})=>(0,i.produce)(e,(e=>{const i=t(r);Array.isArray(i)?i.forEach((t=>e[t]=!1)):i&&(e[i]=!1)})))),r}},873469:(e,t,r)=>{r.d(t,{resetEntities:()=>o});var i=r(679005);const o=(e,t)=>t?(0,i.produce)(e,(e=>{e[t]=null})):{}},421290:(e,t,r)=>{r.d(t,{setEntity:()=>i});const i=(e,t,r)=>t?{...e,[t]:r}:e},62289:(e,t,r)=>{function i(e){const t=e.lists?.allowed?.map((e=>`list${e}`)).join(","),r=e.lists?.excluded?.map((e=>`-list${e}`)).join(","),i=e.owners?.allowed?.join(","),o=e.owners?.excluded?.map((e=>-e)).join(",");return[e.category,t,r,i,o].filter(Boolean).join(",")}r.d(t,{stringifyBasePrivacy:()=>i})},828686:(e,t,r)=>{r.d(t,{updateEntitiesBy:()=>i});const i=(e,t,r)=>{const i=Array.isArray(t)?t:t?.split(",");if(!i?.length)return e;if(void 0!==r){const t=Object.fromEntries(new Map(i.map((e=>[e,r]))));return{...e,...t}}return i.reduce(((e,t)=>(delete e[t],e)),{...e})}},819952:(e,t,r)=>{function i(e){e.preventDefault(),e.stopPropagation()}r.d(t,{cancelEvent:()=>i})},279506:(e,t,r)=>{r.d(t,{isVideoVideoAlbumFull:()=>i});const i=e=>"object"==typeof e&&null!==e&&"id"in e&&"owner_id"in e&&"title"in e&&"count"in e},364994:(e,t,r)=>{function i(e,t){return e.has(t)?e.delete(t):e.add(t),e}r.d(t,{toggleSet:()=>i})},240751:(e,t,r)=>{r.d(t,{isValidUrl:()=>s,makeUrl:()=>o});var i=r(760325);function o(e,t,r=!0){if(!t)return e;const[o,s]=e.split("?"),n={},a=[];return s&&s.split("&").map((e=>{const[r,i]=e.split("=");r in t||(t[r]=i)})),Object.keys(t).forEach((e=>{const r=t[e];var o;("string"==typeof(o=r)&&o||(0,i.isNumber)(r))&&(n[e]=r)})),Object.keys(n).forEach((e=>{const t=r?encodeURIComponent(n[e]):n[e];a.push(`${e}=${t}`)})),0===a.length?o:`${o}?${a.join("&")}`}const s=e=>{try{return new URL(e),!0}catch{}return!1}},498084:(e,t,r)=>{r.d(t,{connectTrackTmrGroupsJoin:()=>d,groupsJoinAction:()=>c,trackTmrGroupsJoin:()=>a});var i=r(141229),o=r(933052),s=r(32489),n=r(476726);const a=()=>{(0,n.partConfigEnabled)("group_join_track_event_count")&&(0,i.tmrSendTimespentEvent)(i.MY_TRACKER_COUNT_EVENT_IDS.COMMUNITY_SUBSCRIBE)},l=(0,s.createEffect)({name:"fx/track_group_join",handler:a}),d=e=>(0,s.sample)({clock:e.done,target:l}),c=(e,t,r)=>(0,o.api)("groups.join",e,t,r).then((e=>(a(),e)))},175241:(e,t,r)=>{r.d(t,{connectTrackTmrGroupsJoin:()=>i.connectTrackTmrGroupsJoin,groupsJoinAction:()=>i.groupsJoinAction,trackTmrGroupsJoin:()=>i.trackTmrGroupsJoin});var i=r(498084)},388716:(e,t,r)=>{r.d(t,{PrivacyCategoryDropdown:()=>p});var i=r(474848),o=r(445248),s=r(349826),n=r(765668),a=r(234337),l=r(846342),d=r(274034),c=r(753457),u=r(610989),v=r(525714);const p=({selectedOptionId:e,onClick:t,options:r})=>(0,i.jsx)(o.SimpleCell,{hasActive:!1,hasHover:!1,maxHeight:36,after:(0,i.jsx)(s.DropdownActionSheet,{trigger:"click",placement:"bottom-end",content:(0,i.jsx)(i.Fragment,{children:r.map((r=>(0,i.jsx)(s.DropdownActionSheet.Item,{after:r===e?(0,i.jsx)(l.Icon20CheckCircleOn,{}):null,onClick:()=>t(r),children:(0,v.getCategoryNameByOption)(r)},r)))}),children:(0,i.jsx)(c.Paragraph,{children:(0,i.jsxs)(n.Link,{color:(0,a.getColorClass)("color_text_accent"),children:[(0,v.getCategoryNameByOption)(e).toLowerCase(),(0,i.jsx)(d.Icon16Dropdown,{})]})})}),children:u.getLang("global_privacy_settings_allowed")})},329148:(e,t,r)=>{r.d(t,{PrivacyDropdown:()=>c});var i=r(474848),o=r(846342),s=r(349826),n=r(106412),a=r(364994),l=r(218894),d=r(843010);function c({options:e,setPrivacy:t,checkedFriendLists:r=new Set,friendLists:c,children:u,placement:v,onClickExceptFriends:p,onClickSomeFriends:m,onShownChange:g,width:_,offsetByMainAxis:h}){return(0,i.jsx)(s.DropdownActionSheet,{placement:v,onShownChange:g,offsetByMainAxis:h,trigger:"click",width:_,content:(0,i.jsx)(i.Fragment,{children:e.map(((e,u)=>{const v=(0,d.getPrivacyOptionName)(e)??"";switch(e){case l.SETTINGS_PRIVACY_SOME_LISTS:return c?.length&&(0,i.jsx)(n.DropdownActionSubSheet,{maxHeight:180,sheet:(0,i.jsx)(i.Fragment,{children:c.map((({name:e,id:s})=>(0,i.jsx)(n.DropdownActionSubSheet.Item,{after:r.has(`${s}`)&&(0,i.jsx)(o.Icon20CheckCircleOn,{}),onClick:()=>(e=>{const i=(0,a.toggleSet)(r,e);t({option:l.SETTINGS_PRIVACY_SOME_LISTS,allowed:i})})(`${s}`),keepOpen:!0,children:e},s)))}),children:v},e);case l.SETTINGS_PRIVACY_EVERYONE_EXCEPT:case l.SETTINGS_PRIVACY_FRIENDS_EXCEPT:return(0,i.jsx)(s.DropdownActionSheet.Item,{onClick:p,children:v},e);case l.SETTINGS_PRIVACY_SOME_FRIENDS:return(0,i.jsx)(s.DropdownActionSheet.Item,{onClick:m,children:v},e);default:return(0,i.jsx)(s.DropdownActionSheet.Item,{onClick:()=>t({option:e}),children:v},u)}}))}),children:u})}},330524:(e,t,r)=>{r.d(t,{PrivacySelect:()=>l});var i=r(474848),o=r(753457),s=r(414698),n=r(480958),a=r(610989);const l=({isPending:e,value:t,options:r,onChange:l,onInputChange:d,getRef:c})=>(0,i.jsx)(o.ChipsSelect,{value:t,onChange:l,onInputChange:d,options:r,fetching:e,placeholder:a.getLang("friends_privacy_choose"),filterFn:!1,getRef:c,renderOption:(e,t)=>(0,i.jsx)(o.CustomSelectOption,{...e,before:t.friend?(0,i.jsx)(s.Avatar,{size:24,src:t.friend.photo_50}):null,description:t.friendList?t.subTitle:null,children:(0,i.jsx)(n.TextClamp,{lines:1,children:t.label})})})},580754:(e,t,r)=>{r.d(t,{PrivacySetting:()=>g});var i=r(474848),o=r(445248),s=r(595154),n=r(234337),a=r(725772),l=r(116135),d=r(140083),c=r(304045),u=r(218894),v=r(329148);const p=({placement:e,privacy:t,children:r,...o})=>(0,i.jsx)(v.PrivacyDropdown,{placement:e,checkedFriendLists:t?.option===u.SETTINGS_PRIVACY_SOME_LISTS?t?.allowed:void 0,width:260,...o,children:r}),m=({privacy:e,getRootRef:t,disabled:r,title:s,subtitle:n,after:l,...d})=>(0,i.jsx)(o.SimpleCell,{after:l,subtitle:(0,i.jsxs)("div",{className:c.default.subtitle,children:[e?.option!==u.SETTINGS_PRIVACY_ALL?(0,i.jsx)(a.Icon12Lock,{className:c.default.subtitleIcon}):null,n]}),getRootRef:t,disabled:r,multiline:!0,...d,children:s}),g=({inMobileView:e=!1,...t})=>e?(0,i.jsx)(m,{...t,disabled:!0,after:(0,i.jsx)(p,{offsetByMainAxis:0,...t,children:(0,i.jsx)(s.IconButton,{children:(0,i.jsx)(l.Icon28MoreVertical,{className:(0,n.getColorClass)("color_icon_tertiary")})})})}):(0,i.jsx)(p,{...t,children:(0,i.jsx)(m,{...t,after:(0,i.jsx)(d.Icon24ChevronCompactRight,{className:(0,n.getColorClass)("color_icon_tertiary")})})})},335190:(e,t,r)=>{r.d(t,{INPUT_CHANGE_DEBOUNCE_MS:()=>i,SCROLL_DEBOUNCE_MS:()=>o});const i=300,o=200},77449:(e,t,r)=>{r.d(t,{usePrivacySelect:()=>a});var i=r(296540),o=r(248782),s=r(525714),n=r(335190);const a=({friends:e,listIds:t,ownerIds:r,allPrivacyFriends:a,friendLists:l,onSearch:d,otherFriendsLimitCount:c})=>{const[u,v]=(0,i.useState)([]),[p,m]=(0,i.useState)(""),g=(0,i.useMemo)((()=>{const e=a?.filter((({id:e})=>r?.includes(e)));return(0,s.getFriendsOptions)(e||null)}),[r,a]),_=(0,i.useMemo)((()=>{const e=l?.filter((({id:e})=>t?.includes(e)));return(0,s.getFriendListOptions)(e||null,c)}),[t,l]),h=(0,s.getFriendsOptions)(e),y=l?.filter((({name:e,count:t})=>t>0&&e.toLowerCase().includes(p.toLowerCase())))||null,f=(0,s.getFriendListOptions)(y,c),S=h.concat(f);(0,i.useEffect)((()=>{(g.length||_.length)&&v(g.concat(_))}),[g,_]),(0,i.useEffect)((()=>{d(p)}),[p,d]);const b=(0,i.useCallback)((0,o.debounce)((({target:{value:e}})=>{m(e.trim())}),n.INPUT_CHANGE_DEBOUNCE_MS),[]);return{value:u,options:S,onChange:e=>v(e),onInputChange:b}}},36895:(e,t,r)=>{r.d(t,{getDefaultBasePrivacyView:()=>_,getPrivacyExceptOptionsOptions:()=>g,getSettingsDropdownOptions:()=>m,mapPrivacy:()=>s,mapPrivacyCategory:()=>v,mapPrivacyToBasePrivacy:()=>p});var i=r(218894),o=r(467225);const s={[i.SETTINGS_PRIVACY_ALL]:"all",[i.SETTINGS_PRIVACY_FRIENDS]:"friends",[i.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS]:"friends_of_friends",[i.SETTINGS_PRIVACY_ONLY_ME]:"only_me"},n=[i.SETTINGS_PRIVACY_ALL,i.SETTINGS_PRIVACY_FRIENDS,i.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS,i.SETTINGS_PRIVACY_ONLY_ME],a=[i.SETTINGS_PRIVACY_EVERYONE_EXCEPT,i.SETTINGS_PRIVACY_SOME_FRIENDS,i.SETTINGS_PRIVACY_SOME_LISTS],l=[i.SETTINGS_PRIVACY_ALL,i.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS],d=[i.SETTINGS_PRIVACY_FRIENDS,i.SETTINGS_PRIVACY_SOME_FRIENDS],c=[i.SETTINGS_PRIVACY_ALL,i.SETTINGS_PRIVACY_FRIENDS,i.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS,i.SETTINGS_PRIVACY_SOME_FRIENDS],u={all:i.SETTINGS_PRIVACY_ALL,friends:i.SETTINGS_PRIVACY_FRIENDS,friends_of_friends:i.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS,only_me:i.SETTINGS_PRIVACY_ONLY_ME};function v({category:e,lists:t,owners:r}){if(e===i.SETTINGS_PRIVACY_ALL&&r?.excluded?.length){const e=new Set(r.excluded.map(String));return{option:i.SETTINGS_PRIVACY_EVERYONE_EXCEPT,excluded:e}}if(e){const t=u[e];return t?{option:t}:null}if(t?.allowed?.length){const e=new Set(t.allowed.map(String));return{option:i.SETTINGS_PRIVACY_SOME_LISTS,allowed:e}}if(r?.allowed?.length){const e=new Set(r.allowed.map(String));return{option:i.SETTINGS_PRIVACY_SOME_FRIENDS,allowed:e}}return null}function p({option:e,allowed:t,excluded:r},i,o){const n=s[e];return n||t?.size||r?.size?{category:n,lists:{allowed:t?Array.from(t,(e=>Number(e))):[],excluded:r?Array.from(r,(e=>Number(e))):[]}}:o.lists?.allowed?.length?o.lists?.excluded?.length||o.owners?.allowed?.length||o.owners?.excluded?.length?{...o,category:i.category,lists:{...o.lists,allowed:[]}}:i:o}const m=e=>e?[...n,...a].filter((e=>!l.includes(e))):[...n,...a],g=(e,t)=>t===o.PHOTOS_WITH_ME_ALBUM_ID?d:e?c.filter((e=>e!==i.SETTINGS_PRIVACY_ALL)):c,_=e=>({category:e?i.SETTINGS_PRIVACY_FRIENDS:i.SETTINGS_PRIVACY_ALL})},843010:(e,t,r)=>{r.d(t,{getPrivacyOptionName:()=>s,getPrivacyOptionSubtitle:()=>n});var i=r(610989),o=r(218894);function s(e){switch(e){case o.SETTINGS_PRIVACY_ALL:return i.getLang("privacy_options_all_users");case o.SETTINGS_PRIVACY_EVERYONE_EXCEPT:return i.getLang("privacy_options_advanced_settings");case o.SETTINGS_PRIVACY_FRIENDS:return i.getLang("privacy_options_friends_only");case o.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS:return i.getLang("privacy_options_friends_and_friends");case o.SETTINGS_PRIVACY_ONLY_ME:return i.getLang("privacy_options_only_me");case o.SETTINGS_PRIVACY_SOME_FRIENDS:return i.getLang("privacy_options_some_friends");case o.SETTINGS_PRIVACY_SOME_LISTS:return i.getLang("privacy_options_some_friend_lists");case o.SETTINGS_PRIVACY_FRIENDS_EXCEPT:return i.getLang("settings_privacy_options_advanced_friends_settings");default:return}}function n(e){switch(e){case o.SETTINGS_PRIVACY_ALL:return i.getLang("privacy_options_all_users");case o.SETTINGS_PRIVACY_EVERYONE_EXCEPT:return i.getLang("global_privacy_settings_everyone_except_subtitle");case o.SETTINGS_PRIVACY_FRIENDS:return i.getLang("privacy_options_friends_only");case o.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS:return i.getLang("privacy_options_friends_and_friends");case o.SETTINGS_PRIVACY_ONLY_ME:return i.getLang("privacy_options_only_me");case o.SETTINGS_PRIVACY_SOME_FRIENDS:return i.getLang("global_privacy_settings_some_friends_subtitle");case o.SETTINGS_PRIVACY_SOME_LISTS:return i.getLang("global_privacy_settings_some_friend_lists_subtitle");case o.SETTINGS_PRIVACY_FRIENDS_EXCEPT:return i.getLang("global_privacy_settings_some_friends_subtitle");default:return}}},218894:(e,t,r)=>{r.d(t,{SETTINGS_PRIVACY_ALL:()=>i,SETTINGS_PRIVACY_EVERYONE_EXCEPT:()=>d,SETTINGS_PRIVACY_FRIENDS:()=>o,SETTINGS_PRIVACY_FRIENDS_EXCEPT:()=>c,SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS:()=>s,SETTINGS_PRIVACY_ONLY_ME:()=>n,SETTINGS_PRIVACY_SOME_FRIENDS:()=>a,SETTINGS_PRIVACY_SOME_LISTS:()=>l});const i="all",o="friends",s="friends_of_friends",n="only_me",a="some_friends",l="some_lists",d="everyone_except",c="friends_except"},525714:(e,t,r)=>{r.d(t,{getCategoryNameByOption:()=>g,getCategoryOptionByPrivacy:()=>m,getFriendListOptions:()=>p,getFriendsOptions:()=>v,getPrivacyFriends:()=>c,getPrivacySubtitles:()=>d,mapPrivacyValueToBasePrivacy:()=>u});var i=r(218894),o=r(610989),s=r(952881),n=r(36895);const a=(e,t)=>{const r=e.length+t.length;if(r>2){const i=e[0]?.name||(0,s.getOwnerName)(t[0]),n=0===t.length?o.getLang("global_privacy_settings_N_list_subtitle",r-1):o.getLang("global_privacy_settings_N_person_subtitle",r-1);return(0,o.langReplace)(n,{name:i})}return e.map((({name:e})=>e)).concat(t.map((e=>(0,s.getOwnerName)(e)))).join(", ")},l=`, ${o.getLang("global_privacy_settings_besides_subtitle")}`,d=(e,t,r,i)=>{const o=e?.filter((({id:e})=>r?.owners?.allowed?.includes(e)))||[],s=t?.filter((({id:e})=>r?.lists?.allowed?.includes(e)))||[],n=e?.filter((({id:e})=>i?.owners?.allowed?.includes(e)))||[],d=t?.filter((({id:e})=>i?.lists?.allowed?.includes(e)))||[],c=e?.filter((({id:e})=>r?.owners?.excluded?.includes(e)))||[],u=t?.filter((({id:e})=>r?.lists?.excluded?.includes(e)))||[],v=e?.filter((({id:e})=>i?.owners?.excluded?.includes(e)))||[],p=t?.filter((({id:e})=>i?.lists?.excluded?.includes(e)))||[],m=a(s,o),g=a(d,n),_=a(u,c),h=a(p,v);return{privacyViewSubtitle:`${m}${_?`${l} ${_}`:""}`,privacyCommentSubtitle:`${g}${h?`${l} ${h}`:""}`}},c=(e,t)=>[...e,...t].reduce(((e,t)=>(t.friend&&e.push(t.friend),e)),[]),u=({category:e,allowedValue:t,excludedValue:r})=>{const i=n.mapPrivacy[e],o=t.filter((({friend:e})=>e)).map((({value:e})=>e)),s=t.filter((({friendList:e})=>e)).map((({value:e})=>e));return{category:i,owners:{allowed:o,excluded:r.filter((({friend:e})=>e)).map((({value:e})=>e))},lists:{allowed:s,excluded:r.filter((({friendList:e})=>e)).map((({value:e})=>e))}}},v=e=>e?.map((e=>({value:e.id,label:(0,s.getOwnerName)(e),friend:e})))||[],p=(e,t)=>e?.map((e=>{const r=e.friends?.map((e=>(0,s.getOwnerName)(e))).join(", "),i=r&&e.count>t?(0,o.langReplace)(o.getLang("global_privacy_settings_friends_list_others"),{users:r}):r;return{value:e.id,label:e.name,friendList:e,subTitle:i}}))||[],m=e=>{if(!e)return i.SETTINGS_PRIVACY_ALL;const t=(0,n.mapPrivacyCategory)(e);if(!t)return i.SETTINGS_PRIVACY_ALL;switch(t.option){case i.SETTINGS_PRIVACY_SOME_LISTS:return i.SETTINGS_PRIVACY_SOME_FRIENDS;case i.SETTINGS_PRIVACY_ONLY_ME:return i.SETTINGS_PRIVACY_FRIENDS;case i.SETTINGS_PRIVACY_EVERYONE_EXCEPT:return i.SETTINGS_PRIVACY_ALL}return t.option};function g(e){switch(e){case i.SETTINGS_PRIVACY_ALL:return o.getLang("global_privacy_settings_all_dative");case i.SETTINGS_PRIVACY_FRIENDS:return o.getLang("global_privacy_settings_friends_dative");case i.SETTINGS_PRIVACY_FRIENDS_OF_FRIENDS:return o.getLang("global_privacy_settings_friends_of_friends_dative");case i.SETTINGS_PRIVACY_SOME_FRIENDS:return o.getLang("global_privacy_settings_some_friends_dative");default:return""}}},185198:(e,t,r)=>{r.d(t,{hydrateComponent:()=>n});var i=r(474848),o=r(440961),s=r(293819);function n({component:e,descriptor:t}){const{data:r,target:n}=t.payload,{selector:a}=t;n&&n instanceof HTMLElement&&((0,s.registerReactApplication)(a,(t=>{o.render((0,i.jsx)(e,{...t}),n)})),window.initReactApplication(a,r))}},467225:(e,t,r)=>{r.d(t,{ALBUM_ID_DEFAULT_PHOTO:()=>o,ALBUM_ID_PROFILE_PHOTO:()=>i,ALBUM_ID_SAVED_PHOTO:()=>n,PHOTOS_ARCHIVE_ALBUM_ID:()=>l,PHOTOS_MAX_COUNT_SEND_IN_ONE_REQUEST:()=>c,PHOTOS_WITH_ME_ALBUM_ID:()=>d,PHOTO_STREAM_ALBUM_ID:()=>a,WALL_TEMP_ALBUM_ID:()=>s});const i=-6,o=-7,s=-14,n=-15,a=-183,l=-185,d=-9e3,c=100},969798:(e,t,r)=>{r.d(t,{OwnerServiceAdapter:()=>n});var i=r(331635),o=r(614502),s=r(605967);class n{constructor(e){this.owner=(0,o.store)(e.$ownerData),this.error=(0,o.store)(e.$ownerError),this.isLoading=(0,o.store)(e.$ownerLoading),this.fetch=(0,o.event)(e.getOwnerEvent),this.dispose=(0,o.event)(e.resetOwnerEvent)}}n=(0,i.__decorate)([(0,s.adapter)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["undefined"==typeof InstanceOwnerService?Object:InstanceOwnerService])],n)},23466:(e,t,r)=>{r.d(t,{VideoDeletingServiceAdapter:()=>n});var i=r(331635),o=r(614502),s=r(605967);class n{constructor(e){this.removedVideosIds=(0,o.store)(e.$removedVideosIds),this.toggleDeleted=(0,o.event)(e.toggleDeleteVideoEvent)}}n=(0,i.__decorate)([(0,s.adapter)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["undefined"==typeof InstanceVideoDeletingService?Object:InstanceVideoDeletingService])],n)},552773:(e,t,r)=>{r.d(t,{createAbortControllersService:()=>s});var i=r(32489);const o=e=>Array.isArray(e)?e:[e],s=e=>{const t=e.createStore({}),r=e.createEvent(),s=e.createEvent(),n=e.createEvent();return(0,i.sample)({clock:s,source:t,fn:(e,t)=>o(t).reduce(((e,t)=>(e[t]=null,e)),{...e}),target:t}),(0,i.sample)({clock:r,source:t,fn:(e,t)=>(o(t).forEach((t=>e[t]?.abort())),t),target:s}),(0,i.sample)({clock:n,fn:e=>Object.keys(e),target:r}),(0,i.sample)({clock:n,source:t,fn:(e,t)=>({...e,...t}),target:t}),{$controllers:t,abortRequestEvent:r,clearControllerEvent:s,setControllerEvent:n}}},829952:(e,t,r)=>{r.d(t,{createAuthorUserService:()=>n});var i=r(32489),o=r(728926),s=r(72465);const n=({domain:e,entitiesUsersService:t})=>{const[r,n]=(0,o.createAbortControllerField)(e),a=e.createEvent(),l=e.createStore(""),d=(0,s.combineEntitiesId)(t.$entitiesUsers,l),c=(0,s.combineEntitiesId)(t.$entitiesUsersErrors,l),u=(0,s.combineEntitiesId)(t.$entitiesUsersLoading,l);return(0,i.sample)({clock:a,fn:e=>String(e),target:l}),(0,i.sample)({clock:a,source:r,fn:e=>(e?.abort(),new AbortController),target:r}),(0,i.sample)({clock:a,source:r,fn:(e,t)=>({controller:e,query:{fields:"screen_name,photo_50,photo_100,photo_200",user_ids:String(t)}}),target:t.getUsersFx}),{$userData:d,$userError:c,$userLoading:u,getUserEvent:a,abortUserRequestEvent:n}}},822017:(e,t,r)=>{r.d(t,{createCatalogService:()=>d});var i=r(32489),o=r(348388),s=r(728926),n=r(501204),a=r(225324),l=r(72465);const d=({domain:e,entitiesCatalogSectionsService:t,entitiesGroupsService:r,entitiesUsersService:d,entitiesVideoAlbumsService:c,entitiesVideoService:u,entitiesPlaceholdersService:v})=>{const{$entitiesCatalogVideo:p,$entitiesCatalogVideoErrors:m,$entitiesCatalogVideoLoading:g,catalogGetVideoFx:_,updateSectionEvent:h}=(0,o.createEntitiesCatalogVideoService)({domain:e,entitiesCatalogSectionsService:t,entitiesGroupsService:r,entitiesUsersService:d,entitiesVideoAlbumsService:c,entitiesVideoService:u,entitiesPlaceholdersService:v}),y=(0,n.createCurrentSectionService)({domain:e,entitiesCatalogSectionsService:t}),{$replaceBlocksError:f,$loadingBlockId:S,abortReplacementRequestEvent:b,replaceBlocksEvent:E}=(0,a.createBlocksReplacementService)({domain:e,currentSectionService:y,entitiesCatalogSectionsService:t,updateSectionEvent:h}),{$currentSection:I,$currentSectionId:w,$currentSectionError:A,$currentSectionPending:P,abortSectionRequestEvent:V,changeCurrentSectionIdEvent:F,refetchCurrentSectionEvent:k,setCurrentSectionIdEvent:C}=y,x=e.createEvent(),T=e.createEvent(),L=e.createEvent(),R=(0,i.restore)(L,{url:""}),M=e.createEvent(),[O,B]=(0,s.createAbortControllerField)(e);(0,i.sample)({clock:M,target:[B,V,b]});const $=(0,i.sample)({clock:L,source:{loading:g,query:R},filter:({loading:e,query:t},{url:r,noRefetchOnSameLoading:i})=>t.url!==r||!i||!e[r],fn:(e,t)=>({controller:t.url?new AbortController:null,query:t})});(0,i.sample)({clock:$,fn:({query:e})=>e,target:R}),(0,i.sample)({clock:$,fn:({controller:e})=>e,target:B}),(0,i.sample)({clock:$,fn:()=>null,target:[V,b]}),(0,i.sample)({clock:$,filter:({controller:e,query:t})=>Boolean(t.url&&e),fn:({controller:e,query:{url:t,trackCode:r}})=>({controller:e,query:{need_blocks:1,owner_id:0,url:t,...r&&{from_trackcode:r}}}),target:_}),(0,i.sample)({clock:[_.done,_.fail],fn:()=>null,target:O}),(0,i.sample)({clock:_.done,fn:e=>e.result.catalog?.default_section||"",target:C});const G=(0,i.combine)({currentSectionId:w,entities:p,query:R},(({currentSectionId:e,entities:t,query:r})=>{const i=null!==r.url&&t[r.url];return i?{...i,default_section:e,sections:[]}:null})),D=(0,i.combine)({entities:p,query:R},(({entities:e,query:t})=>e[t.url]??null)),U=(0,i.combine)({catalogEntities:g,currentSectionPending:P,query:R},(({catalogEntities:e,currentSectionPending:t,query:r})=>t||e[r.url]||null)),N=(0,i.combine)({catalogEntities:g,query:R},(({catalogEntities:e,query:t})=>e[t.url]||!1)),j=(0,i.combine)({catalogEntities:m,currentSectionError:A,replaceBlocksError:f,query:R},(({catalogEntities:e,currentSectionError:t,replaceBlocksError:r,query:i})=>!(0,l.isAbortApiError)(r)&&r||!(0,l.isAbortApiError)(t)&&t||!(0,l.isAbortApiError)(e[i.url])&&e[i.url]||null)),q=(0,i.combine)({section:I,deletedAlbums:c.$entitiesVideoDeletedAlbums},(({section:e,deletedAlbums:t})=>{if(!e)return[];const r=e.blocks?.map((e=>({...e,albums_ids:e.albums_ids?.filter((e=>!t[e]))})));return[{...e,blocks:r}]})),Y=(0,i.combine)({catalog:G,sections:t.$entitiesCatalogSections},(({sections:e,catalog:t})=>{const r=t?.buttons?.[0];return r?.section_id&&e[r.section_id]||null})),K=(0,i.combine)(D,w,((e,t)=>e?.sections[0]?.id===t));return(0,i.sample)({clock:x,source:(0,i.combine)([D,R]),filter:([e])=>Boolean(e?.sections),fn:([e,t],r)=>({id:e?.sections?.find((e=>e.url===r))?.id??"",trackCode:t.trackCode??""}),target:F}),(0,i.sample)({clock:T,source:(0,i.combine)([Y,R]),filter:([e])=>Boolean(e?.subsections?.length),fn:([e,t],r)=>({id:e?.subsections?.find((e=>e.url===r))?.id??"",trackCode:t.trackCode??""}),target:F}),{$catalog:D,$catalogGetVideoPending:N,$currentSection:I,$currentSectionId:w,$currentSectionError:A,$currentSectionPending:P,$isFirstSection:K,$pageStructureSection:Y,$data:G,$error:j,$loadingBlockId:S,$pending:U,$sections:q,abortRequestEvent:M,changeCurrentSectionIdEvent:F,changeCurrentSectionUrlEvent:x,changeCurrentSubsectionUrlEvent:T,changeUrlEvent:L,refetchCurrentSectionEvent:k,replaceBlocksEvent:E,updateSectionEvent:h}}},501204:(e,t,r)=>{r.d(t,{createCurrentSectionService:()=>n});var i=r(32489),o=r(728926),s=r(72465);const n=({domain:e,entitiesCatalogSectionsService:t})=>{const r=e.createEvent(),n=e.createEvent(),a=e.createEvent(),l=e.createEvent(),d=e.createStore(""),c=e.createStore(!1),[u,v]=(0,o.createAbortControllerField)(e),{$entitiesCatalogSections:p,$entitiesSectionsErrors:m,$entitiesSectionsLoading:g,catalogGetSectionFx:_,setCatalogGetSectionsEvent:h}=t,y=(0,i.attach)({effect:_,mapParams:({silent:e,...t})=>t}),f=(0,i.combine)({entities:p,currentSectionId:d},(({entities:e,currentSectionId:t})=>e[t]??null)),S=(0,i.combine)({entities:g,currentSectionId:d,silentPending:c},(({entities:e,currentSectionId:t,silentPending:r})=>Boolean(!r&&e[t]))),b=(0,i.combine)({entities:m,currentSectionId:d},(({entities:e,currentSectionId:t})=>e[t]??null));return(0,i.sample)({clock:n,source:d,filter:(e,{id:t})=>e!==t,fn:(e,{id:t,trackCode:r})=>({controller:t?new AbortController:null,id:t,trackCode:r}),target:l}),(0,i.sample)({clock:a,target:d}),(0,i.sample)({clock:r,source:{currentSectionId:d,currentSection:f},filter:({currentSectionId:e,currentSection:t},{filter:r}={})=>!!e&&(!t||!r||r(t)),fn:({currentSectionId:e},{silent:t}={})=>({controller:new AbortController,id:e,silent:t}),target:l}),(0,i.sample)({clock:l,fn:({id:e})=>e,target:a}),(0,i.sample)({clock:l,fn:({controller:e})=>e,target:v}),(0,i.sample)({clock:l,source:p,filter:(e,{id:t,silent:r})=>Boolean(!r&&e[t]?.blocks),fn:(e,{id:t})=>{const{id:r,title:i,url:o}=e[t];return[{id:r,title:i,url:o}]},target:h}),(0,i.sample)({clock:l,source:p,filter:(e,{controller:t,id:r,silent:i})=>Boolean((i||!e[r]?.blocks)&&t),fn:(e,{controller:t,id:r,silent:i,trackCode:o})=>({controller:t,query:o?{section_id:r,from_track_code:o}:{section_id:r},silent:i}),target:y}),(0,i.sample)({clock:y.done.filterMap((({params:e,result:t})=>e.silent&&t.section?[t.section]:void 0)),target:h}),(0,i.sample)({clock:y,filter:({silent:e})=>Boolean(e),fn:()=>!0,target:c}),(0,i.sample)({clock:y.finally,filter:({params:e})=>Boolean(e.silent),fn:()=>!1,target:c}),(0,i.sample)({clock:[y.done,y.fail],filter:e=>!(0,s.isAbortError)(e),fn:()=>null,target:u}),{$currentSection:f,$currentSectionId:d,$currentSectionError:b,$currentSectionPending:S,abortSectionRequestEvent:v,changeCurrentSectionIdEvent:n,refetchCurrentSectionEvent:r,setCurrentSectionIdEvent:a}}},424147:(e,t,r)=>{r.d(t,{createEntitiesVideoSyncService:()=>o});var i=r(32489);const o=e=>{const t=new Map;return(0,i.sample)({clock:e.setVideosEvent,fn:e=>{t.forEach((t=>{t(e)}))}}),{subscribe:e=>{t.set(e,e)},unsubscribe:e=>{t.delete(e)}}}},333659:(e,t,r)=>{r.d(t,{createExtendedService:()=>s});var i=r(32489);const o=e=>Object.values(e).filter((e=>Boolean(e))),s=({entitiesGroupsService:e,entitiesUsersService:t,entitiesVideoAlbumsService:r,entitiesVideoService:s,entitiesPlaceholdersService:n})=>{const{$entitiesGroups:a}=e,{$entitiesUsers:l}=t,{$entitiesVideo:d}=s,{$entitiesVideoAlbums:c}=r,{$entitiesPlaceholders:u}=n;return{$data:(0,i.combine)({albums:c,groups:a,placeholders:u,profiles:l,videos:d},(({albums:e,groups:t,placeholders:r,profiles:i,videos:s})=>({albums:o(e),groups:o(t),placeholders:o(r),profiles:o(i),videos:o(s)})))}}},794432:(e,t,r)=>{r.d(t,{createFaveService:()=>n});var i=r(32489),o=r(927588),s=r(112268);const n=({domain:e,entitiesVideoService:t,onAddFave:r,onRemoveFave:n})=>{const{$entitiesVideo:a,patchVideosEvent:l}=t,{faveAddVideoFx:d,faveRemoveVideoFx:c}=(0,o.createEntitiesFaveVideoService)({domain:e}),u=e.createStore({}),v=e.createEvent(),p=e.createEffect((({controller:e,currentFav:t,query:r})=>{const i={controller:e,query:r};return t?c(i):d(i)}));return(0,i.sample)({clock:v,source:a,fn:(e,{id:t,ownerId:r,ref:i,source:o})=>{const n=(0,s.joinRawId)({ownerId:r,itemId:t}),a=Boolean(e[n]?.is_favorite);return{controller:new AbortController,currentFav:a,fullId:n,query:{id:t,owner_id:r,ref:i,source:o}}},target:p}),(0,i.sample)({clock:p,source:u,fn:(e,{controller:t,fullId:r})=>(e[r]?.abort(),{...e,[r]:t}),target:u}),(0,i.sample)({clock:p,fn:({currentFav:e,query:t})=>[{id:t.id,owner_id:t.owner_id,is_favorite:!e}],target:l}),(0,i.sample)({clock:[p.done,p.fail],filter:e=>"error"in e||!e.result,fn:({params:e})=>[{id:e.query.id,owner_id:e.query.owner_id,is_favorite:e.currentFav}],target:l}),(0,i.sample)({clock:[p.done,p.fail],source:u,fn:(e,{params:t})=>{const r={...e};return delete r[t.fullId],r},target:u}),(0,i.sample)({clock:d.done,target:r}),(0,i.sample)({clock:c.done,fn:e=>({rollbackCallback:t=>{const{query:r}=e.params;v({id:r.id,ownerId:r.owner_id,ref:r.ref,source:t??r.source})}}),target:n}),{toggleFaveVideoEvent:v}}},695726:(e,t,r)=>{r.d(t,{createGroupOwnerService:()=>n});var i=r(32489),o=r(304525),s=r(8520);const n=({domain:e})=>{const t=(0,o.createUtilsResolveScreenNameFx)({domain:e}),r=e.createStore(null),n=e.createStore(null),a=e.createEvent(),l=e.createEvent();return(0,i.sample)({clock:a,source:n,fn:(e,t)=>{e?.abort();return{controller:new AbortController,query:{screen_name:t}}},target:t}),(0,i.sample)({clock:t,fn:({controller:e})=>e||null,target:n}),(0,i.sample)({clock:l,source:n,fn:e=>(e?.abort(),null),target:r}),(0,i.sample)({clock:[t.doneData],filter:e=>(0,s.isNumber)(e?.object_id),fn:({object_id:e})=>e,target:r}),(0,i.sample)({clock:[t.done,t.fail],fn:()=>null,target:n}),{resolveGroupOwnerByScreenNameEvent:a,resetGroupOwnerStore:l,$groupOwnerId:r}}},992013:(e,t,r)=>{r.d(t,{createOwnerService:()=>n});var i=r(32489),o=r(847891),s=r(72465);const n=({domain:e,entitiesGroupsService:t,entitiesUsersService:r})=>{const n=e.createEvent(),a=e.createEvent(),l=e.createStore(null).reset(n);return(0,i.sample)({clock:a,fn:({ownerId:e})=>e,target:l}),(0,i.sample)({clock:a,filter:({ownerId:e})=>o.Ranges.isGroupId(e),fn:({controller:e,ownerId:t})=>({controller:e,query:{groupIds:[o.Ranges.convertOwnerIdToGroupId(t)]}}),target:t.groupsGetByIdFx}),(0,i.sample)({clock:a,filter:({ownerId:e})=>o.Ranges.isUserId(e),fn:({controller:e,ownerId:t})=>({controller:e,query:{fields:"screen_name,photo_50",user_ids:String(t)}}),target:r.getUsersFx}),{$ownerData:(0,s.$selectUserOrGroupStoreById)(r.$entitiesUsers,t.$entitiesGroups,l),$ownerError:(0,s.$selectUserOrGroupStoreById)(r.$entitiesUsersErrors,t.$entitiesGroupsErrors,l),$ownerLoading:(0,s.$selectUserOrGroupStoreById)(r.$entitiesUsersLoading,t.$entitiesGroupsLoading,l),getOwnerEvent:a,resetOwnerEvent:n}}},21881:(e,t,r)=>{r.d(t,{createPinService:()=>l});var i=r(32489),o=r(264874),s=r(887815),n=r(757459),a=r(291903);const l=({domain:e,catalogService:t,entitiesVideoService:r,groupOwnerService:l,onPin:d,onUnpin:c})=>{const{$entitiesVideo:u,patchVideosEvent:v}=r,p=(0,s.createVideoPinVideoFx)({domain:e}),m=(0,s.createVideoUnpinVideoFx)({domain:e}),g=e.createStore({}),_=e.createStore(null),{$catalog:h,$currentSection:y,refetchCurrentSectionEvent:f}=t,S=e.createEvent(),b=e.createEffect((({controller:e,isPinned:t,query:r})=>{const i={controller:e,query:r};return t?m(i):p(i)}));(0,i.sample)({clock:(0,o.once)(S),source:u,fn:e=>{const t=Object.values(e).findIndex((e=>e?.is_pinned)),r=Object.values(e)[t];if(!r)return null;const{id:i,owner_id:o}=r;return i&&o?(0,a.getVideoCardKey)(o,i):null},target:_}),(0,i.sample)({clock:S,source:{videos:u,groupOwnerId:l.$groupOwnerId},fn:({videos:e,groupOwnerId:t},{videoId:r,ownerId:i})=>{const o=(0,a.getVideoCardKey)(i,r),s=Boolean(e[o]?.is_pinned);return{controller:new AbortController,isPinned:s,fullId:o,query:{video_id:r,owner_id:i,group_id:t}}},target:b}),(0,i.sample)({clock:b,source:g,fn:(e,{controller:t,fullId:r})=>(e[r]?.abort(),{...e,[r]:t}),target:g}),(0,i.sample)({clock:b,fn:({isPinned:e,query:{video_id:t,owner_id:r}})=>[{owner_id:r,id:t,is_pinned:!e}],target:v}),(0,i.sample)({clock:b.done,filter:e=>!("error"in e),fn:({params:{isPinned:e,query:{video_id:t,owner_id:r}}})=>e?null:(0,a.getVideoCardKey)(r,t),target:_}),(0,i.sample)({clock:b,source:_,filter:(e,{isPinned:t,query:{video_id:r,owner_id:i}})=>Boolean(e)&&!t&&(0,a.getVideoCardKey)(i,r)!==e,fn:e=>{const{ownerId:t,itemId:r}=(0,n.splitRawId)(e);return[{owner_id:t,id:r,is_pinned:!1}]},target:v}),(0,i.sample)({clock:p.done,fn:d}),(0,i.sample)({clock:m.done,fn:c}),(0,i.sample)({clock:[p.done,m.done],source:{$catalog:h,$currentSection:y},filter:({$catalog:e,$currentSection:t})=>e?.sections[0]?.id===t?.id,fn:()=>({silent:!0}),target:f});return{togglePin:(e,{id:t,owner_id:r})=>{S({videoId:t,ownerId:r})},toggleVideoPinEvent:S}}},225324:(e,t,r)=>{r.d(t,{createBlocksReplacementService:()=>l});var i=r(32489),o=r(373627),s=r(728926),n=r(614117),a=r(72465);const l=({domain:e,entitiesCatalogSectionsService:t,currentSectionService:r,updateSectionEvent:l})=>{const d=e.createStore(null).reset(t.initCatalog),c=e.createStore(!1),u=e.createStore(null),v=e.createStore(null),p=e.createEvent(),m=(0,o.createCatalogReplaceBlocksFx)({domain:e}),[g,_]=(0,s.createAbortControllerField)(e),{$currentSection:h,changeCurrentSectionIdEvent:y}=r;(0,i.sample)({clock:y,fn:()=>null,target:_});const f=(0,i.sample)({clock:p,fn:e=>({controller:e?new AbortController:null,id:e})});(0,i.sample)({clock:f,fn:({controller:e})=>e,target:_}),(0,i.sample)({clock:f,fn:()=>null,target:v}),(0,i.sample)({clock:f,source:u,filter:(e,{id:t})=>e!==t,fn:(e,{controller:t,id:r})=>({controller:t,query:{replacement_ids:r}}),target:m}),(0,i.sample)({clock:f,fn:({id:e})=>e,target:u}),(0,i.sample)({clock:m,fn:()=>!0,target:c}),(0,i.sample)({clock:[m,y],fn:()=>null,target:d}),(0,i.sample)({clock:m.fail,filter:({error:e})=>!(0,n.isNetworkError)(e)||"AbortError"!==e.error.name,fn:({error:e})=>e,target:d});const S=(0,i.sample)({clock:m.doneData,source:h,filter:(e,{replacements:t})=>Boolean(e&&t),fn:(e,{replacements:t,...r})=>{const i={...e,next_from:t.new_next_from},o={...r,section:i};return i.blocks?.length?(i.blocks=t.replacements.reduce(((e,{from_block_ids:t,to_blocks:r})=>(t?.forEach(((t,o)=>{const s=r?.[o];if(!s)return;const n=i.blocks?.findIndex((({id:e})=>e===t));void 0!==n&&(e[n]=s)})),e)),[...i.blocks]),o):o}});return(0,i.sample)({clock:S,fn:({section:e})=>{const{id:t,title:r,url:i}=e;return[{id:t,title:r,url:i}]},target:t.setCatalogGetSectionsEvent}),(0,i.sample)({clock:S,target:l}),(0,i.sample)({clock:[m.fail,S],fn:()=>!1,target:c}),(0,i.sample)({clock:[m.fail,m.done],filter:e=>!(0,a.isAbortError)(e),fn:()=>null,target:g}),(0,i.sample)({clock:m,fn:({query:e})=>e?.replacement_ids?.split("/")[0]||null,target:v}),(0,i.sample)({clock:[m.fail,m.done],filter:e=>!(0,a.isAbortError)(e),fn:()=>null,target:v}),{$currentReplacementId:u,$replaceBlocksError:d,$replaceBlocksPending:c,$loadingBlockId:v,abortReplacementRequestEvent:_,replaceBlocksEvent:p}}},264377:(e,t,r)=>{r.d(t,{createVideoDeletingService:()=>a});var i=r(32489),o=r(112268),s=r(757459),n=r(72465);const a=({domain:e,entitiesVideoService:t})=>{const{$entitiesVideo:r,patchVideosEvent:a,videoAddFx:l,videoDeleteFx:d,videoRestoreFx:c}=t,u=e.createStore({}),v=e.createEvent(),p=e.createEvent(),m=(0,i.restore)(p,{}),g=(e,t)=>({...e,[t]:!e[t]}),_=e.createEffect((({controller:e,deleted:t,query:r})=>{const i={controller:e,query:{video_id:r.id,owner_id:r.owner_id,target_id:r.target_id}};return t?r.target_id&&r.owner_id!==r.target_id?l(i):c(i):d(i)}));(0,i.sample)({clock:v,source:r,fn:(e,{id:t,ownerId:r,targetId:i})=>{const s=(0,o.joinRawId)({ownerId:r,itemId:t}),n=Boolean(e[s]?.localDeleted);return{controller:new AbortController,deleted:n,fullId:s,query:{id:t,owner_id:r,target_id:i}}},target:_}),(0,i.sample)({clock:_,source:u,fn:(e,{controller:t,fullId:r})=>(e[r]?.abort(),{...e,[r]:t}),target:u}),(0,i.sample)({clock:_,fn:({deleted:e,query:{target_id:t,...r}})=>[{...r,localDeleted:!e}],target:a}),(0,i.sample)({clock:_,source:m,fn:(e,{fullId:t})=>g(e,t),target:p}),(0,i.sample)({clock:[_.done,_.fail],filter:e=>"error"in e||!e.result,fn:({params:{deleted:e,query:{target_id:t,...r}}})=>[{...r,localDeleted:e}],target:a}),(0,i.sample)({clock:[_.done,_.fail],source:m,filter:(e,t)=>"error"in t||!t.result,fn:(e,{params:{fullId:t}})=>g(e,t),target:p}),(0,i.sample)({clock:[_.done,_.fail],source:u,fn:(e,{params:t})=>{const r={...e};return delete r[t.fullId],r},target:u}),(0,i.sample)({clock:_.done,filter:({params:e,result:t})=>Boolean(!e.deleted&&t),fn:({params:e})=>(0,n.showVideoDeletedSnackbar)((()=>{const{ownerId:t,itemId:r}=(0,s.splitRawId)(e.fullId),{target_id:i}=e.query;v({ownerId:t,id:r,targetId:i})}))});return{$removedVideosIds:m,$removedVideosCount:(0,i.sample)({clock:m,fn:e=>Object.values(e).filter(Boolean).length}),toggleDeleteVideoEvent:v}}},665039:(e,t,r)=>{r.d(t,{createVideoPlaylistsModalService:()=>p});var i=r(474848),o=r(143735),s=r(637774),n=r(887815),a=r(847891),l=r(610989),d=r(32489),c=r(659179),u=r(818515),v=r(422495);const p=e=>{const t=e.createEvent(),r=(0,d.restore)(t,null),p=e.createEvent(),m=(0,d.restore)(p,null),g=e.createEvent(),_=(0,d.restore)(g,null),h=e.createEvent(),y=(0,d.restore)(h,null),f=e.createStore(!1),S=e.createEvent(),b=(0,o.createEntitiesVideoAlbumService)({domain:e}),E=(0,s.createListsVideosAlbumsService)({domain:e,entitiesVideoAlbumService:b}),{$listIds:I,$loading:w,$fullyLoaded:A}=E.selectStores(r.map((e=>e||""))),P=(0,n.createVideoGetAlbumsByVideoFx)({domain:e}),V=(0,n.createVideoAddToAlbumFx)({domain:e}),F=(0,n.createVideoRemoveFromAlbumFx)({domain:e}),k=e.createEvent(),C=e.createEvent(),x=e.createEvent(),T=e.createEvent(),{$entitiesVideoBinding:L,addBindingsEvent:R,toggleBindingEvent:M,resetBindingsEvent:O}=(0,v.createVideoBindingsService)(e);return(0,d.sample)({clock:S,fn:({videoId:e})=>e,target:g}),(0,d.sample)({clock:S,fn:({ownerId:e})=>e,target:t}),(0,d.sample)({clock:S,fn:({isGroupOwner:e})=>e,target:p}),(0,d.sample)({clock:S,fn:({videoOwnerId:e})=>e,target:h}),(0,d.sample)({clock:S,fn:()=>!1,target:f}),(0,d.sample)({clock:M,fn:()=>!0,target:f}),(0,d.sample)({clock:S,fn:({ownerId:e,isGroupOwner:t})=>{const r={query:{count:50,extended:1},controller:new AbortController,entityKey:e};return t?r.query.group_id=e:r.query.owner_id=e,r},target:E.fetchVideosAlbumsFx}),(0,d.sample)({clock:S,fn:({ownerId:e,videoId:t,videoOwnerId:r,isGroupOwner:i})=>({query:{video_id:t,owner_id:r,target_id:i&&e?a.Ranges.convertGroupIdToOwnerId(e):e},controller:new AbortController}),target:P}),(0,d.sample)({clock:P.done,fn:({params:e,result:t})=>({video_id:e.query.video_id,album_ids:t}),target:R}),(0,d.sample)({clock:k,source:{bindings:L,videoId:_},filter:({videoId:e})=>Boolean(e),fn:({bindings:e,videoId:t})=>{const r=[],i=[],o=t??0;return Object.keys(e[o]).forEach((t=>{const s=Number(t);if(isNaN(s)||!(s in e[o]))return;e[o][s]?r.push(s):i.push(s)})),{toAdd:r.join(","),toRemove:i.join(",")}},target:C}),(0,d.sample)({clock:[k,T],fn:()=>{(0,c.showSnackbar)({text:l.getLang("video_changes_saved"),before:{content:(0,i.jsx)(u.Icon28ListCheckOutline,{})},timeout:v.SNACKBAR_TIMEOUT}).catch()}}),(0,d.sample)({clock:C,source:{videoId:_,videoOwnerId:y,targetId:r,isGroupOwner:m},filter:(e,{toAdd:t})=>Boolean(t),fn:({videoId:e,videoOwnerId:t,targetId:r,isGroupOwner:i},{toAdd:o})=>({query:{target_id:(r=i&&r?a.Ranges.convertGroupIdToOwnerId(r):r)??0,owner_id:t??0,video_id:e??0,album_ids:o},controller:new AbortController}),target:V}),(0,d.sample)({clock:T,source:{videoId:_,videoOwnerId:y,targetId:r,isGroupOwner:m},fn:({videoId:e,videoOwnerId:t,targetId:r,isGroupOwner:i},{id:o})=>({query:{target_id:(r=i&&r?a.Ranges.convertGroupIdToOwnerId(r):r)??0,owner_id:t??0,video_id:e??0,album_ids:o.toString()},controller:new AbortController}),target:V}),(0,d.sample)({clock:C,source:{videoId:_,videoOwnerId:y,targetId:r,isGroupOwner:m},filter:(e,{toRemove:t})=>Boolean(t),fn:({videoId:e,videoOwnerId:t,targetId:r,isGroupOwner:i},{toRemove:o})=>({query:{target_id:(r=i&&r?a.Ranges.convertGroupIdToOwnerId(r):r)??0,owner_id:t??0,video_id:e??0,album_ids:o},controller:new AbortController}),target:F}),(0,d.sample)({clock:x,source:r,filter:e=>Boolean(e),fn:e=>({entityKey:e??0,count:50}),target:E.fetchMoreVideosAlbumsEvent}),{$entitiesVideoBinding:L,$videosAlbumsIds:I,$entitiesPlaylists:b.$entitiesVideoAlbums,$videosAlbumsLoading:w,$videoAlbumsFullyLoaded:A,toggleBindingEvent:M,resetBindingsEvent:O,initModalEvent:S,saveChangesEvent:k,fetchMorePlaylists:x,removeFromAlbumDoneEvent:F.done,$wasToggled:f,createPlaylistEvent:T}}},510961:(e,t,r)=>{r.d(t,{registerPlaylistUpdateEventListener:()=>i.registerPlaylistUpdateEventListener});var i=r(477163)},477163:(e,t,r)=>{r.d(t,{registerPlaylistUpdateEventListener:()=>o});var i=r(400281);const o=e=>{const t=({detail:t})=>{e.patchVideoAlbumsEvent([{id:t.id,owner_id:t.ownerId,title:t.title}]),e.getVideoAlbumByIdFx({query:{owner_id:t.ownerId,album_id:t.id}})};return window.addEventListener(i.PlaylistFormEvents.UPDATE,t),()=>window.removeEventListener(i.PlaylistFormEvents.UPDATE,t)}},271139:(e,t,r)=>{r.d(t,{OwnerServiceAdapter:()=>P.OwnerServiceAdapter,PlaylistServiceAdapter:()=>I.PlaylistServiceAdapter,PlaylistVideoRemovingServiceAdapter:()=>I.PlaylistVideoRemovingServiceAdapter,PlaylistVideoThumbUploadService:()=>I.PlaylistVideoThumbUploadService,VideoDeletingServiceAdapter:()=>V.VideoDeletingServiceAdapter,authorUserService:()=>T,createPageCatalogService:()=>C,createPagePinService:()=>x,entitiesGroupsService:()=>L,entitiesUsersService:()=>M,entitiesVideoAlbumsService:()=>O,entitiesVideoService:()=>B,entitiesVideoSyncService:()=>$,extendedService:()=>G,faveService:()=>D,groupOwnerService:()=>U,ownerService:()=>j,playlistDeletingService:()=>q,playlistService:()=>Y,playlistSubscriptionService:()=>K,playlistVideoRemovingService:()=>H,playlistVideoReorderService:()=>z,videoDeletingService:()=>J,videoPlaylistsModalService:()=>W});var i=r(32489),o=r(872587),s=r(946927),n=r(143735),a=r(779215),l=r(169135),d=r(265498),c=r(396062),u=r(942451),v=r(665039),p=r(175241),m=r(829952),g=r(822017),_=r(424147),h=r(333659),y=r(794432),f=r(992013),S=r(264377),b=r(21881),E=r(695726),I=r(64490),w=r(510961),A=r(72465),P=r(969798),V=r(23466);const F=e=>{const t=(0,o.createEntitiesGroupsService)({domain:e}),r=(0,s.createEntitiesUsersService)({domain:e}),i=(0,n.createEntitiesVideoAlbumService)({domain:e}),c=(0,a.createEntitiesPlaceholdersService)({domain:e}),u=(0,l.createEntitiesVideoService)({domain:e,entitiesGroupsService:t,entitiesUsersService:r}),g=(0,h.createExtendedService)({entitiesGroupsService:t,entitiesUsersService:r,entitiesVideoAlbumsService:i,entitiesVideoService:u,entitiesPlaceholdersService:c}),b=(0,y.createFaveService)({domain:e,entitiesVideoService:u,onAddFave:A.showAddedFaveSnackbarFx,onRemoveFave:A.showRemovedFaveSnackbarFx}),P=(0,S.createVideoDeletingService)({domain:e,entitiesVideoService:u}),V=(0,d.createListsVideosService)({domain:e,entitiesVideoService:u}),F=(0,f.createOwnerService)({domain:e,entitiesGroupsService:t,entitiesUsersService:r}),k=(0,I.createPlaylistService)({domain:e,entitiesVideoAlbumsService:i,listsVideosService:V,ownerService:F}),C=(0,I.createPlaylistSubscriptionService)({domain:e,entitiesVideoAlbumsService:i,playlistService:k,onSubscribe:A.showPlaylistSubscribeSnackbar,onUnsubscribe:A.showPlaylistUnsubscribeSnackbar}),x=(0,I.createPlaylistDeletingService)({entitiesVideoAlbumsService:i,onDeleted:e=>{(0,A.sendPlaylistDeletedEvents)(),(0,A.showPlaylistDeletedSnackbar)(e)}}),T=(0,v.createVideoPlaylistsModalService)(e),L=(0,I.createPlaylistVideoRemovingService)({domain:e,entitiesVideoAlbumsService:i,entitiesVideoService:u,playlistService:k,videoPlaylistsModalService:T,onVideoRemove:A.showPlaylistVideoRemoveSnackbar}),R=(0,m.createAuthorUserService)({domain:e,entitiesUsersService:r}),M=(0,I.createPlaylistVideoReorderService)({domain:e,playlistService:k}),O=(0,E.createGroupOwnerService)({domain:e}),B=(0,_.createEntitiesVideoSyncService)(u);return(0,w.registerPlaylistUpdateEventListener)(i),(0,p.connectTrackTmrGroupsJoin)(t.groupsJoinFx),{entitiesGroupsService:t,entitiesUsersService:r,entitiesVideoAlbumsService:i,entitiesPlaceholdersService:c,entitiesVideoService:u,entitiesVideoSyncService:B,extendedService:g,faveService:b,listsVideosService:V,ownerService:F,playlistService:k,groupOwnerService:O,playlistSubscriptionService:C,playlistDeletingService:x,videoPlaylistsModalService:T,videoDeletingService:P,playlistVideoRemovingService:L,authorUserService:R,playlistVideoReorderService:M}},k=(0,u.makeSharedState)("static/js/modules/web/VideoShowcase/store/index.ts",(()=>{const e=(0,i.createDomain)("VideoShowcase/VideoCatalog");return{domain:e,...F(e)}}),{version:1}),C=e=>{const{entitiesGroupsService:t,entitiesUsersService:r,entitiesVideoAlbumsService:i,entitiesVideoService:o,entitiesPlaceholdersService:s}=k(),n=(0,c.createEntitiesCatalogSectionsService)({domain:e});return(0,g.createCatalogService)({domain:e,entitiesCatalogSectionsService:n,entitiesGroupsService:t,entitiesUsersService:r,entitiesVideoAlbumsService:i,entitiesVideoService:o,entitiesPlaceholdersService:s})},x=(e,t)=>{const{entitiesVideoService:r,groupOwnerService:i}=k();return(0,b.createPinService)({domain:e,catalogService:t,entitiesVideoService:r,groupOwnerService:i,onPin:A.showVideoPinnedSnackbar,onUnpin:A.showVideoUnpinnedSnackbar})},{authorUserService:T,entitiesGroupsService:L,entitiesPlaceholdersService:R,entitiesUsersService:M,entitiesVideoAlbumsService:O,entitiesVideoService:B,entitiesVideoSyncService:$,extendedService:G,faveService:D,groupOwnerService:U,listsVideosService:N,ownerService:j,playlistDeletingService:q,playlistService:Y,playlistSubscriptionService:K,playlistVideoRemovingService:H,playlistVideoReorderService:z,videoDeletingService:J,videoPlaylistsModalService:W}=k()},232284:(e,t,r)=>{r.d(t,{PlaylistServiceAdapter:()=>n});var i=r(331635),o=r(614502),s=r(605967);class n{constructor(e){this.playlistData=(0,o.store)(e.$playlistData),this.fetch=(0,o.event)(e.processPlaylistEvent)}}n=(0,i.__decorate)([(0,s.adapter)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["undefined"==typeof PlaylistServiceInstance?Object:PlaylistServiceInstance])],n)},952330:(e,t,r)=>{r.d(t,{PlaylistVideoRemovingServiceAdapter:()=>n});var i=r(331635),o=r(614502),s=r(605967);class n{constructor(e){this.removedVideosCount=(0,o.store)(e.$removedVideosCount),this.removedVideosIds=(0,o.store)(e.$removedVideosIds),this.removeVideoForUser=(0,o.event)(e.removeVideoForUserEvent),this.toggleVideoRemoved=(0,o.event)(e.toggleVideoRemovedEvent)}}n=(0,i.__decorate)([(0,s.adapter)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["undefined"==typeof PlaylistVideoRemovingServiceInstance?Object:PlaylistVideoRemovingServiceInstance])],n)},225359:(e,t,r)=>{r.d(t,{PlaylistVideoThumbUploadService:()=>s});var i=r(327813),o=r(968788);class s{get thumb(){return this._thumb}get isLoading(){return this._isLoading}get error(){return this._error}async getPlaylistThumbUploadUrl(e){const{upload_url:t}=await this.videoApi.getPlaylistThumbUploadUrl(e,{signal:this.controller?.signal});return t}async uploadFile(e,t){const r=new FormData;r.append("photo",e);return(await fetch(t,{method:"POST",body:r,signal:this.controller?.signal})).json()}async upload(e,t,r=new AbortController){const{ownerId:o}=t;this.controller=r,this._isLoading=!0,this._error=null;try{const t=await this.getPlaylistThumbUploadUrl({owner_id:o,type:1}),i=await this.uploadFile(e,t);this._thumb=await this.videoApi.savePlaylistThumb({owner_id:o,thumb_json:JSON.stringify(i),thumb_size:"l"},{signal:r.signal})}catch(e){(0,i.runInAction)((()=>{this._error=e}))}(0,i.runInAction)((()=>{this.controller=null,this._isLoading=!1}))}dispose(){this.controller?.abort(),this.controller=null}resetData(){this.dispose(),this._thumb=null,this._isLoading=!1,this._error=null}constructor(){this.videoApi=new o.VideoApi,this.controller=null,this._thumb=null,this._isLoading=!1,this._error=null,(0,i.makeAutoObservable)(this,{},{autoBind:!0})}}},100767:(e,t,r)=>{r.d(t,{createPlaylistDeletingService:()=>o});var i=r(32489);const o=({entitiesVideoAlbumsService:e,onDeleted:t})=>{const{$entitiesVideoDeletedAlbums:r,$entitiesVideoDeletedAlbumsErrors:o,$entitiesVideoDeletedAlbumsPending:s,deleteVideoAlbumByIdFx:n}=e;return(0,i.sample)({clock:n.done,source:e.$entitiesVideoAlbums,fn:(e,{params:r})=>{const i=e[r.id];i&&t(i)}}),{$entitiesVideoDeletedAlbums:r,$entitiesVideoDeletedAlbumsErrors:o,$entitiesVideoDeletedAlbumsPending:s,deleteVideoAlbumByIdFx:n}}},506119:(e,t,r)=>{r.d(t,{createPlaylistService:()=>l});var i=r(32489),o=r(728926),s=r(757459),n=r(112268),a=r(72465);const l=({domain:e,entitiesVideoAlbumsService:t,listsVideosService:r,ownerService:l})=>{const[d,c]=(0,o.createAbortControllerField)(e),u=e.createEvent(),v=e.createEvent(),p=e.createEvent(),m=e.createEvent(),g=e.createStore("").reset(u),_=e.createStore("").reset(u),h=(0,a.combineEntitiesId)(t.$entitiesVideoAlbums,_),y=(0,a.combineEntitiesId)(t.$entitiesVideoAlbumsErrors,_),f=(0,a.combineEntitiesId)(t.$entitiesVideoAlbumsLoading,_),{getOwnerEvent:S,...b}=l;(0,i.sample)({clock:v,source:{playlistId:_,playlistLoading:f},filter:({playlistId:e,playlistLoading:t})=>Boolean(e&&!t),fn:({playlistId:e})=>{const{itemId:t,ownerId:r}=(0,s.splitRawId)(e);return{ownerId:r,playlistId:t}},target:p}),(0,i.sample)({clock:p,source:d,fn:e=>(e?.abort(),new AbortController),target:d}),(0,i.sample)({clock:p,source:d,fn:(e,{ownerId:t})=>({controller:e,ownerId:t}),target:S}),(0,i.sample)({clock:p,fn:()=>{},target:r.resetVideosEvent}),(0,i.sample)({clock:p,fn:({ownerId:e,playlistId:t})=>(0,n.joinRawId)({itemId:t,ownerId:e}),target:_}),(0,i.sample)({clock:p,fn:({ownerId:e})=>String(e),target:g}),(0,i.sample)({clock:p,source:d,fn:(e,{ownerId:t,playlistId:r})=>({controller:e,query:{album_id:r,owner_id:t}}),target:t.getVideoAlbumByIdFx}),(0,i.sample)({clock:p,source:d,fn:(e,{ownerId:t,playlistId:r})=>({controller:e,entityKey:(0,n.joinRawId)({itemId:r,ownerId:t}),query:{album_id:r,count:25,extended:1,owner_id:t,fields:"verified,photo_50,is_esia_verified,is_sber_verified,is_tinkoff_verified"}}),target:r.fetchVideosFx}),(0,i.sample)({clock:m,source:_,fn:e=>({entityKey:e}),target:r.fetchMoreVideosEvent});const E=r.selectStores(_.map(String));return{...b,$playlistId:_,$playlistData:h,$playlistError:y,$playlistLoading:f,$videosCount:E.$count,$videosError:E.$error,$videosFullyLoaded:E.$fullyLoaded,$videosIds:E.$listIds,$videosLoading:E.$loading,abortRequestEvent:c,resetPlaylistEvent:u,processPlaylistEvent:p,fetchMoreVideosEvent:m,refetchPlaylistEvent:v}}},742124:(e,t,r)=>{r.d(t,{createPlaylistSubscriptionService:()=>n});var i=r(32489),o=r(552773),s=r(72465);const n=({domain:e,entitiesVideoAlbumsService:t,playlistService:r,onSubscribe:n,onUnsubscribe:a})=>{const{$playlistId:l}=r,d=(0,o.createAbortControllersService)(e),c=(0,s.createPlaylistSubscriptionEffect)({$playlistId:l,abortControllersService:d,targetFx:(0,s.createCorrectingPlaylistEffect)({correction:1,effectFx:t.subscribeToVideoAlbumFx,entitiesVideoAlbumsService:t}),onDone:n}),u=(0,s.createPlaylistSubscriptionEffect)({$playlistId:l,abortControllersService:d,targetFx:(0,s.createCorrectingPlaylistEffect)({correction:-1,effectFx:t.unsubscribeFromVideoAlbumFx,entitiesVideoAlbumsService:t}),onDone:a}),v=e.createEvent(),p=(0,i.sample)({source:{controllers:d.$controllers,playlistId:l},fn:({controllers:e,playlistId:t})=>e[t]??null});return(0,i.sample)({clock:v,source:l,fn:e=>e,target:d.abortRequestEvent}),{$abortController:p,abortRequestEvent:v,subscribeFx:c,unsubscribeFx:u}}},147250:(e,t,r)=>{r.d(t,{createPlaylistVideoRemovingService:()=>s});var i=r(32489),o=r(112268);const s=({domain:e,entitiesVideoAlbumsService:t,entitiesVideoService:r,playlistService:s,videoPlaylistsModalService:n,onVideoRemove:a})=>{const{$playlistData:l,$playlistId:d,processPlaylistEvent:c,refetchPlaylistEvent:u}=s,v=e.createEvent(),p=(0,i.restore)(v,{}),m=e.createStore({}),g=e.createEvent();(0,i.sample)({clock:g,source:{playlistData:l,removedVideosIds:p},filter:({playlistData:e},{vkId:t})=>void 0!==t&&t===e?.owner_id,fn:({removedVideosIds:e},{videoId:t})=>({...e,[t]:!0}),target:p}),(0,i.sample)({clock:g,source:l,filter:(e,{vkId:t})=>void 0!==t&&t!==e?.owner_id,fn:(e,{videoId:t})=>({id:t}),target:r.videoGetByIdFx});const _=e.createEvent(),h=t.addVideoToAlbumFx,y=t.removeVideoFromAlbumFx,f=e.createEffect((({controller:e,currentIsRemoved:t,query:r})=>{const i={controller:e,query:r.params};return t?y(i):h(i)})),S=(e,t)=>({...e,[t]:!e[t]});(0,i.sample)({clock:[c,u],fn:()=>({}),target:p}),(0,i.sample)({clock:_,source:p,fn:(e,{params:t})=>{const r=(0,o.joinRawId)({ownerId:t.owner_id,itemId:t.video_id});return S(e,r)},target:p}),(0,i.sample)({clock:_,source:p,fn:(e,t)=>{const r=(0,o.joinRawId)({ownerId:t.params.owner_id,itemId:t.params.video_id});return{controller:new AbortController,currentIsRemoved:!!e[r],query:t}},target:f}),(0,i.sample)({clock:f,source:m,fn:(e,{controller:t,query:r})=>{const i=r.params.video_id;return e[i]?.abort(),{...e,[i]:t}},target:m}),(0,i.sample)({clock:[f.done,f.fail],source:p,filter:(e,t)=>("error"in t||!t.result)&&!t.params?.controller?.signal?.aborted,fn:(e,{params:t})=>{const r=t.query.params,i=(0,o.joinRawId)({ownerId:r.owner_id,itemId:r.video_id});return S(e,i)},target:v}),(0,i.sample)({clock:[f.done,f.fail],source:m,fn:(e,{params:t})=>{if(t?.controller?.signal?.aborted)return e;const r=t.query.params.video_id,i={...e};return delete i[r],i},target:m}),(0,i.sample)({clock:y.done,source:l,fn:(e,{params:t})=>{e&&a(e,(()=>{_({params:t.query})}))}}),(0,i.sample)({clock:n.removeFromAlbumDoneEvent,source:{playlistId:d,removedVideosIds:p},filter:({playlistId:e,removedVideosIds:t},{params:r})=>{if(t[(0,o.joinRawId)({itemId:r.query.video_id,ownerId:r.query.owner_id})])return!1;const{album_id:i,album_ids:s="",target_id:n}=r.query;if(void 0===n)return!1;const a=s.split(",");return i&&a.push(i),a.some((t=>(0,o.joinRawId)({itemId:Number(t),ownerId:n})===e))},fn:({removedVideosIds:e},{params:t})=>({...e,[(0,o.joinRawId)({itemId:t.query.video_id,ownerId:t.query.owner_id})]:!0}),target:v});return{$removedVideosCount:(0,i.sample)({clock:p,fn:e=>Object.values(e).filter(Boolean).length}),$removedVideosIds:p,removeVideoForUserEvent:g,toggleVideoRemovedEvent:_}}},470989:(e,t,r)=>{r.d(t,{createPlaylistVideoReorderService:()=>n});var i=r(32489),o=r(887815),s=r(757459);const n=({domain:e,playlistService:t})=>{const r=(0,o.createVideoReorderVideosFx)({domain:e}),n=e.createEvent();return(0,i.sample)({clock:n,source:t.$playlistId,fn:(e,t)=>{const{ownerId:r,videoId:i,beforeVideoId:o,beforeOwnerId:n,afterVideoId:a,afterOwnerId:l}=t,{ownerId:d,itemId:c}=(0,s.splitRawId)(e),u={target_id:d,album_id:c,owner_id:r,video_id:i};return void 0!==o&&(u.before_video_id=o,u.before_owner_id=n),void 0!==a&&(u.after_video_id=a,u.after_owner_id=l),{query:u}},target:r}),{reorderVideosEvent:n}}},64490:(e,t,r)=>{r.d(t,{PlaylistServiceAdapter:()=>l.PlaylistServiceAdapter,PlaylistVideoRemovingServiceAdapter:()=>d.PlaylistVideoRemovingServiceAdapter,PlaylistVideoThumbUploadService:()=>c.PlaylistVideoThumbUploadService,createPlaylistDeletingService:()=>o.createPlaylistDeletingService,createPlaylistService:()=>i.createPlaylistService,createPlaylistSubscriptionService:()=>s.createPlaylistSubscriptionService,createPlaylistVideoRemovingService:()=>n.createPlaylistVideoRemovingService,createPlaylistVideoReorderService:()=>a.createPlaylistVideoReorderService});var i=r(506119),o=r(100767),s=r(742124),n=r(147250),a=r(470989),l=r(232284),d=r(952330),c=r(225359)},847390:(e,t,r)=>{r.d(t,{combineEntitiesId:()=>o});var i=r(32489);function o(e,t,r){return(0,i.combine)({entities:e,id:t},(({entities:e,id:t})=>t&&e[t]||r||null))}},437700:(e,t,r)=>{r.d(t,{createCorrectingPlaylistEffect:()=>s});var i=r(32489),o=r(112268);const s=({correction:e,effectFx:t,entitiesVideoAlbumsService:r})=>{const s=(0,i.attach)({effect:t});return(0,i.sample)({clock:s.done,source:r.$entitiesVideoAlbums,filter:(e,{params:t})=>"number"==typeof t.query.album_id,fn:(t,{params:r})=>{const i=(0,o.joinRawId)({itemId:r.query.album_id,ownerId:r.query.owner_id}),s=t[i]?.followers_count??0;return[{id:r.query.album_id,owner_id:r.query.owner_id,followers_count:Math.max(0,s+e)}]},target:r.patchVideoAlbumsEvent}),s}},602127:(e,t,r)=>{r.d(t,{createPlaylistSubscriptionEffect:()=>n});var i=r(32489),o=r(757459),s=r(641377);const n=({$playlistId:e,abortControllersService:t,targetFx:r,onDone:n,onEventFired:a})=>{const{clearControllerEvent:l,setControllerEvent:d}=t,c=(0,i.attach)({effect:r,source:e,mapParams:(e,t)=>{const{itemId:r,ownerId:i}=(0,o.splitRawId)(t);return{controller:e,query:{owner_id:i,album_id:r}}}});return(0,i.sample)({clock:c,source:e,fn:(e,t)=>(a?.(),{[e]:t}),target:d}),(0,i.sample)({clock:[c.done,c.fail],source:e,filter:(e,t)=>!(0,s.isAbortError)(t),fn:e=>e,target:l}),(0,i.sample)({clock:c.done,fn:()=>{n?.()}}),(0,i.attach)({effect:c,mapParams:()=>new AbortController})}},72465:(e,t,r)=>{r.d(t,{$selectUserOrGroupStoreById:()=>a.$selectUserOrGroupStoreById,combineEntitiesId:()=>i.combineEntitiesId,createCorrectingPlaylistEffect:()=>o.createCorrectingPlaylistEffect,createPlaylistSubscriptionEffect:()=>s.createPlaylistSubscriptionEffect,isAbortApiError:()=>n.isAbortApiError,isAbortError:()=>n.isAbortError,sendPlaylistDeletedEvents:()=>l.sendPlaylistDeletedEvents,showAddedFaveSnackbarFx:()=>d.showAddedFaveSnackbarFx,showPlaylistDeletedSnackbar:()=>c.showPlaylistDeletedSnackbar,showPlaylistSubscribeSnackbar:()=>u.showPlaylistSubscribeSnackbar,showPlaylistUnsubscribeSnackbar:()=>v.showPlaylistUnsubscribeSnackbar,showPlaylistVideoRemoveSnackbar:()=>p.showPlaylistVideoRemoveSnackbar,showRemovedFaveSnackbarFx:()=>d.showRemovedFaveSnackbarFx,showVideoDeletedSnackbar:()=>m.showVideoDeletedSnackbar,showVideoPinnedSnackbar:()=>g.showVideoPinnedSnackbar,showVideoUnpinnedSnackbar:()=>_.showVideoUnpinnedSnackbar});var i=r(847390),o=r(437700),s=r(602127),n=r(641377),a=r(127855),l=r(442033),d=r(207897),c=r(694942),u=r(801057),v=r(944554),p=r(500924),m=r(124975),g=r(604424),_=r(427797)},641377:(e,t,r)=>{r.d(t,{isAbortApiError:()=>s,isAbortError:()=>n});var i=r(987601),o=r(614117);const s=e=>e&&(0,o.isNetworkError)(e)&&(0,i.isRequestAbortError)(e.error),n=e=>"error"in e&&s(e.error)},845206:(e,t,r)=>{r.d(t,{selectEntityById:()=>o});var i=r(847891);const o=(e,t,r)=>{if(null===r)return null;const o=Number(r);return isNaN(o)?null:i.Ranges.isUserId(o)?e[r]??null:i.Ranges.isGroupId(o)?t[i.Ranges.convertOwnerIdToGroupId(o)]??null:null}},127855:(e,t,r)=>{r.d(t,{$selectUserOrGroupStoreById:()=>s});var i=r(32489),o=r(845206);const s=(e,t,r)=>(0,i.combine)(e,t,r,o.selectEntityById)},442033:(e,t,r)=>{r.d(t,{sendPlaylistDeletedEvents:()=>o});var i=r(400281);const o=()=>{window.dispatchEvent(new CustomEvent(i.PlaylistFormEvents.DELETE))}},207897:(e,t,r)=>{r.d(t,{showAddedFaveSnackbarFx:()=>m,showRemovedFaveSnackbarFx:()=>g});var i=r(474848),o=r(610989),s=r(659179),n=r(32489),a=r(476726),l=r(102846),d=r(13966),c=r(644746),u=r(85775),v=r(422495),p=r(189776);const m=(0,n.createEffect)((()=>{const e=(0,a.partConfigEnabled)("video_bookmarks_renaming_to_watch_later")?{text:o.getLang("video_added_to_watch_later"),before:{content:(0,i.jsx)(d.Icon24ClockOutline,{})},action:window.location.href.includes(v.BOOKMARKS_URL)?void 0:{label:o.getLang("global_open_section"),onClick:()=>window.location.href=v.BOOKMARKS_URL}}:{text:(0,i.jsx)(l.InnerHTML,{children:(0,o.langLink)(v.BOOKMARKS_URL,o.getLang("fave_video_added"))}),before:{content:(0,i.jsx)(c.Icon24FavoriteOutline,{})}};(0,s.showSnackbar)(e)})),g=(0,n.createEffect)((e=>{const t=(0,a.partConfigEnabled)("video_bookmarks_renaming_to_watch_later")?{text:o.getLang("video_deleted_from_my_watch_later"),before:{content:(0,i.jsx)(d.Icon24ClockOutline,{})},action:e.rollbackCallback?{label:o.getLang("global_cancel"),onClick:(t,r)=>{e.rollbackCallback?.(p.FAVORITE_SOURCES.SNACKBAR),(0,s.hideSnackbar)(r)}}:void 0}:{text:o.getLang("video_deleted_from_my_bookmarks"),before:{content:(0,i.jsx)(u.Icon24UnfavoriteOutline,{})}};(0,s.showSnackbar)(t)}))},694942:(e,t,r)=>{r.d(t,{showPlaylistDeletedSnackbar:()=>s});var i=r(610989),o=r(659179);const s=e=>{const t=e?`«${e.title}»`:"",r=(0,i.langReplace)(i.getLang("video_playlist_name_deleted"),{name:t});(0,o.showSnackbar)({text:r})}},801057:(e,t,r)=>{r.d(t,{showPlaylistSubscribeSnackbar:()=>a});var i=r(474848),o=r(659179),s=r(610989),n=r(629775);const a=()=>(0,o.showSnackbar)({text:s.getLang("video_you_subscribed_to_playlist"),before:{content:(0,i.jsx)(n.Icon20CheckAlt,{})}})},944554:(e,t,r)=>{r.d(t,{showPlaylistUnsubscribeSnackbar:()=>a});var i=r(474848),o=r(659179),s=r(610989),n=r(629775);const a=()=>(0,o.showSnackbar)({text:s.getLang("video_you_unsubscribed_from_playlist"),before:{content:(0,i.jsx)(n.Icon20CheckAlt,{})}})},500924:(e,t,r)=>{r.d(t,{showPlaylistVideoRemoveSnackbar:()=>a});var i=r(474848),o=r(610989),s=r(659179),n=r(818515);const a=(e,t)=>{const r=e?.title?` «${e.title}»`:"",a=`${o.getLang("video_deleted_from_playlist")}${r}`,l=(0,s.showSnackbar)({text:a,before:{content:(0,i.jsx)(n.Icon28ListCheckOutline,{})},action:{label:o.getLang("global_cancel"),onClick:async()=>{t(),(0,s.hideSnackbar)(await l)}}})}},124975:(e,t,r)=>{r.d(t,{showVideoDeletedSnackbar:()=>s});var i=r(610989),o=r(659179);const s=e=>{(0,o.showSnackbar)({text:i.getLang("video_video_deleted_snackbar_text"),action:{label:i.getLang("global_cancel"),onClick:async(t,r)=>{e(),(0,o.hideSnackbar)(r)}}})}},604424:(e,t,r)=>{r.d(t,{showVideoPinnedSnackbar:()=>s});var i=r(659179),o=r(610989);const s=()=>(0,i.showSnackbar)({text:o.getLang("video_pin_video_snackbar"),type:"ok"})},427797:(e,t,r)=>{r.d(t,{showVideoUnpinnedSnackbar:()=>s});var i=r(659179),o=r(610989);const s=()=>(0,i.showSnackbar)({text:o.getLang("video_unpin_video_snackbar"),type:"ok"})},694715:(e,t,r)=>{r.d(t,{ensureEventPropagationStopping:()=>i});const i=(e,t)=>(e.stopPropagation(),t(e))},527460:(e,t,r)=>{r.d(t,{getOwnerPlaylistsUrl:()=>s});var i=r(476726),o=r(417517);const s=(e,t)=>{const r=(0,o.getOwnerUrl)(e,t);return e?.id?e.id===window.vk.id||(0,i.partConfigEnabled)("video_community_catalog")?[r,"playlists"].join("/"):[r,new URLSearchParams({section:"playlists"}).toString()].join("?"):r}},69865:(e,t,r)=>{r.d(t,{getShowcaseUrl:()=>i});const i=()=>"/video"},924156:(e,t,r)=>{r.d(t,{getVerifiedBadge:()=>c});var i=r(474848),o=r(863358),s=r(847891),n=r(901219),a=r(978271),l=r(847759),d=r(476726);const c=e=>{if(!e)return;const t=(e=>{const t=(0,n.isOwnerUser)(e);return t&&(e?.is_esia_verified||e?.is_sber_verified||e?.is_tinkoff_verified)?{icon:"esia",ownerId:e.id,verificationType:"esia"}:e?.verified?{icon:"default",ownerId:t?e.id:s.Ranges.convertGroupIdToOwnerId(e.id),verificationType:"default"}:null})(e);return(0,d.partConfigEnabled)("video_verified_badge_fix")?t?(0,i.jsx)(a.VerifiedBadgeWidget,{...t}):void 0:t?(0,i.jsx)(o.VerifiedLabel,{iconHref:"/verify",onMouseOver:e=>(0,l.pageVerifiedTip)(e.currentTarget,{oid:t.ownerId,forceNewTab:!0}),icon:t.icon}):void 0}},792919:(e,t,r)=>{r.d(t,{getVideoCardKey:()=>o});var i=r(112268);const o=(e,t)=>(0,i.joinRawId)({ownerId:e,itemId:t})},291903:(e,t,r)=>{r.d(t,{canDeletePlaylistVideo:()=>g.canDeletePlaylistVideo,canDeletePlaylistVideoFromPlaylist:()=>g.canDeletePlaylistVideoFromPlaylist,copyPlaylistUrl:()=>m.copyPlaylistUrl,ensureEventPropagationStopping:()=>i.ensureEventPropagationStopping,getFullAlbumId:()=>m.getFullAlbumId,getOwnerPlaylistsUrl:()=>o.getOwnerPlaylistsUrl,getShowcaseUrl:()=>s.getShowcaseUrl,getVerifiedBadge:()=>n.getVerifiedBadge,getVideoCardKey:()=>a.getVideoCardKey,initDestroyablePage:()=>l.initDestroyablePage,isAccessDenied:()=>d.isAccessDenied,isIdInvalid:()=>c.isIdInvalid,isMyVideoAlbum:()=>m.isMyVideoAlbum,isServiceAlbumId:()=>m.isServiceAlbumId,isSystemPlaylist:()=>u.isSystemPlaylist,isVideosEnabled:()=>v.isVideosEnabled,logAddToMeClick:()=>p.logAddToMeClick,logAuthorClick:()=>p.logAuthorClick,logDownloadClick:()=>p.logDownloadClick,logFaveClick:()=>p.logFaveClick,logShareClick:()=>p.logShareClick,logSubscribeClick:()=>p.logSubscribeClick,logTapClick:()=>p.logTapClick,mapAlbumsWithInclusionsToPlaylists:()=>m.mapAlbumsWithInclusionsToPlaylists,showPlaylistActionSnackbar:()=>m.showPlaylistActionSnackbar});var i=r(694715),o=r(527460),s=r(69865),n=r(924156),a=r(792919),l=r(782564),d=r(973450),c=r(464387),u=r(24552),v=r(458646),p=r(392273),m=r(948380),g=r(736041)},782564:(e,t,r)=>{r.d(t,{initDestroyablePage:()=>s});var i=r(440961),o=r(185198);function s({descriptor:e,component:t}){var r,s,n;const a=()=>{(0,o.hydrateComponent)({descriptor:e,component:t})};a(),(r=window.cur)._back??(r._back={}),(s=window.cur._back).hide??(s.hide=[]),window.cur._back.hide.push((()=>{const{target:t}=e.payload;t&&i.unmountComponentAtNode(t)})),(n=window.cur._back).show??(n.show=[]),window.cur._back.show.push(a)}},973450:(e,t,r)=>{r.d(t,{isAccessDenied:()=>i});const i=e=>"api_error"===e?.type&&204===Number(e.error?.error_code)},464387:(e,t,r)=>{r.d(t,{isIdInvalid:()=>i});const i=e=>"api_error"===e?.type&&100===Number(e.error?.error_code)},24552:(e,t,r)=>{r.d(t,{isSystemPlaylist:()=>i});const i=e=>1===e?.is_system},458646:(e,t,r)=>{r.d(t,{isVideosEnabled:()=>i});const i=e=>"api_error"===e?.type&&15===Number(e.error?.error_code)},392273:(e,t,r)=>{r.d(t,{logAddToMeClick:()=>v,logAuthorClick:()=>c,logDownloadClick:()=>m,logFaveClick:()=>u,logShareClick:()=>p,logSubscribeClick:()=>l,logTapClick:()=>d});r(694743);var i=r(581903),o=r(695290),s=r(687604);const n=()=>(0,s.getTrackCode)("search_track_code"),a=(e,t,r,o)=>{(o=n()||o)&&i.searchStatsCollector.logEvent({action:e,type:t,track_code:r||o})},l=(e,t,r)=>{a(e?o.SearchClickActionMap.UNSUBSCRIBE_OUT:o.SearchClickActionMap.SUBSCRIBE_OUT,t,r)},d=(e,t,r)=>{a(o.SearchClickActionMap.TAP,e,t,r)},c=(e,t,r)=>{a(o.SearchClickActionMap.OPEN_OWNER_OUT,e,t,r)},u=(e,t,r,i)=>{a(e?o.SearchClickActionMap.UNFAVE_OUT:o.SearchClickActionMap.FAVE_OUT,t,r,i)},v=(e,t,r,i)=>{a(e?o.SearchClickActionMap.REMOVE_FROM_ME_OUT:o.SearchClickActionMap.ADD_TO_ME_OUT,t,r,i)},p=(e,t)=>{a(o.SearchClickActionMap.SHARE_OUT,e,t)},m=(e,t)=>{a(o.SearchClickActionMap.DOWNLOAD_OUT,e,t)}},736041:(e,t,r)=>{r.d(t,{canDeletePlaylistVideo:()=>o,canDeletePlaylistVideoFromPlaylist:()=>i});const i=e=>Boolean(e.can_remove_videos),o=(e,t)=>Boolean(e.can_delete&&t.is_system)},948380:(e,t,r)=>{r.d(t,{copyPlaylistUrl:()=>S,getFullAlbumId:()=>_,isMyVideoAlbum:()=>m,isServiceAlbumId:()=>g,mapAlbumsWithInclusionsToPlaylists:()=>y,showPlaylistActionSnackbar:()=>f});var i=r(474848),o=r(112268),s=r(422495),n=r(610989),a=r(659179),l=r(818515),d=r(629775),c=r(8520),u=r(705744),v=r(60553),p=r(27995);const m=e=>e===s.MY_VIDEO_ALBUM_ID,g=e=>e&&e<=0,_=({albumId:e,ownerId:t})=>e&&t?(0,o.joinRawId)({ownerId:t,itemId:e}):"",h=(e,t=!1)=>({id:e.id,title:e.title,isPrivate:"only_me"===e?.privacy?.category,containsVideo:t}),y=({albumsByVideo:e,albums:t,ownerId:r})=>{return e.reduce(((e,i)=>{const o=_({albumId:i,ownerId:r}),s=t[o];return s&&(e[o]=h(s,!0)),e}),{...(i=t,Object.keys(i).reduce(((e,t)=>{const r=i[t];return r&&(e[t]=h(r)),e}),{}))});var i},f=async({playlistId:e,ownerId:t,playlistTitle:r,added:o})=>{const d=m(e);if(!r&&!d)return;const u=d?await(async()=>(window.Video||await(0,v.getVideoModule)(),window.Video._getMyAddedVideosPath()))():(0,s.getPlaylistURL)(t,e);let p;p=o?d?n.getLang("video_added_to_section"):n.getLang("video_added_to_playlist"):d?n.getLang("video_deleted_from_section"):n.getLang("video_deleted_from_playlist");const g=d?n.getLang("video_catalog_showcase_section_my_video_added_title"):(0,c.decodeHTMLEntities)(r||"");(0,a.showSnackbar)({text:p,before:{content:(0,i.jsx)(l.Icon28ListCheckOutline,{})},action:{label:g,onClick:()=>window.location.href=u},timeout:s.SNACKBAR_TIMEOUT}).catch()},S=({owner_id:e,id:t})=>{(0,c.copyTextToClipboard)(`https://${(0,u.getHostName)()}${(0,s.getPlaylistURL)(e,t)}`);(0,p.isVKUserAnonymous)()||(0,a.showSnackbar)({text:n.getLang("video_playlist_url_copied"),before:{content:(0,i.jsx)(d.Icon20CheckAlt,{})}})}},986752:(e,t,r)=>{r.d(t,{EditPlaylistModal:()=>l});var i=r(474848),o=r(456921),s=r(272259),n=r(964929),a=r(572238);const l=(0,o.observer)((function(){const{error:e,messageBoxProps:t,playlistModalProps:r}=(0,a.useEditPlaylistModel)();return e?(0,i.jsx)(n.PlaylistErrorModal,{error:e,onClose:t.onClose}):r?(0,i.jsx)(n.PlaylistModal,{...r,...t}):(0,i.jsx)(s.MessageBoxModalLoader,{refreshCoordinates:t.refreshCoordinates})}))},862264:(e,t,r)=>{r.d(t,{EditPlaylistModalWidget:()=>n});var i=r(127126),o=r(986752),s=r(572238);const n=(0,i.createWidget)(s.EditPlaylistModelProvider,o.EditPlaylistModal)},846719:(e,t,r)=>{r.r(t),r.d(t,{showEditPlaylistModal:()=>i.showEditPlaylistModal});var i=r(21989)},725545:(e,t,r)=>{r.d(t,{EditPlaylistModel:()=>l});var i=r(331635),o=r(327813),s=r(8520),n=r(127126),a=r(310142);class l{get error(){return this._error}get messageBoxProps(){return this._messageBoxProps}get playlistModalProps(){return this._playlistModalProps}abort(){this._abortController?.abort()}async[n.init]({ownerId:e,playlistId:t,onClose:r,refreshCoordinates:i,...s}){this._abortController=new AbortController,this._messageBoxProps={onClose:r,refreshCoordinates:i};try{const r=await this.playlistsProvider.fetchById({id:t,ownerId:e},{signal:this._abortController.signal});(0,o.runInAction)((()=>{this._abortController=void 0,this._playlistModalProps={...s,ownerId:e,playlist:r.data}}))}catch(e){(0,o.runInAction)((()=>{this._abortController=void 0,this._error=e}))}}[n.destroy](){this.abort()}constructor(e){this.playlistsProvider=e,this._abortController=void 0,this._playlistModalProps=void 0,this._error=void 0,this._messageBoxProps={onClose:s.noop,refreshCoordinates:s.noop},(0,o.makeAutoObservable)(this)}}l=(0,i.__decorate)([n.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===a.VideoPlaylistsProvider?Object:a.VideoPlaylistsProvider])],l)},572238:(e,t,r)=>{r.d(t,{EditPlaylistModelProvider:()=>s,useEditPlaylistModel:()=>n});var i=r(127126),o=r(725545);const{Provider:s,useModel:n}=(0,i.createProvider)(o.EditPlaylistModel)},21989:(e,t,r)=>{r.d(t,{showEditPlaylistModal:()=>n});var i=r(474848),o=r(272259),s=r(862264);const n=e=>{(0,o.showMessageBoxModal)((t=>(0,i.jsx)(s.EditPlaylistModalWidget,{...e,...t})),{width:420})}},944600:(e,t,r)=>{r.d(t,{VerifiedBadgeWidget:()=>s});var i=r(140157),o=r(120312);const s=(0,r(127126).createWidget)(i.VerifiedBadgeModelProvider,o.VerifiedBadge)},546997:(e,t,r)=>{r.d(t,{VerifiedBadge:()=>p});var i=r(474848),o=r(765668),s=r(785118),n=r(102846),a=r(380118),l=r(863358),d=r(140157),c=r(456921);const u=e=>{e.stopPropagation()},v=({header:e,text:t,headerLink:r},l)=>l?{header:(0,i.jsx)(o.Link,{target:"_blank",href:r,children:e}),text:(0,i.jsx)(s.Div,{mode:"vertical",spacing:0,paddingBottom:0,children:(0,i.jsx)(n.InnerHTML,{Component:a.Footnote,children:t})}),maxWidth:270}:{},p=(0,c.observer)((function({children:e}){const t=(0,d.useVerifiedBadgeModel)();return(0,i.jsx)("span",{onClick:u,children:(0,i.jsx)(l.VerifiedLabel,{iconHref:t.badgeLink,iconTarget:"_blank",tooltip:v(t.tooltipProps,t.isShowTooltip),icon:"esia"===t.verificationType?"esia":"default",onMouseOver:()=>{t.prepareModel()},children:e})})}))},120312:(e,t,r)=>{r.d(t,{VerifiedBadge:()=>i.VerifiedBadge});var i=r(546997)},106831:(e,t,r)=>{r.d(t,{VerifiedBadgeWidget:()=>i.VerifiedBadgeWidget});var i=r(944600)},39229:(e,t,r)=>{r.d(t,{VerifiedBadgeModelProvider:()=>v,useVerifiedBadgeModel:()=>p});var i=r(331635),o=r(327813),s=r(127126),n=r(26823),a=r(896845),l=r(847891),d=r(610989),c=r(571084);class u{get isLoading(){return this._isLoading}get user(){if(this.initId)return this.videoUsersStore?.getById(this.initId)?.data}get badgeLink(){return"esia"===this.verificationType?"/faq20572":"/verify"}get verificationType(){return this._verificationType}get tooltipProps(){return this.initId===c.ID_GROUP_PUBLIC_GAMES_WINNER?{header:d.getLang("groups_public_games_tt_header"),text:(0,d.langLink)("/publicgames",d.getLang("groups_public_games_tt_body")),headerLink:this.badgeLink}:this.isGroup?{header:d.getLang("groups_verified_header"),text:d.getLang("groups_verified_text"),headerLink:this.badgeLink}:(this.isCurrentUser||this.isUser)&&"default"===this.verificationType?{header:d.getLang("profile_verified_header"),text:this.user?.deactivated?"":(0,d.langReplace)(d.getLang("profile_verified_text"),{user:this.user?.first_name_gen||""}),headerLink:this.badgeLink}:this.isCurrentUser&&"esia"===this.verificationType?{header:d.getLang("profile_esia_verified_header"),text:d.getLang("profile_new_esia_verified_status_owner_tooltip"),headerLink:this.badgeLink}:this.isUser&&"esia"===this.verificationType?{header:d.getLang("profile_esia_verified_header"),text:this.user?.deactivated?"":(0,d.langReplace)(d.getLang("profile_esia_verified_tooltip"),{user:this.user?.first_name_gen||""}),headerLink:this.badgeLink}:{header:"",text:"",headerLink:this.badgeLink}}get isShowTooltip(){return Boolean(!this.isUser||!this.isLoading||this.user)}get isUser(){return!!this.initId&&l.Ranges.isUserId(this.initId)}get isGroup(){return!!this.initId&&l.Ranges.isGroupId(this.initId)}get isCurrentUser(){return this.initId===window.vk.id}setInitId(e){this.initId=e}setVerificationType(e){this._verificationType=e}setLoading(e){this._isLoading=e}[s.init]({ownerId:e,verificationType:t}){this.setInitId(e),this.setVerificationType(t)}async prepareModel(){if(this.initId&&!this.isGroup&&!this.isLoading&&!this.isCurrentUser&&this.user?.id!==this.initId){this.setLoading(!0);try{this.user||await this.usersFetchProvider.fetch({fields:u.getExtendedFields(),userIds:[this.initId]})}finally{this.setLoading(!1)}}}static getExtendedFields(){return["deactivated","first_name_gen"]}constructor(e,t){this.usersStoreFactory=e,this.usersFetchProvider=t,this.initId=void 0,this._verificationType=void 0,this._isLoading=!1,this.videoUsersStore=void 0,this.videoUsersStore=this.usersStoreFactory.ensureByFields(u.getExtendedFields()),(0,o.makeAutoObservable)(this,{})}}u=(0,i.__decorate)([s.scope.transient(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===n.VideoUsersStoreFactory?Object:n.VideoUsersStoreFactory,void 0===a.VideoUsersFetchProvider?Object:a.VideoUsersFetchProvider])],u);const{Provider:v,useModel:p}=(0,s.createProvider)(u)},571084:(e,t,r)=>{r.d(t,{ID_GROUP_PUBLIC_GAMES_WINNER:()=>i});const i=-29246653},140157:(e,t,r)=>{r.d(t,{VerifiedBadgeModelProvider:()=>i.VerifiedBadgeModelProvider,useVerifiedBadgeModel:()=>i.useVerifiedBadgeModel});var i=r(39229)},978271:(e,t,r)=>{r.d(t,{VerifiedBadgeWidget:()=>i.VerifiedBadgeWidget});r(846719);var i=r(106831)},5266:(e,t,r)=>{r.d(t,{PlaylistErrorModal:()=>a});var i=r(474848),o=r(767734),s=r(533048),n=r(610989);const a=({onClose:e,error:t})=>{const r="type"in t&&"network_error"===t.type,a=r?n.getLang("video_playlist_popup_connection_error_header"):n.getLang("video_playlist_popup_loading_error_header"),l=r?n.getLang("video_playlist_popup_connection_error_subheader"):n.getLang("video_playlist_popup_loading_error_subheader");return(0,i.jsx)(o.ModalCardBase,{onClose:e,header:a,subheader:l,actions:(0,i.jsx)(s.Button,{size:"l",mode:"secondary",stretched:!0,onClick:()=>window.location.reload(),children:n.getLang("video_playlist_popup_error_reload_button")})})}},681174:(e,t,r)=>{r.d(t,{PlaylistModal:()=>V,showPlaylistModal:()=>F});var i=r(474848),o=r(327813),s=r(456921),n=r(610989),a=r(272259),l=r(847891),d=r(209642),c=r(125852),u=r(416124),v=r(529558),p=r(753457),m=r(966576),g=r(533048),_=r(296540),h=r(580754),y=r(525714),f=r(843010),S=r(36895),b=r(793538),E=r(580022),I=r(5266),w=r(411282),A=r(194624);const P=(0,s.observer)((function({onClose:e,playlist:t,ownerId:r,refreshCoordinates:s,onCreate:P,onEdit:V}){const F=(0,A.usePlaylistModalModel)(),k=F.privacyModel.ownerService.owner,C=F.privacyModel.isLoading,x=(0,_.useRef)(null),[T,L]=(0,_.useState)(!1),[R,M]=(0,_.useState)(!1),O=l.Ranges.isGroupId(r),B=Boolean(F.privacyModel.ownerService.owner?.is_closed),$=(0,S.mapPrivacyCategory)(F.privacyModel.privacy||F.privacyModel.initialPrivacy),G=(0,S.getSettingsDropdownOptions)(B),{privacyViewSubtitle:D}=(0,y.getPrivacySubtitles)(F.privacyModel.privacyService.privacyFriends,F.privacyModel.privacyService.friendLists,F.privacyModel.privacy),U=$?.option&&(0,f.getPrivacyOptionSubtitle)($.option)?.concat(D),N=()=>{e(),F.dispose()};return(0,_.useEffect)((()=>(F.privacyModel.ownerService.fetch({ownerId:r,controller:new AbortController}),()=>F.dispose())),[]),(0,_.useEffect)((()=>{k&&F.privacyModel.fetchOwnerPrivacy()}),[k]),F.error?(0,i.jsx)(I.PlaylistErrorModal,{error:F.error,onClose:F.privacyModel.error?e:()=>F.resetError()}):!k||C?(0,i.jsx)(a.MessageBoxModalLoader,{refreshCoordinates:s}):(0,i.jsxs)(i.Fragment,{children:[!T&&!R&&(0,i.jsxs)(d.ModalBox,{children:[(0,i.jsx)(c.ModalHeader,{closeAriaLabel:n.getLang("box_cancel"),onClose:e,children:t?n.getLang("video_edit_playlist_title"):n.getLang("video_create_playlist_title")}),(0,i.jsxs)(u.ModalBody,{insetLevel:1,children:[(0,i.jsx)(v.FormItem,{top:n.getLang("video_playlist_name_placeholder"),children:(0,i.jsx)(p.Input,{value:F.title,status:F.titleError?"error":"default",placeholder:n.getLang("video_create_playlist_placeholder"),onChange:e=>F.setTitle(e.target.value)})}),(0,i.jsx)(w.PlaylistThumb,{}),!O&&(0,i.jsx)(h.PrivacySetting,{placement:"right",title:n.getLang("video_playlist_settings_privacy_view"),subtitle:U,privacy:$,friendLists:F.privacyModel.privacyService.friendLists,setPrivacy:e=>{F.privacyModel.setPrivacy((0,S.mapPrivacyToBasePrivacy)(e,F.privacyModel.defaultPrivacy,F.privacyModel.initialPrivacy))},onClickSomeFriends:()=>{M(!0)},onClickExceptFriends:()=>{L(!0)},getRootRef:x,options:G})]}),(0,i.jsx)(m.ModalFooter,{actions:[(0,i.jsx)(g.Button,{mode:"secondary",size:"m",onClick:e,children:n.getLang("box_cancel")},1),(0,i.jsx)(g.Button,{mode:"primary",size:"m",onClick:t?async()=>{if(await F.editPlaylist()){N();const e=F.thumbModel.uploadedThumb?.image;V?.({image:e?(0,o.toJS)(e):void 0,privacy:F.privacyModel.privacy?(0,o.toJS)(F.privacyModel.privacy):void 0,title:F.title})}}:async()=>{const e=await F.createPlaylist();e&&(N(),P?.({id:e,title:F.title}))},loading:F.isLoading,children:n.getLang("Save")},2)]})]}),T&&(0,i.jsx)(b.PrivacyModal,{privacy:F.privacyModel.privacy,onSave:e=>F.privacyModel.setPrivacy(e),onDestroy:()=>L(!1),categoryOptions:(0,S.getPrivacyExceptOptionsOptions)(B)}),R&&(0,i.jsx)(E.PrivacyFriendsModal,{privacy:F.privacyModel.privacy,onSave:e=>F.privacyModel.setPrivacy(e),onDestroy:()=>M(!1)})]})})),V=e=>(0,i.jsx)(A.PlaylistModalModelProvider,{...e,children:(0,i.jsx)(P,{...e})}),F=({onDestroy:e,...t})=>{(0,a.showMessageBoxModal)((e=>(0,i.jsx)(V,{...t,...e})),{width:420,onDestroy:e})}},411282:(e,t,r)=>{r.d(t,{PlaylistThumb:()=>u});var i=r(474848),o=r(456921),s=r(610989),n=r(529558),a=r(831966),l=r(390147),d=r(194624);const c=["image/jpeg","image/png","image/gif","image/heic","image/heif","image/webp"].join(","),u=(0,o.observer)((function(){const e=(0,d.usePlaylistModalModel)(),t=e.thumbModel.getThumbSrc(256);return(0,i.jsx)(n.FormItem,{top:s.getLang("video_playlist_thumb"),bottom:s.getLang("video_playlist_thumb_recomendation"),children:t?(0,i.jsx)(a.MediaAttach,{src:t,coverMode:e.thumbModel.error?"error":e.thumbModel.isLoading?"loading":"none",inputAriaLabel:s.getLang("video_upload_select_thumb"),removeTooltipText:s.getLang("global_delete"),width:128,height:80,onRetryClick:()=>{e.thumbModel.upload(e.thumbModel.thumbFile)},onRemoveClick:()=>e.thumbModel.resetData()}):(0,i.jsx)(a.MediaAttach,{inputAriaLabel:s.getLang("video_upload_select_thumb"),addIcon:(0,i.jsx)(l.Icon28CameraOutline,{}),accept:c,width:128,height:80,onChange:t=>{e.thumbModel.upload(t.target.files?.[0])}})})}))},848334:(e,t,r)=>{r.d(t,{PrivacyFriendsForm:()=>E});var i=r(474848),o=r(296540),s=r(625134),n=r(765668),a=r(903224),l=r(428918),d=r(116638),c=r(771008),u=r(725128),v=r(414698),p=r(785118),m=r(828902),g=r(923594),_=r(952881),h=r(610989),y=r(336583),f=r(248782),S=r(287841),b=r(335190);const E=({setSelectedFriends:e,selectedFriends:t,someFriends:r,onSearchSomeFriends:E,onSearchSomeFriendsReset:I,isPending:w})=>{const A=(0,o.useRef)(""),P=(0,o.useRef)(null),[V,F]=(0,o.useState)(!1),k=(0,o.useRef)(null),C=(0,o.useCallback)((e=>{k.current&&k.current.abort();const t=new AbortController;k.current=t,E({query:e,signal:t.signal})}),[E]),x=(0,o.useCallback)((0,f.debounce)((({target:{value:e}})=>{const t=e.trim();A.current!==t&&(I(),A.current=t,C(t))}),b.INPUT_CHANGE_DEBOUNCE_MS),[C,I]);(0,o.useEffect)((()=>{const e=(0,S.throttle)((({target:e})=>{e.scrollHeight-e.scrollTop<=2*e.clientHeight&&(w||C(A.current))}),b.SCROLL_DEBOUNCE_MS);return P.current?.addEventListener("scroll",e),()=>{P.current?.removeEventListener("scroll",e)}}),[C,w]),(0,o.useEffect)((()=>(C(A.current),()=>I())),[C,I]),(0,o.useEffect)((()=>()=>{k.current?.abort()}),[]);const T=(0,o.useRef)([]),L=V?T.current.filter((e=>r.some((({id:t})=>t===e.id)))):r;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Header,{aside:t.length>0||L.length>0&&V?(0,i.jsx)(n.Link,{onClick:()=>{F((e=>(T.current=e?[]:t,!e)))},children:V?h.getLang("friends_privacy_show_all"):h.getLang("friends_privacy_show_selected")}):null,children:h.getLang("global_privacy_settings_friends_in_list")}),(0,i.jsx)(a.Search,{onChange:x}),(0,i.jsx)(l.Spacing,{size:4}),(0,i.jsx)("div",{className:y.default.scrollContainer,children:(0,i.jsx)(d.CustomScrollView,{boxRef:P,className:y.default.scroll,children:0!==L.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.SpacedList,{spacing:4,children:L.map((r=>(0,i.jsx)(u.SelectableCell,{before:(0,i.jsx)(v.Avatar,{size:32,src:r.photo_50}),checked:t.some((({id:e})=>e===r.id)),onChange:()=>(t=>{e((e=>e.some((({id:e})=>e===t.id))?e.filter((({id:e})=>e!==t.id)):[...e,t]))})(r),maxHeight:36,children:(0,_.getOwnerName)(r)},r.id)))}),w&&(0,i.jsx)(p.Div,{className:y.default.loading,children:(0,i.jsx)(m.Spinner,{size:"small"})})]}):(0,i.jsx)("div",{className:y.default.status,children:w?(0,i.jsx)(m.Spinner,{size:"medium"}):(0,i.jsx)(g.Placeholder,{children:h.getLang("global_privacy_settings_no_friends_found_for_query")})})})})]})}},580022:(e,t,r)=>{r.d(t,{PrivacyFriendsModal:()=>_});var i=r(474848),o=r(296540),s=r(293721),n=r(209642),a=r(125852),l=r(785118),d=r(966576),c=r(757550),u=r(533048),v=r(610989),p=r(272259),m=r(848334),g=r(599333);const _=({onSave:e,onDestroy:t,privacy:r})=>{const{privacyService:_}=(0,g.getPlaylistModalServices)(),h=(0,s.useEvent)(_.setPrivacyFriends),y=(0,s.useStore)(_.$privacyFriends),f=(0,s.useStore)(_.$someFriends),S=(0,s.useEvent)(_.searchSomeFriends),b=(0,s.useEvent)(_.searchSomeFriendsReset),E=(0,s.useStore)(_.searchSomeFriendsFx.pending),I=(0,o.useMemo)((()=>r?.lists?.excluded?.length||r?.lists?.allowed?.length||r?.owners?.excluded?.length||0===r?.owners?.allowed?.length?[]:y?.filter((({id:e})=>r?.owners?.allowed?.includes(e)))||[]),[r]),[w,A]=(0,o.useState)(I),P=()=>{0===w.length?e({category:"only_me"}):(h(w),e({owners:{allowed:w.map((({id:e})=>e))}})),t()};return(0,i.jsx)(p.MessageBoxModal,{width:640,onDestroy:t,children:({onClose:e})=>(0,i.jsxs)(n.ModalBox,{children:[(0,i.jsx)(a.ModalHeader,{onClose:e,closeAriaLabel:v.getLang("global_close"),children:v.getLang("global_privacy_settings_select_friends_modal_title")}),(0,i.jsx)(l.Div,{mode:"horizontal",spacing:0,children:(0,i.jsx)(m.PrivacyFriendsForm,{setSelectedFriends:A,selectedFriends:w,someFriends:f,onSearchSomeFriends:S,onSearchSomeFriendsReset:b,isPending:E})}),(0,i.jsx)(d.ModalFooter,{actions:(0,i.jsxs)(c.ButtonGroup,{gap:"m",align:"right",children:[(0,i.jsx)(u.Button,{mode:"secondary",size:"m",onClick:e,children:v.getLang("global_cancel")}),(0,i.jsx)(u.Button,{mode:"primary",size:"m",onClick:P,children:v.getLang("global_save")})]})})]})})}},793538:(e,t,r)=>{r.d(t,{PrivacyModal:()=>A});var i=r(474848),o=r(77449),s=r(218894),n=r(525714),a=r(272259),l=r(293721),d=r(296540),c=r(209642),u=r(125852),v=r(785118),p=r(625134),m=r(529558),g=r(428918),_=r(216806),h=r(966576),y=r(757550),f=r(533048),S=r(610989),b=r(388716),E=r(330524),I=r(596240),w=r(599333);const A=({onSave:e,onDestroy:t,privacy:r,categoryOptions:A})=>{const{privacyService:P}=(0,w.getPlaylistModalServices)(),V=(0,l.useStore)(P.$searchAllowedFriends),F=(0,l.useEvent)(P.searchAllowedFriends),k=(0,l.useStore)(P.searchAllowedFriendsFx.pending),C=(0,l.useStore)(P.$searchExcludedFriends),x=(0,l.useEvent)(P.searchExcludedFriends),T=(0,l.useStore)(P.searchExcludedFriendsFx.pending),L=(0,l.useEvent)(P.setPrivacyFriends),R=(0,l.useStore)(P.$privacyFriends),M=(0,l.useStore)(P.$friendLists),[O,B]=(0,d.useState)(!1),$=(0,n.getCategoryOptionByPrivacy)(r),[G,D]=(0,d.useState)($),{value:U,options:N,onChange:j,onInputChange:q}=(0,o.usePrivacySelect)({friends:V,listIds:r?.lists?.allowed,ownerIds:r?.owners?.allowed,onSearch:F,allPrivacyFriends:R,friendLists:M,otherFriendsLimitCount:I.OTHER_FRIENDS_LIMIT_COUNT}),{value:Y,options:K,onChange:H,onInputChange:z}=(0,o.usePrivacySelect)({friends:C,listIds:r?.lists?.excluded,ownerIds:r?.owners?.excluded,onSearch:x,allPrivacyFriends:R,friendLists:M,otherFriendsLimitCount:I.OTHER_FRIENDS_LIMIT_COUNT}),J=(0,d.useRef)(null),W=G!==s.SETTINGS_PRIVACY_SOME_FRIENDS||G===s.SETTINGS_PRIVACY_SOME_FRIENDS&&U.length>0,X=e=>{const t=Y.filter((({value:t})=>!e.some((e=>e.value===t))));t.length!==Y.length&&H(t),j(e)},Q=e=>{const t=U.filter((({value:t})=>!e.some((e=>e.value===t))));t.length!==U.length&&j(t),H(e)},Z=()=>{const r=W?{category:G,allowedValue:G===s.SETTINGS_PRIVACY_SOME_FRIENDS?U:[],excludedValue:Y}:(J.current&&J.current.focus(),B(!0),!1);if(!r)return;const i=(0,n.mapPrivacyValueToBasePrivacy)(r),o=(0,n.getPrivacyFriends)(r.allowedValue,r.excludedValue);L(o),e(i),t()};return(0,i.jsx)(a.MessageBoxModal,{width:640,onDestroy:t,children:({onClose:e})=>(0,i.jsxs)(c.ModalBox,{children:[(0,i.jsx)(u.ModalHeader,{onClose:e,closeAriaLabel:S.getLang("global_close"),children:S.getLang("global_privacy_modal_title")}),(0,i.jsxs)(v.Div,{mode:"horizontal",spacing:0,children:[(0,i.jsx)(p.Header,{children:S.getLang("friends_privacy_show")}),(0,i.jsx)(b.PrivacyCategoryDropdown,{selectedOptionId:G,onClick:D,options:A}),G===s.SETTINGS_PRIVACY_SOME_FRIENDS&&(0,i.jsx)(m.FormItem,{status:!W&&O?"error":"default",children:(0,i.jsx)(E.PrivacySelect,{isPending:k,value:U,options:N,onChange:X,onInputChange:q,getRef:J})}),(0,i.jsx)(g.Spacing,{size:6}),(0,i.jsx)(_.Separator,{}),(0,i.jsx)(p.Header,{children:S.getLang("friends_privacy_hide")}),(0,i.jsx)(m.FormItem,{children:(0,i.jsx)(E.PrivacySelect,{isPending:T,value:Y,options:K,onChange:Q,onInputChange:z})}),(0,i.jsx)(g.Spacing,{})]}),(0,i.jsx)(h.ModalFooter,{actions:(0,i.jsxs)(y.ButtonGroup,{gap:"m",align:"right",children:[(0,i.jsx)(f.Button,{mode:"secondary",size:"m",onClick:e,children:S.getLang("global_cancel")}),(0,i.jsx)(f.Button,{mode:"primary",size:"m",onClick:Z,children:S.getLang("global_save")})]})})]})})}},964929:(e,t,r)=>{r.d(t,{PlaylistErrorModal:()=>i.PlaylistErrorModal,PlaylistModal:()=>o.PlaylistModal,showPlaylistModal:()=>o.showPlaylistModal});var i=r(5266),o=r(681174)},376314:(e,t,r)=>{r.d(t,{PlaylistModalModel:()=>d});var i=r(327813),o=r(643010),s=r(271139),n=r(900348),a=r(573549),l=r(8169);class d{get title(){return this._title}get error(){return this._error||this.privacyModel.error}get titleError(){return this._titleError}get isLoading(){return this.entitiesVideoAlbumsService.createVideoAlbumPending||Boolean(this._rawId&&this.entitiesVideoAlbumsService.videoEditedAlbumsPending[this._rawId])}setTitle(e){this._titleError=!1,this._title=e}resetError(){this._error=null}validateTitle(){""===this._title.trim()&&(this._titleError=!0)}dispose(){this.entitiesVideoAlbumsService.abortEditRequest(),this.entitiesVideoAlbumsService.abortCreateRequest(),this.thumbModel.dispose(),this.privacyModel.dispose()}async createPlaylist(){if(this.validateTitle(),this._titleError)return;const e=(0,i.toJS)(this.thumbModel.uploadedThumb),t={title:this._title,ownerId:this.ownerId,privacy:(0,i.toJS)(this.privacyModel.privacy)??void 0};e&&(t.photoId=e.photo_id,t.photoHash=e.photo_hash);try{const{album_id:e}=await this.entitiesVideoAlbumsService.createVideoAlbum(t);return this._onCreate({id:e,ownerId:t.ownerId,title:t.title,privacy:t.privacy}),e}catch(e){this._error=e}}async editPlaylist(){if(this.validateTitle(),!this._id||this._titleError)return;const e=(0,i.toJS)(this.thumbModel.uploadedThumb),t={itemId:this._id,ownerId:this.ownerId,title:this._title,privacy:(0,i.toJS)(this.privacyModel.privacy)??void 0};e?(t.photoId=e.photo_id,t.photoHash=e.photo_hash):null===e&&(t.photoId=0);try{await this.entitiesVideoAlbumsService.editVideoAlbumById(t),this._onEdit({id:t.itemId,ownerId:t.ownerId,title:t.title,privacy:t.privacy})}catch(e){return void(this._error=e)}return void 0!==t.photoId&&this.playlistService.fetch({playlistId:this._id,ownerId:this.ownerId}),!0}constructor({playlist:e,ownerId:t,onCreate:r,onEdit:d}){this.entitiesVideoAlbumsService=new n.EntitiesVideoAlbumsServiceAdapter(s.entitiesVideoAlbumsService),this.playlistService=new s.PlaylistServiceAdapter(s.playlistService),this._title="",this._error=null,this._titleError=!1,this.ownerId=t,this.privacyModel=new a.PlaylistPrivacyModel({playlist:e}),this.thumbModel=new l.PlaylistThumbModel({playlist:e,ownerId:t}),this._onCreate=r,this._onEdit=d,e&&(this._id=e.id,this._rawId=(0,o.getIdentityRawId)({id:e.id,ownerId:t}),this._title=e.title),(0,i.makeAutoObservable)(this)}}},573549:(e,t,r)=>{r.d(t,{PlaylistPrivacyModel:()=>l});var i=r(327813),o=r(800729),s=r(36895),n=r(271139),a=r(599333);class l{get defaultPrivacy(){return this._defaultPrivacy}get initialPrivacy(){return this._initialPrivacy}get privacy(){return this._privacy}setPrivacy(e){this._privacy=e}get isLoading(){return this.ownerService.isLoading||this.privacyService.getFriendListsPending||this.privacyService.getUsersByIdsPending}get error(){return this.ownerService.error||this.privacyService.getFriendListsError||this.privacyService.getUsersByIdsError}dispose(){this.ownerService.dispose(),this.privacyService.dispose()}get privacyOwners(){return[...this.initialPrivacy?.owners?.excluded||[],...this.initialPrivacy?.owners?.allowed||[]]}setPrivacyByOwner(){this._defaultPrivacy=(0,s.getDefaultBasePrivacyView)(Boolean(this.ownerService.owner?.is_closed)),this._initialPrivacy=this._playlistPrivacy??this.defaultPrivacy,this._privacy=this._initialPrivacy}fetchPrivacyOwners(){const e=this.privacyOwners;e.length&&this.privacyService.getUsersByIds(e)}async fetchOwnerPrivacy(){this.setPrivacyByOwner(),this.fetchPrivacyOwners(),this.privacyService.getFriendLists()}constructor({playlist:e}){this.ownerService=new n.OwnerServiceAdapter((0,a.getPlaylistModalServices)().ownerService),this.privacyService=new o.PrivacyServiceAdapter((0,a.getPlaylistModalServices)().privacyService),this._privacy=null,this._playlistPrivacy=e?.privacy,this._defaultPrivacy=(0,s.getDefaultBasePrivacyView)(!1),this._initialPrivacy=this._playlistPrivacy??this.defaultPrivacy,this._privacy=this._initialPrivacy,(0,i.makeAutoObservable)(this)}}},8169:(e,t,r)=>{r.d(t,{PlaylistThumbModel:()=>n});var i=r(327813),o=r(8520),s=r(271139);class n{get thumbFile(){return this._thumbFile}get uploadedThumb(){return this._uploadedThumb}getThumbSrc(e){return this._uploadedThumb?this._uploadedThumb.image?.[0]?.url:this._thumbFile?URL.createObjectURL(this._thumbFile):this._playlistThumbs?(0,o.getPhotoSize)(this._playlistThumbs,e)?.url:void 0}get error(){return this.playlistVideoThumbService.error}get isLoading(){return this.playlistVideoThumbService.isLoading}dispose(){this.playlistVideoThumbService.dispose()}resetData(){this.playlistVideoThumbService.resetData(),this._playlistThumbs=null,this._thumbFile=null,this._uploadedThumb=null}async upload(e){e&&e.type.match(/^image\//)?(this._thumbFile=e,await this.playlistVideoThumbService.upload(e,{ownerId:this.ownerId}),(0,i.runInAction)((()=>{this.playlistVideoThumbService.thumb&&(this._uploadedThumb=this.playlistVideoThumbService.thumb,this._thumbFile=null)}))):this._thumbFile=null}constructor({ownerId:e,playlist:t}){this.playlistVideoThumbService=new s.PlaylistVideoThumbUploadService,this._playlistThumbs=null,this._thumbFile=null,this._uploadedThumb=void 0,this.ownerId=e,t?.image&&(this._playlistThumbs=t.image),(0,i.makeAutoObservable)(this)}}},675454:(e,t,r)=>{r.d(t,{createPlaylistHandler:()=>d});var i=r(474848),o=r(659179),s=r(818515),n=r(610989),a=r(422495),l=r(400281);const d=e=>({ownerId:t,id:r,title:d,privacy:c})=>{e&&((e,t)=>{(0,o.showSnackbar)({before:{content:(0,i.jsx)(s.Icon28ListCheckOutline,{})},text:n.getLang("video_playlist_created_notification"),action:{label:n.getLang("video_open_new_playlist"),href:(0,a.getPlaylistURL)(e,t)}})})(t,r),window.dispatchEvent(new CustomEvent(l.PlaylistFormEvents.CREATE,{detail:{ownerId:t,id:r,title:d,privacy:c}}))}},263330:(e,t,r)=>{r.d(t,{editPlaylistHandler:()=>o});var i=r(400281);const o=({ownerId:e,id:t,title:r,privacy:o})=>{window.dispatchEvent(new CustomEvent(i.PlaylistFormEvents.UPDATE,{detail:{ownerId:e,id:t,title:r,privacy:o}}))}},194624:(e,t,r)=>{r.d(t,{PlaylistModalModelProvider:()=>c,usePlaylistModalModel:()=>u});var i=r(474848),o=r(456921),s=r(296540),n=r(376314),a=r(675454),l=r(263330);const d=(0,s.createContext)(null),c=(0,o.observer)((function({playlist:e,ownerId:t,hasOnCreateSnackbar:r=!0,children:o}){const[c]=(0,s.useState)((()=>new n.PlaylistModalModel({playlist:e,ownerId:t,onCreate:(0,a.createPlaylistHandler)(r),onEdit:l.editPlaylistHandler})));return(0,i.jsx)(d.Provider,{value:c,children:o})})),u=()=>{const e=(0,s.useContext)(d);if(!e)throw new Error("Empty Model for PlaylistModalModel");return e}},599333:(e,t,r)=>{r.d(t,{getPlaylistModalServices:()=>a});var i=r(596240),o=r(32489),s=r(271139),n=r(992013);const a=(0,r(942451).makeSharedState)("static/js/modules/web/video/components/PlaylistModal/models/store.ts",(()=>{const e=(0,o.createDomain)("VideoShowcase/PlaylistModal"),t=(0,n.createOwnerService)({domain:e,entitiesGroupsService:s.entitiesGroupsService,entitiesUsersService:s.entitiesUsersService});return{ownerService:t,privacyService:(0,i.createPrivacyService)(e,t.$ownerData)}}),{version:1})}}]);try{stManager.done("dist/web/chunks/8c621eff.436a3f88.js")}catch(e){}