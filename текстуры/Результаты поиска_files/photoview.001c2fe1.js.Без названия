(()=>{"use strict";var __webpack_modules__={858283:(_,e,t)=>{function o(){return{icon:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0a4 4 0 0 1 4 4h1.4c.55 0 .76.06.96.17.2.1.36.27.47.47.11.2.17.4.17.96v5.23c0 1.45-.15 1.98-.43 2.5-.29.54-.7.95-1.23 1.24-.53.28-1.06.43-2.5.43H5.16c-1.45 0-1.98-.15-2.5-.43-.54-.29-.95-.7-1.24-1.23-.28-.53-.43-1.06-.43-2.5V5.6c0-.55.06-.76.17-.96.1-.2.27-.36.47-.47.2-.11.4-.17.96-.17H4a4 4 0 0 1 4-4ZM4.77 5.5h-.04a.82.82 0 0 0-.4.09.6.6 0 0 0-.24.24.82.82 0 0 0-.09.4v.04c0 .17.03.3.09.4.05.1.14.19.24.24.1.06.23.09.4.09h.04c.17 0 .3-.03.4-.09a.6.6 0 0 0 .24-.24c.06-.1.09-.23.09-.4v-.04a.82.82 0 0 0-.09-.4.6.6 0 0 0-.24-.24.82.82 0 0 0-.4-.09Zm6.5 0h-.04a.82.82 0 0 0-.4.09.6.6 0 0 0-.24.24.82.82 0 0 0-.09.4v.04c0 .17.03.3.09.4.05.1.14.19.24.24.1.06.23.09.4.09h.04c.17 0 .3-.03.4-.09a.6.6 0 0 0 .24-.24c.06-.1.09-.23.09-.4v-.04a.82.82 0 0 0-.09-.4.6.6 0 0 0-.24-.24.82.82 0 0 0-.4-.09ZM8 1.5A2.5 2.5 0 0 0 5.5 4h5A2.5 2.5 0 0 0 8 1.5Z" fill="currentColor"/></svg>',name:"market_16"}}t.d(e,{getIcon16Market:()=>o})},678755:(_,e,t)=>{function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10.98 6.93a.75.75 0 1 0-1.06-1.06L7.15 8.64l-.87-.87a.75.75 0 1 0-1.06 1.06l1.4 1.4a.75.75 0 0 0 1.06 0l3.3-3.3ZM6.81 1.04a1.72 1.72 0 0 0-1.6.46L1.5 5.2a1.72 1.72 0 0 0-.47 1.6l1.29 5.58a1.72 1.72 0 0 0 1.29 1.29l5.57 1.29a1.72 1.72 0 0 0 1.6-.46l3.7-3.7a1.72 1.72 0 0 0 .47-1.6l-1.29-5.58a1.72 1.72 0 0 0-1.29-1.29L6.81 1.04Zm-.55 1.52a.22.22 0 0 1 .2-.05l5.58 1.28a.22.22 0 0 1 .17.17l1.28 5.57a.22.22 0 0 1-.06.2l-3.7 3.7a.22.22 0 0 1-.2.07l-5.57-1.3a.22.22 0 0 1-.17-.16L2.51 6.47a.22.22 0 0 1 .05-.2l3.7-3.7Z" clip-rule="evenodd"/></svg>',name:"nft_heptagon_outline_16"}}t.d(e,{getIcon16NftHeptagonOutline:()=>o})},359119:(_,e,t)=>{function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42L4.5 9.6Z"/></svg>',name:"verified_16"}}t.d(e,{getIcon16Verified:()=>o})},5829:(_,e,t)=>{t.d(e,{memoizeFirstTruthy:()=>o});const o=_=>((_,e)=>{let t,o=!1;return(...i)=>(!0===o||(t=_(...i),o=e(t)),t)})(_,(_=>!!_))},346327:(_,e,t)=>{t.d(e,{default:()=>d});var o=t(452314),i=t(610989),s=t(879007),r=t(317412),a=t(688701);const n={init:function(_,e){cur.lSTL&&(0,o.re)(cur.lSTL);const t=(e=e||{}).parent=e.parent||boxLayerWrap;(0,s.extend)(cur,{lSTLWrap:t,lSTL:t.appendChild((0,o.ce)("div",{id:"layer_stl",innerHTML:`<div id="layer_stl_bg" class="fixed"></div><div id="layer_stl_cl"></div><nobr id="layer_stl_text" class="fixed">${i.getLang("global_to_top")}</nobr>`,el:_.bodyNode,onclick:r.cancelEvent,onmousedown:n.lSTLDown,sc:n.onScroll})),lSTLText:(0,o.ge)("layer_stl_text",t),lSTLShown:0,lSTLWas:0,lSTLWasSet:0,lSTLOpts:e}),_&&_.setOptions({onShow:n.show,onHide:n.hide}),_&&_.scrollInited||((0,r.addEvent)(t,"scroll",n.onScroll),_&&(_.scrollInited=!0)),onBodyResize(),n.onScroll()},hide:function(){const _=cur.lSTLOpts;_&&_.parent&&((0,r.removeEvent)(_.parent,"scroll",n.onScroll),(0,o.hide)(cur.lSTL),cur.lSTLShown=0,_.onHide&&_.onHide())},show:function(){const _=cur.lSTLOpts;_&&_.parent&&((0,r.addEvent)(_.parent,"scroll",n.onScroll),setTimeout(n.onScroll,0),_.onShow&&_.onShow())},lSTLDown:function(_){if(_=_||window.event,(0,r.checkEvent)(_))return;const e=cur.lSTLWrap;if(!__afterFocus){let _=0;const t=e.scrollTop;cur.lSTLWasSet&&cur.lSTLWas?(_=cur.lSTLWas,cur.lSTLWas=0):cur.lSTLWas=t,e.scrollTop=_}return(0,r.cancelEvent)(_)},onScroll:function(){if(!cur.lSTL)return;const _=cur.lSTLWrap.scrollTop,e=200,t=cur.lSTLWas||_>e;let s=0;if(cur.lSTL.style.marginTop=Math.min(_,boxLayer.scrollHeight-cur.lSTL.scrollHeight-1)+"px",vk.staticheader){const _=(0,o.getSize)("page_header_wrap")[1];cur.lSTLText.style.marginTop=Math.max(-Math.min((0,a.scrollGetY)(),document.body.clientHeight-(window.lastWindowHeight||0)),-_)+"px"}t?(1!==cur.lSTLShown&&((0,o.show)(cur.lSTL),cur.lSTLShown=1),cur.lSTLWas&&_>500&&(cur.lSTLWas=0),_>e?(s=(_-e)/e,cur.lSTLWasSet&&(cur.lSTLWasSet=0,(0,o.val)((0,o.domLC)(cur.lSTL),i.getLang("global_to_top")),(0,o.removeClass)((0,o.domLC)(cur.lSTL),"down"))):(s=(e-_)/e,cur.lSTLWas&&(cur.lSTLWasSet||(cur.lSTLWasSet=1,(0,o.val)((0,o.domLC)(cur.lSTL),""),(0,o.addClass)((0,o.domLC)(cur.lSTL),"down"))))):0!==cur.lSTLShown&&((0,o.hide)(cur.lSTL),cur.lSTLShown=0),(0,o.setStyle)(cur.lSTL,{opacity:Math.min(Math.max(s,0),1)})}},d=n},296485:(_,e,t)=>{t.d(e,{default:()=>h});var o=t(257375),i=t(714209),s=t(610989),r=t(7144),a=t(879007),n=t(317412),d=t(452314),l=t(211981);const c="friends_dropdown__list_item",p="friends_dropdown__list_item system_message",u="add_term_tag";const h=class{init(){if(!this.isInited||!this.friendsdListNode){(0,o.getIndexedFriends)()||this.fetchFriendsList(),this.isInited=!0,this._initElement(),this._initScroll()}return this.friendsdListNode}update(_=[]){this._resetScroll(),this.setTopUsers(_),this._hideDropdown()}setTopUsers(_){this.topUsers.list.forEach((_=>{this.topUsers.remove(_)})),_.forEach((_=>{this.topUsers.add(_)})),this.topUsers.list=_}_hideDropdown(){(0,d.removeClass)(this.friendsdListNode,"show-dropdown")}_getItemHtml(_,e,t,o){return`<div class="${c}" data-id="${_}" data-name="${e}">\n      <img src="${o}" alt="${e}" class="friends_dropdown__list_image">\n      <div class="friends_dropdown__list_info">\n        <div class="friends_dropdown__list_name">${e} ${_===vk.id.toString()?`(${s.getLang("photos_tags_user_you")})`:""}</div>\n        <div class="friends_dropdown__list_label">${t}</div>\n      </div>\n    </div>`}_initElement(){this.friendsdListNode=(0,d.ce)("div",{className:"friends_dropdown__list"}),this.listInput=(0,d.ce)("input",{className:"friends_dropdown__list_input",placeholder:`${(0,r.replaceEntities)(s.getLang("photos_tags_dropdown_placeholder"))}`}),this.listDropdown=(0,d.ce)("div",{className:"friends_dropdown__list_dropdown"}),this.listContent=(0,d.ce)("div",{className:"friends_dropdown__list_content"}),this.listDropdown.appendChild(this.listContent),this.friendsdListNode.appendChild(this.listInput),this.friendsdListNode.appendChild(this.listDropdown),this._setListHTML(`<div class="${p}">${s.getLang("box_loading")}</div>`),(0,n.addEvent)(this.friendsdListNode,"click",n.cancelEvent),(0,n.addEvent)(this.listDropdown,"click",(_=>{this._handleItemSelected(_.target)})),(0,n.addEvent)(this.listDropdown,"mouseover",(_=>{if(this.keyboardNavigation)return;const e=(0,d.hasClass)(_.target,c)?_.target:(0,d.gpeByClass)(c,_.target);this._setHoverItem(e)})),(0,n.addEvent)(this.listInput,"keyup keydown keypress",this._handleInputKeyEvent),(0,n.addEvent)(this.listInput,"click",(()=>{this.show()}))}_handleItemSelected(_){const e=(0,d.hasClass)(_,c)?_:(0,d.gpeByClass)(c,_),t=(0,d.domData)(e,"name"),o=(0,d.domData)(e,"id");o&&this.options.onUserSelected(o,t),(0,d.hasClass)(_,u)&&this.freeTerm&&this.options.onUserSelected(0,this.freeTerm)}_getItemEleById(_){return(0,d.domQuery1)(`[data-id="${_}"]`,this.listDropdown)}_setListHTML(_){(this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent).innerHTML=_}_setHoverItem(_,e=!1){const t=(0,d.domData)(_,"id");if(t&&t!==this.hoverItem){if(this.hoverItem){const _=this._getItemEleById(this.hoverItem);(0,d.removeClass)(_,"hover")}this.hoverItem=t,(0,d.addClass)(_,"hover"),e&&this.scroll&&this.scroll&&this.scroll.scrollIntoView(_)}}show(_){(0,d.hasClass)(this.friendsdListNode,"show-dropdown")||(this._renderFriendsList(this.lastSeachTerm,_),(0,d.addClass)(this.friendsdListNode,"show-dropdown"),this._resetScroll(),this.scroll&&this.scroll.update())}_renderFriendsList(_,e=!1){_=(0,a.trim)(_);if((0,o.getIndexedFriends)()){const t=this._doSearch(_);this._renderFriendsDropdown(_,t,e)}else this._setListHTML(`<div class="${p}">${s.getLang("box_loading")}</div>`);clearTimeout(this.requestTimeout),_.length>0&&_!==this.lastSeachTerm&&(this.requestTimeout=setTimeout((()=>{this.fetchFriendsWithQuery(_)}),300))}_initScroll(){i.browser.safari||window.stManager.add(["ui_common.css",window.jsc("web/ui_common.js")],(()=>{this.scroll=new window.uiScroll(this.listContent,{global:!0})}))}_handleInputKeyEvent(_){if("keyup"===_.type){switch(_.keyCode){case n.KEY.ENTER:this._handleEnter();break;case n.KEY.ESC:return this.options.onEscapePress(),void this._hideDropdown();default:const e=_&&_.target.value;e!==this.lastSeachTerm&&(this._renderFriendsList(e),this.lastSeachTerm=e,this.hoverItem=null)}this.options.onKeyUp(),this.show()}else switch(_.keyCode){case n.KEY.UP:case n.KEY.DOWN:this._handleArrows(_.keyCode===n.KEY.DOWN)}}_handleArrows(_=!0){let e,t;if(this.keyboardNavigation||(this.keyboardNavigation=!0,(0,n.addEvent)(this.listDropdown,"mousemove",this._handleMouseMoveOnce)),this.hoverItem)e=this._getItemEleById(this.hoverItem),t=_?(0,d.domNS)(e):(0,d.domPS)(e);else{const _=this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent;t=(0,d.domFC)(_)}t&&this._setHoverItem(t,!0)}_handleMouseMoveOnce(){this.keyboardNavigation=!1,(0,n.removeEvent)(this.listDropdown,"mousemove",this._handleMouseMoveOnce)}_handleEnter(){if(this.hoverItem){const _=this._getItemEleById(this.hoverItem);this._handleItemSelected(_)}}_doSearch(_=""){let e;const t=(0,o.getPhotoData)("tagged"),i=(0,o.getIndexedFriends)();let s,r,a;_.length>0?(s=this.topUsers.search(_),r=i.search(_),a=cur.pvServerFriendsIndex.search(_)):(s=this.topUsers.list,r=i.list,a=cur.pvServerFriendsIndex.list),e=s.concat(r,a);let n=[];return e=e.filter((([_])=>{const e=n.indexOf(_)<0&&(!t||!t[_]);return n.push(_),e})),e.length>20&&(e=e.slice(0,20)),e}_renderFriendsDropdown(_,e,t=!1){let o="";if(e.forEach((([_,e,t,i])=>{const s=`id${_}`;o+=this._getItemHtml(_,e,t,i,s)})),!o&&t){this.freeTerm=_,_=(0,r.clean)(_);const e=s.getLang("photos_tags_not_found_tag_text").replace("{tagName}",`<span class="${u}">${_}</span>`);o=`<div class="${p}">${e}</div>`,this._setListHTML(o)}else o&&(this._setListHTML(o),this.freeTerm=null,this._resetScroll());this.hoverItem=null}focus(){this.listInput.focus()}reset(){this.listInput.value="",this.lastSeachTerm="",this.hoverItem=null,this._resetScroll()}_resetScroll(){this.scroll?this.scroll.scrollTop():this.listContent.scrollTop=0}fetchFriendsList(){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags"},{onDone:_=>{(0,o.setIndexedFriends)(_,(()=>{this._renderFriendsList(this.lastSeachTerm)}))}})}fetchFriendsWithQuery(_){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags",str:_,photo:(0,o.getPhotoData)("id")},{onDone:e=>{this._handleFetchFriends(_,e)}})}_handleFetchFriends(_,e=[]){if(this.lastSeachTerm!==_)return;let t,i=0;const s=(0,o.getPhotoData)("tagged");t=s?e.filter((([_])=>!s[_])):e,t.forEach((_=>{const e=_[0];cur.pvServerFriendsIds.indexOf(e)<0&&(cur.pvServerFriendsIds.push(e),cur.pvServerFriendsIndex.add(_),i++)})),(i>0||0===t.length)&&this._renderFriendsList(_,!0)}constructor(_={}){this.options=(0,a.extend)({onUserSelected:()=>!1,onEscapePress:()=>!1,onKeyUp:()=>!1},_),cur.pvServerFriendsIndex&&cur.pvServerFriendsIds||(cur.pvServerFriendsIndex=new l.vkIndexer([],(([_,e])=>e)),cur.pvServerFriendsIds=[]),this.topUsers=new l.vkIndexer([],(([_,e])=>e)),this.isInited=!1,this.lastSeachTerm="",this.hoverItem=null,this.keyboardNavigation=!1,this.freeTerm=null,this._handleInputKeyEvent=this._handleInputKeyEvent.bind(this),this._handleMouseMoveOnce=this._handleMouseMoveOnce.bind(this)}}},773610:(_,e,t)=>{t.d(e,{FullscreenPV:()=>d});var o=t(452314),i=t(610989),s=t(7144),r=t(317412),a=t(879007),n=t(772546);const d={init(){if(!cur.pvCanvas||cur.pvFSControls)return;const _=(0,s.positive)((0,n.getCookie)("remixfsss")),e=Math.min((0,s.positive)((0,n.getCookie)("remixfsdt"))||5,15);cur.pvFSControls=cur.pvCanvas.appendChild((0,o.ce)("div",{id:"pv_fs_controls",innerHTML:`\n<div id="pv_fs_topright" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_num"></div>\n      </td>\n      <td>\n        <div id="pv_fs_close" onclick="Photoview.fullscreenStop()">\n          <div id="pv_fs_close_btn"></div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_bottomleft" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_slide_check" onclick="FullscreenPV.startSlide()">\n          <div class="pv_fs_slide_check_icon"></div>${i.getLang("photos_slideshow")}\n        </div>\n      </td>\n      <td>\n        <div id="pv_fs_slide_speed_wrap">\n          <div id="pv_fs_slide_about"></div>\n          <div id="pv_fs_slide_speed" onmousedown="FullscreenPV.startSlideEdit(event)">\n            <div id="pv_fs_slide_speed_back"></div>\n            <div id="pv_fs_slide_speed_line">\n              <div id="pv_fs_slide_speed_ctrl"></div>\n            </div>\n          </div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_left_wrap" class="pv_fs_controls">\n  <div id="pv_fs_left"></div>\n</div>\n\n<div id="pv_fs_right_wrap" class="pv_fs_controls">\n  <div id="pv_fs_right"></div>\n</div>\n`,onmouseover:d.over,onmouseout:d.out})),(0,a.extend)(cur,{pvFSInfo:(0,o.ge)("pv_fs_num"),pvFSSlideCheck:(0,o.ge)("pv_fs_slide_check"),pvFSSlideSpeedWrap:(0,o.ge)("pv_fs_slide_speed_wrap"),pvFSSlideLine:(0,o.ge)("pv_fs_slide_speed_line"),pvFSSlideAbout:(0,o.ge)("pv_fs_slide_about"),pvFSSlideCont:(0,o.ge)("pv_fs_bottomleft"),pvFSSlideDelta:e,pvFSLeft:(0,o.ge)("pv_fs_left"),pvFSRight:(0,o.ge)("pv_fs_right")}),cur.pvFSSlideLine.style.width=Math.floor(100*(e-1)/14)+"%",(0,o.val)(cur.pvFSSlideAbout,i.getLang("photos_seconds",e)),_&&(0,o.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),d.slide(),(0,r.addEvent)(cur.pvCanvas,"mousemove",d.showControls),(0,r.addEvent)(cur.pvCanvas,"mousedown",d.onClick),(0,r.addEvent)(cur.pvCanvas,"mouseup",d.endSlideEdit),d.showControls(!0),cur.pvPhoto.blur(),d.updateInfo()},over(_){const e=_||window.event,t=e.target||e.srcElement||document;cur.pvFSOver=!t.id.match(/^pv_fs_(left|right)(_wrap)?$/)},out(){cur.pvFSOver=!1},onClick:_=>(__afterFocus||_&&(2==_.button||3==_.which)||(0,o.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSLeftShown?Photoview.show(cur.pvListId,cur.pvIndex-1):cur.pvFSRightShown&&Photoview.show(cur.pvListId,cur.pvIndex+1)),!!_&&(0,r.cancelEvent)(_)),showControls(_){const e=cur.pvFSrX=_.pageX,t=cur.pvFSrY=_.pageY;let i,s;cur.pvFSSlideEdit&&d.updateSlide(),void 0!==cur.pvFSX&&void 0!==cur.pvFSY&&Math.abs(e-cur.pvFSX)+Math.abs(t-cur.pvFSY)<4||(cur.pvFSControlsTimer||((0,o.removeClass)(cur.pvCanvas,"pv_fs_nocursor"),clearTimeout(cur.pvFSHideControlsTimer),(0,o.show)(cur.pvFSControls),(0,o.addClass)(cur.pvFSControls,"pv_fs_shown")),clearTimeout(cur.pvFSControlsTimer),cur.pvFSOver||cur.pvFSSlideEdit||(cur.pvFSControlsTimer=setTimeout(d.hideControls,3e3)),i=!cur.pvFSOver&&(e<100||cur.pvFSWidth&&e<(cur.pvScrWidth-cur.pvFSWidth)/2),i&&!cur.pvFSLeftShown?(0,o.addClass)(cur.pvFSLeft,"pv_fs_over"):!i&&cur.pvFSLeftShown&&(0,o.removeClass)(cur.pvFSLeft,"pv_fs_over"),cur.pvFSLeftShown=i,s=!cur.pvFSOver&&!i,s&&!cur.pvFSRightShown?(0,o.addClass)(cur.pvFSRight,"pv_fs_over"):!s&&cur.pvFSRightShown&&(0,o.removeClass)(cur.pvFSRight,"pv_fs_over"),cur.pvFSRightShown=s,cur.pvFSX=e,cur.pvFSY=t)},hideControls(){(0,o.addClass)(cur.pvCanvas,"pv_fs_nocursor"),(0,o.removeClass)(cur.pvFSControls,"pv_fs_shown"),clearTimeout(cur.pvFSHideControlsTimer),cur.pvFSHideControlsTimer=setTimeout(o.hide.pbind(cur.pvFSControls),300),cur.pvFSControlsTimer=!1},startSlide(){(0,o.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")?(clearTimeout(cur.pvFSTimer),(0,o.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),(0,n.setCookie)("remixfsss",0)):((0,o.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),d.slide(),(0,n.setCookie)("remixfsss",1),clearTimeout(cur.hideAboutTO),cur.hideAboutTO=setTimeout((function(){(0,o.removeClass)(cur.pvFSSlideAbout,"highlighted")}),3e3),(0,o.addClass)(cur.pvFSSlideAbout,"highlighted"))},updateSlide(){const _=Math.floor(15*Math.max(Math.min((vk.rtl?cur.pvFSrLeft+cur.pvFSrWidth-cur.pvFSrX:cur.pvFSrX-cur.pvFSrLeft)/cur.pvFSrWidth,.99),0))+1;cur.pvFSSlideDelta!=_&&((0,n.setCookie)("remixfsdt",cur.pvFSSlideDelta=_),cur.pvFSSlideLine.style.width=Math.floor(100*(_-1)/14)+"%",(0,o.val)(cur.pvFSSlideAbout,i.getLang("photos_seconds",_)))},startSlideEdit(_){if(cur.pvFSrX&&cur.pvFSrY)return(0,a.extend)(cur,{pvFSSlideEdit:!0,pvFSrLeft:(0,o.getXY)((0,o.domPN)(cur.pvFSSlideLine))[0],pvFSrWidth:(0,o.getSize)((0,o.domPN)(cur.pvFSSlideLine))[0]}),(0,o.addClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),d.updateSlide(),clearTimeout(cur.pvFSTimer),(0,r.cancelEvent)(_||window.event)},endSlideEdit(){cur.pvFSSlideEdit&&(cur.pvFSSlideEdit=!1,(0,o.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),d.slide(),cur.pvFSOver||(clearTimeout(cur.pvFSControlsTimer),cur.pvFSControlsTimer=setTimeout(d.hideControls,3e3)))},slide(){clearTimeout(cur.pvFSTimer),!(0,o.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")||cur.pvFSSlideEdit||(0,o.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSTimer=setTimeout((function(){cur.pvSlideNeedAnimation=!0,Photoview.show(cur.pvListId,cur.pvIndex+1)}),1e3*cur.pvFSSlideDelta))},updateInfo(){const _=((cur.pvData||{})[cur.pvListId]||[]).length,e=cur.pvIndex+1;(0,o.val)(cur.pvFSInfo,e+" / "+_),(0,o.toggle)(cur.pvFSInfo,_>1),(_>1?o.removeClass:o.addClass)(cur.pvCanvas,"pv_fs_one")}};window.FullscreenPV=d},487306:(_,e,t)=>{t.d(e,{default:()=>v});var o=t(452314),i=t(879007),s=t(317412),r=t(20025),a=t(610989),n=t(921336),d=t(141561),l=t(257375),c=t(476726),p=t(957125);const u="area_hover",h="visible_all";const v=class{_init(){const _=(0,c.partConfigEnabled)("photo_recognition_web");this.photoTooltip=new n.default(window.layer,{onMouseLeave:this._removeActiveAreaAfterTimeout,onUserSelected:this._userSelectedCallback,onDeleteClicked:this.deleteTag,onEscapePressed:this._removeActiveAreaAfterTimeout,onSuggestionDeclined:this._handleSuggestionDeclined,hideAfterDecline:_}),this.photoView=window.Photoview,this.areasContainer=(0,o.ce)("div",{className:"photo_tags_suggested_areas_list"}),this.containerNode.innerHTML="",this.containerNode.appendChild(this.areasContainer),(0,s.addEvent)(this.imageNode,"mousemove",this._handleImageMouseMove),(0,s.addEvent)(this.imageNode,"mouseleave",this._removeActiveAreaAfterTimeout),(0,s.addEvent)(this.imageNode,"mouseenter",this.showAllSuggestedAreas.bind(this)),(0,s.addEvent)(this.areasContainer,"mouseleave",this._removeActiveAreaAfterTimeout),(0,s.addEvent)(this.areasContainer,"click",this._handleAreaClick),this.renderTagAreas()}_handleImageMouseMove(_){if(this.areasHidden)return;const e=(0,o.getXY)(_.target),t=Math.round(100*(_.pageX-e[0])/_.target.offsetWidth),i=Math.round(100*(_.pageY-e[1])/_.target.offsetHeight);clearTimeout(this.areasTimeOut),this.areasTimeOut=setTimeout((()=>{this.photoTooltip.isActive||this.activeAreaId||this.hideAllSuggestedAreas()}),700),this.showAllSuggestedAreas();for(let _ in this.areas)if(this.areas.hasOwnProperty(_)){const e=this.areas[_],{x:o,y:s,x2:r,y2:a}=e;if(t>parseInt(o)&&t<parseInt(r)&&i>parseInt(s)&&i<parseInt(a)){if(_===this.activeAreaId)return void(this.tagAreaFound=!0);if(this.tagAreaFound=this.showTagArea(_),this.tagAreaFound)return}}this.tagAreaFound=!1,this._removeActiveAreaAfterTimeout()}_handleAreaClick(_){(0,s.cancelEvent)(_),this.photoTooltip.showAndFocusFriendsList(_)}showTagArea(_){const e=this.areas[_];return!(!e||e.isDeleted)&&(null!==this.activeAreaId&&this.areas[this.activeAreaId]&&(0,o.removeClass)(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=_,(0,o.addClass)(this.areas[_].ele,"active"),this.showTooltip(_),this.showAllSuggestedAreas(),!0)}hideTagArea(){clearTimeout(this.waitTimeout),null!==this.activeAreaId&&this.areas[this.activeAreaId]&&(0,o.removeClass)(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=null,this.photoTooltip.hide(),this.hideAllSuggestedAreas()}_removeActiveAreaAfterTimeout(_=500){this.activeAreaId&&!this.waitToRemove&&(this.waitToRemove=!0,clearTimeout(this.waitTimeout),this.waitTimeout=setTimeout((()=>{!this.photoTooltip.isActive&&!this.tagAreaFound&&!this.photoTooltip.interaction&&this.hideTagArea(),this.waitToRemove=!1}),_))}showTooltip(_){if(this.tooltipsPaused)return;const e=this.areas[_].ele,t=this._getTooltipOptions(_);if(e){const{top:_,right:i,bottom:s,left:r}=(0,o.getXYRect)(e,!0);this.photoTooltip.show({top:_,right:i,bottom:s,left:r},t)}}showAllSuggestedAreas(){(0,o.addClass)(this.areasContainer,h),(0,o.removeClass)(this.areasContainer,u),this.activeAreaId&&(0,o.addClass)(this.areasContainer,u)}hideAllSuggestedAreas(){(0,o.removeClass)(this.areasContainer,h)}pauseTooltips(){this.hideTagArea(),this.tooltipsPaused=!0}resumeTooltips(){this.tooltipsPaused=!1}_createTagElement(_,e,t,i){const s=cur.pvPhWidth,r=cur.pvPhHeight/s,a=t-_,n=i-e,d=(0,o.ce)("div",{className:"photo_tags_suggested_area"},{left:`${_}%`,marginTop:r*e+"%",width:`${a}%`}),l=(0,o.ce)("div",{},{paddingBottom:100*r*(n/a)+"%"});return d.appendChild(l),d}renderTagAreas(){this.areas={},this.areasContainer.innerHTML="";const _=(0,l.getPhotoData)("tags");let e=(0,l.getPhotoData)("suggested_tags");!(0,c.partConfigEnabled)("photo_recognition_web")&&cur.postTo&&cur.postTo<0&&(e=[]);for(let e in _)if("0"!==e&&_.hasOwnProperty(e)){const[t,o,i,s,r,a,n]=_[e],d=this._createTagElement(t,o,i,s);this.areas[e]={ele:d,x:t,y:o,x2:i,y2:s,userName:r,userHref:a,canDeleteTag:Boolean(n),confirmedTag:!1},this.areasContainer.appendChild(d)}for(let _ in e)if(_&&e.hasOwnProperty(_)){const[t,o,i,s,r,a,n]=e[_],d=this._createTagElement(t,o,i,s);let l;r&&(l=`/id${r}`),this.areas[_]={ele:d,x:t,y:o,x2:i,y2:s,userHref:l,suggestedUserId:r,suggestedUserName:a,usersList:n,confirmedTag:!1},this.areasContainer.appendChild(d)}}_userSelectedCallback(_,e,t=!1){const o=(0,l.getPhotoData)("tags"),s=(0,l.getPhotoData)("suggested_tags"),r=(0,c.partConfigEnabled)("photo_recognition_web"),a=this.activeAreaId,n=this.areas[a],{x:d,y:p,x2:u,y2:h}=n,v=`/id${_}`,E=cur.pvAskForAutoTag&&t,P=(0,i.clean)(e),m={suggestedUserId:!1,suggestedUserName:!1,usersList:[],userId:_,userName:P,userHref:v,canDeleteTag:!0},g=this.activeAreaId,b=()=>{this.activeAreaId=g,this.areas[g]=(0,i.extend)(n,m),this.photoTooltip.updateState(m),this.showTagArea(g),this._removeActiveAreaAfterTimeout(1e3),E&&(cur.pvAskForAutoTag=!1,this.showSettingsBox())};r?this.confirmSuggestedTags([a],(()=>{this.activeAreaId=g,this.photoTooltip.updateState(m),this.showTagArea(g),this._removeActiveAreaAfterTimeout(1e3)})):(o[a]=[d,p,u,h,P,v,!0],delete s[a],this._confirmSuggestedTag(a,_,e,r,b))}showSettingsBox(){(0,r.showBox)("/al_photos.php",{act:"show_autotag_settings"},{params:{grey:!0,width:450,bodyStyle:{padding:0},hideButtons:!0,titleTransparent:!0},onDone:(_,e)=>{const t=_.bodyNode,o=t=>{_.hide(),window.ajax.post("/al_settings.php",{act:"a_change_autotag_friends",hash:e.hash,autotag_friends:t?1:0})};t.querySelector(".AutotagSettingsBox__yesButton").addEventListener("click",(()=>o(!0))),t.querySelector(".AutotagSettingsBox__noButton").addEventListener("click",(()=>o(!1)))}})}confirmAlert(_=!1){let e=cur.pvOneSuggestHintId,t=cur.pvOneSuggestHintHash;_?(e=cur.pvSomeSuggestsHintId,t=cur.pvSomeSuggestsHintHash,cur.pvNeedShowAlertForSomeSuggests=!1):cur.pvNeedShowAlertForOneSuggest=!1,window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:e,hash:t},{onDone:()=>{},onFail:()=>(console.error("something wrong with help hint"),!0)})}deleteTag(_){_||(_=this.activeAreaId,this.photoView.deleteTag(_)),this.hideTagArea();let e=this.areas[_];_&&e&&(e=(0,i.extend)(e,{isDeleted:!0}),(0,o.addClass)(e.ele,"deleted"))}_getTooltipOptions(_){const e=this.areas[_];let{suggestedUserId:t,suggestedUserName:o,userName:i,userHref:s,usersList:r,canDeleteTag:a}=e;return{suggestedUserId:t,userName:i,userHref:s,suggestedUserName:o,usersList:r,canDeleteTag:a}}_handleSuggestionDeclined(){const _=this.activeAreaId,e=this.areas[_];if(!e)return;const t=(0,l.getPhotoData)("suggested_tags"),o=(0,c.partConfigEnabled)("photo_recognition_web");this.areas[_]=(0,i.extend)(e,{suggestedUserId:!1,suggestedUserName:!1,userHref:null}),t&&t[_]&&(t[_][4]=0),o?this.declineSuggestedTags([_]):(this.showTagArea(_),this._declineSuggestedTag(_))}declineSuggestedTags(_,e,t){const i=(0,l.getPhotoData)("id"),s=(0,l.getPhotoData)("hash"),r=cur.pvListId,n=cur.pvIndex,c=cur.pvData[r][n],p=(0,l.getPhotoData)("tags"),u=_.map((_=>`${i}_${_}`)).join(",");ajax.post("al_photos.php",{act:"decline_suggested_tags",tag_raw_ids:u,hash:s,extended:1},{onDone:(t,s,l)=>{this.decrementLeftMenuCounterIfNeeded(_),this.updatePhotoViewSuggestedTags(t,s,c),this.dispatchEvent(d.TagEventTypes.DECLINE_SUGGESTED_TAGS,{tagIds:_.map(Number),photoRawId:i}),r===cur.pvListId&&n===cur.pvIndex&&(!c.taginfo&&c.actions.tag&&p[0]<cur.pvMaxTags?(0,o.show)(cur.pvTagLink):(0,o.hide)(cur.pvTagLink),t||s||this.photoView.toggleTopInfoPanel(a.getLang("photos_tag_deleted"),l)),e&&e()},onFail:_=>(_||(_=a.getLang("global_unknown_error")),t&&t(),this.handleTagRequestFail(_))})}confirmSuggestedTags(_,e,t){const i=cur.pvListId,s=cur.pvIndex,n=cur.pvData[i][s],c=(0,l.getPhotoData)("id"),p=(0,l.getPhotoData)("hash"),u=(0,l.getPhotoData)("suggested_tags"),h=_.length>1,v=_[0],E=u[v][4],P=()=>{const r=_.map((_=>`${c}_${_}`)).join(",");ajax.post("al_photos.php",{act:"confirm_suggested_tags",tag_raw_ids:r,hash:p,extended:1},{onDone:(t,r,a,l,p)=>{this.decrementLeftMenuCounterIfNeeded(_),this.updatePhotoViewTags(t,r,a,n),this.updatePhotoViewSuggestedTags(l,p,n),this.dispatchEvent(d.TagEventTypes.CONFIRM_SUGGESTED_TAGS,{tagIds:_.map(Number),photoRawId:c}),i===cur.pvListId&&s===cur.pvIndex&&(!n.taginfo&&n.actions.tag&&t[0]<cur.pvMaxTags?(0,o.show)(cur.pvTagLink):(0,o.hide)(cur.pvTagLink)),e&&e()},onFail:_=>(_||(_=a.getLang("global_unknown_error")),t&&t(),this.handleTagRequestFail(_))})};if(cur.pvNeedShowAlertForOneSuggest&&!h&&E!==window.vk.id||cur.pvNeedShowAlertForSomeSuggests&&h){let e="",o="",i="";if(h){const t=_.reduce(((_,e)=>{const t=u[e],o=t&&t[4];return o&&o!==window.vk.id&&(_[o]=!0),_}),{}),s=Object.keys(t).length;o=a.getLang("photo_recognition_some_tag_alert",s),e=a.getLang("photo_recognition_some_friends_alert_text",s),i=a.getLang("photo_recognition_some_friends_submit_btn")}else{const _=u[v][5],t=u[v][7];o=a.getLang("photo_recognition_one_tag_alert"),e=(0,a.langSex)(t,a.getLang("photo_recognition_one_tag_alert_text","raw")).replace("{name}",_),i=a.getLang("photo_recognition_one_friend_submit_btn")}const s=(0,r.showFastBox)(o,e,i,(()=>{s.hide(),P(),this.confirmAlert(h)}),a.getLang("global_cancel"),(()=>{s.hide(),t&&t()}))}else P()}decrementLeftMenuCounterIfNeeded(_){const e=(0,l.getPhotoData)("suggested_tags");_.forEach((_=>{const t=e[_],o=t&&t[4];o&&o===window.vk.id&&(0,p.decrementLeftMenuPhotoCounter)()}))}_confirmSuggestedTag(_,e,t,o,i){const s=(0,l.getPhotoData)("id"),r=(0,l.getPhotoData)("hash");ajax.post("al_photos.php",{act:"confirm_suggested_tag",tag:_,tagged_id:e,name:t,photo:s,hash:r},{onDone:(_,e,t)=>{this.updatePhotoViewTags(_,e,t),i()},onFail:this.handleTagRequestFail})}_declineSuggestedTag(_){const e=(0,l.getPhotoData)("id"),t=(0,l.getPhotoData)("hash");ajax.post("al_photos.php",{act:"decline_suggested_tag",tag:_,photo:e,hash:t},{onFail:this.handleTagRequestFail})}dispatchEvent(_,e){this.areasContainer.dispatchEvent(new CustomEvent(_,{detail:e,bubbles:!0}))}handleTagRequestFail(_){const e=a.getLang("global_error");return setTimeout((0,r.showFastBox)(e,_).hide,3e3),!0}unMount(){(0,s.removeEvent)(this.imageNode,"mousemove",this._handleImageMouseMove),(0,s.removeEvent)(this.areasContainer,"click",this._handleAreaClick),this.containerNode.innerHTML=""}hideAreas(){this.areasHidden=!0,(0,o.hide)(this.areasContainer),this.photoTooltip.hide()}showAreas(){this.areasHidden=!1,(0,o.show)(this.areasContainer),(0,s.removeEvent)(this.imageNode,"mousemove",this._handleImageMouseMove),(0,s.addEvent)(this.imageNode,"mousemove",this._handleImageMouseMove)}reload(_=null){this.hideTagArea(),this.resumeTooltips(),this.renderTagAreas(),_&&(this.imageNode=_),this.activeAreaId=null,this.waitToRemove=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this.showAreas()}_queueCheckUpdates(){cur.pvTagsQueueParams&&window.Notifier&&Notifier.addKey(cur.pvTagsQueueParams,this._queueReceiveUpdates)}updatePhotoViewTags(_,e,t,o=null){(o=o||(0,l.getCurrentPhoto)())&&(o.tags=_,o.tagged=e,o.tagshtml=t,this.photoView.setTags(t))}updatePhotoViewSuggestedTags(_,e,t=null){(t=t||(0,l.getCurrentPhoto)())&&(_&&Object.keys(_).length?t.suggested_tags=_:delete t.suggested_tags,e?(t.suggestedTagsInfo=e,this.photoView.showSuggestedInfoTopPanel(cur.pvCurPhoto)):(delete t.suggestedTagsInfo,this.photoView.toggleTopInfoPanel(!1)),this.reload())}_queueReceiveUpdates(_,e){e.events&&e.events.forEach((_=>{const e=_.split("<!>"),t=e[1],o=e[2],i=JSON.parse(o),s=JSON.parse(e[3]),r=JSON.parse(e[4]),a=e[5];if((0,l.getPhotoData)("id")===t)(0,l.setPhotoData)("suggested_tags",i),this.updatePhotoViewTags(s,r,a),this.renderTagAreas();else if(cur.pvData)for(let _ in cur.pvData)if(cur.pvData.hasOwnProperty(_)){const e=cur.pvData[_];e.length&&e.forEach(((e,o)=>{if(e.id&&e.id===t){const e=cur.pvData[_][o];e.suggested_tags=i,e.tags=s,e.tagged=r,e.tagshtml=a}}))}}))}constructor(_,e){this.imageNode=_,this.containerNode=e,this.activeAreaId=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this._handleImageMouseMove=this._handleImageMouseMove.bind(this),this._handleAreaClick=this._handleAreaClick.bind(this),this._removeActiveAreaAfterTimeout=this._removeActiveAreaAfterTimeout.bind(this),this._queueCheckUpdates=this._queueCheckUpdates.bind(this),this._queueReceiveUpdates=this._queueReceiveUpdates.bind(this),this._userSelectedCallback=this._userSelectedCallback.bind(this),this._handleSuggestionDeclined=this._handleSuggestionDeclined.bind(this),this.updatePhotoViewTags=this.updatePhotoViewTags.bind(this),this.deleteTag=this.deleteTag.bind(this),this._init(),this._queueCheckUpdates()}}},921336:(_,e,t)=>{t.d(e,{default:()=>d});var o=t(296485),i=t(317412),s=t(452314),r=t(879007),a=t(645024);const n="right_top";const d=class{renderTooltip(){this.tooltipNode=(0,s.ce)("div",{className:"photo_tooltip"},{display:"none"});const _=(0,s.ce)("div",{className:"photo_tooltip__content"});this.sugggestionNode=(0,s.ce)("div"),this.nameNode=(0,s.ce)("div",{className:"photo_tooltip__name"},{display:"none"}),this.listNode=(0,s.ce)("div",{className:"photo_tooltip__suggestion"}),this.listNode.appendChild(this.friendsDropdownNode),(0,i.addEvent)(this.nameNode,"click",this._handleConfirmedTooltipClick),_.appendChild(this.nameNode),_.appendChild(this.sugggestionNode),_.appendChild(this.listNode),this.tooltipNode.appendChild(_),this.container.appendChild(this.tooltipNode),(0,i.addEvent)(this.tooltipNode,"mouseenter",(()=>{this.isActive=!0})),(0,i.addEvent)(this.sugggestionNode,"click",(_=>{(0,i.cancelEvent)(_);switch((0,s.domData)(_.target,"button")){case"yes":this.options.onUserSelected(this.suggestedUserId,this.suggestedUserName,!0);break;case"no":this.options.onSuggestionDeclined(),(0,s.hide)(this.sugggestionNode),this.userHref=null,this.options.hideAfterDecline?this.hide():(this.showFriendsList(),this.showAndFocusFriendsList())}})),(0,i.addEvent)(this.tooltipNode,"mouseleave",(()=>{this.interaction||(this.isActive=!1,this.options.onMouseLeave())})),this.options.closeOnClick&&(0,i.addEvent)(document,"click",this._handleDocumentClick)}_handleDocumentClick(_){this.options.onMouseLeave(),this.interaction=!1,this.isActive=!1,this.hide()}_handleUserSelected(_,e){this.isActive=!1,this.options.onUserSelected(_,e)}_handleEscapePress(){this.isActive=!1,this.interaction=!1,this.friendsDropdown.reset(),this.options.onEscapePressed()}_handleStartInteraction(){this.interaction=!0}_handleConfirmedTooltipClick(_){(0,i.cancelEvent)(_),"button"===_.target.tagName.toLowerCase()?this.options.onDeleteClicked():this.userHref&&this._go(this.userHref,_)}updatePosition({top:_,right:e,bottom:t,left:o}){const i=e-o,r=(0,s.getSize)(this.tooltipNode),a=r[0]?r[0]:280;let d="bottom",l=o+Math.floor(i/2)-a/2,c=t;if((l<10||this.hasDropdown&&t>(0,s.clientHeight)()-300)&&(d=n),d===n){l=e,c=_;const t=(0,s.clientHeight)()-_;t<300&&(c=_-300+t)}(0,s.domData)(this.tooltipNode,"dir",d),(0,s.setStyle)(this.tooltipNode,{top:c,left:l})}updateSuggestionQuestion(_,e){this.sugggestionNode.innerHTML=this._getSuggestionHTML(_,e),this.suggestedUserName=e,this.suggestedUserId=_}_getSuggestionHTML(_,e){const t=_===vk.id?a.getLang("photos_tags_user_you"):e;return`<div class="suggested_tag_user">\n      ${(0,a.langTag)("<div>","</div>",a.getLang("photos_tags_suggestion_question"),"tag_span").replace("{userName}",`<div class="suggested_tag_user__name">&nbsp;${t}</div>`)}\n      <div class="suggested_tag_user__actions">\n        <button data-button="yes" class="yes">${a.getLang("box_yes")}</button>\n        <span>&middot;</span>\n        <button data-button="no">${a.getLang("box_no")}</button>\n      </div>\n    </div>`}updateState(_){const{suggestedUserName:e,suggestedUserId:t,usersList:o,userName:i,userHref:r,canDeleteTag:a}=_;this.suggestedUserName=!1,this.suggestedUserId=!1,this.userHref=r,this.hasDropdown=!1,(0,s.removeClass)(this.tooltipNode,"tagged"),i?(this.nameNode.innerHTML=`${i} ${a?"<button>Delete</button>":""}`,(0,s.toggleClass)(this.nameNode,"show_delete",a),(0,s.show)(this.nameNode),(0,s.hide)(this.listNode),(0,s.hide)(this.sugggestionNode),(0,s.addClass)(this.tooltipNode,"tagged")):t?(this.updateSuggestionQuestion(t,e),(0,s.hide)(this.nameNode),(0,s.hide)(this.listNode),(0,s.show)(this.sugggestionNode)):(this.friendsDropdown.update(o),(0,s.hide)(this.nameNode),(0,s.hide)(this.sugggestionNode),this.showFriendsList(),this.hasDropdown=!0)}showFriendsList(){(0,s.show)(this.listNode),this.options.resetDropdownOnShow&&this.resetFriendsDropdown()}resetFriendsDropdown(){this.friendsDropdown.reset()}show(_,e={},t=!1){this.isActive=!1,this.interaction=!1,this.updateState(e),this.updatePosition(_),(0,s.show)(this.tooltipNode),t&&this.friendsDropdown.show(!0),this.friendsDropdown.focus()}hide(){(0,s.hide)(this.tooltipNode)}showAndFocusFriendsList(_){this.userHref?this._go(this.userHref,_):(this.friendsDropdown.focus(),this.friendsDropdown.show())}unMount(){(0,i.removeEvent)(document,"click",this._handleDocumentClick),(0,s.re)(this.tooltipNode)}_go(_,e){e&&e.ctrlKey?window.open(_):nav.go(_,e)}constructor(_,e={}){this.options=(0,r.extend)({closeOnClick:!0,resetDropdownOnShow:!0,onUserSelected:()=>!1,onMouseLeave:()=>!1,onEscapePressed:()=>!1,onDeleteClicked:()=>!1,onSuggestionDeclined:()=>!1},e),this.container=_,this.friendsDropdown=new o.default({onUserSelected:this._handleUserSelected.bind(this),onEscapePress:this._handleEscapePress.bind(this),onKeyUp:this._handleStartInteraction.bind(this)}),this.friendsDropdownNode=this.friendsDropdown.init(),this._handleConfirmedTooltipClick=this._handleConfirmedTooltipClick.bind(this),this._handleDocumentClick=this._handleDocumentClick.bind(this),this.renderTooltip()}}},856821:(_,e,t)=>{t.d(e,{Phototag:()=>l});var o=t(921336),i=t(610989),s=t(879007),r=t(141561),a=t(257375),n=t(258643),d=t(452314);const l={startTag(){if(cur.pvTagger||!cur.pvPhoto.firstChild)return;!cur.pvTaggerTooltip&&window.layer?cur.pvTaggerTooltip=new o.default(layer,{closeOnClick:!1,resetDropdownOnShow:!1,onUserSelected:l.addTag,onEscapePressed:l.stopTag}):cur.pvTaggerTooltip.resetFriendsDropdown(),(0,d.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");const _=n.FlatButton.render({children:i.getLang("global_done"),appearance:n.FlatButtonAppearance.PRIMARY,size:n.FlatButtonSize.M,restAttrs:{onclick:"Phototag.stopTag()"}});if(Photoview.toggleTopInfoPanel(i.getLang("photos_select_tag_area"),[_]),Photoview.toggleNavControls(""),Photoview.toggleOnPhotoControls(!1),layerWrap.scrollTop=0,cur.pvTagger="loading",!cur.pvTagger)return;const e={minw:30,minh:30,onStart(){cur.pvPhotoTags&&cur.pvPhotoTags.pauseTooltips(),cur.pvTaggerTooltip.hide()},onFinish:l.showFriends};Photoview.updatePhotoDimensions(),cur.pvTagger=window.photoTagger(cur.pvPhoto.firstChild,(0,s.extend)(e,{zstart:50})),cur.pvPhotoTags&&cur.pvPhotoTags.hideAllSuggestedAreas()},stopTag(){if(!cur.pvTagger||"loading"==cur.pvTagger)return void(cur.pvTagger=!1);(0,a.getPhotoData)("suggestedTagsInfo")?Photoview.showSuggestedInfoTopPanel(cur.pvCurPhoto):Photoview.toggleTopInfoPanel(!1),(0,d.hide)(cur.pvFriends),cur.pvTaggerTooltip&&cur.pvTaggerTooltip.hide(),cur.pvListId&&cur.pvData[cur.pvListId].length>1&&Photoview.toggleNavControls("left close right"),Photoview.toggleOnPhotoControls(!0),cur.pvTagger.destroy(),cur.pvTagger=!1,Photoview.updatePhotoDimensions(),cur.pvPhotoTags&&cur.pvPhotoTags.reload()},addTag(_,e){if(!cur.pvTagger||"loading"==cur.pvTagger)return!1;const t=cur.pvTagger.result();if(!_&&!e||!t[2])return!1;const o=(0,a.getPhotoData)("id"),i=(0,a.getPhotoData)("suggested_tags"),s=cur.pvListId,n=cur.pvIndex,c=cur.pvData[s][n],p=(0,d.getSize)(cur.pvPhoto.firstChild),u=t[0]/p[0]*100,h=t[1]/p[1]*100,v=(t[0]+t[2])/p[0]*100,E=(t[1]+t[3])/p[1]*100;return ajax.post("al_photos.php",{act:"add_tag",mid:_,photo:c.id,name:e,hash:c.hash,x:u,y:h,x2:v,y2:E},{onDone(_,e,t,a,p){if(cur.pvPhotoTags.updatePhotoViewTags(_,e,t,c),a&&p&&cur.pvPhotoTags.updatePhotoViewSuggestedTags(a,p,c),i){const _=Object.keys(i),e=a?_.filter((_=>!a[_])):_;cur.pvPhotoTags.dispatchEvent(r.TagEventTypes.DELETE_TAG,{tagIds:e.map(Number),photoRawId:o})}cur.pvListId==s&&cur.pvIndex==n&&((0,d.re)(Photoview.actionInfo()),(!c.taginfo&&c.actions.tag&&_[0]<cur.pvMaxTags?d.show:d.hide)(cur.pvTagLink),cur.pvTaggerTooltip.hide(),cur.pvTagger.reset(),cur.pvPhotoTags.renderTagAreas(),cur.pvTaggerTooltip.resetFriendsDropdown(),i&&p&&l.stopTag())},onFail:cur.pvPhotoTags.handleTagRequestFail}),!1},showFriends(){if(!cur.pvTagger||"loading"==cur.pvTagger)return;const _=cur.pvTagger.result(),e=_[0],t=_[1],o=_[2],i=_[3],s=(0,d.getXYRect)(cur.pvPhoto.firstChild,!0),r=s.left+e,a=s.top+t,n=s.left+e+o,l=s.top+t+i;cur.pvTaggerTooltip.hide(),cur.pvPhotoTags&&cur.pvPhotoTags.resumeTooltips(),cur.pvTaggerTooltip.show({left:r,top:a,right:n,bottom:l},{},!0)}}},994815:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Photoview:()=>Photoview});var _vkontakte_internal_vkjs_lib_API__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__(933052),_icons_desktop__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(787576),_icons_desktop__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(359119),_icons_desktop__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(678755),_icons_desktop__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(858283),_icons_desktop__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__(781596),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(714209),_web_lib_market__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(174628),_shared_ecomm_shared_adultApi__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(764994),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(610989),_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7144),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(691004),_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(134020),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(850101),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(688701),_web_ecomm_shared_utils_constructProductLink__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(928372),_web_ecomm_shared_utils_openProductWiki__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(988397),_web_lib_legacy__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(655883),_shared_lib_parse__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(614212),_web_photos_photos__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(514877),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(773610),_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(856821),_photo_tags__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(487306),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(618913),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(927984),_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(452314),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(317412),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(879007),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(346327),_web_page_wall__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(487434),_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(248298),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(20025),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(810903),_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(663878),_web_lib_utils__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(507035),_photoview_utils__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(257375),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(476726),_web_photos_types__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(141561),_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(957125),_web_reports_reports__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(678041),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(258643),_shared_market_analytics_utils__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(375962),_shared_ecomm_market_stats_types__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(70933),_web_ecomm_market_shared_utils_logViewMarketItemOnPhoto__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(553218),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(8520),_shared_ecomm_utils_marketItemId__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__(757459),_shared_stickers_refactor_utils_popup_getDataAttrs__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(62870),_shared_stickers_refactor_utils_popup_constants__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(359385),_shared_accessibility_accessibility__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(203240);const Photoview={MIN_WIDTH:600,MIN_HEIGHT:450,PE_MIN_WIDTH:600,PE_MIN_HEIGHT:500,SIDE_COLUMN_WIDTH:310,SIDE_MIN_GAP:40,VERTICAL_MIN_GAP:15,BOTTOM_BAR_HEIGHT:52,SIDE_NAV_PANELS_MAX_WIDTH:120,SIDE_NAV_PANELS_MIN_WIDTH:25,LEFT_RIGHT_NAV_RATIO:.25,blank:"/images/blank.gif",blankf:()=>{},cacheSize:3,allSizes:["x","y","z","w"],PE_V1:1,PE_V2:2,PE_V3:4,_getViewedPhotoFullId(){const _=cur.pvListId,e=cur.pvIndex;return cur.pvData[_][e].id},changeThumbs(_,e,t){if(_){const o=[(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("photo_row"+cur.filterPhoto),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("photos_add_thumb"+cur.filterPhoto)],i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("page_post_thumb_wrap");i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("page_preview_photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("im_preview_photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("page_square_photo")),i.push.apply(i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("photos_row"));for(let _ in i)if(i.hasOwnProperty(_)){let e=i[_].getAttribute("onclick");if(!e){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(i[_]);e=!!t&&t.getAttribute("onclick")}e&&-1!=e.indexOf(`'${cur.filterPhoto}'`)&&o.push(i[_])}for(let e in o)if(o[e]){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hasClass)(o[e],"page_square_photo")||o[e].style.backgroundImage){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(o[e],{backgroundImage:`url('${_}')`});continue}let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByTag1)("img",o[e]);t&&(t.src=_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(t,{height:"auto"}))}if(cur.pvNoTemp||(cur.pvNoTemp={}),cur.pvNoTemp[cur.filterPhoto]=!0,window.ThumbsEdit&&e){const _=ThumbsEdit.cache();for(let o in _)if(_.hasOwnProperty(o)){const i=_[o].previews||[];let s=!1;for(let _ in i)i.hasOwnProperty(_)&&"photo"==i[_].type&&i[_].photo.id=="photo"+t&&(i[_].photo.sizes=e,delete i[_].photo.restrictionBlur,s=!0);s&&ThumbsEdit.refresh(o)}}}},openStickersEditor(_){cur.pvEditorMode||(_||(_=cur.pvCurPhoto),Photoview.stopTagger(),cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas(),Photoview.toggleNavControls(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvLikeFSWrap),Photoview.toggleNavControls("close"),Photoview.hideTag(!0),cur.pvEditorMode=!0,cur.pvEditorSaved=!1,Photoview.updatePhotoDimensions(),window.stManager.add([window.jsc("web/spe.js")],(()=>{SPE.init(_,((e,t,o,i)=>{const s=document.querySelector(`.photos_photo_edit_row[data-id="${e.id}"] .photos_photo_edit_row_thumb`);s&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(s,"background-image",`url(${t})`);const r=e.id!=_.id;cur.pvEditorSaved=!0,cur.pvPhotoTags&&cur.pvPhotoTags.reload();let a=[];if(o&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.isArray)(o)&&Object.entries(o).forEach((([_,e])=>{if(!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.isArray)(e))return;const[t,o,i]=e;t&&a.push({type:_,url:t,width:o,height:i})})),_.closeOnPEEdit){if(e&&t&&window.ThumbsEdit&&o){const t=ThumbsEdit.cache();for(let s in t)if(t.hasOwnProperty(s)){const a=s.replace("thumbs_edit",""),n=cur.addMedia[a];if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__.partConfigEnabled)("web_posting_carousel_crop")){const t=n?.getMedias(),s=t?.find((([,e])=>e===_.id));if(s){const _=s[0],t=e.id,r=s[5],{editable:a}=r??{};let d={...s,list:e.list,view_opts:i,thumb_m:o?.m?.[0]??s.thumb_m,thumb_s:o?.s?.[0]??s.thumb_s,editable:{...a,sizes:o,click:n.showPhoto.pbind(e.id,e.list,(0,_shared_lib_parse__WEBPACK_IMPORTED_MODULE_12__.parseJSON)(i))}};d.crop_data=void 0,n.emitThumbUpdated({id:s[1],thumb:[_,t,d]})}}const d=t[s].previews||[];let l=!1;for(let t in d)if(d.hasOwnProperty(t)&&"photo"==d[t].type&&d[t].photo.id=="photo"+_.id){const s=d[t].photo;if(r){s.id="photo"+e.id,s.pid=e.id.split("_")[1];const t=n.getMedias();(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)(t,(function(){if("photo"==this[0]&&this[1]==_.id)return this[1]=e.id,!1}))}d[t].click=n.showPhoto.pbind(e.id,e.list,(0,_shared_lib_parse__WEBPACK_IMPORTED_MODULE_12__.parseJSON)(i)),d[t].itemId=s.pid,s.sizes=o,l=!0}l&&(ThumbsEdit.refresh(s),n.onChange&&n.onChange())}}return(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_38__.isFunction)(window.cur.pvOptions.onEdit)&&window.cur.pvOptions.onEdit(a),Photoview.changeThumbs(t,o,e.id),Photoview.hide(0)}if((0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_38__.isFunction)(window.cur.pvOptions.onEdit)&&window.cur.pvOptions.onEdit(a),cur.pvListId){const i=cur.pvListId,s=cur.pvData[i];let a=cur.pvIndex;if(!s)return nav.reload();let n=s[a];if(r){const _=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)({},e);a=++cur.pvIndex,s.splice(a,0,_),n=_,cur.pvCommsLikes[n.id]=[n.comments,0,(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)(),!1],delete n.comments,delete n.likes}const d=cur.pvShown&&i==cur.pvListId&&a==cur.pvIndex;e&&t&&!r&&(Photoview.changeThumbs(t,o,_.id),delete n.x_,delete n.x_src,delete n.y_,delete n.y_src,delete n.z_,delete n.z_src,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(n,e)),n.peType=Photoview.PE_V3,d&&(cur.pvCurData=Photoview.genData(n,Photoview.getPhotoSize()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvPhoto).src=Photoview.blank,setTimeout(Photoview.show.pbind(cur.pvListId,cur.pvIndex),0))}}),(()=>{if(delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),_.closeOnPEEdit)return Photoview.hide(0);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvLikeFSWrap),Photoview.toggleNavControls(["left","right","close"]),setTimeout(Photoview.updatePhotoDimensions,1)}))})))},genUrl:(_,e)=>e?(e.match(/\.[a-z]{3}(?:\?|$)/i)||(e+=".jpg"),e.match(/https?:\/\//i)?e:(_||"").replace(/\/[a-z0-9_:\.]*$/i,"")+"/"+e):"",genData(_,e){const t="x"==e?3:"y"==e?2:"z"==e?1:0,o=["w","z","y","x"].slice(t);let i,s;for(let e=0;e<4-t;++e){const t=o[e];if(i=_[t+"_"])break;if(s=_[t+"_src"])break}return i||(i=[s]),{src:Photoview.genUrl(_.base,i[0]),width:i[2]&&i[1],height:i[1]&&i[2],restrictionBlur:_.restrictionBlur,restrictionGeo:_.restrictionGeo,restrictionTitle:_.restrictionTitle,restrictionText:_.restrictionText,restrictionButton:_.restrictionButton,photoRaw:_.photoRaw,unblurHash:_.unblurHash}},actionInfo:()=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_action_info")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domPN)(cur.pvTags).insertBefore((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{id:"pv_action_info",className:"pv_right_block"}),cur.pvTags),locNav(_,e,t,o){if(cur.pvListId=="newtag"+vk.id+(t.rev?"/rev":"")&&t[0]=="albums"+vk.id&&"added"==t.act)return Photoview.hide(o.hist),!1;if((t=nav.toStr(t)).replace("?rev=1","/rev")==cur.pvListId&&cur.pvShown)return Photoview.hide(o.hist),!1;const i=t.match(/^photo(-?\d+_\d+)\??((all=1|newtag=\d+)(&rev=1)?|(rev=1&)?tag=\d+|rev=1)?$/);if(!i)return;let s=cur.pvListId;s&&cur.pvShown||(s="added"==nav.objLoc.act?"newtag"+vk.id+(nav.objLoc.rev?"/rev":""):nav.strLoc.replace("?rev=1","/rev"));const r=cur.pvData[s];if(r)for(let _=0,e=r.length;_<e;++_)if(r[_]&&r[_].id==i[1])return Photoview.show(s,_,!1,cur.pvRoot),!1},updateLocNav(){if(cur.pvRoot){for(let _=0,e=cur.nav.length;_<e;++_)if(cur.nav[_]==Photoview.locNav)return;cur.nav.push(Photoview.locNav)}else for(let _=0,e=cur.nav.length;_<e;++_)cur.nav[_]==Photoview.locNav&&(cur.nav.splice(_,1),--_,--e)},toggleOnPhotoControls(_){_=!!_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggle)(cur.pvFSWrap,_)},checkLayerVisibility(){if(cur.pvShown)return!0;(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_38__.isFunction)(cur.pvOptions?.onBeforeLayersPreparing)&&cur.pvOptions.onBeforeLayersPreparing(),(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.debugLog)("layerqueue.hide from photoview"),layerQueue.hide(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(window,"resize",Photoview.onResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(document,"keydown",Photoview.onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(layerWrap,"click",Photoview.onLayerClick);const _=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)();_?.getOptions().featureFlags?.keepInPhotoView?_._hideInternal({showingOther:!1,tempHiding:!0}):(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.getBoxQueue)().hideAll(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(layerBG,{opacity:""}),layers.show(),layers.fullhide=Photoview.hide},emojiShowTT:(_,e)=>void 0!==cur.pvEmoji&&Emoji.ttShow(cur.pvEmoji,_,e),emojiHideTT:(_,e)=>void 0!==cur.pvEmoji&&Emoji.ttHide(cur.pvEmoji,_,e),onImageWrapMouseDown(_){if(2!=_.button&&!cur.pvEditorMode){if(_.target.closest(".pv_attach_product_badge"))return!1;if(cur.pvAttachedProducts.isProcess)return Photoview.attachProductPoint(_),!1;if(!cur.pvTagger&&!1===(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.checkEvent)(_)){let e=cur.pvIndex;return Photoview.updateNavBtnsLeftThreshold(),_.pageX<cur.pvLeftBtnAmount?e-=1:e+=1,cur.pvPointerPosition=[_.pageX,_.pageY],Photoview.show(!1,e,_)}}},onImageWrapMouseLeave(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(cur.pvNavBtnLeft,"pv_nav_btn_show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(cur.pvNavBtnRight,"pv_nav_btn_show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(cur.pvImageAreaWrap,"pv_init_hover"),Photoview.updateNavBtnsLeftThreshold(!0)},onImageWrapMouseMove(_){Photoview.updateNavBtnsLeftThreshold(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",_.pageX<cur.pvLeftBtnAmount),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvNavBtnRight,"pv_nav_btn_show",_.pageX>cur.pvLeftBtnAmount)},toggleLightModeClass(_){_=!!_&&cur.pvIsLightMode,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvBox,"pv_light_mode",!!_),_=!!_&&cur.pvShowBottomActions,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvBox,"pv_show_bottom_actions",!!_)},isPhotosList:()=>!!(cur.pvVideoTagsShown||cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown),checkIsEditorAndHide(){cur?.pvEditorMode?SPE.attemptHide():Photoview.hide(0)},setInitialFocus(){const _=cur.pvNavBtnClose?[cur.pvNavBtnClose]:[];(0,_shared_accessibility_accessibility__WEBPACK_IMPORTED_MODULE_40__.setFocusIsNeed)(cur.pvBox,_),cur.pvBox.contains(document.activeElement)||cur.pvBox.focus()},createLayer(){cur.pvLayerCreated=!0,delete cur.pvLeftBtnAmount,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(layerWrap,"pv_layer_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(layerBG,"pv_layer");const _=Photoview.isPhotosList(),e=nav.objLoc[0].match(/^faq(\d)+$/),t=nav.objLoc[0].match(/^bug(\d)+$/),o=cur.translationBoxOpened;cur.pvIsLightMode=t||0==nav.objLoc[0].indexOf("blog/")||e||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.inArray)(nav.objLoc[0],["blog","about","support","helpdesk","tutorial","market","bugs","translation","restore2"])||o||cur.pvOptions&&cur.pvOptions.isLightMode,cur.pvShowBottomActions=!cur.pvIsLightMode||e||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.inArray)(nav.objLoc[0],["helpdesk","support"]);const i="display: none",s=cur.pvAlbumsShown?cur.pvAlbumsData[cur.pvAlbumsShown].html:"",r=cur.pvVideoTagsShown?cur.pvVideoTagsData.html:"",a=_?i:"",n=_?"":i,d=cur.pvAlbumsShown?"":i,l=cur.pvVideoTagsShown?"":i;let c=cur.pvAlbumShown?cur.pvAlbumData[cur.pvAlbumShown].html:"",p=cur.pvAlbumShown?"":i;cur.pvPhotoTagShown&&(c=cur.pvPhotoTagData[cur.pvPhotoTagShown].html,p=""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments")&&(cur.pvBackupComments=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domPN)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments")).removeChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments")));const u=cur.pvAlbumsData?.[cur.oid]?.opts?.photos_map_tags_markup||"",h=`\n    <div style="${n}" class="box_title_wrap box_grey">\n      <div class="box_x_button" onclick="Photoview.hide(0)">${(0,_icons_desktop__WEBPACK_IMPORTED_MODULE_41__.getIcon20Cancel)().icon}</div>\n      ${u}\n      <div class="box_title_controls"></div>\n      <div class="box_title"></div>\n    </div>\n    `,v=cur.pvIsLightMode?"":'\n      <div class="pv_fs_wrap">\n        <div class="pv_fs_btn" onmousedown="return Photoview.fullscreen(event);"><div></div></div>\n      </div>\n    ',E=`\n      <div class="pv_bottom_info clear_fix">\n        <div>\n          <div class="pv_bottom_info_left">\n            <div class="pv_album_name" onmouseover="setTitle(this)"></div>\n            <span class="pv_counter"></span></div>\n            ${cur.pvShowBottomActions?'<div class="pv_bottom_actions"></div>':""}\n        </div>\n      </div>`,P=(0,_shared_stickers_refactor_utils_popup_getDataAttrs__WEBPACK_IMPORTED_MODULE_39__.popUpGetStringDataAttrs)({popupStickerContainerId:_shared_stickers_refactor_utils_popup_constants__WEBPACK_IMPORTED_MODULE_42__.POPUP_STICKER_PHOTO_CONTAINER_ID}),m=cur.pvIsLightMode?"":`\n      <div id="pv_narrow_column_wrap" class="pv_narrow_column_wrap">\n        <div class="pv_narrow_column_cont wall_module">\n          <div ${P} class="narrow_column" id="pv_narrow"></div>\n        </div>\n      </div>`,g=(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_6__.getProgressHtml)("pv_image_progress"),b="pv_mouse_out_layer";layer.innerHTML=`\n    <div class="pv_cont">\n      <div id="pv_box" class="_scroll_node pv_box" role="dialog" aria-modal="true" tabindex="-1" onclick="cur.pvClicked = true;" onmouseenter="removeClass(layerWrap, '${b}')" onmouseleave="addClass(layerWrap, '${b}')">\n        ${h}\n        <div class="clear_fix pv_photo_wrap" style="${a}">\n          <div aria-label="${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_close")}" role="button" tabindex="0" class="pv_close_btn" onclick="Photoview.checkIsEditorAndHide()"></div>\n          <div class="no_select pv_left_wrap">\n            <div class="no_select pv_image_wrap">\n              <div id="pv_tag_info" class="PhotoViewTopPanel">\n                <div class="pv_tag_info_text"></div>\n                <div class="pv_tag_info_buttons_wrap"></div>\n              </div>\n              <div id="pv_tag_frame"></div>\n              <div id="pv_tag_faded"></div>\n              <div id="pv_tag_person" onmouseout="Photoview.hideTag()"></div>\n              <div class="pv_photo_tags" id="pv_photo_tags"></div>\n              <div class="pv_img_area_wrap pv_init_hover" onmouseleave="return Photoview.onImageWrapMouseLeave(event)" onmousedown="return Photoview.onImageWrapMouseDown(event)" onmousemove="Photoview.onImageWrapMouseMove(event)">\n                <div class="pv_img_progress_wrap">${g}</div>\n                <div id="pv_photo"></div>\n                \n      <div class="pv_nav_btn" id="pv_nav_btn_left" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex - 1, event);">\n        <div class="pv_nav_btn_icon"></div>\n      </div>\n      <div class="pv_nav_btn" id="pv_nav_btn_right" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex + 1, event);"><div class="pv_nav_btn_icon"></div></div>\n    \n                <div class="pv_like_fs_wrap">\n                ${v}\n                </div>\n              </div>\n            </div>\n            ${E}\n          </div>\n          ${m}\n        </div>\n        <div id="pv_albums_wrap" class="pv_white_bg photos_container_albums" style="${d}">${s}</div>\n        <div id="pv_album_wrap" class="pv_white_bg" style="${p}">${c}</div>\n        <div id="pv_vtagged_wrap" class="pv_white_bg" style="${l}">${r}</div>\n      </div>\n    </div>`,cur.pvYourComment&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domPN)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_your_comment")).replaceChild(cur.pvYourComment,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_your_comment")),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvCont:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(layer),pvBox:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_box"),pvImageAreaWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_img_area_wrap"),pvLeftWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_left_wrap"),pvTitle:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("box_title_wrap"),pvTitleText:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("box_title"),pvImageWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_image_wrap"),pvNavBtnLeft:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_nav_btn_left"),pvNavBtnRight:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_nav_btn_right"),pvNavBtnClose:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_close_btn"),pvNarrowColumnWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_narrow_column_wrap"),pvNarrowColumn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_narrow_column_cont"),pvPhotoWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_photo_wrap"),pvAlbumWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_album_wrap"),pvAlbumsWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_albums_wrap"),pvVTagsWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_vtagged_wrap"),pvPhotoTagsContainer:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_photo_tags"),pvTagInfo:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_tag_info"),pvTagFrame:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_tag_frame"),pvTagFaded:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_tag_faded"),pvTagPerson:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_tag_person"),pvPhoto:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_photo"),pvTagInfoText:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_tag_info_text"),pvTagInfoButtons:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_tag_info_buttons_wrap"),pvBottomInfo:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_bottom_info"),pvAlbumName:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_album_name"),pvCounter:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_counter"),pvBottomActions:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_bottom_actions"),pvBottomLeft:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_bottom_info_left"),pvNarrow:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_narrow"),pvWide:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_wide"),pvImgProgress:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_image_progress"),pvLikeFSWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_like_fs_wrap"),pvFSWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_fs_wrap"),pvFS:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs"),pvFSFg:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_fg"),pvActions:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pvs_actions"),pvYourComment:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_your_comment"),pvAddMedia:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_add_media")),pvMediaPreview:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_media_preview"),pvCommentSend:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comment_send"),pvComment:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comment")}),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(layerWrap,"scroll",Photoview.scrollResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(layerWrap,"mousemove",Photoview.onLayerMouseMove),Photoview.updateSize(),_&&_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_22__.default.init(!1,{parent:layerWrap});const w=layerWrap.scrollTop;layerWrap.scrollTop=w},doShowAlbums(_,e){if(_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(_),e&&(2==e.button||3==e.which))return;if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag(),!1!==e))return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e);let t=(cur.pvAlbumsData||{})[_];if(!t)return;Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),e&&e.pageX&&e.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldX:e.pageX,pvOldY:e.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)()}),cur.pvShown=!0,cur.pvAlbumsShown=_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pva_owner")!=_&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvaOffset:t.opts.offset,pvaCount:t.opts.count,pvaPhotosOffset:t.opts.photos_offset,pvaPhotosFeedOffset:t.opts.photos_feed_offset,pvaPhotosCount:t.opts.photos_count,pvShowAllAlbums:!1}),cur.pvLayerCreated?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pva_owner")!=_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)(cur.pvAlbumsWrap,t.html),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(cur.pvAlbumsWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvPhotoWrap,cur.pvAlbumWrap,cur.pvVTagsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvAlbumsWrap),Photoview.updateSize(),layerWrap.scrollTop=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pva_scroll"))):Photoview.createLayer(!0),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_22__.default.show(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvAlbumsWrap),cur.pvTitleText.innerHTML=t.opts.summary,cur.pvListId&&"temp"!=cur.pvListId?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex}):(!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.msie||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.version>8)&&(cur.pvClicked=!1),Photoview.toggleNavControls(),cur.pvListId=!1;const o=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(nav.objLoc,{z:"albums"+cur.pvAlbumsShown});return nav.strLoc!=nav.toStr(o)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(o)),Photoview.updatePeriods(),!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e)},jumpToAlbums(_){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="albums"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pva_owner")||cur.pvJumpTo.z!=nav.objLoc.z)?(_&&(cur.pvListId=!1),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_18__.showAlbums)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pva_owner"),{noHistory:!0})},jumpToAlbum(_){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="album"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_album")||cur.pvJumpTo.z!=nav.objLoc.z)?(_&&(cur.pvListId=!1),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_18__.showAlbum)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_album"),{noHistory:!0})},jumpToTagged(_){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="tag"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_tag")||cur.pvJumpTo.z!=nav.objLoc.z)?(cur.pvJumpTo.z=="tag"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_tag")&&(cur.pvJumpTo.z="photo_"+cur.pvJumpTo.z),_&&(cur.pvListId=!1),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Photoview.showTagged((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_tag"),{noHistory:!0})},doShowAlbum(_,e){if(e&&(2==e.button||3==e.which))return;if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag(),!1!==e))return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e);let t=(cur.pvAlbumData||{})[_];if(!t)return;Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),e&&e.pageX&&e.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldX:e.pageX,pvOldY:e.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)()}),cur.pvShown||cur.pvAlbumShown||cur.pvAlbumsShown||layerQueue.push(),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_22__.default.show(),cur.pvShown=!0,cur.pvAlbumShown=_,cur.pvLayerCreated&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_album")==_||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvsaOffset:t.opts.offset,pvsaCount:t.opts.count}),cur.pvLayerCreated?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_album")!=_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)(cur.pvAlbumWrap,t.html),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(cur.pvAlbumWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_scroll"))):Photoview.createLayer(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvAlbumWrap);const o=t.opts.author||"";if(cur.pvTitleText.innerHTML=(o?o+'<span class="divider"></span> ':"")+t.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});const _=(cur.pvListId||"").split("/");_[0]&&Photoview.showRepeat((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)(_[0]))}else(!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.msie||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;const i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(nav.objLoc,{z:"album"+cur.pvAlbumShown});return nav.strLoc!=nav.toStr(i)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(i)),!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e)},doShowTagged(_,e){if(_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(_),e&&(2==e.button||3==e.which))return;if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag(),!1!==e))return!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e);const t=(cur.pvPhotoTagData||{})[_];if(!t)return;if(Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),e&&e.pageX&&e.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldX:e.pageX,pvOldY:e.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)()}),cur.pvShown=!0,cur.pvPhotoTagShown=_,cur.pvLayerCreated&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_tag")==_||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvsaOffset:t.opts.offset,pvsaCount:t.opts.count}),cur.pvLayerCreated?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_tag")!=_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)(cur.pvAlbumWrap,t.html),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(cur.pvAlbumWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_scroll"))):Photoview.createLayer(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvAlbumWrap),cur.pvTitleText.innerHTML=t.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});const _=(cur.pvListId||"").split("/");_[0]&&Photoview.showRepeat((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)(_[0]))}else(!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.msie||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;const o=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(nav.objLoc,{z:"photo_tag"+cur.pvPhotoTagShown});return nav.strLoc!=nav.toStr(o)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(o)),!!e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e)},toggleNavControls(_){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)([cur.pvNavBtnRight,cur.pvNavBtnLeft,cur.pvNavBtnClose],(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(this)})),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.isString)(_)&&(_=_.split(" ")),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)(_||[],(function(_,e){switch(e){case"close":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvNavBtnClose);break;case"left":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvNavBtnLeft);break;case"right":(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvNavBtnRight)}}))},getPhotoSize(){let _;switch(cur.pvVeryBig){case 3:_="w";break;case 2:case 1:_="z";break;default:_="y"}return _},show(_,e,t,o){if(cur.pvEditorMode)return;if(cur.pvAttachedProducts=cur.pvAttachedProducts||{},cur.pvAttachedProducts.badges&&cur.pvAttachedProducts.badges.forEach((_=>_.remove())),t&&(2==t.button||3==t.which))return;if(cur.cancelClick)return void delete cur.cancelClick;if(Photoview.destroyPeriod(),clearTimeout(window.__pvhideTimer),"temp"==_&&cur.pvShown){if(cur.pvListId&&"temp"!=cur.pvListId)return;cur.pvWasShown=!0}else cur.pvWasShown=!1;if(__afterFocus)return!!t&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag(),!1!==t))return!!t&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(t);if(!1===_){if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown){if(cur.pvOldListId)return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvJumpTo:cur.pvOldJumpTo,pvJumpFrom:cur.pvOldJumpFrom,pvJumpSteps:cur.pvOldJumpSteps}),e==cur.pvOldIndex+1&&++cur.pvOldIndex,Photoview.show(cur.pvOldListId,cur.pvOldIndex,t,o);Photoview.toggleNavControls()}_=cur.pvListId}const i=((cur.pvData||{})[_]||{}).length;let s=_!=cur.pvListId;if(!i)return;t&&t.pageX&&t.pageY&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)()}),(cur.pvOptions||{}).queue&&(layerQueue.push(),cur.pvOptions.queue=!1,cur.pvHistoryLength=0),Photoview.checkLayerVisibility()||(s=!0);const r=e+(e<0?i:e>=i?-i:0),a=s?1:cur.pvIndex>e?-1:1;if(!s&&!cur.pvCanvas){if(cur.pvJumpTo){cur.pvJumpSteps+=e-cur.pvIndex;if(r===cur.pvJumpFrom&&cur.pvJumpSteps>=i)return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvOldJumpFrom:cur.pvJumpFrom,pvOldJumpSteps:cur.pvJumpSteps-(e-cur.pvIndex),pvOldJumpTo:cur.pvJumpTo}),Photoview.jumpToAlbums(cur.pvJumpSteps<0);if(a>0&&(r<cur.pvJumpFrom&&r+4>cur.pvJumpFrom||r<cur.pvJumpFrom+i&&r+4>cur.pvJumpFrom+i)){(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)().src=window.stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":"")+".png?3";const _=cur.pvJumpTo.z.match(/^albums(-?\d+)$/);_&&(cur.pvAlbumsData||(cur.pvAlbumsData={}),cur.pvAlbumsData[_[1]]||(cur.pvAlbumsData[_[1]]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:_[1],other:1},{onDone:Photoview.loadedAlbums})))}cur.pvJumpSteps<=-i&&(cur.pvJumpSteps+=i)}if(1==i&&e!=cur.pvIndex&&("temp"!=_||cur.pvOptions.temp_final))return Photoview.hide(),!!t&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(t)}s&&"temp"!=_&&(!1===cur.pvJumpFrom&&(cur.pvJumpFrom=r),cur.pvRoot=o,Photoview.updateLocNav()),e=r;const n=cur.pvData[_][e];if(!n||!n.x_&&!n.x_src)return;cur.pvIndex=e,cur.pvShown=!0,cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1,cur.pvListId=_,Photoview.calculateVeryBig();const d=Photoview.getPhotoSize();return cur.pvCurData=Photoview.genData(n,d),cur.pvLayerCreated||Photoview.createLayer(),cur.pvCurrent&&(cur.pvCurrent.onload=Photoview.blankf,cur.pvCurrent.src=Photoview.blank),delete cur.pvCurrent,cur.pvCurrent=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)(),cur.pvCurrent.onload=Photoview.preload.pbind(e,a),cur.pvCurrent.src=cur.pvCurData.src,s&&Photoview.toggleNavControls(i>1?"left right close":"close"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.hideProgress)(cur.pvCounter),"temp"!=_||cur.pvOptions.temp_final?"temp"==_&&cur.pvOptions.temp_final&&cur.pvOptions.temp_summary||(cur.pvCounter.innerHTML=i>1?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_photo_counter_num_of_N").replace("%s",cur.pvIndex+1).replace(/%s|{count}/,i):""):(((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(cur.pvCurData)||cur.pvCurData.restrictionGeo)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvImgProgress),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.showProgress)(cur.pvCounter,"","pr_baw")),cur.pvCurPhoto=n,cur.pvCurData.width&&cur.pvCurData.height?Photoview.doShow():(cur.pvCurData=cur.pvCurrent,cur.pvTimerPassed=0,clearTimeout(cur.pvTimer),cur.pvTimer=setTimeout(Photoview.doShow,0)),cur.pvBox&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown),!!t&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(t)},_checkWebGL:()=>navigator.userAgent.indexOf("Windows NT 5.1")>=0?-1:function(){try{const _=document.createElement("canvas");_.width=_.height=100;const e={preserveDrawingBuffer:!0,premultipliedAlpha:!1};return!!window.WebGLRenderingContext&&(_.getContext("webgl",e)||_.getContext("experimental-webgl",e))}catch(_){return!1}}()?1:_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.safari?((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.debugLog)("photo editor: webgl enable needed"),-2):((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.debugLog)("photo editor: webgl not suported"),-1),openEditor(_,e){function t(t){return t||(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.debugLog)("photo editor: CORS not available ("+e+")"),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showBox)("al_photos.php",{act:"edit_photo",photo:_||cur.pvData[cur.pvListId][cur.pvIndex].id,webgl:Photoview._checkWebGL(),cors:t},{stat:["ui_controls.css","ui_controls.js"]})}e=e||cur.pvCurData.src;const o=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)();o.onerror=()=>t(0),o.onload=()=>t(1),o.crossOrigin="",o.src=e},showReportPhotoForm(){if(cur.pvCurPhoto.reported)return;const[_,e]=Photoview._getViewedPhotoFullId().split("_");(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_33__.showReportForm)("photo",_,e,(()=>{cur.pvCurPhoto.reported=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_more_act_spam"),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_report_sent"))}))},showReportPhotoCommentForm(_,e){(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_33__.showReportForm)("photo_comment",_,e,(()=>(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_33__.afterCommentReportSubmit)("photo",_,e)))},hideLoadProgress(_){if(_){const e=_.currentSrc;if(e&&(_.naturalHeight<=50||_.naturalWidth<=50)){const _=new Image;_.onload=function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvImgProgress)},_.src=e}}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvImgProgress);Photoview.setInitialFocus()},doShow(){const _=cur.pvCurData;if((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(_)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvImgProgress),(!_.width||!_.height)&&cur.pvTimerPassed<5e3)return clearTimeout(cur.pvTimer),cur.pvTimerPassed+=100,void(cur.pvTimer=setTimeout(Photoview.doShow,100));if(!cur.pvShown)return;if(cur.pvCanvas)return void Photoview.pvCanvasSet();function e(_){let e="";if((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(_)){let t="";if(_.restrictionButton){t=`<button class="ZPhotosRestriction__button" onMouseDown="${`event.stopPropagation(); Page.unblurPhoto('${_.photoRaw}', '${_.unblurHash}', this);`}">${_.restrictionButton}</button>`}e=`<div class="ZPhotosRestriction__title">${_.restrictionTitle||" "}</div><div class="ZPhotosRestriction__text">${_.restrictionText}</div>${t}`}_.restrictionGeo&&(e=`<div class="ZPhotosRestriction__title">${_.restrictionText||" "}</div>`),cur.pvPhoto.innerHTML='<img tabindex="0" src="'+(_.src||"/images/blank.gif")+'" />'+e,Photoview.hideLoadProgress(cur.pvPhoto&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvPhoto))}Photoview.toggleLightModeClass(!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(cur.pvAlbumsWrap)&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pva_scroll",layerWrap.scrollTop),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvAlbumsWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvPhotoWrap),Photoview.updateSize()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(cur.pvAlbumWrap)&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_scroll",layerWrap.scrollTop),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvAlbumWrap),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvPhotoWrap),Photoview.updateSize()),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_22__.default.hide(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--geo",!!_.restrictionGeo),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--blur",(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(_));const t=cur.pvPhoto&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvPhoto);if(t&&t.src){const o=/https?:\/\/[a-z0-9\.\-]+/;(t.src.replace(o,"")!=_.src.replace(o,"")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hasClass)(t,"ZPhotosRestriction")||_.restrictionGeo||_.restrictionBlur)&&e(_)}else e(_);if(Photoview.hideLoadProgress(t),Photoview.updatePhotoDimensions(),window.tooltips&&tooltips.destroyAll(cur.pvBox),"temp"==cur.pvListId)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvCommentsData),Photoview.toggleOnPhotoControls(!1),void Photoview.updateVerticalPosition();Photoview.toggleOnPhotoControls(!0);const o=cur.pvCurPhoto;if(o.peData)return o.closeOnPEEdit=!0,void Photoview.openStickersEditor(o);const i="NFT"===o.album,s=!(o.commshown>=0)&&-o.commshown||i;cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag(),Photoview.hideTag(!0),(_.width<200||_.height<200)&&(o.actions.dialog=!1);let r="";("NA"!=o.album&&2!=s||o.graffiti)&&(r=o.album);const a=!o.album||!o.author;if(!cur.pvIsLightMode&&!a){let _="";_+='<div class="pv_author_block clear_fix">';let e="";"NA"!=o.author&&(e=o.author),e&&(o.author_href&&(_+=`<a class="pv_author_img fl_l" href="${o.author_href}">`),_+=`<div class="ow_ava ow_ava_comm" style="background-image: url('${o.author_photo}');"></div>`,o.author_href&&(_+="</a>")),_+=`\n        <div class="pv_author_info">\n          <div id="pv_author_name">${e}</div>\n          <div class="pv_date_info_wrap">\n            <span id="pv_date_info">${o.date}</span>\n          </div>\n        </div>\n      </div>`;const t=cur.pvCommsLikes[o.id],r=t[0],a=t[1];if(!i){_+=(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_6__.getProgressHtml)("pv_progress"),_+=Likes.makeTemplate(o.likes_tpl,{object_raw:o.id,likes_count:a||"",liked:o.liked,share_count:o.shares||"",share_opts:{list:cur.pvListId,to:"mail"}});const e=1&o.actions.edit||o.desc;let t="";if(e){const _=o.desc||`<span class="pv_desc_edit">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_edit_desc")}</span>`;let e="";1&o.actions.edit?(e+='class="pv_can_edit pv_desc_cont"',e+='onclick="Photoview.editInline(event)"'):e+='class="pv_desc_cont"',t=`<div ${e}>${_}</div>`}1==o.was_edited?_+=`<div id="pv_edit_info" class="pv_right_block">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_was_edited")}</div>`:o.was_edited&&(_+=`\n          <div id="pv_edit_info" class="pv_right_block" onmouseover="showTooltip(this, {\n            text: '${o.was_edited}',\n            black: 1\n          });">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_was_edited")}</div>`),_+='<div id="pv_desc" class="pv_right_block" style="'+(e?"":"display: none")+'">'+t+"</div>"}if(o.nft?.enabled){const{nft_collection:e,nft_owner_id:t,nft_public_id:s,title:r,nft_owner_name:a}=o.nft;let n="";const d=e?.is_verified?'<div class="NftInfoBanner__checkmark">'+(0,_icons_desktop__WEBPACK_IMPORTED_MODULE_43__.getIcon16Verified)().icon+"</div>":"";n=`\n          <div class="NftInfoBanner__collection">\n            <div class="NftInfoBanner__collectionName">${e?.name||`${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photo_nft_token_owner")}: ${a||"-"}`}</div>${d}\n          </div>\n        `,_+=`\n<div class="NftInfoBanner ${i?"NftInfoBannerOnly":""} pv_right_block" onclick="Photoview.showNftTokenDetails('${t}_${s}')">\n  <div class="NftInfoBanner__thumb">\n    <img class="NftInfoBanner__thumbImg" src="${cur.pvCurData.src}" alt="NFT image thumbnail"/>\n    <div class="NftInfoBanner__highlight"></div>\n  </div>\n  <div class="NftInfoBanner__info">\n    <div class="NftInfoBanner__logoBlock">\n      ${(0,_icons_desktop__WEBPACK_IMPORTED_MODULE_44__.getIcon16NftHeptagonOutline)().icon}\n      <span class="NftInfoBanner__logoText">NFT</span>\n    </div>\n    <div class="NftInfoBanner__tokenName">${(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_38__.encodeHTMLEntities)((0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_38__.unescape)(r))}</div>\n    ${n}\n  </div>\n</div>`}if(!i){_+='<div id="pv_attached_products_list"></div>',_+='<div id="pv_microdata">'+(o.microdata_html?o.microdata_html:"")+(o.microdata_preview_button?o.microdata_preview_button:"")+"</div>",o.microdata_html&&(0,_web_lib_market__WEBPACK_IMPORTED_MODULE_1__.shortCurrency)();_+='<div id="pv_tags"'+(o.tagshtml?"":' style="display: none"')+' class="pv_right_block">'+_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_onthisphoto")+": "+o.tagshtml+"</div>";_+='<div id="pv_place" class="pv_right_block">'+(o.place?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+o.place+"</a>":"")+"</div>",_+=r.tagName?'<div id="pv_comments_place"></div>':(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.trim)(r),cur.pvReplyForm&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(cur.pvReplyForm),cur.pvReplyForm=null,_+='<div id="pv_rotate"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>'}cur.pvNarrow.innerHTML="",Photoview.updateRightBlock(),cur.pvNarrow.innerHTML=_,window.Likes.update(`photo${o.id}`,{like_my:o.liked,like_num:a||""});const[n,d]=Photoview.generateMarketList(o.attached_tags.tags);o.attached_tags.tags&&o.attached_tags.tags.length&&document.getElementById("pv_attached_products_list").appendChild(n),cur.pvImageAreaWrap.appendChild(d);const l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_closed_commments_placeholder"),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_no_commments_placeholder");if(s||!o.actions.comm?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(l,"unshown"),s&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(c,"unshown")):o.reply_form&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(l,"unshown"),o.replyFormEl=cur.pvReplyForm=o.replyFormEl||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.se)(o.reply_form),cur.pvNarrowColumn.appendChild(cur.pvReplyForm),cur.onReplyFormSizeUpdate=cur.onMediaChanged=_=>{cur.pvShown&&Photoview.updateRightBlock()},cur.onReplyFormFocus=()=>{Photoview.updateRightBlock(!0),cur.pvNarrowScrollbar.scrollBottom(0,!0)}),r.tagName){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("page_gif_loading",r),(()=>{Page.hideGif(this,!1)}));const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments_place");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domPN)(_).replaceChild(r,_)}if(cur.pvNarrowScrollbar=new uiScroll(cur.pvNarrow,{global:!0}),o.reply_form){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("reply_field",cur.pvNarrowColumn);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.data)(_,"send",Photoview.sendComment),(0,_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_5__.placeholderInit)(_,{editable:1}),cur.pvOptions.commentFocusInit){delete cur.pvOptions.commentFocusInit;const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("submit_post_field",cur.pvReplyForm);_&&_.focus()}}cur.editing=!1,Photoview.updateRightBlock()}let n=[];if(r=r||"",cur.pvAlbumName.innerHTML=r,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggle)(cur.pvBottomInfo,!cur.pvIsLightMode||cur.pvShowBottomActions||r),i||(vk.id&&o.actions.share&&n.push(`<button id="pv_share" onclick="Photoview.sendPhoto()">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_share_from_view")}</button>`),!o.taginfo&&o.actions.tag&&o.tags[0]<cur.pvMaxTags&&!(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(o)&&n.push(`\n          <button id="pv_tag_link" onclick="stManager.add([jsc('web/photo_tagger_mode.js'), 'tagger.css', jsc('web/tagger.js')], () => {\n            Phototag.startTag();\n          })">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_tagperson")}</button>`),o.actions.del&&n.push(`<button id="pv_delete" onclick="Photoview.deletePhoto()">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_delete")}</button>`),o.actions.save&&n.push(`<button id="pv_save_to_me" onclick="Photoview.savePhoto()">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_save")}</button>`)),cur.pvShowBottomActions&&!a){let _=[];if(o.actions.spam){const e=cur.pvCurPhoto.reported?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_report_sent"):_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_report");_.push(["spam",e,"Photoview.showReportPhotoForm()"]),_.push("sep")}if(o.actions.forbid){const e=Photoview._getViewedPhotoFullId().split("_"),t=e[0],o=e[1],i=1;_.push(["atfr",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("reports_atfr"),"sfof("+t+", "+o+", "+i+")"])}if(o.actions.strike){const e=Photoview._getViewedPhotoFullId().split("_"),t=e[0],o=e[1],i=2;_.push(["strike",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("reports_strike_system_delete_with_reason"),"ssfof("+t+", "+o+", "+i+", 0, '')"])}if(o.actions.blur){const e=Photoview._getViewedPhotoFullId().split("_"),t=e[0],o=e[1];_.push(["b",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("reports_b"),"scblf('photo', "+t+", "+o+")"])}if(!i){if(o.actions.geoBlock){const e=Photoview._getViewedPhotoFullId().split("_"),t=e[0],o=e[1];_.push(["gb",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("reports_gb"),"scgbf('photo', "+t+", "+o+")"])}if(o.actions.edit&&(o.peType&Photoview.PE_V1||o.peType&Photoview.PE_V2)&&_.push(["pe",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_photoeditor"),"Photoview.openEditor()"]),vk.id&&o.actions.pe&&o.peType&Photoview.PE_V3&&(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_18__.isPhotoeditor3Available)()&&!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.inArray)(nav.objLoc[0],["support","helpdesk"])&&!o.restrictionGeo&&!(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(o)){const e=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__.partConfigEnabled)("web_photo_editor_hide_entrypoint")?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_photoeditor"):_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_pe_edit");_.push(["spe",e,"Photoview.openStickersEditor()"])}if(o.actions.rotate?(_.push(["rotate_ccw",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_rotate_ccw"),"Photoview.rotatePhoto(-1)"]),_.push(["rotate_cw",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_rotate_cw"),"Photoview.rotatePhoto(1)"]),_.push("sep")):o.actions.rot&&(_.push(["rotate_ccw",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_rotate_ccw"),"Photoview.rotatePhotoOld(-1)"]),_.push(["rotate_cw",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_rotate_cw"),"Photoview.rotatePhotoOld(1)"]),_.push("sep")),o.actions.place&&_.push(["place",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_edit_add_place"),"Photoview.editPlace()"]),o.attached_tags&&o.attached_tags.hash){const e=`<div class="pv_more_act_item_icon">${(0,_icons_desktop__WEBPACK_IMPORTED_MODULE_45__.getIcon16Market)().icon}</div>`;_.push(["market",`${e} ${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_edit_add_market")}`,"Photoview.selectProductInBox()"])}if(o.actions.prof&&o.profile_data){const e=JSON.stringify({...o.profile_data,width:o.width,height:o.height});_.push(["to_profile",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_to_avatar"),"","",`data-task-click='Page/owner_set_exist_photo' data-options='${e}'`])}if(o.actions.dialog&&_.push(["to_dialog",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_load_to_dialog"),`showBox('al_page.php', {act: 'owner_photo_edit', photo: '${o.id}', oid: ${o.actions.dialog}, list: '${cur.pvListId}'}, {stat: ['owner_photo.css', jsc('web/owner_photo.js'), 'tagger.css', jsc('web/tagger.js')]});`]),o.actions.move){const e=o.id.split("_")[0];_.push(["move_to",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_move_to_album"),`\n            showBox('al_photos.php', {act: 'a_move_to_album_box', photo_id: '${o.id}', owner_id: ${e}}, {stat: ['${window.jsc("web/page.js")}', 'page.css', '${window.jsc("web/wide_dd.js")}', 'wide_dd.css']})\n          `]),o.actions.cover&&_.push(["as_title",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_album_to_cover"),`\n              ajax.post('al_photos.php', {act: 'a_set_as_album_title', photo: '${o.id}', hash: '${o.hash}'}, {onDone: showDoneBox})\n            `])}}let e="";(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)(_,((t,o)=>{"sep"===o?0!==t&&t!==_.length-1&&(e+='<div class="pv_more_act_item_sep"></div>'):e+=`\n              <button class="pv_more_act_item" onmouseover="${o[3]||""}" onclick="${o[2]||""}" id="pv_more_act_${o[0]}" ${o[4]||""}>\n                ${o[1]}\n              </button>\n            `})),o.restrictionGeo||(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(o)||(e+=`<a\n          class="pv_more_act_item"\n          id="pv_more_act_download"\n          target="_blank"\n          rel="noopener"\n          href="${Photoview.genData(o,"w").src}\n        ">\n            ${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_open_original")}\n        </a>`),e=`<div class="pv_more_acts">${e}</div>`,_.length?(_=JSON.stringify(_),_=_.replace(/\"/g,"&quot;"),n.push(`<button class="pv_actions_more" data-items="${_}">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_actions_more")}</button>`)):(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.inArray)(nav.objLoc[0],["support","helpdesk"])&&n.push(`\n            <a id="pv_more_act_download" target="_blank" rel="noopener" href="${Photoview.genData(o,"w").src}">\n              ${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_open_original")}\n            </a>\n          `),n=n.join('<span class="divider"></span>'),cur.pvIsLightMode&&(n+='<div id="pv_rotate" style="display:none;"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>'),cur.pvBottomActions.innerHTML=n;const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_actions_more");t&&(cur.pvMoreActionsTooltip=new ElementTooltip(t,{id:"pv_more_acts_tt",forceSide:"top",elClassWhenShown:"pv_more_shown",content:e,offset:[0,-5],autoShow:!0,showOnKeyboard:!0,noHideOnClick:!0}))}if(Photoview.updatePhotoDimensions(),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvTagLink:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_tag_link"),pvLikeIcon:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_like_icon"),pvLikeLink:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_like_link"),pvDesc:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_desc"),pvTags:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_tags"),pvEditing:!1,pvProgress:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_progress")}),o.deleted||!o.author)(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.isArray)(o.deleted)&&Photoview.toggleTopInfoPanel(o.deleted[0],o.deleted[1]),a||Photoview.toggleDeletedState(!0);else if(o.taginfo){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");const _=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButton.render({children:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_confirm_tag"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonAppearance.PRIMARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonSize.M,restAttrs:{id:"pv_confirm_tag",onclick:`Photoview.confirmTag(${o.tagid}, this)`}}),e=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButton.render({children:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_delete_tag"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonAppearance.SECONDARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonSize.M,className:"PhotoViewTopPanel__button--dark",restAttrs:{id:"pv_delete_tag",onclick:`Photoview.deleteTag(${o.tagid}, this)`}});Photoview.toggleTopInfoPanel(o.taginfo,[_,e]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvCommentsData)}else o.suggestedTagsInfo?Photoview.showSuggestedInfoTopPanel(o):(Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1));(cur.pvOptions||{}).scroll&&cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollTop(cur.pvOptions.scroll),cur.pvBodyScrollTop=document.body.scrollTop,setTimeout((function(){void 0!==cur.pvBodyScrollTop&&(document.body.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop)}),0),Photoview.updateVerticalPosition();const d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvPhoto);cur.pvPhotoTags?cur.pvPhotoTags.reload(d):vk.id&&(cur.pvPhotoTags=new _photo_tags__WEBPACK_IMPORTED_MODULE_16__.default(d,cur.pvPhotoTagsContainer)),setTimeout(Photoview.afterShow,2)},toggleTopInfoPanel(_,e){const t=!!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.isString)(_)||!!_;void 0!==_&&(cur.pvTagInfoText.innerHTML=_),void 0!==e&&(Array.isArray(e)||(e=[e]),cur.pvTagInfoButtons.innerHTML="",e.forEach((_=>{_ instanceof HTMLButtonElement?cur.pvTagInfoButtons.append(_):cur.pvTagInfoButtons.innerHTML+=_}))),cur.pvTagInfo.classList.toggle("PhotoViewTopPanel--show",t),Photoview.updatePhotoTagsContainerDimensions(),Photoview.updatePhotoDimensions()},toggleDeletedState(_){_=!!_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvCont,"pv_deleted_state",_),Photoview.updateRightBlock()},showSuggestedInfoTopPanel(_){if(!(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__.partConfigEnabled)("photo_recognition_web")||!_.suggestedTagsInfo)return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");const e=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.getPhotoData)("suggested_tags");if(!e)return;const t=Object.keys(e);if(!t.length)return;let o="",i="";if(t.length>1)o=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photo_tag_confirm_all"),i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photo_recognition_decline_all");else{e[t[0]][4]===vk.id?(o=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photo_recognition_item_confirm_me"),i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photo_recognition_item_decline_me")):(o=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_confirm_tag"),i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_delete_tag"))}const s=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButton.render({children:o,appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonAppearance.PRIMARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonSize.M,restAttrs:{id:"pv_confirm_suggested_tags",onclick:"Photoview.confirmAllSuggestedTags(this)"}}),r=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButton.render({children:i,appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonAppearance.SECONDARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonSize.M,className:"PhotoViewTopPanel__button--dark",restAttrs:{id:"pv_decline_suggested_tags",onclick:"Photoview.declineAllSuggestedTags(this)"}});Photoview.toggleTopInfoPanel(_.suggestedTagsInfo,[s,r])},updatePhotoTagsContainerDimensions(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvPhoto);if(!e)return;_||(_=e.offsetWidth);const t=e.offsetLeft,o=e.offsetTop;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvPhotoTagsContainer,{top:o+"px",left:t+"px",width:_+"px"})},updateTagFrameDimensions(_,e,t){const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvPhoto);if(!o)return;const i=o.offsetLeft,s=o.offsetTop;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvTagFaded,{width:cur.pvPhWidth+"px",height:cur.pvPhHeight+"px",left:i+"px",top:s+"px"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvTagFrame,{left:i+"px",top:s+"px"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvTagPerson,{left:i+"px",top:s+"px"}),_&&e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvTagFrame),{width:_,height:e,marginTop:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(t)})},afterShow(){cur.pvPhoto.href="/photo"+cur.pvCurPhoto.id,4&cur.pvCurPhoto.actions.edit&&1&cur.pvCurPhoto.actions.edit&&!cur.pvCurPhoto.desc&&Photoview.editInline(),cur.pvTagFrame.innerHTML='<img tabindex="0" src="'+(cur.pvCurData.src||"/images/blank.gif")+'" />',Photoview.updateTagFrameDimensions(),(cur.pvOptions||{}).scroll&&(layerWrap.scrollTop=cur.pvOptions.scroll,cur.pvOptions.scroll=0),Photoview.updateLoc(),Photoview.updatePhotoDimensions(),cur.pvOptions.onChange&&cur.pvOptions.onChange()},pvCanvasUpdate(_){const e=cur.pvCurData;if(!(cur.pvCanvas&&e&&e.width&&e.height))return;cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight;let t=e.width||604,o=e.height||453,i=cur.pvScrWidth/t,s=0;const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_fade")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_wrap"),a=r&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(r);o*i>cur.pvScrHeight&&(i=cur.pvScrHeight/o),i>1.25&&(i=1.25),t=Math.floor(t*i),o=Math.floor(o*i),s=Math.floor((cur.pvScrHeight-o)/2),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(a,"ZPhotosRestriction--geo",!!e.restrictionGeo),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(a,"ZPhotosRestriction--blur",(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(e));let n="";n=e.restrictionGeo?`<div class="ZPhotosRestriction__title">${e.restrictionText||" "}</div>`:(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.isImgBlurred)(e)?`<div class="ZPhotosRestriction__title">${e.restrictionTitle||" "}</div>`:"",a.innerHTML!==n&&(a.innerHTML=n),(cur.pvFSWidth!=t||cur.pvFSHeight!=o||cur.pvFSTop!=s||_)&&(cur.pvFSWidth=t,cur.pvFSHeight=o,cur.pvFSTop=s,a&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(a,{marginTop:s,width:t,height:o}),a.style.backgroundImage=`url('${e.src}')`))},pvCanvasSet(){const _=cur.pvCurData;if(!cur.pvCanvas||!_)return;let e;const t=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)(),o=()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_fade")&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)("pv_fs_img_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_fade").id="pv_fs_img_wrap")};o(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_wrap"))&&cur.pvSlideNeedAnimation?(cur.pvSlideNeedAnimation=!1,cur.pvCanvas.insertBefore((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.se)(`<div id="pv_fs_img_fade"><div style="background-image: url('${_.src}')" /></div>`),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_wrap")),e=()=>{(0,_web_lib_legacy__WEBPACK_IMPORTED_MODULE_11__.cssAnim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_wrap"),{opacity:0},{duration:1e3},(()=>{o(),Photoview.fullscreenOnLoad()})),(0,_web_lib_legacy__WEBPACK_IMPORTED_MODULE_11__.cssAnim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_fade"),{opacity:1},{duration:1e3})}):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_fs_img_wrap"),`<div style="background-image: url('${_.src}')" /></div>`),e=Photoview.fullscreenOnLoad),Photoview.pvCanvasUpdate(!0),t.onload=e,t.src=_.src,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_14__.FullscreenPV.updateInfo()},updateLoc(){let _;const e=cur.pvListId;cur.pvRoot?(_={0:"photo"+cur.pvCurPhoto.id},"photos"==e.substr(0,6)?_.all=1:"tag"==e.substr(0,3)?_.tag=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(e.substr(3)):"newtag"==e.substr(0,6)&&(_.newtag=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(e.substr(6))),-1!=e.indexOf("/rev")&&(_.rev=1),(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_28__.isClaimContent)()&&(_.claim=window.nav.objLoc.claim,_.dmcah=window.nav.objLoc.dmcah)):_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(nav.objLoc,{z:"photo"+cur.pvCurPhoto.id+"/"+(cur.pvCurPhoto.list_override||e)}),nav.strLoc!=nav.toStr(_)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(_),(cur.pvOptions||{}).fromQueue&&(cur.pvNoHistory=!0,cur.pvHistoryLength=0)),cur.pvOptions&&(cur.pvOptions.fromQueue=!1)},canFullscreen(){const _=_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser,e=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.floatval)(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.version);return!_.mobile&&(document.fullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||_.safari&&e>5)},fullscreenOnLoad(){_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_14__.FullscreenPV.slide()},fullscreenEnd(_){const e=cur.pvCanvas;e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(e),clearTimeout(cur.pvFSTimer),clearTimeout(cur.pvFSControlsTimer),cur.pvCanvas=cur.pvFSControls=cur.pvFSTimer=cur.pvFSControlsTimer=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(document,"webkitfullscreenchange mozfullscreenchange fullscreenchange webkitfullscreenerror mozfullscreenerror fullscreenerror"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(pageNode),cur.pvCanvasUpdateTO&&clearInterval(cur.pvCanvasUpdateTO),void 0!==cur.pvScrWasY&&((0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollToY)(cur.pvScrWasY,0),delete cur.pvScrWasY),!0!==_&&(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex)))},fullscreen(_){if(cur.pvCanvas||cur.pe)return;const e=cur.pvCanvas=document.body.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{className:"fixed",id:"pv_fullscreen",innerHTML:'<div id="pv_fs_img_wrap"></div>'})),t=e.requestFullscreen||e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;cur.pvFinishing=!1,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_14__.FullscreenPV.init(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(document,"webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",Photoview.onFullscreen),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(document,"webkitfullscreenerror mozfullscreenerror MSFullscreenError fullscreenerror",Photoview.fullscreenEnd.pbind(!0));try{t.call(e)}catch(_){cur.pvPartScreen=!0,Photoview.onFullscreen()}return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(_)},fullscreenStop(_){cur.pvFinishing=!0===_,cur.pvPartScreen=!1;const e=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen;try{e.call(document)}catch(_){Photoview.onFullscreen()}setTimeout(Photoview.fullscreenEnd,30)},onFullscreen(){(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_28__.isFullScreen)()?(cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag(),cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight,cur.pvScrWasY=(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollGetY)(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(pageNode),cur.pvCanvasUpdateTO=setInterval(Photoview.pvCanvasUpdate.pbind(!1),100),cur.pvFinishing||(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex))):Photoview.fullscreenEnd(cur.pvFinishing)},showDD(_,e){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hasClass)(_,"pv_report_blocked")&&e&&(clearTimeout(cur.hideShareTimer),_.blur(),!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hasClass)(e,"pv_dd_hiding"))){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(e))return(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.fadeIn)(e,0);cur.ddShown&&Photoview.hideDD(0),cur.ddShown=e,setTimeout(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent.pbind(document,"click",Photoview.hideDD),1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(e)}},hideDD(_){if(_>0)return void(cur.hideShareTimer=setTimeout(Photoview.hideDD.pbind(0),_));const e=cur.ddShown;e&&(-1==_?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(e):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(e,"pv_dd_hiding"),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.fadeOut)(e,200,(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(e,"pv_dd_hiding")}))),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(document,"click",Photoview.hideDD),cur.ddShown=!1)},createDD:(_,e)=>`\n      <div onmouseover="Photoview.showDD(this.previousSibling, this);" onmouseout="Photoview.hideDD(500)" onclick="Photoview.hideDD(-1)" class="pvs_dd fixed">\n        <table cellspacing="0" cellpadding="0">\n          <tr>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n            <td>\n              <div class="pvs_header_wrap">\n                <div class="pvs_header">\n                  <span class="pvs_header_text">${e}</span>\n                </div>\n              </div>\n              <div class="pvs_acts">${_}</div>\n              <div class="pvs_sh1"></div>\n              <div class="pvs_sh2"></div>\n            </td>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n          </tr>\n        </table>\n       </div>\n    `,showShare(){clearTimeout(cur.hideShareTimer);const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pvs_dd");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_share").blur(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(_))return(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.fadeIn)(_,0);setTimeout(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent.pbind(document,"click",Photoview.hideShare),1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(_)},hideShare(_){if(_>0)return void(cur.hideShareTimer=setTimeout(Photoview.hideShare.pbind(0),_));const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pvs_dd");e&&(-1==_?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(e):(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.fadeOut)(e,200),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(document,"click",Photoview.hideShare))},savePhoto(){const _=cur.pvListId,e=cur.pvData[_][cur.pvIndex];ajax.post("al_photos.php",{act:"save_me",photo:e.id,list:_,hash:e.hash},{onDone:()=>{const _=document.getElementById("pv_save_to_me");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domPN)(_).replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{className:"pv_save_to_me_saved",innerHTML:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_save_saved")}),_),e.actions.save=0},onFail:_=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_error"),_),!0)})},sendPhoto(){const _=cur.pvListId,e=cur.pvIndex,t=cur.pvData[_][e];(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showBox)("like.php",{act:"publish_box",object:"photo"+t.id,list:_,to:"mail"},{stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")]})},moveToAlbumBox:(_,e,t)=>!(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showBox)("al_photos.php",{act:"a_move_to_album_box",photo_id:_+"_"+e,owner_id:_,from:t},{stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css"]}),moveToAlbum(_,e,t){ajax.post("al_photos.php",{act:"a_move_photo",photo:_,album_id:e,hash:t},{onDone:_=>{(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)().hide();const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_album_name");e&&(e.innerHTML=_),cur.pvCurPhoto.album=_,(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.showDoneBox)('<div class="pv_done_box">'+_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_move_to_album_success").replace("{album}",_)+"</div>")}})},setTags(_){Photoview.hideTag(),_?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvTags),window.tooltips&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("delete",cur.pvTags),(()=>{tooltips.destroy(this)})),cur.pvTags.innerHTML=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_onthisphoto")+": "+_):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvTags)},preload(_,e){window.updateWndVScroll&&updateWndVScroll();const t=cur.pvListId,o=((cur.pvData||{})[t]||{}).length;if(!o)return;const i=cur.pvVeryBig>2?"w":cur.pvVeryBig?"z":"y",s=cur.pvVeryBig>1||cur.pvVeryBig?"z":"y",r=cur.pvVeryBig>1?"z":cur.pvVeryBig?"y":"x",a=cur.pvVeryBig>1?"y":cur.pvVeryBig?"x":0;cur.pvLastFrom=_,cur.pvLastDirection=e;const n=Photoview.allSizes;for(let i=0;i<Math.min(Photoview.cacheSize,o-Photoview.cacheSize);++i){let s=_+(i+1)*-e;for(;s>=o;)s-=o;for(;s<0;)s+=o;const r=cur.pvData[t][s];if(r)for(let _=0,e=n.length;_<e;++_){const e=n[_];r[e]&&r[e].src&&(r[e].src=Photoview.blank,delete r[e])}}for(let n=0;n<Photoview.cacheSize;++n){let d=_+(n+1)*e;for(;d>=o;)d-=o;for(;d<0;)d+=o;const l=cur.pvData[t][d];if(!l||!l.id){(!l||(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)()-l>3e3)&&(cur.pvData[t][d]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)(),setTimeout((()=>{ajax.post("al_photos.php",{act:"show",gid:cur.gid,list:t,offset:Photoview.realOffset(t,d,-1),direction:e},{onDone:Photoview.loaded})}),10));break}l[i]||(l[i+"_src"]?(l[i]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)(),l[i].src=l[i+"_src"]):(l[i]=1,l[s]||(l[s+"_src"]?(l[s]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)(),l[s].src=l[s+"_src"]):(l[s]=1,l[r]||(l[r+"_src"]?(l[r]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)(),l[r].src=l[r+"_src"]):(l[r]=1,l[a]||(l[a+"_src"]?(l[a]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)(),l[a].src=l[a+"_src"]):(l[a]=1,l.x||(l.x=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)(),l.x.src=l.x_src)))))))))}},hide(_,e){const{noLoc:t,goOptions:o}="object"==typeof _?_:{noLoc:_};if(Photoview.hideTag(!0),cur.pvShown&&(!__afterFocus||!0===e)){if(cur.pvCanvas&&Photoview.fullscreenStop(!0),cur.prevPhotoWidth=cur.prevPhotoHeight=0,(cur.pvJumpTo||{}).z=="albums"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pva_owner")&&!cur.pvAlbumsShown&&0===t)return Photoview.jumpToAlbums(!0);if((cur.pvJumpTo||{}).z=="album"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_album")&&!cur.pvAlbumShown&&0===t)return Photoview.jumpToAlbum(!0);if((cur.pvJumpTo||{}).z=="tag"+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pvsa_tag")&&!cur.pvPhotoTagShown&&0===t)return Photoview.jumpToTagged(!0);if("temp"==cur.pvListId)cur.pvCancelLoad();else if(!cur.pvNoHistory&&!t&&cur.pvHistoryLength>0&&cur.pvHistoryLength<10)return cur.pvNoHistory=!0,__adsUpdate("very_lazy"),cur.pvBodyScrollTop=document.body.scrollTop,history.go(-cur.pvHistoryLength);if(!0!==t&&!layerQueue.count()){let _;cur.pvRoot?("newtag"==cur.pvListId.substr(0,6)?(_="albums"+vk.id+"?act=added",-1!=cur.pvListId.indexOf("/rev")&&(_+="&rev=1")):_=cur.pvListId.replace(/^photos/,"albums").replace("/rev","?rev=1"),nav.setLoc(_,o)):(_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.clone)(nav.objLoc),delete _.z),nav.strLoc!=nav.toStr(_)&&nav.setLoc(_,o),__adsUpdate("very_lazy")}window.__pvhideTimer=setTimeout(Photoview.doHide.pbind(cur),0),__adsUpdate(),cur.pvaOffset=cur.pvaInitOffset,cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1,cur.pvaInitPhotosOffset&&(cur.pvaPhotosOffset=cur.pvaInitPhotosOffset),cur.pvaInitFeedOffset&&(cur.pvaPhotosFeedOffset=cur.pvaInitFeedOffset)}},doHide(_){void 0!==cur.pvBodyScrollTop&&(document.body.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop),cur.pvTaggerTooltip&&(cur.pvTaggerTooltip.unMount(),delete cur.pvTaggerTooltip),_.pvHistoryLength=0,cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),_.pvFriends&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_add_tag","pv_cancel_tag",_.pvFriends.firstChild.firstChild,_.pvFriends),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(_.pvFriends),_.pvFriends=_.pvFriendName=!1),_web_page_wall__WEBPACK_IMPORTED_MODULE_23__.default.cancelEdit(!0);const e=Photoview.allSizes,t=_.pvListId,o=((_.pvData||{})[t]||{}).length;if(_.pvLastDirection&&o){for(let i=0;i<Photoview.cacheSize;++i){let s=_.pvLastFrom+(i+1)*_.pvLastDirection;for(;s>=o;)s-=o;for(;s<0;)s+=o;const r=_.pvData[t][s];if(r)for(let _=0,t=e.length;_<t;++_){const t=e[_];r[t]&&r[t].src&&(r[t].src=Photoview.blank,delete r[t])}}_.pvLastDirection=_.pvLastFrom=!1}if(cur.pvYourComment=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(cur.pvYourComment),layers.hide(),layers.fullhide=!1,delete cur.pvLayerCreated,window.tooltips&&tooltips.destroyAll(cur.pvBox),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(layerWrap,"pv_layer_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(layerBG,"pv_layer"),layerBG.style.opacity="",_.pvShown=_.pvListId=_.pvClicked=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(window,"resize",Photoview.onResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(document,"keydown",Photoview.onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(layerWrap,"click",Photoview.onLayerClick),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(layerWrap,"scroll",Photoview.scrollResize),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)(layerWrap,"mousemove",Photoview.onLayerMouseMove),cur.pvOptions){let _=cur.pvOptions.onHide;cur.pvOptions.onHide=!1,_&&(window.wkcur&&"likes"===window.wkcur.type&&window.wkcur.shown?window.wkcur.photoViewverHideCB=_:_())}layerQueue.pop(),Photoview.destroyPeriod();const i=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.getBoxQueue)().getAll().find((_=>_.getOptions().featureFlags?.keepInPhotoView));if(i&&i._show(),_.pvPreloaded&&_===cur){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("photos_container"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{innerHTML:_.pvPreloaded});for(;t.firstChild;)e.appendChild(t.firstChild);e.qsorter&&setTimeout(qsorter.added.pbind(e),0),_.pvPreloaded=!1}_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_22__.default.hide(),Photoview.toggleFastChats(!0),delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&(cur.pvPhotoTags.unMount(),delete cur.pvPhotoTags)},editPhoto(){},descTT:_=>(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_26__.showTooltip)(_,{text:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_edit_desc"),black:1,shift:[-160,13,0],showdt:0,appendParentCls:"narrow_column"}),editInline(_){if("A"==((_||window.event||{}).target||{}).tagName||cur.pvEditing)return;window.tooltips&&window.tooltips.hideAll();const e=cur.pvListId,t=cur.pvIndex,o=cur.pvData[e][t],i=_=>{if(!cur.pvShown||cur.pvListId!=e||cur.pvIndex!=t||cur.pvEditing)return;cur.pvEditing=[e,t];const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_caption_warn"),i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_edit_desc_intro"),s=cur.pvDesc.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{innerHTML:`\n          <textarea\n            class="dark"\n            id="pv_edit_text"\n            onkeydown="onCtrlEnter(event, Photoview.saveInline)"\n            onkeyup="checkTextLength(cur.pvCaptionLimit, this, ${o});"\n            placeholder="${i}"\n          >${_}</textarea>\n          <div id="pv_caption_warn"><div>`},{display:"none"})),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_edit_text");(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_6__.autosizeSetup)(r,{minHeight:21,maxHeight:350}),setTimeout((()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.elfocus)(r),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.addEvent)(r,"blur",Photoview.saveInline),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvDesc.firstChild),cur.pvNarrowScrollbar.scrollTop(0)}),1)};!o.desc?i(""):ajax.post("al_photos.php",{act:"edit_desc",photo:o.id},{onDone:i,progress:cur.pvProgress})},cancelInline(){cur.pvEditing=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_edit_text"),"blur"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvDesc.firstChild),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(cur.pvDesc.firstChild.nextSibling)},saveInline(){if(!cur.pvEditing)return;(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.removeEvent)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_edit_text"),"blur");const _=cur.pvEditing[0],e=cur.pvEditing[1],t=cur.pvData[_][e],o=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.trim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)("pv_edit_text"));if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_desc_edit",cur.pvDesc)&&!o)return Photoview.cancelInline();ajax.post("al_photos.php",{act:"save_desc",photo:t.id,hash:t.hash,text:o,stat_ref:Boolean(cur.pvOptions.isUpload)?"save_description_upload_photoview":"save_description_no_upload_photoview"},{onDone:o=>{t.desc=o;if(!(cur.pvShown&&_==cur.pvListId&&e==cur.pvIndex))return;cur.pvEditing=!1;const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvDesc);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)(i,o||'<span class="pv_desc_edit">'+_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_edit_desc")+"</span>"),i.onmouseover=o?Photoview.descTT.pbind(i):()=>{},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domNS)(i))},progress:cur.pvProgress})},cmp(_,e){const t=_.length,o=e.length;return t<o?-1:t>o?1:_<e?-1:_>e?1:0},receiveComms(_,e,t,o,i,s){if(_!=cur.pvListId||e!=cur.pvIndex)return;const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{innerHTML:t}),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments_list"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domLC)(a);let d=n;const l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(d,!0)[1],c=cur.pvData[_][e];for(let _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domLC)(r);_;_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domLC)(r)){for(c.actions.comm&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(_,"reply_replieable");d&&Photoview.cmp(d.id,_.id)>0;)d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domPS)(d);d&&!Photoview.cmp(d.id,_.id)?(a.replaceChild(_,d),d=_):(d&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domNS)(d)?a.insertBefore(_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domNS)(d)):!d&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(a)?!0===i?(--c.commshown,r.removeChild(_)):a.insertBefore(_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(a)):a.appendChild(_),++c.commshown)}s&&n&&(layerWrap.scrollTop+=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(n,!0)[1]-l),cur.pvCommsLikes[c.id][0]=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments"),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur.pvReplyNames,o),Photoview.updateComms()},commSaved(_){if(!cur.pvShown)return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments"),t=!!e&&cur.pvData[cur.pvListId][cur.pvIndex],o=_.match(/^(-?\d+)photo(_\d+)/);t&&o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comment"+o[1]+o[2])&&(cur.pvCommsLikes[t.id][0]=e)},comments(_){if(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments")).id||"";if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)("pv_comments_header")||Photoview.cmp(e,"pv_comment"+_)<0)return}const e=cur.pvListId,t=cur.pvIndex,o=cur.pvData[e][t],i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments_header");ajax.post("al_photos.php",{act:"photo_comments",offset:o.commshown,photo:o.id,list_id:cur.pvListId},{onDone:(o,i)=>{Photoview.receiveComms(e,t,o,i,!1,_),_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comment"+_)&&Photoview.showComment(_)},showProgress:()=>{i.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.showProgress)(i)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.hideProgress)(i)}})},updateComms(_){const e=cur.pvData[cur.pvListId][cur.pvIndex],t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments_header");let o="";e.commcount>e.commshown&&(o=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_show_prev_comments",e.commcount-e.commshown)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments_list"),"unshown",!_&&0==e.commcount),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggle)(t,o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_no_commments_placeholder"),0==e.commcount&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("_post_content",cur.pvBox)),t.innerHTML=o},commentChanged(){(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_28__.checkTextLength)(cur.pvCommLimit,cur.pvComment),cur.pvCommenting=cur.pvData[cur.pvListId][cur.pvIndex].id},updateRightBlock(_){function e(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvLeftWrap)[1]-(cur.pvReplyForm?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvReplyForm)[1]:0);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvNarrow,"height",_);const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pv_no_commments_placeholder_wrap");if(e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(e.children[0])||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(e.children[1]))){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(e)[1],o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)("pv_comments_list")[1],i=_-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments").offsetTop-o;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(e,"margin-top",Math.max(0,i/2-t/2))}}e(),clearTimeout(cur.pvRightBlockUpdateTO),cur.pvRightBlockUpdateTO=setTimeout(e)},getReplyAsGroupEl:()=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_reply_as_group"),sendComment(_,e,t={}){const o=cur.pvListId,i=cur.pvIndex,s=cur.pvData[o][i],r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("reply_field"+_),a=r&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.data)(r,"composer"),n=(cur.pvReplyNames[(cur.reply_to||{})[0]]||[])[1],d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("addpost_button",cur.pvReplyForm);let l={};const c=t.stickerId;if(c)l={message:"",attach1_type:"sticker",attach1:c,sticker_referrer:t.sticker_referrer};else{if(l=a?Composer.getSendParams(a,Photoview.sendComment.pbind(_)):{message:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.trim)(Emoji.editableVal(r))},l.delayed)return;if(!l.attach1_type&&(!l.message||n&&!n.indexOf(l.message)))return void Emoji.editableFocus(r,!1,!0)}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)("reply_warn"+_);const p=Photoview.getReplyAsGroupEl();ajax.post("al_photos.php",_web_page_wall__WEBPACK_IMPORTED_MODULE_23__.default.fixPostParams((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(l,{act:"post_comment",photo:s.id,hash:s.hash,from_group:p&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domData)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domClosest)("_submit_post_box",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)(p)),"from-oid")<0?1:"",reply_to:(cur.reply_to||{})[1]})),{onDone:(t,n)=>{++s.commcount,Photoview.receiveComms(o,i,t,n,!0),c||(a?Composer.reset(a):Emoji.val(r,"")),r.autosize&&r.autosize.update(),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.mobile?_web_page_wall__WEBPACK_IMPORTED_MODULE_23__.default.hideEditReply(_):(Emoji.editableFocus(r,!1,!0),_web_page_wall__WEBPACK_IMPORTED_MODULE_23__.default.cancelReplyTo(_,e)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)("reply_link"+_),_web_page_wall__WEBPACK_IMPORTED_MODULE_23__.default.hideEditPostReply(null,!0),cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollBottom(),Photoview.updateRightBlock()},showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(d)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(d)}})},highlightComment(_){if(!(_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)(_)))return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(_,!0)[1],t=_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate.pbind(_,{backgroundColor:"#ECEFF3"},200,(()=>{setTimeout((()=>{(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(_,{backgroundColor:"#FFF"},200,(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(_,{backgroundColor:""})}))}),1e3)}));e<0||e>lastWindowHeight-200?(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(layerWrap,{scrollTop:layerWrap.scrollTop+e-50},300,t):t()},showComment(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comment"+_);return e?Photoview.highlightComment(e):Photoview.comments(_),!1},commDone(node,text,del,script){if(!node)return;const fc=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(node),msg=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domNS)(fc),ph=null!=cur.pvListId&&!1!==cur.pvListId&&null!=cur.pvIndex&&cur.pvData[cur.pvListId][cur.pvIndex];if(!text)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(fc),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(msg),void(ph?(++ph.commcount,++ph.commshown,Photoview.updateComms()):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_13__.photos.recache(cur.offset,1));if(msg?(msg.innerHTML=text,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(msg)):node.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{innerHTML:text})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(fc),del&&(ph?(--ph.commshown,--ph.commcount,Photoview.updateComms(del)):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_13__.photos.recache(cur.offset,-1)),ph&&(cur.pvCommsLikes[ph.id][0]=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_comments")),script)try{eval(script)}catch(_){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.logEvalError)(_,script)}},commProgress(_,e){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_actions"+_);if(!t)return;let o=t.firstChild.nextSibling;if(!0!==e)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(o),void(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(t.firstChild);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(t.firstChild),o||(o=t.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{className:"progress"}))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(o)},commParams:(_,e)=>({onDone:Photoview.commDone.pbind(_,e),progress:"pv_progress"+_+e,stat:[window.jsc("web/privacy.js"),"privacy.css"]}),commAction(_,e,t,o){if("spam"===_){const[_,e]=t.split("_");return void this.showReportPhotoCommentForm(_,e)}const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.gpeByClass)("reply",e),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.gpeByClass)("post_actions",e),r="post_actions_progress";(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hasClass)(i,r)||ajax.post("al_photos.php",{act:_+"_comment",comment:t,hash:o},{onDone:Photoview.commDone.pbind(i),showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass.pbind(s,r),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass.pbind(s,r)})},_isOverLayer:_=>_.target==layer||_.target==cur.pvCont,_isOverLayerLeft(_){if(Photoview._isOverLayer(_)){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(cur.pvBox),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvBox);return _.pageX<e[0]&&_.pageY>e[1]&&_.pageY<e[1]+t[1]}},onLayerMouseMove(_){if(Photoview._isOverLayer(_)){const e=Photoview._isOverLayerLeft(_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(layerWrap,"pv_left_panel_over",e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",e)}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(layerWrap,"pv_left_panel_over")},onLayerClick(_,e){if(Photoview._isOverLayer(_)&&Photoview._isOverLayerLeft(_))return Photoview.show(!1,cur.pvIndex-1,_);Photoview._doLayerClick(_,e)},_doLayerClick(_,e){if(cur.pvClicked&&!e||__afterFocus||_&&cur.__mdEvent&&_.target!=cur.__mdEvent.target)return void(cur.pvClicked=!1);if(_&&(2==_.button||3==_.which||_.pvHandle))return;_&&(_.pvHandle=!0);let t=_.pageX,o=_.pageY;if(null==t&&null!=_.clientX){const e=document.documentElement,i=document.body;t=_.clientX+(e&&e.scrollLeft||i&&i.scrollLeft||0)-(e.clientLeft||0),o=_.clientY+(e&&e.scrollTop||i&&i.scrollTop||0)-(e.clientTop||0)}const i=Math.abs(t-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(cur.pvOldX)),s=Math.abs(o-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(cur.pvOldY));(i>3||s>3)&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)()-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(cur.pvOldT)>300&&(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag():cur.pvEditorMode?_.target!=layerWrap&&_.target!=layer||SPE.attemptHide((()=>{Photoview.hide(0)})):Photoview.hide(0))},onKeyDown(_){if(!1===_.returnValue)return!1;if((!window.SPE||!window.SPE.editor)&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.inArray)(_.keyCode,[_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.DOWN,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.UP])&&cur.pvNarrowScrollbar&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hasClass)(_.target,"reply_field")&&_.target&&"pv_edit_text"!==_.target.id)return cur.pvNarrowScrollbar.scrollBy(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.DOWN?70:-70),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(_);if(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.ESC&&cur.pvEditing)return Photoview.cancelInline(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(_);_.altKey&&_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.RETURN&&Photoview.canFullscreen()&&(cur.pvCanvas?Photoview.fullscreenStop():Photoview.fullscreen()),_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.SPACE&&cur.pvCanvas&&(_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_14__.FullscreenPV.startSlide(),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_14__.FullscreenPV.showControls(!0));const e=_.target.contentEditable;return!!(window.Emoji&&Emoji.shown||_.target&&("INPUT"==_.target.tagName||"TEXTAREA"==_.target.tagName||"DIV"==_.target.tagName&&e&&"inherit"!=e))||(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.ESC?(cur.pvCanvas?Photoview.fullscreenStop():cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag():_.vkCanceled||(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)()||(cur.pvEditorMode?SPE.attemptHide((()=>{Photoview.hide(0)})):Photoview.hide(0)),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(_)):(cur.pvTagger||(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.getBoxQueue)().count()||cur.pvComment&&cur.pvComment.focused||_.ctrlKey||(_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.RIGHT?Photoview.show(cur.pvListId,cur.pvIndex+1):_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.KEY.LEFT&&Photoview.show(cur.pvListId,cur.pvIndex-1)),!cur.pvCanvas&&void 0))},updateVerticalPosition(_){if(cur.pvCont){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvCont),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.clientHeight)()/2-e[1]/2-(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(layer,"margin-top",Math.round(t))}},calculateVeryBig(){const _=Math.max(document.documentElement.clientWidth,window.innerWidth||0);cur.pvVeryBig=_>1800?3:_>1200?2:_>800&&1,window.devicePixelRatio>1&&(cur.pvVeryBig+=1,cur.pvVeryBig=Math.min(3,cur.pvVeryBig))},updateNavBtnsLeftThreshold(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvImageWrap)[0],t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(cur.pvImageWrap)[0];cur.pvLeftBtnAmount&&!_||(cur.pvLeftBtnAmount=t+Photoview.LEFT_RIGHT_NAV_RATIO*e)},restorePhotoLocation(_,e,t){e.preventDefault(),e.stopPropagation(),window.ajax.post("al_photos.php",{act:"restore_location",hash:_.dataset.hash,photo_raw:t},{onDone(){window.location.reload()}})},updatePhotoDimensions(_){if(Photoview.isPhotosList()||cur.pvEditorModeDimensionsUpdated)return;let e=Photoview.MIN_WIDTH,t=Photoview.MIN_HEIGHT;cur.pvEditorMode&&(e=Photoview.PE_MIN_WIDTH,t=Photoview.PE_MIN_HEIGHT,cur.pvEditorModeDimensionsUpdated=!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(cur.pvBottomInfo,"pv_with_line_break");const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(cur.pvTagInfo),i=o?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvTagInfo)[1]:0,s=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvBottomInfo)[1],n=Math.max(e,s-Photoview.SIDE_COLUMN_WIDTH-2*Photoview.SIDE_MIN_GAP),d=Math.max(t,r-a-2*Photoview.VERTICAL_MIN_GAP-i);Photoview.calculateVeryBig();const l=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.clone)(cur.pvCurData||{width:e,height:t});l.width=l.width||e,l.height=l.height||t;const c=l.width/l.height;let p=Math.min(n,l.width),u=p/c;u=Math.min(d,u),p=Math.ceil(u*c);const h=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(cur.pvBottomLeft)[0]+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvBottomLeft)[0]>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(cur.pvBottomActions)[0]-20;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvBottomInfo,"pv_with_line_break",h),_&&(cur.prevPhotoWidth=cur.prevPhotoHeight=0);const v=cur.prevPhotoWidth=Math.max(p,e,cur.prevPhotoWidth||0),E=cur.prevPhotoHeight=Math.max(u,t,(cur.prevPhotoHeight||0)-i);let P=Math.max(0,E/2-u/2);if(P>0&&!o){const _=((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvPhoto)[1]+a)/2-u/2;_>a&&(P=_)}cur.pvAttachedProducts.photoSize={width:p,height:u,top:P},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvPhoto,{width:v,height:E});(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvBottomInfo,{width:v-46}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)(cur.pvPhoto),{width:p,height:u,marginTop:P}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvTagInfo,{width:v}),cur.pvTagFrame&&Photoview.updateTagFrameDimensions(p,u,P),cur.pvPhotoTagsContainer&&Photoview.updatePhotoTagsContainerDimensions(p),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvImgProgress,"marginTop",P+u/2);const m=(cur.pvIsLightMode?0:Photoview.SIDE_COLUMN_WIDTH)+v;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvCont,{width:m,paddingLeft:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.sbWidth)()}),Photoview.updateRightBlock(),Photoview.updateVerticalPosition(),cur.pvPhWidth=p,cur.pvPhHeight=u,Photoview.updateNavBtnsLeftThreshold();const g=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(cur.pvCont),b=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvCont),w=g[1]+b[1],D=s-(g[0]+b[0])<85||r-w<60;Photoview.toggleFastChats(!D)},toggleFastChats(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)("chat_onl_wrap","hidden",!_),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("rb_box_wrap"),(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(this,"hidden",!_)}))},onResize(){if(cur.pvCanvas){const _=cur.pvVeryBig,e=cur.pvCanvas.offsetWidth,t=cur.pvCanvas.offsetHeight;return cur.pvVeryBig=e>1280||t>1280?2:(e>807||t>807)&&1,void(_!=cur.pvVeryBig&&setTimeout(Photoview.preload.pbind(cur.pvIndex,cur.pvLastDirection||1),10))}if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvCont,"width",800):Photoview.updatePhotoDimensions(!0),cur.pvPhoto){if(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.mozilla&&cur.pvPhoto.firstChild){const _=cur.pvPhoto.firstChild.offsetLeft,e=(lastWindowWidth-cur.pvActualWidth)%2&&(cur.pvActualWidth-cur.pvPhWidth)%2?4:3;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvTagFrame,{left:_-e+"px"})}Photoview.scrollResize(),Photoview.stopTagger()}},stopTagger(){cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag()},updateSize(){cur.pvBox&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown||!!cur.pvAlbumShown),onBodyResize(),Photoview.onResize()},activate(_){_&&_.timeout?(clearTimeout(_.timeout),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeAttr)(_,"timeout")):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(_)&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.fadeTo)(_,200,1)},deactivate(_){_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(_)&&!_.timeout&&(_.timeout=setTimeout((()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeAttr)(_,"timeout"),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.fadeTo)(_,200,.4)}),1))},deletePhoto(_){const e=cur.pvListId,t=cur.pvIndex,o=cur.pvData[e][t],i=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)();if(cur.deletionProgress=cur.deletionProgress||{},cur.deletionProgress[o.id])return;if(cur.deletionProgress[o.id]=!0,cur.pvTagger)return void Photoview.stopTagger();cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas();const s={act:"delete_photo",photo:o.id,hash:o.hash,set_prev:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.isChecked)("pvb_prev_check"),sure:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(_)};(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_28__.isClaimContent)()&&(s._nol=JSON.stringify(window.nav.objLoc)),ajax.post("al_photos.php",s,{onDone:(_,s)=>{if(cur.deletionProgress[o.id]=!1,i)return i.hide(),nav.go("/id0",!1,{nocur:!0});e==cur.pvListId&&t==cur.pvIndex&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(s||_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photo_deleted"),_),o.deleted=[cur.pvTagInfoText.innerHTML,cur.pvTagInfoButtons.innerHTML],Photoview.toggleDeletedState(!0),Photoview.updatePhotoDimensions())}})},restorePhoto(_){const e=cur.pvListId,t=cur.pvIndex,o=cur.pvData[e][t];(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.isButtonLocked)(_)||ajax.post("al_photos.php",{act:"restore_photo",photo:o.id,hash:o.hash},{onDone:_=>{o.deleted=!1,e==cur.pvListId&&t==cur.pvIndex&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1),Photoview.updatePhotoDimensions()),cur.pvPhotoTags&&cur.pvPhotoTags.showAreas()},onFail:_=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_error"),_),!0),showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(_),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(_)})},spamPhoto(_,e){const t=cur.pvListId,o=cur.pvIndex,i=cur.pvData[t][o];(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.isButtonLocked)(e)||(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_15__.Phototag.stopTag():ajax.post("al_photos.php",{act:"spam_photo",photo:i.id,hash:i.hash,spam_hash:_,pv:1},{onDone:(_,e)=>{e&&(i.deleted=_),t==cur.pvListId&&o==cur.pvIndex&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photo_marked_as_spam_restore"),""),e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvCommentsData))},showProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(e),hideProgress:()=>(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(e)}))},rotatePhoto(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_rotate_progress");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(e))return;_%=4,Photoview.stopTagger(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(e);const t=cur.pvListId,o=cur.pvIndex,i=cur.pvData[t][o],s=i.id,r=i.rotate_hash;window.ajax.post("/al_photos.php?act=make_rotate",{type:"view",list_id:t,hash:r,photo:s,index:o,to:_},{onDone:Photoview.rotatePhotoDone,onFail:Photoview.rotatePhotoDone})},rotatePhotoOld(_){const e=document.querySelector("#pv_rotate_progress");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(e))return;Photoview.stopTagger(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_rotate").appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{id:"pv_rotate_frame",className:"upload_frame",innerHTML:'<iframe name="pv_rotate_frame"></iframe>'}));const t=cur.pvListId,o=cur.pvIndex,i=cur.pvData[t][o],s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_rotate_form");s.innerHTML="",s.action=i.rotate[0];const r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)({act:"do_rotate",to:_,list_id:t,index:o,fid:i.id},i.rotate);if(_=(_+4)%4,"rotate_photo"==r.act&&(r.angle=(r.angle+_)%4),r["rot"+_])return r.act="done_rotate",r.complete=1,void window.ajax.post("/al_photos.php",r,{onDone:Photoview.rotateDone,onFail:()=>{Photoview.rotateDone()}});for(let _ in r)0!=_&&s.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("input",{type:"hidden",name:_,value:r[_]}));s.submit()},rotatePhotoDone(_){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)("pv_rotate_progress"),!_)return;const e=_.list_id;if(!e)return;const t=_.index,o=cur.pvData[e][t];o&&(Object.entries(_.photos).forEach((function([_,e]){o[`${_}_`]=e,o[`${_}_src`]=e[0]})),e===cur.pvListId&&t===cur.pvIndex&&Photoview.show(e,t),cur.pvPhotoTags&&cur.pvPhotoTags.reload())},rotateDone(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)("pv_rotate_progress");const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_rotate_frame");if(!e)return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(e),!_)return;const t=_.list_id,o=_.index,i=cur.pvData[t][o];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(i,{x_src:_.x_src,y_src:_.y_src,z_src:_.z_src,w_src:_.w_src,base:_.base,x_:_.x_,y_:_.y_,z_:_.z_,w_:_.w_,x:0,y:0,z:0,w:0,tags:_.tags,tagged:_.tagged,suggested_tags:_.suggested_tags,tagshtml:_.html}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(i.rotate,{photo:_.photo,hash:_.hash,rhash:_.rhash,angle:_.angle,rot1:_.rot1,rot3:_.rot3}),t==cur.pvListId&&o==cur.pvIndex&&Photoview.show(t,o),cur.pvPhotoTags&&cur.pvPhotoTags.reload()},likeUpdate(_,e,t){e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(e);const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_like"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domByClass)(o,"_count");if(!i)return;const s=o.tt||{},r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.clone)(s.opts||{}),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domByClass)(s.container,"_value"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domByClass)(s.container,"_content"),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domByClass)(s.container,"_title");t&&d&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)(d,t),s&&(s.likeInvalidated=!0),a&&(a.value=e),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animateCount)(i,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(o,"pv_liked",_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(o,"no_likes",!e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.toggleClass)(n,"me_hidden",!_),e?!s.el||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(s.container)||t||tooltips.show(s.el,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(r,{showdt:0})):s.el&&s.hide()},tagOver(_){(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(_,{backgroundColor:"#6B8DB1"},200),(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_26__.showTooltip)(_,{text:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_delete_tag"),shift:[0,-2,0]})},tagOut(_){_.parentNode&&_.parentNode.parentNode&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(_,{backgroundColor:"#C4D2E1"},200)},deleteTag(_,e){const t=cur.pvListId,o=cur.pvIndex,i=cur.pvData[t][o];if(i.tagid){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)("pv_tag_handling"))return}else if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_action_progress"))return;const s=e?1:0;ajax.post("al_photos.php",{act:"delete_tag",photo:i.id,tag:_,hash:i.hash,top_panel:s,extended:1},{onDone:(e,s,r,a)=>{i.tagid?((0,_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_32__.decrementLeftMenuPhotoCounter)(),cur.pvPhotoTags&&cur.pvPhotoTags.dispatchEvent(_web_photos_types__WEBPACK_IMPORTED_MODULE_31__.TagEventTypes.DECLINE_USER_TAG,{tagId:_,photoRawId:i.id}),i.taginfo=i.tagid=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_tag_deleted"),e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(cur.pvTagInfoButtons,"no_events"),setTimeout((()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(cur.pvTagInfoButtons,"no_events")}),1e3)):Photoview.actionInfo().innerHTML=e,void 0!==s&&(i.tags=s,i.tagged=r,i.tagshtml=a,cur.pvListId==t&&cur.pvIndex==o&&(Photoview.setTags(a),(!i.taginfo&&i.actions.tag&&s[0]<cur.pvMaxTags?_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvTagLink))),cur.pvPhotoTags&&cur.pvPhotoTags.deleteTag(_)},onFail:_=>{if(_)return Photoview.actionInfo().innerHTML=_,!0},showProgress:()=>{if((0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(e),!i.tagid){const _=Photoview.actionInfo();_.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.showProgress)(_)}},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(e),i.tagid||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(Photoview.actionInfo())}})},restoreTag(_){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_action_progress"))return;const e=cur.pvListId,t=cur.pvIndex,o=cur.pvData[e][t];ajax.post("al_photos.php",{act:"restore_tag",photo:o.id,tag:_,hash:o.hash},{onDone:(_,i,s,r)=>{void 0!==i&&(o.tags=i,o.tagged=s,o.tagshtml=r,cur.pvListId==e&&cur.pvIndex==t&&(Photoview.setTags(r),(!o.taginfo&&o.actions.tag&&i[0]<cur.pvMaxTags?_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvTagLink)),cur.pvPhotoTags&&cur.pvPhotoTags.renderTagAreas()),Photoview.actionInfo().innerHTML=_},onFail:_=>{if(_)return Photoview.actionInfo().innerHTML=_,!0},showProgress:()=>{const _=Photoview.actionInfo();_.innerHTML="",(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.showProgress)(_)},hideProgress:()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(Photoview.actionInfo())}})},confirmTag(_,e){const t=cur.pvListId,o=cur.pvIndex,i=cur.pvData[t][o];(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)("pv_tag_handling")||ajax.post("al_photos.php",{act:"confirm_tag",tag:_,photo:i.id,hash:i.hash,extended:1},{onDone:(e,s,r)=>{i.tags=e,i.tagged=s,i.tagshtml=r,i.taginfo=i.tagid=!1,cur.pvPhotoTags&&cur.pvPhotoTags.dispatchEvent(_web_photos_types__WEBPACK_IMPORTED_MODULE_31__.TagEventTypes.CONFIRM_USER_TAG,{tagId:_,photoRawId:i.id}),(0,_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_32__.decrementLeftMenuPhotoCounter)(),t==cur.pvListId&&o==cur.pvIndex&&(Photoview.setTags(r),(!i.taginfo&&i.actions.tag&&e[0]<cur.pvMaxTags?_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(cur.pvTagLink),i.suggestedTagsInfo&&!i.taginfo&&e[0]<cur.pvMaxTags?Photoview.showSuggestedInfoTopPanel(i):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cleanElems)("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(!1)))},showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(e)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(e)}})},confirmAllSuggestedTags(_){if(!cur.pvPhotoTags)return;(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(_);const e=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.getPhotoData)("suggested_tags"),t=Object.keys(e);cur.pvPhotoTags.confirmSuggestedTags(t,(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(_)}),(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(_)}))},declineAllSuggestedTags(_){if(!cur.pvPhotoTags)return;(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(_);const e=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_29__.getPhotoData)("suggested_tags"),t=Object.keys(e);cur.pvPhotoTags.declineSuggestedTags(t,(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(_)}),(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(_)}))},toProfileTag(){const _=cur.pvData[cur.pvListId][cur.pvIndex].tagged[vk.id];_&&!cur.pvTagger&&Photoview.showTag(_)},showTag(_){cur.pvPhotoTags&&cur.pvPhotoTags.showTagArea(_)},showDynTag(_){if(clearTimeout(cur.pvHidingTag),cur.pvShowingTag==_)return;const e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.clone)(cur.pvData[cur.pvListId][cur.pvIndex].tags[_]),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_tag"+_);if(!t)return;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.each)(e,((_,t)=>{e[_]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.positive)(t*cur[_%2?"pvPhHeight":"pvPhWidth"]/100)}));let o=0;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(cur.pvTagInfo)&&(o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvTagInfo)[1]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvTagPerson,{marginLeft:e[0]+"px",marginTop:o+e[3]+"px",minWidth:e[2]-e[0]+"px"}),cur.pvTagPerson.innerHTML=t.firstChild.innerHTML;const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvTagPerson);e[3]+i[1]>cur.pvPhHeight&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(cur.pvTagPerson,{marginTop:cur.pvPhHeight-i[1]+"px"}),cur.pvTagPerson.onmouseover=Photoview.showDynTag.pbind(_),cur.pvShowingTag=_,_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.msie?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.show)(cur.pvTagPerson):(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.fadeIn)(cur.pvTagPerson,200)},hideTag(){cur.pvPhotoTags&&cur.pvPhotoTags.hideTagArea()},realOffset(_,e,t){let o=e;if(!cur.pvData||!cur.pvData[_])return o;for(let i=0;i<e;i++)cur.pvData[_][i]&&(cur.pvData[_][i].deleted||cur.pvData[_][i].moved)&&(o+=t);return o},realCount(_,e){let t=e;if(!cur.pvData||!cur.pvData[_])return t;for(let e=0;e<cur.pvData[_].length;e++)cur.pvData[_][e]&&(cur.pvData[_][e].deleted||cur.pvData[_][e].moved)&&t++;return t},list(_,e,t){"deleted"!=t&&(cur.pvList||(cur.pvList={}),cur.pvList[_+"_"+e]=t)},loaded(_,e,t,o,i){if("deleted"!=_){if(i&&((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{lang:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur.lang||{},i.lang),pvHash:i.hash,pvCommLimit:i.commlimit,pvCaptionLimit:i.captionlimit,pvMaxTags:i.maxtags,pvReasons:i.reasons,pvReplyNames:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur.pvReplyNames||{},i.names||{}),pvAskForAutoTag:i.ask_for_autotag,pvNeedShowAlertForOneSuggest:i.need_show_alert_for_one_suggest,pvNeedShowAlertForSomeSuggests:i.need_show_alert_for_some_suggests,pvOneSuggestHintId:i.one_suggest_hint_id,pvOneSuggestHintHash:i.one_suggest_hint_hash,pvSomeSuggestsHintId:i.some_suggests_hint_id,pvSomeSuggestsHintHash:i.some_suggests_hint_hash,pvTagsQueueParams:i.qparams}),window.pvcur=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(window.pvcur||{},{wallTpl:i.wallTpl,rmedia_types:i.rmedia_types}),cur.wallTpl=cur.wallTpl||i.wallTpl,cur.options||(cur.options={}),cur.options.share||(cur.options.share=i.share),cur.wallUploadOpts||(cur.wallUploadOpts=i.upload),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_add_media")),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_add_media"))),e=Photoview.realCount(_,e),t=Photoview.realOffset(_,t,1),cur.pvData||(cur.pvData={}),cur.pvCommsLikes||(cur.pvCommsLikes={}),cur.pvData[_])if(cur.pvData[_].length<e)for(let t=cur.pvData[_].length;t<e;++t)cur.pvData[_].push(void 0);else cur.pvData[_].length>e&&(cur.pvData[_]=cur.pvData[_].slice(0,e));else cur.pvData[_]=new Array(e);for(let i=0,s=o.length;i<s;++i){const s=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.clone)(o[i]);let r=t+i;for(;r>=e;)r-=e;cur.pvCommsLikes[s.id]=[s.comments,s.likes,(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkNow)(),!1],delete s.comments,delete s.likes,cur.pvData[_][r]=s}}},showDeleted(_,e,t){cur.pvShown&&"temp"==cur.pvListId&&(e+="<br><br>"+t),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showFastBox)({title:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_error"),onHide:()=>{cur.pvShown&&"temp"==cur.pvListId&&Photoview.hide(!0)}},e)},spamDeleted(_,e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)((0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)().progress)||ajax.post("al_photos.php",{act:"spam_photo",photo:e,hash:t,from:"deleted"},{onDone:e=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domPN)(_).replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("span",{innerHTML:e}),_)},showProgress:(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)().showProgress,hideProgress:(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)().hideProgress})},showPhoto(_,e,t,o){if(cur.pvShown&&("temp"!=cur.pvListId||cur.pvWasShown)&&void 0===t.noHistory||((0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.debugLog)("in showPhoto noHistory: "+t.noHistory),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=t.noHistory?0:t.histLen||0),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(cur,{pvJumpTo:t.jumpTo||!1,pvJumpFrom:!1,pvJumpSteps:0}),e=cur.pvList&&cur.pvList[_+"_"+e]||e,!cur.pvData||!cur.pvData[e])return;const i=cur.pvData[e],s=cur.pvOptions&&cur.pvOptions.onHide;let r=!0;cur.pvOptions=t,cur.pvOptions.onHide||(cur.pvOptions.onHide=s);for(let o=0,s=i.length;o<s;++o)if(i[o]){if(i[o].id===_)return Photoview.show(e,o,!1,t.root),t.onShow&&t.onShow(),!1}else r=!1;return r&&o?(t.onEmpty&&t.onEmpty(),!1):void 0},loadedAlbums(_,e,t,o){if(!cur.pvAlbumsData)return;const i={offset:o.offset,part:1,owner:_};o.photos_offset&&(cur.pvaInitPhotosOffset=o.photos_offset),o.photos_feed_offset&&(i.photos_feed_offset=o.photos_feed_offset,cur.pvaInitFeedOffset=o.photos_feed_offset),ajax.preload("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(i,{act:"show_albums"}),t),cur.curYear=o.cur_year,cur.pvAlbumsData[_]={html:e,opts:o},cur.pvaInitOffset=o.offset,cur.pvAlbumsShowing==_&&(Photoview.doShowAlbums(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.boxRefreshCoords)(layer))},showAlbums(_,e){_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(_),cur.pvAlbumsData||(cur.pvAlbumsData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=e.noHistory,cur.pvHistoryLength=0,cur.pvAlbumsShowing=_;const t=e.onFail;cur.pvAlbumsData[_]?"loading"!=cur.pvAlbumsData[_]&&(Photoview.doShowAlbums(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.boxRefreshCoords)(layer)):(cur.pvAlbumsData[_]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:_},(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(e,{onDone:Photoview.loadedAlbums,onFail:e=>(t&&t(e),delete cur.pvAlbumsData[_],cur.pvAlbumsData[_],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedAlbum(_,e,t,o){cur.pvAlbumData&&(t&&ajax.preload("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)({offset:o.offset,part:1,album:_},{act:"show_album"}),t),cur.pvAlbumData[_]={html:e,opts:o},cur.pvAlbumShowing==_&&(Photoview.doShowAlbum(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.boxRefreshCoords)(layer)))},showAlbum(_,e){cur.pvAlbumData||(cur.pvAlbumData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=e.noHistory,cur.pvHistoryLength=0,cur.pvAlbumShowing=_;const t=e.onFail;cur.pvAlbumData[_]?"loading"!=cur.pvAlbumData[_]&&(Photoview.doShowAlbum(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.boxRefreshCoords)(layer)):(cur.pvAlbumData[_]="loading",ajax.post("al_photos.php",{act:"show_album",album:_},(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(e,{onDone:Photoview.loadedAlbum,onFail:e=>(t&&t(e),delete cur.pvAlbumData[_],cur.pvAlbumData[_],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedTagged(_,e,t){cur.pvPhotoTagData&&(cur.pvPhotoTagData[_]={html:e,opts:t},cur.pvPhotoTagShowing==_&&(Photoview.doShowTagged(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.boxRefreshCoords)(layer)))},showTagged(_,e){_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(_),cur.pvPhotoTagData||(cur.pvPhotoTagData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=e.noHistory,cur.pvHistoryLength=0,cur.pvPhotoTagShowing=_;const t=e.onFail;cur.pvPhotoTagData[_]?"loading"!=cur.pvPhotoTagData[_]&&(Photoview.doShowTagged(_,!1),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.boxRefreshCoords)(layer)):(cur.pvPhotoTagData[_]="loading",ajax.post("al_photos.php",{act:"show_tag",mid:_},(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(e,{onDone:Photoview.loadedTagged,onFail:e=>(t&&t(e),delete cur.pvPhotoTagData[_],cur.pvPhotoTagData[_],layers.fullhide&&layers.fullhide(!0),!0)})))},updatePeriods(){Photoview.periods=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass)("photos_period_delimiter")},destroyPeriod(){Photoview.fixedPeriod&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)},fixPeriod(){if(Photoview.periods&&Photoview.periods.length){const _=(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollGetY)(),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(Photoview.periods[0])[1];let t=!1,o=!1;for(let e in Photoview.periods)if(Photoview.periods.hasOwnProperty(e)){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(Photoview.periods[e])[1]>=_)break;t=Photoview.periods[e];const i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.intval)(e)+1;o=!!Photoview.periods[i]&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(Photoview.periods[i])[1]-_}if(t){t!=Photoview.fixedPeriodEl&&(Photoview.fixedPeriod?Photoview.fixedPeriod.innerHTML=t.innerHTML:(Photoview.fixedPeriod=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{innerHTML:t.innerHTML,className:"pva_period_fixed"},{left:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(t)[0]+"px"}),utils.appendChild(Photoview.fixedPeriod)),Photoview.fixedPeriodEl=t);let _=!1!==o?o-e:0;_>=0&&(_=0),Photoview.fixedPeriodTop!==_&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.setStyle)(Photoview.fixedPeriod,{top:_+"px"}),Photoview.fixedPeriodTop=_)}else!t&&Photoview.fixedPeriod&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)}},scrollResize(){if(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.mobile||!cur.pvShown||!cur.pvAlbumsShown&&!cur.pvAlbumShown&&!cur.pvPhotoTagShown&&!cur.pvVideoTagsShown)return;const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pv_photos_load_more"),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pva_more_load_more"),t=3*lastWindowHeight;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(_)&&t>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(_)[1]-(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.msie6?0:(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollGetY)())&&(cur.pvVideoTagsShown?Photoview.loadVideoTags():cur.pvPhotoTagShown?Photoview.loadTaggedPhotos():cur.pvAlbumsShown?Photoview.loadAlbumsPhotos():Photoview.loadAlbumPhotos()),cur.pvAlbumsShowing&&Photoview.fixPeriod(),cur.pvAlbumsShown&&cur.pvShowAllAlbums&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(e)&&t>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(e)[1]-(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_0__.browser.msie6?0:(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollGetY)())&&Photoview.loadAlbums()},loadAlbums(){cur.pvShowAllAlbums=!0,Photoview.loadAlbumsPhotos(!0)},loadedAlbumsPhotos(_,e,t,o){if(cur.pvaLoading=0,!cur.pvAlbumsShown)return;const i=Boolean(cur.pvaPhotosFeedOffset)&&!o;t?cur.pvaOffset=_:(cur.pvaPhotosOffset=_,cur.pvaPhotosFeedOffset=o);const s=t?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pva_content"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pva_content_photos"),r=t?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pva_more_load_more"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pv_photos_load_more"),a=t?{act:"show_albums"}:{act:"show_albums",only_photos:1},n=t?cur.pvaOffset:cur.pvaPhotosOffset,d=t?cur.pvaCount:cur.pvaPhotosCount;if(!s)return;const l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{innerHTML:e});for(;l.firstChild;){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hasClass)(l.firstChild,"photos_period_delimiter")){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.domData)(l.firstChild,"year");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("photos_period_delimiter_"+_)){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.re)(l.firstChild);continue}}s.appendChild(l.firstChild)}if(Photoview.onResize(),Photoview.updatePeriods(),i&&a.only_photos||_>=d||!e)return void(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(r);if(!t)return;cur.pvaLoading=1;const c={offset:n,photos_feed_offset:cur.pvaPhotosFeedOffset,part:1,owner:cur.pvAlbumsShown};cur.pvaPhotosFeedOffset&&(c.photos_feed_offset=cur.pvaPhotosFeedOffset),ajax.post("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(c,a||{}),{onDone(){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.debugLog)("preload done: "+cur.pvaLoading),2==cur.pvaLoading?Photoview.loadedAlbumsPhotos.apply(window,arguments):cur.pvaLoading=!1},onFail:()=>(cur.pvaLoading=0,!0)})},loadAlbumsPhotos(_){const e=_?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pva_more_load_more"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pv_photos_load_more"),t=_?{act:"show_albums"}:{act:"show_albums",only_photos:1},o=_?cur.pvaOffset:cur.pvaPhotosOffset;if(!cur.pvAlbumsShown||!e||!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(e)||(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.isButtonLocked)(e))return;if(cur.pvaLoading)return void(cur.pvaLoading=2);const i={offset:o,part:1,owner:cur.pvAlbumsShown};cur.pvaPhotosFeedOffset&&(i.photos_feed_offset=cur.pvaPhotosFeedOffset),ajax.post("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)(i,t||{}),{cache:t.only_photos?0:1,onDone:Photoview.loadedAlbumsPhotos,onFail:()=>(cur.pvaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(e)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(e)}})},loadedAlbumPhotos(_,e){if(cur.pvaLoading=0,!cur.pvAlbumShown)return;cur.pvsaOffset=_;const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pvsa_content_photos"),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pv_photos_load_more");if(!t)return;t.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cf)(e));if(!cur.pvAlbumData[cur.pvAlbumShown].opts.no_known_count&&_>=cur.pvsaCount||!e)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(o),void Photoview.onResize();setTimeout((()=>{Photoview.onResize()}),10),cur.pvsaLoading=1,ajax.post("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},{onDone(){2==cur.pvsaLoading?Photoview.loadedAlbumPhotos.apply(window,arguments):(cur.pvsaLoading=!1,ajax.preload("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},arguments))},onFail:()=>(cur.pvsaLoading=0,!0)})},loadAlbumPhotos(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pv_photos_load_more"),e=cur.pvsaOffset;cur.pvAlbumShown&&_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(_)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.isButtonLocked)(_)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_album",album:cur.pvAlbumShown,offset:e,part:1},{onDone:Photoview.loadedAlbumPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(_)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(_)},cache:!0}))},loadedTaggedPhotos(_,e){if(cur.pvaLoading=0,!cur.pvPhotoTagShown)return;cur.pvsaOffset=_;const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pvsa_content_photos"),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pv_photos_load_more");t&&(t.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.cf)(e)),Photoview.onResize(),_>=cur.pvsaCount||!e?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)(o):(cur.pvsaLoading=1,ajax.post("al_photos.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.extend)({offset:cur.pvsaOffset,part:1,mid:cur.pvPhotoTagShown},{act:"show_tag"}),{onDone(){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_17__.debugLog)("preload done: ",cur.pvsaLoading),2==cur.pvsaLoading?Photoview.loadedTaggedPhotos.apply(window,arguments):cur.pvsaLoading=!1},onFail:()=>(cur.pvsaLoading=0,!0)})))},loadTaggedPhotos(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("ui_pv_photos_load_more"),e=cur.pvsaOffset;cur.pvPhotoTagShown&&_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.isVisible)(_)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.isButtonLocked)(_)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_tag",mid:cur.pvPhotoTagShown,offset:e,part:1},{onDone:Photoview.loadedTaggedPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.lockButton)(_)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_24__.unlockButton)(_)},cache:1}))},thumbOver(_,e){clearTimeout((cur.pvHideTO||{})[e]);const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pva_title",_),o=t.previousSibling,i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pva_desc",_))[1];i<5||((0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(t,{marginTop:146-(i+7)},{duration:200,transition:_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.Fx.Transitions.easeOutCirc}),"pva_repeat"==o.className&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(o,{marginTop:43-Math.floor((i+7)/2)},{duration:200,transition:_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.Fx.Transitions.easeOutCirc}))},thumbOut(_,e){cur.pvHideTO||(cur.pvHideTO={}),cur.pvHideTO[e]=setTimeout((()=>{const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pva_title",_),t=e.previousSibling;(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(e,{marginTop:146},200),"pva_repeat"==t.className&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_27__.animate)(t,{marginTop:43},200)}),150)},fsMove(_){if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown||!cur.pvCurPhoto.author)return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getXY)(cur.pvActions),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.getSize)(cur.pvActions),o=Math.max(100,.2*cur.pvPhWidth);_.pageX>e[0]-o&&_.pageX<e[0]+t[0]+o&&_.pageY>e[1]-o&&_.pageY<e[1]+t[1]+o?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.addClass)(cur.pvActions,"visible"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.removeClass)(cur.pvActions,"visible")},showRepeat(_){if(!_||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pva_repeat",_))return;const e=window.stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":""),t=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_repeat_album");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pva_link",_).insertBefore((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ce)("div",{className:"pva_repeat",innerHTML:`\n        <div class="pva_repeat_blob">\n         <div class="pva_repeat_cont">\n         <img class="pva_repeat_img png" src="${e}.png?3" />\n         <span class="pva_repeat_text">${t}</span></div>\n        </div>`}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.geByClass1)("pva_title",_))},showPlace(){const _=cur.pvCurPhoto.geohash;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showBox)("al_places.php",{act:"show_photo_place",geohash:_,photo:cur.pvCurPhoto.id},{cache:1})},editPlace(){const _=cur.pvCurPhoto.geohash;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showBox)("al_places.php",{act:"show_photo_place",edit:1,geohash:_||"",photo:cur.pvCurPhoto.id})},updatePlace(_,e){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_edit_place");e?(t&&(t.innerHTML=e?e+".":""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.ge)("pv_place").innerHTML=e?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+e+"</a>":"",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_19__.hide)("pv_add_place")):setTimeout((()=>{ajax.post("al_photos.php",{act:"get_photo_place",photo:_},{onDone:e=>{Photoview.updatePlace(_,e)}})}),1e3)},reportComment(_,e,t){const[o,i]=t.split("_");this.showReportPhotoCommentForm(o,i)},selectProductInBox:function(){const _=cur.pvData[cur.pvListId][cur.pvIndex].attached_tags,e=(_.tags?_.tags.length:0)>=_.max_tags_per_object;if(_.tags&&e)return(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("global_error"),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("market_attach_products_overflow",_.max_tags_per_object)),!1;(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_18__.showAttachNewProductBox)(window.event,{type:"market",refSource:"photo",callback:Photoview.attachProduct})},showNftTokenDetails:function(_){(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_18__.showNftInfo)(window.event,_)},attachProduct:function(_){(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_7__.curBox)().hide();const e=`<span class="attach_market_title">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("market_product_attach_photo")} "${_.title}</span>`,t=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButton.render({children:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("groups_cancel2"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonAppearance.SECONDARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonSize.M,className:"PhotoViewTopPanel__button--dark",restAttrs:{id:"attach_market_cancel"}}),o=_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButton.render({children:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("Save"),appearance:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonAppearance.PRIMARY,size:_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButtonSize.M,disabled:!0,restAttrs:{id:"attach_market_save"}});Photoview.toggleTopInfoPanel(e,[t,o]);const i=()=>{Photoview.toggleTopInfoPanel();const _=cur.pvAttachedProducts;_.point&&_.point.remove(),cur.pvAttachedProducts.isProcess=!1};cur.pvAttachedProducts.isProcess=!0,document.getElementById("attach_market_cancel").addEventListener("click",i),document.getElementById("attach_market_save").addEventListener("click",(function(){i();const e=cur.pvAttachedProducts;if(Object.assign(_,e.tempTag),!e.tempTag)return!1;let t;if(document.getElementById("MarketList")){const[e,o]=Photoview.generateMarketListItem(_);t=e,document.getElementById("MarketList").appendChild(e),cur.pvImageAreaWrap.appendChild(o)}else{const[e,o,i]=Photoview.generateMarketList([_],!0);t=i,cur.pvImageAreaWrap.appendChild(o),document.getElementById("pv_attached_products_list").appendChild(e)}const o=cur.pvData[cur.pvListId][cur.pvIndex],[s,r]=o.id.split("_");_.x=e.tempTag.x,_.y=e.tempTag.y,(0,_vkontakte_internal_vkjs_lib_API__WEBPACK_IMPORTED_MODULE_46__.api)("tags.add",{object:`product${_.id}`,owner_id:Number(s),item_id:Number(r),access_key:o.accessKey,type:"photo",x:e.tempTag.x.toFixed(4),y:e.tempTag.y.toFixed(4)}).then((({id:e})=>{t.id=e,o.attached_tags.tags=o.attached_tags.tags||[],_.tag_id=e,o.attached_tags.tags.push(_)})).catch((_=>console.log(_)))}))},attachProductPoint:function(_){let e=document.getElementById("pv_product_point");e||(e=document.createElement("div"),e.classList.add("attach_market_point"),e.id="pv_product_point");const t=cur.pvImageAreaWrap,o=cur.pvAttachedProducts;o.tempTag=o.tempTag||{},_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_34__.FlatButton.setDisabled(document.getElementById("attach_market_save"),!1);const i=_.currentTarget.getBoundingClientRect(),s=cur.pvAttachedProducts.photoSize,r=_.clientX-i.left-(i.width-s.width)/2,a=_.clientY-i.top-(i.height-s.height)/2;r>0&&a>0&&r<s.width&&a<s.height&&(document.getElementById("pv_product_point")||t.appendChild(e),o.tempTag.y=(_.clientY-i.top-s.top)/s.height,o.tempTag.x=(_.clientX-i.left-(i.width-s.width)/2)/s.width,e.style.top=_.clientY-i.top+"px",e.style.left=_.clientX-i.left+"px"),o.point=e},generateMarketList:function(_){const e=document.createElement("span");e.innerHTML=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_attached_goods"),e.classList.add("pv_photo_product_attach_label");const t=document.createElement("ul");let o;t.id="MarketList",t.classList.add("AttachedProductsList");const i=document.createDocumentFragment(),s=document.createDocumentFragment();if(_){(0,_shared_ecomm_shared_adultApi__WEBPACK_IMPORTED_MODULE_2__.getIsAdultConfirmedStore)().getState()&&(cur.pvCurPhoto.attached_tags.market_isAdultConfirmed=!0),_.forEach((function(e){const t=Photoview.generateMarketListItem(e);1===_.length&&(o=t[0]),i.appendChild(t[0]),s.appendChild(t[1])}))}t.appendChild(i);const r=document.createElement("div");return r.appendChild(e),r.appendChild(t),[r,s,o]},generateMarketListItem:function(_){const e=document.createElement("li");e.id=_.tag_id,e.classList.add("AttachedProductsList__item");const t=document.createElement("a"),o=cur.pvCurPhoto.attached_tags.market_isAdultConfirmed,i=_.is_adult&&!_.is_owner&&!o;let s,r;if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__.partConfigEnabled)("web_market_item_page")){const{item_id:e,owner_id:t,id:o}=_;if(e&&t)r=t,s=e;else{const _=o.split("_");r=_[0],s=_[1]}}else{const e=_.url.match(/product-?\d+_\d+/)[0].replace("product",""),t=(0,_shared_ecomm_utils_marketItemId__WEBPACK_IMPORTED_MODULE_47__.splitRawId)(e);s=t.itemId,r=t.ownerId}const a=(0,_web_ecomm_shared_utils_constructProductLink__WEBPACK_IMPORTED_MODULE_9__.constructProductLink)({baseUrl:`/market${_.owner_id}`,seoSlug:_.seo_slug??"",ownerId:r,itemId:s,refSource:_shared_ecomm_market_stats_types__WEBPACK_IMPORTED_MODULE_36__.RefSource.PHOTO});t.href=a,t.setAttribute("target","_blank");const n=_=>{(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.checkEvent)(_)||(layerQueue.push(),(0,_web_ecomm_shared_utils_openProductWiki__WEBPACK_IMPORTED_MODULE_10__.openProductWiki)({event:_,itemId:s,ownerId:r,href:a,onLoaded:()=>(0,_shared_market_analytics_utils__WEBPACK_IMPORTED_MODULE_35__.onMarketItemCardOpen)({refSource:_shared_ecomm_market_stats_types__WEBPACK_IMPORTED_MODULE_36__.RefSource.PHOTO})}))};"link"!==_.type&&t.addEventListener("click",n),t.classList.add("AttachedProductsList__content");const d=document.createElement("div");d.classList.add("AttachedProductsList__img"),i&&d.classList.add("AttachedProductsList__img--blur"),d.style.backgroundImage="url("+(_.thumb||"/images/market/attach_product_list_placeholder.png")+")",t.appendChild(d);const l=document.createElement("span");l.classList.add("AttachedProductsList__title"),l.innerHTML=i?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("market_adult_product_title"):(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.clean)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.unclean)(_.title)),t.appendChild(l);const c=document.createElement("span");c.classList.add("AttachedProductsList__price"),c.innerHTML=i?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("market_adult_product_price"):_.price,t.appendChild(c),e.appendChild(t);const p=cur.pvData[cur.pvListId][cur.pvIndex],u=document.createElement("button");p.attached_tags&&p.attached_tags.hash&&(u.classList.add("AttachedProductsList__cross"),e.appendChild(u));const h=document.createElement("a");h.href=a,h.setAttribute("target","_blank"),"link"!==_.type&&h.addEventListener("click",n),h.classList.add("pv_attach_product_badge"),h.innerHTML=`\n      <div class="pv_attach_product_badge_text">\n        <div class="pv_attach_product_badge_title">${i?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("market_adult_product_title"):(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.clean)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_21__.unclean)(_.title))}</div>\n        <div class="pv_attach_product_badge_price">${i?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("market_adult_product_price"):_.price}</div>\n      </div>\n      <div class="pv_attach_product_badge_icon">\n        ${(0,_icons_desktop__WEBPACK_IMPORTED_MODULE_48__.getIcon16Chevron)().icon}\n      </div>\n    `;const v=cur.pvImageAreaWrap.getBoundingClientRect(),E=cur.pvAttachedProducts.photoSize,P=176,m=54,g=14,b={top:Math.floor(_.y*E.height)+(v.height-E.height)/2,left:Math.floor(_.x*E.width)+(v.width-E.width)/2,height:m+g,width:P};h.style.top=`${b.top}px`,h.style.left=`${b.left}px`,h.style.opacity="1";const w=Photoview.getBadgePositioningClass({photoSize:E,badgeRect:b});h.classList.add(w);const[D,O]=p.id.split("_");return p.attached_tags&&p.attached_tags.hash&&u.addEventListener("click",(_=>{(0,_vkontakte_internal_vkjs_lib_API__WEBPACK_IMPORTED_MODULE_46__.api)("tags.delete",{type:"photo",access_key:p.accessKey,owner_id:Number(D),item_id:Number(O),tag_id:Number(_.target.parentElement.id)}).then((()=>{const e=cur.pvData[cur.pvListId][cur.pvIndex];e.attached_tags.tags=e.attached_tags.tags.filter((e=>e.tag_id!=_.target.parentElement.id)),h.remove();return document.getElementById("MarketList").childElementCount>1?_.target.parentElement.outerHTML="":document.getElementById("pv_attached_products_list").innerHTML="",(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(_)})).catch((_=>console.log(_)))})),u.addEventListener("mouseover",(_=>{(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_26__.showTooltip)(_.target,{text:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang("photos_pv_act_delete"),black:1,center:!0,shift:[0,3]})})),e.addEventListener("mouseover",(function(){h.style.opacity="1"})),e.addEventListener("mouseout",(function(_){if(e.contains(_.relatedTarget))return!1;h.style.opacity="0"})),cur.pvImageAreaWrap.addEventListener("mouseover",(function(){cur.pvEditorMode||(h.style.opacity="1")})),cur.pvImageAreaWrap.addEventListener("mouseout",(function(_){if(cur.pvImageAreaWrap&&cur.pvImageAreaWrap.contains(_.relatedTarget))return!1;h.style.opacity="0"})),cur.pvAttachedProducts.badges=cur.pvAttachedProducts.badges||[],cur.pvAttachedProducts.badges.push(h),(0,_web_ecomm_market_shared_utils_logViewMarketItemOnPhoto__WEBPACK_IMPORTED_MODULE_37__.logViewMarketItemOnPhoto)(_),[e,h]},isBadgeWiderThanPhoto:({photoWidth:_,badgeWidth:e})=>e>_,getRequiredBadgeSideSize:_=>_/2,isBadgeCroppedFromLeft:({photoSize:_,badgeRect:e})=>{if(Photoview.isBadgeWiderThanPhoto({photoWidth:_.width,badgeWidth:e.width}))return!1;const t=Photoview.getRequiredBadgeSideSize(e.width);return e.left<t},isBadgeCroppedFromRight:({photoSize:_,badgeRect:e})=>{if(Photoview.isBadgeWiderThanPhoto({photoWidth:_.width,badgeWidth:e.width}))return!1;const t=Photoview.getRequiredBadgeSideSize(e.width);return e.left+e.width>_.width-t},isBadgeCroppedFromBottom:({photoSize:_,badgeRect:e})=>!(e.height>_.height)&&e.top>_.height-e.height,getBadgePositioningClass:({photoSize:_,badgeRect:e})=>{const t={photoSize:_,badgeRect:e},o=Photoview.isBadgeCroppedFromLeft(t),i=Photoview.isBadgeCroppedFromRight(t),s=Photoview.isBadgeCroppedFromBottom(t),r="pv_attach_product_badge",a=`${r}--down-middle`;return o||i||s?o&&i&&!s?a:o?s?`${r}--up-right`:`${r}--down-right`:i?s?`${r}--up-left`:`${r}--down-left`:s?`${r}--up-middle`:a:a},showProfileBox:(_,e)=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_25__.showBox)("al_places.php",{act:"photos_box",uid:_},{stat:["maps.js",window.jsc("web/places.js"),"places.css","ui_controls.js","ui_controls.css"]}),Photoview.hide(0),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_20__.cancelEvent)(e),!1)}},757459:(_,e,t)=>{t.d(e,{splitRawId:()=>o});const o=_=>{const[e,t,o]=_.split("_");return{ownerId:Number(e),itemId:Number(t),externalId:void 0!==o?o:null}}},657112:(_,e,t)=>{t.d(e,{CONTAINER_ID_DATASET_PROPERTY:()=>n,CONTAINER_ID_DATA_DEFAULT_VALUE:()=>s,CONTAINER_ID_DATA_PROPERTY:()=>a,ConflictActionsTypes:()=>f,CustomPopUpLayerTypes:()=>b,DEDUCTIBLE_DATA_PROPERTY:()=>c,DEDUCTIBLE_FULL_SCREEN_DATA_PROPERTY:()=>p,DEFAULT_LOOP_LIMIT:()=>D,DEFAULT_PLAYER_OPTIONS:()=>P,DEFAULT_POPUP_CONTAINER_DATA_PROPERTY:()=>u,DEFAULT_POSITION_X:()=>M,DEFAULT_POSITION_Y:()=>T,DEFAULT_SCALE_RATIO:()=>O,FULL_SCREEN_CONTAINER_DATA_PROPERTY:()=>l,FULL_SCREEN_DATA_DEFAULT_VALUE:()=>r,MIN_SIZE_FOR_PLAY:()=>L,MIN_SIZE_FOR_SCALE:()=>C,POPUP_LOTTIE_GROUP:()=>I,POPUP_POSITION_DEFAULT_VALUE:()=>v,POPUP_POSITION_PROPERTY:()=>h,POPUP_STICKER_IM_CONTAINER:()=>d,PopUpLayerTypes:()=>g,PopUpPositionTypes:()=>w,SCREEN_MODIFICATOR:()=>E,SPEED_ON_DESTROY:()=>m});var o=t(995385),i=t(179739);const s="common_container",r="body",a="data-popup-sticker-container-id",n=(0,i.dataAttrKeyToDatasetKey)(a),d="popup-sticker-im-container",l="data-popup-sticker-full-screen-container",c="data-popup-sticker-deductible",p="data-popup-sticker-deductible-full-screen",u="data-popup-sticker-use-common",h="data-popup-sticker-position",v="fixed",E="screen",P={speed:1,loop:!0,autoplay:!1,cache:!0,lazyLoading:!0,direction:o.LottiePlayerDirection.FORWARD,strictCache:!0},m=3,g={Gradient:"gradient",FullScreen:"animation_fullscreen",Fixed:"animation_fixed"},b={Background:"background"},w={FullScreen:"fullscreen",Fixed:"fixed",TopFullScreen:"topFullScreen"},D=1,O=1,M="center",T="middle",C=384,L=64,I="Popup",f={ChangeModificator:"changeModificator",DontShow:"dontShow"}},302091:(_,e,t)=>{t.d(e,{findFixedElement:()=>a,getDataAttrs:()=>i,getDeductibleDataAttrs:()=>r,getPopupElementsFromFixedElement:()=>d,getStringDataAttrs:()=>s});var o=t(657112);const i=_=>{const{popupStickerUseCommon:e="false",popupStickerContainerId:t,popupStickerFullScreenContainer:i,popupStickerPosition:s=o.POPUP_POSITION_DEFAULT_VALUE}=_,r={[o.DEFAULT_POPUP_CONTAINER_DATA_PROPERTY]:e,[o.POPUP_POSITION_PROPERTY]:s,[o.CONTAINER_ID_DATA_PROPERTY]:t};return i&&(r[o.FULL_SCREEN_CONTAINER_DATA_PROPERTY]=i),r},s=_=>{let e="";const t=i(_);return Object.entries(t).forEach((([_,t])=>{e+=`${_}='${t}' `})),e.trim()},r=_=>{const{popupStickerDeductible:e,popupStickerDeductibleFullScreen:t}=_,i={};return e&&(i[o.DEDUCTIBLE_DATA_PROPERTY]=e),t&&(i[o.DEDUCTIBLE_FULL_SCREEN_DATA_PROPERTY]=t),i},a=_=>_.closest(`[${o.CONTAINER_ID_DATA_PROPERTY}]`)||document.body;function n(_,e,t,i,s,r=null){let a=[...document.querySelectorAll(`[${e}=${i}]`)];switch(s&&(a=[...a,...document.querySelectorAll(`[${e}=${o.CONTAINER_ID_DATA_DEFAULT_VALUE}]`)]),a.push(t),_){case"lower":case"parent":a=a.sort(((_,e)=>_.getBoundingClientRect().top-e.getBoundingClientRect().top));break;case"upper":a=a.sort(((_,e)=>_.getBoundingClientRect().bottom-e.getBoundingClientRect().bottom))}const n=a.findIndex((_=>_===t));let d;switch(_){case"upper":case"parent":d=a[n-1]||null;break;case"lower":d=a[n+1]||null;break;default:d=a[0]||null}return d||r}const d=(_,e)=>{const{popupStickerContainerId:t,popupStickerPosition:i,popupStickerUseCommon:s}=(_=>{const{popupStickerUseCommon:e="false",popupStickerPosition:t=o.POPUP_POSITION_DEFAULT_VALUE,popupStickerContainerId:i=o.CONTAINER_ID_DATA_DEFAULT_VALUE}=_.dataset;return{popupStickerContainerId:i,popupStickerUseCommon:e,popupStickerPosition:t}})(_);let r="true"===s;return{fixedElement:_,headerElement:n("upper",o.DEDUCTIBLE_DATA_PROPERTY,e,t,r),footerElement:n("lower",o.DEDUCTIBLE_DATA_PROPERTY,e,t,r),fullScreenElement:n("parent",o.FULL_SCREEN_CONTAINER_DATA_PROPERTY,e,t,r,document.body),fullScreenHeaderElement:n("upper",o.DEDUCTIBLE_FULL_SCREEN_DATA_PROPERTY,e,t,r),fullScreenFooterElement:n("lower",o.DEDUCTIBLE_FULL_SCREEN_DATA_PROPERTY,e,t,r),position:i}}},179739:(_,e,t)=>{t.d(e,{dataAttrKeyToDatasetKey:()=>o});const o=_=>_.slice(5).split("-").map(((_,e)=>0!==e?_.charAt(0).toUpperCase()+_.slice(1):_)).join("")},828441:(_,e,t)=>{t.d(e,{getStore:()=>d});var o=t(32489),i=t(751230),s=t(942451),r=t(73212),a=t(27995);function n(){const _=(0,o.createDomain)("adult"),e=_.createEvent(),t=_.createEvent(),s=_.createEvent(),n=(0,i.createAccountInfoService)({domain:_}),{$accountInfo:d,getInfoFx:l}=n,c=_.createStore((0,r.getEcommInitialData)("market_isAdultConfirmed")??null),p=_.createStore((0,r.getEcommInitialData)("market_isAdultConfirmed")??!1).on(e,((_,e)=>e)),u=_.createStore(!1).on(t,((_,e)=>e));(0,o.sample)({clock:s,source:c,filter:_=>!(0,a.isVKUserAnonymous)()&&null===_,fn:()=>({query:{fields:"market_adult_18plus"}}),target:l}),(0,o.sample)({clock:l.doneData,fn:_=>Boolean(_.market_adult_18plus?.is_adult_confirm),target:e}),(0,o.sample)({clock:l.doneData,fn:_=>Boolean(_.market_adult_18plus?.is_adult_by_profile),target:t});const h=(0,o.createEvent)(),v=(0,o.restore)(h,!1),E=(0,o.createEvent)(),P=(0,o.restore)(E,(()=>{}));return{$isAdultConfirmed:p,$isAdultByProfile:u,setAdultConfirmation:e,initAdultStore:s,$accountInfo:d,$accountInfoFetching:l.pending,setIsAdultModalOpen:h,$isAdultModalOpen:v,cacheAdultItemHandler:E,$adultItemHandler:P}}function d(){return(0,s.makeSharedState)("static/js/modules/shared/ecomm/shared/adultApi/adultStore.ts",n,{version:1})()}},687055:(_,e,t)=>{t(828441)},753842:(_,e,t)=>{t.d(e,{getIsAdultConfirmedStore:()=>i});var o=t(828441);function i(){return(0,o.getStore)().$isAdultConfirmed}},764994:(_,e,t)=>{t.d(e,{getIsAdultConfirmedStore:()=>o.getIsAdultConfirmedStore,initAdultStore:()=>a.initAdultStore,setAdultConfirmation:()=>r.setAdultConfirmation,setUserIsAdult:()=>i.setUserIsAdult,useIsAdultConfirmed:()=>s.useIsAdultConfirmed});var o=t(753842),i=(t(687055),t(301609)),s=t(130964),r=t(476777),a=t(324211)},324211:(_,e,t)=>{t.d(e,{initAdultStore:()=>i});var o=t(828441);function i(){(0,o.getStore)().initAdultStore()}},476777:(_,e,t)=>{t.d(e,{setAdultConfirmation:()=>i});var o=t(828441);function i(_){(0,o.getStore)().setAdultConfirmation(_)}},301609:(_,e,t)=>{t.d(e,{setUserIsAdult:()=>s});var o=t(933052),i=t(476777);function s(){(0,i.setAdultConfirmation)(!0),window.vk.id&&(0,o.api)("market.setUserIsAdult",{})}},130964:(_,e,t)=>{t.d(e,{useIsAdultConfirmed:()=>s});var o=t(293721),i=t(828441);function s(){return(0,o.useStore)((0,i.getStore)().$isAdultConfirmed)}},73212:(_,e,t)=>{t.d(e,{getEcommInitialData:()=>o});const o=_=>(window.ecommInitialState??{})[_]},71894:(_,e,t)=>{t.d(e,{convertWebFeedRefToStatsScreen:()=>a,sendCarouselClickEvent:()=>s,sendFeedOpenAudioStats:()=>r});var o=t(782784),i=t(695290);function s(_,e,t){if(!e||!t)return;let s=null;1===_?s=i.EventItemType.CLICK_NEXT:-1===_?s=i.EventItemType.CLICK_PREVIOUS:0===_&&(s=i.EventItemType.CLICK_PRETTY_CARD),s&&o.feedInteractionItemStatCollector.logEvent({track_code:e,ref:t,item:i.FeedInteractionItemType.WALL_ITEM},s)}function r(_,e){_&&e&&o.feedInteractionItemStatCollector.logEvent({track_code:_,ref:e,item:i.FeedInteractionItemType.WALL_ITEM},i.EventItemType.OPEN_AUDIO)}function a(_){return["feed_news_top","feed_top"].includes(_)?"feed_top":["feed_news_recent","feed_recent","feed"].includes(_)?"feed_recent":["feed_recommended_top","feed_recommended_recent","feed_recommendations","feed_suggestions","recommended"].includes(_)?"feed_recommended":"other"}},123121:(_,e,t)=>{t.d(e,{ANALYTICS_SCREEN_OTHER:()=>s,ANALYTICS_SCREEN_SETTINGS:()=>i,GroupAdminLevel:()=>o});const o={USER:0,MODERATOR:1,EDITOR:2,ADMINISTRATOR:3,HOST:4,EVENT_CREATOR:5,CREATOR:6,PSEUDO_LEVEL_ADVERTISER:100},i="settings",s="other"},359385:(_,e,t)=>{t.d(e,{POPUP_STICKER_MARKET_CONTAINER_ID:()=>o,POPUP_STICKER_PHOTO_CONTAINER_ID:()=>s,POPUP_STICKER_PRODUCT_CONTAINER_ID:()=>i,POPUP_STICKER_VIDEO_CONTAINER_ID:()=>r});const o="popup-sticker-market-react-container",i="popup-sticker-product-container",s="popup-sticker-photoview-container",r="popup-sticker-videoview-container"},62870:(_,e,t)=>{t.d(e,{popUpGetStringDataAttrs:()=>s});var o=t(302091),i=t(805088);const s=_=>(0,i.isPopUpStickersEnabled)()?(0,o.getStringDataAttrs)(_):""},27995:(_,e,t)=>{t.d(e,{isVKUserAnonymous:()=>i});var o=t(388078);const i=()=>o.Ranges.isZeroOwner(window.vk.id)},553218:(_,e,t)=>{t.d(e,{logViewMarketItemOnPhoto:()=>r});var o=t(338148),i=t(843335),s=t(70933);function r(_){o.viewAnalytics.logMarketItemView({view:{start_view:"0",end_view:"0"},screen:(0,i.getStatScreen)(),ref_source:s.RefSource.PHOTO,params:{item_id:_.item_id,owner_id:_.owner_id,search_query_id:0,item_idx:0}})}},545729:(_,e,t)=>{t.d(e,{FILTER_MAX_PRICE:()=>r,GROUP_HEADER_QUERY_PARAM:()=>n,INPUT_REQUEST_DEBOUNCE:()=>a,MARKET_CATALOG_SCREEN_DEFAULT:()=>o,MARKET_LEFT_MENU_SCREEN:()=>i,MARKET_SEARCH_QUERY_ID:()=>s});const o="marketplace",i="market",s="market_search_query_id",r=5e9,a=1e3,n="with_group_header"},928372:(_,e,t)=>{t.d(e,{constructProductLink:()=>r});var o=t(112268),i=t(545729),s=t(476726);function r({baseUrl:_,screen:e,refSource:t,refScreen:r,itemId:a,ownerId:n,externalId:d,ref:l,type:c,withGroupHeader:p,seoSlug:u=""}){const h=new URLSearchParams;if(!(0,s.partConfigEnabled)("web_market_item_page")){const _=(0,o.joinRawId)({itemId:a,ownerId:n,externalId:d});h.set("w",`product${_}`)}return t&&h.set("ref_source",t),r&&h.set("ref_screen",r),l&&h.set("ref",l),e&&h.set("screen",e),c&&h.set("type",c),p&&h.set(i.GROUP_HEADER_QUERY_PARAM,"1"),(0,s.partConfigEnabled)("web_market_item_page")?(0,s.partConfigEnabled)("market_item_page_hru")?`${window.location.origin}/market/product/${u}${n}-${a}${h.toString()?`?${h.toString()}`:""}`:`${window.location.origin}/market/product/${n}-${a}${h.toString()?`?${h.toString()}`:""}`:`${_}?${h.toString()}`}},988397:(_,e,t)=>{t.d(e,{openProductWiki:()=>n});var o=t(112268),i=t(476726),s=t(387674),r=t(545729),a=t(927984);function n({ownerId:_,itemId:e,event:t,externalId:n,onLoaded:d,from:l,params:c,href:p,adParams:u,isService:h,refSource:v}){if(t?.preventDefault(),t?.stopPropagation(),t?.persist?.(),(0,i.partConfigEnabled)("web_market_item_page")){const _=document.createElement("a");if(_.setAttribute("target","_blank"),p){const e=new URL(p),t=(0,s.fromQueryString)(e.search.slice(1)),o=("groups"===window.cur.module||"public"===window.cur.module)&&!h;o&&(t[r.GROUP_HEADER_QUERY_PARAM]="1"),v&&(t.ref_source=v);const i=o?`${e.pathname}?${(0,s.toQueryString)(t)}`:p;_.setAttribute("href",i)}_.click()}else{const i=(0,o.joinRawId)({itemId:e,ownerId:_,externalId:n});(0,a.showWiki)({w:`product${i}/query`,from:l,...c},!1,t,{queue:1,onLoaded:d,adParams:u})}}},159374:(_,e,t)=>{var o=t(490712),i=t(994815);window.vk?.pe?.static_manager_dynamic_imports&&window.vk?.stDomain&&(t.p=window.vk.stDomain+"/dist/"),window.Photoview=i.Photoview;try{window.stManager.done(window.jsc("web/photoview.js"))}catch(_){}requestIdleCallback((()=>{try{(0,o.statlogsValueEvent)("entries_requests",1,"photoview","web")}catch{}}),{timeout:5e3})},966665:(_,e,t)=>{t.d(e,{recognizeBlockState:()=>o});const o=(0,t(942451).makeSharedState)("photo_recognize_block",(()=>({block:null})),{version:0})},512243:(_,e,t)=>{t.d(e,{FEED_RECOGNIZE_PHOTO_DEFAULT_BLOCK_TYPE:()=>c,FEED_RECOGNIZE_PHOTO_POST_ID:()=>l,NUMBER_INITIALIZED_PHOTO:()=>p,PHOTO_CAROUSEL_AVATAR_CLASS:()=>n,PHOTO_CAROUSEL_CLASS:()=>o,PHOTO_CAROUSEL_HIDE_BTN_CLASS:()=>d,PHOTO_CAROUSEL_ITEM_CLASS:()=>i,PHOTO_CAROUSEL_ITEM_NO_SIZE_CLASS:()=>s,PHOTO_ELEMENT_CLASS:()=>r,PHOTO_NO_SIZE_ELEMENT_CLASS:()=>a});const o="PhotoCarousel",i="PhotoCarouselItem",s="PhotoCarouselItem--noSize",r="PhotoCarouselImage",a="PhotoCarouselItem__stub",n="PhotoCarouselBlockItem__avatar",d="PhotoCarousel__hidePost",l="tags_suggestions",c="tags_suggestions",p=4},468189:(_,e,t)=>{t.d(e,{attachPlayerEventHandler:()=>b,checkIfLinkIsValid:()=>D,feedShowMoreButtonLoadedCount:()=>O,getCommentsSortEvent:()=>L,handleViewingFeedBlocks:()=>T,handleViewingPosts:()=>M,isFeedPostDurationStatsFixEnabled:()=>g,isFeedRepliesStatsEnabled:()=>I,sendCaptionLinkClickEvent:()=>C,sendCarouselClickEventWeb:()=>w});var o=t(476726),i=t(681589),s=t(71894),r=t(116346),a=t(374036),n=t(617430),d=t(7144),l=t(946076),c=t(185628),p=t(512243),u=t(966665),h=t(248298),v=t(490712),E=t(197971),P=t(695290),m=t(782784);function g(){return(0,o.partConfigEnabled)("feed_posts_duration_stats_fix")}function b({isAudioChanged:_,attachElement:e}){if(!_||!e)return;const t=(0,i.getTrackCodeFromPost)(e),o=(0,i.resolveRefFromCur)();(0,s.sendFeedOpenAudioStats)(t,o)}function w(_,e,t){(0,s.sendCarouselClickEvent)(_,e,t)}function D(_){return"Post/ownerLinkClick"!==_?.getAttribute("data-task-click")&&!_?.closest(".PostActivityCaption, .PostActivityBar")&&!_?.closest(".ui_actions_menu_item")}const O=(_,e,t)=>{let o=document.getElementById("show_more_link"),i=o?.offsetTop??0;o&&!o.seen&&i>=e&&i<e+t&&(o.seen=Date.now(),(0,v.statlogsValueEvent)("feed_load_more_seen",(0,h.isButtonLocked)(o),_))},M=({posts:_=[],postRaws:e,el:t})=>t?((0,E.isAdWithLongImpressionOnly)(t)||(0,E.isAutoplayAd)(t)?window.Wall.triggerAdStat(t.firstElementChild,"impression"):e&&_?.push(e),_??[]):_??[],T=({el:_,index:e,ref:t,onView:o})=>{if(_)if(_.querySelector(".VideosForYouGallery"))window.FeedVideosForYou?.viewBlock(),o?.();else if(_.querySelector(".FeedVideoPostcard"))window.FeedVideoPostcard?.viewBlock(),o?.();else if(_.querySelector(".UxpollsBlock")){const e=_.querySelector(".UxpollsBlock")?.dataset.trackCode;e&&((0,r.viewUXPollsBlock)(e),o?.())}else if(_.querySelector(".feed_friends_recomm")){let i=_.querySelector(`.${a.UI_GALLERY_CLASSNAME}`);const s=i?.getAttribute("data-from");let r=i?.getAttribute("data-code");if(s&&r&&((0,n.friendsRecommLogSave)(["view_block",s,String(e),(0,d.vkNow)(),String(t??""),r],!0),o?.()),i){const _=(0,l.uiGetGallery)(i);_?.setGalleryViewed?.(),o?.()}}else _.querySelector(".js-feed_groups_recomm")?((0,c.feedInitialViewRecommendedGroupsTrigger)(_,e),o?.()):_.querySelector("#feed_mini_apps_recomm")?(window.RecommendedMiniApps.viewBlock(),o?.()):_.querySelector(`#${p.FEED_RECOGNIZE_PHOTO_POST_ID}`)&&((0,u.recognizeBlockState)().block?.viewBlock(),o?.())};function C(_,e){m.feedInteractionItemStatCollector.logEvent({track_code:_??void 0,ref:e,item:P.FeedInteractionItemType.WALL_ITEM},P.EventItemType.CAPTION_LINK_CLICK)}function L(_){return{asc:"sort_oldest",desc:"sort_latest",smart:"sort_popular"}[_]}function I(){return(0,o.partConfigEnabled)("feed_replies_stats_web")}},197971:(_,e,t)=>{t.d(e,{getFeedPosts:()=>E,isAdWithLongImpression:()=>c,isAdWithLongImpressionOnly:()=>p,isAdWithShowOff:()=>u,isAutoplayAd:()=>l,isElemViewable:()=>v,isInFeed:()=>P,postsGetRaws:()=>d});var o=t(5829),i=t(452314),s=t(879007),r=t(681589),a=t(167517),n=t(476726);const d=_=>{if(!(_ instanceof HTMLElement))return{};let e=(0,s.indexOf)((0,i.domPN)(_).children,_),t=_.firstElementChild;if(!(t instanceof HTMLElement))return{};for(;t&&t.id.startsWith("moat");)t=(0,i.domNS)(t);if(!(t instanceof HTMLElement))return{};let o,n,d,l=/^post(-?\d+_\d+)$/,c={};if("ads_feed_placeholder"===t.id)return c;const p=window.cur;c={module:(0,r.resolveRef)(p.module,p.section,p.subsection),index:e},"feed"===p.module&&"search"===p.section&&(c.q=p.q);let u=(0,a.getAdAttribute)(t,"ad-view");u&&(c["ad_"+u]=1);let h=t.getAttribute("post_view_hash");h&&(c.hash=h);let v=t.getAttribute("data-post-track-code");if(v&&!u&&(c.trackCode=v),"block_"===t.id.substr(0,6)){c[t.id]=1,c.block=t.id.substr(6);let _=(0,i.attr)(t,"data-contain");_&&_.split(",").forEach((function(_){const e=_.split(":");c[e[0]]=(0,s.intval)(e[1])||1}))}else if(n=t.id.match(l))c[n[1]]=1;else if(n=t.id.match(/^post(adsite.*)$/))c[n[1]]=1;else if(o=t.className,n=o.match(/feed_reposts_wrap(-?\d+_\d+)/)){if(d=(0,i.domFC)(t),(0,i.hasClass)((0,i.domFC)(d),"post_copy")&&(c[n[1]]=-1),(n=(0,i.domFC)(d)?.id.match(l))&&(c[n[1]]=1),(0,i.isVisible)(d=(0,i.domNS)(d)))for(d=(0,i.domFC)(d);d;d=(0,i.domNS)(d))(n=d?.id.match(l))&&(c[n[1]]=1)}else if(n=o.match(/feed_repost(-?\d+_\d+)/)){if(d=(0,i.domFC)(t),!d)return c;(0,i.hasClass)(d,"post_copy")&&(c[n[1]]=-1),(n=d.id.match(l))&&(c[n[1]]=1)}else{let _=t.id;if((0,i.hasClass)(t,"post_photos")){d=(0,i.geByClass1)("post_image",t,"a");const e=d?.querySelector?.("[data-post-id]")?.getAttribute("data-post-id");e&&(n=e.match(/^(-?\d+_p?\d+)$/),n&&(_=n[1]))}c[_]=1}return c},l=_=>{const e=_&&(0,i.domFC)(_);return e&&((0,n.partConfigEnabled)("post_adguard_protection_promo")?(0,a.getAdAttribute)(e,"ad-video-autoplay"):e.hasAttribute("data-ad-video-autoplay"))},c=_=>{const e=_&&(0,i.domFC)(_);return e&&((0,n.partConfigEnabled)("post_adguard_protection_promo")?(0,a.getAdAttribute)(e,"ad-stat-impression_long")||(0,a.getAdAttribute)(e,"ad-disabled-stat-impression_long"):e.hasAttribute("data-ad-stat-impression_long")||e.hasAttribute("data-ad-disabled-stat-impression_long"))},p=_=>{let e=_&&(0,i.domFC)(_);return e&&((0,n.partConfigEnabled)("post_adguard_protection_promo")?(0,a.getAdAttribute)(e,"ad-views-long-only"):e.hasAttribute("data-ad-views-long-only"))},u=_=>{let e=_&&(0,i.domFC)(_);return e&&((0,n.partConfigEnabled)("post_adguard_protection_promo")?(0,a.getAdAttribute)(e,"ad-stat-show_off"):e.hasAttribute("data-ad-stat-show_off"))},h=(0,o.memoizeFirstTruthy)((()=>(0,i.ge)("page_header").offsetHeight)),v=(_,e,t,o)=>{let i=h(),s=t+i,r=t+o,a=_.offsetHeight,n=_.offsetTop+i,d=n+a;return(d>s&&n<r?(Math.min(r,d)-Math.max(s,n))/a:0)>=e},E=_=>document.querySelectorAll(`${_} .feed_row`),P=()=>"feed"===window.cur?.module},617430:(_,e,t)=>{t.d(e,{friendsRecommLogClear:()=>l,friendsRecommLogGet:()=>d,friendsRecommLogOnFail:()=>u,friendsRecommLogSave:()=>n,friendsRecommLogSend:()=>c,getRef:()=>a});var o,i=t(250682),s=t(879007),r=t(624216);!function(_){_.friends_recomm="friends_recomm"}(o||(o={}));const a=()=>"feed"===window.cur.module&&window.Feed?window.Feed?.getModuleRef():window.cur.module;function n(_,e=!1){const t=d();t.push(_),i.multiAccountLs.set("friends_recomm",t),c(e)}function d(_=!1,e,t=!1){const o=i.multiAccountLs.get("friends_recomm");let r=Array.isArray(o)?o:[];return e&&(r=r.filter((_=>(t?_[1]!==e:_[1]===e)&&(0,s.inArray)(_[0],["show_user_rec","open_user"])))),_&&(r=r.map((_=>_.join("|")))),r}function l(_){if(_){const e=d(!1,_,!0);e.length?i.multiAccountLs.set("friends_recomm",e):i.multiAccountLs.remove("friends_recomm")}else i.multiAccountLs.remove("friends_recomm")}function c(_=!1){!window.cur?.friendsRecommLogIdle&&window?.curNotifier?.idle_manager&&(Array.isArray(window.cur.onIdle)||(window.cur.onIdle=[]),Array.isArray(window.cur.onUnidle)||(window.cur.onUnidle=[]),window.cur.friendsRecommLogIdle=()=>{clearTimeout(window.cur.friendsRecommLog)},window.cur.onIdle.push(window.cur.friendsRecommLogIdle),window.cur.onUnidle.push(c)),clearTimeout(window.cur.friendsRecommLog),_?p():window.cur.friendsRecommLog=window.setTimeout(p,1e4)}function p(){if(window.cur.friendsRecommProcess)return;const _=d(!0);_.length&&(window.cur.friendsRecommProcess=!0,l(),r.ajax.post("al_friends.php",{act:"a_recomm_logs",logs:_},{onDone:()=>{delete window.cur.friendsRecommProcess},onFail:()=>(u(_),delete window.cur.friendsRecommProcess,!0)}))}function u(_){let e=d();e=_.map((_=>_.split("|"))).concat(e),i.multiAccountLs.set("friends_recomm",e)}},185628:(_,e,t)=>{t.d(e,{blockInstanceSetForFeedRowContent:()=>r,feedInitialViewRecommendedGroupsTrigger:()=>s});var o=t(946076);const i="__RecommendedGroups";function s(_,e){const t=_.querySelector(".js-feed_groups_recomm"),s=_.querySelector(".ui_gallery");if(!t||!s)return void console.error(new Error("RecommendedGroups: missing block container for view"),t,s);const r=s.getAttribute("data-code")||"",a=t[i]??void 0;if(!a)return void console.error(new Error("RecommendedGroups: missing block instance"),t,s);const n="number"==typeof e?e:void 0;a.viewBlock(r,n);const d=(0,o.uiGetGallery)(s);d&&d.getVisibleItems().forEach((_=>{a.onViewGroup(_[0])})),s.visible=!0}function r(_,e){_[i]=e}},116346:(_,e,t)=>{t.d(e,{clickUXPollsBlock:()=>s,viewUXPollsBlock:()=>i});var o=t(490712);function i(_){(0,o.statlogsValueEvent)("uxpolls_view",_)}function s(_){(0,o.statlogsValueEvent)("uxpolls_click",_)}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(_){var e=__webpack_module_cache__[_];if(void 0!==e)return e.exports;var t=__webpack_module_cache__[_]={id:_,loaded:!1,exports:{}};return __webpack_modules__[_].call(t.exports,t,t.exports,__webpack_require__),t.loaded=!0,t.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(_,e,t,o)=>{if(!e){var i=1/0;for(n=0;n<deferred.length;n++){for(var[e,t,o]=deferred[n],s=!0,r=0;r<e.length;r++)(!1&o||i>=o)&&Object.keys(__webpack_require__.O).every((_=>__webpack_require__.O[_](e[r])))?e.splice(r--,1):(s=!1,o<i&&(i=o));if(s){deferred.splice(n--,1);var a=t();void 0!==a&&(_=a)}}return _}o=o||0;for(var n=deferred.length;n>0&&deferred[n-1][2]>o;n--)deferred[n]=deferred[n-1];deferred[n]=[e,t,o]},__webpack_require__.n=_=>{var e=_&&_.__esModule?()=>_.default:()=>_;return __webpack_require__.d(e,{a:e}),e},getProto=Object.getPrototypeOf?_=>Object.getPrototypeOf(_):_=>_.__proto__,__webpack_require__.t=function(_,e){if(1&e&&(_=this(_)),8&e)return _;if("object"==typeof _&&_){if(4&e&&_.__esModule)return _;if(16&e&&"function"==typeof _.then)return _}var t=Object.create(null);__webpack_require__.r(t);var o={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&e&&_;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((e=>o[e]=()=>_[e]));return o.default=()=>_,__webpack_require__.d(t,o),t},__webpack_require__.d=(_,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(_,t)&&Object.defineProperty(_,t,{enumerable:!0,get:e[t]})},__webpack_require__.f={},__webpack_require__.e=_=>Promise.all(Object.keys(__webpack_require__.f).reduce(((e,t)=>(__webpack_require__.f[t](_,e),e)),[])),__webpack_require__.u=_=>45458===_?"web/chunks/hls.c49a3f53.js":56229===_?"web/chunks/366130d1.async.1c06797d.js":30072===_?"web/chunks/showCaptchaPopup.a4740a52.js":19072===_?"web/chunks/left_menu_store.b41d694b.js":42255===_?"web/chunks/wikiModalExampleInitiator.bf570c13.js":56965===_?"web/chunks/stories_web_lib.ba126e07.js":17213===_?"web/chunks/2bd60279.async.ea157d31.js":42943===_?"web/chunks/video_web_lib.782f771d.js":53927===_?"web/chunks/questions_boxes_web.d05c4563.js":40482===_?"web/chunks/0ca8e07a.async.981f6895.js":12679===_?"web/chunks/2c4420c0.async.0fa14a60.js":40617===_?"web/chunks/93bd35f8.async.944fc663.js":27602===_?"web/chunks/2fea6d3f.async.fa8b17c6.js":24535===_?"web/chunks/4e9ddeeb.async.0371d26b.js":74336===_?"web/chunks/show_audio_playlist.c4ee742f.js":93033===_?"web/chunks/a6f550f7.async.84ccbfa1.js":89870===_?"web/chunks/5ad2d924.async.2e93ba52.js":17895===_?"web/chunks/money_transfer_box.50183b92.js":50905===_?"web/chunks/money_transfer.e2c2d345.js":21608===_?"web/chunks/bf8fbce1.async.1f467086.js":66118===_?"web/chunks/6fb21264.async.74f2b319.js":36237===_?"web/chunks/2fb8e07d.async.2c799e4e.js":56154===_?"web/chunks/cc6f5392.async.8d8a5bcd.js":58292===_?"web/chunks/437a8ce6.async.378b5454.js":49925===_?"web/chunks/8af15a4d.async.5eadc2fd.js":68349===_?"web/chunks/5f266f5f.async.3ed461f1.js":25459===_?"web/chunks/2c9432b5.async.06e9b990.js":84835===_?"web/chunks/unauth_action_box.29aa267e.js":23045===_?"web/chunks/0d674423.async.5458427b.js":71247===_?"web/chunks/364659da.async.59a0e75a.js":59886===_?"web/chunks/StoryPublisherV2.2ad86f85.js":70989===_?"web/chunks/4b497ab9.async.e13543c1.js":29311===_?"web/chunks/feed-client-nav-skeleton.774b8a5c.js":56091===_?"web/chunks/feed-client-nav-async-right-block.323099af.js":1715===_?"web/chunks/AudioLongtapModal.d6e38506.js":96649===_?"web/chunks/ecomm_market_product_attach.e1343ea9.js":51713===_?"web/chunks/voice_message_player.172315d5.js":9925===_?"web/chunks/speech.257a7e64.js":99595===_?"web/chunks/ReportForm.ee85cb0b.js":73248===_?"web/chunks/5792d39d.async.ad94820b.js":42099===_?"web/chunks/58131fc9.async.2e7c43e3.js":51943===_?"web/chunks/VideoUpload.8e2a8bde.js":73214===_?"web/chunks/SilentModeForms.c8c406fe.js":73035===_?"web/chunks/apps_attach_modal.8fe17bc5.js":52781===_?"web/chunks/primary_attachments_carousel.5d130da4.js":69706===_?"web/chunks/e0383668.async.b99eb451.js":43802===_?"web/chunks/d5b01a55.async.6a0ae0bd.js":10504===_?"web/chunks/StoriesCreatorVKApp.f31236ac.js":54833===_?"web/chunks/performance-stats.99d41d48.js":57088===_?"web/chunks/79f739a7.async.7b7d443d.js":32643===_?"web/chunks/story_blocks.0da84ca4.js":13410===_?"web/chunks/283c0b16.async.33f5912b.js":17448===_?"web/chunks/b1bc3b17.async.86dcbc32.js":99370===_?"web/chunks/VideoEditorModal.cd800b6f.js":95805===_?"web/chunks/PublishClipToVideoModal.fb197348.js":91906===_?"web/chunks/VideoUploadModal.07557685.js":74205===_?"web/chunks/VideoExternalUploadModal.15030051.js":36637===_?"web/chunks/ClipUploadModal.bb853a52.js":18493===_?"web/chunks/AddClipToVideoBlock.d29cc984.js":40953===_?"web/chunks/AddClipToVideoModal.6f004f3e.js":60274===_?"web/chunks/ClipPlayerModule.600f713b.js":60899===_?"chunks/"+_+".0471a2c1.js":40074===_?"chunks/"+_+".4d8e0cba.js":37557===_?"chunks/"+_+".46b5840d.js":29290===_?"chunks/"+_+".b54ef2c0.js":{17356:"web/chunks/videoplayer-interactive",57407:"web/chunks/shopify"}[_]+"."+{17356:"95a5926a",57407:"78df6599"}[_]+".js",__webpack_require__.miniCssF=_=>30072===_?"web/chunks/eba149c1.css":{74336:1,17895:1,50905:1}[_]?"web/chunks/43d06ff5.css":59886===_?"web/chunks/c3646f82.css":1715===_?"web/chunks/4aa73755.css":96649===_?"web/chunks/8272fe04.css":99595===_?"web/chunks/fb872de1.css":51943===_?"web/chunks/443c0dba.css":73214===_?"web/chunks/122e7a6e.css":73035===_?"web/chunks/a16fc671.css":52781===_?"web/chunks/11be77d5.css":10504===_?"web/chunks/8a71df77.css":32643===_?"web/chunks/1deee1aa.css":99370===_?"web/chunks/aa88a2a7.css":95805===_?"web/chunks/70c35bc4.css":{91906:1,74205:1,36637:1}[_]?"web/chunks/f89919fd.css":18493===_?"web/chunks/85bd25a0.css":40953===_?"web/chunks/d66415b4.css":60274===_?"web/chunks/a9cca8ef.css":void 0,__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(_){if("object"==typeof window)return window}}(),__webpack_require__.hmd=_=>((_=Object.create(_)).children||(_.children=[]),Object.defineProperty(_,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+_.id)}}),_),__webpack_require__.o=(_,e)=>Object.prototype.hasOwnProperty.call(_,e),inProgress={},__webpack_require__.l=(_,e,t,o)=>{if(inProgress[_])inProgress[_].push(e);else{var i,s;if(void 0!==t)for(var r=document.getElementsByTagName("script"),a=0;a<r.length;a++){var n=r[a];if(n.getAttribute("src")==_||n.getAttribute("data-webpack")=="vk:"+t){i=n;break}}i||(s=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,__webpack_require__.nc&&i.setAttribute("nonce",__webpack_require__.nc),i.setAttribute("data-webpack","vk:"+t),i.src=_),inProgress[_]=[e];var d=(e,t)=>{i.onerror=i.onload=null,clearTimeout(l);var o=inProgress[_];if(delete inProgress[_],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((_=>_(t))),e)return e(t)},l=setTimeout(d.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),s&&document.head.appendChild(i)}},__webpack_require__.r=_=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},__webpack_require__.p="/dist/",loadStylesheet=_=>new Promise(((e,t)=>{var o=__webpack_require__.miniCssF(_),i=__webpack_require__.p+o;if(((_,e)=>{for(var t=document.getElementsByTagName("link"),o=0;o<t.length;o++){var i=(r=t[o]).getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(i===_||i===e))return r}var s=document.getElementsByTagName("style");for(o=0;o<s.length;o++){var r;if((i=(r=s[o]).getAttribute("data-href"))===_||i===e)return r}})(o,i))return e();((_,e,t,o)=>{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onerror=i.onload=s=>{if(i.onerror=i.onload=null,"load"===s.type)t();else{var r=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.href||e,n=new Error("Loading CSS chunk "+_+" failed.\n("+a+")");n.code="CSS_CHUNK_LOAD_FAILED",n.type=r,n.request=a,i.parentNode.removeChild(i),o(n)}},i.href=e,document.head.appendChild(i)})(_,i,e,t)})),installedCssChunks={53089:0},__webpack_require__.f.miniCss=(_,e)=>{installedCssChunks[_]?e.push(installedCssChunks[_]):0!==installedCssChunks[_]&&{1715:1,10504:1,17895:1,18493:1,30072:1,32643:1,36637:1,40953:1,50905:1,51943:1,52781:1,59886:1,60274:1,73035:1,73214:1,74205:1,74336:1,91906:1,95805:1,96649:1,99370:1,99595:1}[_]&&e.push(installedCssChunks[_]=loadStylesheet(_).then((()=>{installedCssChunks[_]=0}),(e=>{throw delete installedCssChunks[_],e})))},(()=>{__webpack_require__.b=document.baseURI||self.location.href;var _={53089:0};__webpack_require__.f.j=(e,t)=>{var o=__webpack_require__.o(_,e)?_[e]:void 0;if(0!==o)if(o)t.push(o[2]);else{var i=new Promise(((t,i)=>o=_[e]=[t,i]));t.push(o[2]=i);var s=__webpack_require__.p+__webpack_require__.u(e),r=new Error;__webpack_require__.l(s,(t=>{if(__webpack_require__.o(_,e)&&(0!==(o=_[e])&&(_[e]=void 0),o)){var i=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;r.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",r.name="ChunkLoadError",r.type=i,r.request=s,o[1](r)}}),"chunk-"+e,e)}},__webpack_require__.O.j=e=>0===_[e];var e=(e,t)=>{var o,i,[s,r,a]=t,n=0;if(s.some((e=>0!==_[e]))){for(o in r)__webpack_require__.o(r,o)&&(__webpack_require__.m[o]=r[o]);if(a)var d=a(__webpack_require__)}for(e&&e(t);n<s.length;n++)i=s[n],__webpack_require__.o(_,i)&&_[i]&&_[i][0](),_[i]=0;return __webpack_require__.O(d)},t=self.webpackChunkvkweb=self.webpackChunkvkweb||[];t.forEach(e.bind(null,0)),t.push=e.bind(null,t.push.bind(t))})();var __webpack_exports__=__webpack_require__.O(void 0,[91498,50560,89631,85172,762,21529,79210,35623,81765,23592,25304,73085,18373,77137,60188,36294,77805,80731,11917],(()=>__webpack_require__(159374)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();