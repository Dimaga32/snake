"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[5375],{562791:(e,t,i)=>{i.d(t,{Icon16LockOutline:()=>o});var o=(0,i(844990).makeIcon)("Icon16LockOutline","lock_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="lock_outline_16"><path fill="currentColor" fill-rule="evenodd" d="M2 10c0-1.4 0-2.1.273-2.635a2.5 2.5 0 0 1 1.092-1.093c.297-.15.645-.218 1.135-.248V4.5a3.5 3.5 0 1 1 7 0v1.524c.49.03.838.097 1.135.249a2.5 2.5 0 0 1 1.093 1.092C14 7.9 14 8.6 14 10v1c0 1.4 0 2.1-.272 2.635a2.5 2.5 0 0 1-1.093 1.093C12.1 15 11.4 15 10 15H6c-1.4 0-2.1 0-2.635-.272a2.5 2.5 0 0 1-1.092-1.093C2 13.1 2 12.4 2 11zm8-2.5H6c-.725 0-1.178.001-1.52.029-.324.027-.413.07-.434.08a1 1 0 0 0-.437.437c-.01.02-.053.11-.08.434-.028.342-.029.795-.029 1.52v1c0 .725.001 1.178.029 1.52.027.324.07.413.08.434a1 1 0 0 0 .437.437c.02.01.11.053.434.08.342.028.795.029 1.52.029h4c.725 0 1.178-.001 1.52-.03.324-.026.413-.069.434-.079a1 1 0 0 0 .437-.437c.01-.02.053-.11.08-.434.028-.342.029-.795.029-1.52v-1c0-.725-.001-1.178-.03-1.52-.026-.324-.069-.413-.079-.434a1 1 0 0 0-.437-.437c-.02-.01-.11-.053-.434-.08-.342-.028-.795-.029-1.52-.029M10 6H6V4.5a2 2 0 1 1 4 0z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},373206:(e,t,i)=>{i.d(t,{Icon16UnlockOutline:()=>o});var o=(0,i(844990).makeIcon)("Icon16UnlockOutline","unlock_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="unlock_outline_16"><path fill="currentColor" fill-rule="evenodd" d="M2 10c0-1.4 0-2.1.273-2.635a2.5 2.5 0 0 1 1.092-1.093c.297-.15.645-.218 1.135-.248V4.5a3.5 3.5 0 0 1 6.867-.957.75.75 0 1 1-1.443.41A2 2 0 0 0 6 4.5V6h4c1.4 0 2.1 0 2.635.273a2.5 2.5 0 0 1 1.093 1.092C14 7.9 14 8.6 14 10v1c0 1.4 0 2.1-.272 2.635a2.5 2.5 0 0 1-1.093 1.093C12.1 15 11.4 15 10 15H6c-1.4 0-2.1 0-2.635-.272a2.5 2.5 0 0 1-1.092-1.093C2 13.1 2 12.4 2 11zm8-2.5H6c-.725 0-1.178.001-1.52.029-.324.027-.413.07-.434.08a1 1 0 0 0-.437.437c-.01.02-.053.11-.08.434-.028.342-.029.795-.029 1.52v1c0 .725.001 1.178.029 1.52.027.324.07.413.08.434a1 1 0 0 0 .437.437c.02.01.11.053.434.08.342.028.795.029 1.52.029h4c.725 0 1.178-.001 1.52-.03.324-.026.413-.069.434-.079a1 1 0 0 0 .437-.437c.01-.02.053-.11.08-.434.028-.342.029-.795.029-1.52v-1c0-.725-.001-1.178-.03-1.52-.026-.324-.069-.413-.079-.434a1 1 0 0 0-.437-.437c-.02-.01-.11-.053-.434-.08-.342-.028-.795-.029-1.52-.029" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},549318:(e,t,i)=>{i.d(t,{Icon20Add:()=>o});var o=(0,i(844990).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="add_20"><path fill-rule="evenodd" d="M10 3a.75.75 0 0 1 .75.75v5.5h5.5a.75.75 0 0 1 0 1.5h-5.5v5.5a.75.75 0 0 1-1.5 0v-5.5h-5.5a.75.75 0 0 1 0-1.5h5.5v-5.5A.75.75 0 0 1 10 3" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},289150:(e,t,i)=>{i.d(t,{Icon20DownloadOutline:()=>o});var o=(0,i(844990).makeIcon)("Icon20DownloadOutline","download_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="download_outline_20"><g fill="currentColor"><path fill-rule="evenodd" d="M4 17.75a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75a.75.75 0 0 1-.75-.75" clip-rule="evenodd" /><path d="M10.75 2.726c0-.401-.336-.726-.75-.726a.74.74 0 0 0-.75.726v9.722l-3.97-3.97a.75.75 0 0 0-1.06 1.06l5.245 5.246a.75.75 0 0 0 1.06 0l5.257-5.256a.75.75 0 0 0-1.061-1.061l-3.972 3.972z" /></g></symbol>',20,20,!1,void 0)},524057:(e,t,i)=>{i.d(t,{default:()=>o});const o={playlistPrivateIcon:"PlaylistCheckboxTooltip-module__playlistPrivateIcon--RZ6VJ"}},594816:(e,t,i)=>{i.d(t,{default:()=>o});const o={playlistSubhead:"VideoPlaylistsModal-module__playlistSubhead--oO2Bo"}},943852:(e,t,i)=>{i.d(t,{default:()=>o});const o={playlistSubhead:"ModalBodyComponent-module__playlistSubhead--oSeEB"}},882931:(e,t,i)=>{i.d(t,{default:()=>o});const o={playlistPrivateIcon:"PlaylistPopover-module__playlistPrivateIcon--_8Rba",playlistSubhead:"PlaylistPopover-module__playlistSubhead--G_uJa",scrollHeight:"PlaylistPopover-module__scrollHeight--_S6z1"}},666717:(e,t,i)=>{i.d(t,{Likes:()=>S});var o=i(452314),s=i(317412),a=i(810903),n=i(879007),r=i(663878),d=i(927984),l=i(7144),c=i(20025),h=i(388078),u=i(610989),p=i(630298),_=i(849225),v=i(142718),y=i(335291),g=i(662e3),w=i(100193),m=i(958258),b=i(400281),I=i(681589),k=i(489944),C=i(745195),P=i(964587),L=i(302495),x=i(695290),f=i(476726);const S={toggle(e,t,i,a){if((0,s.cancelEvent)(t),(0,l.isObject)(window.cur)&&(0,l.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(vk.widget&&!vk.id)return window.Widgets.oauth();const n=(0,o.hasClass)(e,"active");(0,o.addClass)(e,"animate"),this.clientUpdate(i,_.LikeButtonTypes.like,n?-1:1,!n),this.handleAuthorLikeInReply(i,e,n);const{objectType:r}=(0,p.parseLikeObjectId)(i),d=(0,p.isObjectTypeIsVideo)(r),c=d?(0,b.getVideoTrackCode)():void 0,h={act:n?"a_do_unlike":"a_do_like",object:i,hash:a,list:cur.pvListId,wall:2,from:this._getReference(i),from_widget:vk.widget?1:0,track_code:c,event_subtype:(0,P.getFeedEventSubtype)()},u=()=>{const t=()=>{(0,o.toggleClass)(e,"active",n),this.clientUpdate(i,_.LikeButtonTypes.like,n?1:-1,n),this.handleAuthorLikeInReply(i,e,!n)};return(0,f.partConfigEnabled)("video_modal_unauth_like_bugfix")?(setTimeout(t,500),!1):(t(),!1)};window.ajax.post("like.php",h,{onDone:t=>{if(t.unauth_action_box)return u(),void w.UnauthActionBox.show(t.unauth_action_box,{onLogin:d?window.VideoShowcase?.login:void 0});this.update(i,t);const o=i.match(/^(wall|market)(.*)/);o&&cur.onLike&&cur.onLike(e,o[1],o[2],n),this.handleAuthorLikeInReply(i,e,n,t)},onFail:u});(0,l.intval)((0,o.domData)(e,"count"))>0?S.showLikes(e,i,{fast:!0}):e.tt&&e.tt.destroy&&e.tt.destroy()},_getReference:e=>cur.pvShown?"photo_viewer":e===cur.wallLayer?"wkview":window.mvcur&&window.mvcur.mvShown?"videoview":cur.wallType?"feed"===cur.wallType?"news"===cur.section?`feed_${cur.subsection?cur.subsection:cur.section}`:"recommended"===cur.section?"feed_recommended"+("recent"!==cur.subsection?"_"+cur.subsection:""):(0,n.inArray)(cur.section,["friends","groups","videos","photos"])?"feed_"+(cur.subsection?"_"+cur.subsection:""):`feed_${cur.section}`:"top"===cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module,share(e,t={},i=void 0){if(vk.widget&&!vk.id)return window.Widgets.oauth();if((0,l.isObject)(window.cur)&&(0,l.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(window.cur){const e=(0,I.getTrackCodeFromPost)(i);window.cur.shareButtonTrackCode=e}const{objectType:o,objectId:s}=(0,p.parseLikeObjectId)(e),a=(0,p.isObjectTypeIsVideo)(o);(vk.widget?window.showBox:c.showBox)("like.php",{act:"publish_box",object:e,from_widget:vk.widget?1:0,...t},{onDone:(e,t)=>{t.unauth_action_box&&(e.hide(),w.UnauthActionBox.show(t.unauth_action_box,{onLogin:a?window.VideoShowcase?.login:void 0}))},stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")]}),"wall"===o&&window.Wall&&window.Wall.triggerAdPostStat(s,"share_post"),"clip"===o&&(0,L.logSearchClipClick)(x.SearchClickActionMap.SHARE_OUT),cur.RpcMethods&&(cur.RpcMethods.likeFullUpdate=t=>S.update(e,window.cleanObj(t)))},clientUpdate(e,t,i,s){const a=this._getButtonsByType(e,t);if(!a.length)return;const n=(0,l.intval)((0,o.domData)(a[0],"count"))+i;this._updateDom(e,t,n,s),this.updateExternalIndex(e,{type:t,count:n,isActive:s})},update(e,t){if(!isNaN(parseInt(t.like_num))){const i=(0,l.isUndefined)(t.like_my)?void 0:!!(0,l.intval)(t.like_my);this._updateDom(e,_.LikeButtonTypes.like,t.like_num,i,t.like_title,t.like_from_group),this.updateExternalIndex(e,{type:_.LikeButtonTypes.like,count:t.like_num,isActive:i})}if(!isNaN(parseInt(t.share_num))){const i=(0,l.isUndefined)(t.share_my)?void 0:!!(0,l.intval)(t.share_my);this._updateDom(e,_.LikeButtonTypes.share,t.share_num,i,t.share_title),this.updateExternalIndex(e,{type:_.LikeButtonTypes.share,count:t.share_num})}if((0,n.isNumeric)(t.views_num)&&this._updateDom(e,_.LikeButtonTypes.views,t.views_num,void 0,t.views_title),(0,n.isNumeric)(t.comment_num)&&this._updateDom(e,_.LikeButtonTypes.comment,t.comment_num),t[v.REACTIONS_COUNTS_RESPONSE_FIELD]){const i=!!t.isQueueUpdate;(0,g.triggerReactionsUpdate)(e,t[v.REACTIONS_COUNTS_RESPONSE_FIELD],void 0,{isQueueUpdate:i,isUserAction:!1,previewVisibility:y.previewVisibilityUseCurrent})}},updateComments(e,t){this.update(e,{comment_num:t})},_updateDom(e,t,i,s,a,d){const c=this._getButtonsByType(e,t),h=t===_.LikeButtonTypes.views;if(!c?.length)return;let v="";h?v=i:i>0&&(v=vk.widget?(0,n.formatCount)(i):(0,u.langNumeric)(i,"%s",!0)),h||(i=(0,l.intval)(i));for(let e=0;e<c.length;e++){const n=c[e];if((0,o.hasClass)(n,"no_counter"))continue;const y=h?c[e]:(0,p.getElementLikeButtonCount)(c[e]);if((0,r.animateCount)(y,v,{str:"auto",noWrapWidth:!h,noSpaceIfEmpty:!0}),(0,o.toggleClass)(n,"empty",i<=0),"boolean"==typeof s&&(0,o.toggleClass)(n,"active",s),(0,o.attr)(c[e],"data-count",i),(0,o.attr)(n,"data-combine")){const e=s?u.getLang("global_dislike"):`${u.getLang("global_like")}${i?" "+i:""}`;(0,o.attr)(n,"title")!==e&&(0,o.attr)(n,"title",e)}(0,m.updateAriaLabelCounter)(n,i,t),h&&n?.closest?.(".like_views")?.setAttribute("title",a||"");const g=c[e].tt;if(g){const e=(0,o.domByClass)(g.container,"_content"),r=(0,o.domByClass)(g.container,"_value"),c=(0,o.domByClass)(g.container,"_title"),h=(0,o.domByClass)(g.container,"like_tt_group_like"),u=(0,l.intval)((0,o.val)(r));if((0,o.val)(r,i),a&&(0,o.val)(c,a),(0,l.isObject)(g)&&(g.likeInvalidated=!0),(u!==i&&u<7||!1===a)&&(t===_.LikeButtonTypes.like?n.needReinitLikesTT=!0:t===_.LikeButtonTypes.share&&(n.needReinitShareTT=!0)),t===_.LikeButtonTypes.like&&(0,o.toggleClass)(e,"me_hidden",!s),!1===a&&g.destroy&&g.destroy(),void 0!==d&&h){const e="like_tt_group_like_hidden";d?h.classList.remove(e):h.classList.add(e)}}}},_getButtonsByType:(e,t)=>(0,o.domQuery)(`._like_${e} ._${t}, ._like_${e} [data-like-button-type="${t}"]`),showLikes(e,t,i={}){if(!e||!(e instanceof HTMLElement)||e.postDontShowLikes)return;if(vk.widget&&vk.show_external_auth_box)return;let s=i.views?{views:1}:i.share?{published:1}:{};i.listId&&(s.list=i.listId),i.like_hash&&(s.like_hash=i.like_hash),i.like_stats_params&&Object.assign(s,i.like_stats_params);const r=!!(0,o.geByClass1)("share",(0,o.gpeByClass)("like_wrap",e));let d=document.body,c=!1;const h=getComputedStyle(e),u=(0,l.intval)(h.getPropertyValue("padding-left").replace("px","")),_=(0,l.intval)(h.getPropertyValue("padding-top").replace("px","")),v=(0,p.getElementLikeButtonIcon)(e);let y=40;"wpost"===i.from&&(y=24);const g=[y-(0,o.getSize)(v)[0]/2-u,10-_];let w=i.cl||"";if(i.share)w+="likes_tt_share";else if(w+="likes_tt_like","widget_community"===i.from)g[0]=6;else if("wcomments"===i.from||"widget_comments"===cur.wallType){const t=16,i=10;g[0]=(0,o.getSize)(e)[0]+t-(0,o.getSize)(v)[0]/2-i}else"photo_carousel"===i.from&&(g[1]=10);if(!!i?.isFromReactionsPreview){const t=e.querySelector("._ReactionsPreview__itemsContainer");if(t){const e=t.querySelector(".ReactionsPreviewItem"),i=(0,o.getXYRect)(e,!1),s=(i.width||0)/2;let a=s;d=t;i.left+i.width/2>window.innerWidth/2&&(c=!0,a=t.offsetWidth-s),g[0]=-a+y}}let m,b;i.share?(m="needReinitLikesTT",b="resetLikesTTTimer"):(m="needReinitShareTT",b="resetShareTTTimer"),clearTimeout(e[b]),(0,a.showTooltip)(e,{url:"/like.php",params:(0,n.extend)({act:"a_get_stats",object:t,has_share:r?1:""},s),appendEl:d,slide:15,shift:g,ajaxdt:i.fast?0:100,showdt:i.fast?0:400,hidedt:200,dir:"auto",checkLeft:!0,needLeft:c,reverseOffset:80,noZIndex:!0,hasover:!0,tip:{over:()=>{S.showLikes(e,t,i)}},typeClass:"like_tt",className:w,onHide:()=>{clearTimeout(e[b]),e[m]&&(e[b]=setTimeout((()=>{delete e[m],e.tt&&e.tt.destroy&&e.tt.destroy()}),200))}})},showShare:function(e,t,i){S.showLikes(e,t,(0,n.extend)(i,{share:1}))},updateViews:(e,t)=>{vk.widget&&vk.show_external_auth_box||window.ajax.post("like.php",{act:"a_get_stats",object:e,views:1},{cache:1,onDone(t,i){const s=(0,o.ce)("div",{innerHTML:i});S._updateDom(e,_.LikeButtonTypes.views,t,void 0,s.innerText||s.textContent)}})},makeTemplate(e,t){if(!e)return"";(t=(0,n.extend)({buttons_prepend:"",object_raw:"",likes_count:"",liked:!1,share_count:"",shared:"",views_count:"",share_opts:{},like_opts:{},class_name:"",like_cont_class:"",like_class_name:"",[v.REACTIONS_COUNTS_RESPONSE_FIELD]:"",reactions_class_name:""},t)).like_active=t.liked?"active":"",t.share_active=t.shared?"active":"",t.comment_active="",t.likes_formatted_count=t.likes_count>0?(0,u.langNumeric)(t.likes_count,"%s",!0):"",t.share_formatted_count=t.share_count>0?(0,u.langNumeric)(t.share_count,"%s",!0):"",t.share_opts=this._convertOptsToString(t.share_opts),t.like_opts=this._convertOptsToString(t.like_opts),t.like_class_name+=t.likes_count>0?"":" empty",t.share_class_name=t.share_count>0?"":"empty";const i=t[v.REACTIONS_COUNTS_RESPONSE_FIELD],s=!!i&&Object.values(i).some((e=>!!e));return t.reactions_class_name+=s?"":" PostBottomAction--empty",(0,o.rs)(e,t)},_convertOptsToString:e=>JSON.stringify(e).replace(/\"/g,"'"),updateExternalIndex(e,t={}){const{objectType:i,objectId:o}=(0,p.parseLikeObjectId)(e);switch(i){case"photo":if(!cur.pvShown||!cur.pvCurPhoto||cur.pvCurPhoto.id!==o)return;const e=cur.pvListId,i=cur.pvIndex,s=cur.pvData[e][i];t.type===_.LikeButtonTypes.like?(s.likes=t.count,s.liked=t.isActive,cur.pvCommsLikes[s.id][1]=t.count):t.type===_.LikeButtonTypes.share&&(s.shares=t.count);break;case"video":if(window.mvcur&&window.mvcur.mvShown&&window.mvcur.videoRaw===o&&t.type===_.LikeButtonTypes.like){const e=window.Videoview.getMvData();e.likes=t.count,void 0!==t.isActive&&(e.liked=t.isActive,window.Videoview.playerOnLiked(t.isActive),window.Videoview.recache())}break;case"clip":t.type===_.LikeButtonTypes.like&&window.Videoview.playerOnLiked(t.isActive)}},showLikesList(e,t){cur.viewAsBox||(0,o.hasClass)((0,o.gpeByClass)("like_btn",e),"no_counter")||(0,d.showWiki)({w:"likes/"+(0,n.clean)(t)},!1,!1,{queue:1})},showSharesList(e,t){cur.viewAsBox||(0,o.hasClass)((0,o.gpeByClass)("like_btn",e),"no_counter")||(0,d.showWiki)({w:"shares/"+(0,n.clean)(t)},!1,!1,{queue:1})},handleAuthorLikeInReply(e,t,i,o){const{objectId:s}=(0,p.parseLikeObjectId)(e),a=(0,k.getPostElemByChildEl)(t),n=Number(a?.dataset?.postAuthorId),r=a?.querySelector(`.reply#post${s}`)?.querySelector(".HighlightingAuthorLike");if(!r||!h.Ranges.isUserId(n)||vk.id!==n)return;const d="HighlightingAuthorLike--hidden";(o?o.like_my:!i)?(r.classList.remove(d),o&&(0,C.renderAuthorUserOnboardingTooltip)(r)):r.classList.add(d)}}},804230:(e,t,i)=>{i.d(t,{VideoPlaylistsListProvider:()=>d});var o=i(331635),s=i(327813),a=i(67515),n=i(127126),r=i(310142);let d=class{createList(){return new a.VideoPlaylistsList(this.videoPlaylistProvider)}constructor(e){this.videoPlaylistProvider=e,(0,s.makeAutoObservable)(this)}};d=(0,o.__decorate)([n.scope.container(),(0,o.__metadata)("design:paramtypes",[r.VideoPlaylistsProvider])],d)},518691:(e,t,i)=>{i.d(t,{VideoPlaylistsListService:()=>d});var o=i(331635),s=i(327813),a=i(968788),n=i(127126),r=i(900357);let d=class{getContainingVideoPlaylistIds(e){return this.playlistsIdByVideoMap.get(e)}getContainingVideoPlaylists(e){return this.playlistsByVideoMap.get(e)}async addToAlbum({videoId:e,albumId:t,albumIds:i,targetId:o,ownerId:s,accessKey:a,ref:n,context:r},d){const l={video_id:e,target_id:o,access_key:a,owner_id:s,album_id:t,album_ids:i?.join(","),ref:n,context:r};return await this.videoApi.addToAlbum(l,d)}async removeFromAlbum({ownerId:e,albumId:t,albumIds:i,targetId:o,videoId:s},a){const n={owner_id:e,video_id:s,album_id:t,target_id:o,album_ids:i?.join(",")};return await this.videoApi.removeFromAlbum(n,a)}async fetchAlbumsByVideo({targetId:e,videoId:t,ownerId:i,extended:o},a){const n={extended:(0,r.convertToBooleanParam)(o),video_id:t,target_id:e,owner_id:i},d=await this.videoApi.getAlbumsByVideo(n,a);return(0,s.runInAction)((()=>{if(Array.isArray(d))this.playlistsIdByVideoMap.set(n.video_id,new Set(d));else{const e=d.items.map((e=>e.id));this.playlistsIdByVideoMap.set(n.video_id,new Set(e)),this.playlistsByVideoMap.set(n.video_id,d.items)}})),d}constructor(e){this.videoApi=e,this.playlistsIdByVideoMap=new Map,this.playlistsByVideoMap=new Map,(0,s.makeAutoObservable)(this)}};d=(0,o.__decorate)([n.scope.container(),(0,o.__metadata)("design:paramtypes",[a.VideoApi])],d)},67515:(e,t,i)=>{i.d(t,{VideoPlaylistsList:()=>s});var o=i(327813);class s{get count(){return this._count}get isLoading(){return this._isLoading}get isLoadedFully(){return this._isLoadedFully}get isLoaded(){return Boolean(this.prevRequestParams)}getPlaylistById(e){return this.ids.includes(e)&&this.videoPlaylistsProvider.getPlaylist(e)||null}get playlists(){return this.ids.reduce(((e,t)=>{const i=this.videoPlaylistsProvider.getPlaylist(t);return i&&e.push(i),e}),[])}get notEmptyPlaylists(){return this.ids.reduce(((e,t)=>{const i=this.videoPlaylistsProvider.getPlaylist(t);return i&&i.data.count>0&&e.push(i),e}),[])}dispose(){this.controller?.abort()}done(e,t){const{count:i=0,offset:o=0}=e,s=t.items.map((({rawId:e})=>e));return this._isLoadedFully=t.count<=o+i,this._count=t.count,this.ids=o?[...this.ids,...s]:s,this._isLoading=!1,this.controller=null,this.prevRequestParams=e,s}async fetch(e,t=new AbortController){this.reset(),this.controller=t,this._isLoading=!0;const i=await this.request(e,t);return this.done(e,i)}async fetchMore(e=new AbortController){if(!this.prevRequestParams||this._isLoading||this._isLoadedFully)return;this.controller=e,this._isLoading=!0;const{count:t=0,offset:i=0}=this.prevRequestParams??{},o=i+t,s={...this.prevRequestParams,offset:o},a=await this.request(s,e);return this.done(s,a)}request(e,t){return this.videoPlaylistsProvider.fetch(e,{signal:t.signal})}reset(){this.controller?.abort(),this.resetData()}resetData(){this._count=0,this._isLoading=!1,this._isLoadedFully=!1,this.ids=[],this.prevRequestParams=null,this.controller=null}constructor(e){this.videoPlaylistsProvider=e,this.ids=[],this.prevRequestParams=null,this.controller=null,this._count=0,this._isLoading=!1,this._isLoadedFully=!1,(0,o.makeAutoObservable)(this)}}},998917:(e,t,i)=>{i.d(t,{useLazyLoad:()=>a});var o=i(296540),s=i(287841);const a=(e,t,i=window,a)=>{(0,o.useEffect)((()=>{let o;if(i)return e?(o=(0,s.throttle)((()=>{const e=i instanceof Window?Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight):Math.max(i.scrollHeight,i.clientHeight),o=i instanceof Window?document.documentElement.clientHeight:i.clientHeight,s=i instanceof Window?i.scrollY:i.scrollTop,n=o+s,r=Math.max(e-2*o,0);(!a&&n>=r||a&&s<o/2)&&t?.()}),34),o(),i.addEventListener("scroll",o)):o&&i.removeEventListener("scroll",o),()=>{o&&i.removeEventListener("scroll",o)}}),[e,t,i,a])}},209884:(e,t,i)=>{i.d(t,{getPlayFromByDuration:()=>o});const o=e=>{let t="";const i=Math.floor(e/3600);i&&(t+=`${i}h`);const o=Math.floor(e%3600/60);o&&(t+=`${o}m`);const s=e%60;return s&&(t+=`${s}s`),t}},506435:(e,t,i)=>{i.d(t,{PlaylistCheckbox:()=>h});var o=i(474848),s=i(293721),a=i(149183),n=i(757459),r=i(415782),d=i(480958),l=i(965657),c=i(160726);const h=({playlistId:e,videoId:t,videoPlaylistsModalService:i})=>{const h=(0,a.useEntitiesStore)(i.$entitiesPlaylists,e),{itemId:u}=(0,n.splitRawId)(e),p=(0,l.useVideoInPlaylist)(i.$entitiesVideoBinding,t,u),_=(0,s.useEvent)(i.toggleBindingEvent);return h?(0,o.jsx)(r.Checkbox,{checked:p,onChange:()=>_({album_id:u,video_id:t}),titleAfter:(0,o.jsx)(c.PlaylistCheckboxTooltip,{privacy:h?.privacy?.category}),children:(0,o.jsx)(d.TextClamp,{lines:1,children:h.title})}):null}},160726:(e,t,i)=>{i.d(t,{PlaylistCheckboxTooltip:()=>l});var o=i(474848),s=i(610989),a=i(373206),n=i(562791),r=i(320830),d=i(524057);const l=({privacy:e})=>{const t=(()=>{switch(e){case"all":return{Icon:a.Icon16UnlockOutline,text:s.getLang("video_playlist_available_to_all_tooltip")};case"only_me":return{Icon:n.Icon16LockOutline,text:s.getLang("video_playlist_private_tooltip")};default:return}})();if(!t)return null;const{Icon:i,text:l}=t;return(0,o.jsx)(r.TextTooltip,{placement:"top",appearance:"black",offsetByCrossAxis:-56,offsetByMainAxis:4,text:l,children:(0,o.jsx)(i,{className:d.default.playlistPrivateIcon})})}},136400:(e,t,i)=>{i.d(t,{PlaylistCheckbox:()=>o.PlaylistCheckbox,PlaylistCheckboxTooltip:()=>s.PlaylistCheckboxTooltip});var o=i(506435),s=i(160726)},637131:(e,t,i)=>{i.d(t,{showPlaylistsModal:()=>O});var o=i(474848),s=i(293721),a=i(296540),n=i(884945),r=i(753457),d=i(847891),l=i(209642),c=i(125852),h=i(416124),u=i(415782),p=i(428918),_=i(216806),v=i(785118),y=i(380118),g=i(439220),w=i(828902),m=i(966576),b=i(533048),I=i(610989),k=i(476726),C=i(422495),P=i(998917),L=i(272259),x=i(964929),f=i(400281),S=i(136400),T=i(594816);const A=({video:e,ownerId:t,isGroupOwner:i=!1,onClose:L,refreshCoordinates:A,videoPlaylistsModalService:O})=>{const{$videosAlbumsIds:V,$videosAlbumsLoading:E,$videoAlbumsFullyLoaded:j,$wasToggled:B,toggleBindingEvent:M,saveChangesEvent:R,fetchMorePlaylists:D,resetBindingsEvent:F,initModalEvent:H,createPlaylistEvent:N}=(0,s.useUnit)(O),[U,W]=(0,a.useState)(null);(0,a.useEffect)((()=>{A(),F()}),[]),(0,a.useEffect)((()=>{H({ownerId:t,isGroupOwner:i,videoId:e.id,videoOwnerId:e.owner_id})}),[]);const z=(0,C.useVideoInPlaylist)(O.$entitiesVideoBinding,e.id,C.MY_VIDEO_ALBUM_ID);return(0,P.useLazyLoad)(!j&&!E,D,U),(0,o.jsxs)(l.ModalBox,{height:365,children:[(0,o.jsx)(c.ModalHeader,{closeAriaLabel:I.getLang("box_cancel"),onClose:L,children:I.getLang("video_playlist_modal_header")}),(0,o.jsx)(h.ModalBody,{insetLevel:1,children:V?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.Checkbox,{checked:z,disabled:Boolean(E)&&!V?.length,onChange:()=>{M({video_id:e.id,album_id:C.MY_VIDEO_ALBUM_ID})},children:i?I.getLang("video_all_groups_videos"):I.getLang("video_my_added_videos_playlist")}),(0,o.jsx)(p.Spacing,{size:8}),(0,o.jsx)(_.Separator,{}),(0,o.jsx)(p.Spacing,{size:8}),(0,o.jsx)(v.Div,{mode:"horizontal",spacing:6,children:(0,o.jsx)(y.Footnote,{className:T.default.playlistSubhead,weight:"3",children:I.getLang("video_playlists")})}),!!V.length&&(0,o.jsxs)(g.ModalScrollView,{height:108,maxHeight:108,getRef:W,children:[!!V&&V.map((t=>(0,o.jsx)(S.PlaylistCheckbox,{playlistId:t,videoId:e.id,videoPlaylistsModalService:O},t))),(E||!V)&&(0,o.jsx)(v.Div,{mode:"horizontal",spacing:4,children:(0,o.jsx)(w.Spinner,{})})]}),(0,o.jsx)(r.CellButton,{onClick:o=>{L();const s=i?d.Ranges.convertGroupIdToOwnerId(Math.abs(t)):t;(0,k.partConfigEnabled)("video_playlist_redesign_popup")?(0,x.showPlaylistModal)({ownerId:s,onCreate:N,hasOnCreateSnackbar:!1}):(0,f.createPlaylistPopup)(o,s,e.id,e.owner_id,f.CreatePlaylistRequestOrigin.VIDEO_PLAYLISTS_MODAL).catch()},before:(0,o.jsx)(n.Icon28AddOutline,{}),children:I.getLang("video_add_video_to_new_playlist")}),!V.length&&(0,o.jsx)(p.Spacing,{size:106})]}):(0,o.jsxs)(v.Div,{mode:"horizontal",children:[(0,o.jsx)(p.Spacing,{size:104}),(0,o.jsx)(w.Spinner,{}),(0,o.jsx)(p.Spacing,{size:104})]})}),(0,o.jsx)(m.ModalFooter,{actions:[(0,o.jsx)(b.Button,{mode:"secondary",size:"m",onClick:L,children:I.getLang("box_cancel")},1),(0,o.jsx)(b.Button,{mode:"primary",size:"m",onClick:()=>{R(),L()},disabled:!B,children:I.getLang("Save")},2)]})]})},O=({onDestroy:e,ownerId:t,isGroupOwner:i,video:s,videoPlaylistsModalService:a})=>{(0,L.showMessageBoxModal)((e=>(0,o.jsx)(A,{ownerId:t,isGroupOwner:i,video:s,videoPlaylistsModalService:a,...e})),{onDestroy:e,width:420})}},615822:(e,t,i)=>{i.d(t,{showPlaylistModalWidget:()=>s.showPlaylistModalWidget,showPlaylistsModal:()=>o.showPlaylistsModal});var o=i(637131),s=i(765072)},461353:(e,t,i)=>{i.d(t,{PlaylistCheckboxWidget:()=>h});var o=i(474848),s=i(415782),a=i(480958),n=i(136400),r=i(456921),d=i(127126),l=i(516877);const c=(0,r.observer)((()=>{const{title:e,playlist:t,checked:i,onCheckboxClick:r}=(0,l.usePlaylistCheckboxModel)();return t?(0,o.jsx)(s.Checkbox,{checked:i,onChange:r,titleAfter:(0,o.jsx)(n.PlaylistCheckboxTooltip,{privacy:t?.privacy?.category}),children:(0,o.jsx)(a.TextClamp,{lines:1,children:e})}):null})),h=(0,d.createWidget)(l.PlaylistCheckboxModelProvider,c)},193438:(e,t,i)=>{i.d(t,{PlaylistCheckboxWidget:()=>o.PlaylistCheckboxWidget});var o=i(461353)},674297:(e,t,i)=>{i.d(t,{PlaylistCheckboxModelProvider:()=>r,usePlaylistCheckboxModel:()=>d});var o=i(331635),s=i(127126),a=i(327813);class n{get playlist(){return this.props.current.playlist}get id(){return this.props.current.playlist.id}get title(){return this.props.current.playlist.title}get checked(){return this._checked}constructor(e){this.props=e,this.onCheckboxClick=()=>(this._checked=!this._checked,this.props.current.onChange?.(this.props.current.playlist.id)),this._checked=!1,this._checked=!!this.props.current.checkedIds&&this.props.current.checkedIds.has(this.props.current.playlist.id),(0,a.makeAutoObservable)(this)}}n=(0,o.__decorate)([s.scope.transient(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[void 0===s.Props?Object:s.Props])],n);const{Provider:r,useModel:d}=(0,s.createProvider)(n)},516877:(e,t,i)=>{i.d(t,{PlaylistCheckboxModelProvider:()=>o.PlaylistCheckboxModelProvider,usePlaylistCheckboxModel:()=>o.usePlaylistCheckboxModel});var o=i(674297)},61917:(e,t,i)=>{i.d(t,{showPlaylistModalWidget:()=>m});var o=i(474848),s=i(272259),a=i(296540),n=i(770125),r=i(209642),d=i(125852),l=i(416124),c=i(966576),h=i(533048),u=i(127126),p=i(456921),_=i(689938),v=i(120383),y=i(632549);const g=(0,p.observer)((function(){const{messageBoxProps:e,isUpdated:t,onSubmitClick:i}=(0,v.useVideoPlaylistModel)(),s=(0,n.useLangs)();return(0,a.useEffect)((()=>{e.refreshCoordinates()}),[]),(0,o.jsxs)(r.ModalBox,{height:365,children:[(0,o.jsx)(d.ModalHeader,{closeAriaLabel:s.getLang("box_cancel"),onClose:e.onClose,children:s.getLang("video_playlist_modal_header")}),(0,o.jsx)(l.ModalBody,{insetLevel:1,children:(0,o.jsx)(y.ModalBodyComponent,{})}),(0,o.jsx)(c.ModalFooter,{actions:[(0,o.jsx)(h.Button,{mode:"secondary",size:"m",onClick:e.onClose,children:s.getLang("box_cancel")},1),(0,o.jsx)(h.Button,{mode:"primary",size:"m",onClick:i,disabled:!t,children:s.getLang("Save")},2)]})]})})),w=(0,u.createWidget)(v.VideoPlaylistModelProvider,g),m=e=>{(0,s.showMessageBoxModal)((t=>(0,o.jsx)(_.DIRootWebProvider,{children:(0,o.jsx)(w,{...e,...t})})),{width:420})}},443391:(e,t,i)=>{i.d(t,{ModalBodyComponent:()=>m});var o=i(474848),s=i(785118),a=i(428918),n=i(828902),r=i(415782),d=i(216806),l=i(380118),c=i(439220),h=i(753457),u=i(39170),p=i(193438),_=i(884945),v=i(456921),y=i(120383),g=i(770125),w=i(943852);const m=(0,v.observer)((function(){const{isLoading:e,playlists:t,isLoadedFully:i,isListEmpty:v,propsList:m,toggle:b,fetchMorePlaylists:I,isMyAlbum:k,handleCreateNewPlaylist:C,checkedIds:P,handleAddToMyVideo:L}=(0,y.useVideoPlaylistModel)(),x=(0,g.useLangs)(),{isGroupOwner:f}=m;return v&&e?(0,o.jsxs)(s.Div,{mode:"horizontal",children:[(0,o.jsx)(a.Spacing,{size:104}),(0,o.jsx)(n.Spinner,{}),(0,o.jsx)(a.Spacing,{size:104})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Checkbox,{checked:k,disabled:e,onChange:L,children:f?x.getLang("video_all_groups_videos"):x.getLang("video_my_added_videos_playlist")}),(0,o.jsx)(a.Spacing,{size:8}),(0,o.jsx)(d.Separator,{}),(0,o.jsx)(a.Spacing,{size:8}),(0,o.jsx)(s.Div,{mode:"horizontal",spacing:6,children:(0,o.jsx)(l.Footnote,{className:w.default.playlistSubhead,weight:"3",children:x.getLang("video_playlists")})}),t.length>0&&(0,o.jsxs)(c.ModalScrollView,{height:108,maxHeight:108,children:[t.map((e=>(0,o.jsx)(p.PlaylistCheckboxWidget,{onChange:b,playlist:e,checkedIds:P},e.id))),e&&(0,o.jsx)(s.Div,{mode:"horizontal",spacing:4,children:(0,o.jsx)(n.Spinner,{})}),!i&&(0,o.jsx)(u.DynamicPagination,{isLoading:e,fetchData:I,nextFrom:t.length,withSpinner:!1})]}),(0,o.jsx)(h.CellButton,{onClick:C,before:(0,o.jsx)(_.Icon28AddOutline,{}),children:x.getLang("video_add_video_to_new_playlist")}),!t.length&&(0,o.jsx)(a.Spacing,{size:106})]})}))},632549:(e,t,i)=>{i.d(t,{ModalBodyComponent:()=>o.ModalBodyComponent});var o=i(443391)},765072:(e,t,i)=>{i.d(t,{showPlaylistModalWidget:()=>o.showPlaylistModalWidget});var o=i(61917)},886096:(e,t,i)=>{i.d(t,{VideoPlaylistModelProvider:()=>b,useVideoPlaylistModel:()=>I});var o=i(331635),s=i(127126),a=i(310142),n=i(804230),r=i(518691),d=i(5281),l=i(673483),c=i(327813),h=i(847891),u=i(470297),p=i(422495),_=i(476726),v=i(964929),y=i(400281),g=i(47238),w=i(594020);class m{abort(){this._abortController?.abort()}get ownerId(){return this.props.current.ownerId}get isGroupOwner(){return this.props.current.isGroupOwner}get videoId(){return this.props.current.videoId}get isMyAlbum(){return!this.toRemove.has(p.MY_VIDEO_ALBUM_ID)&&(!!this.toAdd.has(p.MY_VIDEO_ALBUM_ID)||this.checkedIds?.has(p.MY_VIDEO_ALBUM_ID))}get messageBoxProps(){return{onClose:this.props.current.onClose,refreshCoordinates:this.props.current.refreshCoordinates}}get propsList(){return this.props.current}get checkedIds(){return this.playlistsListService.getContainingVideoPlaylistIds(this.props.current.videoId)}get isLoading(){return this._playlistsList.isLoading}get isLoadedFully(){return this._playlistsList.isLoadedFully}get isListEmpty(){return!this._playlistsList.playlists.length}get playlists(){return this._playlistsList.playlists.map((e=>e.data))}get isUpdated(){return Boolean(this.toAdd.size||this.toRemove.size)}get owner(){return this.ownersProvider.getOwner(this.ownerId)}getPlaylistsByOwner(e){return this.playlistsByOwnerMap.get(e)}async[s.init](){this._abortController=new AbortController,this.targetId=this.props.current.isGroupOwner&&this.props.current.ownerId?h.Ranges.convertGroupIdToOwnerId(this.props.current.ownerId):this.props.current.ownerId;try{await Promise.all([this.playlistsListService.fetchAlbumsByVideo({videoId:this.props.current.videoId,ownerId:this.props.current.videoOwnerId,extended:!0,targetId:this.targetId},{signal:this._abortController.signal}),this._playlistsList.fetch({groupId:this.props.current.isGroupOwner?this.props.current.ownerId:void 0,ownerId:this.props.current.isGroupOwner?void 0:this.props.current.ownerId,count:this._chunkSize},this._abortController)])}catch(e){(0,c.runInAction)((()=>{this._abortController=void 0,this._error=e}))}}[s.destroy](){this.abort()}toggleSetById(e,t){e.has(t)?e.delete(t):e.add(t)}setPlaylistsByOwner(){return this.playlistsByOwnerMap.set(this.props.current.ownerId,this._playlistsList.playlists.map((e=>e.data)))}constructor(e,t,i,o,s,a,n){this.props=e,this.langs=t,this.videoPlaylistProvider=i,this.videoPlaylistListProvider=o,this.playlistsListService=s,this.ownersProvider=a,this.groupsProvider=n,this.handleCreateNewPlaylist=e=>{this.messageBoxProps.onClose();const t=this.isGroupOwner?h.Ranges.convertGroupIdToOwnerId(Math.abs(this.ownerId)):this.ownerId;(0,_.partConfigEnabled)("video_playlist_redesign_popup")?(0,v.showPlaylistModal)({ownerId:t,onCreate:this.сreatePlaylist,hasOnCreateSnackbar:!1}):(0,y.createPlaylistPopup)(e,t,this.videoId,this.props.current.videoOwnerId,y.CreatePlaylistRequestOrigin.VIDEO_PLAYLISTS_MODAL).catch()},this.handleAddToMyVideo=()=>{this.toggle(p.MY_VIDEO_ALBUM_ID)},this.сreatePlaylist=async e=>{this._abortController=new AbortController;try{await this.playlistsListService.fetchAlbumsByVideo({videoId:this.props.current.videoId,ownerId:this.props.current.videoOwnerId,extended:!0,targetId:this.targetId},{signal:this._abortController.signal}),await this.playlistsListService.addToAlbum({videoId:this.props.current.videoId,targetId:this.targetId,ownerId:this.props.current.videoOwnerId,albumId:e.id},this._abortController),await this._playlistsList.fetch({ownerId:this.props.current.ownerId,count:this._chunkSize},this._abortController),(0,c.runInAction)((()=>{(0,g.showSuccessSnackbar)(this.langs.getLang("video_changes_saved")),this._abortController=void 0}))}catch(e){(0,c.runInAction)((()=>{(0,g.showFailSnackbar)(this.langs.getLang("video_editor_popout_save_failed_header")),this._abortController=void 0,this._error=e}))}},this.fetchMorePlaylists=async()=>{this._abortController=new AbortController;try{await this._playlistsList.fetchMore(this._abortController),(0,c.runInAction)((()=>{this._abortController=void 0}))}catch(e){(0,c.runInAction)((()=>{this._abortController=void 0,this._error=e}))}},this.onSubmit=async({videoId:e,ownerId:t,playlistId:i,ref:o,context:s,accessKey:a})=>{try{if(this.toAdd.size&&(this._abortController=new AbortController,await this.playlistsListService.addToAlbum({videoId:e,ref:o,albumIds:[...this.toAdd,...this.checkedIds??[]],albumId:i,accessKey:a,context:s,targetId:this.targetId,ownerId:t},this._abortController)),this.toRemove.size){if(this.props.current.playlistId){const{id:e}=(0,u.parseRawId)(this.props.current.playlistId);this._id=e}this._abortController=new AbortController,await this.playlistsListService.removeFromAlbum({videoId:e,albumIds:Array.from(this.toRemove),albumId:i,targetId:this.targetId,ownerId:t},this._abortController),this._id&&Array.from(this.toRemove).includes(this._id)&&window.nav.reload()}(0,c.runInAction)((()=>{this._abortController=void 0})),(0,g.showSuccessSnackbar)(this.langs.getLang("video_changes_saved"))}catch(e){(0,c.runInAction)((()=>{this._abortController=void 0,this._error=e})),(0,g.showFailSnackbar)(this.langs.getLang("video_editor_popout_save_failed_header"))}this.toRemove.clear(),this.toAdd.clear()},this.onSubmitClick=()=>{this.onSubmit({ownerId:this.props.current.videoOwnerId,videoId:this.props.current.videoId}),this.messageBoxProps.onClose()},this.toggle=e=>{this.checkedIds?.has(e)?this.toggleSetById(this.toRemove,e):this.toggleSetById(this.toAdd,e)},this.targetId=0,this.toAdd=new Set,this.toRemove=new Set,this._abortController=void 0,this._error=void 0,this._chunkSize=50,this._id=void 0,this.playlistsByOwnerMap=new Map,this._playlistsList=o.createList(),(0,c.makeAutoObservable)(this)}}m=(0,o.__decorate)([s.scope.transient(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[void 0===s.Props?Object:s.Props,void 0===w.Langs?Object:w.Langs,void 0===a.VideoPlaylistsProvider?Object:a.VideoPlaylistsProvider,void 0===n.VideoPlaylistsListProvider?Object:n.VideoPlaylistsListProvider,void 0===r.VideoPlaylistsListService?Object:r.VideoPlaylistsListService,void 0===d.VideoOwnerProvider?Object:d.VideoOwnerProvider,void 0===l.VideoGroupsProvider?Object:l.VideoGroupsProvider])],m);const{Provider:b,useModel:I}=(0,s.createProvider)(m)},120383:(e,t,i)=>{i.d(t,{VideoPlaylistModelProvider:()=>o.VideoPlaylistModelProvider,useVideoPlaylistModel:()=>o.useVideoPlaylistModel});var o=i(886096)},47238:(e,t,i)=>{i.d(t,{showFailSnackbar:()=>d,showSuccessSnackbar:()=>r});var o=i(474848),s=i(659179),a=i(818515),n=i(422495);const r=e=>{(0,s.showSnackbar)({text:e,before:{content:(0,o.jsx)(a.Icon28ListCheckOutline,{})},timeout:n.SNACKBAR_TIMEOUT}).catch()},d=e=>{(0,s.showSnackbar)({text:e,before:{content:(0,o.jsx)(a.Icon28ListCheckOutline,{})},timeout:n.SNACKBAR_TIMEOUT}).catch()}},132792:(e,t,i)=>{i.d(t,{VIDEO_SHOWCASE_SCROLL_TO_TOP_BUTTON_CHANGE_ACTIVITY_EVENT:()=>o,VIDEO_SHOWCASE_WATCH_LATER_TOOLTIP_VIEWED_EVENT:()=>s});const o="video showcase scroll to top button change activity",s="video showcase watch later tooltip viewed event"},429459:(e,t,i)=>{i.d(t,{addPlaylistVideo:()=>a});var o=i(60553),s=i(400281);const a=async(e,{owner_id:t,id:i})=>{window.VideoUpload||await(0,o.getVideoUploadModule)(),(0,s.uploadVideoPopup)(t,`${i}`,"1")}},32659:(e,t,i)=>{i.d(t,{copyPlaylistUrl:()=>s});var o=i(291903);const s=(e,{owner_id:t,id:i})=>(0,o.copyPlaylistUrl)({owner_id:t,id:i})},890368:(e,t,i)=>{i.d(t,{downloadVideo:()=>d});var o=i(112268),s=i(695290),a=i(490712),n=i(624216),r=i(291903);const d=(e,{id:t,owner_id:i,title:d,type:l,track_code:c})=>{d&&l&&(n.ajax.post("al_video.php?act=get_download_url",{video_raw_id:(0,o.joinRawId)({ownerId:i,itemId:t})},{onDone:e=>{(({url:e,title:t,type:i})=>{if(!e)return!1;const o=document.createElement("a");o.href=e,o.download=`${t}.mp4`,document.body.appendChild(o),o.click(),document.body.removeChild(o),(0,a.statlogsValueEvent)("video_downloads","",i)})({title:d,type:l,url:e})}}),(0,r.logDownloadClick)(s.EventItemType.VIDEO,c))}},129009:(e,t,i)=>{i.d(t,{editPlaylistById:()=>s});var o=i(194527);const s=(e,t,i)=>{o.Video.editAlbum(t,e,i,!0)}},650020:(e,t,i)=>{i.d(t,{editVideo:()=>n});var o=i(112268),s=i(20025),a=i(271139);const n=(e,{owner_id:t,id:i,type:n},r)=>{(0,s.showBox)("al_video.php?act=edit_box",{vid:i,oid:t,is_short_video:"short_video"===n?1:0},{containerClass:"video_edit",params:{onHide:()=>{a.entitiesVideoService.videoGetByIdFx({id:(0,o.joinRawId)({ownerId:t,itemId:i}),extended:1,group_id:r?.groupId})}}})}},944255:(e,t,i)=>{i.d(t,{addPlaylistVideo:()=>o.addPlaylistVideo,copyPlaylistUrl:()=>s.copyPlaylistUrl,downloadVideo:()=>a.downloadVideo,editPlaylistById:()=>n.editPlaylistById,editVideo:()=>r.editVideo,openPlaylist:()=>d.openPlaylist,openPlaylistFactory:()=>d.openPlaylistFactory,openVideo:()=>l.openVideo,openVideoExtended:()=>l.openVideoExtended,sendReport:()=>c.sendReport,sendReportWithCallback:()=>c.sendReportWithCallback,shareVideo:()=>h.shareVideo,shareVideoExtended:()=>h.shareVideoExtended,toggleDelete:()=>u.toggleDelete,toggleFav:()=>p.toggleFav,togglePlaylistSubscribe:()=>_.togglePlaylistSubscribe});var o=i(429459),s=i(32659),a=i(890368),n=i(129009),r=i(650020),d=i(758685),l=i(616856),c=i(90931),h=i(98185),u=i(477036),p=i(631906),_=i(366253)},758685:(e,t,i)=>{i.d(t,{openPlaylist:()=>r,openPlaylistFactory:()=>n});var o=i(757459),s=i(112268),a=i(616856);const n=e=>(t,i)=>{if(!i.first_video_id)return;const{itemId:n,ownerId:r}=(0,o.splitRawId)(i.first_video_id),d=(0,s.joinRawId)({ownerId:i.owner_id,itemId:i.id});(0,a.openVideoExtended)(t,{id:n,owner_id:r},{playlistId:d,module:e})},r=n()},616856:(e,t,i)=>{i.d(t,{openVideo:()=>l,openVideoExtended:()=>d});var o=i(112268),s=i(209884),a=i(695290),n=i(194527),r=i(291903);const d=(e,{id:t,owner_id:i,track_code:d,viewed_duration:l,type:c},{playlistId:h="",module:u,searchTrackCode:p}={})=>{if(!i||!t||n.Video.checkClickEvent(e))return;const _="short_video"===c;(0,r.logTapClick)(a.EventItemType.VIDEO,d,p),e.preventDefault(),e.stopPropagation();const v=l?(0,s.getPlayFromByDuration)(l):"";n.Video.show(e,(0,o.joinRawId)({ownerId:i,itemId:t}),{autoplay:1,forceAllVideos:Boolean(h),queue:0,playlistId:h,playFrom:v,addParams:{track_code:d},module:u,shortVideo:_},e.target)},l=(e,t)=>d(e,t)},90931:(e,t,i)=>{i.d(t,{sendReport:()=>a,sendReportExtended:()=>s,sendReportWithCallback:()=>n});var o=i(610989);const s=(e,{id:t,owner_id:i},{cardFeedback:s,withoutCardFeedback:a=!1}={})=>{window.stManager.add([window.jsc("web/videoview.js")],(()=>{window.Videoview.showReportVideoForm(i,t,(()=>{a||window.stManager.add([window.jsc("web/video_showcase.js")],(()=>{window.VideoShowcase?.showCardFeedback(String(i),String(t),o.getLang("global_report_spam")),s?.(e)}))}))}))},a=(e,t)=>s(e,t),n=(e,t,i)=>s(e,t,{cardFeedback:i})},98185:(e,t,i)=>{i.d(t,{shareVideo:()=>a,shareVideoExtended:()=>s});var o=i(112268);const s=(e,t)=>{window.stManager.add([window.jsc("web/likes.js")],(()=>{window.Likes.share(`video${(0,o.joinRawId)({ownerId:e,itemId:t})}`)}))},a=(e,t)=>{s(t.owner_id,t.id)}},477036:(e,t,i)=>{i.d(t,{toggleDelete:()=>s});var o=i(271139);const s=(e,{owner_id:t,id:i},{groupId:s}={})=>{const a={id:i,ownerId:t},n=s?-Math.abs(s):void 0;t!==n&&(a.targetId=n),o.videoDeletingService.toggleDeleteVideoEvent(a)}},631906:(e,t,i)=>{i.d(t,{toggleFav:()=>n});var o=i(695290),s=i(271139),a=i(291903);const n=(e,{id:t,owner_id:i,is_favorite:n,track_code:r},d)=>{s.faveService.toggleFaveVideoEvent({id:t,ownerId:i,ref:r,source:d?.source}),(0,a.logFaveClick)(!!n,o.EventItemType.VIDEO,r,d?.searchTrackCode)}},366253:(e,t,i)=>{i.d(t,{togglePlaylistSubscribe:()=>s});var o=i(694743);const s=(e,{is_subscribed:t,owner_id:i,id:s})=>{t?o.appCatalogService.playlistService.unsubscribeFromPlaylist({owner_id:i,album_id:s}):o.appCatalogService.playlistService.subscribeOnPlaylist({owner_id:i,album_id:s})}},531698:(e,t,i)=>{i.d(t,{usePlaylistSubscriptionListener:()=>o.usePlaylistSubscriptionListener,useRestrictedPlaylist:()=>s.useRestrictedPlaylist,useSearchTrackCode:()=>r.useSearchTrackCode,useUnavailablePlaylist:()=>a.useUnavailablePlaylist,useWatchLaterTooltipViewed:()=>n.useWatchLaterTooltipViewed});var o=i(950726),s=i(119650),a=i(859809),n=i(278809),r=i(848631)},950726:(e,t,i)=>{i.d(t,{usePlaylistSubscriptionListener:()=>r});var o=i(293721),s=i(296540),a=i(694743),n=i(518538);const r=e=>{const t=e??a.appCatalogService,i=(0,o.useEvent)(t.playlistService.updatePlaylistSubscriptionState);(0,s.useEffect)((()=>{const e=({detail:e})=>i({album_id:e.albumId,owner_id:e.ownerId,is_subscribed:e.isSubscribed});return window.addEventListener(n.VideoPlaylistEvents.SUBSCRIPTION_STATE_CHANGE,e),()=>window.removeEventListener(n.VideoPlaylistEvents.SUBSCRIPTION_STATE_CHANGE,e)}),[])}},119650:(e,t,i)=>{i.d(t,{useRestrictedPlaylist:()=>n});var o=i(293721),s=i(271139),a=i(291903);const n=()=>{const e=(0,o.useStore)(s.playlistService.$videosError);return(0,a.isAccessDenied)(e)}},848631:(e,t,i)=>{i.d(t,{useSearchTrackCode:()=>a});var o=i(296540),s=i(687604);const a=()=>{const[e]=(0,o.useState)((()=>(0,s.getTrackCode)("search_track_code")));return e}},859809:(e,t,i)=>{i.d(t,{useUnavailablePlaylist:()=>n});var o=i(293721),s=i(271139),a=i(291903);const n=()=>{const e=(0,o.useStore)(s.playlistService.$videosError);return(0,a.isIdInvalid)(e)||(0,a.isVideosEnabled)(e)}},278809:(e,t,i)=>{i.d(t,{useWatchLaterTooltipViewed:()=>a});var o=i(296540),s=i(132792);const a=()=>{const[e,t]=(0,o.useState)(!1),i=(0,o.useCallback)((()=>{window.isVideoWatchLaterTooltipViewed=!0}),[]);return(0,o.useEffect)((()=>{const e=()=>t(!0);return window.addEventListener(s.VIDEO_SHOWCASE_WATCH_LATER_TOOLTIP_VIEWED_EVENT,e),()=>window.removeEventListener(s.VIDEO_SHOWCASE_WATCH_LATER_TOOLTIP_VIEWED_EVENT,e)}),[]),{isWatchLaterTooltipViewed:e,handleWatchLaterTooltipClose:i}}},745195:(e,t,i)=>{i.d(t,{getAuthorOnboardingTooltipsSharedState:()=>d,renderAuthorUserOnboardingTooltip:()=>c,renderHelpTooltip:()=>l});var o=i(165753),s=i(741531),a=i(942451),n=i(812477),r=i(610989);const d=()=>(0,a.makeSharedState)("author-onboarding-tooltips",(()=>({isAuthorUserTooltipShown:!1,isAuthorGroupTooltipShown:!1})),{version:1}),l=(e,t,i,o)=>{const{tooltip:s}=(0,n.helpHintTooltip)(e,{content:t,onHideRequestSent:i,isServerSideHideDisabled:!0},{width:o,forceSide:"top",withCloseButton:!1,appendToParent:!0,autoAdjustToViewport:!1,offset:[2,-6],noAutoHideOnWindowClick:!1,cls:"feature_intro_tt feature_intro_blue_tt"});window.requestAnimationFrame((()=>s.show()))},c=e=>{const t=d(),i=o.AvailableHelpHints.AUTHOR_LIKE_ONBOARDING_HINT;(0,s.ensureAccountHelpHintsService)().canShow(i)&&!t().isAuthorUserTooltipShown&&(t().isAuthorUserTooltipShown=!0,l(e,r.getLang("intro_hint_description_feed_author_like_onboarding"),(()=>(0,s.ensureAccountHelpHintsService)().hideHelpHint({hintId:i})),225))}},849225:(e,t,i)=>{i.d(t,{LikeButtonTypes:()=>o});const o={like:"like",share:"share",views:"views",comment:"comment"}},860310:(e,t,i)=>{i.d(t,{PlaylistPopover:()=>b});var o=i(474848),s=i(296540),a=i(696798),n=i(785118),r=i(415782),d=i(428918),l=i(216806),c=i(380118),h=i(828902),u=i(116638),p=i(533048),_=i(610989),v=i(882931),y=i(549318),g=i(422495),w=i(550119),m=i(998917);const b=({addedToMy:e,playlists:t,onToggleVideoAdded:i,children:b,trigger:I="hover",videoId:k,videoOwnerId:C,playlistsLoading:P,onCreateNewPlaylist:L,addedToMyCheckboxDisabled:x,fetchMorePlaylistEvent:f,cardRef:S,...T})=>{const[A,O]=(0,s.useState)(null);(0,m.useLazyLoad)(Boolean(f),f,A);return(0,o.jsx)(a.Popover,{trigger:I,restoreFocus:!1,content:(0,o.jsxs)(n.Div,{children:[(0,o.jsx)(r.Checkbox,{checked:e,disabled:x,onChange:()=>{S?.current?.parentElement?.focus(),i(e,g.MY_VIDEO_ALBUM_ID)},children:_.getLang("video_my_added_videos_playlist")}),(Boolean(t?.length)||P)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.Spacing,{size:8}),(0,o.jsx)(l.Separator,{}),(0,o.jsx)(d.Spacing,{size:4}),(0,o.jsx)(n.Div,{mode:"vertical",spacing:8,children:(0,o.jsx)(c.Footnote,{className:v.default.playlistSubhead,weight:"3",children:_.getLang("video_playlists")})})]}),P&&!t?.length&&(0,o.jsx)("div",{className:v.default.scrollHeight,children:(0,o.jsx)(h.Spinner,{})}),Boolean(t?.length)&&(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(u.CustomScrollView,{className:v.default.scrollHeight,boxRef:O,children:[t?.map((e=>(0,o.jsx)(w.PlaylistPopoverItem,{playlist:e,handleToggleVideoAdded:i},e.id))),P&&(0,o.jsx)(h.Spinner,{})]})}),(0,o.jsx)(p.Button,{onClick:L,mode:"tertiary",appearance:"accent-invariable",stretched:!0,align:"left",before:(0,o.jsx)(y.Icon20Add,{}),size:"m","data-testid":"create_playlist_from_video_card_checkbox_button",children:_.getLang("video_create_new_playlist_btn")})]}),...T,children:b})}},550119:(e,t,i)=>{i.d(t,{PlaylistPopoverItem:()=>u});var o=i(474848),s=i(296540),a=i(415782),n=i(320830),r=i(480958),d=i(610989),l=i(562791),c=i(8520),h=i(882931);const u=(0,s.memo)((({playlist:e,handleToggleVideoAdded:t})=>(0,o.jsx)(a.Checkbox,{checked:e.containsVideo,onChange:()=>t(e.containsVideo,e.id),titleAfter:e.isPrivate&&(0,o.jsx)(n.TextTooltip,{placement:"top",appearance:"black",offsetByCrossAxis:-56,offsetByMainAxis:4,text:d.getLang("video_playlist_private_tooltip"),children:(0,o.jsx)(l.Icon16LockOutline,{className:h.default.playlistPrivateIcon})}),children:(0,o.jsx)(r.TextClamp,{lines:1,children:(0,c.decodeHTMLEntities)(e.title)})},e.id)))},531386:(e,t,i)=>{i.d(t,{VideoForYouEvents:()=>s,VideoPlayerSyncEvents:()=>o,VideoPlaylistEvents:()=>a});const o={TOGGLE_FAVORITE:"VideoPlayerSyncEvents/TOGGLE_FAVORITE",TOGGLE_ADDING_TO_MY_VIDEOS:"VideoPlayerSyncEvents/TOGGLE_ADDING_TO_MY_VIDEOS"},s={VIEW_BLOCK:"VideoForYouEvents/VIEW_BLOCK"},a={SUBSCRIPTION_STATE_CHANGE:"VideoPlaylistEvents/SUBSCRIPTION_STATE_CHANGE"}},518538:(e,t,i)=>{i.d(t,{VideoForYouEvents:()=>o.VideoForYouEvents,VideoPlayerSyncEvents:()=>o.VideoPlayerSyncEvents,VideoPlaylistEvents:()=>o.VideoPlaylistEvents});var o=i(531386)},297215:(e,t,i)=>{i.d(t,{useOwner:()=>o.useOwner,usePlaylists:()=>s.usePlaylists,useVideoMenuItems:()=>a.useVideoMenuItems});var o=i(280501),s=i(556697),a=i(609372)},280501:(e,t,i)=>{i.d(t,{useOwner:()=>o.useOwner});var o=i(422495)},556697:(e,t,i)=>{i.d(t,{usePlaylists:()=>s});var o=i(293721);const s=e=>(0,o.useStoreMap)(e,(e=>Object.values(e).filter((e=>Boolean(e)))))},609372:(e,t,i)=>{i.d(t,{useVideoMenuItems:()=>B});var o=i(474848),s=i(296540),a=i(629775),n=i(829713),r=i(426222),d=i(370),l=i(289150),c=i(549318),h=i(490363),u=i(485749),p=i(223173),_=i(490639),v=i(917919),y=i(405816),g=i(8520),w=i(932709),m=i(165753),b=i(112268),I=i(610989),k=i(27995),C=i(659179),P=i(666717),L=i(615822),x=i(944255),f=i(271139),S=i(291903),T=i(476726),A=i(33281),O=i(181480),V=i(422495),E=i(531698);const j=({onClick:e,...t})=>{const i={...t};return e&&(i.onClick=t=>(0,S.ensureEventPropagationStopping)(t,e)),i},B=({video:e,handlers:t,playlistOwnerId:i=window.vk.id,canUserAddToGroupPlaylists:S=!1,playlistId:B})=>{const{onDeleteFromPlaylist:M,onDeleteVideo:R,onAddToGroup:D,onExportVideo:F,onToggleFave:H,onComplaintSuccess:N}=t||{},U=(0,w.useHelpHint)(m.AvailableHelpHints.ACCOUNT_HINT_VIDEO_WATCH_LATER_ACTION),{isWatchLaterTooltipViewed:W,handleWatchLaterTooltipClose:z}=(0,E.useWatchLaterTooltipViewed)(),[G,$]=(0,s.useState)(!1),q=(0,A.getVideoUrl)(e),Y=()=>{(0,g.copyTextToClipboard)(`https://${window.location.host}${q}`),(0,C.showSnackbar)({text:I.getLang("video_copied_to_clipboard"),before:{content:(0,o.jsx)(a.Icon20CheckAlt,{})}})},K=()=>{P.Likes.share(`video${(0,b.joinRawId)({ownerId:e.owner_id,itemId:e.id})}`)},J=t=>{(0,x.sendReportWithCallback)(t,e,N)},Q=t=>{(0,x.editVideo)(t,{owner_id:e.owner_id,id:e.id})},Z=()=>{(0,T.partConfigEnabled)("video_add_to_playlist_modal_mobx_move")?(0,L.showPlaylistModalWidget)({ownerId:i,videoId:e.id,isGroupOwner:S,videoOwnerId:e.owner_id,playlistId:B}):(0,L.showPlaylistsModal)({ownerId:i,videoPlaylistsModalService:f.videoPlaylistsModalService,video:e,isGroupOwner:S})};return{menuItems:(0,s.useMemo)((()=>{const t=[];if((0,k.isVKUserAnonymous)())return[];e.can_edit&&t.push({before:(0,o.jsx)(n.Icon20WriteOutline,{}),children:I.getLang("video_edit"),onClick:Q,"data-testid":"video_edit_button"});const i=(0,T.partConfigEnabled)("video_bookmarks_renaming_to_watch_later"),s=(e,t)=>i&&U&&!W?{before:(0,o.jsx)(V.MenuHelpHintTooltip,{helpHint:U,placement:"top-start",maxWidth:262,onClose:z,children:e}),children:t,"data-testid":"video_card_watch_later_button"}:{before:e,children:t,onClick:H,"data-testid":"video_card_favorite_button"};return H&&e.is_favorite?t.push(i?s((0,o.jsx)(r.Icon20ClockOutline,{}),I.getLang("video_remove_from_watch_later")):s((0,o.jsx)(d.Icon20FavoriteOutline,{}),I.getLang("global_remove_from_bookmarks"))):H&&e.can_add_to_faves&&t.push(i?s((0,o.jsx)(r.Icon20ClockOutline,{}),I.getLang("video_catalog_showcase_section_my_watch_later_title")):s((0,o.jsx)(d.Icon20FavoriteOutline,{}),I.getLang("global_add_to_bookmarks"))),3===e.can_download&&"interactive"!==e.type&&t.push({before:(0,o.jsx)(l.Icon20DownloadOutline,{}),children:I.getLang("video_download_video_from_modal"),onClick:t=>{t.stopPropagation(),(0,O.downloadVideo)({oid:String(e.owner_id),vid:String(e.id),title:String(e.title),type:"video"})},"data-testid":"video_download_button"}),D&&t.push({before:(0,o.jsx)(c.Icon20Add,{}),children:I.getLang("video_add_to_group"),onClick:D,"data-testid":"video_card_add_to_group_button"}),e.can_add&&t.push({before:(0,o.jsx)(h.Icon20ListPlusOutline,{}),children:I.getLang("video_move_to_playlist"),onClick:Z,"data-testid":"video_move_to_playlist"}),t.push({before:(0,o.jsx)(u.Icon20CopyOutline,{}),children:I.getLang("video_copy_video_link"),onClick:Y,"data-testid":"video_card_copy_video_link_button"}),F&&t.push({before:(0,o.jsx)(l.Icon20DownloadOutline,{}),children:I.getLang("video_export_action"),onClick:F,"data-testid":"video_card_export_button"}),0!==e?.restriction?.can_play&&t.push({before:(0,o.jsx)(p.Icon20ShareOutline,{}),children:I.getLang("video_share_with_friends"),onClick:K,"data-testid":"video_card_share_button"}),M&&t.push({before:(0,o.jsx)(_.Icon20DeleteOutline,{}),children:I.getLang("video_delete_from_playlist"),onClick:M,"data-testid":"video_card_delete_from_playlist_button"}),R&&t.push({before:(0,o.jsx)(v.Icon20Cancel,{}),children:I.getLang("video_delete_video"),onClick:R,"data-testid":"video_card_delete_button"}),e.owner_id!==window.vk.id&&t.push({before:(0,o.jsx)(y.Icon20ReportOutline,{}),children:I.getLang("global_report_spam"),onClick:J,"data-testid":"video_card_complain_button"}),t.map(j)}),[G]),onMenuPopoverShownChanged:e=>{$(e)}}}},958258:(e,t,i)=>{i.d(t,{updateAriaLabelCounter:()=>a});var o=i(610989),s=i(849225);const a=(e,t,i)=>{if(!("number"==typeof t&&e instanceof HTMLElement&&e.classList.contains("PostBottomAction")))return;const a=(e=>{let t;switch(e){case s.LikeButtonTypes.comment:t=o.getLang("likes_comments_N_aria_short","raw");break;case s.LikeButtonTypes.like:t=o.getLang("likes_likes_N_aria_short","raw");break;case s.LikeButtonTypes.share:t=o.getLang("likes_shares_N_aria_short","raw")}return t})(i);if(!a)return;const n=(0,o.langNumeric)(t,a,!1);e.setAttribute("aria-label",n)}}}]);try{stManager.done("dist/web/chunks/44ea4781.191a24f0.js")}catch(e){}