(()=>{var __webpack_modules__={355508:e=>{e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%" %attrs%>\n  %extra%<span class="ui_rmenu_item_label "><span class="ui_rmenu_label-text">%label%</span></span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<div class="ui_rmenu_extra_label"><span class="ui_rmenu_count _im_r_ct _im_r_badge">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button></div>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',sImDialogImRowPhoto:'<div class="im_grid">%photo%</div>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',im_peer_photo_nft:'<div class="nim-peer %modifier_class%"> %user_photo% %user_icon%</div>',sImContactAvatar:' <div class="ContactAvatar ContactAvatar--%size% %classes%">%name%</div>',sImUserAvatar:' <div class="ImUserAvatar _online %online_class% %classes%"> <img src="%src%" class="ImUserAvatar__img" alt=""> </div>',sImUserNftAvatar:' <div class="ImUserAvatar"> <div class="ImUserAvatar__img" alt=""> <span class="AvatarRich AvatarRich--sz-48 AvatarRich--shadow AvatarRich--nft" style="width: 48px; height: 48px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 3px " aria-hidden="true"> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src="%src%" class="AvatarRich__img" /> <div class="AvatarRich__badge AvatarRich__badge--shadow AvatarRich__badgeBottom">%online%</div> </span> </div> </div>',sImDrawNftOnline:' <div class="AvatarRich__badgeIcon--online"> <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M10 6a4 4 0 1 1-8 0 4 4 0 0 1 8 0z" fill="currentColor"/></svg> </div>',sImDrawNftOnlineMobile:' <div class="AvatarRich__badgeIcon--onlineMobile"> <svg xmlns="http://www.w3.org/2000/svg" width="8" height="12" fill="none" viewBox="0 0 8 12"><path fill="currentColor" d="M5.99 0C7.1 0 8 .9 8 2.01v7.98C8 11.1 7.1 12 5.99 12H2.01C.9 12 0 11.1 0 9.99V2.01C0 .9.9 0 2.01 0h3.98Zm0 3H2a.5.5 0 0 0-.5.5v5c0 .28.23.5.5.5h4a.5.5 0 0 0 .5-.5v-5A.5.5 0 0 0 6 3Z"/></svg> </div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> <span class="im-page--title-main-gitdonut _im_chat_donut"></span> </span> </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">%mail_network_reconnect%</button> %more_children%</div>',im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',sImSimpleNameBusinessNotifyLabel:'<span class="im-page--title-main-business-notify _im_chat_business_notify">%text%</span>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> <div class="im-page--dialogs-empty--icon">%icon%</div> %msg%</li>',im_dialogs_active_folder_button:'<li class="im-page--dialogs-folder-button %class_name%" data-list-id="all"> <button class="im-page--dialogs-folder-button--back _im_dialog_folder_back"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 0 1 0 1.06L7.8 10l4.72 4.72a.75.75 0 1 1-1.06 1.06l-5.25-5.25a.75.75 0 0 1 0-1.06l5.25-5.25a.75.75 0 0 1 1.05 0z" fill="currentColor"/></svg></button> <span class="im-page--dialogs-folder-button--text">%msg%</span> %actions%</li>',im_dialogs_active_folder_button_actions:'<button type="button" class="im-page--dialogs-folder-button--actions _im_dialog_folder_actions" data-folder="%folder%"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M9.53 6.42a.75.75 0 0 1 .94 0l5.25 4.25a.75.75 0 1 1-.94 1.16L10 7.96l-4.78 3.87a.75.75 0 1 1-.94-1.16z" fill="currentColor"/></svg></button>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="message_request_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8 2C4.44 2 1.5 4.52 1.5 7.75c0 1.09.34 2.12.95 3.02-.09.4-.36 1.04-.82 1.87a1.08 1.08 0 0 0 .46 1.49c.17.08.36.12.54.12A5.5 5.5 0 0 0 6 13.23a7.4 7.4 0 0 0 2 .28c3.56 0 6.5-2.52 6.5-5.76C14.5 4.52 11.56 2 8 2Zm0 1.5c-2.92 0-5 2.02-5 4.25 0 .8.25 1.55.73 2.22l.13.19a.75.75 0 0 1 .13.57l-.04.23a7.08 7.08 0 0 1-.65 1.74c.87-.1 1.44-.36 1.8-.66l.23-.21a.75.75 0 0 1 .7-.15l.31.1c.52.15 1.08.23 1.66.23 2.92 0 5-2.02 5-4.26 0-2.23-2.08-4.25-5-4.25Zm8.16 5.07a.75.75 0 1 1 1.18-.91A5.46 5.46 0 0 1 18.5 11a5.42 5.42 0 0 1-.91 3.01c.08.41.34 1.05.78 1.9a1.09 1.09 0 0 1-.99 1.59 5.18 5.18 0 0 1-3.23-1.01 6.8 6.8 0 0 1-1.9.27 6.73 6.73 0 0 1-2.57-.5.75.75 0 0 1 .57-1.39 5.22 5.22 0 0 0 2 .39 5.3 5.3 0 0 0 1.57-.24l.3-.09a.75.75 0 0 1 .71.16l.23.2c.33.3.85.54 1.66.65a7.34 7.34 0 0 1-.63-1.74l-.04-.23a.75.75 0 0 1 .12-.55l.13-.19A3.92 3.92 0 0 0 17 11c0-.9-.3-1.73-.84-2.43Z"/></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--counter">%counter%</span> </li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice BannerInfo BannerInfo--noMargin"> %msg% </div> </li>',im_dialogs_business_notify_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-business-notify-button _im_toggle_business_notify_tab %class_name%" data-list-id="business_notify_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 0 1-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 0 1-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8ZM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13Zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 0 0-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 0 0-.33-.33c-.2-.1-.39-.15-.98-.16Zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 0 0-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 0 0-.1-.63l-.06-.1a.77.77 0 0 0-.33-.33l-.1-.05a2.6 2.6 0 0 0-.94-.1Z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',sImBusinessNotifyDisableBoxContent:'<div class="im_bussiness_notify_disable_box"> <div class="im_bussiness_notify_disable_box_text"> %text% </div> </div>',im_dialogs_archives_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-archives-button _im_toggle_archives_tab %class_name%" data-list-id="archive_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M7 10.75c0-.41.34-.75.75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--mentions" data-mentions="%mentions%"><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',im_dialogs_archive_notice:'<li class="im-page--dialogs-archive-notice-w _im_archive_notice" data-list-id="archive_notice"> <div class="im-page--dialogs-archive-notice"> <span class="im-page--dialogs-archive-notice--title">%title%</span> <span class="im-page--dialogs-archive-notice--text">%text%</span> <button class="im-page--dialogs-archive-notice--close _im_archive_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_dialogs_archive_notice_button:'<button class="im-page--dialogs-archive-notice--button _im_archive_notice_settings">%text%</button>',im_dialogs_new_ui_notice:'<li class="im-page--dialogs-new-ui-notice-w _im_new_ui_notice" data-list-id="new_ui_notice"> <div class="im-page--dialogs-new-ui-notice"> <span class="im-page--dialogs-new-ui-notice--title">%title%</span> <span class="im-page--dialogs-new-ui-notice--text">%text%</span> <button class="im-page--dialogs-new-ui-notice--close _im_new_ui_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody% </span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%title%</span> <span class="im-fwd--date">%date%</span> </span> <span class="im-fwd--close _im_fwd_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <a target="_blank" href="%href%"><span class="AvatarRich AvatarRich--sz-36 AvatarRich--shadow AvatarRich--nft" style="width: 36px; height: 36px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px " aria-hidden="true"> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src="%photo%" alt="%name%" class="AvatarRich__img" /> </span></a> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_mess_stack_nft:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peer_id%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <a target="_blank" href="%href%"><span class="AvatarRich AvatarRich--sz-36 AvatarRich--shadow AvatarRich--nft" style="width: 36px; height: 36px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px " aria-hidden="true"> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src="%photo%" alt="%name%" class="AvatarRich__img" /> </span></a> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_no_nft:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peer_id%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"><div class="nim-peer--photo"><a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a></div></div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_dialog_deleted_media:'  <span class="nim-dialog--preview nim-dialog--preview-deleted-attach">\n    %mail_attach_deleted%\n  </span>',im_attachment_deleted:'<span class="im-mess--del-attach">%text%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">%wall_reply_submit_settings%</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">%wall_reply_submit_settings_1%</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">%wall_reply_submit_settings_2%</div></div>\n  </div>\n</div>',im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>%mail_new_unread_msgs%</span></h4>',im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"><div class="nim-peer--photo _im_dialog_photo">%photo%</div></div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="%mail_im_to_multidialog%: %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="%mail_casper_chat_label%" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="%mail_reactions_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="%mail_mention_badge_label%" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="%mail_expiring_message_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>',im_drow_classic:'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"><div class="nim-peer--photo _im_dialog_photo">%photo%</div></div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="%mail_im_to_multidialog%: %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="%mail_casper_chat_label%" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="%mail_reactions_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="%mail_mention_badge_label%" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="%mail_expiring_message_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>',im_drow_nft:'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <span class="AvatarRich AvatarRich--sz-46 AvatarRich--shadow AvatarRich--nft" style="width: 46px; height: 46px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px " aria-hidden="true"> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src="%photo%" alt="%tab_name%" class="AvatarRich__img" /> </span> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="%mail_im_to_multidialog%: %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="%mail_casper_chat_label%" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="%mail_reactions_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="%mail_mention_badge_label%" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="%mail_expiring_message_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>',im_drow_nft_classic:'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <span class="AvatarRich AvatarRich--sz-50 AvatarRich--shadow AvatarRich--nft" style="width: 50px; height: 50px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 3px " aria-hidden="true"> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src="%photo%" alt="%tab_name%" class="AvatarRich__img" /> </span> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="%mail_im_to_multidialog%: %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="%mail_casper_chat_label%" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="%mail_reactions_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="%mail_mention_badge_label%" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="%mail_expiring_message_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>',im_conversation_search_row:'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="%mail_im_to_multidialog%: %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="%mail_casper_chat_label%"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="%mail_reactions_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="%mail_mention_badge_label%" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="%mail_expiring_message_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>',im_conversation_search_nft_row:'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <span class="AvatarRich AvatarRich--sz-34 AvatarRich--shadow AvatarRich--nft" style="width: 34px; height: 34px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px " aria-hidden="true"> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src="%photo%" class="AvatarRich__img" /> </span> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="%mail_im_to_multidialog%: %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="%mail_casper_chat_label%"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="%mail_reactions_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="%mail_mention_badge_label%" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="%mail_expiring_message_badge_label%" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>',im_drow_actions_menu:'<button type="button" class="nim-dialog--actions _im_dialog_actions" data-peer="%peer_id%"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M13 6.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/></svg></button>',im_drow_close_button:'<button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer_id%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button>',im_page_inline_menu:'<ul class="im-page--inline-menu-list"> %actions%</ul>',im_page_inline_menu_item:'<li class="im-page--inline-menu--list-item"> <button class="im-page--inline-menu--button %class_name%" data-action="%action%"> <div class="im-page--inline-menu--button-icon">%icon%</div> <span class="im-page--inline-menu--button-text">%name%</span> </button> </li>',im_delete_actions:'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">%mail_restore%</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">%mail_im_mark_spam%</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">%mail_user_black_list%</button>',im_chat_change_topic:'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">%mail_chat_topic_change_label%</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>',im_msg_row:'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-cmid="%cmid%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="%mail_select_message%" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> <span class="im-mess--reactions _im_mess_reactions">%reactions%</span> </li>',sImHistoryRowActions:'<div class="im-mess--actions"> <span role="link" aria-label="%mail_im_set_reaction%" class="im-mess--reaction _im_mess_reaction"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.89 4.72a7.42 7.42 0 0 1-1.45 2.72c-.6.6-1.67 1.09-2.72 1.45a16.94 16.94 0 0 1-.8.25l-.27.08c-.39.1-.39.81 0 .92a21.17 21.17 0 0 1 1.07.33c1.05.36 2.11.84 2.72 1.45.6.6 1.09 1.67 1.45 2.72a16.94 16.94 0 0 1 .25.8l.08.27c.1.38.81.38.92 0a22.86 22.86 0 0 1 .27-.88 16.4 16.4 0 0 1 .06-.2c.36-1.04.84-2.1 1.45-2.71.6-.6 1.67-1.09 2.72-1.45a16.39 16.39 0 0 1 .8-.25l.27-.08c.39-.1.39-.82 0-.92a21.17 21.17 0 0 1-1.07-.33 7.44 7.44 0 0 1-2.72-1.45 7.44 7.44 0 0 1-1.45-2.72 16.4 16.4 0 0 1-.25-.8 22.85 22.85 0 0 1-.08-.27c-.1-.39-.81-.39-.92 0a21.17 21.17 0 0 1-.33 1.07ZM3.53.28a.4.4 0 0 0-.76 0l-.3.91a2 2 0 0 1-1.28 1.27l-.92.3a.4.4 0 0 0 0 .77l.92.3a2 2 0 0 1 1.27 1.28l.3.92a.4.4 0 0 0 .77 0l.3-.92a2 2 0 0 1 1.28-1.27l.91-.3a.4.4 0 0 0 0-.77l-.91-.3a2 2 0 0 1-1.27-1.28L3.53.28Z"/></svg></span> <span role="link" aria-label="%mail_im_mark_forward%" class="im-mess--forward _im_mess_forward"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="%mail_im_reply%" class="im-mess--reply _im_mess_reply"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="%mail_im_edit%" class="im-mess--edit _im_mess_edit"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m9.49 3.95 2.56 2.56-6.14 6.14a4.82 4.82 0 0 1-2 1.2l-2.1.64a.24.24 0 0 1-.3-.3l.64-2.1a4.82 4.82 0 0 1 1.2-2L9.5 3.95Zm3.67-2.13 1.02 1.02c.4.4.42 1.03.08 1.45l-1.17 1.18-2.56-2.56 1.1-1.1c.42-.42 1.1-.42 1.53 0Z"/></svg></span> <span role="link" aria-label="%mail_important_message%" class="im-mess--fav _im_mess_fav"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m5.75 3.87-.43 1c-.03.06-.04.1-.07.12a.23.23 0 0 1-.07.06c-.03.02-.07.02-.15.03l-.62.1c-1.77.24-2.65.37-3.02.78a1.53 1.53 0 0 0-.37 1.32c.11.55.81 1.1 2.2 2.22l.24.2c.06.05.1.07.11.1a.23.23 0 0 1 .04.1l-.02.15-.07.38c-.39 2.06-.58 3.09-.28 3.59a1.53 1.53 0 0 0 1.24.73c.59.02 1.4-.65 3-1.99l.28-.22c.08-.08.12-.11.17-.12a.23.23 0 0 1 .13 0c.05.01.09.04.17.11l.28.24c1.6 1.33 2.41 2 3 1.98a1.53 1.53 0 0 0 1.24-.73c.3-.5.11-1.53-.28-3.6l-.07-.37a.51.51 0 0 1-.02-.15.23.23 0 0 1 .04-.1l.11-.1.24-.2c1.39-1.11 2.09-1.67 2.2-2.22a1.53 1.53 0 0 0-.37-1.32c-.37-.41-1.25-.54-3.02-.79l-.62-.09c-.08 0-.12-.01-.15-.03a.23.23 0 0 1-.07-.06c-.03-.02-.04-.06-.07-.13l-.43-1c-.71-1.63-1.06-2.45-1.56-2.7a1.52 1.52 0 0 0-1.37 0c-.5.25-.85 1.07-1.56 2.7Z"/></svg></span> </div> <div class="im-mess--check fl_l"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zM6 7.94a.75.75 0 1 0-1 1.12l1.46 1.3c.44.38 1.1.33 1.49-.1l.04-.05 2.9-3.75a.75.75 0 1 0-1.19-.92L7.1 8.91 6 7.94z"/></svg></div>',im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_message_deleted_media:'  <span class="im-page-pinned--deleted-media">%mail_attach_deleted%</span>',im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:'<button class="im-page--retry _im_retry_media">%mail_retry%</button>',sImLblWasEdited:" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>%mail_was_edited_short%</span>",sImLblWasSourceInfo:" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>%mail_was_source_short%</span>",im_top_banner:'<div class="im-top-banner %classes%">\n  %icon%\n  <div class="im-top-banner--text">%text%</div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button>',im_calls_link:'<button class="im_srv_lnk_light _fc_call_link">%text%</button>',sImPeerMuteUnmute:'<button class="_im_peer_mute_unmute im-chat-input-block-control im-chat-input-block-control--with-icon im-chat-input-block-control--%type%">%text%</button>',sImPeerAcceptOrRejectMessageRequest:'<p>%mail_message_request_user_notice%</p> <p> <button type="button" class="flat_button %cls_accept%">%mail_message_request_accept%</button> <button type="button" class="flat_button secondary %cls_reject%">%mail_message_request_reject%</button> </p>',sImPeerReturnToChat:'<button class="_im_peer_return_to_chat im-chat-input-block-control">%text%</button>',sImCallSnippet:'<article class="CallSnippet %classes%" %attributes% tabindex="0" aria-label="%me_start_call%" role="button" > <div class="CallSnippet__users">%user_list%</div> <div class="CallSnippet__content"> <h3 class="CallSnippet__title">%title%</h3> <div class="CallSnippet__desc">%description%</div> </div> %button%</article>',sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:'<%tagName% class="FlatButton FlatButton--%appearance% FlatButton--size-s MessageKeyboard__button MessageKeyboard__button--%modifier% _im_mess_btn" %attributes%> <span class="FlatButton__in"> <span class="FlatButton__content">%label%</span> </span> </%tagName%>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:' <div class="im-page--casper-empty"> <div class="im-page--casper-empty__icon"><svg width="56" height="56" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M33.57 34.52c.6.65.57 1.67-.1 2.27-3 2.73-6.35 2.73-9.33 1.1-.74-.4-1.28-.8-1.61-1.1-.67-.6-.7-1.62-.1-2.27a1.66 1.66 0 0 1 2.19-.2l.13.1c.15.14.5.4.97.66 1.86 1.01 3.7 1.01 5.53-.65.67-.6 1.7-.56 2.32.09ZM19.5 22a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7ZM28 4c5.83 0 10.75 2.06 15.26 6.27A20.86 20.86 0 0 1 50 25.05l-.02 20.82c-.07 2.55-1.9 4.56-4.5 4.56-.59-.02-1.3-.12-2.24-.5l-1.92-.81a7.89 7.89 0 0 0-3.08-.81h-.15c-.42.04-.83.24-1.97 1.03l-1.75 1.25C32.16 52.16 30.03 52.93 28 53c-2.04 0-3.83-.69-6-2.18l-1.94-1.37-.55-.38a3.93 3.93 0 0 0-1.48-.74l-.25-.02c-.86 0-1.73.24-3.08.8l-1.93.82c-.8.32-1.22.44-1.7.48l-.55.02c-2.5 0-4.32-1.96-4.5-4.43L6 25.5c0-5.72 2.43-11.2 6.76-15.23C17.16 6.16 22.38 4.11 28 4Zm.02 3-.43.02c-4.78.2-9.12 2.02-12.79 5.44A17.85 17.85 0 0 0 9 25.07v.42l.02 20.37.01.1c.12.86.65 1.4 1.35 1.47h.11l.38-.01h.03c.09-.02.21-.06.44-.15l.26-.1 1.94-.82c1.6-.67 2.76-1 3.98-1.04h.46l.26.03.25.02c.98.15 1.67.51 3.04 1.46l.27.18 1.9 1.35c1.65 1.13 2.83 1.6 4.08 1.65h.16l.23-.01a8.85 8.85 0 0 0 4.14-1.62l.32-.22 1.78-1.27c1.7-1.18 2.52-1.57 3.83-1.57a10 10 0 0 1 3.9.9l.34.14 1.88.8c.51.2.85.27 1.13.28.82 0 1.39-.54 1.48-1.4v-.16L47 25.12a17.86 17.86 0 0 0-5.8-12.66C37.35 8.85 33.28 7.1 28.45 7h-.42Zm11.46 17.85c.6.52.7 1.46.2 2.1-.46.6-1.27.72-1.87.3l-.12-.09-.15-.13c-.9-.7-1.8-.66-2.74-.18l-.28.16-.13.09-.2.15c-.6.42-1.4.3-1.87-.3-.5-.64-.4-1.58.2-2.1.22-.2.57-.44 1.04-.68a5 5 0 0 1 5.92.68Z" fill="currentColor"/></svg></div> %mail_im_empty_casper_chat% </div>',sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message " data-last-msgid="%id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sUiActionsMenuSeparator:'<div class="ui_actions_menu_sep"></div>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item im-action im-action_%icon% %classes%" data-action="%action%"> %icon_html% %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem _im_dialog_peer_tag" data-id="%tag_id%" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </a> <button onclick="return showFastBox(%mail_ad_tag_no_access_box_title%, mail_ad_tag_no_access_box_text);" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </button> </div>',sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>',sImPeerTagsFilterItem:'<div class="PeerTagsFilterItem"> <input class="PeerTagsFilterItem__checkbox _im_peer_tags_filter_checkbox" type="checkbox" id="peer_tag_%tag_id%" %checked%> <label class="PeerTagsFilterItem__label" for="peer_tag_%tag_id%"> <span class="PeerTagsFilterItem__checkboxOff"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05 2.53C4.79 2.13 5.52 2 7.13 2h5.74c1.61 0 2.34.14 3.08.53.65.35 1.17.87 1.52 1.52.4.74.53 1.47.53 3.08v5.74c0 1.61-.14 2.34-.53 3.08a3.64 3.64 0 0 1-1.52 1.52c-.74.4-1.47.53-3.08.53H7.13c-1.61 0-2.34-.14-3.08-.53a3.64 3.64 0 0 1-1.52-1.52c-.4-.74-.53-1.47-.53-3.08V7.13c0-1.61.14-2.34.53-3.08.35-.65.87-1.17 1.52-1.52Zm3.08.97c-1.53 0-1.96.14-2.38.36-.38.2-.69.5-.9.9-.21.4-.35.84-.35 2.37v5.74c0 1.53.14 1.96.36 2.38.2.38.5.69.9.9.4.21.84.35 2.37.35h5.74c1.53 0 1.96-.14 2.38-.36.38-.2.69-.5.9-.9.21-.4.35-.84.35-2.37V7.13c0-1.53-.14-1.96-.36-2.38-.2-.38-.5-.69-.9-.9-.4-.21-.84-.35-2.37-.35H7.13Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__checkboxOn"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.44 4.18C2 5.04 2 6.16 2 8.4v3.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h3.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C14.96 2 13.84 2 11.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74Zm12.2 3.8a.9.9 0 1 0-1.28-1.27L8.7 11.38 6.64 9.33a.9.9 0 0 0-1.28 1.27l2.7 2.69a.9.9 0 0 0 1.27 0l5.3-5.3Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterItem__name">%name%</span> <span class="PeerTagsFilterItem__count">%count%</span> </label> </div>',sImPeerTagsFilterPaneItem:'<div class="PeerTagsFilterPaneItem _im_peer_tags_filter_pane_item" data-id="%tag_id%"> <span class="PeerTagsFilterPaneItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterPaneItem__name">%name%</span> <span class="PeerTagsFilterPaneItem__remove"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> </div>',sImCallUser:'<img src="%url%" alt="%name%" class="CallUsers__user">',sImCallUsers:'<div class="CallUsers"> <svg xmlns="http://www.w3.org/2000/svg" class="CallUsers__hidden"> <defs> <clipPath id="user-frame"> <path d="M12 0a12 12 0 11-7.97 20.97C5.89 18.47 7 15.37 7 12c0-3.36-1.1-6.47-2.97-8.97A11.95 11.95 0 0112 0z"/> </clipPath> </defs> </svg> <figure class="CallUsers__list"> %users% </figure> </div>',sImCallBannerContent:'<article class="CallBanner %cls%"> <div class="CallBanner__users">%user_list%</div> <div class="CallBanner__content"> <h3 class="CallBanner__title">%title%</h3> <div class="CallBanner__desc">%desc%</div> </div> </article>',sImCallBannerButton:'<button class="FlatButton FlatButton--secondary FlatButton--size-s _im_call_banner_join_btn _im_top_banner_button" type="button" data-link="%call_link%" >\n  <span class="FlatButton__in FlatButton__in--noPointerEvents">\n    \n    <span class="FlatButton__content">%mail_join_chat%</span>\n    \n  </span>\n</button>',sImAudioMsgPlayerASRToggle:' <button onclick="return AudioMessagePlayer.toggleTranscript(this, event);" class="audio-msg-track--transcriptToggle _msg_asr_toggle" > <span class="audio-msg-track--transcriptToggleShow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M1.89 12.11c.46 0 .73-.23.9-.8L3.22 10h3.05l.45 1.33c.15.55.42.78.92.78.51 0 .88-.34.88-.83a1.56 1.56 0 0 0-.11-.56L6.1 4.42c-.25-.69-.66-1-1.36-1-.66 0-1.08.32-1.33 1.01l-2.3 6.29a1.82 1.82 0 0 0-.12.56c0 .5.34.83.9.83ZM3.6 8.63l1.1-3.47h.04l1.12 3.46H3.61Zm7.62 3.47c.78 0 1.57-.4 1.92-1.06h.03v.32c.04.5.36.76.82.76.49 0 .83-.29.83-.86V7.68c0-1.26-1.04-2.1-2.66-2.1-1.3 0-2.3.47-2.6 1.22a.9.9 0 0 0-.09.38c0 .39.3.66.72.66a.86.86 0 0 0 .68-.32c.38-.49.7-.66 1.22-.66.64 0 1.05.34 1.05.93v.41l-1.58.1c-1.57.1-2.45.75-2.45 1.9 0 1.13.91 1.9 2.1 1.9Zm.56-1.24c-.58 0-.96-.29-.96-.76 0-.44.36-.73 1-.78l1.32-.08v.46c0 .68-.61 1.16-1.36 1.16Z"/></svg></span> <span class="audio-msg-track--transcriptToggleHide"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="currentColor" viewBox="0 0 16 12"><path d="M4.45 8.31a.9.9 0 0 1-1.1-1.42l4.1-3.2a.9.9 0 0 1 1.1 0l4.1 3.2a.9.9 0 1 1-1.1 1.42L8 5.54 4.45 8.31Z"/></svg></span> </button>',sImCarousel:'<div class="Carousel _im_carousel" data-scroll-count="%scroll_count%"> <button class="Carousel__control Carousel__control--prev Carousel__control--hidden _im_carousel_control _im_carousel_control_left %controls_class%" data-direction="-1"><svg fill="none" height="16" viewBox="0 0 12 16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="m4.77 8 3.37 3.36a.9.9 0 1 1-1.28 1.28l-4-4a.9.9 0 0 1 0-1.28l4-4a.9.9 0 1 1 1.28 1.28z" fill="currentColor"/></svg></button> <button class="Carousel__control Carousel__control--next _im_carousel_control _im_carousel_control_right %controls_class%" data-direction="1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" fill="none" viewBox="0 0 12 16"><path fill="currentColor" d="M7.23 8 3.86 4.64a.9.9 0 0 1 1.28-1.28l4 4a.9.9 0 0 1 0 1.28l-4 4a.9.9 0 0 1-1.28-1.28L7.23 8Z"/></svg></button> <div class="Carousel__viewport _im_carousel_viewport"> <div class="Carousel__layer _im_carousel_layer"> %content% </div> </div> </div>',sImBotCarousel:'<div class="BotCarousel _im_bot_carousel _im_bot_carousel_%msg_id%"> %content%</div>',sImBotCarouselSlide:'<div class="BotCarousel__slide" data-index="%index%">%content%</div>',sImBotCarouselSlideTitle:'<div class="BotCarousel__slideTitle">%content%</div>',sImBotCarouselSlideDescription:'<div class="BotCarousel__slideDescription">%content%</div>',sImBotCarouselSlideContent:'<div class="BotCarousel__slideContent">%content%</div>',sImBotCarouselSlideLinkWrapper:'<a href="%url%" class="BotCarousel__slideLinkWrapper" target="_blank" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhotoLinkWrapper:'<a href="#" class="BotCarousel__slideLinkWrapper" onclick="return showPhoto(\'%photo_id%\', \'mail%msg_id%\', {}, event)" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhoto:"<img class=\"BotCarousel__slideImage\" src='%url%' alt='%alt%' />",sImBotCarouselSlideButtons:'<div class="BotCarousel__slideButtons">%content%</div>',sImBotCarouselSlideButton:'<%tag_name% class="FlatButton FlatButton--%appearance% FlatButton--size-m FlatButton--wide BotCarousel__slideButton BotCarousel__slideButton--%modifier% _im_mess_btn" %attributes%> <span class="FlatButton__in"> <span class="FlatButton__content">%label%</span> </span> </%tag_name%>',sImConvoRecommendListUser:'<li class="ConvoRecommendList__item"> <a href="%link%" class="ConvoRecommendList__button _im_dialog _convoRecommendUser" data-peer="%id%" data-position="%position%" data-trackcode="%track_code%"> <div class="ConvoRecommendList__avatar"> %photo% <button class="ConvoRecommendList__removeItem _convoRecommendUserRemove" aria-label="%remove_label%"> <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg> </button> </div> <span class="ConvoRecommendList__name">%name%</span> </a> </li>',sImConvoRecommendListButton:'<li class="ConvoRecommendList__item"> <%tag_name% %attributes% class="ConvoRecommendList__button %classes%"> <span class="ConvoRecommendList__avatar ConvoRecommendList__icon" aria-hidden="true"> %icon% </span> <span class="ConvoRecommendList__name">%title%</span> </%tag_name%> </li>',sImConvoRecommendList:'<ul class="ConvoRecommendList" data-list-id="recommend_list"> %list_content%</ul>',sImEmptyDialogStub:' <div class="EmptyDialogStub %classes%"> <div class="EmptyDialogStub__main"> <div class="EmptyDialogStub__avatar">%avatar%</div> <div class="EmptyDialogStub__name">%name%</div> <div class="EmptyDialogStub__savedAs">%saved_as%</div> <div class="EmptyDialogStub__description">%stub_text%</div> </div> %secondary_block% </div> <div class="_im_stickers_panel_placeholder"></div>',sImEmptyDialogStubUserInfo:' <div class="EmptyDialogStub__secondary"> <div class="EmptyDialogStub__additional"> <div class="EmptyDialogStub__additionalIcon">%additional_icon%</div> %additional_info% </div> %mutual_friends% <div class="EmptyDialogStub__actions"> <a class="FlatButton FlatButton--secondary FlatButton--size-m" draggable="false" href="%profile_href%" > <span class="FlatButton__in"> <span class="FlatButton__content">%mail_view_profile%</span> </span> </a> %subscribe_button% </div> </div>',sImEmptyDialogStubSubscribeButton:'<button class="FlatButton FlatButton--primary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">%button_text%</span>\n    \n  </span>\n</button>',sImEmptyDialogStubUnsubscribeButton:'<button class="FlatButton FlatButton--secondary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">%button_text%</span>\n    \n  </span>\n</button>',sImEmptyDialogStubMutualFriends:' <div class="EmptyDialogStub__mutualFriends"> <div class="EmptyDialogStub__mutualFriendsPhotos">%friends%</div> <div class="EmptyDialogStub__mutualFriendsCount">%text%</div> </div>',sImEmptyDialogStubMutualFriend:' <img src="%src%" class="EmptyDialogStub__mutualFriendPhoto" alt="%name%" />',sImEmptyDialogStickers:'<div class="EmptyDialogStickers"> %content%</div>',sImEmptyDialogSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogAnimatedSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animation_url%"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogPopupSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-sticker-layers="%layers%"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> <div class="stickerIcon popupStickerIcon popupStickerHinticon">%icon%</div> </a>',sImDialogImRowAvatarRichSkinPhoto:'<span class="AvatarRich AvatarRich--sz-%size% AvatarRich--shadow AvatarRich--nft" style="width: %size%px; height: %size%px; border-radius: unset; --avatar-rich-stroke-width: 1px; --avatar-rich-nft-frame-width: 2px " aria-hidden="true"> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src="%photo%" class="AvatarRich__img" /> </span>',sImReactionsPanel:' <div class="MessageReactionsPanel _im_reaction_panel %classes%"> %reactions% <div class="MessageReactionsPanel__arrow"></div> </div>',sImReactionsPanelItem:' <div class="MessageReactionsPanel__reaction %selected% _im_reactions_panel_item" data-id="%id%"> <img src="%icon%" /> </div>',sImMessageReactions:' <div class="MessageReactions %classes% _im_message_reaction" data-id="%id%"> <div class="MessageReactions__icon">%icon%</div> <div class="MessageReactions__peers">%peers%</div> <div class="MessageReactions__counter">%count%</div> </div>',sImMessageReactionsIcon:' <img src="%icon%" />',sImMessageReactionsPeer:'    <img class="MessageReactions__peer" data-id="%peer_id%" src="%src%" title="%name%">',sImMessageReactionsModalButton:'    <button class="MessageReactionsModalButton _im_message_reactions_modal"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M13 6.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/></svg></button>'}},531769:(e,t,s)=>{"use strict";s.d(t,{Icon46MessageReaction404:()=>i});var i=(0,s(844990).makeIcon)("Icon46MessageReaction404","message_reaction_404_46","0 0 46 46",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 46 46" id="message_reaction_404_46"><path fill-rule="evenodd" d="M22.465 6.176c-.214.16-.379.604-.707 1.493-1.203 3.249-1.804 4.874-2.686 6.283a16.16 16.16 0 0 1-5.12 5.12c-1.41.882-3.034 1.483-6.283 2.686-.89.329-1.333.493-1.493.708a.9.9 0 0 0 0 1.069c.16.214.604.379 1.493.708 3.25 1.202 4.874 1.803 6.283 2.686a16.16 16.16 0 0 1 5.12 5.12c.882 1.408 1.483 3.033 2.686 6.283.328.888.493 1.333.707 1.492a.9.9 0 0 0 1.07 0c.214-.16.379-.604.707-1.492 1.203-3.25 1.804-4.875 2.686-6.284a16.16 16.16 0 0 1 5.12-5.12c1.41-.882 3.034-1.483 6.283-2.685.89-.33 1.333-.494 1.493-.708a.9.9 0 0 0 0-1.07c-.16-.214-.604-.378-1.493-.707-3.25-1.203-4.874-1.804-6.283-2.686a16.16 16.16 0 0 1-5.12-5.12c-.882-1.41-1.483-3.034-2.686-6.283-.328-.89-.493-1.333-.707-1.493a.9.9 0 0 0-1.07 0m-.875 18.945c0 .109.088.196.196.196h1.794a.196.196 0 0 0 .196-.196q.006-.566.144-.951a1.9 1.9 0 0 1 .433-.681q.294-.294.75-.565a4.8 4.8 0 0 0 .94-.721q.397-.405.617-.923.225-.525.225-1.2 0-1.009-.502-1.724t-1.384-1.09q-.883-.381-2.03-.381-1.045 0-1.91.375a3.17 3.17 0 0 0-1.39 1.124q-.44.63-.531 1.542a.335.335 0 0 0 .34.362h1.625c.204 0 .365-.164.413-.362a1.36 1.36 0 0 1 .731-.912q.335-.168.71-.168.386 0 .703.161.324.162.514.462c.19.3.19.432.19.698q0 .375-.167.68-.168.3-.45.548a5.4 5.4 0 0 1-.64.479q-.479.3-.82.67-.34.368-.518.968-.173.6-.18 1.61Zm.156 3.872q.409.404.986.404.37 0 .68-.184.312-.191.502-.502a1.32 1.32 0 0 0-.22-1.667 1.34 1.34 0 0 0-.962-.404q-.577 0-.986.404-.404.403-.398.969-.006.57.398.98" clip-rule="evenodd" /></symbol>',46,46,!1,void 0)},342798:(e,t,s)=>{"use strict";s.d(t,{Icon16Stars:()=>i});var i=(0,s(844990).makeIcon)("Icon16Stars","stars_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="stars_16"><path fill-rule="evenodd" d="M8.887 4.724C8.53 5.773 8.047 6.832 7.44 7.44c-.608.607-1.667 1.089-2.716 1.447a17 17 0 0 1-.801.253l-.277.08c-.381.105-.381.815 0 .92a21 21 0 0 1 1.078.332c1.049.36 2.108.84 2.716 1.448.607.608 1.089 1.667 1.447 2.715a17 17 0 0 1 .253.802l.08.277c.105.381.815.381.92 0a23 23 0 0 1 .266-.88l.067-.199c.358-1.048.84-2.107 1.447-2.715s1.667-1.089 2.716-1.447a16 16 0 0 1 .8-.254l.278-.079c.381-.105.381-.815 0-.92a21 21 0 0 1-1.079-.333c-1.048-.358-2.107-.84-2.715-1.447s-1.089-1.667-1.447-2.716a16 16 0 0 1-.254-.801l-.079-.277c-.105-.381-.815-.381-.92 0a21 21 0 0 1-.333 1.078M3.53.275a.402.402 0 0 0-.762 0l-.305.917c-.2.6-.671 1.07-1.271 1.27l-.917.306a.402.402 0 0 0 0 .763l.917.306c.6.2 1.07.67 1.27 1.27l.306.918c.123.366.64.366.763 0l.306-.918c.2-.6.67-1.07 1.27-1.27l.918-.306a.402.402 0 0 0 0-.763l-.918-.305c-.6-.2-1.07-.671-1.27-1.271z" /></symbol>',16,16,!1,void 0)},872453:(e,t,s)=>{"use strict";s.d(t,{Icon24List:()=>i});var i=(0,s(844990).makeIcon)("Icon24List","list_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="list_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12a1.5 1.5 0 1 0-.001 2.999A1.5 1.5 0 0 0 4 16.5M21 18a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1m0-6a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1M8 7h12a1 1 0 0 0 0-2H8a1 1 0 1 0 0 2" /></g></symbol>',24,24,!1,void 0)},758778:(e,t,s)=>{"use strict";s.d(t,{Icon28ArchiveCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28ArchiveCircleFillGray","archive_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="archive_circle_fill_gray_28"><linearGradient id="archive_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#archive_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><g fill="#fff"><path d="M6.568 8.482c-.068.255-.068.565-.068 1.185 0 .31 0 .465.034.592a1 1 0 0 0 .707.707c.127.034.282.034.592.034h12.334c.31 0 .465 0 .592-.034a1 1 0 0 0 .707-.707c.034-.127.034-.282.034-.592 0-.62 0-.93-.068-1.185a2 2 0 0 0-1.414-1.414C19.763 7 19.453 7 18.833 7H9.167c-.62 0-.93 0-1.185.068a2 2 0 0 0-1.414 1.414" /><path fill-rule="evenodd" d="M8 14.1c0-.56 0-.84.109-1.054a1 1 0 0 1 .437-.437C8.76 12.5 9.04 12.5 9.6 12.5h8.8c.56 0 .84 0 1.054.109a1 1 0 0 1 .437.437C20 13.26 20 13.54 20 14.1v2.1c0 1.68 0 2.52-.327 3.162a3 3 0 0 1-1.311 1.311C17.72 21 16.88 21 15.2 21h-2.4c-1.68 0-2.52 0-3.162-.327a3 3 0 0 1-1.311-1.311C8 18.72 8 17.88 8 16.2zm3.5.65a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 0 1.5h-3.5a.75.75 0 0 1-.75-.75" clip-rule="evenodd" /></g></symbol>',28,28,!1,void 0)},817970:(e,t,s)=>{"use strict";s.d(t,{Icon28EducationCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28EducationCircleFillGray","education_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="education_circle_fill_gray_28"><rect width="28" height="28" fill="url(#education_circle_fill_gray_28_a)" rx="14" /><path fill="#fff" d="M19.2 14.937v1.732c0 2.116-2.328 3.831-5.2 3.831s-5.2-1.715-5.2-3.83l-.001-1.733 4.01 2.192a2.5 2.5 0 0 0 2.23.075l.15-.075zm-4.804-8.336 7.197 3.933a.76.76 0 0 1 .404.665H22v4.704c0 .423-.358.766-.8.766s-.8-.343-.8-.766v-3.387l-6.004 3.282a.83.83 0 0 1-.793 0l-7.2-3.933a.749.749 0 0 1 0-1.33l7.2-3.934a.83.83 0 0 1 .793 0" /><defs><linearGradient id="education_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#B1B6BD" /><stop offset="1" stop-color="#99A2AD" /></linearGradient></defs></symbol>',28,28,!1,void 0)},120757:(e,t,s)=>{"use strict";s.d(t,{Icon28MessageUnreadCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28MessageUnreadCircleFillGray","message_unread_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="message_unread_circle_fill_gray_28"><linearGradient id="message_unread_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#message_unread_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><g fill="#fff"><path d="M19.87 12.17a3 3 0 0 1-4.09-3.935A6.8 6.8 0 0 0 13.999 8c-3.314 0-6 2.359-6 5.269 0 1.406.628 2.684 1.653 3.63a11.5 11.5 0 0 1-.404 1.688q-.083.26-.224.606a.58.58 0 0 0 .017.475.606.606 0 0 0 .801.273l.159-.076q.228-.113.401-.21a12 12 0 0 0 1.895-1.333c.54.14 1.11.215 1.702.215 3.314 0 6-2.359 6-5.268q-.001-.567-.13-1.099" /><path d="M20 9.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" /></g></symbol>',28,28,!1,void 0)},675277:(e,t,s)=>{"use strict";s.d(t,{Icon28NotificationCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28NotificationCircleFillGray","notification_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="notification_circle_fill_gray_28"><linearGradient id="notification_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#notification_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" d="M15.817 19.5a1.85 1.85 0 0 1-3.634 0zM9.5 18Q8 18 8 17c0-1 1.5-1 1.5-2.5v-3a4.5 4.5 0 0 1 3.7-4.43V7a.8.8 0 0 1 1.6 0v.071a4.5 4.5 0 0 1 3.7 4.429v3C18.5 16 20 16 20 17q0 1-1.5 1z" /></symbol>',28,28,!1,void 0)},27716:(e,t,s)=>{"use strict";s.d(t,{Icon28SendCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28SendCircleFillGray","send_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="send_circle_fill_gray_28"><linearGradient id="send_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#send_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" d="M10.16 16.628q-.686 1.947-.863 2.737c-.368 1.653-.637 2.026.738 1.24s8.031-4.679 9.516-5.544c1.936-1.128 1.962-1.04-.104-2.237-1.573-.912-8.15-4.703-9.412-5.447-1.26-.745-1.106-.414-.738 1.24q.179.8.875 2.761c.324.915 1.079 1.586 1.992 1.772l3.843.781a.07.07 0 0 1 .052.083.07.07 0 0 1-.052.055l-3.852.78c-.916.186-1.673.86-1.996 1.779" /></symbol>',28,28,!1,void 0)},812628:(e,t,s)=>{"use strict";s.d(t,{Icon28SunglassesCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28SunglassesCircleFillGray","sunglasses_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="sunglasses_circle_fill_gray_28"><path fill="url(#sunglasses_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" d="M5.84 15.44c-.186-1.213-.23-1.357-.555-1.816-.409-.577-.467-1.238.428-1.412 2.296-.446 4.782-.113 7.047.302a6.2 6.2 0 0 0 2.48 0c2.265-.415 4.75-.748 7.047-.302.895.174.837.835.428 1.412-.325.46-.369.603-.555 1.816-.278 1.82-1.807 2.56-3.7 2.56-2.08 0-2.773-1.187-3.418-2.805-.628-1.573-1.454-1.573-2.082 0C12.315 16.813 11.622 18 9.541 18c-1.894 0-3.423-.741-3.701-2.56" /><defs><linearGradient id="sunglasses_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#B1B6BD" /><stop offset="1" stop-color="#99A2AD" /></linearGradient></defs></symbol>',28,28,!1,void 0)},592837:(e,t,s)=>{"use strict";s.d(t,{Icon28TextCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28TextCircleFillGray","text_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="text_circle_fill_gray_28"><path fill="url(#text_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" d="M18.42 18.97c.996 0 2.09-.51 2.535-1.379H21v.419c.045.655.357.99.944.99.617 0 1.056-.38 1.056-1.12v-4.653c0-1.645-1.331-2.727-3.376-2.727-1.65 0-2.93.602-3.301 1.577a1.2 1.2 0 0 0-.112.502c0 .503.38.853.907.853.35 0 .625-.137.863-.41.483-.64.885-1.022 1.546-1.022.818 0 1.473.602 1.473 1.364v.54l-2.142.122c-1.993.122-3.108.989-3.108 2.474 0 1.47 1.153 2.47 2.67 2.47m.713-1.607c-.728 0-1.152-.381-1.152-.99 0-.58.394-.953 1.204-1.014L21 15.253v.594c0 .883-.915 1.516-1.867 1.516" /><path fill="#fff" fill-rule="evenodd" d="M6.189 19c.621 0 .971-.297 1.189-1.01l.59-1.67.095-.32h3.853l.1.32.59 1.693c.21.697.56.987 1.22.987.684 0 1.174-.438 1.174-1.054 0-.223-.039-.423-.148-.712l-3.077-7.972C11.441 8.386 10.897 8 9.981 8c-.886 0-1.438.4-1.764 1.27l-3.062 7.964c-.1.274-.155.526-.155.712C5 18.592 5.458 19 6.189 19m3.745-8.803h.054l1.456 4.303H8.51z" clip-rule="evenodd" /><defs><linearGradient id="text_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#B1B6BD" /><stop offset="1" stop-color="#99A2AD" /></linearGradient></defs></symbol>',28,28,!1,void 0)},180304:(e,t,s)=>{"use strict";s.d(t,{Icon28UsersCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28UsersCircleFillGray","users_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="users_circle_fill_gray_28"><linearGradient id="users_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#users_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" d="M10.5 15c2.25 0 4.5.9 4.5 2.846v.134c0 .295-.04.447-.113.585a.77.77 0 0 1-.322.321c-.138.075-.29.114-.585.114H7.02c-.295 0-.447-.04-.585-.113a.77.77 0 0 1-.321-.322c-.075-.138-.114-.29-.114-.585v-.134C6 15.9 8.25 15 10.5 15m7 0c2.25 0 4.5.9 4.5 2.846v.134c0 .295-.04.447-.113.585a.77.77 0 0 1-.322.321c-.138.075-.29.114-.585.114H16.6c.084-.248.13-.508.144-.797l.006-.223v-.134c0-1.069-.358-1.957-.971-2.659A7.7 7.7 0 0 1 17.5 15m-7-6a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5m7 0a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5" /></symbol>',28,28,!1,void 0)},298684:(e,t,s)=>{"use strict";s.d(t,{Icon28VolumeCircleFillGray:()=>i});var i=(0,s(844990).makeIcon)("Icon28VolumeCircleFillGray","volume_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="volume_circle_fill_gray_28"><linearGradient id="volume_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#volume_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" fill-rule="evenodd" d="M6.923 11.5H9l3.293-3.293A1 1 0 0 1 14 8.914v10.172a1 1 0 0 1-1.707.707L9 16.5H6.923c-.669 0-.911-.07-1.156-.2-.244-.131-.436-.323-.567-.567s-.2-.487-.2-1.156v-1.154c0-.669.07-.911.2-1.156.131-.244.323-.436.567-.567.245-.13.487-.2 1.156-.2m9.526-.788a.9.9 0 0 1 1.27.097A4.9 4.9 0 0 1 18.9 14c0 1.216-.444 2.33-1.177 3.186a.9.9 0 1 1-1.367-1.17A3.08 3.08 0 0 0 17.1 14c0-.772-.28-1.476-.747-2.018a.9.9 0 0 1 .096-1.27m4.044-2.39a.9.9 0 1 0-1.251 1.294A6.08 6.08 0 0 1 21.1 14a6.08 6.08 0 0 1-1.859 4.384.9.9 0 0 0 1.252 1.294A7.88 7.88 0 0 0 22.9 14a7.88 7.88 0 0 0-2.407-5.677" clip-rule="evenodd" /></symbol>',28,28,!1,void 0)},425414:(e,t,s)=>{"use strict";s.d(t,{Icon56PhoneOutline:()=>i});var i=(0,s(844990).makeIcon)("Icon56PhoneOutline","phone_outline_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56" id="phone_outline_56"><g fill="none" fill-rule="evenodd"><path d="M0 0h56v56H0z" /><path fill="currentColor" fill-rule="nonzero" d="M33.407 35.76 31.9 37.268a2.97 2.97 0 0 1-3.118.688c-1.75-.644-3.783-2.162-6.176-4.555-2.395-2.395-3.912-4.427-4.552-6.176a2.97 2.97 0 0 1 .686-3.118l1.51-1.508c2.24-2.24 2.443-5.745.498-8.052l-1.772-2.106c-1.48-1.76-4.17-1.939-6.012-.373a5.3 5.3 0 0 0-1.562 2.312 5.4 5.4 0 0 0-.26 1.265c-.835 6.194 2.212 12.826 9.303 19.918s13.72 10.137 19.974 9.295a5.32 5.32 0 0 0 3.513-1.809c1.573-1.846 1.393-4.54-.366-6.02l-2.104-1.772c-2.31-1.943-5.814-1.738-8.054.503m-2.121-2.122c3.327-3.327 8.588-3.635 12.107-.677l2.105 1.773c3.048 2.566 3.355 7.164.71 10.269-1.4 1.62-3.372 2.638-5.447 2.835-7.26.978-14.746-2.46-22.438-10.154C10.63 29.991 7.19 22.502 8.16 15.311c.058-.645.192-1.28.4-1.896a8.33 8.33 0 0 1 2.452-3.626c3.1-2.636 7.695-2.329 10.259.72l1.77 2.105c2.963 3.514 2.657 8.778-.671 12.107l-1.493 1.491c.464 1.25 1.747 2.966 3.85 5.068 2.1 2.1 3.815 3.384 5.066 3.852z" /></g></symbol>',56,56,!1,void 0)},397139:()=>{},73243:()=>{},957485:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});const i={highlight:"CategoryGroup-module__highlight--Lukeh"}},923448:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});const i={icon:"SkillItem-module__icon--ubBP6",skillImage:"SkillItem-module__skillImage--dwecA"}},910944:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});const i={peer:"MessageReactionsPopup-module__peer--ldbRl",icon:"MessageReactionsPopup-module__icon--SENfF"}},622818:(e,t,s)=>{"use strict";function i(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M10.1 1.78c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17C9.15 3.33 9 3.6 9 4a1 1 0 0 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/><path clip-rule="evenodd" d="M17.29 11.7c-.22.3-.49.53-.79.7v.68c0 .53 0 .98-.03 1.34-.03.38-.1.74-.27 1.08-.26.52-.68.94-1.2 1.2-.34.17-.7.24-1.08.27-.36.03-.8.03-1.34.03H7.42c-.53 0-.98 0-1.34-.03-.38-.03-.74-.1-1.08-.27a2.75 2.75 0 0 1-1.2-1.2 2.8 2.8 0 0 1-.27-1.08c-.03-.36-.03-.8-.03-1.34v-.69a2.5 2.5 0 0 1-.79-.69A4.45 4.45 0 0 1 2 9h.75H2v-.02a1.42 1.42 0 0 1 0-.12 2.44 2.44 0 0 1 .4-1.14C2.83 7.05 3.64 6.5 5 6.5h10c1.36 0 2.17.55 2.6 1.22a2.58 2.58 0 0 1 .4 1.26v.01c0 1.08-.2 2.02-.71 2.71zM3.5 9.01c0 .92.18 1.48.41 1.79.2.27.52.45 1.09.45.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.57 0 .88-.18 1.09-.45.23-.31.4-.87.41-1.79v-.02c0-.02 0-.06-.02-.1-.02-.1-.06-.24-.14-.36C16.2 8.33 15.89 8 15 8H5c-.9 0-1.2.33-1.34.53a1.08 1.08 0 0 0-.16.48zM17.25 9H18zm-4.4 2.78c.43.44 1.11.97 2.15.97v.3c0 .57 0 .96-.02 1.25-.03.29-.07.43-.12.52-.12.23-.3.42-.54.54-.1.05-.23.1-.52.12-.3.02-.68.02-1.25.02h-5.1c-.57 0-.96 0-1.25-.02a1.36 1.36 0 0 1-.52-.12 1.25 1.25 0 0 1-.54-.54c-.05-.1-.1-.23-.12-.52C5 14 5 13.62 5 13.05v-.3c1.04 0 1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3c.44.44 1.12.97 2.16.97s1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3z" fill-rule="evenodd"/><path d="M6.4 1.78c.03-.09.17-.09.2 0 .2.54.4.9.55 1.17.2.38.35.64.35 1.05a1 1 0 0 1-2 0c0-.41.14-.67.35-1.05.16-.28.35-.63.55-1.17zm7.2 0c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17-.2.38-.35.64-.35 1.05a1 1 0 1 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/></g></svg>',name:"cake_outline_20"}}s.d(t,{getIcon20CakeOutline:()=>i})},120862:(e,t,s)=>{"use strict";function i(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="education_outline_20__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="education_outline_20__education_outline_20"><path id="education_outline_20__Bounds" d="M0 0h20v20H0z"/><path d="M17.5 9.06 16 9.9V13c0 2.8-2.72 5-6 5s-6-2.2-6-5V9.89l-2.35-1.3a1.25 1.25 0 0 1 0-2.19L9.4 2.15c.37-.2.83-.2 1.2 0l7.75 4.25c.42.24.66.68.65 1.13v5.22a.75.75 0 1 1-1.5 0V9.06Zm-3 1.65-3.9 2.14c-.37.2-.83.2-1.2 0L5.5 10.7V13c0 1.9 1.98 3.5 4.5 3.5s4.5-1.6 4.5-3.5v-2.3ZM10 3.54 2.77 7.5 10 11.46l7.23-3.96L10 3.54Z" id="education_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"education_outline_20"}}s.d(t,{getIcon20EducationOutline:()=>i})},111871:(e,t,s)=>{"use strict";function i(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="home_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="home_outline_20__Icons-20/home_outline_20"><g id="home_outline_20__home_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M3 11h-.04l-.18-.01A2.04 2.04 0 0 1 1.67 7.4L8.2 1.8a2.75 2.75 0 0 1 3.58 0l6.54 5.6A2.04 2.04 0 0 1 17 11v4.25c0 1.24-1 2.25-2.25 2.25h-2.8a.95.95 0 0 1-.95-.95V13.5a1 1 0 0 0-2 0v3.05c0 .52-.43.95-.95.95h-2.8c-1.24 0-2.25-1-2.25-2.25V11Zm11.75 5c.41 0 .75-.34.75-.75v-4.9c0-.47.38-.85.85-.85H17a.54.54 0 0 0 .35-.96l-6.54-5.6c-.46-.4-1.16-.4-1.62 0l-6.54 5.6a.54.54 0 0 0-.06.77c.09.1.21.17.31.18l.1.01h.65c.47 0 .85.38.85.85v4.9c0 .41.34.75.75.75H7.5v-2.5a2.5 2.5 0 1 1 5 0V16h2.25Z" id="home_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"home_outline_20"}}s.d(t,{getIcon20HomeOutline:()=>i})},110583:(e,t,s)=>{"use strict";function i(){return{icon:'<svg width="56" height="56" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="archive_outline_56__Icons-56/archive_outline_56" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="archive_outline_56__archive_outline_56"><path d="M0 0h56v56H0z"/><path d="M44.5 18c.83 0 1.5.67 1.5 1.5v21a7.5 7.5 0 0 1-7.5 7.5h-21a7.5 7.5 0 0 1-7.5-7.5v-21c0-.83.67-1.5 1.5-1.5h33ZM43 21H13v19.5a4.5 4.5 0 0 0 4.5 4.5h21a4.5 4.5 0 0 0 4.5-4.5V21Zm-21.5 9h13a1.5 1.5 0 0 0 0-3h-13a1.5 1.5 0 0 0 0 3Zm-9-22h31a6.5 6.5 0 0 1 6.5 6.5v4a2.5 2.5 0 0 1-2.5 2.5h-39A2.5 2.5 0 0 1 6 18.5v-4A6.5 6.5 0 0 1 12.5 8ZM47 18v-3.5a3.5 3.5 0 0 0-3.5-3.5h-31A3.5 3.5 0 0 0 9 14.5V18h38Z" id="archive_outline_56__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"archive_outline_56"}}s.d(t,{getIcon56ArchiveOutline:()=>i})},5998:(e,t,s)=>{"use strict";s.d(t,{random:()=>n});var i=s(7144);const a=2147483647;function n(){try{if(window.crypto){let e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,i.intval)((0,i.rand)(0,a).toFixed(0))}},265772:(e,t,s)=>{"use strict";s.d(t,{screenfull:()=>a});const i=()=>/ipad|iphone|ipod/.test(window.navigator.userAgent.toLowerCase()),a=function(){const e=function(){let e,t;const s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];let a=0,n=s.length;const o={};for(;a<n;a++)if(e=s[a],e&&e[1]in document){for(a=0,t=e.length;a<t;a++)o[s[0][a]]=e[a];return o}return!!i()&&s[0].reduce(((e,t)=>({...e,[t]:t})),{})}(),t={element:document[e.fullscreenElement],request:function(t){if(i()){const e=t.querySelector("video");return void(e?.webkitEnterFullscreen&&(this.element=t,e.webkitEnterFullscreen()))}const s=e.requestFullscreen;t=t||document.documentElement,this.element=t,t[s]()},exit:function(t){if(t&&i()){const e=t.querySelector("video");e?.webkitExitFullscreen&&e.webkitExitFullscreen()}else document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){if(i()){const e=this.element?.querySelector("video");if(e)return e.webkitDisplayingFullscreen}return Boolean(document[e.fullscreenElement])}},enabled:{enumerable:!0,get:function(){return!!i()||Boolean(document[e.fullscreenEnabled])}}}),t)}()},315258:(e,t,s)=>{"use strict";s.d(t,{MarusiaMediaRecorder:()=>l});var i=s(634438);let a,n,o=window.AudioContext||window.webkitAudioContext;function r(e){let t=new Event("error");return t.data=new Error("Wrong state for "+e),t}class l{start(e){if("inactive"!==this.state)return this.em.dispatchEvent(r("start"));this.state="recording",a||(a=new o),this.clone=this.stream.clone(),this.input=a.createMediaStreamSource(this.clone),this.analyser=a.createAnalyser(),n||(n=a.createScriptProcessor(2048,1,1)),this.input.connect(this.analyser),this.analyser.connect(n),n.connect(a.destination);let t=this;t.encoder.postMessage(["init",a.sampleRate]),n.onaudioprocess=e=>{"recording"===t.state&&(this.onAudioProcessHandler(this.analyser),t.encoder.postMessage(["encode",e.inputBuffer.getChannelData(0)]))},this.input.connect(n),n.connect(a.destination),this.em.dispatchEvent(new Event("start")),e&&(this.slicing=setInterval((()=>{"recording"===t.state&&t.requestData()}),e))}stop(){return"inactive"===this.state?this.em.dispatchEvent(r("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach((e=>{e.stop()})),this.encoder.terminate(),clearInterval(this.slicing))}pause(){return"recording"!==this.state?this.em.dispatchEvent(r("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return"paused"!==this.state?this.em.dispatchEvent(r("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return"inactive"===this.state?this.em.dispatchEvent(r("requestData")):this.encoder.postMessage(["dump",a.sampleRate])}addEventListener(...e){this.em.addEventListener(...e)}removeEventListener(...e){this.em.removeEventListener(...e)}dispatchEvent(...e){this.em.dispatchEvent(...e)}constructor(e,t){this.stream=e,this.state="inactive",this.onAudioProcessHandler=t,this.em=document.createDocumentFragment(),this.encoder=function(e){let t=e.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),s=new Blob([t]);return new Worker(URL.createObjectURL(s))}(l.encoder);let s=this;this.encoder.addEventListener("message",(e=>{let t=new Event("dataavailable");t.data=new Blob([e.data],{type:s.mimeType}),s.em.dispatchEvent(t),"inactive"===s.state&&s.em.dispatchEvent(new Event("stop"))}))}}l.prototype.mimeType="audio/wav",l.isTypeSupported=e=>l.prototype.mimeType===e,l.notSupported=!navigator.mediaDevices||!o,l.encoder=i.default},223905:(e,t,s)=>{"use strict";function i(){let e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia,t=function(t){return new Promise((function(s,i){e?e.call(navigator,t,s,i):i(new Error("NotSupported"))}))},s=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){let t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(s){e(s.map((function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))};e&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=t),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=s)),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode)}s.d(t,{initFailBack:()=>i})},452256:(e,t,s)=>{"use strict";s.d(t,{Stickers:()=>n});var i=s(216147),a=s(705744);const n={getStickerUrl:function(e,t){let s=String(t);if(i.colorScheme.isDarkScheme()&&(s=s.replace(/b$/,"")+"b"),window.Emoji){const t=Emoji.stickersById?.[e]?.sticker[Emoji.STICKER_FIELD_IMAGES]?.[s];if(t)return t}const n={id:e,size:s};if((0,a.isMvk)()){if(window.stickers_cache){const t=window.stickers_cache.getStickerImage(e,s);if(t)return t}return window.store.stickers&&function(e,t){return e.replace(/%([^%]+?)%/g,(e=>(e=e.slice(1,-1),t.hasOwnProperty(e)?t[e]:"")))}(window.store.stickers.url_template,{id:e,size:s})}return window.getTemplate("stickers_sticker_url",n)},getStickerPopupLayer:function(e){return(0,a.isMvk)()&&window.stickers_cache?.getStickerPopupLayer(e)||[]}}},233859:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var i=s(406760),a=s(610989),n=s(52554);const o=()=>[{id:"user name",label:a.getLang("mail_community_templates_hint_name"),process:e=>(0,i.oCacheGet)(e,(0,n.getPeer)(e)).first_name},{id:"user surname",label:a.getLang("mail_community_templates_hint_last_name"),process(e){const t=(0,i.oCacheGet)(e,(0,n.getPeer)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:a.getLang("mail_community_templates_hint_your_name"),process:e=>(0,i.oCacheGet)(e,vk.id).first_name},{id:"admin surname",label:a.getLang("mail_community_templates_hint_your_last_name"),process(e){const t=(0,i.oCacheGet)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:a.getLang("mail_community_templates_hint_community"),process:e=>(0,i.oCacheGet)(e,e.get().id).name},{id:"greeting",label:a.getLang("mail_community_templates_hint_greeting"),process(e){const t=(new Date).getHours();let s;return s=t>=3&&t<12?a.getLang("mail_greeting_good_morning"):t>=12&&t<17?a.getLang("mail_greeting_good_afternoon"):t>=17&&t<=23?a.getLang("mail_greeting_good_evening"):a.getLang("mail_greeting_good_night"),s}}]},719451:(e,t,s)=>{"use strict";s.d(t,{handleEventChatUpdated:()=>u});var i=s(583790),a=s(693143),n=s(948350),o=s(368759),r=s(891911),l=s(533243);function c(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function d(e,t){let s=e?e.indexOf(t):-1;return-1!==s&&(e.splice(s,1),!0)}function u(e,t,s,u,m,p){let h=(0,a.getTab)(e,t);const f=u===vk.id;switch(s){case r.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case r.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:return s===r.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED?c(h.adminIds,u):d(h.adminIds,u),e.set((e=>(0,n.setCallAvailability)(t,e))).then((()=>{_(e,t,m),g(e,t,m,p)})),!0;case r.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:return h.data.flags=u,e.set((e=>(0,n.setCallAvailability)(t,e))).then((()=>{_(e,t,m),g(e,t,m,p)})),!0;case r.MAIL_CHAT_UPDATE_TYPE_PINNED:delete h.pinHideId,cur.imDb.update(o.PIN_HIDDEN_ID_OP,[h.peerId,void 0]);const v=h&&h.pinned&&(0,i.parserMessage)(h.pinned).messageId;return m.removeUnpinnedMessageEditable(e,v),!1;case r.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:return function(e,t,s){if((0,i.isTabLoaded)(s.get(),e)){let i=(0,a.getTab)(s,e);c(i.memberIds,t)&&i.membersCount++,-1===i.data.active.indexOf(t)&&i.data.active.push(t),t===vk.id&&(i.data.kicked=0,i.data.closed=0)}return s.set((s=>(0,n.loadChatMember)({[e]:[t]},s)))}(t,u,e).then((()=>{if(f&&e.get().peer===t)return e.set((e=>(0,n.getPinnedMessage)(t,e)))})).then((()=>g(e,t,m,p))).then((()=>{if(f&&e.get().peer===t)return Promise.all([e.set((e=>(0,n.getPeerActiveCallData)(t,e))),e.set((e=>(0,n.loadKeyboard)(t,e)))])})).then((()=>(e.get().peer===t&&h.callInProgress&&(m.updateBanner(e),m.updateHeader(e)),m.fixKeyboard()))).then((()=>{if(f)return e.set((e=>(0,n.syncMessagesEditableStatus)(e,t)))})).then((()=>(0,n.syncMessageReactStatus)(e,t))),!0;case r.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case r.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:return function(e,t,s,o,r){if((0,i.isTabLoaded)(o.get(),e)){let i=(0,a.getTab)(o,e);d(i.memberIds,t)&&i.membersCount--,i.data.active=i.data.active.filter((e=>e!==t)),t===vk.id&&(s?i.data.kicked=1:i.data.closed=1,o.set((t=>(0,n.removePeerActiveCallData)(e,t))))}return t===vk.id&&o.get().peer===e?(r.cancelEditing(),o.set((t=>(0,n.unpinMessageOptimistic)(e,t)))):Promise.resolve()}(t,u,s===r.MAIL_CHAT_UPDATE_TYPE_USER_KICKED,e,m).then((()=>g(e,t,m,p))).then((()=>(0,n.syncMessageReactStatus)(e,t))).then((()=>{if(f)return e.set((e=>(0,n.syncMessagesEditableStatus)(e,t)))})),e.get().id!==u&&((0,a.getKeyboard)(e,t)||{}).author_id!==u||e.set((e=>(0,n.deleteKeyboard)(t,e))).then((()=>m.fixKeyboard())),!0;case r.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:return e.set((e=>(0,n.loadBanner)(t,e))).then((()=>m.updateBanner(e))),!0;case r.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:case r.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:return!0;case r.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:const b=u?e=>(0,n.getPeerActiveCallData)(t,e):e=>(0,n.removePeerActiveCallData)(t,e);return e.set(b).then((()=>{e.get().peer===t&&(m.updateBanner(e),m.updateHeader(e)),p.updateDialog(t,e),_(e,t,m)})),!0;case r.MAIL_CHAT_UPDATE_TYPE_IS_NEW_CHANGED:return e.set((e=>(0,l.setConvoIsNew)(t,u,e))),!0;default:return!1}}function _(e,t,s){e.get().peer===t&&((0,n.setActions)(e.get()),s.updateActions(e))}function g(e,t,s,i){e.get().peer===t&&((0,n.setActions)(e.get()),s.updateChat(e,t),i.updateDialog(t,e))}},551465:(e,t,s)=>{"use strict";s.d(t,{mount:()=>k});var i=s(485413),a=s(645024),n=s(879007),o=s(452314),r=s(248782),l=s(583790),c=s(948350),d=s(718898),u=s(800855);const _=68,g=32,m=300,p=20,h=68,f=10,v=2e3,b=100;function y(e,t,s,i){const a=e instanceof Array?e:(0,o.geByClass)("_im_bar_date",e),r=t.contHeight();d.default.onNewMessagesChunk();let l=a.reduce(((e,t)=>(e[(0,o.domData)(t,"date")]=[t.offsetTop+f,r,t],e)),{});const c=!s&&i.barMap?i.barMap:{};return i.barMap=(0,n.extend)(c,l),i.barMapKeys=Object.keys(i.barMap).sort(),Promise.resolve(i)}function w(e,t){return t.barMapKeys.forEach((s=>{t.barMap[s][0]-=e})),Promise.resolve(t)}function E(e,t,s,i,a){let n=e.get().barMap[t];const o=(0,l.isClassicInterface)(a)?h:p;return s-(n[0]+s-n[1])+i-o}function C(e,t,s,i){return i.barTransition=i.barMap[t][2],s>0?((0,o.addClass)(i.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,o.addClass)(e,"im-page--date-bar-transition-inverse")):s<0&&((0,o.removeClass)(i.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,o.removeClass)(e,"im-page--date-bar-transition-inverse")),(0,o.addClass)(i.barMap[t][2],"im-page--date-bar-transition"),(0,o.addClass)(e,"im-page--date-bar-transition"),Promise.resolve(i)}function S(e,t){return t.barTransition&&((0,o.removeClass)(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),(0,o.removeClass)(e,"im-page--date-bar-transition"),Promise.resolve(t)}function T(e,t,s,i,a){const n=e.get();let r,l;const c=s-t;n.barMapKeys.forEach((t=>{const n=E(e,t,s,i,a);if(n>=c){const o=r?E(e,r,s,i,a):s;r=o>n?t:r}else if(n<c){const o=l?E(e,l,s,i,a):0;l=n>o?t:l}}));let d={};return[[l,"prev"],[r,"cur"]].forEach((([t,n])=>{t&&(d[n+"Bar"]=function(e,t){let s=e.get().barMap[t][2];return{text:s.textContent,date:(0,o.domData)(s,"date")}}(e,t),d[n+"Left"]=E(e,t,s,i,a)-c)})),d}function I(e,t,s,i,r){const d=e.get(),m=(0,c.isEverythingLoaded)(d),p=t.get(),h=r.scrollTop(),f=p.lastTop?p.lastTop-h:0;p.lastTop=h;const v=(0,u.isPinnedMessageVisibleInTab)(d,d.peer)?(0,l.getPinnedMessageHeight)(e):0,b=(0,c.isSearchingInplace)(d.peer,d)&&d.tabs[d.peer]&&d.tabs[d.peer].top_banner?50:0,y=((0,l.isClassicInterface)(e)?_+v+b:0)-g/2,w=r.contHeight();let{prevBar:E,curBar:I,prevLeft:k}=T(t,h,w,y,e),M="translateY(0px)",P=!1,A=!1,L=!1;I||m||(I=function(e){let t=(0,o.geByClass1)("_im_mess",e),s=(0,o.domData)(t,"ts");return t&&s?{text:(0,a.getShortDate)((0,n.intval)(s),!1,!0,a.getLang("months_of","raw")),date:s}:null}(i)),I?P=I:A=!0,E&&I&&k>-g&&k<0&&(L=!0,A=!1,P=I,M=`translateY(${-g-k}px)`),P&&function(e,t){(0,o.domData)(e,"ts")!==t.date&&(e.innerHTML=t.text,(0,o.domData)(e,"ts",t.date),e.style.visibility="visible")}(s,P),L?t.set(C.bind(null,s,E.date,f)):t.set(S.bind(null,s)),M&&(s.style.transform=M),(0,o.toggleClass)(s,"im-page--top-date-bar_no-b",A)}function k(e,t){let s=(0,o.geByClass1)("_im_top_date_bar",t);const a={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},n=(0,i.default)(a);let l=null,c=null,d=null,u=(0,r.debounce)((e=>{const s=n.get();Object.keys(s).length&&!s.isDisabled&&n.set(y.bind(null,t,e,!1))}),500);return{reset(i){n.get().isDisabled||n.set(y.bind(null,t,i,!0)).then(I(e,n,s,t,i))},disable(){n.setState({...a,isDisabled:!0})},enable(){n.setState({isDisabled:!1})},heightIncreased(e,t){n.get().isDisabled||(u(t),n.set(w.bind(null,e)))},parseMore(i,a){n.get().isDisabled||n.set(y.bind(null,i,a,!1)).then((()=>{I(e,n,s,t,a)}))},toggle(e){n.get().isDisabled&&e||s.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){n.get().isDisabled||(c=Date.now(),d||((0,o.addClass)(t,"im-page--top-date-bar_visible"),d=setInterval((function(){Date.now()-c>v&&((0,o.removeClass)(t,"im-page--top-date-bar_visible"),clearInterval(d),d=null)}),b)))},update(i){n.get().isDisabled||(l&&(clearTimeout(l),l=null),l=setTimeout((function(){I(e,n,s,t,i)}),m),I(e,n,s,t,i))},unmount(){l&&(clearTimeout(l),l=null),d&&(clearInterval(d),d=null),n.unmount()}}}},525057:(e,t,s)=>{"use strict";s.d(t,{mount:()=>pe});var i=s(474848),a=s(948350),n=s(7144),o=s(723561),r=s(357889),l=s(317412),c=s(879007),d=s(850101),u=s(452314),_=s(693143),g=(s(296540),s(440961)),m=s(241750),p=s(583790),h=s(322917),f=s(365485),v=s(485413),b=s(958145),y=s(507035),w=s(20025),E=s(810903),C=s(610989),S=s(803898),T=s(133836),I=s(885658),k=s(258643),M=s(603723);const P="_im_create_cancel",A="_im_create_list",L="_im_dialog",R="_im_dialogs_creation_name",x="_im_create_select",D="_im_create_avatar",O="_im_create_remove_avatar",B="_im_confirm_creation",N="_im_cancel_creation",F="_im_avatar_img",U=["im-creation--item_hovered"],H="olist_item_wrap_on",j="ui_search_reset",V="_im_creation_settings",q=33554432,G=100;let K=q;function $(e){!function(e){const t=e.querySelector("._im_creation_settings_modal_wrap"),s=W.bind(null,t);g.render((0,i.jsx)(M.PresetOptionsModal,{flags:K,afterSave:z.bind(null,t),onSave:Y,onCancel:s}),t)}(e)}function W(e){e&&g.unmountComponentAtNode(e)}function Y(e){return K=e,Promise.resolve()}function z(e){W(e)}function Z(e){return(0,E.showTooltip)(e,{text:C.getLang("mail_chat_creation_settings_icon_tooltip"),black:1,center:!0,zIndex:1e3,shift:[0,10]})}function Q(e,t,s,i,n,r){(0,a.toggleConversation)(!1),(0,u.removeClass)(t,"im-create_shown"),(0,u.removeClass)(t,"im-create_photo-attached"),setTimeout(J.bind(null,t,!1),100),ae(r).map((e=>(0,u.geByClass1)("_im_dialog"+e))).forEach((e=>{(0,u.removeClass)(e,H)})),s().createCanceled(e),n.resetSelection(),"add_member"===e.get().creationType&&e.set(a.setCreationType.bind(null,"chat",[])),e.set(a.presetAvatar.bind(null,!1));let l=(0,u.geByClass1)(F,t);ee(e,r,t),uiSearch.reset((0,u.geByClass1)(R,t)),uiSearch.reset((0,u.geByClass1)(x,t)),l&&l.parentNode.removeChild(l),ee(e,r,t),(0,o.cancelStackFilter)("im_search");let c=0===e.get().peer?"search":"default";e.get().longpoll.push([(0,b.transitionEvent)(c)]),(0,u.attr)(t,"aria-hidden","true")}function X(e,t,s){return t&&(s.current_create_peer_ids={},s.current_create_peers=[]),s.current_create_peer_ids||(s.current_create_peer_ids={}),s.current_create_peers||(s.current_create_peers=[]),e.forEach((e=>{e.then((e=>{e=e.filter((e=>!s.current_create_peer_ids[e.peerId])),s.current_create_peer_ids=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),s.current_create_peer_ids),s.current_create_peers=s.current_create_peers.concat(e)}))})),Promise.resolve(s)}function J(e,t){(0,u.toggleClass)(e,"im-create_material",t)}function ee(e,t,s){const i=(0,u.geByClass1)(B,s),a=t.get().selection.length,n="add_member"===e.get().creationType,o=uiSearch.getFieldEl((0,u.geByClass1)(R,s)),r=a>0,l=(o?o.value.trim():"").length>0,c=!r&&(n||!l),d=n?C.getLang("mail_add_to_chat"):l||a>1?C.getLang("mail_im_create_chat"):C.getLang("mail_to_dialog");k.FlatButton.setLabel(i,d),k.FlatButton.setDisabled(i,c)}function te(e,t,s,i,a,o,r){if(!r)return;let l,d=(0,c.intval)((0,u.domData)(r,"list-id")),_=ae(o),g=(0,n.clean)((0,c.trim)(r.textContent)),m=(0,u.geByClass1)(x,t),p=(0,u.getSize)(m)[1];(0,c.inArray)(d,_)?(l=i.removeSelection(d,g),(0,u.removeClass)(r,H)):(l=i.addSelection(d,g),(0,u.addClass)(r,H)),l.then((()=>{let e=p-(0,u.getSize)(m)[1],t=a.scrollTop();a.scrollTop(t-e)})),ee(e,o,t);let h=(0,u.geByClass1)(x,t);uiSearch.reset(h)}function se(e,t){let s=ae(e),i=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],a=[];return t.online&&a.push("online"),mobPlatforms[t.online]&&a.push("mobile"),(0,c.inArray)(t.peerId,s)&&i.push(H),(0,c.getTemplate)("im_owner_item",{owner_id:t.peerId,cls:" "+i.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:a.join(" ")})}function ie(e){return(0,_.getSearchText)(e)||!1}function ae(e){return e.get().selection.map((e=>e.id))}function ne(e,t,s){return e.then((e=>e.filter((e=>e.is_friend&&!(0,c.inArray)(e.peerId,s.get().creationFilter)))))}function oe(e,t,s,i,n){let o,r,l=(0,u.geByClass1)(x,e),c=(0,a.searchLocalHints)(i,t.get()),d=s.hoverFirstElement.bind(s,U,_e(t));t.get().creation_shown_all=!1,s.reset(),s.pipe(ne(c,0,t),i),s.toTop(),i?(r=(0,a.searchTopConv)(i,t.get()),o=(0,a.searchHintsIndex)(i,[],"friends",t.get()),s.pipe(ne(o,0,t),i).then(d),s.pipe(ne(r,0,t),i).then(d)):(o=Promise.resolve([]),r=Promise.resolve([])),t.set(X.bind(null,[c,r,o],!0)),uiSearch.showProgress(l),Promise.all([c,o,r]).then((()=>uiSearch.hideProgress(l)))}function re(e,t,s,i){let o=2e9+Math.round((0,n.rand)(1e6,2e6));cur.recieveCropResult=s=>{cur.recieveCropResult=!1,(0,d.curBox)()&&(0,d.curBox)().hide(),e.set(a.presetAvatar.bind(null,s)),(0,a.getOwnerPhoto)(s,o).then((e=>{(0,u.geByClass1)(D,t).appendChild((0,u.ce)("img",{className:`im-chat-placeholder--img ${F}`,src:e}))})),(0,u.addClass)(t,"im-create_photo-attached")},Page.ownerPhoto(o)}function le(e,t){(0,u.geByClass1)(D,t).innerHTML="",e.set(a.presetAvatar.bind(null,!1)),(0,u.removeClass)(t,"im-create_photo-attached")}function ce(e,t,s,i,a,n){ae(t).map((e=>(0,u.geByClass1)("_im_dialog"+e))).forEach((e=>(0,u.removeClass)(e,H))),t.reset(),oe(s,e,i,!1,ae(t)),a.resetSelection(),Q(e,s,n,0,a,t)}function de(e,t,s,i,n,o,l){const c=ae(t),d=e.get(),g=(0,u.geByClass1)(B,s),m=uiSearch.getFieldEl((0,u.geByClass1)(R,s)).value,p="add_member"===e.get().creationType,h=!p&&(m.length||c.length>1),f=(0,u.geByClass1)("_im_creation_show_history_input",s).checked;if(p)return e.set(a.addNewMember.bind(null,d.peer,c,f)).catch((e=>(0,w.showFastBox)(C.getLang("global_error"),e))),Q(e,s,o,0,n,t);if(k.FlatButton.lock(g),!h)return v(c[0]);function v(a){K=q,ce(e,t,s,i,n,o),function(e,t,s,i,a,n){Q(e,t,s,0,a,n),e.get().longpoll.push([(0,b.changePeer)(i,!1,!1,!1,"create_conversation")])}(e,s,o,a,n,t),k.FlatButton.unlock(g),(0,_.isSearching)(e)?o().cancelSearch(e):o().restoreDialogs(e),(0,I.collectChatCreateStats)(a,"create_chat__create_new")}e.set((e=>(0,T.createChatAction)(e,d.next_chat_avatar,c,m,K))).then((()=>v(d.next_peer))).catch((e=>{k.FlatButton.unlock(g),(0,r.topMsg)(C.getLang("global_unknown_error"),2,"#FFB4A3")}))}function ue(e,t){return(0,E.showTooltip)(e,{text:C.getLang("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function _e(e,t){const s=t&&t.get().selection.length;return{top:-1,bottom:(0,p.isClassicInterface)(e)?s>0?69:0:-1}}function ge(e,t,s){ee(e,t,s)}function me(e,t,s,i,a,n,r,l){return{show(t,n=[]){t.setState({shown:!0}),J(e,!0),(0,o.cancelStackPush)("im_create",r),(0,u.addClass)(e,"im-create_shown");const l=i.get().selection.reduce(((e,t)=>(e[t.id]=!0,e)),{});n&&n.forEach((t=>{if(!l[t[0]]){const s=e.querySelector(`._im_dialog${t[0]}`);a.addSelection(t[0],t[1]),s&&!s.classList.contains(H)&&s.classList.add(H)}})),function(e,t,s,i){(0,u.toggleClass)(e,"im-create_chat","chat"===i.get().creationType),(0,u.toggleClass)(e,"im-create_invite","add_member"===i.get().creationType);let a="chat"===i.get().creationType?C.getLang("mail_im_group_dialog"):C.getLang("mail_im_friends_tab"),n=(0,u.geByClass1)("_im_create_title",e);(0,u.val)(n,a),k.FlatButton.setLabel((0,u.geByClass1)(B,e),"add_member"===i.get().creationType?C.getLang("mail_add_to_chat"):C.getLang("mail_im_create_chat")),oe(e,i,t,!1,s.get().selection.map((e=>e.id)))}(e,s,i,t),setTimeout((()=>{t.get().longpoll.push([(0,b.transitionEvent)("create")]),(0,u.attr)(e,"aria-hidden","false"),a.focus()}),1)},focusSearch(e){a.focus()},confirmCreate(e){l()},hide(s){s.get().shown=!1,Q(s,e,t,0,a,i)},scroll(e){s.scrollPage(e,!0)},updateScroll(){s.updateScroll()},selectElement(t){te(t,e,0,a,s,i,s.getHoveredElement())},hoverPrevElement(e){s.hoverPrevElement(U,null,_e(e,i))},hoverNextElement(e){s.hoverNextElement(U,null,_e(e,i))},unmount(){(0,f.destroyModule)(n),s.unmount(),a.unmount(),(0,o.cancelStackFilter)("im_create"),cur.recieveCropResult=void 0}}}function pe(e,t,s){let i=(0,v.default)({selection:[]}),n=(0,u.geByClass1)(A,e),o=(0,u.geByClass1)(x,e);const r=(0,S.debouncedPromise)((function(s){return function(e,t,s,i){const a=i.get(),n=ie(a);a.selection.map((e=>e.id)),s.unhoverElements(U),e.get().creationQuery=n,oe(t,e,s,n)}(t,e,_,s)}),300);let d=(0,h.mount)(o,i,(()=>({selectionDeleted(s,i){ee(t,s,e),(0,u.removeClass)((0,u.geByClass1)("_im_dialog"+i),H)},onChange:e=>r(e).catch((e=>{if("debounce"!==e)throw e}))}))),_=(0,m.mount)(n,(0,v.default)({offset:0,limit:G,elements:[],elCls:L}),(()=>({idFn:e=>(0,c.intval)(e.peerId),hoverableFn:e=>(0,u.hasClass)(e,"_im_dialog"),renderFn:se.bind(null,i),more(e,s){let n;return t.get().shown?(t.get().creation_shown_all||!1!==ie(i)?n=Promise.resolve([]):(t.get().creation_shown_all=!0,n=(0,a.searchTopConv)(ie(i),t.get())),t.set(X.bind(null,[n],!1)),ne(n,ie(i),t)):Promise.resolve(!1)},onClick(s,a){(0,l.checkEvent)(s)||(te(t,e,0,d,_,i,a),(0,l.cancelEvent)(s))}})));t.get().creationQuery=!1,t.get().creationType="chat";let g=Q.bind(null,t,e,s,"cross",d,i),p=re.bind(null,t,e),b=le.bind(null,t,e),w=ce.bind(null,t,i,e,_,d,s),E=de.bind(null,t,i,e,_,d,s),C=ge.bind(null,t,i,e),T=$.bind(null,e),I=(0,u.geByClass1)(P,e),k=(0,u.geByClass1)(R,e),M=(0,u.geByClass1)(V,e),F=k.querySelector("."+j);const q=(0,f.createModule)({handlers:(t,s)=>{t(I,"click",g),t(I,"mouseover",ue.bind(null,I)),t((0,u.geByClass1)(D,e),"click",p),t((0,u.geByClass1)(O,e),"click",b),t((0,u.geByClass1)(N,e),"click",w),t(k,"change",C),t(k,"input",C),t(k,"paste",C),t(F,"click",C),t((0,u.geByClass1)(B,e),"click",E),t(M,"click",T),t(M,"mouseenter",Z.bind(null,M)),t(e,"mouseover",(0,y.throttle)(_.unhoverElements.bind(_,U),100))}});return me(e,s,_,i,d,q,g,E)}},486923:(e,t,s)=>{"use strict";s.d(t,{mount:()=>bt});var i=s(948350),a=s(723561),n=s(7144),o=s(645024),r=s(850101),l=s(879007),c=s(317412),d=s(583790),u=s(693143),_=s(510575),g=s(659557),m=s(629596),p=s(945154),h=s(485413),f=s(507035),v=s(241750),b=s(891911),y=s(365485),w=s(77294),E=s(406760),C=s(531868),S=s(810903),T=s(414299),I=s(958145),k=s(699615),M=s(336476),P=s(177157),A=s(714209),L=s(474831),R=s(52554),x=s(885658),D=s(533243),O=s(822317),B=s(429061),N=s(96526),F=s(476726),U=s(110583),H=s(885635),j=s(349333),V=s(911575),q=s(380181),G=s(505821),K=s(452314),$=s(660546),W=s(8520),Y=s(465094),z=s(143172),Z=s(388078);const Q=64,X="_im_dialog",J="_im_peer_target",ee="_im_dialog_star",te="_im_dialog_actions",se="_im_dialog_close",ie="_im_dialog_actions_item",ae="nim-dialog_inline-menu_visible",ne="_im_dialog_daction",oe=["_im_dialog_selected","nim-dialog_selected"],re=["_im_dialog_hovered","nim-dialog_hovered"],le="_im_dialog_peer_tags",ce="_im_dialog_name_w",de="_im_peer_tags_extra",ue="_im_dialog_peer_tag",_e="ConvoRecommendList",ge="_convoRecommendUser",me="_convoRecommendUserRemove",pe="_convoRecommendAction",he=`${_e}--hidden`,fe=`${_e}--fadeIn`,ve=`${_e}--fadeOut`,be="_im_dialog_folder_button_hide",ye="im-page--dialogs-folder-button_hidden",we="_im_archive_notice",Ee="_im_archive_notice_close",Ce="_im_archive_notice_settings",Se="_im_new_ui_notice",Te="_im_new_ui_notice_close",Ie="archive_folder_hidden",ke="business_notify_folder_hidden",Me="_im_dialog_folder_actions",Pe="_im_dialog_folder_actions_item",Ae="_im_dialog_folder_back",Le=340,Re=16,xe=6,De=46;function Oe(e,t,s){(0,K.removeClass)(t.parentNode,"im-page--dialogs_with-mess");let i=s.getCurrentElements().filter((e=>e.message));s.toTop(),s.reset(),(0,w.statlogsProbValueEvent)(.01,"im_search_stat",1,"search_messages_only"),i.length>0?(i=[{type:"sep_messages"}].concat(i),e.setState({searchOnlyMessages:!0})):i=[st()],s.pipeReplace(Promise.resolve(i))}function Be(e){return(0,K.hasClass)(e,"_im_search")}function Ne(e){if((0,u.isSearching)(e)&&e.get().searchAllLoaded||(0,u.isRecentSearchesActive)(e))return Promise.resolve([]);if(e.get().dialog_search_going||(0,d.isClassicInterface)(e)&&0!==e.get().peer)return Promise.resolve(!1);if((0,u.isSearching)(e))return(0,i.searchMessages)((0,u.getSearchText)(e),e.get()).then((([e,t])=>tt(t,e)));const t=e.get().active_tab,s=e.get().dialog_tabs_all;return![p.FOLDER_MESSAGE_REQUEST,p.FOLDER_PEER_TAGS,O.FOLDER_BUSINESS_NOTIFY,O.FOLDER_ARCHIVE].includes(t)&&s[p.FOLDER_ALL]&&!(0,d.isReversedDialogs)(e)||s[t]?Promise.resolve(ft(e)):e.set(i.loadDialogs).then(ft)}function Fe(e,t,s,a,n,o){if(n?.target?.closest?.(`.${te}`))return;const r=parseInt((0,K.domData)(o,"peer"),10),l=(0,u.getTab)(s,r),_=(0,K.hasClass)(o,"_im_sugg_"+r),g=o.classList.contains(`${_e}__button`);if(!l&&!_&&!g)return;const m=(0,K.gpeByClass)(J,n.target)&&(0,c.checkEvent)(n),p=(0,d.isCommunityInterface)(s)&&(0,K.gpeByClass)(le,n.target),h=!!n.target?.closest("."+me);if(m||p||h)return;const f=s.get(),v=Be(o),b=parseInt((0,K.domData)(o,"msgid"),10);if(l&&(0,u.tabIsMessageRequestToChat)(l))return e().showChatInvitationBox(s,r),(0,c.cancelEvent)(n);let y=`list_${f.active_tab}`;if((0,u.isSearching)(s)&&(y="conversations_search"),(0,u.isRecentSearchesActive)(s)&&(y="recent_searches"),_&&(y="popular_suggestions"),g&&(y="list_all_suggestions"),v&&(y="message_search"),l&&(0,c.checkEvent)(n))return window.open(function(e,t,s,i=!1){const a=(0,d.getBaseLink)(e),n=()=>`${a}?sel=${(0,d.convertPeerToUrl)(t.peerId)}${i&&s?"&msgid="+s:""}`;if(i)return n();if(Z.Ranges.isUserIdTransitional(t.peerId)||Z.Ranges.isGroupId(t.peerId))return(0,d.isClassicInterface)(e)?n():t.href;return n()}(s,l,b,v));if(a.saveScroll("list"),e().deselectAllMessages(s),v&&f.msgid!==b)f.longpoll.push([(0,I.changePeer)(r,b,!1,!1,y)]);else if(r!==f.peer){f.longpoll.push([(0,I.changePeer)(r,!1,!0,!0,y)]);const e=(0,u.isSearching)(s);e&&!(0,K.hasClass)(o,"_dont_add_recent")&&(0,i.saveRecentSearchPeer)(r,cur.imDb),e&&l&&!(0,d.isClassicInterface)(s)&&setTimeout((()=>{const e=l.message?l.message.messageId:l.peerId;a.scrollToElement(e.toString(),!0,0,"center")}),100)}else r===f.peer&&e().goToHistoryEnd();(0,M.isMarusiaPeer)(r)&&(z.marusiaStats.logChatOpen(Y.navigationStat.getModule()),ajax.post("al_marusia.php",{act:"send_event",event:"chatopen"})),(0,c.cancelEvent)(n)}function Ue(e,t,s,i){let a;const n="string"==typeof s.photo&&""!==s.photo,o=Z.Ranges.isContactId(t),r=s.tab||s.name,c=o?(0,d.prepareContactName)(r):r;if(Z.Ranges.isChatOrChannelPeer(t)&&!n)a=(0,d.renderPhotosFromTab)(e,s,i);else{if(o&&!n){const t=(0,d.getUserInitials)(r),n=(0,u.isSearching)(e)&&!s.message?34:i?50:46;a=(0,l.getTemplate)("sImContactAvatar",{name:t,size:n,classes:"nim-peer--contact-avatar"})}else a=(0,P.isDialogWithYourself)(e.get().id,t)?`<img src="${O.FAVORITES_ICON_URL}" alt="">`:s.is_nft_photo?s.photo.trim():`<img src="${s.photo}" alt="">`;i&&!s.is_nft_photo&&(a=(0,l.getTemplate)("im_dialogs_link_img",{href:s.href||s.link,photo:a}))}return{photo:a,userLink:`<span class="_im_dialog_link">${c}</span>`}}function He(e,t,s,i){return s?"":i?(0,l.getTemplate)("im_img_prebody",{photo:t}):e}function je(e,t,s){if(!(s&b.FLAG_OUTBOUND))return!1;if((0,d.isSelfMessage)(t.peerId,e.get().gid))return!1;if(Z.Ranges.isChatOrChannelPeer(t.peerId)&&t.data&&t.data.closed)return!1;if(t.unread)return!1;if((0,F.partConfigEnabled)("me_web_read_by_cmid")){const e=Ye(t);return!!e.local||e.chat_local_id>t.out_up_to_cmid}return!!t.lastmsg&&t.lastmsg>t.out_up_to}function Ve(e){let t=Ye(e);return!!(e.unread>0&&t)||!!(0,u.isTabMarkedUnread)(e)}function qe(e){return(0,C.isUnreadWithExpiring)(e)&&!(0,C.isUnreadWithMentions)(e)}function Ge(e,t,s=null,i={}){const a=s||Ye(t),{photo:r,userLink:c}=Ue(e,t.peerId,t,(0,d.isClassicInterface)(e));if(!a)return function(e,t,s,i,a={}){let n=[];(0,d.isClassicInterface)(i)&&n.push("nim-dialog_classic"),(0,u.isRecentSearchesActive)(i)&&n.push("nim-dialog_recent"),n.push("nim-dialog_empty"),a.search&&n.push("_im_search");const r=(0,l.getTemplate)("im_drow_close_button",{peer_id:e.peerId}),c=(0,P.isDialogWithYourself)(i.get().id,e.peerId),_=e.is_nft_photo&&!c;return(0,l.getTemplate)(`im_drow${_?"_nft":""}${(0,d.isClassicInterface)(i)?"_classic":""}`,{peer:e.peerId,msg_id:"",photo:t,user_link:s,date:"",body:"",mail_im_to_multidialog:o.getLang("mail_im_to_multidialog"),mail_casper_chat_label:o.getLang("mail_casper_chat_label"),mail_reactions_badge_label:o.getLang("mail_reactions_badge_label"),mail_mention_badge_label:o.getLang("mail_mention_badge_label"),mail_expiring_message_badge_label:o.getLang("mail_expiring_message_badge_label"),unread:"",more:n.join(" "),is_star:"",unread_message_string:"",is_online:(0,f.onlinePlatformClass)(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==i.get().peer?"nim-dialog_selected _im_dialog_selected":"",actions:r})}(t,r,c,e,i);const{flags:g}=a,m=(0,d.isFvkcomgroup)(e,t.peerId),p=(0,C.tabIsMessageRequest)(t),h=(0,u.tabIsMessageRequestToChat)(t),v=(0,u.isCasperChat)(e,t.peerId),y=We(t,e,s),w=(0,u.isCommunityChat)(e,t.peerId),E=t.major_sort_id;let S=[];i.search&&S.push("_im_search","nim-dialog_search"),(0,l.inArray)(t.peerId,e.get().mutedPeers)&&S.push("nim-dialog_muted"),t.verified&&S.push("nim-dialog_verified"),!t.verified&&t.verified_by_other_services&&S.push("nim-dialog_verified_by_other_services"),t.isDonutChat&&S.push("nim-dialog_donut"),v&&S.push("nim-dialog_casper"),(0,u.isRecentSearchesActive)(e)&&S.push("nim-dialog_recent"),(0,_.isMessageEmpty)(a)&&!v&&S.push("nim-dialog_empty"),(0,d.isClassicInterface)(e)&&S.push("nim-dialog_classic"),t.folders&b.FOLDER_IMPORTANT&&S.push("nim-dialog_starred"),!i.search&&(0,d.isUnrespond)(e,t.peerId,t)&&S.push("nim-dialog_unrespond"),(m||w)&&e.get().gid&&S.push("nim-dialog_deny-remove"),(0,C.isUnreadWithMentions)(t)&&S.push("nim-dialog_unread-mentions"),(0,C.hasUnreadReactionsBadge)(e,t.peerId)&&S.push("nim-dialog_unread-reactions"),qe(t)&&S.push("nim-dialog_unread-expiring"),t.callInProgress&&S.push("nim-dialog_active-call"),t.callInProgress&&t.callInProgress.participants.count<1&&S.push("nim-dialog_active-call-empty"),(0,k.isPinnedSortId)(E)&&S.push("nim-dialog_pinned");const T=(0,u.tabIsMessageRequestToChat)(t)?t.mr&&t.mr.request_date:a.date,I=e.get().timeshift,M=T?(0,o.getShortDateOrTime)(T,I,!0,o.getLang("months_sm_of","raw")):"",A=!je(e,t,g)||h||(0,u.isSearching)(e)?"":"nim-dialog_unread-out",L=t.unread>0?o.getLang("mail_im_new_messages",t.unread):"",R=Z.Ranges.isContactId(t.peerId)?(0,d.prepareContactName)(t.tab):t.tab,x=(0,d.isCommunityInterface)(e)||p?"im_drow_close_button":"im_drow_actions_menu",D=(0,l.getTemplate)(x,{peer_id:t.peerId}),O=(0,P.isDialogWithYourself)(e.get().id,t.peerId),B=t.is_nft_photo&&!O;return(0,l.getTemplate)(`im_drow${B?"_nft":""}${(0,d.isClassicInterface)(e)?"_classic":""}`,{peer:t.peerId,msg_id:a.messageId||"",photo:r,user_link:c,date:M,body:y,mail_im_to_multidialog:o.getLang("mail_im_to_multidialog"),mail_casper_chat_label:o.getLang("mail_casper_chat_label"),mail_reactions_badge_label:o.getLang("mail_reactions_badge_label"),mail_mention_badge_label:o.getLang("mail_mention_badge_label"),mail_expiring_message_badge_label:o.getLang("mail_expiring_message_badge_label"),unread_message_string:L,tab_name:(0,n.stripHTML)(R),unread:(0,d.simplifyCounter)(t.unread),more:S.join(" "),is_online:(0,f.onlinePlatformClass)(t.online),is_unread:Ve(t)?"nim-dialog_unread":"",is_unread_out:A,is_selected:i.noselect||h||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected",actions:D,title:(0,F.partConfigEnabled)("mail_dialog_preview_title")?y.replace(/\<[^>]*\>/g,""):""})}function Ke(e,t,s,i,a){if(t.deletedDialog)return;if((0,K.hasClass)(e,"nim-conversation-search-row"))return void $e(e,t,s);const n=s.get(),r=Ye(t),c=r.flags,g=We(t,s),{photo:m,userLink:p}=Ue(s,t.peerId,t,(0,d.isClassicInterface)(s)),h=s.get().timeshift,v=r.date?(0,o.getShortDateOrTime)(r.date,h,!0,o.getLang("months_sm_of","raw")):"";if(nt(e,t),(0,F.partConfigEnabled)("mail_dialog_preview_title")){const i=We(t,s,null,!0).replace(/<[^>]*>/g,"");(0,K.attr)((0,K.geByClass1)("_im_dialog_title",e),"title",(0,W.decodeHTMLEntities)(i))}(0,K.val)((0,K.geByClass1)("_dialog_body",e),g),(0,K.val)((0,K.geByClass1)("_im_dialog_date",e),v),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",e),(0,d.simplifyCounter)(t.unread));const y=(0,K.geByClass1)("_im_dialog_link",e);y&&(0,K.val)(y.parentNode,p);let w=(0,K.geByClass1)("_im_dialog_photo",e);w&&w.innerHTML!==m&&(0,K.val)(w,m),n.is_peer_profile_enabled&&(n.peer||ut(e,s));const E=(0,u.isCasperChat)(s,t.peerId);(0,K.toggleClass)(e,"nim-dialog_verified",!!t.verified),(0,K.toggleClass)(e,"nim-dialog_verified_by_other_services",!t.verified&&!!t.verified_by_other_services),(0,K.toggleClass)(e,"nim-dialog_casper",E),(0,K.toggleClass)(e,"nim-dialog_muted",(0,l.inArray)(t.peerId,s.get().mutedPeers)),(0,K.toggleClass)(e,"nim-dialog_unrespond",(0,d.isUnrespond)(s,t.peerId,t)),(0,K.toggleClass)(e,"nim-dialog_classic",(0,d.isClassicInterface)(s)),(0,K.toggleClass)(e,"nim-dialog_unread",Ve(t)),(0,K.toggleClass)(e,"nim-dialog_unread-mentions",(0,C.isUnreadWithMentions)(t)),(0,K.toggleClass)(e,"nim-dialog_unread-reactions",(0,C.hasUnreadReactionsBadge)(s,t.peerId)),(0,K.toggleClass)(e,"nim-dialog_unread-expiring",qe(t)),(0,K.toggleClass)(e,"nim-dialog_active-call",!!t.callInProgress),(0,K.toggleClass)(e,"nim-dialog_active-call-empty",!!t.callInProgress&&t.callInProgress.participants.count<1),(0,K.toggleClass)(e,"nim-dialog_pinned",(0,k.isPinnedSortId)(t.major_sort_id)),(0,K.toggleClass)(e,"nim-dialog_deny-remove",s.get().gid>0&&((0,d.isFvkcomgroup)(s,t.peerId)||(0,u.isCommunityChat)(s,t.peerId))),(0,K.removeClass)(e,"nim-dialog_failed"),(0,K.removeClass)(e,"nim-dialog_deleted"),(0,K.addClass)(e,"_im_dialog"),(0,f.toggleOnline)((0,K.geByClass1)("_im_peer_online",e),t.online),(0,K.toggleClass)(e,"nim-dialog_recent",(0,u.isRecentSearchesActive)(s)),(0,K.toggleClass)(e,"nim-dialog_empty",(0,_.isMessageEmpty)(r)&&!E),(0,K.toggleClass)(e,"nim-dialog_unread-out",je(s,t,c)&&!(0,u.isSearching)(s)),(0,K.toggleClass)(e,"nim-dialog_starred",t.folders&b.FOLDER_IMPORTANT),a&&setTimeout((function(){(0,K.addClass)((0,K.geByClass1)("_im_dialog_"+t.peerId,i),"nim-dialog_injected")}),100)}function $e(e,t,s){nt(e,t),(0,K.toggleClass)(e,"nim-dialog_recent",(0,u.isRecentSearchesActive)(s)),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",e),(0,d.simplifyCounter)(t.unread)),(0,K.toggleClass)(e,"nim-dialog_unread",Ve(t)),(0,K.toggleClass)(e,"nim-dialog_unread-expiring",qe(t)),(0,K.toggleClass)(e,"nim-dialog_unread-mentions",(0,C.isUnreadWithMentions)(t)),(0,K.toggleClass)(e,"nim-dialog_unread-reactions",(0,C.hasUnreadReactionsBadge)(s,t.peerId));let{photo:i}=Ue(s,t.peerId,t,(0,d.isClassicInterface)(s));const a=(0,P.isDialogWithYourself)(s.get().id,t.peerId),n=t.is_nft_photo&&!a;n&&(i=(0,l.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:i,size:34}));let o=(0,K.geByClass1)(n?"nim-peer_search":"_im_dialog_photo",e);o.innerHTML!==i&&(0,K.val)(o,i),(0,f.toggleOnline)((0,K.geByClass1)("_im_peer_online",e),t.online)}function We(e,t,s=null,i=!1){const a=s||Ye(e),n=(0,u.tabIsMessageRequestToChat)(e),r=(0,u.isCasperChat)(t,e.peerId),c=(0,d.isClassicInterface)(t)&&!i;if(n){const s=e.mr&&e.mr.inviter_id,i=(0,E.oCacheGet)(t,s),a=c?i.name:i.short_name;return(c?(0,l.getTemplate)("im_img_prebody",{photo:i.photo}):"")+o.getLang("mail_mr_service_message").replace(/{user}/,a)}if((0,d.isPeerBlocked)(e.peerId,t)){let s=t.get().block_states[e.peerId].name,i=o.getLang("mail_community_answering").replace("{username}",s);return(0,l.getTemplate)("im_drow_prebody",{prebody:i,body:""})}return(0,_.isServiceMsg)(a)&&!n?(0,$.renderServiceMsg)(t,a,e.peerId,!1):r&&(0,_.isMessageEmpty)(a)?o.getLang("mail_empty_casper_message"):(0,_.isExpiredCasperMessage)(a)?o.getLang("mail_expired_message"):function(e,t,s,i,a,n,r,c,_,g){let m="",p="";const h=(0,u.isChannelPeer)((0,u.getTab)(e,s));if(t&b.FLAG_OUTBOUND&&!(0,P.isDialogWithYourself)(e.get().id,s))m=He(o.getLang("mail_author_you"),g,h,_);else if(!(0,C.isBusinessNotifyTab)((0,u.getTab)(e,s))&&Z.Ranges.isChatOrChannelPeer(s)&&!Z.Ranges.isZeroOwner(i)){const t=(0,E.oCacheGet)(e,i);t&&(m=He(o.getLang("mail_author_name").replace("{name}",t.first_name),t.photo,h,_))}return r=(0,d.renderShortText)(s,c,r,a,n),p=m?(0,l.getTemplate)("im_drow_prebody",{prebody:m,body:r}):r,p}(t,a.flags,e.peerId,a.userId,!i,a.attaches,a.text,a.subject,c,(0,E.oCacheGet)(t,t.get().id).photo)}function Ye(e){let t=e.lastmsg_meta;return Array.isArray(t)&&(t=(0,T.getMessageFromTuple)(t)),t||(0,T.getMessageFromTuple)([-1,0,e.peerId,0,"",{},{},-1,-1,0])}function ze(e,t,s){const a=(0,u.getTab)(e,t),n=(0,u.tabIsMessageRequestToChat)(a),o=(0,d.showLeaveDialog)(e,t,(a=>{s().updateMenu(e);let r=Promise.resolve();Z.Ranges.isChatOrChannelPeer(t)&&(r=n?e.set((e=>(0,i.rejectMessageRequest)(t,!1,e))):e.set((e=>(0,i.leaveChat)(t,e)))),a&&r.then((()=>(0,d.cleanHistory)(e,o,s,i.flushHistory,t,a))),o.hide()}))}function Ze(e,t,s,a,n,r){let u=(0,K.gpeByClass)("_im_dialog",r,s);if((0,c.cancelEvent)(n),!u)return!1;const _=(0,l.intval)((0,K.domData)(u,"peer")),g=t.get(),m=Z.Ranges.isGroupId(_)||Z.Ranges.isUserIdTransitional(_);if(g.recentSearch){const s=(0,i.removeFromRecentSearch)(_,cur.imDb);(0,K.re)(u),0===s.length&&dt(t,a,e)}else(0,d.isClassicInterface)(t)&&m?(0,i.deleteDialog)(_,g).then((([s,i])=>{s?(!function(e,t,s,i,a){let n=(0,K.geByClass1)("_dialog_body",t);(0,K.addClass)(t,"nim-dialog_deleted"),(0,K.removeClass)(t,"_im_dialog"),(0,K.val)(n,(0,l.getTemplate)("im_delete_actions",{text:(0,o.langNumeric)(s,o.getLang("mail_im_X_message_deleted","raw")),peer:e,spam_id:i,mail_restore:o.getLang("mail_restore"),mail_im_mark_spam:o.getLang("mail_im_mark_spam"),mail_user_black_list:o.getLang("mail_user_black_list")}))}(_,u,s,i),e().updateMenu(t)):ze(t,_,e)})):ze(t,_,e);return!1}function Qe(e,t,s){(0,d.toggleDialogsFolder)(e,(e=>{t().restoreDialogs(e,!0,!0),(0,h.unpackStore)(e).active_tab===p.FOLDER_ALL&&t().updateRecommendationList(e),t().updateDialogFilters(e,!0)}),i.changeDialogsTab,s)}function Xe(e,t,s=""){let{photo:i,userLink:a}=Ue(e,t.peerId,t,(0,d.isClassicInterface)(e));const r=Z.Ranges.isContactId(t.peerId)?(0,d.prepareContactName)(t.tab):t.tab;let c=function(e){return!(0,d.isPendingForward)(e)}(e),_=""===s?[]:[s];const g=e.get();(0,u.isRecentSearchesActive)(e)&&_.push("nim-dialog_recent"),(0,d.isClassicInterface)(e)&&_.push("nim-csr_classic"),(0,l.inArray)(t.peerId,e.get().mutedPeers)&&_.push("nim-dialog_muted"),(0,u.isCasperChatTab)(t)&&_.push("nim-dialog_casper"),(0,C.isUnreadWithMentions)(t)&&_.push("nim-dialog_unread-mentions"),(0,C.hasUnreadReactionsBadge)(e,t.peerId)&&_.push("nim-dialog_unread-reactions"),qe(t)&&_.push("nim-dialog_unread_expiring"),(0,u.getTab)(e,t.peerId)?.isDonutChat&&_.push("nim-dialog_donut");const m=(0,P.isDialogWithYourself)(e.get().id,t.peerId),p=t.is_nft_photo&&!m;return(0,l.getTemplate)(p?"im_conversation_search_nft_row":"im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:i,user_link:a,unread:(0,d.simplifyCounter)(t.unread),tab_name:(0,n.stripHTML)(r),mail_im_to_multidialog:o.getLang("mail_im_to_multidialog"),mail_casper_chat_label:o.getLang("mail_casper_chat_label"),mail_reactions_badge_label:o.getLang("mail_reactions_badge_label"),mail_mention_badge_label:o.getLang("mail_mention_badge_label"),mail_expiring_message_badge_label:o.getLang("mail_expiring_message_badge_label"),is_unread:Ve(t)?"nim-dialog_unread":"",is_online:(0,f.onlinePlatformClass)(t.online),is_selected:t.peerId==g.peer&&c?"nim-dialog_selected _im_dialog_selected":"",more:_.join(" ")})}function Je(e,t){switch(t.type){case"sep_btn_search_msg":return(0,d.renderBtnSearchOnlyMessages)(e);case"sep_messages":return(0,d.renderMessagesSep)();case"sep_conversations":return(0,d.renderConversationsSep)();case"sep_popular":return(0,d.renderPopularSuggSep)();case"popular_sugg":return(0,d.renderPopularSuggestions)(e);case"recommend_list":return(0,d.renderConvoRecommendList)(e);case"find_friends_stub":return(0,d.renderFindFriendsStub)(e);case"clear_recent":return(0,d.renderClearRecent)();case"empty_dialogs":return(0,l.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_list_empty"),icon:""});case"empty_business_notify":return(0,l.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_business_notify_empty"),icon:""});case"empty_archives":return(0,l.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_archives_empty"),icon:(0,U.getIcon56ArchiveOutline)().icon});case"empty_message_requests":return(0,l.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_mr_empty"),icon:""});case"empty":return(0,l.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_im_search_empty"),icon:""});case"message_request_notice":return(0,l.getTemplate)("im_dialogs_message_requests_notice",{msg:o.getLang("mail_message_request_tab_notice")});case"message_request_button_go":return(0,l.getTemplate)("im_dialogs_message_requests_button",{msg:o.getLang("mail_tab_mr"),counter:(0,H.getFolderUnreadCount)(e,O.ConvoListFolder.MR)});case"business_notify_button_go":return(0,l.getTemplate)("im_dialogs_business_notify_button",{msg:o.getLang("mail_tab_business_notify"),class_name:t.hidden?ye:"",counter:(0,H.getFolderUnreadCount)(e,O.ConvoListFolder.BUSINESS_NOTIFY)});case"archive_button_go":return(0,l.getTemplate)("im_dialogs_archives_button",{msg:o.getLang("mail_tab_archives"),class_name:t.hidden?ye:"",counter:(0,H.getFolderUnreadCount)(e,O.ConvoListFolder.ARCHIVE),mentions:(0,H.getFolderMentionsCount)(e,O.ConvoListFolder.ARCHIVE)});case"archive_notice":const s=(0,l.getTemplate)("im_dialogs_archive_notice_button",{text:o.getLang("mail_archive_tab_notice_button")}),i=o.getLang("mail_archive_tab_notice_content").replace("{button}",s);return(0,l.getTemplate)("im_dialogs_archive_notice",{title:o.getLang("mail_archive_tab_notice_title"),text:i});case"all":const a=(0,h.unpackStore)(e).active_tab,n={[O.ConvoListFolder.MR]:o.getLang("mail_tab_mr"),[O.ConvoListFolder.BUSINESS_NOTIFY]:o.getLang("mail_tab_business_notify"),[O.ConvoListFolder.ARCHIVE]:o.getLang("mail_tab_archives")}[a],r=(0,H.getFolderInlineMenuActions)(e,a).length>0?(0,l.getTemplate)("im_dialogs_active_folder_button_actions",{folder:a}):"";return(0,l.getTemplate)("im_dialogs_active_folder_button",{msg:n,class_name:`_im_folder_${a}_header`,actions:r});case"new_ui_notice":return(0,l.getTemplate)("im_dialogs_new_ui_notice",{title:o.getLang("mail_new_ui_notice_title"),text:o.getLang("mail_new_ui_notice_text")});default:return t.message?Ge(e,t,t.message,{noselect:!0,search:!0}):t.local_index||(0,u.isSearching)(e)?Xe(e,t):Ge(e,t)}}function et(e,t,s,a,n,r){let u=(0,l.intval)((0,K.domData)(r,"peer")),_=(0,K.domData)(r,"action"),g=(0,K.domData)(r,"sid"),m=(0,K.geByClass1)("_im_dialog_"+u,t),p=(0,l.intval)((0,K.domData)(r,"spam"));switch(_){case"restore":m&&e.set(i.restoreDialog.bind(null,u,g,p)).then((()=>{(0,K.addClass)(m,"_im_dialog"),(0,K.removeClass)(m,"nim-dialog_deleted"),Ke(m,e.get().tabs[u],e,t,!1),a().updateMenu(e)}));break;case"spam":const n=`${o.getLang("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${g}" data-peer="${u}">\n            ${o.getLang("mail_restore")}\n        </button>`;if(m){let t=(0,K.geByClass1)("_dialog_body",m);(0,K.val)(t,n),(0,i.spamDialog)(u,g,e.get())}break;case"block":let r;r=(0,d.isCommunityInterface)(e)?(0,d.showBlacklistBox)(u,e):(0,d.showBlacklistBoxUser)(u,e),r.once("success",(function(){e.set(i.flushHistory.bind(null,u)).then((()=>{s().restoreDialogs(e)}))}))}(0,c.cancelEvent)(n)}function tt(e,t){return e.map((e=>(0,T.getMessageFromTuple)(e))).map((e=>(0,l.extend)({},t[e.peerId],{message:e})))}function st(e){return{type:"empty",lang:e}}function it(e,t,s,a){let n=(0,K.gpeByClass)("_im_dialog",a,t),o=(0,l.intval)((0,K.domData)(n,"peer"));return e.set(i.toggleDialogImportant.bind(null,o)),setTimeout((function(){at(e,t,s,a)}),100),(0,c.cancelEvent)(s),!1}function at(e,t,s,i){(0,S.showTooltip)(i,{text:function(){let s=(0,K.gpeByClass)("_im_dialog",i,t),a=(0,K.domData)(s,"peer");return e.get().tabs[a].folders&b.FOLDER_IMPORTANT?o.getLang("mail_im_toggle_important_off"):o.getLang("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:vt(e,i.getBoundingClientRect().top)})}function nt(e,t){const s=t.unread>0?o.getLang("mail_im_new_messages",t.unread):"",i=(0,K.geByClass1)("_im_unread_blind_label",e);(0,K.val)(i,s)}function ot(e,t,s,a,n){let d=(0,K.gpeByClass)("_im_dialog",n,t),_=(0,l.intval)((0,K.domData)(d,"peer"));return e.set(i.markDialogAnswered.bind(null,_)).then((()=>{Ke(d,e.get().tabs[_],e,t),(0,u.isRecentSearchesActive)(e)||s().restoreDialogs(e)})),(0,r.showDoneBox)(o.getLang("mail_marked_as_answered"),{out:1e3}),(0,c.cancelEvent)(a),!1}function rt(e){const t=(0,u.isSearching)(e),s=e.get().searchOnlyMessages;return(0,d.isClassicInterface)(e)?{top:t&&!s?96:60,bottom:(0,d.isCommunityInterface)(e)?42:87}:{top:t&&!s?36:0,bottom:0}}function lt(e,t){e.hoverFirstElement(re,rt(t))}function ct(e){e.unhoverElements(re)}function dt(e,t,s){if((0,u.doPopularSuggExist)(e)){let e=[{type:"sep_popular"},{type:"popular_sugg"}];t.pipeReplace(Promise.resolve(e)),t.toTop()}else s().cancelSearch(e),(0,a.cancelStackFilter)("im_search")}function ut(e,t){const s=t.get(),i=parseInt((0,K.domData)(e,"peer")),a=(0,u.getTab)(s,i);if(!s.is_peer_profile_enabled||!(0,d.isCommunityInterface)(s)||!a||(0,u.isChannelPeer)(a)||(0,u.isCommunityChat)(s,i)||(0,u.isSearching)(t))return;const n=(0,K.geByClass1)(le,e);if(!(a.ad_id||s.peer_profile_tags&&a.peer_tags&&a.peer_tags.ids))return void(n.innerHTML&&(n.innerHTML=""));let o=a.peerTagsMaxWidth||0;if(!o){const s=(0,K.geByClass1)(ce,e).offsetWidth;o=Le-(s+xe+(a.verified?Re:0)),t.set((e=>(e.tabs[i].peerTagsMaxWidth=o,Promise.resolve(e))))}(0,g.renderPeerTags)(n,o,t,i)}function _t(e,t){if(!(0,d.isCommunityInterface)(e))return;["empty_dialogs","empty_business_notify","empty_archives","empty"].includes((0,K.domData)(t,"list-id"))?(0,g.updateEmptyDialogsMargin)():(0,K.hasClass)(t,"_im_dialog")&&ut(t,e)}function gt(e){(0,c.checkEvent)(e)||(0,c.cancelEvent)(e)}function mt(){return window.FriendsSearch?Promise.resolve():window.stManager.add([window.jsc("web/friends_search.js")])}function pt(e,t,s){const{selector:i,setting:a}={new_ui_notice:{selector:`.${Se}`,setting:"new_ui_notice_hidden"},archive:{selector:`.${we}`,setting:"archives_folder_notice_hidden"}}[s];i&&a&&e.set((e=>(0,j.setLocalSettingsValue)(a,1,e))).then((()=>(t.querySelector(i).hidden=!0,(0,V.toggleHideFolderNoticeHandler)((0,h.unpackStore)(e),s,1))))}function ht(e,t,s,i,a,n){return{selectPeer(t,s){let i=(0,K.geByClass)("_im_dialog",e),a=s.get().peer;for(let e=0;e<i.length;e++){let s=i[e],n=(0,l.intval)((0,K.domData)(s,"peer")),o=(0,l.intval)((0,K.domData)(s,"msgid"));n===a&&(!Be(s)||t===o&&Be(s))?((0,K.addClass)(s,"nim-dialog_selected"),(0,K.addClass)(s,"_im_dialog_selected")):(0,K.hasClass)(s,"_im_dialog_selected")&&((0,K.removeClass)(s,"nim-dialog_selected"),(0,K.removeClass)(s,"_im_dialog_selected"))}},appendFastDialogs(t,i,a){(0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),s.saveScroll("list"),a?(s.reset(),(0,d.isPendingForward)(t)||(0,u.isRecentSearchesActive)(t)||!(0,m.doesSearchResultContainConversations)(i)?(0,u.isRecentSearchesActive)(t)&&((0,m.doesSearchResultContainConversations)(i)&&(i=[{type:"clear_recent"}].concat(i)),(0,u.doPopularSuggExist)(t)&&(i=[{type:"sep_popular"},{type:"popular_sugg"}].concat(i))):i=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(i),t.setState({searchOnlyMessages:!1}),s.pipeReplace(Promise.resolve(i)).then((()=>lt(s,t)))):s.pipe(Promise.resolve(i)),(0,d.isClassicInterface)(t)&&!Z.Ranges.isZeroOwner(t.get().peer)||s.toTop()},deactivate(){s.deactivate()},activate(){s.activate()},hoverFirstDialog(e){lt(s,e)},hoverNextDialog(e){s.hoverNextElement(re,oe,rt(e))},hoverPrevDialog(e){s.hoverPrevElement(re,oe,rt(e))},unhoverDialogs:ct.bind(s),selectHoveredDialog(t){let a=(0,K.geByClass1)("_im_dialog_hovered",e);(0,F.partConfigEnabled)("mail_dialog_list_disable_enter_default")||a||(a=(0,K.geByClass1)("_im_dialog",e)),a&&Fe(i,0,t,s,{},a)},appendSearch(t,i,a){let n=tt(a,i);a.length>0?((0,K.addClass)(e.parentNode,"im-page--dialogs_with-mess"),s.pipe(Promise.resolve([{type:"sep_messages"}].concat(n))).then((()=>lt(s,t)))):(0===s.getCurrentElements().length&&s.pipeReplace(Promise.resolve([st()])),(0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"))},update(e){s.pipeReplace(Promise.resolve(ft(e))).then(n.track)},updateDialog(t,s){let i=(0,K.geByClass1)("_im_dialog_"+t,e);i&&!Be(i)&&Ke(i,(0,u.getTab)(s,t),s,e)},focusOnSelected(t){let i=t.get().peer;if(!i)return;let a=(0,K.geByClass1)(`_im_dialog_${i}`,e);a?s.scrollTop(a.offsetTop-a.offsetHeight):s.toTop()},restoreScroll(e){s.restoreScroll("list")||s.toTop()},forceScrollReinit(){const e=s.getScroller();e&&(e.style.overflowY="hidden",setTimeout((()=>e.style.overflowY=""),0))},restoreDialogs:(t,a,o)=>((0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),(0,H.isEmptyFolder)(t)&&!s.isLoading()&&(a=!0),a&&s.reset(),o&&s.wipe(),(0,S.hideAllTooltips)(e),s.pipeReplace(Promise.resolve(ft(t))).then((()=>{if(a&&(!(0,d.isClassicInterface)(t)||!t.get().peer)){let e=function(e,t,s){return(0,d.isClassicInterface)(s)||t().toggleSettingsLoader(s,!0),e.checkMore(!(0,d.isClassicInterface)(s)).then((()=>{(0,d.isClassicInterface)(s)||t().toggleSettingsLoader(s,!1)}))}(s,i,t);return s.toTop(),e}})).then((()=>ct(s))).then(n.track)),appendDialogs(t,i){(0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),i.forEach((s=>{let i=(0,K.geByClass1)("_im_dialog_"+s.peerId,e);i&&$e(i,s,t)})),(0,d.isPendingForward)(t)||(0,u.isRecentSearchesActive)(t)||!(0,m.doesSearchResultContainConversations)(i)||(i=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(i)),t.setState({searchOnlyMessages:!1}),s.isEmpty()&&0===i.length&&(0,d.isPendingForward)(t)&&(i=[st(o.getLang("mail_im_search_empty_chats"))]),s.replacePreserveOrder(i)},updateCounter(t,s){let i=(0,K.geByClass1)("_im_dialog_"+s,e),a=(0,u.getTab)(t,s);if(i&&!Be(i)&&(nt(i,a),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",i),(0,d.simplifyCounter)(a.unread)),(0,K.toggleClass)(i,"nim-dialog_unread",Ve(a)),(0,K.toggleClass)(i,"nim-dialog_unread-out",je(t,a,Ye(a).flags)),(0,K.toggleClass)(i,"nim-dialog_unread-mentions",(0,C.isUnreadWithMentions)(a)),(0,K.toggleClass)(i,"nim-dialog_unread-reactions",(0,C.hasUnreadReactionsBadge)(t,s)),(0,K.toggleClass)(i,"nim-dialog_unread-expiring",qe(a))),(0,u.isRecentSearchesActive)(t)){let t=(0,K.geByClass1)("_im_sugg_"+s,e);t&&((0,K.val)((0,K.geByClass1)("_sugg_unread_ct",t),(0,d.simplifyCounter)(a.unread)),(0,K.toggleClass)(t,"sugg-is_unread",a.unread>0))}},removeDialog(e,t){s.remove(t)},updateOnline(t,s){let i=(0,K.geByClass1)("_im_dialog_"+t,e);if(i){let e=s.get().tabs[t],a=(0,K.geByClass1)("_im_peer_online",i);(0,f.toggleOnline)(a,e.online)}},updateRecommendedOnline(t,s){const i=(0,C.getRecommendedConvoList)(s),a=e.querySelector(`.${_e}__button[data-peer="${t}"]`);if(a&&i){const e=i.item_data[t].online_info,s=a.querySelector("._online");s&&(s.classList.toggle("online",e.is_online||e.is_mobile),s.classList.toggle("mobile",e.is_mobile))}},updateRecommendationList(t){const s=(0,K.se)((0,d.renderConvoRecommendList)(t)),i=s.querySelector(`.${L.CAROUSEL_LAYER_CLASS}`);if(!i){const t=e.querySelector(`.${_e}`);return void(t&&t.replaceChildren(...s.children))}const a=e.querySelector(`.${_e} .${L.CAROUSEL_VIEWPORT_CLASS}`);if(!a)return;const o=a.querySelector(`.${L.CAROUSEL_LAYER_CLASS}:not(.${ve})`);o&&(o.classList.add(ve),o.addEventListener("animationend",(()=>{i.classList.remove(fe),o.parentNode&&(o.remove(),n.track())}))),i.classList.add(fe),a.appendChild(i)},setRecommendationListVisibility(t){const s=e.querySelector(`.${_e}`);return!!s&&(s.classList.toggle(he,!t),!0)},setDialogFailed(t,s,i){let a=(0,K.geByClass1)("_im_dialog_"+t,e);a&&i.get().tabs[t].lastmsg===s&&((0,K.addClass)(a,"nim-dialog_failed"),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",a),"!"))},scrollUp(e,t=!1){s.toTop(e,t),s.saveScroll("list",!0)},saveScroll(e){s.saveScroll("list",!0)},promoteDialog(i,a){let n=(0,K.geByClass1)("_im_dialog_"+a,e);n&&!Be(n)||!(0,u.isSearching)(i)?(s.pipeReplace(Promise.resolve(ft(i)),void 0,!0).then((t=>{!(0,l.inArray)(a,t)&&n&&Ke(n,(0,u.getTab)(i,a),i,e)})),t().updateTyping(a,i)):s.unsetScroll("list")},removeSelection(t){const i=t.get().peer.toString(),a=`._im_dialog_${i}.${oe.join(".")}`,n=(0,K.domQuery)(a,e)[0];oe.forEach((e=>(0,K.removeClass)(n,e))),(0,d.isClassicInterface)(t)||s.hoverElement(i,re,rt(t))},updateScroll(){s.updateScroll()},updateTyping(t,s){let i=(0,K.geByClass1)(`_im_dialog_${t}`,e);if(i&&!Be(i)&&!s.get().tabs[t].deletedDialog){let e=(0,K.geByClass1)("_im_dialog_typing",i);const a=!(0,d.isClassicInterface)(s);let n=(0,d.formatTyper)((0,u.getTab)(s,t).activity,t,!Z.Ranges.isChatOrChannelPeer(t),s.get(),1,a);(0,K.val)(e,n),(0,K.toggleClass)(i,"nim-dialog_typing",n)}},renderPeerTags(t,s=null){if(s){ut((0,K.geByClass1)("_im_dialog_"+s,e),t)}else!function(e,t){const s=t.get();s.is_peer_profile_enabled&&(0,d.isCommunityInterface)(s)&&(0,K.geByClass)("_im_dialog",e).forEach((e=>{ut(e,t)}))}(e,t)},updateFolderCounters(t){const s=(0,h.unpackStore)(t),i={[O.ConvoListFolder.ARCHIVE]:d.TOGGLE_ARCHIVES_TAB,[O.ConvoListFolder.BUSINESS_NOTIFY]:d.TOGGLE_BUSINESS_NOTIFY_TAB};[O.ConvoListFolder.MR,O.ConvoListFolder.BUSINESS_NOTIFY,O.ConvoListFolder.ARCHIVE].forEach((t=>{const a=(0,H.getFolderUnreadCount)(s,t),n=e.querySelector(`[data-list-id=${t}_button_go] .im-page--dialogs-folder-button--counter`);n&&(n.innerHTML=a);const o=i[t];o&&e?.querySelector(`.${o}`)?.classList?.toggle(ye,(0,H.isConvoListFolderHidden)(s,t))}));const a=(0,H.getFolderMentionsCount)(s,O.ConvoListFolder.ARCHIVE),n=e.querySelector(`[data-list-id=${O.ConvoListFolder.ARCHIVE}_button_go] .im-page--dialogs-folder-button--mentions`);n&&(n.dataset.mentions=a)},toggleFolder:Qe,unmount(){s.unmount(),n.destroy(),(0,y.destroyModule)(a)}}}function ft(e){const t=(0,h.unpackStore)(e),s=t.active_tab,i=t.dialog_tabs?.[s]??[],a=t.tabs,n=i.map((e=>a[e.toString()])).sort(P.sortFn.bind(null,e)),o=(0,d.isViewWithRecommendations)(e)&&n.length<2&&!t.hasContacts;if(s===p.FOLDER_MESSAGE_REQUEST&&n.unshift({type:"message_request_notice"}),s!==O.FOLDER_ARCHIVE||t.settings.archives_folder_notice_hidden||n.unshift({type:"archive_notice"}),!(0,d.isClassicInterface)(e))switch(s){case p.FOLDER_ALL:(0,H.getConvoListFolderCounterDisplayed)(e,O.ConvoListFolder.MR)>0&&n.unshift({type:"message_request_button_go"}),(0,R.isBusinessNotifyEnabled)(e)&&n.unshift({type:"business_notify_button_go",hidden:(0,H.isConvoListFolderHidden)(e,O.FOLDER_BUSINESS_NOTIFY)}),n.unshift({type:"archive_button_go",hidden:(0,H.isConvoListFolderHidden)(e,O.FOLDER_ARCHIVE)});break;case p.FOLDER_UNREAD:n.unshift({type:"archive_button_go",hidden:(0,H.isConvoListFolderHidden)(e,O.FOLDER_ARCHIVE)});break;case p.FOLDER_MESSAGE_REQUEST:case O.FOLDER_BUSINESS_NOTIFY:case O.FOLDER_ARCHIVE:n.unshift({type:"all"})}(0,d.isViewWithRecommendations)(e)&&(t.hasContacts||i.length>1)&&n.unshift({type:"recommend_list"}),o?n.push({type:"find_friends_stub"}):(0,H.isEmptyFolder)(e)&&n.push(...(0,H.getEmptyFolderEls)(e));return s===p.FOLDER_ALL&&!(0,d.isCommunityInterface)(e)&&!(0,d.isClassicInterface)(e)&&!(0,R.getLocalSettingsValue)(e,"new_ui_notice_hidden")&&n.unshift({type:"new_ui_notice"}),n}function vt(e,t){let s=e.get().gid?220:150;return!((0,g.isPeerTagsFolder)(e)&&t<=s+De)&&(t>s||(0,u.isSearching)(e))}function bt(e,t,s,a){const{callMutations:n,bindMutations:r}=(0,y.createMutations)(ht),_=document.body.appendChild(document.createElement("div"));_.classList.add("im-page--dialogs-inline-menu-container");const m=function(e,s){(0,S.showTooltip)(s,{text:()=>{if((0,u.isRecentSearchesActive)(t))return o.getLang("mail_hide_from_recent");const e=Number(s.getAttribute("data-peer")),i=(0,u.getTab)(t,e),a=(0,u.tabIsMessageRequestToChat)(i);return Z.Ranges.isChatOrChannelPeer(e)&&!a?(0,C.doesChatTabHaveFlag)((0,u.getTab)(t,e),1024)?o.getLang("mail_unfollow_channel"):(0,u.isChatActive)(i)?o.getLang("mail_leave_chat"):o.getLang("mail_delete"):o.getLang("mail_delete")},black:1,[(0,d.isClassicInterface)(t)?"center":"needLeft"]:!0,shift:(0,d.isClassicInterface)(t)?[-4,10]:[0,10],toup:vt(t,s.getBoundingClientRect().top),zIndex:1})},p=function(s,i){const{folder:a}=i.dataset;if(!a)return;const n=function(e,t,s,i,a){return s=>{const n=s.target.closest(`.${Pe}`);if(!n)return;const{action:o}=n.dataset;if(o!==O.FolderAction.SHOW)return;const r={[O.ConvoListFolder.BUSINESS_NOTIFY]:"business_notify_folder_hidden",[O.ConvoListFolder.ARCHIVE]:"archives_folder_hidden"}[i];r&&t.set((e=>(cur.imDb.updateByKey("archives_folder_hidden",null),(0,j.setLocalSettingsValue)(r,null,e)))).then((t=>{const s=e.querySelector(`.${Me}`);return s&&(s.hidden=!0),(0,V.toggleHideFolderHandler)((0,h.unpackStore)(t),i,!1,!0)})),a?.tt?.hide()}}(e,t,0,a,i),o=(0,H.getFolderInlineMenuActions)(t,a).map((e=>(0,l.getTemplate)("im_page_inline_menu_item",{...e,class_name:Pe}))).join(""),r=(0,l.getTemplate)("im_page_inline_menu",{actions:o});(0,S.showTooltip)(i,{text:r,onCreate:()=>i.tt?.container?.addEventListener("click",n),onHide:()=>{i.tt?.container?.removeEventListener("click",n),i.tt?.destroy()},black:0,dir:"top",shift:[-2,-6],zIndex:130,hasover:!0,appendEl:_,className:"im_page_inline_menu_tt im_page_folder_inline_menu_tt",slide:4,showdt:100,hidedt:100,forcetodown:1,needLeft:!0})};let b;const w=function(i,a){const o=(0,u.getTab)(t,Number(a.dataset.peer));if(!o)return;(0,S.hideAllTooltips)(e),(0,S.destroyAllTooltips)(e),b=null;const r=function(e,t,s,i,a){return n=>{const o=n.target.closest(`.${ie}`);if(!o)return;const{action:r}=o.dataset;(0,G.handleUiActionForPeer)(e,t,s,r,i),a?.tt?.hide()}}(t,s,n,o.peerId,a),c=(0,C.getConvoInlineMenuActions)(t,o).map((e=>(0,l.getTemplate)("im_page_inline_menu_item",{...e,class_name:ie}))).join(""),d=(0,l.getTemplate)("im_page_inline_menu",{actions:c});b=a.closest(`.${X}`),(0,S.showTooltip)(a,{text:d,onCreate:()=>a.tt?.container?.addEventListener("click",r),onShowStart:()=>{b?.classList?.add(ae)},onHide:()=>{b?.classList?.remove(ae),b=null},black:0,dir:"left",shift:[-30,-11],zIndex:130,hasover:!0,className:"im_page_inline_menu_tt im_page_dialog_inline_menu_tt",appendEl:_,slideX:4,showdt:200,hidedt:100})};let E=function(e,s){(0,S.showTooltip)(s,{text:o.getLang("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:vt(t,s.getBoundingClientRect().top)})},T=at.bind(null,t,e),I=it.bind(null,t,e),k=ot.bind(null,t,e,n),M={idFn:e=>function(e,t){try{return t.message?t.message.messageId:(0,u.isSearching)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}catch(s){if(t)throw s;const i=(0,h.unpackStore)(e),a=Object.keys(i.tabs).map(Number),n=i.dialog_tabs.all.filter((e=>!a.includes(e)));throw s.message=`Missing convo info for: ${n.join(", ")}`,s}}(t,e),hoverableFn:e=>(0,K.hasClass)(e,"_im_dialog"),renderFn:Je.bind(null,t),more:Ne.bind(null,t,n),onScroll:()=>{if((0,d.isClassicInterface)(t)&&A.browser.safari){(document.body.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible?(0,K.addClass)(a,"im-page--header_static"):(0,K.removeClass)(a,"im-page--header_static")}(0,S.hideAllTooltips)(e)},onRenderFn:_t.bind(null,t)},P=(0,v.mount)(e,(0,h.default)({limit:40,offset:0,nativeScroll:!!(0,d.isClassicInterface)(t),height:Q,elements:ft(t)}),(()=>M));const L=function(e){let t;const s=new Set,i=e=>{e.forEach((e=>{const{target:t,isIntersecting:i}=e,{position:a,peer:n,trackcode:o}=t.dataset;if(!s.has(n)&&i)s.add(n),(0,x.collectConversationSuggestionItemStats)(o,Number(a),"show");else if(s.has(n)&&!i){if(s.delete(n),!o)return;(0,x.collectConversationSuggestionItemStats)(o,Number(a),"hide")}}))};return{track:()=>{t&&t.disconnect();const e=document.querySelector(`.${_e}`);if(!e)return;const s=e.querySelector("._im_carousel_viewport");t=new IntersectionObserver(i,{root:s}),e.querySelectorAll(`.${ge}`).forEach((e=>t.observe(e)))},destroy:()=>{t&&t.disconnect()}}}();L.track(),A.browser.mozilla&&mt();let R=Fe.bind(null,s,n,t,P);const F=e=>{b?.classList?.remove(ae)};let U=Oe.bind(null,t,e,P),$=et.bind(null,t,e,n,s);const W=Ze.bind(null,s,t,e,P),[Y,z,oe,le]=[O.ConvoListFolder.MR,O.ConvoListFolder.BUSINESS_NOTIFY,O.ConvoListFolder.ARCHIVE,O.ConvoListFolder.ALL].map((e=>i=>{if(!i.target.closest(`.${be}`))return void Qe(t,s,e);const n=(0,h.unpackStore)(t).settings,r={[O.ConvoListFolder.BUSINESS_NOTIFY]:"number"!=typeof n.business_notify_folder_hidden,[O.ConvoListFolder.ARCHIVE]:"number"!=typeof n.archives_folder_hidden}[e],l={[O.ConvoListFolder.BUSINESS_NOTIFY]:ke,[O.ConvoListFolder.ARCHIVE]:Ie},c=Boolean(cur.imDb.selectByKey(l[e]));r&&!c&&(!function(e,t){const s=e.querySelector(`.${B.CONVO_MORE_CLASS}`);if(!s)return;let i;const a="feature_intro_tt feature_intro_blue_tt im-page--dialogs--folder_hide_hint";switch(t){case O.ConvoListFolder.BUSINESS_NOTIFY:i={width:206,content:o.getLang("mail_dialog_business_notify_more_hint"),cls:a+" im-page--dialogs--business-notify_hide_hint"};break;case O.ConvoListFolder.ARCHIVE:i={width:164,content:o.getLang("mail_dialog_archive_more_hint"),cls:a+" im-page--dialogs--archives_hide_hint"};break;default:return}(0,K.data)(s,"ett")?.destroy?.();const n=new N.ElementTooltip(s,{autoShow:!1,appendTo:document.body,forceSide:"bottom",offset:[15,8],align:"right",withCloseButton:!0,onHide:()=>{n.destroy()},...i});n.show()}(a,e),cur.imDb.updateByKey(l[e],1)),s().hideFolderButton(t,e)})),ce=s=>{pt(t,e,"archive")},he=s=>{pt(t,e,"new_ui_notice")},fe=(0,y.createModule)({handlers:(a,n)=>{n(e,"click",se,W),n(e,"click","_im_dialog_markre",k),n(e,"click",ee,I),n(e,"click",X,R),n(e,"mouseover",X,F),n(e,"click",d.MESSAGE_SEARCH_CLASS,U),n(e,"mouseover",se,m),n(e,"mouseover",te,w),n(e,"mouseover",Me,p),n(e,"mouseover","_im_dialog_markre",E),n(e,"click",d.CLEAR_RECENT_CLASS,(()=>{(0,i.resetRecentSearch)(cur.imDb),dt(t,P,s)})),n(e,"click",d.TOGGLE_MR_TAB,Y),n(e,"click",d.TOGGLE_BUSINESS_NOTIFY_TAB,z),n(e,"click",d.TOGGLE_ARCHIVES_TAB,oe),n(e,"click",d.TOGGLE_ALL_TAB,le),n(e,"mouseover",ee,T),n(e,"click",ne,$),n(e,"click",J,gt),n(e,"click",me,(e=>function(e,t){(0,c.cancelEvent)(e);const s=e.target.closest("."+ge),i=s.parentNode,a=Number(s.dataset.peer);if(!s.dataset.trackcode){const e=(0,h.unpackStore)(t),s={hasPeer:!!a,hasListData:!!e.recommendationList,hasPeerData:!!e.recommendationList.item_data[a]};throw i.remove(),t.set((e=>(0,D.removeStoredRecommendedListItem)(e,a))),new Error((0,q.getErrorText)(s,"Rec remove log"))}i.remove(),t.set((e=>(0,D.removeStoredRecommendedListItem)(e,a)))}(e,t))),n(e,"click",ge,(e=>function(e){if(e.target.closest("."+me))return;const t=e.target.closest("."+ge),{position:s,trackcode:i}=t.dataset;(0,x.collectConversationSuggestionItemStats)(i,Number(s),"click")}(e))),n(e,"click",pe,(e=>function(e,t){"invite_by_phone_number"===e.target.closest("."+pe).dataset.action&&mt().then((()=>{window.FriendsSearch.inviteBox()}))}(e))),(0,d.isCommunityInterface)(t)&&t.get().is_peer_profile_enabled&&(n(e,"mouseover",de,(e=>(0,g.onPeerTagsExtraHover)(e,t))),n(e,"click",ue,(e=>(0,g.onDialogPeerTagClick)(e,t)))),a(e,"mouseover",(0,f.throttle)(P.unhoverElements.bind(P,re),100)),n(e,"mouseover",be,((e,t)=>{(0,S.showTooltip)(t,{text:o.getLang("mail_dialog_folder_button_hide"),black:1,center:!0,shift:[1,6],appendEl:document.body})})),n(e,"click",Ee,ce),n(e,"click",Te,he),n(e,"click",Ce,(e=>{s().applySearchAction(t,"settings",e)})),n(e,"mouseover",Ae,((e,t)=>{(0,S.showTooltip)(t,{text:o.getLang("mail_dialog_folder_button_back"),black:1,center:!0,shift:[-3,0],appendEl:document.body})})),n(e,"click",Ae,le)}});return r(e,n,P,s,fe,L)}},702598:(e,t,s)=>{"use strict";s.d(t,{mount:()=>p});var i=s(948350),a=s(879007),n=s(452314),o=s(629596),r=s(808288),l=s(583790),c=s(485413),d=s(365485),u=s(891911),_=s(459373);function g(e,t,s,a){if(e.loading||e.all)return;if(s.scrollTop+window.innerHeight-s.scrollHeight>-300){let s=(0,n.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,l.wrapLoading)(s)((0,i.loadImportant)(e.offset).then((([t,o,r,c])=>{e.all=c.all,e.offset=c.offset,e.all?(0,n.addClass)(s,"im-important_all"):e.loading=!1,a.set((e=>(0,i.mergeTabs)(e,(0,l.tabFromIds)(c.msgs,c.hash),!0)));let d=(0,n.ce)("div");d.innerHTML=o,s.appendChild(d),(0,_.ensureDomHasActions)(s)})),"bottom")}}function m(e,t,s,...n){n.filter((e=>(0,a.inArray)(e.type,[u.SET_FLAGS,u.RESET_FLAGS,u.CHANGE_PEER]))).forEach((a=>{if(a.type!==u.CHANGE_PEER){if(a.flags===u.FLAG_IMPORTANT){let s=a.type===u.SET_FLAGS;e.set(i.updateFavMessage.bind(null,[a.messageId],0,s)).then((i=>{t.markImportant(a.messageId,s,e)}))}}else s.hide()}))}function p(e,t,s,i){let a=(0,n.ge)("box_layer_wrap"),u=t.get().longpoll,p=(0,c.default)({peer:0,longpoll:u,oCache:{},tabs:(0,l.tabFromIds)(i.msgs,i.hash)}),h=(0,r.mount)(e.bodyNode,p,(()=>({}))),f=(0,o.mount)(e.bodyNode,t,"fav_box");(0,_.ensureDomHasActions)(e.bodyNode);let v=m.bind(null,t,h,e);u.onData(v);let b=g.bind(null,{all:!1,loading:i.all,offset:i.offset},e,a,p);const y=(0,d.createModule)({handlers:(e,t)=>{e(a,"scroll",b)}});return{unmount(){(0,d.destroyModule)(y),f.unmount(),h.unmount(),u.offData(v)}}}},331619:(e,t,s)=>{"use strict";s.d(t,{mount:()=>d});var i=s(583790),a=s(879007),n=s(948350);const o=5e3,r=54e6,l=72e5;function c(e){const t=e.get().tabs,s=e.get().peer,o=Object.keys(t).filter((t=>(0,i.isFullyLoadedTab)(e,t)&&(0,a.intval)(t)!==s)).map((e=>t[e]));o.filter((e=>Date.now()-e.last_visited>r)).forEach((t=>e.set(n.cleanTab.bind(null,t.peerId)))),o.filter((t=>(0,i.isFullyLoadedTab)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>l)).forEach((t=>e.set(n.stringifyTab.bind(null,t.peerId))))}function d(e){const t=setInterval(c.bind(null,e),o);return{unmount(){clearInterval(t)}}}},300909:(e,t,s)=>{"use strict";s.d(t,{AUDIO_MSG_AUTOSHOW_SETTING_HINT:()=>ot,mount:()=>vs});var i=s(948350),a=s(333976),n=s(723561),o=s(490712),r=s(317412),l=s(927984),c=s(327527),d=s(452314),u=s(471424),_=s(201193),g=s(52554),m=s(531868),p=s(583790),h=s(628180),f=s(693143),v=s(507035),b=s(510575),y=s(265772),w=s(891379),E=s(365485),C=s(914098),S=s(107850),T=s(572148),I=s(629596),k=s(808288),M=s(373155),P=s(890888),A=s(94751),L=s(800855),R=s(814402),x=s(551465),D=s(891911),O=s(958145),B=s(621753),N=s(718898),F=s(950353),U=s(368759),H=s(656405),j=s(523977),V=s(699615),q=s(279203),G=s(387674),K=s(8520),$=s(810903),W=s(879007),Y=s(248782),z=s(967886),Z=s(476726),Q=s(885658),X=s(922201),J=s(205922),ee=s(20025),te=s(199835),se=s(248298),ie=s(205184),ae=s(349333),ne=s(258643),oe=s(610989),re=s(520581),le=s(170482),ce=s(459373),de=s(911575),ue=s(660546),_e=s(411953),ge=s(674458),me=s(598824),pe=s(388078),he=s(745910);const fe=1e3,ve=-30,be=30,ye=2e3,we=700,Ee=45,Ce=16,Se=42,Te=47,Ie=15,ke=40,Me="._im_to_end",Pe="._im_to_mention",Ae="._im_to_reaction",Le="_im_failed_action",Re="_im_mess_link",xe="_im_admin_name",De="_im_typer_c",Oe="_im_error",Be="im-page--error--visible",Ne="_im_join_cancel",Fe="_im_retry_media",Ue="im-audio-message_recorded",He="im-audio-message_recording",je="_im_mess_srv",Ve="im_srv_mess_link",qe="_chat_invitation",Ge="_im_mess",Ke="_im_replied_message",$e="_im_replied_author_link",We="im-mess-stack--bomb",Ye="top",ze="center",Ze="im-expired-message--in",Qe="_im-call-snippet",Xe="_im_mess_callsnippet",Je="_im_call_snippet_join_btn",et="mem_pseudolink",tt="_im_mess_pinned",st="_im_subscribe_button",it="im-mess-stack--lnk",at="_msg_asr_toggle",nt="im_msg_audiomsg--transcription-shown",ot="_im_asr_setting_hint";let rt=!1,lt={},ct=!1;function dt(e){return e.get().isMassMentionsMessageAllowed}function ut(e){const t=(0,f.getTab)(e,e.get().peer);return!!(0,f.getPinnedMessage)(e)||!(!t||!t.top_banner)}function _t(e,t){const s=(0,v.unpackStore)(e),i=(0,f.getTab)(s,t);return pe.Ranges.isChatOrChannelPeer(t)&&(0,L.isPinnedMessageVisibleInTab)(s,t)||!!i.top_banner&&!(0,f.isSearchShown)(t,s)}function gt(e){return(0,p.getPinnedMessageHeight)(e)}function mt(e,t,s){const i=s||(0,d.clientHeight)();return Math.min(i-Ie,Math.max(0,e,we+Se+t.offsetTop))}function pt(e,t){const s=(0,W.intval)((0,d.domData)(t.target,"msgid")),i=(0,d.gpeByClass)(`_im_mess_${s}`,t.target),a=(0,d.geByClass1)("_im_log_body",i),n=(0,d.geByClass1)("_im_mess_susp_cont",i);a.innerHTML=n.innerHTML}function ht(e,t){return(0,d.geByClass1)("_im_mess_"+t,e)}function ft(e){e().hideError()}function vt(e,t,s,a,n){if((0,r.checkEvent)(a))return!0;let o=(0,G.fromQueryString)(n.getAttribute("href")),l=(0,W.intval)(o.msgid);l&&e.set(i.changePeer.bind(null,e.get().peer,l,!1)).then((()=>At(s,t,l,e))),(0,r.cancelEvent)(a)}function bt(e,t,s){const a=(0,f.getTab)(t,s),n=(0,i.strHistory)(a.history);(0,d.toggleClass)(e,"im-page--history_empty-hist",!n)}function yt(e,t,s,i){if(!(0,d.hasClass)(s.target,"_im_mess_marker"))return;const a=s.target,n=(0,v.toArray)((0,d.geByClass)(p.FAILED_CLASS,t));window.tooltips&&n.map((e=>(0,d.geByClass1)("_im_mess_marker",e))).filter((e=>e!==a)).forEach((e=>tooltips.hide(e,{fasthide:!0})));let o=(0,d.domData)(i,"msgid");(0,$.showTooltip)(a,{content:(0,W.getTemplate)("im_failed_menu",{count:n.length,modifiers:(0,K.classNames)("im-settings_failed",{"im-settings_no_delete":o>0,"im-settings_single":1===n.length}),id:o}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}function wt(e){return(0,d.geByClass1)("_im_peer_history",e)}function Et(e,t){const s=t.contHeight(),i=e.scrollTop+(s-e.contHeight);t.scrollTop(i)}function Ct(e,t,s,a,n,o,r,l,u,_=!0,g=!1){let m=(t.get().tabs||{})[s];n().hideError(),o.renderPeer(t),l.renderPeer(t),u.render(t);const h=(0,f.isCasperChat)(t,s);if((0,d.toggleClass)(e,"im-page--history_casper",h),!t.get().tabHistoryNotChanged){o.reRenderTitle(t),bt(e,t,s);const r=(0,i.strHistory)(m.history);if(r){const t=(0,d.geByClass1)("_im_peer_history",e);(0,d.val)(t,r)}else n().showEmptyScreen();(0,c.getAudioPlayer)().isPlaying()&&(0,c.getAudioPlayer)().updateCurrentPlaying(),Yt(t,a,e)}if((0,i.isSearchingInplace)(s,t.get())?n().showSearch(t):n().cancelSearch(t,!1),r.changePeer(s,t),t.get().msgid)At(a,e,t.get().msgid,t);else if(m.scrollBottom&&_){Et(m,a);const[s]=(0,p.isMessagesVisible)(t,e,a);m.skipped||setTimeout((()=>{m.unread&&!s&&(Dt(t,e,!0),Ot(t,e,!0)),Tt(t,a,e),It(t,a,e)}),100)}else Pt(a,e,n,t,g)||a.scrollBottom(ve);Ft(t,e),(0,X.initWidgets)(e,s)}function St(e,t,s=!1){const a=s||t.scrollTop(),n=t.scrollBottom(),o=t.contHeight(),r=e.get().peer;e.set(i.saveHistoryScroll.bind(null,r,a,n,o))}function Tt(e,t,s){const i=(0,f.isGoToMentionVisible)(e),a=(0,f.isGoToEndVisible)(e),n=t.getScrollHeight()/4,o=t.scrollTop()>0;t.scrollBottom()>n&&(!a||i)&&o&&Dt(e,s,!0,ke)}function It(e,t,s){if(!dt(e))return;const i=t.getScrollHeight()/4,a=t.scrollTop()>0,n=(0,f.isGoToMentionVisible)(e);t.scrollBottom()>i&&!n&&a&&Ot(e,s,!0,ke)}function kt(e,t,s,a,n,o,r,l,c=!0){if(!e.get().history_init&&(e.get().history_init=!0,l.scrollTop()>0))return;if(y.screenfull.isFullscreen)return;n.update(l),n.show();const u=e.get().peer;if(0===u||!(0,p.isFullyLoadedTab)(e.get(),u))return;if(N.default.onHistoryScroll(l.scrollTop()),layers.visible)return;const _=(0,f.getTab)(e,u);_&&!_.skipped&&l.scrollBottom()>ke?(Tt(e,l,o),It(e,l,o)):_.skipped||_.unread||(Xt(e,o),Jt(e,o));let g=(0,p.wrapLoading)(s);if(!(0,i.isSearchingInplace)(u,e.get())&&c&&a(l),!rt&&(r<0||0===l.scrollBottom())&&l.scrollBottom()<fe){if((0,i.isSearchingInplace)(u,e.get()))return;if(_.skipped>0&&!e.get().no_moving_down){const s=(0,d.gpeByClass)("_im_page_history",o),a=e.get();rt=!0;let n=e.set(i.loadLessHistory).then(t().loadHistory.bind(null,a.peer,{reversed:!0})).then((()=>{t().updateObserver(),rt=!1,Dt(e,s),Ot(e,s),_.skipped||e.set(i.changePeer.bind(null,e.get().peer,!1,!1))}));return Gt(s,!0),void n.then(Gt.bind(null,s,!1))}}if(!rt&&l.scrollTop()<fe){if((0,i.isSearchingInplace)(u,e.get())){rt=!0;let s=t().getSearchResulstModule();return s.isAll(e)?void(rt=!1):void g(s.loadMore(e).then((s=>{rt=!1,s&&(t().loadHistory(e.get().peer,{},e,s),a(l))})),"up")}let s=e.get();_.allShown||(rt=!0,g(e.set(i.loadMoreHistory.bind(null,0,0)).then(t().loadHistory.bind(null,s.peer,{})).then((()=>{rt=!1,a(l)})),"up"))}r<0&&rs(e,u,l.scrollBottom(),o,t),(0,w.videoAutoPlayHandler)()}function Mt(e,t){return window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?Promise.resolve():e.set(i.readTillSpecificMessage.bind(null,t,e.get().peer))}function Pt(e,t,s,i,a){const n=(0,d.geByClass1)("_im_unread_bar_row",t);if(n){let o=i.get(),r=o.peer,l=n.getBoundingClientRect(),c=(0,d.geByClass1)("_im_chat_body_abs",t).getBoundingClientRect().top+20;(0,p.isClassicInterface)(i)&&(c+=Te+(_t(o,r)?gt(i):0));const u=e.scrollTop()-c+l.top;return e.scrollTop(u),St(i,e,u),setTimeout((()=>{r===i.get().peer&&kt(i,s,wt(t),(function(){}),a,t,0,e)}),80),s().updateObserver(),!0}return!1}function At(e,t,s,i,a=Ye){const n=ht(t,s);if(n){const s=(0,p.isClassicInterface)(i),o=i.get().peer,r=s?(0,d.clientHeight)():(0,d.geByClass1)("_im_chat_body_abs",t).offsetHeight;let l=n.offsetTop+(0,d.domPN)(n).offsetTop+(0,d.domPN)((0,d.domPN)(n)).offsetTop+(0,d.domPN)((0,d.domPN)((0,d.domPN)(n))).offsetTop;s&&_t(i,o)&&(l-=gt(i)),a===Ye?e.scrollTop(l-e.getScrollHeight()/2+r/2):e.scrollTop(l-e.getScrollHeight()+r/4),(0,d.addClass)(n,"im-mess_light"),setTimeout((()=>{(0,d.removeClass)(n,"im-mess_light")}),ye)}}function Lt(e,t,s){s.updateLastSeen(e)}function Rt(e,t,s,a,n,o){const r=(0,d.domData)(o,"action"),l=(0,d.domData)(o,"msgid"),c=(0,d.geByClass1)("_im_mess_marker",ht(s,l)),_=Number(l)>0?"edit":"send",g=e.get().peer,m=wt(s);switch(r){case"resend":(0,u.statlogsSendingRetry)("retry",_),t(n,o);break;case"resend_all":(0,u.statlogsSendingRetry)("retry",_),a().resendPeer();break;case"delete":(0,u.statlogsSendingRetry)("delete",_),e.set((t=>(0,i.removeFailed)(e,m,g,l,t)));break;case"delete_all":(0,u.statlogsSendingRetry)("delete",_),e.set((t=>(0,i.removeFailed)(e,m,g,void 0,t)))}tooltips.hide(c,{fasthide:!0})}function xt(){const e=(0,ee.showBox)("al_im.php",{act:"a_business_notify_info_content"},{title:!1,onDone:()=>{const t=()=>e.hide();document.querySelectorAll("._im_business_notify_info_box_hide").forEach((e=>e.addEventListener("click",t))),e.setOptions({hideButtons:!0})}})}function Dt(e,t,s,a=0){const n=e.get().peer;if(pe.Ranges.isZeroOwner(n))return;const o=e.get().tabs[n],r=(t||document).querySelector(Me);let l=!1;(s||o.skipped>0||o.unread>0)&&!(0,i.isSearchingInplace)(n,e.get())?(l=!0,Ut(t,e),(0,d.addClass)(r,"im-navigation_shown")):Qt(r,!0),e.set(i.updateGoToEndVisibility.bind(null,[l,+a]))}function Ot(e,t,s,a=0){if(!dt(e))return!1;const n=e.get().peer;if(pe.Ranges.isZeroOwner(n))return;const o=e.get().tabs[n],{mentions:r=[],mention_cmids:l=[]}=o,c=(t||document).querySelector(Pe),u=(0,Z.partConfigEnabled)("me_web_read_by_cmid")?l.length:r.length;let _=!1;o.unread>0&&u>0&&!(0,i.isSearchingInplace)(n,e.get())?(_=!0,function(e,t,s){const i=(e||document).querySelector(Pe),a=i.querySelector("._im_to_mention_label");a.innerHTML=s>0?(0,W.formatCount)(s):""}(t,0,u),(0,d.addClass)(c,"im-navigation_shown")):Qt(c,!0),e.set(i.updateGoToMentionVisibility.bind(null,[_,+a]))}function Bt(e){Qt((e||document).querySelector(Ae),!0)}function Nt(e,t){if(!(0,f.isGoToReactionAvailable)(e))return;const s=(0,g.getPeer)(e),a=(0,g.getUnreadReactions)(e,s).size,n=(t||document).querySelector(Ae);n&&a&&!(0,i.isSearchingInplace)(s,e.get())?(!function(e,t){const s=e.querySelector("._im_to_reaction_label");s&&(s.innerHTML=t?(0,W.formatCount)(t):"")}(n,a),(0,d.addClass)(n,"im-navigation_shown")):Bt(t)}function Ft(e,t){e.set((e=>(0,i.updateGoToReactionAvailability)(!0,e))),Nt(e,t)}function Ut(e,t){const s=t.get().peer,i=(0,f.getTab)(t,s);(e||document).querySelector(Me).querySelector("._im_to_end_label").innerHTML=Number(i.unread)>0?(0,W.formatCount)(i.unread):""}function Ht(e,t=0){if(0===e.scrollTop()&&0===e.scrollBottom())return!1;return e.scrollBottom()<(t?be+t:be)}function jt(e,t,s,i,a){let n=(0,d.domData)(a,"msgid"),o=e.get().peer,r=(0,f.getMessage)(e,o,n);r.type===D.EDIT_MESSAGE?(s().sendEditMessage(e,r),s().resendMessage(o,n)):e.get().imQueueResend(o,n).then((t=>{e.get().longpoll.push([(0,O.resendEvent)(o,t.mess)])}))}function Vt(e,t,s,a,n,o){let r=(0,W.intval)((0,d.domData)(o,"peer")),l=(0,W.intval)((0,d.domData)((0,d.gpeByClass)("_im_mess",o),"msgid"));const c=(0,f.getTab)(e,r);return e.set(i.restoreMessage.bind(null,l,r)).then(p.restoreMessage.bind(null,l,r,wt(t))).then((()=>Yt(e,s,t))),(0,i.restoreMessageSend)(l,r,c.hash,e.get().gid).then((()=>{l>c.lastmsg&&(0,i.loadActualLastMessage)(e,r).then((()=>a().updateState(r,e)))})),!1}function qt(e,t){if(e){const s=e.querySelector(Me);(0,d.toggleClass)(s,"im-navigation_loading",t)}}function Gt(e,t){if(e){const s=e.querySelector(Me);(0,d.toggleClass)(s,"im-navigation_loading",t)}}function Kt(e,t,s,a){const n=t.get().peer,o=(0,f.getTab)(t,n);if(!(0,p.isFullyLoadedTab)(t,n))return;const r=Object.keys(o.msgs).find((e=>{const t=o.msgs[e];return!Array.isArray(t)&&(0,b.isUnread)(o,t)}));if(!o.skipped)return r?At(a,s,r,t):a.scrollBottom(ve),Dt(t,s),Ot(t,s),rs(t,n,0,s,e),void(0,i.readTillSpecificMessage)(o.lastmsg,n,t.get());qt(s,!0),t.set((e=>(0,de.loadPeer)(e,n,-1,!0,!1,"goToEnd"))).then((()=>{qt(s,!1),e().changePeer(t,!1,!1)}))}function $t(e,t,s,i){const a=t.get().peer,n=(0,f.getTab)(t,a),{mentions:o=[],mention_cmids:r=[]}=n,l=(0,Z.partConfigEnabled)("me_web_read_by_cmid")?r[0]:o[0],c=(0,Z.partConfigEnabled)("me_web_read_by_cmid")&&l?(0,ie.getMessageByCmid)(t,a,l)?.messageId:l;if(!n.skipped)return c&&At(i,s,c,t,ze),Dt(t,s,!0),Ot(t,s),Mt(t,c),void rs(t,a,0,s,e);qt(s,!0),t.set((e=>(0,de.loadPeer)(e,a,c,!0,!1,"goToMention"))).then((()=>{qt(s,!1),e().changePeer(t,!1,!1),a===t.get().peer&&(At(i,s,c,t,ze),Mt(t,c))}))}async function Wt(e,t,s){const i=(0,g.getPeer)(e),a=(0,g.getGroupId)(e),n=Math.min(...Array.from((0,g.getUnreadReactions)(e,i)));if(!n)return;const o=(t||document).querySelector(Ae);o?.setAttribute("disabled","");const r=await function(e,t,s,i){let a=(0,ie.getMessageByCmid)(e,t,i)?.messageId;if(a)return Promise.resolve(a);const n=(0,g.getTabCmidToMessageIdMap)(e,t).get(i);return n?Promise.resolve(n):e.set((e=>(0,re.updateCmidToMessageIdMap)(e,t,s,i))).then((e=>(0,g.getTabCmidToMessageIdMap)(e,t).get(i)))}(e,i,a,n);o?.removeAttribute("disabled"),r&&(0,p.focusOnMessage)(e,(()=>At(s,t,r,e)),i,r)}function Yt(e,t,s,i=!1){if((0,p.isClassicInterface)(e)){let e=t.contHeight(),a=(0,d.geByClass1)("_im_chat_input_w",s),n=(0,d.geByClass1)("im-chat-input",s),o=(0,d.geByClass1)("_im_chat_resize",s),r=(0,d.geByClass1)("EmptyDialogStickers",s);if(!1!==(i=!1!==i?i:(0,p.getClassicChatHeight)())&&i>0){const e=(0,d.clientHeight)();let t=(0,d.geByClass1)("_im_chat_audio_input_parent",s),n=mt(i,s,e),r=n-((0,d.hasClass)(t,He)||(0,d.hasClass)(t,Ue)?t:(0,d.geByClass1)("_im_chat_input_parent",s)).offsetHeight;o.style.height=e-n-Ie+"px",(0,d.setStyle)(a,{top:r+"px",bottom:"auto"})}else o.style.height="0px",(0,d.setStyle)(a,{top:"auto",bottom:"0px"});let l=(0,d.geByClass1)("_im_peer_history_w",s),c=n.offsetHeight-Ee,u=a.offsetHeight-Ce;return(0,d.setStyle)(l,{borderBottomWidth:r?c:u}),t.contHeight()-e}let a=t.getScrollHeight();return t.update(!1,!0),a-t.getScrollHeight()}function zt(e,t,s,i){let a=t.offsetHeight;i(),e.heightIncreased(t.offsetHeight-a,s)}function Zt(e,t){let s=t.getBoundingClientRect().top;(0,$.showTooltip)(t,{className:"im-page--admin-tt",text:oe.getLang("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:s>200})}function Qt(e,t=!1){(0,d.hasClass)(e,"im-navigation_shown")&&(t&&(0,d.addClass)(e,"im-navigation_fast"),(0,d.removeClass)(e,"im-navigation_shown"),t&&(e.offsetHeight,(0,d.removeClass)(e,"im-navigation_fast")))}function Xt(e,t,s=!1){const a=t.querySelector(Me);e.set(i.updateGoToEndVisibility.bind(null,[!1,0])),Qt(a,s)}function Jt(e,t,s=!1){const a=t.querySelector(Pe);e.set(i.updateGoToMentionVisibility.bind(null,[!1,0])),Qt(a,s)}function es(e,t,s){y.screenfull.isFullscreen||0===t.get().peer||(0,p.isClassicInterface)(t)||e().restoreScroll(t,t.get().peer)}function ts(e,t){const s=e.get(),a=s.peer,n=(0,d.domClosest)(je,t.target),o=(0,W.intval)((0,d.domData)(n,"msgid")),r=(0,f.getMessage)(e,a,o),l=r&&(0,b.isServiceMsg)(r)&&r.kludges.source_act;if(l!==p.CHAT_PIN_MESSAGE&&l!==p.CHAT_UNPIN_MESSAGE)return;const c=n.querySelector("."+Ve);if(c&&"A"!==c.tagName){const e=r.kludges.source_chat_local_id;if(!e||lt[e])return;lt[e]=(0,i.getMessageLocalId)(a,e,s).then((([t])=>{if(t){const s=`/im?sel=${(0,p.convertPeerToUrl)(a)}&msgid=${t}`,i=c.innerHTML;(0,d.domReplaceEl)(c,(0,ue.getServiceLinkTemplate)(s,i,!0,Ve)),delete lt[e]}}))}}function ss(e,t,s){const i=e.get(),a=i.peer,n=s.target.href&&s.target.href.match(/msgid=([\d]+)/),o=n&&n[1];if("A"===s.target.tagName&&o&&!(0,p.isAlreadyDeleted)(e,a,o)&&!(0,r.checkEvent)(s)){(0,f.getMessage)(e,a,o)?(e.setState({msgid:o}),(0,F.updateLocation)({msgid:o}),t().focusOnMessage()):i.longpoll.push([(0,O.changePeer)(a,o,!1,!1,i.currentEntryPoint||"")])}(0,r.cancelEvent)(s)}function is(e){let t=(0,m.getCurrentTab)(e);pe.Ranges.isChatOrChannelPeer(t.peerId)&&(t.pinHideId=cur.imDb.select(U.PIN_HIDDEN_ID_OP,t.peerId))}function as(e,t,s,i,a){e.setState({isEditing:!1}),(0,d.removeClass)(i,"im-mess_is_editing"),(0,d.removeClass)((0,d.geByClass1)("_im_page_history"),"is_msg_editing"),(0,n.cancelStackFilter)("cancel_edit"),s.setDraft(e,(0,g.getPeer)(e)?(0,f.getTabDraft)((0,m.getCurrentTab)(e)):null),s.toggleStickers(e,!0),s.restoreKeyboard(),ns(t)}function ns(e){(0,v.toArray)((0,d.geByClass)("_im_history_tooltip",e)).forEach((e=>(0,d.hide)(e)))}function os(e){const t=e.dataset.title,s=e.dataset.url;if(!s||!t)return!1;const i=oe.getLang("mail_download_unsafe_text").replace("{filename}",t),a=new ee.MessageBox({title:oe.getLang("mail_download_unsafe_title")});return a.content(i).setButtons(oe.getLang("global_continue"),(()=>{const e=document.createElement("a");e.setAttribute("href",s),e.click(),a.hide()}),oe.getLang("global_cancel")).show(),!1}function rs(e,t,s,a,n){let o=(0,f.getTab)(e,t);if(!(Date.now()-(o.lastReset||0)<1e3)&&o&&o.msgs&&o.history&&!rt&&o.offset>300&&0==o.skipped&&s<50&&s>=0&&0===(e.get().selectedMessages||[]).length){let s=Object.keys(o.msgs).filter((e=>e>0)).sort(((e,t)=>e-t)).slice(0,-50);const a=s.slice(-1)[0];e.mutate(i.resetTabAll.bind(null,t)),e.set(i.removeMessages.bind(null,s,t)).then((()=>n().removeStartingFromMessage(a,t,e)))}}function ls(e,t,s,i){const a=i.target,n=(0,d.domClosest)(Ke,a),o=Number(n.getAttribute("data-msgid")),r=(0,d.domClosest)("im-mess",a),l=Number(r.getAttribute("data-msgid")),c=e.get().peer;o&&!(0,p.isAlreadyDeleted)(e,c,o)?(e.setState({msgid:o}),(0,F.updateLocation)({msgid:o}),(0,p.focusOnMessage)(e,t().focusOnMessage,c,o)):l&&(0,p.showRepliedBox)(e,l,i)}function cs(e){(0,r.checkEvent)(e)||(0,r.cancelEvent)(e)}const ds=new Map;function us(e,t){const s=t.closest(`.${p.AUDIO_MSG_CLASS}`),i=s.querySelector("._msg_asr_empty"),a=t.closest(`.${Ge}`),n=s.id.replace("audmsg",""),o=!!s.closest(".im-mess_fwd"),r=Boolean(s.dataset.asr_done),l=o?0:Number(a?.dataset.msgid),c=!s.classList.contains(nt),d=Number(a?.dataset.peer)||void 0,u=Number(a?.dataset.msgid),_=d&&(0,ie.getMessage)(e,d,u),g=Number(a?.dataset.cmid)||_?.chat_local_id,m="audio_message"+n;if(c){const e=(ds.get(s.id)||0)+1;ds.set(s.id,e),r||((0,_e.recogniseAudioMessage)(l,n),g&&d&&(0,Q.collectVoiceStat)("transcript_loading",d,g,m)),e%3==0&&i?i.innerHTML=function(){const e=oe.getLang("me_voice_asr_status_empty_set").split("|");return e[Math.floor(Math.random()*e.length)]?.trim()}():i&&(i.innerHTML=oe.getLang("me_voice_asr_status_empty"))}c&&!o&&(0,ge.markAudioMessageAsListened)(e,u,d).catch((()=>{})),g&&d&&(0,Q.collectVoiceStat)("transcript_toggle",d,g,m,c,"user"),s.classList.toggle(nt),window.tooltips&&tooltips.destroy(t,{fasthide:!0});if(!t.closest(".audio-msg-player"))return;s.querySelector(".audio-msg-track_player-attached .audio-msg-track--transcriptToggle").classList.toggle("audio-msg-track--transcript_on",t.classList.contains("audio-msg-track--transcript_on"))}function _s(e,t){function s(t,s){const i=s.closest(`.${Ge}`);if(!i)return;const a=s.id.replace("audiomsgpl_","audio_message"),n=Number(i.dataset.peer),o=Number(i.dataset.msgid);if(!n||!o)return;const r=(0,ie.getMessage)(e,n,o),l=Number(i.dataset.cmid)||r?.chat_local_id;switch(t){case"playing":(0,Q.collectVoiceStat)("play",n,l,a);break;case"paused":(0,Q.collectVoiceStat)("pause",n,l,a);break;case"finished":(0,Q.collectVoiceStat)("finish",n,l,a)}}window.AudioMessagePlayer.events.on("listened",(s=>function(e,t,s){const i=t.closest(`.${Ge}`),a=t.closest(".im_fwd_log_wrap");if(!i||a)return;const n=Number(i.dataset.msgid),o=Number(i.dataset.peer);n&&o&&(0,ge.markAudioMessageAsListened)((0,v.unpackStore)(e),n,o).then((()=>{s.markMessageAsListened(e,o,n)})).catch((()=>{}))}(e,s,t()))),window.AudioMessagePlayer.events.on("transcription_toggle",(t=>us(e,t))),window.AudioMessagePlayer.events.on("playing",(e=>{s("playing",e)})),window.AudioMessagePlayer.events.on("paused",(e=>{s("paused",e)})),window.AudioMessagePlayer.events.on("finished",(e=>{s("finished",e)}))}function gs(e){const t=e.target.closest(`.${at}`),s=e.target.closest(`.${p.AUDIO_MSG_CLASS}`);(0,$.showTooltip)(t,{text:s.classList.contains(nt)?oe.getLang("me_voice_asr_toggle_close"):oe.getLang("me_voice_asr_toggle_open"),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[6,12],showdt:400,onHide(){window.tooltips&&tooltips.destroy(t,{fasthide:!0})}})}function ms(e,t,s){const i=s.target.closest("."+p.MESSAGE_KEYBOARD_BUTTON_CLASS),a=s.target.closest("."+p.MESSAGE_STACK_CLASS);if(i){const n=e.sendMessageFromKeyboard.bind(null,(()=>e)),o=(0,h.getActionObjectFromElement)(i),r=a?a.dataset.peer:void 0,l=s.target.closest("."+Ge),c=(0,m.getCurrentTab)(t);if(!l||!c)return;const d=Number(l.dataset.msgid),u=(0,f.parserMessage)(d?c.msgs[d]:c.pinned);if(!u)return;return(0,h.handleButtonClick)(o,n,t,{keyboardAuthorId:r,peerId:u.peerId,message:u,onBeforeSend:()=>{(0,p.setCallbackButtonLoadingState)(i,!0)},onSendSuccess:e=>{const s={timeout:setTimeout((()=>{t.set((t=>(0,ae.unsetPressedCallbackButton)({peerId:u.peerId,eventId:e},t))).then((()=>(0,p.setCallbackButtonLoadingState)(i,!1)))}),h.CALLBACK_TIMEOUT_MS),onCallback:()=>{const e=Number(i.dataset.index);let t;document.contains(i)?t=i:isNaN(e)||(t=(0,p.getCallbackButton)(document,Number(u.messageId),e)),t&&(0,p.setCallbackButtonLoadingState)(t,!1)}};t.set((t=>(0,ae.setPressedCallbackButton)({peerId:u.peerId,eventId:e},s,t)))},onSendFail:e=>{e.error_msg&&(0,h.handleShowSnackbar)({peerId:u.peerId,store:t,text:e.error_msg}),(0,p.setCallbackButtonLoadingState)(i,!1)}})}}function ps(e,t){const s=t.target.closest("."+Qe),i=s.closest("."+Xe),a=s.dataset.type,n=s.dataset.participants,o=n&&n.split(",").reduce(((t,s)=>(+s!==e.get().id&&pe.Ranges.isUserIdTransitional(+s)&&t.push(+s),t)),[]),r=+i.dataset.peer;(0,p.isCallToPeerAvailable)(e,r)&&(0,p.startCallFromIm)(e,r,"video"===a,o,p.CALL_ENTRY_POINT_SNIPPET)}function hs(e,t,s){const i=s.target.closest("."+tt);(0,p.updateMessageEditableStatus)(e,e.get().peer,t,i)}function fs(e,t,s,o,r,l,c,u,h,y,w,C,S,T,k,M,P,A,L,R){let x;const D=(0,v.throttle)((function(...e){s.smoothScroll(...e)}),300);return{fixKeyboard(){r.fixKeyboard()},removeUnpinnedMessageEditable(e,s){const i=t.querySelector(`.${tt}:not(._im_mess_${s}`);i&&(i.classList.remove(tt),(0,p.updateMessageEditableStatus)(e,e.get().peer,t,i))},changePeer(e,i=!0,n=!0){const c=e.get().peer;if((0,a.revertLastInlineVideo)(t),(0,he.popupDestroyByRemoveEventNative)(),h.hideReactionsPanel(),0===c)return window.StickerPickerViewer?.destroy(),k.disable(),r.setDraft(e,null),(0,Z.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,me.loadMarusiaSdk)().then((e=>{e&&(e.stopListening(),e.hide())})),function(e){(0,d.addClass)(e,"im-page--history_empty"),wt(e).innerHTML=""}(t);if(!(0,p.isFullyLoadedTab)(e.get(),c))return;(0,d.removeClass)(t,"im-page--history_search"),o.deselectAll(e),o.changeActions(e),o.showActions(e);const v=(0,m.getCurrentTab)(e),b=e.get().prevPeer;(0,d.removeClass)(t,"im-page--history_loading"),(0,d.toggleClass)(t,"im-page--history_vkcomgroup",(0,p.isFvkcomgroup)(e,c)),i?r.setDraft(e,(0,f.getTabDraft)(v)):r.updateState(e),Dt(e,t),Ot(e,t),this.updateGoToReactionsButton(e,t),l().updateTyping(c,e),Lt(e,0,o),pe.Ranges.isZeroOwner(b)&&!pe.Ranges.isZeroOwner(c)?function(e,t,s,i,a,n,o,r,l,c,u){(0,d.removeClass)(e,"im-page--history_empty"),Ct(e,t,s,i,a,n,o,r,l,c,u)}(t,e,c,s,l,o,u,M,A,n,k):pe.Ranges.isZeroOwner(b)||pe.Ranges.isZeroOwner(c)||Ct(t,e,c,s,l,o,u,M,A,n,k),(0,f.isCasperChat)(e,c)||(k.enable(),k.toggle(!0),k.reset(s)),pe.Ranges.isZeroOwner(c)||setTimeout((()=>{kt(e,l,wt(t),S,k,t,0,s)})),(0,ce.ensureDomHasActions)(t),(0,g.getPeer)(e)===_.VK_OFFICIAL_PEER_ID&&(0,Q.collectOnboardingFindFriendsShowStats)(e.get().viewer_id),r.updateMediaSelectorOptions(e),window.IM&&window.IM.updateHints(c)},preparePeer(e){const s=(0,g.getPeer)(e);is(e),r.setDraft(e,(0,f.getTabDraft)((0,f.getTab)(e,s)),!1),l().updateTyping(s,e),l().hideError(),o.renderPeer(e),M.renderPeer(e),o.hideActions(e),u.changePeer(s,e),Lt(e,0,o),k.toggle(!1),Xt(e,t,!0),Jt(e,t,!0),function(e,t){e.set((e=>(0,i.updateGoToReactionAvailability)(!1,e))),Bt(t)}(e,t)},saveScroll:e=>St(e,s),loadingPeer(e){(0,i.isAnythingLoading)(e.get())||((0,d.removeClass)(t,"im-page--history_empty"),(0,d.addClass)(t,"im-page--history_loading"))},stopLoading(e){(0,d.removeClass)(t,"im-page--history_loading")},deselectDialog(e){c().removeSelection(e)},replaceMessageAttrs(e,s){(0,p.replaceMessageAttrs)(s.get(),wt(t),e),R.update()},cleanSelection(e){y.cleanSelection(e)},updateDialogFilters(e,t){c().updateDialogFilters(e,t)},getSearchResulstModule:()=>x,showSearchResults(e){e?((0,d.removeClass)(t,"im-page--history_search-empty"),wt(t).innerHTML=e):((0,d.addClass)(t,"im-page--history_search-empty"),wt(t).innerHTML=(0,p.renderEmptySearch)())},insertSearch(e,i){x||(o.deselectAll(i),x=(0,I.mount)(t,i,"message_search")),(0,d.addClass)(t,"im-page--history_search"),l().showSearchResults(e),Yt(i,s,t),s.scrollBottom(0),Dt(i,t),Ot(i,t),this.updateGoToReactionsButton(i,t),k.reset(s)},updateChatTopic(e,t){c().updateDialog(e,t),e===t.get().peer&&(o.renderPeer(t),o.renderActions(t),M.renderPeer(t))},updateActions(e){o.changeActions(e)},updateChatPhoto(e,i,a){if((0,p.isPeerActive)(e.peerId,a.get())){o.renderPeer(a),M.renderPeer(a);let n=Ht(s);(0,p.addChatPhotoToUpdate)(e,i,a.get(),wt(t)),n&&s.scrollBottom(ve)}},markImportant(e,s,i){ht(t,e)&&(o.changedMessageSelection(i),h.markImportant(e,s,i))},isNewMessagesVisible:e=>function(e,t){return(0,f.getUnreadScrollBottom)(e)>=(0,W.intval)(t.scrollBottom())}(e,s),loadHistory(e,i,a,n=!1){let o=a.get();if((0,p.isPeerActive)(e,o)){let a=n||o.tabs[e].historyToAppend;if(!a)return;let r=(0,d.geByClass1)("_im_peer_history",t),l=(0,d.domFC)(r),c=s.scrollBottom(),u=i.reversed?e=>r.appendChild(e):e=>r.insertBefore(e,l),_=0;i.reversed&&(_=r.offsetHeight);const g=(0,d.sech)(a),m=document.createDocumentFragment();g.forEach((e=>m.appendChild(e))),u(m),(0,X.initWidgets)(t,e),i.reversed&&k.heightIncreased(r.offsetHeight-_,s),i.reversed||s.scrollBottomFixSave(c),s.update(!1,!0);const p=g.filter((e=>(0,d.hasClass)(e,"_im_bar_date")));k.parseMore(p,s),(0,ce.ensureDomHasActions)(t),R.update()}},sendMessage(e){0!==e.get().peer&&r.sendMessage()},editMessage(e,i){if((0,p.isFullyLoadedTab)(e,i.peerId)&&(0,p.isPeerActive)(i.peerId,e.get())){if(!ht(t,i.messageId))return;St(e,s),(0,p.editAndReplaceMessage)(e.get(),i,t),Et((0,f.getTab)(e,i.peerId),s),o.reRenderPinned(e),k.reset(s),R.update()}},updateMessageReactions(e,s,i){(0,p.replaceMessageReactions)(t,s,i,e)},addMessage(e,a){if(!(0,i.isSearchingInplace)(a.peerId,e.get())&&(0,p.isFullyLoadedTab)(e,a.peerId)&&(0,p.isPeerActive)(a.peerId,e.get())){if(ht(t,a.messageId))return;const n=wt(t);zt(k,n,s,(()=>{const i=Ht(s),o=(0,d.geByClass1)("_im_unread_bar_row",t),[r,c]=(0,p.isMessagesVisible)(e,t,s);(0,ce.appendMessageToHistory)(e.get(),a,n,!0,!r&&!o),(0,d.removeClass)(t,"im-page--history_empty-hist");const u=(0,f.getTab)(e,e.get().peer),_=(0,b.isServiceMsg)(a)&&a.userId===vk.id,g=a.kludges&&a.kludges.source_act,m=_&&g!==p.CHAT_PIN_MESSAGE&&g!==p.CHAT_UNPIN_MESSAGE;u.skipped||r||!(0,b.isUnread)(u,a)||(0,b.isOut)(a)||(Dt(e,t,!0,c),Ot(e,t,0,c)),(a.local||i||m)&&(ct=!0,s.scrollBottom(0)),l().updateTyping(a.peerId,e),Ut(t,e),ns(t)}));let o=(0,d.domPS)((0,d.domLC)(n));if((0,d.hasClass)(o,"_im_bar_date")){let e=(0,d.ce)("div");e.innerHTML=o.outerHTML,k.parseMore(e,s)}l().hideError(),k.update(s),(0,i.updateMentions)(e.get()),rs(e,a.peerId,s.scrollBottom(),0,l),this.updateObserver()}},setMessageErrored(e,s,i,a){i&&"string"==typeof i&&l().showError(i),(0,p.setMessageError)(e,s,t)},markMessagesAsRead(e,s){e.get().peer===s.peerId&&(0,p.markMessagesAsRead)(e.get(),s.peerId,t)},markMessageAsListened(e,s,i){(0,g.getPeer)(e)===s&&(0,p.updateListenedMark)(t,i)},compensateHistoryHeightChange(e){s.scrollTop(s.scrollTop()+e*gt(C))},updateTyping(e,s){if((0,i.isSearchingInplace)(e,s.get()))return;const a=s.get();if(a.peer!==e||!(0,p.isFullyLoadedTab)(a,e))return;let n=(0,p.formatTyper)((0,f.getTab)(s,e).activity,e,!1,a),o=(0,d.geByClass1)(p.TYPING_CLASS,t);if(!o&&!n)return;if(!o){let e=(0,d.geByClass1)(De,t);(0,d.val)(e,(0,W.getTemplate)("im_typing",{cls:(0,p.isClassicInterface)(s)?"im-activity_classic":""})),o=(0,d.geByClass1)(p.TYPING_CLASS,t)}(0,d.val)((0,d.geByClass1)("_im_typing_name",o),n);const r=(0,p.loadSummaryActivityType)((0,f.getTab)(s,e).activity||{})===i.ACTIVITY_TYPE_RECORDING_AUDIO;o.setAttribute("data-activity-type",r?"recording":"typing"),n?((0,d.addClass)(o,"im-page--typing_vis"),l().hideError()):(0,d.removeClass)(o,"im-page--typing_vis")},scrollFix(e,t,i){k.heightIncreased(i,s),k.update(s),(0,p.isPeerActive)(t,e.get())&&Ht(s,i)&&s.scrollBottom(ve)},scrollBottom(){s.scrollBottom(ve)},goToEnd(){Kt((()=>this),C,t,s)},updateGoToEnd(e,i){const a=(0,f.getTab)(e,e.get().peer);a&&(a.skipped||a.unread)?Dt(e,t):Xt(e,t,i),w(0,s,!1);const n=e.get().peer;setTimeout((()=>{e.get().peer===n&&St(e,s)}))},updateGoToMention(e,i){const a=(0,f.getTab)(e,e.get().peer),{mentions:n=[],mention_cmids:o=[]}=a||{},r=(0,Z.partConfigEnabled)("me_web_read_by_cmid")?o[0]:n[0];a&&r?Ot(e,t):Jt(e,t,i),w(0,s,!1);const l=e.get().peer;setTimeout((()=>{e.get().peer===l&&St(e,s)}))},newMessage(e){c().newMessage(e),Xt(e,t,!0),Jt(e,t,!0)},scroll(e,t,i=!1,a=!1){if(0===e.get().peer)return;let n=i?s.getScrollHeight():40;!0===a&&(n=s.contHeight()),n="up"===t?-n:n,i||a?D(n,(()=>{w(n,s)})):(s.scrollTop(s.scrollTop()+n),w(n,s))},showCreation(e,t){c().showCreation(e,t)},updateScroll:()=>Yt(C,s,t),toggleBarDate(e){k.toggle(e)},changedMessageSelection(e){o.changedMessageSelection(e)},updateOnline(e,t){(0,p.isTabLoaded)(t.get(),e)&&e===t.get().peer&&o.renderPeer(t)},isEmpty:e=>r.isEmpty(e),replaceAttachmentPlaceholders(e,i){if((0,p.isPeerActive)(i.peerId,e.get()))zt(k,wt(t),s,(()=>{let a=Ht(s);(0,p.replaceAttaches)(t,i,e.get());let n=(0,f.getTab)(e,i.peerId);if(n.mediacontent[i.messageId].length>=3&&n.mediacontent[i.messageId][2].pinned){let t=(0,f.parserMessage)(n.pinned);t&&t.messageId==i.messageId&&(n.pinned=n.mediacontent[i.messageId][2].pinned,o.reRenderPinned(e))}a&&s.scrollBottom(0)})),k.update(s);else if((0,b.isMoneyRequest)(i)){let t=(0,f.getTab)(e,i.peerId);if(t.mediacontent[i.messageId].length>=3&&t.mediacontent[i.messageId][2].pinned){let e=(0,f.parserMessage)(t.pinned);e&&e.messageId==i.messageId&&(t.pinned=t.mediacontent[i.messageId][2].pinned)}}},replaceBotCarouselPlaceholder(e,i){const a=e.get();(0,p.isPeerActive)(i.peerId,a)&&(zt(k,wt(t),s,(()=>{let e=Ht(s);(0,p.replaceCarousel)(t,i,a),e&&s.scrollBottom(0)})),k.update(s))},removeMessages(e,i,a){a.get().peer===i&&((0,p.removeMessages)(e,wt(t)),(0,p.removeExpiredMessagesStub)(e,wt(t)),Yt(a,s,t),o.changedMessageSelection(a),this.updateObserver())},removeStartingFromMessage(e,i,a){if(a.get().peer===i){const i=wt(t);let n=(0,d.geByClass1)("_im_mess_"+e,i);(0,p.removeStartingFromMessage)(n,i),Yt(a,s,t),o.changedMessageSelection(a)}},hideGoToEnd(e){Xt(C,t,e)},hideGoToMention(e){Jt(C,t,e)},removeMessagesRestore(e,s,i,a){a.get().peer===s&&(0,p.removeMessagesWithRestore)(e,s,i,wt(t))},removeExpiredFailedMessages(e){C.get().peer===e&&C.set(i.removeExpiredFailed.bind(null,wt(t),e))},handleMessageExpiration(e){(0,p.isFullyLoadedTab)(C.get(),e.peerId)&&((0,p.replaceExpiredMessageWithPlaceholder)(C,t,e),(0,p.replaceExpiredRepliedMessageWithPlaceholder)(t,e),r.detachMessages(e))},updateState(e,t){c().updateState(e,t)},updateBanner(e){M.renderPeer(e)},updateHeader(e){o.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(o.changeActions(e),o.renderPeer(e),o.renderActions(e),M.renderPeer(e),r.updateState(e),(0,i.updateMentions)(e.get()))},updateConvoInList(e,t){c().updateConvoInList(e,t)},focustTxt(e){r.focusOn(e)},startSearch(e){e.get().peer&&(l().showSearch(e),u.changePeer(e.get().peer,e),u.search())},showSearch(e){(0,d.addClass)(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),ut(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout((()=>u.focus(e)),10)},cancelSearch(e,a=!0){if(e.get().searchShown&&((0,d.removeClass)(t,"im-page--hisory_search-open"),(0,d.removeClass)(t,"im-page--history_search"),(0,d.removeClass)(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),ut(e)&&this.updateChatTopic(e.get().peer,e),o.changedMessageSelection(e)),a&&!pe.Ranges.isZeroOwner(e.get().peer)&&x){let a=e.get().tabs[e.get().peer];const n=(0,i.strHistory)(a.history);n?wt(t).innerHTML=n:l().showEmptyScreen(),Yt(e,s,t),s.scrollBottom(0),e.get().msgid&&(At(s,t,e.get().msgid,e),Dt(e,t),Ot(e,t)),this.updateGoToReactionsButton(e,t),S(s),k.reset(s)}x&&(x.unmount(),x=!1,(0,ce.ensureDomHasActions)(t))},showEmptyScreen(){const e=(0,d.geByClass1)("_im_peer_history",t);(0,d.addClass)(t,"im-page--history_empty-hist");const s=(0,le.renderHistoryStub)(C);(0,d.val)(e,s)},updateHistory(e){0!==C.get().peer&&e(t)},focusOnMessage(){At(s,t,C.get().msgid,C)},sendEditMessage(e,t){e.set(i.deliverEditedMessage.bind(null,(0,f.getTab)(e,t.peerId),t)).catch((s=>e.get().longpoll.push([(0,O.failedMessage)(t.peerId,t,s)])))},renderStickersPanel(e){const s=(0,g.getPeer)(e),a=(0,f.getTab)(e,s);if(!a||a.block_error&&a.block_error>0)return;const n=(0,i.strHistory)(a.history||""),o=t.querySelector("._im_stickers_panel_placeholder");if(o&&!n){const t=(0,le.prepareEmptyDialogStickersTemplate)(e);if(!t)return;(0,d.domReplaceEl)(o,t)}},deselectAll(e){o.deselectAll(e)},unmount(){(0,E.destroyModule)(e),s.destroy(),clearInterval(T),r.unmount(),o.unmount(),h.unmount(),y.unmount(),u.unmount(),k.unmount(),(0,n.cancelStackFilter)("forward"),P.unmount(),L?.unmount(),R.unmount(),function(e,t){(0,B.removeDraggable)((0,d.geByClass1)(e,t))}("_im_chat_resize_track",t),A.destroy()},removePeer(e,t){c().removePeer(e,t)},restoreScroll(e,t){const i=e.get().tabs[t];i.scrollBottom?Et(i,s):s.scrollBottom(ve)},resendMessage(e,s){e===C.get().peer&&(0,p.startResendMessage)(e,s,t)},resendPeer(){r.resendPeer()},resendAll(){r.resendAll()},respond(e,t){r.attachMessages(e,t),r.focusOn(e);const i=(0,f.getTab)(e,t);i&&!i.skipped&&(s.scrollBottom(ve),S(s))},restoreDialogs(e,t,s){c().restoreDialogs(e,t,s)},cancelRecording(){r.cancelRecording()},flushDraft(e){r.saveText(e)},hideError(){(0,d.geByClass1)(Oe,t).classList.remove(Be)},showError(e){const i=(0,d.geByClass1)(Oe,t);i.innerHTML=e,i.classList.add(Be),s.scrollBottom(ve)},startEditing(e){if((0,i.isAnythingLoading)(C.get()))return void(0,p.showWaitUntilUploadedBox)();e=(0,f.parserMessage)(e);let s=(0,p.getNowEditingMessage)(C);if(r.isBlocked())return;if(s&&s.messageId==e.messageId)return;s&&this.cancelEditing(),ns(t),C.get().searchShown&&this.cancelSearch(C);let a=ht(t,e.messageId);a&&(this.cancelRecording(),function(e,t,s,i,a){e.setState({isEditing:!0}),s.saveText(e),(0,d.addClass)(i,"im-mess_is_editing"),(0,d.addClass)((0,d.geByClass1)("_im_page_history"),"is_msg_editing"),(0,n.cancelStackPush)("cancel_edit",(()=>as(e,t,s,i)));let o=new j.ImDraft;o.dData.txt=(0,H.convertEmojiHtmlToRegularText)(a.text),o.dData.attaches=(0,V.convertKludgesToAttaches)(a.kludges,a.messageId),s.toggleStickers(e,!1),s.setDraft(e,o),setTimeout((()=>s.focusOn(e)),0)}(C,t,r,a,e),r.hideKeyboard(),o.deselectAll(C))},cancelEditing(){let e=(0,p.getNowEditingMessage)(C);e&&as(C,t,r,ht(t,e.messageId))},messageKeyboardButtonClick:e=>ms(r,C,e),getEditingMessage:()=>(0,p.getNowEditingMessage)(C),focusEditingMessage(){let e=(0,p.getNowEditingMessage)(C);e&&At(s,t,e.messageId,C),r.focusOn(C)},setNetworkWaitingStatus(e,t){o.setNetworkWaitingStatus(e,t)},setNetworkReconnectingStatus(e){o.setNetworkReconnectingStatus(e)},clearNetworkStatus(){o.clearNetworkStatus()},updateCasperMessageStatus(e,s=!1){(0,p.isFullyLoadedTab)(C.get(),e.peerId)&&C.set(i.updateCasperMessageExpiringStatus.bind(null,e,s)).then((()=>{C.get().peer===e.peerId&&(0,p.setCasperMessageExpiringStatusDOM)(t,s,e.messageId)}))},updateObserver(){P.update(),L?.update(),R.update()},updateFolderCounters(e){c().updateFolderCounters(e)},renderPeerProfile(e){A.render(e)},destroyPeerProfile(){A.destroy()},updateGoToReactionsButton(e,t){Nt(e,t)}}}function vs(e,t,s,a,n){let c=(0,d.geByClass1)("_im_peer_history_w",e);(0,z.hasAccessibilityMode)()&&(0,d.addClass)(c,"history_a11y");let{callMutations:h,bindMutations:w}=(0,E.createMutations)(fs),I=(e=>{let t=(0,Y.debounce)(e,100),s=(0,v.throttle)(e,100);return e=>{t(e),s(e)}})(St.bind(null,t));const D=(0,x.mount)(t,e);let N=kt.bind(null,t,h,c,I,D,e),F=(0,k.mount)(e,t,h),U=(0,R.createScroll)((0,d.geByClass1)("_im_chat_body_abs",e),{onScroll:(...e)=>{N(...e),(0,Z.partConfigEnabled)("mail_history_mention_popover")&&window.reforgedME&&window.reforgedME.profileInfo&&window.reforgedME.profileInfo.mountProfileInfo(null),(0,Z.partConfigEnabled)("messages_reactions")&&(!ct&&F.hideReactionsPanel(),ct=!1)},nativeScroll:(0,p.isClassicInterface)(t),shadows:!1});const H=(0,p.isClassicInterface)(t)?void 0:U.scroll.container,j=(0,P.mount)(t,H,(e=>function(e,t,s){const a=(0,m.getCurrentTab)(e);if(!a)return;const n=s.reduce(((t,s)=>{if(s.isIntersecting){const i=+s.target.getAttribute("data-msgid")||+s.target.getAttribute("data-last-msgid"),n=(0,f.getMessage)(e,a.peerId,i);i&&n&&!(0,b.isOut)(n)&&t.push(i)}return t}),[]);if(n.length){const s=Math.max(...n);Mt(e,s).then((()=>{s===a.lastmsg&&e.set((e=>(0,i.setActions)(e))).then((()=>t().updateActions(e)))}))}}(t,h,e)),((e,t)=>(0,b.isUnread)(t,e))),V=()=>window.curNotifier?.idle_manager?.is_idle,G=(0,P.mountHistoryMsgsReactionsObserver)(t,H,(()=>Ft(t,e)),(e=>{if(V()||!(0,Z.partConfigEnabled)("messages_reactions"))return;const s=(0,m.getCurrentTab)(t);if(!(s&&(0,m.shouldUseReactionsShortPolling)(s)))return;const i=(0,g.getPeer)(t);t.set((t=>(0,re.updateMessagesReactions)(i,e,t))).then((t=>{e.forEach((e=>{const s=(0,ie.getMessageByCmid)(t,i,e),a=s?.messageId;a&&void 0!==s.kludges.reactions&&h().updateMessageReactions(t,i,a)}))}))}),(i=>{if(V()||!(0,Z.partConfigEnabled)("messages_reactions"))return;const n=(0,g.getPeer)(t),o=(0,g.getGroupId)(t);t.set((e=>{const s=Array.from((0,g.getPendingReadReactionsCmids)(t,n));return(0,ae.setPendingReadReactionsCmids)(n,[...s,...i],e)})).then((t=>{Nt(t,e),s.updateCounter(t,n),(0,p.isClassicInterface)(t)&&a.updateCounter(t,n)})).then((()=>(0,re.markReactionsAsRead)(i,n,o))).then((()=>{const e=Array.from((0,g.getPendingReadReactionsCmids)(t,n)),s=new Set(i),a=e.filter((e=>!s.has(e)));t.set((e=>(0,ae.setPendingReadReactionsCmids)(n,a,e)))}))})),K=(0,g.getLocalSettingsValue)(t,"transcript_auto_show")&&(0,v.unpackStore)(t).isASRSettingHintActive?(0,P.mount)(t,H,(e=>{let s=cur?.imDb?.selectByKey?.("shown_asr_hints")??[];e.forEach((e=>{if(!e.isIntersecting)return;const i=Number(e.target.dataset.msgid||e.target.dataset.lastMsgid);s&&!s.includes(i)&&e.target.querySelector(`.${ot}`)&&(s.length+1<3?s.push(i):(t.set((e=>(e.isASRSettingHintActive=!1,Promise.resolve(e)))),(0,_e.hideHelpHint)("im:transcript_autoshow_setting"),K.unmount(),s=void 0))})),cur?.imDb?.updateByKey?.("shown_asr_hints",s)}),b.isAudioMsg):void 0;let X=(0,C.mount)((0,d.geByClass1)("_im_dialog_header",e),t,h);setTimeout((function(){const s=t.get().peer;if(s){if(is(t),((0,m.getCurrentTab)(t).pinned||(0,m.getCurrentTab)(t).top_banner)&&(h().updateChatTopic(s,t),t.set(i.setActions),X.changeActions(t)),(0,m.getCurrentTab)(t).callInProgress&&h().updateBanner(t),t.get().msgid)At(U,e,t.get().msgid,t);else if(!Pt(U,e,h,t,D)){U.scrollBottom(ve);const e=(0,m.getCurrentTab)(t);(0,p.isTabMarkedUnread)(e)&&t.set((t=>(0,i.markDialogRead)(e.peerId,t)))}t.get().history_init=!1,(0,f.isCasperChat)(t,s)?D.disable():D.reset(U),Dt(t,e),Ot(t,e),kt(t,h,c,I,D,e,0,U),(0,ce.ensureDomHasActions)(e),nav.objLoc.st&&(t.mutate(i.setInplaceSearch.bind(null,nav.objLoc.st,s)),h().startSearch(t)),window.nav.objLoc.open_settings&&(X.showSettings(t),delete window.nav.objLoc.open_settings,window.nav.setLoc(window.nav.objLoc))}else D.disable()}),15);let le=(0,S.mount)((0,d.geByClass1)("_im_text_input",e),t,(0,p.isClassicInterface)(t)?a.updateMenu:void 0,((e,t)=>{s.removeDialog(e,t),s.restoreDialogs(e,!0)}),h),ge=(0,T.mount)((0,d.geByClass1)("_im_dialog_header",e),t,h),me=(0,M.mount)(e,t,(()=>({changedMessageSelection:X.changedMessageSelection})));const he=(0,A.mount)(c);(0,L.mount)(e,t,h);const fe=(0,q.mount)(e,t,(()=>({hidePinned(){(0,L.pinnedMessageHide)(t,t.get().peer,h,!1)},compensateHistoryHeightChange(e){h().compensateHistoryHeightChange(e)},showPinned(){(0,L.pinnedMessageUnHide)(t,t.get().peer,h,!1)},showMessageRequestRejectDialog(t){!function(e,t,s,a,n){const o=oe.getLang("mail_mr_reject_confirmation"),r=(0,J.oCacheGet)(e,n),l=`<div class="checkbox _im_is_spam_checkbox" onclick="checkbox(this);" role="checkbox" aria-checked="false">${oe.getLang("mail_report_as_spam")}</div>`,c=r?r.first_name_gen:"",u=(0,ee.showFastBox)(oe.getLang("mail_message_request_reject_request"),o.replace("{name}",c),oe.getLang("mail_message_request_reject"),(()=>{const o=(0,se.isChecked)((0,d.geByClass1)("_im_is_spam_checkbox"),t),r=o?oe.getLang("mail_message_request_rejected_and_spam"):oe.getLang("mail_message_request_rejected");e.set((e=>(0,i.rejectMessageRequest)(n,o,e))).then((e=>{(0,p.isClassicInterface)(e)&&a.updateMenu(e),s.removeDialog(e,n),s.restoreDialogs(e,!0),n===e.get().peer&&e.get().longpoll.push([(0,O.resetPeer)()]),(0,p.hideAllBoxes)(),(0,te.showNotification)({text:r})})).catch((e=>{(0,p.hideAllBoxes)(),(0,v.showErrorBox)(e)}))}));u.setControlsText(l)}(t,e,s,a,t.get().peer)},showBusinessNotifyDialog:xt})));pe.Ranges.isZeroOwner(t.get().peer)||t.set((e=>(0,de.restoreHistoryQueue)(e,t.get().peer))).then((()=>{(0,de.restoreQueuedMessagesInDom)(t.get(),t.get().peer,wt(e)),bt(e,t,t.get().peer)})),_s(t,h),function(e,t,s){let i,a,n=(0,d.geByClass1)(e,t);(0,B.initDraggable)(n,{onStartDrag:(e,t)=>{(0,d.addClass)(document.body,"cursor_ns_resize"),i=t,a=t},onDrop:()=>{(0,d.removeClass)(document.body,"cursor_ns_resize")},onDrag:(e,n)=>{let o=mt(a-i+n,t);(0,p.setClassicChatHeight)(o),s().fixHeight()}})}("_im_chat_resize_track",e,n);let be=jt.bind(null,t,e,h),ye=Vt.bind(null,t,e,U,h),we=e=>{(0,r.cancelEvent)(e),function(e,t){e().showCreation(t)}(n,t)},Ee=Kt.bind(null,h,t,e,U),Ce=$t.bind(null,h,t,e,U),Se=Wt.bind(null,t,e,U),Te=yt.bind(null,t,e),Ie=p.showEditTimeTooltip.bind(null,t),ke=p.showMessageInfoTooltip.bind(null,t),De=Rt.bind(null,t,be,e,h),Be=vt.bind(null,t,e,U),Ue=es.bind(null,h,t,U),He=ts.bind(null,t),Ye=ss.bind(null,t,h),ze=ls.bind(null,t,h,e),nt=ms.bind(null,le,t);const rt=ft.bind(null,h),lt=p.showCasperExpiringTooltip.bind(null,t,e),dt=()=>(0,l.showWiki)({w:"expired_messages"}),ut=ps.bind(null,t),_t=e=>function(e,t){const s=t.target.closest("."+Je),i=s.closest("."+Xe),a=s.dataset.link,n=+i.dataset.peer;((0,p.isCallToPeerFromSnippetAvailable)(e,n)||(0,p.isCallToPeerAvailable)(e,n))&&(0,p.joinCallFromIm)(e,n,a,!1,p.CALL_ENTRY_POINT_JOIN_SNIPPET)}(t,e),gt=hs.bind(null,t,e),ht=e=>function(e,t){const s=t.target.closest(`.${st}`),i=(0,g.getPeer)(e);if(ne.FlatButton.isLocked(s)||!i)return;const a=e.get().tabs[i].is_subscribed;ne.FlatButton.lock(s),e.set((e=>(0,re.setPeerSubscribedStatus)(i,a,e))).then((e=>{const t=(0,v.unpackStore)(e),a=t.tabs[i].is_subscribed,n=t.tabs[i].is_subscribed_to_me,o=t.tabs[i].is_subscribe_button;if(a&&n)return void(s.style.display="none");let r="";o&&a&&!n&&(r=oe.getLang("mail_you_are_following")),!o||n||a||(r=oe.getLang("mail_follow_to_friend")),o||!a||n||(r=oe.getLang("mail_friend_request_sent")),o||a||(r=oe.getLang("mail_add_to_friends"));const l=a?ne.FlatButtonAppearance.SECONDARY:ne.FlatButtonAppearance.PRIMARY;ne.FlatButton.unlock(s),ne.FlatButton.setAppearance(s,l),ne.FlatButton.setLabel(s,r)})).catch((e=>{17===e?.error?.error_code&&(0,te.showNotification)({title:oe.getLang("mail_changes_cant_be_applied"),text:oe.getLang("mail_not_confirmed_phone")}),ne.FlatButton.unlock(s)}))}(t,e),Et=e=>{const t=(0,d.domClosest)(it,e.target);if(!t)return;const s=(0,d.domClosest)(p.MESSAGE_STACK_CLASS,t),i=parseInt((0,d.domData)(s,"peer"),10)||null;window.reforgedME&&window.reforgedME.profileInfo&&i&&window.reforgedME.profileInfo.mountProfileInfo({peerId:i,targetElement:t})},Ct=(0,E.createModule)({handlers:(s,a)=>{a(e,"click",p.RESTORE_CLASS,ye),a(e,"mouseover click",p.FAILED_CLASS,Te),a(e,"mouseover","_im_edit_time",Ie),a(e,"mouseover","_im_page_info",ke),a(e,"click","_im_mess_susp",pt.bind(null,e)),a(e,"click",Le,De),a(e,"click",Re,Be),a(e,"mouseover",xe,Zt),a(e,"mouseover",je,He),a(e,"mouseover",We,lt),a(e,"mouseover",et,(e=>function(e,t){const s=e.target.dataset.mention;let i=null;switch(!0){case _.MASS_MENTION_ALIASES.all.includes(s):i=oe.getLang("mail_im_mention_all");break;case _.MASS_MENTION_ALIASES.online.includes(s):i=oe.getLang("mail_im_mention_online")}i&&(window.tooltips&&window.tooltips.destroy(e.target),(0,$.showTooltip)(e.target,{shift:[0,5],center:!0,black:1,className:"im-mass-mention-tt",reverseOffset:!0,toup:e.target.getBoundingClientRect().top>(0,p.getHistoryTopIndent)(t)+37,text:i,noZIndex:!0}))}(e,t))),a(e,"mouseover",tt,gt),a(e,"mouseover",at,gs),a(e,"click",p.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON,p.onASRCollapseToggleClick),a(e,"click",ot,(()=>{n().openSettings()})),a(e,"click",Ve,Ye),a(e,"click",Oe,rt),a(e,"click",Ke,ze),a(e,"click",$e,cs),a(e,"click",qe,((e,s)=>{if((0,r.checkEvent)(e))return!0;if(!(0,d.gpeByClass)("wall_postlink_preview_btn",e.target)&&!(0,d.hasClass)(e.target,"wall_postlink_preview_btn"))return!0;const a=(0,d.geByClass1)("flat_button",s),n={invite_chat_id:(0,d.domData)(a,"inv-id"),invite_hash:(0,d.domData)(a,"hash")};(0,p.showInvitationBox)(t,n,i.leaveInvitation),(0,r.cancelEvent)(e)})),a(e,"click",p.JOIN_CALL_BY_LINK_CLASS,p.handleCallLinkClick),a(e,"click",Ne,(()=>t.get().longpoll.push([(0,O.resetPeer)()]))),a(e,"click",Fe,(e=>function(e,t,s){const a=e.get(),n=(0,d.domClosest)(Ge,s.target),o=(0,d.domData)(n,"msgid"),r=(0,f.getMessage)(a,a.peer,o),l=e=>t().replaceAttachmentPlaceholders(e,r);r&&((0,u.statlogsSendingRetry)("retry_attach"),e.set(i.addAttachmentsToStoreData.bind(null,r,[(0,ue.renderMessageMedia)(a,r)])).then(l),e.set(i.loadMedia.bind(null,r)).then(l))}(t,h,e))),a(e,"click",p.MESSAGE_KEYBOARD_BUTTON_CLASS,nt),a(e,"click",Qe,ut),a(e,"click",Je,_t),s((0,d.geByClass1)("_im_peer_history_w",e),"mousemove",D.show),s((0,d.geByClass1)("_im_start_new",e),"click",we),s(e.querySelector(Me),"click",Ee),s(e.querySelector(Pe),"click",Ce),s(e.querySelector(Ae),"click",Se),a(e,"click",st,ht),s((0,d.geByClass1)("_im_cancel_edit",e),"click",(()=>(h().cancelEditing(),!1))),s((0,d.geByClass1)("_im_edit_focus_cur",e),"click",(()=>(h().focusEditingMessage(),!1))),y.screenfull.raw&&s(document,y.screenfull.raw.fullscreenchange,Ue),s(window,"im_goToMessage",(e=>{const s=(0,W.intval)(e.msgid);if(s)return(0,o.statlogsValueEvent)("im_links_to_attachments",1,"to_message"),t.set(i.changePeer.bind(null,e.sel,s,!1)).then((()=>(0,p.focusOnMessage)(t,h().focusOnMessage,t.get().peer,s)))})),a(e,"click",Ze,dt),(0,Z.partConfigEnabled)("mail_history_mention_popover")&&a(e,"mouseover",it,Et)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?(0,L.pinnedMessageHide)(t,e.peer,h,!1):(0,L.pinnedMessageUnHide)(t,e.peer,h,!1)}],window.showForwardBox=e=>function(e,t){(0,p.applyMessageHandlers)((0,ee.showBox)("al_im.php",t,{params:{width:638,bodyStyle:"padding: 0px",containerClass:"im-show-message-box"}},{}),e)}(t,e),window.showUnsafeDocModal=os;let Tt=setInterval(Lt.bind(null,t,e,X),1e4);(0,g.getPeer)(t)===_.VK_OFFICIAL_PEER_ID&&(0,Q.collectOnboardingFindFriendsShowStats)(t.get().viewer_id);const It=(0,g.getPeer)(t),Bt=(0,f.getTab)(t,It);return Bt&&(0,m.tabIsMessageRequest)(Bt)&&(0,Q.collectOpenMessageRequestStats)(It),w(Ct,e,U,X,le,h,n,ge,F,me,N,t,I,Tt,D,fe,j,he,K,G)}},572148:(e,t,s)=>{"use strict";s.d(t,{mount:()=>I});var i=s(365485),a=s(723561),n=s(610989),o=s(879007),r=s(452314),l=s(317412),c=s(248782),d=s(948350),u=s(577271);const _="im_hist_search",g="_im_search_date",m="_im_search_date_input",p="_im_search_history_input",h="_im_start_inplace_search",f="_im_cancel_inplace_search",v="_im_clear_date";function b(e,t,s,n,o,r){return{focus(e){uiSearch.focus(t),function(e,t,s,i){(0,a.cancelStackPush)(_,S.bind(null,e,t,s,i))}(e,t,s,n)},changePeer(e,s){uiSearch.getFieldEl(t).value=s.get().tabs[e].searchText||""},search(){r({})},unmount(){(0,i.destroyModule)(o),(0,a.cancelStackFilter)(_),n.then((e=>e.destroy()))}}}function y(e,t,s,i){e.set(d.setCurrentSearchDate.bind(null,e.get().peer,`${i.d}.${i.m}.${i.y}`)).then(E.bind(null,e,t,s))}function w(e,t){e.then((e=>{(0,l.triggerEvent)((0,r.geByClass1)("datepicker_control",t),"mousedown",!1,!0)}))}function E(e,t,s){let i=e.get().peer;uiSearch.showProgress(s),(0,d.searchMessagesInplace)(i,e.get()).then((i=>{uiSearch.hideProgress(s),t().insertSearch(i,e),(0,u.updateCounters)(location.href,document.referrer)})).catch((()=>{uiSearch.focus(s),uiSearch.hideProgress(s)}))}function C(e,t,s,i,a,n){if("keyup"===n.type&&13!=n.which)return;let r=(0,o.clean)(uiSearch.getFieldEl(t).value);e.set(d.setCurrentSearch.bind(null,r,e.get().peer)).then(a.bind(null,e,i,t))}function S(e,t,s,i){(0,a.cancelStackFilter)(_),i.then((e=>{e.hide()})),e.set(d.cancelSearch.bind(null,e.get().peer)).then((()=>{uiSearch.getFieldEl(t).value="",s().cancelSearch(e)}))}function T(e,t,s,i){s.then((e=>{e.hide()})),e.set(d.clearDate.bind(null,e.get().peer)).then(E.bind(null,e,t,i))}function I(e,t,s){let a=(0,r.geByClass1)(m,e),o=(0,r.geByClass1)(p,e),l=function(e,t,s,i){let a='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+n.getLang("wall_clear_date_filter")+"</button></td>";return new Promise((e=>{window.stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){let t=new Datepicker(s,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+a+"</tr>",addRowsM:'<tr id="im_month_clear">'+a+"</tr>",onUpdate:i,pastActive:!0,noFuture:!0});e(t)}))}))}(0,0,a,y.bind(null,t,s,o)),d=w.bind(null,l,e),u=C.bind(null,t,o,a,s,(0,c.debounce)(E,300)),_=S.bind(null,t,o,s,l),I=T.bind(null,t,s,l,o);const k=(0,i.createModule)({handlers:(t,s)=>{t((0,r.geByClass1)(g,e),"click",d),t(uiSearch.getFieldEl(o),"keyup",u),t((0,r.geByClass1)(h,e),"click",u),t((0,r.geByClass1)(f,e),"click",_),s(e,"click",v,I)}});return b(0,o,s,l,k,u)}},808288:(e,t,s)=>{"use strict";s.d(t,{mount:()=>se});var i=s(948350),a=s(610989),n=s(879007),o=s(452314),r=s(317412),l=s(583790),c=s(510575),d=s(693143),u=s(365485),_=s(471424),g=s(810903),m=s(20025),p=s(891911),h=s(712178),f=s(908081),v=s(660546),b=s(485413),y=s(520581),w=s(52554),E=s(205184),C=s(476726),S=s(39087),T=s(531868);const I="_im_mess_fav",k="_im_mess_reply",M="_im_mess_forward",P="_im_mess_edit",A="_im_mess_reaction",L="_im_reaction_panel",R="_im_reactions_panel_item",x="im-mess_reacting",D="_im_message_reaction",O="_im_message_reactions_modal",B="_im_message_unknown_reaction",N=16,F=(0,C.partConfigEnabled)("messages_reactions_panel_on_hover");let U=0;function H(e,t,s,i,a){const n=(0,l.getHistoryTopIndent)(e);(0,g.showTooltip)(t,{shift:[s,10],black:1,className:"_im_history_tooltip "+i,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>n+37,text:a})}function j(e,t,s){const a=(0,o.gpeByClass)("_im_mess",s),r=(0,n.intval)((0,o.domData)(a,"msgid")),l=e.get().peer,u=(0,d.getMessage)(e,l,r),_=!(0,c.isImportant)(u);return e.get().longpoll.push([{peerId:l,messageId:r,type:_?p.SET_FLAGS:p.RESET_FLAGS,flags:p.FLAG_IMPORTANT}]),e.set(i.favMessage.bind(null,[r],_,l)),V(e,-10,t,s,!0),!1}function V(e,t,s,i,n){F&&U>0&&J();const r=(0,o.domData)((0,o.gpeByClass)("_im_mess",i),"msgid"),l=(0,d.getMessage)(e,e.get().peer,r),u=a.getLang("mail_im_unmark_important"),_=a.getLang("mail_im_toggle_important"),g=l?(0,c.isImportant)(l)?u:_:"",m=g.length>16;n&&window.tooltips&&tooltips.destroy(i),H(e,i,m?84:34,m?"im-star-tt_long":"im-star-tt",g)}function q(e,t){const s=e.get().peer,a=+(0,o.domData)((0,o.domClosest)("im-mess",t.target),"msgid");if((0,l.canForwardMessages)(e,[a]))return(0,_.statlogsForwardFromChannel)(),(0,i.processFwd)([a],s,e).then((t=>e.set(i.prepareForward.bind(null,t)))).then((()=>{(0,h.mount)(e)})),!1}function G(e,t,s){const a=e.get().peer,n=+(0,o.domData)((0,o.domClosest)("im-mess",s.target),"msgid");return(0,i.processFwd)([n],a,e).then((t=>e.set(i.forwardMessages.bind(null,t,e.get().tfdraft,!0)))).then((()=>t().respond(e,a))),!1}function K(e,t,s,i){F&&U>0&&J(),H(e,i,18,"im-reply-tt",a.getLang("mail_im_mark_forward"))}function $(e,t,s,i){F&&U>0&&J(),H(e,i,18,"im-reply-tt",a.getLang("mail_im_reply"))}function W(e,t,s,i){let a=(0,n.intval)((0,o.domData)((0,o.gpeByClass)("_im_mess",i),"msgid")),r=(0,d.getMessage)(e,e.get().peer,a);return r&&t().startEditing(r),!1}function Y(e,t,s){F&&U>0&&J(),H(e,s,18,"im-edit-tt",a.getLang("mail_im_edit"))}function z(e,t,s){(0,r.cancelEvent)(s);const i=new m.MessageBox({title:a.getLang("mail_unknown_reaction")});return i.content(a.getLang("mail_unknown_reaction_warning")).setButtons(a.getLang("global_continue"),i.hide).show(),!1}function Z(e,t,s,i){const a=i.closest("._im_mess");if(!a)return!1;const n=Number(a.dataset.cmid);return!!n&&((0,f.mount)(e,n),!1)}function Q(e,t,s,i){const a=i.closest("._im_mess");if(!a)return!1;const n=(0,l.getHistoryTopIndent)(e),r=Number(a.dataset.cmid);if(F){if(U===r)return!1;J()}else{if(U===r)return J(),!1;U>0&&J()}const c=(0,b.unpackStore)(e);if(!c.reactions)return;const d=(0,w.getPeer)(e),u=(0,E.getMessageByCmid)(e,d,r),_=(0,E.getMyReaction)(e,d,r);let g=[...c.reactions.values()];if(u?.kludges?.reactions&&u.kludges.reactions.length>=N){const e=u.kludges.reactions.map((e=>e.reaction_id));g=g.filter((({id:t})=>e.includes(t)))}const m=(0,v.renderReactionsPanel)(g,_),p=(0,o.se)(m),h=a.offsetWidth-i.offsetLeft-i.offsetWidth-i.offsetWidth/2;return p.style.setProperty("--right-offset",`${h}px`),i.parentElement.after(p),U=r,F||a.classList.add(x),p.getBoundingClientRect().top<n+30&&p.classList.add("MessageReactionsPanel--bottom"),setTimeout((()=>{document.addEventListener("click",J)})),!1}function X(e,t,s){if(U>0)return;const i=a.getLang("mail_im_set_reaction"),n=i.length>16;H(e,s,n?98:48,n?"im-reaction-tt":"im-reaction-long-tt",i)}function J(e){if(0===U||e?.target.closest(`.${L}`))return;U=0;const t=document.querySelector(`.${L}`);if(!t)return;const s=t.closest("._im_mess");s?.classList.remove(x),t.remove(),document.removeEventListener("click",J)}function ee(e,t,s){const i=s.target.closest(`.${R}`);return i&&te(e,t,s,i),!1}function te(e,t,s,i){const a=i.closest("._im_mess"),n=(0,w.getPeer)(e),o=(0,T.getTab)(e,n);if(!n||!a||!o)return!1;const r=Number(a.dataset.cmid),l=Number(i.dataset.id),c=(0,E.getMyReaction)(e,n,r),d=Number(a.dataset.msgid),u=c===l,_=(0,w.getGroupId)(e),g=u?e=>(0,S.removeMessageReactionOptimistic)(n,d,c,e):e=>(c?(0,S.removeMessageReactionOptimistic)(n,d,c,e):Promise.resolve(e)).then((e=>(0,S.addMessageReactionOptimistic)(n,d,l,e))),m=o.scrollBottom;return e.set((e=>g(e))).then((e=>t().updateMessageReactions(e,n,d))).then((()=>{0===m&&t().scrollBottom()})).then((()=>(0,y.changeMessageReaction)(n,r,l,c,_))),J(),!1}function se(e,t,s){const i=V.bind(null,t,0),a=j.bind(null,t),n=K.bind(null,t,0),o=q.bind(null,t),r=$.bind(null,t,0),c=G.bind(null,t,s),d=Y.bind(null,t),_=W.bind(null,t,s),g=X.bind(null,t),m=Q.bind(null,t,s),p=ee.bind(null,t,s),h=te.bind(null,t,s),f=z.bind(null,t,s),v=Z.bind(null,t,s),b=(0,u.createModule)({handlers:(t,s)=>{s(e,"click",I,a),s(e,"mouseover",I,i),s(e,"click",M,o),s(e,"mouseover",M,n),s(e,"click",k,c),s(e,"mouseover",k,r),s(e,"click",P,_),s(e,"mouseover",P,d),s(e,"click",B,f),s(e,"click",L,p),s(e,"click",D,h),s(e,"click",O,v),F?s(e,"mouseover",A,m):(s(e,"click",A,m),s(e,"mouseover",A,g))}});return function(e,t){return{markImportant(t,s){(0,l.updateStar)(t,s,e)},unmount(){(0,u.destroyModule)(t)},hideReactionsPanel(){J()}}}(e,b)}},642995:(e,t,s)=>{"use strict";s.d(t,{mount:()=>h});var i=s(945154),a=s(714209),n=s(879007),o=s(317412),r=s(948350),l=s(583790),c=s(958145),d=s(485413),u=s(365485);function _(e){return e.which||e.keyCode}function g(e,t,s){!s||(0,n.inArray)(_(s),i.UNPRINTABLE_KEYS)||(0,r.isSearchingInplace)(e.get().peer,e.get())||(0,l.isEditableFocused)()||s.ctrlKey||a.browser.mac&&s.metaKey||s.key&&1!==s.key.length||t.signal("printable",s)}function m(e,t,s){_(s)===i.ENTER&&e.signal(_(s),s)}function p(e,t,s,r){const d=_(r);if(!layers.visible){if(d>=49&&d<=57&&(r.ctrlKey||r.metaKey&&a.browser.mac)&&(0,l.isClassicInterface)(t))return function(e,t){const s=e.get().tabbedPeers[t];s&&e.get().longpoll.push([(0,c.changePeer)(s.peer,!1,!0,!0,"right_menu")])}(t,d-49),(0,o.cancelEvent)(r);(0,n.inArray)(d,i.UP_DOWN_CONTROLS)&&e.signal(d,r)}}function h(e,t){const s=a.browser.mozilla?"keydown":"keypress",i=(0,d.default)({signalTimer:!1}),n=g.bind(null,e,t),o=p.bind(null,t,e,i),r=m.bind(null,t,i),l=(0,u.createModule)({handlers:e=>{e(document,"keydown",o),e(document,"keyup",r),e(document,s,n)}});return{unmount(){(0,u.destroyModule)(l)}}}},180690:(e,t,s)=>{"use strict";s.d(t,{mount:()=>Xe});var i=s(486923),a=s(714209),n=s(839094),o=s(723561),r=s(610989),l=s(7144),c=s(317412),d=s(850101),u=s(879007),_=s(411953),g=s(452314),m=s(465094),p=s(300909),h=s(429061),f=s(111796),v=s(525057),b=s(474831),y=s(950353),w=s(814402),E=s(846210),C=s(617923),S=s(365485),T=s(418368),I=s(637634),k=s(891911),M=s(357854),P=s(860404),A=s(491677),L=s(331619),R=s(368759),x=s(507035),D=s(693143),O=s(510575),B=s(948350),N=s(471424),F=s(583790),U=s(945154),H=s(702598),j=s(642995),V=s(406760),q=s(719451),G=s(746217),K=s(264872),$=s(248782),W=s(476726),Y=s(414299),z=s(958145),Z=s(533243),Q=s(659557),X=s(531868),J=s(52554),ee=s(349333),te=s(891379),se=s(743207),ie=s(628180),ae=s(520581),ne=s(39087),oe=s(256756),re=s(822317),le=s(911575),ce=s(660546),de=s(681009),ue=s(205184),_e=s(459373),ge=s(474325),me=s(922201),pe=s(699615),he=s(598824),fe=s(487867),ve=s(201193),be=s(201683),ye=s(390964),we=s(388078),Ee=s(434487);const Ce=30,Se=400,Te=250;function Ie(e,t,s,i,n){const o=new Map,r=new Map,l=new Map;for(const t of n){o.has(t.peerId)||o.set(t.peerId,new Set),o.get(t.peerId).add(t.messageId);const s=(0,D.getMessage)(e,t.peerId,t.messageId);s&&r.set(t.messageId,s.chat_local_id),l.set(t.messageId,t)}o.forEach(((n,o)=>{const c=[...n],d=(0,D.getTab)(e,o),u=d&&!d.offset,_=d&&d.inplaceSearch&&!!d.searchOffset;e.set(B.removeMessages.bind(null,c,o)).then((()=>e.set(B.removeMessagesMarkDeleted.bind(null,c,o)))).then((()=>{if(e.get().peer===+o&&(0,F.isFullyLoadedTab)(e.get(),o)){const s=(0,D.getTab)(e,o);t.removeMessages(c,+o,e);const i=s.inplaceSearch;if(!s.offset&&!u&&((0,B.setActions)(e.get()),t.updateActions(e),i||t.showEmptyScreen()),i&&_&&!s.searchOffset&&(t.showSearchResults(),a.browser.safari)){const e=(0,g.geByClass1)("_im_peer_history_w");e.style.display="none",setTimeout((()=>e.style.display=""),0)}}})).then((()=>{const a=(0,D.getTab)(e,o);if(!a)return;const n=c.some((e=>e>=a.lastmsg)),d=(0,W.partConfigEnabled)("me_web_read_by_cmid")?c.filter((e=>{const t=r.get(e);return t&&t>a.in_up_to_cmid&&!(l.get(e).flags&k.FLAG_OUTBOUND)})):c.filter((e=>e>a.in_up_to&&!(l.get(e).flags&k.FLAG_OUTBOUND)));n?(0,B.loadActualLastMessage)(e,+o).then((()=>{s.promoteDialog(e,o),i&&i.updateCounter(e,o),o===(0,J.getPeer)(e)&&(t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0))})):d&&(0,Z.removeDeletedUnreadMsgsFromTab)(o,d,e.get()).then((()=>s.updateDialog(o,e)))}))}))}function ke(e,t){"spam"===t?(0,F.showSpamLayer)(e,P.mount,{}):"fav"===t&&(0,F.showFavvedBox)(e,{},H.mount,{})}function Me(e,t,s,i,a){e.forEach((e=>{switch(e.kludges.source_act){case F.CHAT_PHOTO_REMOVE:case F.CHAT_PHOTO_UPDATE:!function(e,t,s,i){t.set(B.updateChatPhoto.bind(null,e)).then((()=>{let a=e.kludges.source_act;s.updateDialog(e.peerId,t),i.updateChatPhoto(e,a,t)}))}(e,t,s,i)}}))}function Pe(e,t){const s=e.get().longpoll.push.bind(null,[(0,z.resetPeer)()]),i=()=>{const a=e.get().selectedMessages;a&&a.length?(e.setState({selectedMessages:[]}).then((()=>{t.changedMessageSelection(e),t.cleanSelection(a)})),setTimeout((()=>(0,o.cancelStackPush)("im_peer",i)),0)):s()};(0,o.cancelStackPush)("im_peer",i)}async function Ae(e,t){if("event_add_message"!==t.type&&"event_edit_message"!==t.type)return!1;try{const{id:s,tabs:i}=e.get();if(!(0,X.tabIsArchived)(i[t.peerId]))return!1;const a=t.kludges?.marked_users??[],n=Object.values(ve.MASS_MENTION_ALIASES).flat();if(!a.some((([e,t])=>{if(e!==be.MARKED_TYPE.MENTIONS)return!1;return Array.isArray(t)&&t.includes(s)||n.includes(t)})))return!1;if((0,X.isMutedConvo)(e.get(),t.peerId))return!0;const{messages_auto_unarchive:o=!1}=await(0,_.getInfo)();return!o}catch(e){return console.error(e),!1}}function Le(e,t){e.set((e=>(0,ee.setLocalSettingsValue)("archives_folder_hidden",null,e))).then((s=>(cur.imDb.updateByKey("archives_folder_hidden",null),(0,F.isClassicInterface)(e)||t.updateFolderCounters(e),(0,le.toggleHideFolderHandler)((0,x.unpackStore)(s),"archive",!1,!0))))}function Re(e,t,s=null){const i=(0,x.unpackStore)(e),a=i?.tabs?.[t]?.mention_cmids??[];if(!a.length)return;const n=s||Math.max(...a);cur.imDb.updateByKey("archive-mentions-map",{...cur.imDb.selectByKey("archive-mentions-map")||{},[t]:n}),e.set((e=>(Array.isArray(e.archiveMentionsMap)&&(e.archiveMentionsMap={}),e.archiveMentionsMap[t]=n,Promise.resolve(e))))}function xe(e){let t=e.attaches.filter((e=>"sticker"!==e.type&&"call"!==e.type));return(0,O.isServiceMsg)(e)||0===t.length}function De(e,t,s){(0,g.addClass)(s,"im-page_history-show"),t.loadingPeer(e)}function Oe(e,t){let s=(0,F.getRightMenuMaxItems)(e,t.offsetHeight);if(e.get().tabbedPeers.length>s){const t=e.get().tabbedPeers.filter((({peer:t})=>(0,u.intval)(t)!==e.get().peer)).map((({peer:t})=>e.get().tabs[t])).sort(((e,t)=>t.last_touched-e.last_touched));let i=[];0!==e.get().peer&&i.push(e.get().tabs[e.get().peer]);const a=i.concat(t).slice(s).map((e=>e.peerId)),n=e.get().tabbedPeers.filter((e=>!(0,u.inArray)(e.peer,a)));return e.set(B.updateTabbedPeers.bind(null,n,!0))}return Promise.resolve(e)}function Be(){let e=(0,d.curBox)();for(;e;)e.hide(),e=(0,d.curBox)()}function Ne(e,t,s,i,a,n,r,l,c){e.get().audio_msg.isRecording&&e.set(B.cancelRecording).then((()=>{i.cancelRecording()})),AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),(0,D.isAnyMessageBeingEdited)(e)&&i.cancelEditing(),(0,D.isSearching)(e)&&t.cancelSearch&&(a.clearSearch(e),s.restoreDialogs(e),c().toggleSettingsButton(e,!1)),Fe(e,l,c),De(e,i,n);let d=e.get().peer;(0,B.updateMentions)(e.get()),(0,F.isFullyLoadedTab)(e,t.peerId)&&(t.msgid&&!(0,D.getMessage)(e,t.peerId,t.msgid)||!t.msgid&&!(0,D.getMessage)(e,t.peerId,(0,D.getTab)(e,t.peerId).lastmsg)||(0,D.getTab)(e,t.peerId).skipped)&&e.mutate((e=>(0,D.makeTabNotFullyLoaded)(e,t.peerId)));let u=e.set(B.changePeer.bind(null,t.peerId,t.msgid,t.entryPoint)).then((e=>{const s=e.get();return s.tabs[t.peerId]?Promise.resolve(s):e.set((()=>(0,le.loadPeer)(s,t.peerId,t.msgid,!0,!1,"applyPeer")))})).then((()=>{if(s.selectPeer(t.msgid,e),function(e,t){(0,F.isPendingForward)(e)&&((0,o.cancelStackFilter)("forward"),e.set(B.forwardMessages.bind(null,e.get().pendingForward,(0,D.getTabDraft)((0,D.getTab)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),Be(),i.preparePeer(e),Pe(e,i),(0,F.isClassicInterface)(e)?(s.deactivate(),Oe(e,n).then((()=>r.updateMenu(e))),(0,oe.updateFolderCounters)(e)):s.updateFolderCounters(e),!(0,F.isClassicInterface)(e)&&(0,X.isRecommendedConvo)(e,t.peerId)&&we.Ranges.isUserIdTransitional(t.peerId)&&!we.Ranges.isContactId(t.peerId)){const i=((0,D.getTab)(e,t.peerId)||{}).online||0,{is_online:a,is_mobile:n}=(0,F.convertLegacyOnlineToAPIFlags)(i);e.set((e=>(0,Z.updateRecommendedListItemOnline)(e,t.peerId,a,n))).then((e=>{s.updateRecommendedOnline(t.peerId,e)}))}}));return u=t.msgid?u.then((()=>e.set(B.selectPeerOnMessage.bind(null,t.peerId===d,d)))):u.then((()=>e.set((e=>(0,B.selectPeer)(!0,e))))),u.then((()=>e.set(B.prepareCasperMessagesFromMessages.bind(null,t.peerId)))).then((()=>{if(e.get().peer===t.peerId){if(t.forward){const s=e.get().tabs[e.get().peer];!s.scrollBottom&&s.unread?e.set(B.setActions).then((()=>i.updateActions(e))):!s.unread&&(0,D.isTabMarkedUnread)(s)&&e.set((e=>(0,B.markDialogRead)(t.peerId,e)))}(0,F.isClassicInterface)(e)&&r.updateMenu(e),i.changePeer(e,!1),i.updateTyping(t.peerId,e),i.removeExpiredFailedMessages(t.peerId),i.updateObserver(),(0,B.updateMentions)(e.get())}})).catch(ge.dummyCatch)}function Fe(e,t,s){t&&e.get().shown&&(t.hide(e),s().createCanceled(e))}function Ue(e,t,s){(0,D.isSearching)(e)&&(t.clearSearch(e),s.restoreDialogs(e))}function He(e,t,s,i,a,n,o){e.setState({isCreating:!0}),(0,F.isClassicInterface)(e)&&(a.saveScroll(e),n.saveScroll(e)),i.showCancelControl(),(0,g.addClass)(o,"im-page_creating"),s&&s.show(e,t),(0,F.isClassicInterface)(e)&&((0,g.setStyle)(o,{height:Ye(o,e).page}),setTimeout((function(){(0,g.addClass)(o,"im-page_cropped")}),200)),(0,B.toggleConversation)(!0)}function je(e,t,s,i){(0,F.isTabLoaded)(e.get(),i)&&(t.updateTyping(i,e),s.updateTyping(i,e))}function Ve(e,t,s,i,a){i.activityType||(i.activityType=a);const n=e=>je(e,t,s,i.peerId);(0,F.isSelfMessage)(i.peerId,e.get().gid)||(e.set(B.setActivity.bind(null,i,a)).then(n),e.set(B.waitActivity.bind(null,i,a)).then(n))}function qe(e,t,s){const i=(0,D.getTab)(s,(0,X.getCurrentTab)(s));if(!i||(0,X.isBusinessNotifyTab)(i))return;const a="im-page_reconnecting";t?e.classList.add(a):e.classList.remove(a)}function Ge(e,t,s,i,a){if((0,D.isMessageRequestChangedEvent)(t))return void function(e,t,s,i){const a=(0,X.getCurrentTab)(e);switch(t.updateType){case k.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED:a&&a.peerId===t.updateArg&&e.get().longpoll.push([(0,z.changePeer)(t.peerId,!1,!1,!1,e.get().currentEntryPoint)]),e.set((e=>(0,B.deletedDialog)(t.updateArg,Promise.resolve([]),e))).then((()=>{s().removePeer(e,t.updateArg),s().updateDialogFilters(e)}));break;case k.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:{const n=(0,D.getTab)(e,t.peerId);(!(0,W.partConfigEnabled)("simplified_start_conversation")||n&&(0,X.tabIsNotImportantMessageRequest)(n)?e.set((e=>(0,B.updateMessageRequestsCounter)(t,e))):e.set((e=>Promise.resolve(e)))).then((()=>{n&&t.updateArg===k.MESSAGE_REQUEST_STATUS_REJECTED&&(0,Z.updateListedConvos)(e.get(),n,!0,(e=>e.filter((e=>e!==Number(t.peerId)))))})).then((()=>{(0,F.isClassicInterface)(e)?(0,oe.updateFolderCounters)(e):i.updateFolderCounters(e),(0,F.checkMessageRequestsTab)(e,i.update),k.MESSAGE_REQUEST_STATUS_ACCEPTED===t.updateArg&&(0,F.isClassicInterface)(e)&&s().updateMenu(e),k.MESSAGE_REQUEST_STATUS_REJECTED===t.updateArg&&0===e.get().dialog_tabs[U.FOLDER_MESSAGE_REQUEST].length&&(0,D.isMessageRequestFolder)(e)&&e.get().longpoll.push([(0,z.changeTab)(U.FOLDER_ALL)]),k.MESSAGE_REQUEST_STATUS_ACCEPTED===t.updateArg&&a?.peerId===t.peerId&&e.set((()=>(0,B.syncMessageReactStatus)(e,t.peerId)))}))}}}(e,t,s,a);if((0,D.isBusinessNotifyChangedEvent)(t))return void function(e,t,s,i){const a=e.set((e=>(0,Z.resetFolderList)(e,re.ConvoListFolder.BUSINESS_NOTIFY)));e.get().active_tab===re.ConvoListFolder.BUSINESS_NOTIFY&&a.then((()=>e.set(B.loadDialogs))).then((()=>s().restoreDialogs(e,!0,!0)))}(e,0,s);if(!(0,F.isTabLoaded)(e.get(),t.peerId))return;(0,q.handleEventChatUpdated)(e,t.peerId,t.updateType,t.updateArg,i,a)||!we.Ranges.isChatOrChannelPeer(t.peerId)||e.set((e=>(0,B.loadChatInfo)(t.peerId,e).then((e=>e.peer===t.peerId?(0,B.setActions)(e):Promise.resolve(e))))).then((()=>{s().updateChatInfo(t.peerId)}))}function Ke(e,t,s){let i=null;if(s.kludges.keyboard&&!s.kludges.keyboard.inline){const t=Object.assign(s.kludges.keyboard,{author_id:s.userId});i=e.set(B.setKeyboard.bind(null,s.peerId,t))}else{const t=(0,D.getKeyboard)(e,s.peerId);t&&t.one_time&&t.author_id!==(0,O.getAuthorId)(e,s)&&(i=e.set(B.deleteKeyboard.bind(null,s.peerId)))}s.peerId===(0,J.getPeer)(e)&&i&&i.then(t.fixKeyboard)}function $e(e,t,s,i,c,_,p,h,f,v,b,y,w,T,I,M,P,A,L,R,H,j,q){let G=!1;return{changePeer(e,s){t.selectPeer(e,s)},cancelSearch(e){Ue(e,i,t)},loadingPeer(e){De(e,s,c)},restoreDialogs(e,s,i){t.restoreDialogs(e,s,i)},showChatInvitationBox(e,s){(0,F.showChatInvitationBox)(e,s,f,t)},toggleSettingsButton(e,t){b?.toggleButton(e,t)},focusSearch(e){i.focusInput()},appendSearch(e,s,i,a){t.appendSearch(e,s,i,a)},appendDialogs(e,s){t.appendDialogs(e,s)},showCreation(e,a){He(e,a,v,i,t,s,c)},updateState(e,i){t.updateDialog(e,i),i.get().peer===e&&s.updateChat(i,e)},updateConvoInList(e,s){t.promoteDialog(s,e)},appendFastDialogs(e,s){t.appendFastDialogs(e,s,!0)},createCanceled(e){i.hideCancelControl(),(0,F.isClassicInterface)(e)?((0,g.setStyle)(c,{height:"auto"}),(0,g.removeClass)(c,"im-page_cropped"),setTimeout((()=>i.focusInput()),0),0===e.get().peer?t.restoreScroll(e):s.restoreScroll(e,e.get().peer)):setTimeout((()=>{0===e.get().peer?i.focusInput():s.focustTxt(e)}),0),(0,g.removeClass)(c,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){M&&M.updateMenu(e)},goToHistoryEnd(){s.goToEnd()},updateDialog(e,s){t.updateDialog(e,s)},updateRecommendationList(e){e.set(ae.updateConvoRecommendationList).then((e=>{(0,J.isRecommendationListRerenderNeeded)(e)&&t.updateRecommendationList(e)}))},setRecommendationListVisibility:e=>t.setRecommendationListVisibility(e),focusTxt(e){s.focustTxt(e)},resync(e){(0,D.isSearching)(e)&&i.clearSearch(e),t.restoreDialogs(e,!0,!0).then((()=>{(0,F.isClassicInterface)(e)||t.focusOnSelected(e)})),v&&v.hide(e),(0,F.isCommunityInterface)(e)&&e.get().tabbedPeers.forEach((({peer:t})=>{M.updateCounter(e,t)})),(0,F.isClassicInterface)(e)?(e.get().tabbedPeers.forEach((({peer:t})=>{M.updateCounter(e,t),M.updateName(t,e)})),(0,oe.updateFolderCounters)(e)):t.updateFolderCounters(e),s.cleanSelection(e.get().selectedMessages||[]),s.cancelSearch(e,!0),we.Ranges.isZeroOwner(e.get().peer)||s.changePeer(e,!1),(0,se.updateUnreadCounter)(e)},toggleSettingsLoader(e,t){b.toggleLoader(e,t)},onUserActions(e,t){if((0,B.isSearchingInplace)(e.get().peer,e.get()))return;let i=e.get(),a=i.peer;if((0,F.isFullyLoadedTab)(i,a)&&!_.is_idle&&(0,D.countUnread)(e.get().peer,e.get())>0){!i.tabs[a].skipped&&s.isNewMessagesVisible(e)&&(s.hideGoToEnd(!0),s.hideGoToMention(!0),s.updateObserver(),Promise.resolve().then((()=>e.set(B.setActions))).then((()=>s.updateActions(e))))}},removeSelection(e){t.removeSelection(e),i.focusInput()},openSettings(){i.openSettings()},route(e,a,n,o){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});let r=!1;return!!(e.mr||e.invite_chat_id&&n.invite_hash)||(o&&o.params&&"left_nav"===o.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach((e=>{switch(e){case"sel":n.q||(r=!0);const e=n.sel?(0,F.unUrlPeer)(n.sel):0;let l=o.back;if(0===e)y.get().longpoll.push([(0,z.resetPeer)(!1,l)]);else if(e!==y.get().peer){let t="";o&&o.params&&o.params.entrypoint&&(t=o.params.entrypoint),y.get().longpoll.push([(0,z.changePeer)(e,n.msgid||!1,!1,!1,t)])}break;case"invite_chat_id":case"invite_hash":!function(e){e.set(B.leaveInvitation).then((()=>{e.get().longpoll.push([(0,z.resetPeer)(!1,!1)])}))}(y);break;case"tab":Fe(y,v,f),r=!0;const u=n.tab||U.FOLDER_ALL;y.get().longpoll.push([(0,z.changeTab)(u)]);break;case"act":n.act&&"create"===n.act?He(y,[],v,i,t,s,c):function(e,t,s,i){s&&s.hide(e,t)}(y,[],v);break;case"st":n.st&&n.sel?((0,d.curBox)()&&(0,d.curBox)().hide(),y.mutate(B.setInplaceSearch.bind(null,unescape(n.st),n.sel)),s.startSearch(y)):(y.mutate(B.cancelSearch.bind(null,a.sel)),s.cancelSearch(y,!0));break;case"q":n.q?((0,d.curBox)()&&(0,d.curBox)().hide(),i.setSearch(y,n.q,!0)):i.clearSearch(y);break;case"box":ke(y,n.box)}})),n.msgid&&(y.get().msgid=n.msgid,s.focusOnMessage()),(0,F.isClassicInterface)(y)&&void 0===e.sel&&M.updateMenu(y),r&&Ue(y,i,t),!1)},updateDialogFilters(e,s=!1){(0,D.isSearching)(e)||s||t.restoreDialogs(e),b?.updateFilter(e)},removePeer(e,s){t.removeDialog(e,s),t.saveScroll(e),e.get().peer===s&&e.get().longpoll.push([(0,z.resetPeer)()]),(0,F.isClassicInterface)(e)&&M.updateMenu(e)},newMessage(e){(0,F.isClassicInterface)(e)||t.scrollUp(!0)},onQueueEvent(e,i){if(i.entity_type===C.EntityType.Online)e.set((e=>(0,B.updateOnline)(i.data.user_id,!!i.data.online&&i.data.platform,i.data.last_seen,e))).then((e=>{(0,F.isTabLoaded)(e.get(),i.data.user_id)&&(t.updateOnline(i.data.user_id,e),s.updateOnline(i.data.user_id,e)),(0,X.isRecommendedConvo)(e,i.data.user_id)&&t.updateRecommendedOnline(i.data.user_id,e)}))},onEvents(e,n){let o=(0,z.compactCounterEvents)(n),d=n.filter(O.isServiceMsg),y=n.filter((e=>e.type===k.ADD_MESSAGE));const C=(0,B.checkNewPeople)(d,y,e);let S=Promise.resolve();if(C.shouldLoad&&(S=e.set(B.loadNewPeople.bind(null,C,p))),S.then((()=>{Me(d,e,t,s),o.forEach((n=>{switch(n.type){case k.ADD_MESSAGE:const o=n.peerId,d=(0,D.getTab)(e,o),p=!d||!d.msgs||0===d.msgs.length,y=(0,F.getMessageStoreStatus)(n,e.get()),C=(0,D.isCommunityBlocked)(e,n.peerId),S=d&&!d.lastmsg,T=d&&(0,X.isChatConvo)(d)&&d.data.closed;switch(Ke(e,s,n),(0,O.isCasperMessage)(n)&&K.casperMessagesStore.add(n),y){case F.MSG_NEW:e.set(B.addMessage.bind(null,n)).then((e=>{Ae(e,n).then((s=>{s&&(Le(e,t),Re(e,n.peerId,n.chat_local_id))}))})),Oe(e,c),function(e,t){const s=(0,x.unpackStore)(e),i=s.tabs[t.peerId],a=s.active_tab,n=t.flags&k.FLAG_STEALTH;return!(!i||!a||n)&&(!(a!==U.FOLDER_ALL||(0,X.tabIsArchived)(i)||(0,X.isBusinessNotifyTab)(i)||(0,D.tabIsMessageRequestToChat)(i))||(a===U.FOLDER_PEER_TAGS?(0,Q.applyPeerTagsFilterToTab)(s,i):(0,B.filterFromTab)(a)(i)))}(e,n)&&((0,D.tabIsMessageRequest)(d)||(n.flags&k.FLAG_OUTBOUND||e.set(B.updateFavAndTitle.bind(null,n.peerId,!0)),function(e,t){const s=t.peerId,i=e.get().tabs[s],a=t.flags&k.FLAG_OUTBOUND,n=(0,u.inArray)(t.peerId,e.get().mutedPeers),o=t.flags&k.FLAG_DELETED,c=e.get().gid,d=(0,O.isUnread)(i,t);if(!a&&!n&&!o&&d){const a=t.userId,n=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"";let o,d,_=(n?n+" ":"")+t.text||"";if(t.kludges&&t.kludges.source_act&&(_=(0,l.stripHTML)((0,ce.renderServiceMsg)(e,t,i.peerId,!1))),(!e.get().notify_msg&&!we.Ranges.isChatOrChannelPeer(s)||c&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:s}),!we.Ranges.isChatOrChannelPeer(s))return;_=(0,u.trim)((0,l.replaceEntities)((0,l.stripHTML)(_.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),_=(0,E.replaceMentions)(_,((e,t,s,i,a)=>a)),we.Ranges.isChatOrChannelPeer(s)?(o=(0,V.oCacheGet)(e,a).name,i.tab&&(o+=" » "+i.tab),d=(0,V.oCacheGet)(e,a).photo):(o=i.tab,d=i.photo);const g=t.attaches[0];if(g&&"mail"===g.type)_+="\n["+r.getLang("mail_added_msgs")+"]";else if(g){const e="doc"===g.type&&"graffiti"===g.kind?"graffiti":g.type;_+="\n["+r.getLang("mail_added_"+e)+"]"}o=(0,u.trim)((0,l.replaceEntities)((0,l.stripHTML)((o||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:_,author_id:s,title:o,author_photo:d})}}(e,n)),t.updateTyping(n.peerId,e),(0,D.isSearching)(e)?t.updateDialog(n.peerId,e):t.promoteDialog(e,n.peerId));const i=(0,D.isCommunityBlocked)(e,n.peerId),a=d&&!d.offset,o=d&&(0,X.isChatConvo)(d)&&!d.data.closed&&T;(C&&!i||S&&!a||o)&&(o&&(0,B.setActions)((0,x.unpackStore)(e)),s.updateActions(e)),(0,F.isClassicInterface)(e)?(M.updateCounter(e,n.peerId),M.updateMenu(e)):b?.updateFilter(e),e.set(B.updateActivity.bind(null,n)).then(je.bind(null,e,s,t,n.peerId)),s.addMessage(e,n),xe(n)||!(0,F.isFullyLoadedTab)(e,n.peerId)||n.local||e.set(B.loadMedia.bind(null,n)).then((e=>{s.replaceAttachmentPlaceholders(e,n),(0,te.videoAutoPlayHandler)()})),n.kludges.has_template&&e.set((e=>(0,B.addCarouselTemplateToStore)(n,e))).then((e=>{s.replaceBotCarouselPlaceholder(e,n)})),(0,N.statlogsSendingTimeStart)(e,n,"send","opt_to_lp");break;case F.MSG_LOCAL_DUPLICATE:xe(n)||e.set(B.loadMedia.bind(null,n)).then((e=>{s.replaceAttachmentPlaceholders(e,n)})),e.set(B.replaceMessage.bind(null,n)),s.replaceMessageAttrs(n,e),t.updateDialog(n.peerId,e),e.get().active_tab===U.FOLDER_ALL&&(0,X.isRecommendedConvo)(e,n.peerId)&&this.updateRecommendationList(e),n.randomId&&(0,N.statlogsSendingTimeEnd)(e,n,"send","opt_to_lp");break;case F.MSG_DUPLICATE:(0,D.isSearching)(e)||t.promoteDialog(e,n.peerId)}(0,D.tabIsMessageRequest)(d)&&(0,F.checkMessageRequestsTab)(e,t.update);(y===F.MSG_LOCAL_DUPLICATE&&1===d.offset||y===F.MSG_NEW&&S&&!n.local)&&e.set((t=>(0,le.loadPeer)(t,o,0,!1,!1,"emptyPinnedCrutch").then((t=>((0,Z.updateListedConvos)(t,(0,D.getTab)(t,o),!1,(e=>(0,B.addDialog)(o,e,t)),((e,s,i)=>(0,B.shouldIncludeDialog)(t,e,s,i))),o===e.get().peer?(0,B.setActions)(t):t))))).then((e=>t.promoteDialog(e,o))),d&&p&&d.peerId===(0,J.getPeer)(e)&&R();break;case k.EDIT_MESSAGE:case k.REPLACE_MESSAGE:{const i=(0,D.getMessage)(e,n.peerId,n.messageId),a=Boolean(i?.flags&k.FLAG_HAS_REACTIONS);if(Boolean(n.flags&k.FLAG_HAS_REACTIONS)!==a)return void e.set((e=>(0,ne.setMessageFlag)(e,n.peerId,n.messageId,k.FLAG_HAS_REACTIONS,!0)));e.set(B.editMessage.bind(null,n)).then((e=>{if(Ae(e,n).then((s=>{s&&(Le(e,t),Re(e,n.peerId,n.chat_local_id))})),Ke(e,s,n),n.kludges.is_expired)return(0,F.removeExpiredMessageIfNeed)(n,s.handleMessageExpiration),void t.updateDialog(n.peerId,e);t.updateDialog(n.peerId,e),s.updateTyping(n.peerId,e),s.editMessage(e,n),xe(n)||!(0,F.isFullyLoadedTab)(e,n.peerId)||n.local||e.set(B.loadMedia.bind(null,n)).then((e=>s.replaceAttachmentPlaceholders(e,n))),i?.kludges.reactions&&!n.kludges.reactions&&(0,ee.setMessageReactions)(e,n.peerId,n.messageId,i.kludges.reactions).then((t=>i.kludges.reaction_id?(0,ee.setMyMessageReaction)(e,n.peerId,n.messageId,i.kludges.reaction_id):Promise.resolve(t))).then((e=>s.updateMessageReactions(e,n.peerId,n.messageId))),n.kludges.has_template&&e.set((e=>(0,B.addCarouselTemplateToStore)(n,e))).then((e=>{s.replaceBotCarouselPlaceholder(e,n)}))}));break}case k.REACTION_CREATE_OR_EDIT_EVENT:{if(!(0,W.partConfigEnabled)("messages_reactions"))break;const{subtype:t,peerId:i,cmid:a,reactionCounters:o,reactionId:r}=n,l=1===t||3===t,c=(0,J.getPeer)(e),d=Number((0,ue.getMessageByCmid)(e,i,a)?.messageId);if(!d)break;const u=(0,D.getTab)(e,i),_=u?.scrollBottom;e.set((e=>(0,ee.setMessageReactions)(e,i,d,o).then((e=>l?(0,ee.setMyMessageReaction)(e,i,d,r):Promise.resolve(e))))).then((e=>{const t=(0,ue.getMessageReactedPeerIds)(e,i,a).filter((t=>!(0,V.oCacheExists)(e,t)));return 0===t.length?Promise.resolve(e):(0,B.loadChatMember)({[i]:t},e)})).then((e=>{if(c===i&&(s.updateMessageReactions(e,i,d),0===_&&s.scrollBottom()),(0,F.isFullyLoadedTab)(e,i))return(0,B.addMessageReactionsToHistory)(i,d,e)}));break}case k.INVALIDATE_MESSAGE:(0,B.reloadMessage)(n.messageId,e.get()).then((t=>{const s=(0,Y.getMessageFromTuple)(t);return e.set((e=>(0,B.editMessage)(s,e))).then((()=>s))})).then((i=>{s.editMessage(e,i),t.updateDialog(i.peerId,e),!xe(i)&&(0,F.isFullyLoadedTab)(e,i.peerId)&&e.set((e=>(0,B.loadMedia)(i,e))).then((e=>s.replaceAttachmentPlaceholders(e,i)))}));break;case k.UNREAD_REACTIONS:(0,W.partConfigEnabled)("messages_reactions")&&e.set((e=>(0,ae.setUnreadReactions)(e,n.peerId,n.cmids))).then((e=>{t.updateCounter(e,n.peerId),n.peerId===(0,J.getPeer)(e)&&s.updateGoToReactionsButton(e,document),(0,F.isClassicInterface)(e)&&M.updateCounter(e,n.peerId)}));break;case k.READ_INBOUND:case k.READ_INBOUND_BY_CMID:e.set((e=>(0,B.markInboundMessagesAsRead)(n,e))).then((e=>{t.updateCounter(e,n.peerId),n.peerId===(0,J.getPeer)(e)&&(s.updateGoToEnd(e,!0),s.updateGoToMention(e,!0),s.updateObserver()),(0,F.isClassicInterface)(e)&&M.updateCounter(e,n.peerId),(0,D.isSearching)(e)||t.restoreDialogs(e),b?.updateFilter(e)}));break;case k.READ_OUTBOUND:case k.READ_OUTBOUND_BY_CMID:e.set(B.markOutboundMessagesAsRead.bind(null,n)).then((e=>{t.updateCounter(e,n.peerId),s.markMessagesAsRead(e,n)}));break;case k.UNREAD_COUNT:e.set((e=>(0,ee.setUnreadCounters)(n,e))).then((()=>{b?.updateFilter(e);const{showOnlyNotMuted:s}=n;s!==(0,J.getLocalSettingsValue)(e,"show_only_not_muted_messages")&&e.set((e=>(0,ee.setLocalSettingsValue)("show_only_not_muted_messages",s,e)));let i=Promise.resolve();n.businessNotifyUnread>0&&1===e.get().settings.business_notify_folder_hidden&&(i=e.set((e=>(0,ee.setLocalSettingsValue)("business_notify_folder_hidden",0,e))),(0,le.toggleHideFolderHandler)((0,x.unpackStore)(e),re.ConvoListFolder.BUSINESS_NOTIFY,!1)),i.then((s=>{(0,F.isClassicInterface)(e)?((0,oe.updateFolderCounters)(e),e.get().tabbedPeers.forEach((({peer:t})=>{M.updateCounter(e,t)}))):t.updateFolderCounters(e)}))}));break;case k.SET_FLAGS:case k.REPLACE_FLAGS:case k.RESET_FLAGS:switch(!0){case Boolean(n.flags&k.FLAG_DELETED):case Boolean(n.flags&k.FLAG_SPAM):n.type!==k.SET_FLAGS||(0,F.isAlreadyDeleted)(e,n.peerId,n.messageId)||e.get().blockedFlagUpdates[n.peerId]||h(n);break;case n.flags===k.FLAG_IMPORTANT:{const t=n.type===k.SET_FLAGS;e.set((e=>(0,B.updateImportant)(t?1:-1,n.messageId,e))),e.set((e=>(0,B.updateFavMessage)([n.messageId],n.peerId,t,e))).then((()=>{s.markImportant(n.messageId,t,e)}));break}case Boolean(n.flags&k.FLAG_AUDIO_MESSAGE_LISTENED):e.set((e=>(0,ne.setMessageFlag)(e,n.peerId,n.messageId,k.FLAG_AUDIO_MESSAGE_LISTENED,!0))).then((e=>{const{peerId:t,messageId:i}=n,a=(0,D.getTab)(e,t);if((0,J.getPeer)(e)===t&&s.markMessageAsListened(e,t,i),a&&(0,F.isFullyLoadedTab)(e,t)){const e=(0,_e.unpackHistory)(a.history);a.history=(0,F.updateListenedMark)(e,i)}}))}break;case k.RECORDING_AUDIO:Ve(e,s,t,n,B.ACTIVITY_TYPE_RECORDING_AUDIO);break;case k.TYPING:Ve(e,s,t,n,B.ACTIVITY_TYPE_TYPING);break;case k.NOTIFY_SETTINGS_CHANGED:!function(e,t,s,i){e.set(B.setMutedPeer.bind(null,s,i)).then(t().updateState.bind(null,s))}(e,f,n.peerId,!n.sound);break;case k.CONVO_MAJOR_ID_CHANGED:e.set((e=>{const{peerId:t,majorId:s}=n,i=(0,D.getTab)(e,t);return(s&&i?Promise.resolve(e):(0,le.loadPeer)(e,t,0,!1,!1,"sortingChange")).then((e=>{const i=(0,D.getTab)(e,t);return i.major_sort_id=s,(0,Z.updateListedConvos)(e,i,!1,(s=>(0,B.addDialog)(t,s,e)),((t,s,i)=>(0,B.shouldIncludeDialog)(e,t,s,i))),(0,B.setActions)(e),Promise.resolve(e)}))})).then((e=>{const{peerId:i}=n;(0,D.getTab)(e,i)&&!(0,D.isSearching)(e)&&t.promoteDialog(e,i),i===e.get().peer&&s.updateActions(e)}));break;case k.CONVO_MINOR_ID_CHANGED:e.set((e=>{const{peerId:t,minorId:s}=n,i=(0,D.getTab)(e,t);return i?(i.minor_sort_id=s,Promise.resolve(e)):Promise.resolve(e)})).then((e=>{const{peerId:s}=n;(0,D.getTab)(e,s)&&!(0,D.isSearching)(e)&&t.promoteDialog(e,s)}));break;case k.RESYNC:e.get().longpoll.pause(),e.set(B.resync).then(f().resync).then((()=>e.get().longpoll.resume()));break;case k.TRANSITION:w.transition(n.state);break;case k.RESET_PEER:if(n.removeActivePeer){const t=e.get().tabbedPeers.filter((({peer:t,type:s})=>t!==e.get().peer&&"perm"===s));e.setState({tabbedPeers:t})}!function(e,t,s,i){e.set(B.cancelRecording).then((()=>{s.cancelRecording()})),AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),t.removeSelection(e),(0,g.removeClass)(i,"im-page_history-show"),s.flushDraft(e),s.stopLoading(),s.destroyPeerProfile(),(0,D.isAnyMessageBeingEdited)(e)&&s.cancelEditing();let a=e.get().peer;e.set(B.changePeer.bind(null,0,!1,"")).then((()=>{window.tooltips&&window.tooltips.hideAll(),Be(),(0,F.isClassicInterface)(e)&&t.activate(),s.changePeer(e),(0,F.isClassicInterface)(e)&&t.restoreScroll(e),setTimeout((()=>{e.get().longpoll.push([(0,z.transitionEvent)("search")])}),13),(0,F.isLocksAvailable)(e)&&(0,F.isPeerBlockedByMe)(a,e)&&e.set(B.releaseBlock.bind(null,a))}))}(e,t,s,c),n.cancelSearch&&Ue(e,i,t),(0,F.isClassicInterface)(e)&&M.updateMenu(e),(0,F.isClassicInterface)(e)&&e.get().active_tab===U.FOLDER_ALL&&this.updateRecommendationList(e),i.focusInput(),(0,F.isCommunityInterface)(e)&&(i.initPeerTagsFilter(e),t.renderPeerTags(e));break;case k.CHANGE_TAB:(0,D.isSearching)(e)&&i.clearSearch(e);const I=e.get().active_tab;(0,F.changeTab)(n.tab,e,f,B.changeDialogsTab).then((e=>{b?.updateFilter(e),n.tab===U.FOLDER_PEER_TAGS&&I!==n.tab&&i.initPeerTagsFilter(e),n.tab===U.FOLDER_ALL&&this.updateRecommendationList(e)}));break;case k.RESET_DIRECTORIES:case k.SET_DIRECTORIES:case k.REPLACE_DIRECTORIES:{const{type:i,peerId:a,mask:o}=n;if(o===k.FOLDER_HAS_BANNER)break;const r=o===k.FOLDER_AD_TAG;e.set((e=>(0,B.updateFolderState)(a,o,i,n.local,r,e))).then((e=>{(0,D.isSearching)(e)||i===k.RESET_DIRECTORIES&&o===U.FOLDER_MASKS[U.FOLDER_IMPORTANT]||i===k.RESET_DIRECTORIES&&o===U.FOLDER_MASKS[U.FOLDER_MESSAGE_REQUEST]||i===k.SET_DIRECTORIES&&o===U.FOLDER_MASKS[U.FOLDER_MESSAGE_REQUEST_REJECTED]||i===k.REPLACE_DIRECTORIES||t.restoreDialogs(e),t.updateDialog(a,e),(0,F.isClassicInterface)(e)&&M.updateCounter(e,a),e.get().peer===a&&s.changedMessageSelection(e)}));break}case k.DELETE_DIALOG:n.leaveChat||void 0===n.leaveChat?e.set(B.deletedDialog.bind(null,n.peerId,Promise.resolve([]))).then((()=>{f().removePeer(e,n.peerId),f().updateDialogFilters(e),(0,B.removeFromRecentSearch)(n.peerId,cur.imDb),e.set(B.preloadSearchIndex.bind(null,cur.imDb))})):e.set(B.flushDialog.bind(null,n.peerId,Promise.resolve([]))).then((()=>{(0,B.loadActualLastMessage)(e,n.peerId).then((()=>f().updateState(n.peerId,e)))}));break;case k.CHANGE_PEER:m.navigationStat.sendGo("im_chat",{destinationItem:{type:n.entryPoint||"unknown",id:n.peerId}}),Ne(e,n,t,s,i,c,M,v,f);break;case k.MUTEX:const P={[n.peerId]:n},A=(0,F.isPeerBlocked)(n.peerId,e);e.set(B.updateBlockStates.bind(null,P)).then((()=>{t.updateDialog(n.peerId,e);let i=(0,F.isPeerBlocked)(n.peerId,e);(0,F.isFullyLoadedTab)(e.get(),n.peerId)&&A!==i&&s.updateChat(e,n.peerId)}));break;case k.FAILED_MESSAGE:e.set(B.setMessageErrored.bind(null,n.peerId,n.message)).then((()=>{s.setMessageErrored(n.peerId,n.message,n.error,e),t.setDialogFailed(n.peerId,n.message.messageId,e)}));break;case k.RESEND:const L=n.message.messageId;e.set(B.resendMessage.bind(null,n.peerId,L,n.message)).then((()=>{s.resendMessage(n.peerId,L),t.promoteDialog(e,n.peerId)}));break;case k.PEER_TAGS_CHANGED_EVENT:(0,Q.onPeerTagsChangeEvent)(e,t,n);break;case k.PEER_PROFILE_TAGS_CHANGED_EVENT:(0,Q.onPeerProfileTagsChangedEvent)(e,t);break;case k.CONVERSATION_UPDATED:Ge(e,n,f,s,t);break;case k.WAITING_FOR_RECONNECT:setTimeout((()=>{qe(c,!0,e),s.setNetworkWaitingStatus(n.timeout-1,e)}),1e3);break;case k.RECONNECTING:qe(c,!0,e),s.setNetworkReconnectingStatus(e);break;case k.RECONNECTED:qe(c,!1,e),setTimeout(s.clearNetworkStatus,0);a.browser.chrome&&!(0,F.isClassicInterface)(e)&&e.get().peer&&(_.is_idle?G||(_.once("unidle",(()=>{G=!1,t.forceScrollReinit()})),G=!0):t.forceScrollReinit());break;case k.KEYBOARD_CALLBACK_RECEIVED:{const t=(0,J.getPressedButtonState)(n.event_id,e);t&&(e.set((e=>(0,ee.unsetPressedCallbackButton)({peerId:n.peer_id,eventId:n.event_id},e))),t.onCallback(),(0,ie.handleCallbackAction)(n,e));break}case z.CHANGE_VOICE_UI:{const t=(0,J.getPeer)(e);if(!t)return;const i=(0,D.getTab)(e,t),a=i?.msgs;if(!i||!a)return;const n=Object.values(a);for(let t=n.length-1;t>=0;t--){const a=(0,de.parseMessage)(n[t]);(0,F.isAlreadyDeleted)(e,i.peerId,a.messageId)||!(0,O.isAudioMsg)(a)&&!(0,ue.hasForwards)(a)||(s.editMessage(e,a),e.set((e=>(0,B.loadMedia)(a,e))).then((e=>s.replaceAttachmentPlaceholders(e,a))))}break}}}))})),(0,W.partConfigEnabled)("marusya_web_support_proccess_commands")){const e=n.filter(pe.isEventForMarusia);e.length&&(0,he.loadMarusiaSdk)().then((t=>{t&&t.onAddMessage(e.map(fe.convertImMessageToMarusia))}))}},updateHistory:e=>s.updateHistory(e),updateChatInfo(e){s.updateChatTopic(e,y),(0,F.isClassicInterface)(y)&&M.updateName(e,y),y.get().peer===e&&s.updateActions(y)},cancelRecording:()=>y.set(B.cancelRecording).then((()=>s.cancelRecording())),fixHeight(){R()},toggleFolder(e,s){t.toggleFolder(e,(()=>this),s)},updateFolderCounters(e){t.updateFolderCounters(e)},hideFolderButton(e,s){const i=(0,x.unpackStore)(e);e.set((async t=>{switch(s){case re.ConvoListFolder.BUSINESS_NOTIFY:return(0,ee.setLocalSettingsValue)("business_notify_folder_hidden",1,t);case re.ConvoListFolder.ARCHIVE:{const{archiveMentionsMap:s}=e.get();return cur.imDb.updateByKey("archive-mentions-map",Array.isArray(s)?{}:s),cur.imDb.updateByKey("archives_folder_hidden",1),(0,ee.setLocalSettingsValue)("archives_folder_hidden",1,t)}default:return t}})).then((e=>((0,F.isClassicInterface)(e)||t.updateFolderCounters(e),(0,le.toggleHideFolderHandler)(i,s,!0))))},makeArchiveVisible(e){Le(e,t)},actualizeArchiveVisibilityOnUnidle(e){!function(e,t){const s=e.get().settings.archives_folder_hidden,i=cur.imDb.selectByKey("archives_folder_hidden");i&&!s?e.set((e=>(0,ee.setLocalSettingsValue)("archives_folder_hidden",1,e))).then((()=>{(0,F.isClassicInterface)(e)||t.updateFolderCounters(e)})):null===i&&s&&e.set((e=>(0,ee.setLocalSettingsValue)("archives_folder_hidden",null,e))).then((()=>{(0,F.isClassicInterface)(e)||t.updateFolderCounters(e)}))}(e,t)},addEntityToArchiveMentionsMap(e,t){Re(e,t)},applySearchAction(e,t,s){i.applySearchAction(e,t,s)},deselectAllMessages(e){s.deselectAll(e)},updateActions(e){(0,B.setActions)((0,x.unpackStore)(e)).then((()=>{s.updateActions(e)}))},unmount(){(0,S.destroyModule)(e),clearInterval(y.get().update_title_to),_.stop(),H(),j(),K.casperMessagesStore.destroy(),t.unmount();let a=window.devicePixelRatio>=1.25?"_2x":"";(0,n.setFavIcon)("/images/icons/favicons/fav_logo"+a+".ico"),s.unmount(),i.unmount(),(0,o.cancelStackFilter)("im_peer"),b?.unmount(),v&&v.unmount(),M&&M.unmount(),P&&P(),T&&T(),(0,F.isLocksAvailable)(y)&&y.get().peer&&y.set(B.releaseBlock.bind(null,y.get().peer)),A.unmount(),q.unmount(),M&&M.unmount(),L.unmount(),clearInterval(I),cur.imDb.unmount(),cur.imDb=!1,(0,W.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,he.loadMarusiaSdk)().then((e=>{e&&e.dispose()})),ye.MediaScopeStats.stop()}}}function We(e,t,s,i){const a=t.get();we.Ranges.isZeroOwner(a.peer)||e().onUserActions(t,i),a.update_old_title&&t.set(B.updateFavAndTitle.bind(null,!1,!1))}function Ye(e,t){const s=(0,g.ge)("page_header"),i=(0,g.geByClass1)("_im_page_history",e),a=(0,g.clientHeight)()-s.offsetHeight-Ce-2,n=(0,F.isClassicInterface)(t)?Te:Se;let o={page:Math.max(a,n)};if((0,F.isClassicInterface)(t)){let e=(0,F.getClassicChatHeight)();e=e>0?Math.min(e-s.offsetHeight-Ce-2,a):a;const t=(0,g.hasClass)(i,"im-page--history_empty-hist")?e:a;o.history=Math.max(e,n),o.chat=Math.max(t,n)}return o}function ze(e,t,s,i,n,o=!0,r=!1){if((0,x.isFullScreen)())return;const l=Ye(e,t);if((0,g.setStyle)(e,{minHeight:l.page}),(0,F.isClassicInterface)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(B.initializeChatResize),(0,g.setStyle)(e,{height:t.get().isCreating?l.page:"auto"}),(0,g.setStyle)((0,g.geByClass1)("_im_page_dialogs",e),{minHeight:l.page}),(0,g.setStyle)((0,g.geByClass1)("_im_page_history",e),{minHeight:l.history,position:"relative",top:0}),(0,g.setStyle)((0,g.geByClass1)("_im_chat_body_abs",e),{minHeight:l.chat,height:l.chat,position:"relative",top:0})),a.browser.safari&&r&&"function"==typeof r&&r(),i&&i.updateScroll(),n&&n.updateScroll&&n.updateScroll(),s){let e=s.updateScroll();s.scrollFix(t,t.get().peer,e)}o&&setTimeout((()=>ze(e,t,s,i,n,!1)),100)}function Ze(e,t){e.get().resendAllOnOnline&&t()}function Qe(){const e=document.querySelector(".im_page");!function(e){let t="safari-repaint";e.forEach((function(e){(0,g.hasClass)(e,t)&&(0,g.removeClass)(e,t),(0,g.addClass)(e,t)})),setTimeout((function(){e.forEach((function(e){(0,g.removeClass)(e,t)}))}),100)}([(0,g.geByClass1)("_im_dialog_actions",e),(0,g.geByClass1)("_im_chat_input_w",e),(0,g.ge)("side_bar"),(0,g.geByClass1)("_im_right_menu",e),(0,g.geByClass1)("_im_dialogs_footer",e),(0,g.geByClass1)("_im_dialogs_search",e)])}function Xe(e,t){(0,W.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog={});const s=t.get();let o,r=window.devicePixelRatio>=1.25?"_2x":"";(0,n.setFavIcon)("/images/icons/favicons/fav_im"+r+".ico"),ze(e,t,!1,!1,!1,!0);let{callMutations:l,bindMutations:d}=(0,S.createMutations)($e),u=s.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),_=u?Notifier.getLpInstance():t.get().gid?(0,I.startLongPollForGroup)(s.lpConfig):(0,I.startLongPoll)(s);_.onData(C);const m=Notifier.getEventQueueInstance&&Notifier.getEventQueueInstance(),E=m?m.subscribe((e=>{try{l().onQueueEvent(t,e)}catch(e){}})):()=>{};function C(...e){try{l().onEvents(t,e)}catch(e){}}let P=(0,g.geByClass1)("_im_dialogs_search",e),O=(0,g.geByClass1)("_im_dialogs_footer",e),N=(0,i.mount)((0,g.geByClass1)("_im_page_dcontent",e),t,l,P);N.renderPeerTags(t);let U,H,q=(0,h.mount)(P,t,l),Y=O?(0,f.mount)(O,t,l):null,z=(0,L.mount)(t),Z=(0,b.mount)(t,document.body);if(cur.imDb=(0,R.mount)(t.get().gid?-t.get().gid:vk.id),cur.imDb.updateByKey("archives_folder_hidden",t.get().settings.archives_folder_hidden),t.set(B.preloadSearchIndex.bind(null,cur.imDb)),async function(e){try{const{archiveMentionsMap:t}=e.get();if(Array.isArray(t))return!1;const s=cur.imDb.selectByKey("archive-mentions-map");return void 0===s?(cur.imDb.updateByKey("archive-mentions-map",t),!1):Object.entries(t).some((([e,t])=>!s.hasOwnProperty(e)||s[e]<t))}catch(e){return console.error(e),!1}}(t).then((e=>{if(e)try{l().makeArchiveVisible(t)}catch(e){}})),(0,F.isClassicInterface)(t)){let s=(0,g.geByClass1)("_im_ui_peers_list",e.parentNode);U=(0,A.mount)(s,t,l),H=function(e,t,s,i){if(a.browser.mobile)return!1;let n=[t,s,(0,g.geByClass1)("_im_chat_input_w",i),(0,g.geByClass1)("_im_dialog_actions",i),(0,g.geByClass1)("_im_dialog_header",i)],o=null,r=(0,g.hasClass)(e,"im-page--header_static"),l=(0,g.ge)("im-group-online-disabled-notice");function d(){let t=(0,w.getNativeOption)("scrollLeft"),s=(0,g.hasClass)(e,"im-page--header_static"),i=[];o!==t?i=n.slice().concat([e]):s!==r&&(i=[e]),o=t,r=s,i.length>0&&i.forEach((i=>{let a=e===i&&s?0:-t;(0,g.setStyle)(i,{[cssTransformProp]:0===a?"unset":"translateX("+a+"px)"})}))}return l&&n.push(l),n=n.concat((0,g.geByClass)("_im_aside_notice"),(0,g.geByClass)("_im_aside_promo_block")),(0,c.addEvent)(window,"scroll",d),d(),()=>{(0,c.removeEvent)(window,"scroll",d)}}(P,O,(0,g.geByClass1)("_im_right_menu",e.parentNode),e)}(0,F.isClassicInterface)(t)&&s.peer&&N.deactivate(),s.gid||(o=(0,v.mount)((0,g.geByClass1)("_im_dialogs_creation",e),t,l));let Q=(0,p.mount)((0,g.geByClass1)("_im_page_history",e),t,N,U,l);const ee=s.isCreating,te=ee?"create":0===s.peer?"search":"default";ee&&o.show(t,[]);let se=(0,T.create)(t,te,N,Q,q,o),ie=(0,j.mount)(t,se);Q.renderPeerProfile(t),Q.updateScroll();let ne=We.bind(null,l,t,se);if(s.peer&&(t.set(B.prepareCasperMessagesFromMessages.bind(null,s.peer)),(0,W.partConfigEnabled)("messages_reactions"))){const e=(0,X.getConvoReactedPeerIds)(s,s.peer).filter((e=>!(0,V.oCacheExists)(s,e)));e&&(0,B.loadChatMember)({[s.peer]:e},s)}we.Ranges.isZeroOwner(s.peer)||setTimeout((()=>Pe(t,Q)),10);let oe=new G.IdleManager({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"});const re=(0,$.debounce)(Qe,300),ce=ze.bind(null,e,t,Q,N,o,!1,re),de=Ze.bind(null,t,Q.resendAll);t.setState({longpoll:_}),t.set(B.setExecStack.bind(null,[])),oe.on("unidle",(function(){l()?.actualizeArchiveVisibilityOnUnidle(t),_.abortWaiting(),ne()})),ye.MediaScopeStats.start("vk"),oe.start(),nav.objLoc.box&&(ke(t,nav.objLoc.box),(0,y.updateLocation)({box:null})),nav.objLoc.mr&&we.Ranges.isChatOrChannelPeer(Number(nav.objLoc.mr))&&(0,F.showChatInvitationBox)(t,nav.objLoc.mr,l,N),window.nav.objLoc?.openSettings&&(q.openSettings(),(0,y.updateLocation)({openSettings:null}));const ue=function(e){const t=e.get();if(!(0,F.isLocksAvailable)(e))return null;const{stop:s}=(0,M.createWorker)(t.mutex_key,(function(e){t.longpoll.push([k.mutexEvent(e)])}),(function(e,s){return(0,B.getMutexQueue)(t.gid).then((([e])=>e))}));return s}(t);let _e;if((0,F.isLocksAvailable)(t)&&(_e=setInterval(F.blockLatencyCompensation.bind(null,t,s.longpoll),2e3)),t.get().invitation&&(0,F.showInvitationBox)(t,t.get().invitation,B.leaveInvitation),(0,F.isClassicInterface)(t)&&(0,D.existsIncomingMessageRequest)(t)){const e=document.getElementById("ui_rmenu_mr");e&&e.classList.remove("unshown")}let ge=(0,x.throttleAccumulate)(Ie.bind(null,t,Q,N,U),200),pe=F.hideTopNotice.bind(null,t),he=F.hideAsideNotice.bind(null,t);K.casperMessagesStore.subscribe((e=>function(e,t,s,i,{type:a,message:n}){switch(a){case K.EXPIRING:return t.updateCasperMessageStatus(n);case K.EXPIRING_SOON:return t.updateCasperMessageStatus(n,!0);case K.EXPIRED:(0,D.isCasperChat)(e,n.peerId)?i(n):(t.handleMessageExpiration(n),s.updateDialog(n.peerId,e))}}(t,Q,N,ge,e))),K.casperMessagesStore.setTimeshift(s.timeshift);const fe=e=>{const s=e.target.closest("._im_new_ui_banner");s&&(s.hidden=!0,(0,le.toggleHideFolderNoticeHandler)(t.get(),"new_ui_banner",1))};(0,Ee.onDomReady)((()=>{t.set(ae.updateConvoRecommendationList).then((e=>{(0,J.isRecommendationListRerenderNeeded)(e)&&N.updateRecommendationList(e)}))})),(0,me.initWidgets)(e,s.peer);return d((0,S.createModule)({handlers:(s,i)=>{s(document,"mousemove mousedown keypress",ne),s(window,"resize",ce),s(window,"online",de),i(e,"click",F.HIDE_TOP_NOTICE_CLASS,pe),i((0,g.gpeByClass)("_im-page-wrap",e),"click",F.HIDE_ASIDE_NOTICE_CLASS,he),i((0,g.gpeByClass)("_im-page-wrap",e),"click",F.HIDE_ASIDE_PROMO_BLOCK_CLASS,F.hideAsidePromoBlock),i((0,g.gpeByClass)("_im-page-wrap",e),"click",F.INSTALL_VKADMIN_LINK,F.installVKAdminApp),(0,F.isClassicInterface)(t)&&!(0,F.isCommunityInterface)(t)&&i((0,g.gpeByClass)("_im-page-wrap",e),"click","_im_new_ui_banner_close",fe),a.browser.safari&&s(document,"visibilitychange",Qe)}}),N,Q,q,e,oe,_,ge,l,o,Y,t,se,ue,_e,U,H,z,ie,ce,(function(){u?_.offData(C):_.stop()}),E,Z)}},67244:(e,t,s)=>{"use strict";s.d(t,{mount:()=>se});var i=s(365485),a=s(714209),n=s(723561),o=s(610989),r=s(248298),l=s(772546),c=s(317412),d=s(452314),u=s(879007),_=s(948350),g=s(223905),m=s(583790),p=s(20025),h=s(727412);let f,v,b,y,w,E,C,S,T,I,k,M,P,A,L,R,x,D=600,O=a.browser.msie&&(0,u.intval)(a.browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function B(e){let t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}let N=!1,F=!1,U=100;function H(e){const{peer:t}=e.get();(0,m.isFullyLoadedTab)(e,t)&&!(0,m.isAnyMessageBeingEdited)(e)&&Date.now()-((0,m.getTab)(e,t).lastTyping||0)>1e3*_.ACTIVITY_PERIOD&&e.set(_.sendRecordingAudio.bind(null,t))}function j(e){if(F)return;F=!0,(0,m.lockButton)(E);let t={peer:k.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise(((t,s)=>{let i=e.getFormData(),a=new O;a.onload=a.onerror=function(e){let i=e.currentTarget.response;200==this.status&&i.length>0&&"{"==i[0]?(i=JSON.parse(i),t(i)):s()},a.open("POST",x.upload_url,!0),a.send(i)}))})(e).then((e=>e.file?new Promise(((s,i)=>{ajax.post("/docs.php",(0,u.extend)({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,i)=>{$(),A([["doc",e+"_"+i,"audiomsg"]],{},t.peer),X(),s()},onFail:function(e){i(e)},progress:null})})):Promise.reject())).then((()=>{(0,m.unlockButton)(E),F=!1})).catch((()=>{F=!1,(0,m.unlockButton)(E),(0,p.showFastBox)(o.getLang("global_error"),o.getLang("mail_audio_message_upload_error"))}))}function V(){R(),v.innerHTML=B(N.duration),N.duration>=D&&Q()}function q(e){e.set(_.cancelRecording).then(z)}function G(){R(),Promise.all([(0,h.voiceMessagePlayerLoader)(),(0,h.speechLoader)()]).then((()=>{N||(N=Speech.newRecorder(),(0,c.addEvent)(N,"progress",V)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),N.record().then((()=>{var e;e=k,x.isRecording=!0,(0,n.cancelStackPush)("audio_message_cancel",q.bind(null,e)),(0,r.hideProgress)((0,d.geByClass1)("im-audio-message-send-wrapper",f)),v.innerHTML="0:00",(0,d.addClass)(f,"im-audio-message_recording"),(0,d.removeClass)(f,"im-audio-message_recorded"),function(){f&&f.classList&&f.classList.remove("im-audio-message-input--hidden");(0,d.geByClass1)("_im_chat_input_parent",I).classList.add("im-chat-input--hidden")}(),P=window.Speech.createVisualization("wave",N.source,b,{color:getComputedStyle(document.body).getPropertyValue("--white")}),P.start();let t=b.getBoundingClientRect();U=(t.right-t.left)/3})).catch((e=>{let t;switch(AudioMessagePlayer.resumeGlobalMedia(),e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t=o.getLang("mail_audio_message_device_error");break;case"PermissionDeniedError":case"PermissionDismissedError":t=o.getLang("mail_audio_message_permission_error");break;case"Unsupported":t=o.getLang("mail_audio_message_unsupported_error");break;default:t=o.getLang("global_unknown_error")}(0,p.showFastBox)(o.getLang("global_error"),t),console.error(e)}))}))}function K(){N&&N.stop(),P&&(P.destroy(),P=null)}function $(){x.isRecording=!1,(0,n.cancelStackFilter)("audio_message_cancel")}function W(){Y(),j(N)}function Y(){AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),(0,c.removeEvent)(N,"finish",Y),(0,c.removeEvent)(N,"finish",W),function(e){let t=URL.createObjectURL(N.buffer);(0,d.domData)(M,"duration",N.duration),(0,d.domData)(M,"ogg",t),(0,d.domData)(M,"mp3",t),(0,d.geByClass1)("audio-msg-track--duration",M).innerHTML=B(N.duration),(0,d.geByClass1)("audio-msg-track--wave-wrapper",M).innerHTML=AudioMessagePlayer.getWave(N.wave,U)}(),(0,d.removeClass)(f,"im-audio-message_recording"),(0,d.addClass)(f,"im-audio-message_recorded")}function z(e=!0){$(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),(0,c.removeEvent)(N,"finish",Y),(0,c.removeEvent)(N,"finish",W),K(),X(),e&&L()}function Z(){N.isRecording?((0,c.addEvent)(N,"finish",W),(0,c.removeEvent)(N,"finish",Y),K()):j(N)}function Q(){(0,c.addEvent)(N,"finish",Y),(0,c.removeEvent)(N,"finish",W),K()}function X(){(0,d.removeClass)(f,"im-audio-message_recorded"),(0,d.removeClass)(f,"im-audio-message_recording"),f&&f.classList&&f.classList.add("im-audio-message-input--hidden"),(0,d.geByClass1)("_im_chat_input_parent",I).classList.remove("im-chat-input--hidden")}function J(){S=(0,d.ge)("audiomsg_record"),M=(0,d.ge)("audiomsg_player"),I=(0,d.geByClass1)("_im_chat_input_w"),f=(0,d.geByClass1)("im-audio-message-input",I),v=(0,d.geByClass1)("audio-msg-track--duration",f),b=(0,d.geByClass1)("audio-msg-track--wave",f),w=(0,d.geByClass1)("im-audio-message--cancel-btn",f),E=(0,d.geByClass1)("_im_audio_send",f),C=(0,d.geByClass1)("audio-msg-track--btn",f),T=(0,d.geByClass1)("im-chat-input--text",I);let e=(0,d.geByClass1)("im-chat-input--textarea",I);(0,d.addClass)(e,"_voice_field_wrap"),(0,c.addEvent)(y,"click",G),(0,c.addEvent)(w,"click",z),(0,c.addEvent)(E,"click",Z),(0,c.addEvent)(C,"click",Q)}function ee(){!function(){N&&(0,c.removeEvent)(N,"progress",V);(0,c.removeEvent)(y,"click",G),(0,c.removeEvent)(w,"click",z),(0,c.removeEvent)(E,"click",Z),(0,c.removeEvent)(C,"click",Q)}(),S=M=f=v=b=y=w=E=C=null}function te(e,t,s){return{cancelRecording:z,start:function(){G()},unmount(){z(!1),ee()}}}function se(e,t,s,a,n){k=t,x=t.get().audio_msg,R=H.bind(null,t),A=s,L=n,(0,g.initFailBack)(),(0,m.getAvailableMicrophones)().then((e=>{const s=e.length>0;s?(J(),a()):(0,l.setCookie)("remixvoice","0",7),t.set(_.setVoiceMessageAvail.bind(null,s))})).catch((e=>{throw(0,l.setCookie)("remixvoice","0",7),e}));let{bindMutations:o}=(0,i.createMutations)(te);return o(e,t,s)}},718898:(e,t,s)=>{"use strict";s.d(t,{default:()=>a});var i=s(452314);const a={onNewMessagesChunk:function(e){const t=(0,i.geByClass)("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach((e=>LongView.register(e,"im")))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}}},491677:(e,t,s)=>{"use strict";s.d(t,{mount:()=>x});var i=s(241750),a=s(7144),n=s(879007),o=s(452314),r=s(317412),l=s(485413),c=s(583790),d=s(948350),u=s(958145),_=s(365485),g=s(822317),m=s(387674),p=s(507035),h=s(810903),f=s(610989),v=s(388078);const b="RightMenuBlockInfo",y="RightMenuBlockInfo__averageTimeHint",w="RightMenuBlockInfo__mute",E="RightMenuBlockInfo__mute--hidden",C="RightMenuBlockInfo__mute--muted",S=Object.values(g.ConvoListFolder);function T(e){let t=e.get().tabbedPeers.map((t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer])).filter((e=>e)).filter((e=>!e.deletedDialog)).map((({peerId:e})=>({type:"peer",peer:e})));return t.length>0&&(t=[{type:"sep"}].concat(t)),t}function I(e,t){if("sep"===t.type)return(0,n.getTemplate)("im_right_menu_sep",{});let s=`${(0,c.getBaseLink)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,i=(0,c.getBareTab)(t.peer,e),o=v.Ranges.isContactId(t.peer)?(0,c.prepareContactName)(i.tab):i.tab,r="";switch(!0){case i.unread>0:r=i.unread;break;case(0,c.isTabMarkedUnread)(i):r=1}return r=(0,n.getTemplate)("im_right_menu_ct",{count:r}),(0,n.getTemplate)("im_right_menu_tpl",{href:s,label:o,peer:t.peer,attrs:`title="${(0,a.stripHTML)(i.tab)}"`,cls:i.unread>0?"im-right-menu--unread":"",extra:r})}function k(e,t,s,i){let a=(0,o.gpeByClass)("_im_peer_tab",i),l=(0,n.intval)((0,o.domData)(a,"list-id")),c=e.get().tabbedPeers.filter((({peer:e})=>e!==l));return e.set(d.updateTabbedPeers.bind(null,c,!0)).then((()=>{M(t,e),l===e.get().peer&&e.get().longpoll.push([(0,u.resetPeer)()])})),(0,r.cancelEvent)(s),!1}function M(e,t){return e.pipeReplace(Promise.resolve(T(t)))}function P(e,t,s,i){return{updateMenu(t){!function(e,t){(0,o.geByClass)("_im_peer_tab",e).forEach((e=>{let s=(0,m.fromQueryString)((0,o.attr)(e,"href").split("?")[1]);s.tab!==t.get().active_tab&&(0,o.attr)(e,"href",`${(0,c.getBaseLink)(t)}?sel=${s.sel}&tab=${t.get().active_tab}`)}))}(e,t);const i=(0,o.gpeByClass)("_im_right_menu",e);M(s,t).then((()=>{let e;e=t.get().peer?(0,o.ge)("ui_rmenu_peer_"+t.get().peer):(0,o.ge)("ui_rmenu_"+t.get().active_tab),e&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(i)}))},updateName(e,t){let s=(0,o.ge)("ui_rmenu_peer_"+e);if(s){let i=(0,o.geByClass1)("ui_rmenu_label-text",s),a=t.get().tabs[e].tab;(0,o.val)(i,a)}},updateCounter(e,t){let s=(0,o.ge)("ui_rmenu_peer_"+t);if(s){let i=(0,o.geByClass1)("_im_r_ct",s);const a=(0,c.getTab)(e,t);let n="";switch(!0){case a.unread>0:n=a.unread;break;case(0,c.isTabMarkedUnread)(a):n=1}(0,o.val)(i,n),s.classList.toggle("im-right-menu--unread",a.unread>0||(0,c.isTabMarkedUnread)(a))}},unmount(){(0,_.destroyModule)(i),s.unmount()}}}function A(e,t,s){1===s.which&&(e.get().peer&&e.get().longpoll.push([(0,u.resetPeer)()]),e.get().longpoll.push([(0,u.changeTab)(t)]),(0,r.cancelEvent)(s))}function L(e){(0,h.showTooltip)(e.currentTarget,{text:f.getLang("mail_admin_av_time"),dir:"bottom",needLeft:!0,typeClass:"tt_default_right RightMenuBlockInfo__averageTimeTooltip",width:210,shift:[-14,8],slide:15})}function R(e,t,s){e.set((e=>(0,d.toggleCommunityMute)(!t,e))).then((()=>s.classList.toggle(C,e.get().mute)))}function x(e,t,s){let a=(0,i.mount)(e,(0,l.default)({limit:50,offset:0,noScroll:!0,elements:T(t)}),(()=>({idFn:e=>e.peer||"000",renderFn:I.bind(null,t)}))),d=k.bind(null,t,a);const g=(0,o.geByClass1)(b),m=(0,o.geByClass1)(y,g),h=(0,o.geByClass1)(w,g),f=(0,_.createModule)({handlers:(s,i)=>{i(e,"click","_im_r_cl",d),i(e,"click","_im_peer_tab",((e,s)=>{if((0,r.checkEvent)(e))return;const i=(0,n.intval)((0,o.domData)(s,"list-id"));(0,p.unpackStore)(t).longpoll.push([(0,u.changePeer)(i,!1,!0,!0,"right_menu")]),(0,r.cancelEvent)(e)})),S.forEach((i=>{s((0,o.geByClass1)(`_ui_item_${i}`,e.parentNode),"mousedown",A.bind(null,t,i))})),m&&s(m,"mouseover",L),(0,c.isCommunityInterface)(t)&&h&&s(h,"click",(e=>R(t,!1,e.currentTarget)))}});return(0,c.isCommunityInterface)(t)&&h&&(R(t,!0,h),h.classList.remove(E)),P(e,0,a,f)}},429061:(e,t,s)=>{"use strict";s.d(t,{CONVO_MORE_CLASS:()=>M,mount:()=>Y});var i=s(948350),a=s(723561),n=s(879007),o=s(693143),r=s(583790),l=s(348089),c=s(365485),d=s(860404),u=s(102104),_=s(77294),g=s(756758),m=s(248782),p=s(803898),h=s(958145),f=s(368759),v=s(810903),b=s(610989),y=s(659557),w=s(822317),E=s(452314),C=s(52554),S=s(934052),T=s(699584);const I=(0,m.debounce)(_.statlogsProbValueEvent,1e3),k="_im_gim_mute",M="_im_search_more",P="_im_search_cancel",A="im-dialog-select_rotated",L="im-dialog-select_hidden",R="_im_dialogs_header_controls",x="im-page--dialogs-header-controls_hidden",D="_im_search_more_action",O="_im_create_convo",B="_im_create_call",N="_im_peer_tags_filter_control",F="_im_peer_tags_filter_checkbox",U="_im_peer_tags_filter_pane_item";function H(e,t,s,r,l,c,d){const u=(0,n.trim)(c);if((0,o.isSearchingValue)(e,u)){const s=()=>d.clearSearch(e,t);u?(e.setState({recentSearch:!1}),l.stop()):l.replaceOrAdd(s),(0,a.cancelStackPush)("im_search",s),u&&e.set((e=>(0,i.setCurrentSearch)(u,!1,e))).then(t),r.classList.add("im-page--dialogs-search_fill","_im_d_search"),(0,C.isCommunityInterface)(e)||d.showCancelControl()}else u||(l.stop(),e.set((e=>(0,i.setCurrentSearch)("",!1,e))).then(t),r.classList.remove("im-page--dialogs-search_fill","_im_d_search"),(0,C.isCommunityInterface)(e)||d.hideCancelControl())}function j(e,t,s){return function(...i){(0,o.getSearchText)(t)===e&&s(...i)}}function V(e,t,s){const a=(0,o.getSearchText)(s);return I(.01,"im_search_stat",1,"search_start"),(0,i.updateSearchQuery)(a),s.setState({recentSearch:!1}),e().toggleSettingsButton(s,!!a),a?(s.get().dialog_search_going=!0,function(e,t,s){const a=j(e,s,(e=>t().appendFastDialogs(s,e)));return(0,i.searchTopConv)(e,s.get()).then((e=>{const t=e.filter((e=>"/images/deactivated_50.png"!==e.photo||"DELETED"!==e.tab));return a(t),t}))}(a,e,s).then((i=>{const n=i.map((e=>e.peerId));return t(a,e,n,s)})).then((()=>{s.get().dialog_search_going=!1})).catch((()=>{}))):(e().restoreDialogs(s,!1,!0),(0,g.removeSearchPositionTracker)("messages"),Promise.resolve(!1))}function q(e,t,s,a){const n=a.get(),o=j(e,a,(e=>t().appendDialogs(a,e))),l=j(e,a,t().appendSearch);return(0,r.isPendingForward)(a)?(0,i.searchHints)(e,s,"all",{},n).then(o):Promise.all([(0,i.searchHints)(e,s,"all",{},n).then(o),(0,i.searchMessages)(e,n)]).then((([,[e,t]])=>{l(a,e,t,!0)}))}function G(e,t,{target:s}){e.set((e=>(0,i.toggleCommunityMute)(t,e))).then((()=>{s.classList.toggle("im-page--gim-mute_muted",e.get().mute),t&&K(e,{target:s})}))}function K(e,{target:t}){return(0,v.showTooltip)(t,{text:()=>e.get().mute?b.getLang("mail_im_sound_off"):b.getLang("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function $(e,t,s,i,a,n){switch(a){case"contacts":i.show();break;case"favorites":nav.go("/im?box=fav");break;case"spam":(0,r.showSpamLayer)(t,d.mount,n);break;case"settings":s.show();break;case w.ConvoAction.CALL_AUDIO:case w.ConvoAction.CALL_VIDEO:case w.ConvoAction.CALL_APP:(0,r.startCallFromIm)(t,null,a===w.ConvoAction.CALL_VIDEO,[],r.CALL_ENTRY_POINT_LIST,a===w.ConvoAction.CALL_APP);break;case w.ConvoAction.CALL_BY_NAME:(0,r.startCallFromIm)(t,null,!1,null,r.CALL_ENTRY_POINT_LIST,!1,!0);break;case w.ConvoAction.BUSINESS_NOTIFY:case w.ConvoAction.ARCHIVE:{if(t.get().active_tab===a)break;if(e().toggleFolder(t,a),(0,o.isClassicInterface)(t)){const e=document.getElementById(`ui_rmenu_${a}`);e?S.default.switchMenu(e):S.default.unselectAll(document.querySelector("._im_right_menu"))}const s=n.target.closest("._ui_menu_wrap");s&&uiActionsMenu.hide(s);break}}}function W(e,t,s,i,n,o,r,l,d,u,_,g){return{focusInput(){uiSearch.focus(i.parentNode)},hideCancelControl(){s.classList.remove(x),t.classList.add(L),t.classList.remove(A)},showCancelControl(){s.classList.add(x),t.classList.add(A),t.classList.remove(L)},setSearch(e,t,s=!1){const a=s?u:()=>{};i.value=t,H(e,a,0,i,o,t,d())},clearSearch(e,t){(0,a.cancelStackFilter)("im_search"),(0,C.isCommunityInterface)(e)||d().hideCancelControl(),uiSearch.reset(i),e.setState({recentSearch:!1}),H(e,t||(()=>{}),0,i,o,i.value,d())},initPeerTagsFilter(e){(0,y.initPeerTagsFilter)(e)},applySearchAction(e,t,s){$(r,e,_,g,t,s)},openSettings(){_.show()},unmount(){o.stop(),_.hide(),(0,c.destroyModule)(l),uiSearch.destroy(n),(0,a.cancelStackFilter)("im_search")}}}function Y(e,t,s){const{callMutations:a,bindMutations:n}=(0,c.createMutations)(W),d=new u.Settings(t,s),_=new T.ContactList(t,s),g=(0,E.geByClass1)(R,e),m=(0,E.geByClass1)(O,e),w=(0,E.geByClass1)(B,e),S=(0,E.geByClass1)(P,e),I=(0,E.ge)("im_dialogs_search",e),A=(0,E.geByClass1)(k,e),L=(0,E.geByClass1)("_im_av_time",e),x=(0,E.geByClass1)(N,e),j=(0,E.geByClass1)(M,e),Y=(0,l.default)("im_search",[M,O,B,"_im_page_dcontent","_im_d_search","_im_dialog"]),z=(0,p.debouncedPromise)(q,300),Z=e=>V(s,z,e),Q=e=>H(t,Z,0,I,Y,e,a()),X=()=>a().clearSearch(t,Z),J=(0,E.geByClass1)("_im_dialogs_search_input",e);uiSearch.init(J,{onChange:Q}),I.value&&setTimeout((()=>Q(I.value)),0);const ee=e=>{(0,v.showTooltip)(e.target,{text:b.getLang("mail_admin_av_time"),dir:(0,E.geByClass1)("_im_top_notice")||(0,E.geByClass1)("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})},te=()=>{let e;e=0===t.get().peer||(0,r.isPendingForward)(t)?"search":"default",(0,o.isSearching)(t)||s().toggleSettingsButton(t,!1),t.get().longpoll.push([(0,h.transitionEvent)(e)])},se=()=>{(0,o.isSearching)(t)&&s().toggleSettingsButton(t,!0),function(e,t,s,a,n,l){if((0,o.isSearching)(e))return;const c=cur.imDb.select(f.RECENT_SEARCH_OP);if(0===c.length&&!(0,o.doPopularSuggExist)(e))return;e.setState({recentSearch:!0}),H(e,(()=>{(0,o.isSearching)(e)||(a.stop(),n().toggleSettingsButton(e,!1),n().restoreDialogs(e,!1,!0))}),0,s,a,"",l);const d=c.filter((t=>!(0,r.isTabLoadedWithMessage)(e.get(),t))),u=c.filter((t=>(0,r.isTabLoadedWithMessage)(e.get(),t))).reduce(((t,s)=>(t[s]=(0,o.getTab)(e,s),t)),{});e.get().topConvTree.then((t=>{const s=t.list.filter((e=>d.includes(e[0]))).reduce(((e,t)=>(e[t[0]]=(0,i.localIndexToDialog)(t),e)),{}),a={...s,...u};return n().appendFastDialogs(e,c.map((e=>a[e]))),s})).then((t=>(0,i.searchHints)("",Object.keys(t),!1,{},e.get()))).then((t=>{n().appendDialogs(e,t)}))}(t,0,I,Y,s,a())},ie=(e,i)=>{const a=i.dataset.action;$(s,t,d,_,a,e)},ae=(0,c.createModule)({handlers:(i,a)=>{i(S,"click",X),i(S,"mouseover",(()=>function(e,t){return(0,v.showTooltip)(t,{appendEl:document.body,text:b.getLang("mail_cancel"),black:1,shift:[3,-1],appendCls:"js-im-page"})}(0,S))),i(m,"click",(()=>s().showCreation(t))),(0,E.domData)(w,"disable-click")||i(w,"click",(()=>{(0,r.startCallFromIm)(t,null,!1,null,r.CALL_ENTRY_POINT_LIST)})),a(e,"click",D,ie),L&&i(L,"mouseover",ee),(0,C.isCommunityInterface)(t)&&A&&(i(A,"click",(e=>G(t,!0,e))),i(A,"mouseover",(e=>K(t,e)))),i(I,"click",se),i(I,"blur",te),i(I,"focus",(()=>{t.get().longpoll.push([(0,h.transitionEvent)("search")])})),i(j,"mouseenter",(e=>{const s=j.parentNode;s.querySelector("._is_active")?.classList.remove("_is_active"),s.querySelector(`[data-action='${t.get().active_tab}']`)?.classList.add("_is_active")})),(0,C.isCommunityInterface)(t)&&x&&(a(e,"change",F,(e=>(0,y.onPeerTagsFilterCheckboxChange)(e,t))),a(e,"click",U,(e=>(0,y.onPeerTagsFilterPaneItemClick)(e,t))))}});return(0,C.isCommunityInterface)(t)&&(x?(0,y.initPeerTagsFilter)(t):A&&G(t,!1,{target:A})),n(e,S,g,I,J,Y,s,ae,a,Z,d,_)}},629596:(e,t,s)=>{"use strict";s.d(t,{doesSearchResultContainConversations:()=>_,mount:()=>g});var i=s(507035),a=s(452314),n=s(879007),o=s(365485),r=s(948350),l=s(583790),c=s(958145);function d(e,t,s,o){let d=(0,n.intval)((0,a.domData)(o,"msgid"));if((0,i.getSelectionText)())return;if((0,l.checkSelectClick)(s))return;let u=(0,n.intval)((0,a.domData)(o,"peer"));return e.set(r.cancelSearch.bind(null,u)),e.get().longpoll.push([(0,c.changePeer)(u,d,!1,!1,t)]),!1}function u(e,t){return{isAll:e=>(0,r.isSearchAllLoaded)(e.get().peer,e.get()),loadMore:e=>function(e){return(0,r.isSearchAllLoaded)(e.get().peer,e.get())?Promise.resolve(""):(0,r.searchMessagesInplace)(e.get().peer,e.get())}(e),unmount(){(0,o.destroyModule)(t)}}}function _(e){return e.findIndex((e=>"number"==typeof e.peerId&&e.href))>-1}function g(e,t,s){let i=d.bind(null,t,s);return u(0,(0,o.createModule)({handlers:(t,s)=>{s(e,"click","_im_mess",i)}}))}},373155:(e,t,s)=>{"use strict";s.d(t,{mount:()=>f});var i=s(365485),a=s(610989),n=s(879007),o=s(452314),r=s(583790),l=s(948350),c=s(693143),d=s(922201),u=s(300909),_=s(388078),g=s(815019);const m="_im_retry_media",p="_im_replied_message";function h(e,t,s,i,h){if((0,l.isSearchingInplace)(e.get().peer,e.get()))return;if((0,o.hasClass)(h,r.FAILED_CLASS)||(0,o.hasClass)(h,r.SENDING_CLASS)||(0,o.hasClass)(h,"_im_mess_srv"))return;if((0,r.checkSelectClick)(i,h)||(0,c.isAnyMessageBeingEdited)(e))return;if("A"===i.target.tagName)return;if((0,o.domClosest)(p,i.target))return;if(i.target.classList.contains(m))return;if((0,g.checkStopActionOnEventOnSticker)(i))return;if(i.target.closest("."+r.MESSAGE_KEYBOARD_BUTTON_CLASS))return;if(i.target.closest("."+r.BOT_CAROUSEL_CLASS))return;if(i.target.closest("."+d.WIDGET_ACTIONS))return;if(i.target.closest("."+r.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON))return;if(i.target.classList.contains(u.AUDIO_MSG_AUTOSHOW_SETTING_HINT))return;if((0,o.domClosest)("scroll-button--right",i.target)||(0,o.domClosest)("scroll-button--left",i.target))return;const f=(0,n.intval)((0,o.domData)(h,"msgid")),v=e.get().peer;if((0,r.isAlreadyDeleted)(e,v,f))return;let b,y;b=i.shiftKey?(0,c.getMessageRangeFromSelection)(e,v,f):[f],e.set(l.addSelection.bind(null,b)).then((()=>{const i=(0,c.getSelectedMessages)(e);let r=!1;b.forEach((e=>{const t=(0,o.geByClass1)("_im_mess_"+e,s);if(t){const s=(0,n.inArray)(e,i);r|=s,(0,o.toggleClass)(t,"im-mess_selected",s);let l=s?a.getLang("mail_deselect_message"):a.getLang("mail_select_message");const c=(0,o.geByClass1)("_im_mess_blind_label_select",t);(0,o.attr)(c,"aria-label",l)}})),r&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)})).then((()=>{1!==e.get().selectedMessages.length||y?y&&y.hide():y=function(e){const t=e.get();if(t.pinnedMessagesPromo&&_.Ranges.isChatOrChannelPeer(t.peer)){const t=(0,o.geByClass1)("_mess-action-promo"),s=new ElementTooltip(t,{autoShow:!1,appendTo:t,content:(0,n.getTemplate)("im_pinned_messages_promo",{content:a.getLang("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),(0,l.hidePromoTooltip)()}});return s.show(),s}}(e)}))}function f(e,t,s){const a=h.bind(null,t,s,e),n=(0,i.createModule)({handlers:(t,s)=>{s(e,"click","_im_mess",a)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map((t=>(0,o.geByClass1)("_im_mess_"+t,e))).filter((e=>e)).forEach((e=>(0,o.removeClass)(e,"im-mess_selected")))},unmount(){(0,i.destroyModule)(t)}}}(e,n)}},103275:(e,t,s)=>{"use strict";s.d(t,{mount:()=>b});var i=s(365485),a=s(610989),n=s(452314),o=s(583790);const r="._im_sick_reload",l="._im_sick_timer",c=5e3,d=6e5,u=30,_=400;let g,m;function p(e){const t=(0,n.ge)("page_header"),s=(0,n.clientHeight)()-t.offsetHeight-u-2,i=_;(0,n.setStyle)(e,{height:Math.max(s,i)})}function h(e){const t=(0,o.formatTimespan)(Math.floor(Math.max(e,0)/1e3),!0);return t?a.getLang("mail_sick_timer").replace(/{timer}/gi,t):""}function f(){nav.reload({force:!0})}function v(e){return{unmount(){clearInterval(m),clearTimeout(g),(0,i.destroyModule)(e)}}}function b(e,t,s){p(e);const{bindMutations:a}=(0,i.createMutations)(v),n=a((0,i.createModule)({handlers:(t,s)=>{t(e.querySelector(r),"click",f),t(window,"resize",p.bind(null,e))}})),o=function(){const e=localStorage.getItem("im_sick_timer"),t=e?Math.min(2*parseInt(e),d):c;return localStorage.setItem("im_sick_timer",t),t}(),u=e.querySelector(l),_=+new Date;return u.innerHTML=h(o),m=setInterval((()=>{u.innerHTML=h(_+o-new Date)}),500),g=setTimeout(f,o),n}},860404:(e,t,s)=>{"use strict";s.d(t,{mount:()=>A});var i=s(317412),a=s(610989),n=s(850101),o=s(879007),r=s(452314),l=s(20025),c=s(948350),d=s(583790),u=s(365485),_=s(373155),g=s(485413),m=s(958145),p=s(459373),h=s(258643),f=s(460241);const v="_im_spam_not_spam",b="_im_spam_spam",y="_im_spam_flush";function w(e,t,s,i){if(e.loading||e.all)return;if(s.scrollTop+window.innerHeight-s.scrollHeight>-300){let s=(0,r.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,d.wrapLoading)(s)((0,c.loadSpam)(e.offset,i.get().gid).then((([t,a,n,o])=>{e.all=o.all,e.offset=o.offset,e.all?(0,r.addClass)(s,"im-important_all"):e.loading=!1,i.set((e=>(0,c.mergeTabs)(e,(0,d.tabFromIds)(o.msgs,o.hash))));let l=(0,r.ce)("div");l.innerHTML=a,s.appendChild(l),(0,p.ensureDomHasActions)(s)})),"bottom")}}function E(e,t){let s=t.get().selectedMessages,i=(0,r.geByClass1)("_im_spam_box",e.bodyNode),n=(0,r.geByClass1)("ui_tab_sel",e.bodyNode);if(s.length>0){let e=a.getLang("mail_selected",s.length);e=e.replace("{count}",s.length),(0,r.val)(n,e+function(){const e=(0,f.getIcon16Cancel)().icon;return`<button aria-label="${a.getLang("mail_deselect_all")}" type="button" class="im-deselect ${d.DESELECT_ALL_CLASS}">${e}</button>`}())}else(0,r.val)(n,a.getLang("mail_spam"));if(0===s.length)(0,r.removeClass)(i,"im-important-box_with-sel");else{(0,r.addClass)(i,"im-important-box_with-sel");const e=document.querySelector(`.${b}`),t=document.querySelector(`.${v}`);e&&t&&(h.FlatButton.setLabel(e,a.getLang("mail_im_mark_delspam",s.length)),h.FlatButton.setLabel(t,a.getLang("mail_im_mark_notspam",s.length)))}}function C(e,t,s){let i=e.get().selectedMessages;e.set(c.cleanSelected).then(s.cleanSelection.bind(null,i)).then((s=>E(t,e)))}function S(e,t,s,i){let a=(0,r.gpeByClass)("_im_mess",i,t);if(!a)return;let n=(0,o.intval)((0,r.domData)(a,"msgid"));a&&((0,c.removeMessageSend)([n],0,e.get().tabs[0].hash,"undel",e.get()),(0,d.restoreMessage)(n,0,t))}function T(e,t,s){let i=e.get().selectedMessages;(0,c.removeMessageSend)(i,0,e.get().tabs[0].hash,"delete",e.get()),(0,d.removeMessagesWithRestore)(i,0,"delete",t),C(e,t,s)}function I(e,t,s){let i=e.get().selectedMessages;(0,c.removeMessageSend)(i,0,e.get().tabs[0].hash,"nospam",e.get()),i.map((e=>(0,r.geByClass1)("_im_mess_"+e))).filter((e=>e)).forEach((e=>{let t=(0,o.intval)((0,r.domData)(e,"peer")),s=(0,o.intval)((0,r.domData)(e,"msgid"));(0,r.val)(e,(0,d.renderGoTo)(t,s)),(0,r.addClass)(e,"im-mess_light")})),C(e,t,s)}function k(e,t,s,a,n){let l=(0,r.gpeByClass)("_im_mess",n,t.bodyNode),c=(0,o.intval)((0,r.domData)(l,"peer")),d=(0,o.intval)((0,r.domData)(l,"msgid"));return t.hide(),s().unmount(),e.get().longpoll.push([(0,m.changePeer)(c,d,!1,!1,"spam_box")]),(0,i.stopEvent)(a),(0,i.cancelEvent)(a),!1}function M(e,t,s,i){const o=(0,l.showFastBox)({title:a.getLang("mail_deleteall1"),bodyStyle:"padding: 20px; line-height: 160%;"},a.getLang("mail_delete_all_spam"),a.getLang("mail_delete"),(()=>{(0,c.flushSpam)(e,i).then((([e,t])=>{(0,n.showDoneBox)(t)})),o.hide(),t.hide(),s().unmount()}),a.getLang("mail_close"),(()=>o.hide()))}function P(e,t){return{unmount(){t.unmount(),(0,u.destroyModule)(e)}}}function A(e,t,s){let i=(0,r.ge)("box_layer_wrap"),{callMutations:a,bindMutations:n}=(0,u.createMutations)(P),o=(0,g.default)({peer:0,oCache:{},tabs:(0,d.tabFromIds)(s.msgs,s.hash),gid:t.get().gid}),l=w.bind(null,{all:s.all,loading:!1,offset:s.offset},e,i,o),c=S.bind(null,o,e.bodyNode),m=k.bind(null,t,e,a),h=M.bind(null,s.hash,e,a,t.get().gid),f=(0,_.mount)(e.bodyNode,o,(t=>({changedMessageSelection:E.bind(null,e)}))),A=T.bind(null,o,e.bodyNode,f),L=I.bind(null,o,e.bodyNode,f),R=C.bind(null,o,e,f);(0,p.ensureDomHasActions)(e.bodyNode);return n((0,u.createModule)({handlers:(t,s)=>{t(i,"scroll",l),s(e.bodyNode,"click",b,A),s(e.bodyNode,"click",v,L),s(e.bodyNode,"click",y,h),s(e.bodyNode,"click",d.RESTORE_CLASS,c),s(e.bodyNode,"click","_im_go_to",m),s(e.bodyNode,"click",d.DESELECT_ALL_CLASS,R)}}),f)}},107850:(e,t,s)=>{"use strict";s.d(t,{mount:()=>Tt});var i=s(891911),a=s(723561),n=s(618913),o=s(317412),r=s(452314),l=s(879007),c=s(67244),d=s(43658),u=s(938900),_=s(948350),g=s(583790),m=s(77294),p=s(693143),h=s(205184),f=s(58318),v=s(5998),b=s(507035),y=s(365485),w=s(8520),E=s(20025),C=s(810903),S=s(645024),T=s(967886),I=s(248782),k=s(156340),M=s(656405),P=s(523977),A=s(699615),L=s(336476),R=s(406760),x=s(963856),D=s(201193),O=s(958145),B=s(531868),N=s(52554),F=s(927984),U=s(476726),H=s(411953),j=s(349333),V=s(911575),q=s(388078),G=s(634180),K=s(598824),$=s(134015);const W=4,Y=5,z=6,Z=7,Q=9,X=11,J=12,ee=13,te=14,se=16,ie=19,ae=20,ne=23,oe=26,re=28,le=29,ce=62,de=65,ue=2e3,_e="_im_media_selector",ge="_im_media_fwd",me="_im_replied_content",pe="_im_fwd_close",he="_im_remove_replied",fe="_im_peer_mute_unmute",ve="_im_peer_return_to_chat",be="_mr_button_accept",ye="_mr_button_reject",we="_im_submit_btn",Ee="_im_media_preview",Ce="_im_chat_audio_input_parent",Se="MassMentionWarning",Te="MassMentionWarning--hidden",Ie="MassMentionWarning__close",ke="app_action_mini_apps",Me="app_action_mini_apps_ab_direct",Pe="app_action_mini_apps_ab_chat";function Ae(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function Le(e,t,s,a,n,o,r=!0){if(dt(t,a))return Promise.resolve(!1);let c=Ue(a);const d=(0,p.getTab)(a,t);c.getBoundAttach(s.message)&&!/^https:\/\/(\w)+se\.mvk\.com\//.test(s.message)&&(s.message=""),s.share_url=c.getShareUrl(),s.cancelled_shares=c.getCancelledShares();let u=(0,v.random)();const _=s.attaches.map((e=>({id:e[1],type:e[0],kind:e[2]||null})));let m={peerId:t,messageId:"rid"+u,flags:i.FLAG_OUTBOUND,date:(0,l.intval)(Date.now()/1e3)-a.get().timeshift,subject:"",text:(0,g.replaceSpecialSymbols)((0,l.clean)(s.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:a.get().gid?vk.id:null},type:i.ADD_MESSAGE,attaches:_,minorSortId:d.minor_sort_id};(0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,L.isMarusiaPeer)(t)&&(m.kludges.payload=s.payload);return _.find((e=>"sticker"===e.type))&&(m.kludges.attachments=JSON.stringify([{type:"sticker",isLocalRender:s?.isLocalRender,sticker:{popup:{layers:s?.layers}}}])),(0,U.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog[u]=[{text:m.text,timestamp:Date.now(),ts:window.lpConnect.options.ts}]),s.rid=u,s.mess=m,e(t,s),a.get().longpoll.push([m]),r&&o().clearText(t,a),n().newMessage(a),Promise.resolve(!0)}function Re(e,t,s,i,a,o,r,c=!1){c||(c=e.get().peer);const d=Ue(e),u=xe(d,r),_=u?d.dData.attaches.map((e=>[e.type,e.id])):[],g={message:"",attaches:[].concat(_,o)};r&&(0,l.extend)(g,r),De(e,t,!1).then((()=>Le(s,c,g,e,t,i,!1).then((s=>(u&&Ze(e,a,t),Promise.resolve(s)))))).catch((t=>{(0,n.debugLog)(t),Fe(e,a)}))}function xe(e,t){const s=e.dData,i=t&&t.sticker_referrer,a=i&&0===i.indexOf("suggestion"),n=t&&t.is_hintach_item;return(!s.txt.trim()||a||n)&&0===s.attaches.filter((e=>"reply"!==e.type)).length}function De(e,t,s){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(_.changePeer.bind(null,e.get().peer,!1,!1)).then((()=>e.set((t=>(0,V.loadPeer)(t,e.get().peer,-1,!0,!1,"toEnd"))))).then((()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),s)))):Promise.resolve(s)}function Oe(e,t,s){const i=!!(0,l.intval)((0,r.domData)(s,"val"));i!==cur.ctrl_submit&&(cur.ctrl_submit=i,(0,H.setInfo)("messages_multiline_input",String(Number(i))).then((()=>{})),e.set((e=>(0,j.setLocalSettingsValue)("ctrl_submit",Number(i),e))))}function Be(e,t,s,i){return!e.get().delayed_ts&&setTimeout((()=>{e.set(_.setDelayedMessage.bind(null,!1,!1)).then((()=>{s(...i)}))}),t)}function Ne(e=S.getLang("mail_send_error")){const t=S.getLang("global_error");(0,E.showFastBox)({title:t},e,S.getLang("mail_ok"),(()=>{nav.reload({force:!0})}))}function Fe(e,t){document.activeElement&&document.activeElement.blur(),Ne();let s=(0,r.geByClass1)("_im_send",t);return e.set(_.toggleSendingAbility.bind(null,!0)).then((()=>{(0,g.lockButton)(s)}))}function Ue(e){return e.get().tfdraft||new P.ImDraft}function He(e,t,s,i,a,o){const l=(0,N.getPeer)(e),c=(0,p.getCurrentKeyboard)(e)||{},{one_time:d=!1}=c,u=(0,r.geByClass1)("_im_send",i);return Promise.resolve().then((()=>{if((0,p.isSendingAvailable)(e)){if((0,_.isAnythingLoading)(e.get())||!(0,g.isFullyLoadedTab)(e,e.get().peer)){let t=Be(e,ue,He,(0,b.toArray)(arguments));return e.set(_.setDelayedMessage.bind(null,!0,t)).then((()=>{(0,g.lockButton)(u)}))}return clearTimeout(e.get().delayed_ts),e.set(_.setDelayedMessage.bind(null,!1,!1)).then((()=>(0,g.unlockButton)(u))).then(De.bind(null,e,t)).then((()=>{const i=o.keyboardAuthorId,n=o.action||{},r=n.attaches||[],c=(0,w.decodeHTMLEntities)(n.payload||"");let d=(0,w.decodeHTMLEntities)(n.label||"");if(q.Ranges.isChatOrChannelPeer(l)){d=`@${(0,R.oCacheGet)(e,i).link.slice(1)} ${d}`}return(0,m.statlogsValueEvent)("message_send_from_keyboard",0,e.get().id,l,i),Le(s,l,{message:d,attaches:r,payload:c},e,t,a,!1)})).then((()=>d?e.set(_.deleteKeyboard.bind(null,l)):Promise.resolve())).then((()=>a().fixKeyboard()))}})).catch((t=>{(0,n.debugLog)(t),Fe(e,i)}))}function je(e,t,s,i,a,o,l=[],c){return Promise.resolve().then((()=>{let n=(0,r.geByClass1)("_im_send",i);if(!(0,p.isSendingAvailable)(e))return!1;if((0,_.isAnythingLoading)(e.get())||!(0,g.isFullyLoadedTab)(e,e.get().peer)){let t=Be(e,ue,je,(0,b.toArray)(arguments));return e.set(_.setDelayedMessage.bind(null,!0,t)).then((()=>{(0,g.lockButton)(n)}))}clearTimeout(e.get().delayed_ts),a().saveText(e);let d=!1,u=Ue(e),m=u.dData.attaches.map((e=>{if("poll"==e.type){let t=o.pollData();return t||(d=!0),[e.type,e.id,t]}return"share"==e.type&&e.object?.extpage_raw?[e.type,e.object.extpage_raw]:[e.type,e.id]})).concat(l);if(d)return!1;const h=e.set(_.setDelayedMessage.bind(null,!1,!1)).then((()=>{(0,g.unlockButton)(n)}));let f=(0,N.getPeer)(e);return h.then((()=>{let n=u.dData.txt,o=t().getEditingMessage();if(!o&&!n&&!m.length)return;if(o)return n||m.length&&!u.hasOnlyReplies(o)?(0,g.isMessageTooLong)(n)?void(0,E.showFastBox)(S.getLang("global_error"),S.getLang("mail_err_edit_too_long")):(t().cancelEditing(),void((0,M.wasMessageReallyModified)(e,o,u)&&((0,M.replaceMsgAfterEdit)(e,o,n,m,u.getShareUrl(),u.getCancelledShares()),t().sendEditMessage(e,o),e.get().longpoll.push([(0,O.editMessageLocallyEvent)(o)])))):void function(e,t,s,i){const a=e.get(),n=a.peer,o=(0,E.showFastBox)({title:S.getLang("mail_dialog_msg_delete_title")},S.getLang("mail_dialog_msg_delete_for_all"),S.getLang("mail_delete"),(function(e){(0,_.removeMessageSend)([i],n,null,"deleteforall",a),o.hide(),t().cancelEditing()}),S.getLang("global_cancel"),(function(){o.hide(),$e((0,r.geByClass1)("_im_text",s))}))}(e,t,i,o.messageId);let l=(0,g.splitMessageToParts)(n,m).map((i=>{const n={message:i.msgText||"",attaches:i.attaches||[]};return(0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,L.isMarusiaPeer)(f)&&c&&(n.payload=JSON.stringify(c)),Le(s,f,n,e,t,a)}));return Promise.all(l)})).then(De.bind(null,e,t))})).catch((t=>{(0,n.debugLog)(t),Fe(e,i)}))}function Ve(e,t,s){return e.set(_.deliverMessage.bind(null,t,s,{}))}function qe(e,t,s,i){e.get().longpoll.push([(0,O.failedMessage)(t,s.mess,i)])}function Ge(e,t,s,i,a,n,o,l,c){let d,u=(0,I.debounce)(ut.bind(null,e,s),500);let m=Emoji.init((0,r.geByClass1)("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>bt(e,t).then((async t=>{let s;const a=e.get().peer;if((0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,L.isMarusiaPeer)(a)){const e=await(0,K.loadMarusiaSdk)();if(s={communication_type:G.CommunicationType.text,voice_assistant:{support_process_commands_by_ids:!0}},e&&!e.canSentMessage())return void e.onClick()}return t&&i([],s)})),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(s,i){let a=e.get().peer,n=Emoji.val(i);q.Ranges.isZeroOwner(a)||dt(a,e)||Ue(e).dData.txt==n||!n||function(e){let t=e.get().peer;(0,g.isFullyLoadedTab)(e,t)&&!(0,p.isAnyMessageBeingEdited)(e)&&Date.now()-((0,p.getTab)(e,t).lastTyping||0)>1e3*_.ACTIVITY_PERIOD&&e.set(_.sendTyping.bind(null,t))}(e),yt(e,t,n),Et(e,t,n),u(i);let o=t.offsetHeight;if(d&&d!==o){let t=l().updateScroll();l().scrollFix(e,e.get().peer,t)}d=o},onStickerSend:(e,t,s,i)=>a([["sticker",e,s]],{sticker_referrer:t,...i}),onUGCStickerSend:(e,t)=>a([["ugc_sticker",`${e.owner_id}_${e.id}`]],{sticker_referrer:t}),onHintachSend:(e,t)=>n([[e,t]],{is_hintach_item:!0}),uploadActions:o,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){c().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(m,{},(()=>l().renderStickersPanel(e))),e.setState({emojiOptId:m}),(0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,L.isMarusiaPeer)(e.get().peer)&&Emoji.toggleStickers(m,!0),m}function Ke(e,t,s){const i=e.get().peer;if((0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,L.isMarusiaPeer)(i))return;const a=Emoji.val((0,r.geByClass1)("_im_text",t));(0,p.isAnyMessageBeingEdited)(e)&&""!==a||bt(e,t).then((t=>{const i=(0,l.intval)((0,r.domData)(s.target,"tttype"));(2===i&&!0!==t||1===i&&!0===t||3!==i&&""===a)&&window.tooltips&&tooltips.destroy(s.target,{fasthide:!0});const n=Ue(e).dData.attaches.length>0;if((0,p.isAnyMessageBeingEdited)(e)&&""===a&&!n)return(0,r.domData)(s.target,"tttype",3),(0,C.showTooltip)(s.target,{text:S.getLang("mail_delete_for_all"),black:!0,force:3!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return(0,r.domData)(s.target,"tttype",1),(0,C.showTooltip)(s.target,{text:(0,g.isCommunityInterface)(e)?S.getLang("mail_send2"):S.getLang("mail_added_audiomsg"),black:!0,force:1!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});(0,r.domData)(s.target,"tttype",2);return(0,C.showTooltip)(s.target,{text:(()=>{const t=e.get().settings.ctrl_submit?1:0;return(0,l.getTemplate)("ctrl_submit_hint",{enter_on:t?"":"on",ctrl_on:t?"on":"",wall_reply_submit_settings:S.getLang("wall_reply_submit_settings"),wall_reply_submit_settings_1:S.getLang("wall_reply_submit_settings_1"),wall_reply_submit_settings_2:S.getLang("wall_reply_submit_settings_2")})})(),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==i,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:(0,b.toArray)((0,r.geByClass)(we)),val:e.get().settings.ctrl_submit?1:0}},onHide(){window.tooltips&&tooltips.destroy(s.target,{fasthide:!0})}})}))}function $e(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function We(e,t){Emoji.val(e,(0,l.clean)(t)),$e(e)}function Ye(e,t,s,i){const a=e.getFwdRaw(),n=t.querySelector(`.${ge}`),o=t.parentNode.querySelector(`.${me}`);if(!((0,p.getCurrentKeyboard)(i)||{}).hide&&a&&s.toggleKeyboard(!0),n.innerHTML="",o.innerHTML="",a){const t=function(e,t){if(e.get().isEditing){const t=(0,g.getNowEditingMessage)(e);return t&&(0,h.hasReply)(t)}return"reply"===t.type}(i,a),s=t?o:n,r=a.object;s.innerHTML=t?ze(r):function(e,t,s,i){if(s.object&&s.object.authorName){const t=(0,g.renderShortText)(0,"",i.text,!0,(0,A.convertKludgesToAttaches)(i.kludges,0));return(0,l.getTemplate)("im_attach_mess",{title:i.authorName,messages:t,date:(0,S.getSmDate)(i.date,e.get().timeshift)})}return(0,l.getTemplate)("im_attach_mess",{title:S.getLang("mail_im_fwd_msgs_title"),messages:(0,l.getTemplate)("im_dialog_media",{name:S.getLang("mail_title_X_msgs",t.getFwdCount())}),date:""})}(i,e,a,r)}}function ze(e){const t=(0,g.renderShortText)(0,"",e.text,!0,(0,A.convertKludgesToAttaches)(e.kludges,0));return(0,l.getTemplate)("im_replied_message",{authorName:e.authorName,text:t})}function Ze(e,t,s){return e.set(_.forwardMessages.bind(null,null,Ue(e),!1)).then((()=>{const i=t.querySelector(`.${ge}`),a=t.parentNode.querySelector(`.${me}`),n=document.querySelector(`.${Ce} .${me}`);a&&a.children.length&&(a.innerHTML="",Je(e,s)),n&&n.children.length&&(n.innerHTML="",Je(e,s)),i&&i.children.length&&(i.innerHTML="",Je(e,s)),yt(e,t)}))}function Qe(e,t,s){const i=(0,N.getPeer)(e);e.set(_.acceptMessageRequest.bind(null,i)).then((()=>{vt(e,i,t),s()})).catch((()=>Ne()))}function Xe(e,t,s){const i=(0,N.getPeer)(e);e.set((e=>(0,_.rejectMessageRequest)(i,!1,e))).then((()=>{(0,g.isClassicInterface)(e)&&t(e),s(e,i),i===e.get().peer&&e.get().longpoll.push([(0,O.resetPeer)()])})).catch((()=>Ne()))}function Je(e,t){const s=t().updateScroll();t().scrollFix(e,e.get().peer,s)}function et(e,t,s,i){let a=e.get().peer,n=(0,l.inArray)(a,e.get().mutedPeers);e.set(_.toggleMutePeer.bind(null,a,!n,-1)).then(s().updateState.bind(null,a)),(0,o.cancelEvent)(i)}function tt(e,t,s,i){let a=e.get().peer;e.set(_.returnToChat.bind(null,a)).then((e=>e.set(_.getPinnedMessage.bind(null,a)))).then(s().updateChatTopic.bind(null,a)),(0,o.cancelEvent)(i)}const st="close",it="open",at="hide";function nt(e,t,s,i,a,n,o,l){if(o!==st&&o!==it&&o!==at)throw new Error(`Action "${o}" not found`);const c=e.get(),d=(0,p.getCurrentKeyboard)(e),u=(0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,L.isMarusiaPeer)(c.peer);((0,g.isCommunityInterface)(e)||!d||c.isEditing||u)&&(o=at);const _=o===st||o===at;let m=Promise.resolve();_||s.isMounted||(m=s.init());const h=!d&&o!==it;return m.then((()=>((0,r.toggleClass)(t,"im-chat-input_open-keyboard",!_),(0,r.toggleClass)(t,"im-chat-input_close-keyboard",_&&o!==at),(0,r.toggleClass)(i,"im_chat-input--keyboard-button_hidden",o===at),s.toggle(c.peer,_,n)))).then((()=>{if(!h||l){let t=a().updateScroll();return a().scrollFix(e,c.peer,t)}}))}function ot(e,t){if((0,p.isAnyMessageBeingEdited)(e))return!1;const s=e.get();if((0,g.isCommunityInterface)(e))return!1;if(!(0,B.getCurrentTab)(e).moneyTransferAvail)return!1;if(q.Ranges.isGroupId(t))return s.moneyTransferCommAvail;if(q.Ranges.isUserIdTransitional(t)){const e=(0,l.inArray)(t,s.moneyTransferExcept);return t!=vk.id&&!e&&!q.Ranges.isContactId(t)}return!1}function rt(e,t){if((0,p.isAnyMessageBeingEdited)(e))return!1;return!!e.get().moneyRequestAvail&&(!!(0,B.getCurrentTab)(e).moneyRequestAvail&&(!(!q.Ranges.isGroupId(t)&&!q.Ranges.isChatOrChannelPeer(t))||!!q.Ranges.isUserIdTransitional(t)&&(t!=vk.id&&!q.Ranges.isContactId(t))))}function lt(e,t,s,i,a,n,o,c,d,u,_,m,h,f,v,b){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[(0,N.getPeer)(e)])},toggleKeyboard:(t=!(0,p.getCurrentKeyboard)(e).hide,s=!0)=>nt(e,i,m,_,n,s,t?st:it),initKeyboard(){if(!e.get().peer||!(0,p.getCurrentKeyboard)(e))return Promise.resolve();const t=!!(ls.get("is_keyboards_hide")||{})[(0,N.getPeer)(e)];return nt(e,i,m,_,n,!0,t?st:it)},fixKeyboard(){const t=(0,p.getCurrentKeyboard)(e);let s;return s=t?t.hide?st:it:at,nt(e,i,m,_,n,!0,s,!0)},hideKeyboard:()=>nt(e,i,m,_,n,!1,at),updateMediaSelectorOptions(e){const t=e.get().peer,s={gift:(0,g.isGiftOptionAvailableForPeer)(e,t)&&!(0,p.isAnyMessageBeingEdited)(e),money:(0,g.isMoneyOptionAvailableForPeer)(e,t)&&!(0,p.isAnyMessageBeingEdited)(e),poll:q.Ranges.isChatOrChannelPeer(t),app_action_mini_apps:(0,g.isAppActionOptionAvailableForPeer)(t),app_action_games:(0,g.isAppActionOptionAvailableForPeer)(t),...Ct(t,e)},a=(0,r.geByClass1)("ms_items_more",i);Object.entries(s).forEach((([e,t])=>{const s=(0,r.geByClass1)("ms_item_"+e,a);(0,r.toggleClass)(s,"ms_item--hidden",!t),t?(0,r.show)(s):(0,r.hide)(s)}))},restoreDraft(e,a,o){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1})),this.updateMediaSelectorOptions(e);const r=e.get().peer,l={im:!0,fromId:-(0,p.getGroupId)(e)||vk.id,peer:r,moneyTransfer:{request:rt(e,r),send:ot(e,r)}},c=(0,N.getEmojiOptId)(e);if(void 0===c?e.setState({suggestionsConfig:l}):Emoji.setSuggestionsConfig(c,l),q.Ranges.isZeroOwner(r))return Promise.resolve();let d=Ue(e);return Emoji.val(s)!==d.dData.txt?(We(s,d.dData.txt),Et(e,i,d.dData.txt)):$e(s),(0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&((0,L.isMarusiaPeer)(r)?((0,K.loadMarusiaSdk)().then((t=>{(0,L.isMarusiaPeer)(e.get().peer)&&t&&t.init({iconContainer:document.querySelector("._im_send"),suggestContainer:document.querySelector("._marusia_suggest"),draftText:d.dData.txt,unreadMessages:e.get().tabs[r]?.unread??0,needOnboarding:e.get().tabs[r]?.is_new,textInput:s,setTextValue:We})})),void 0!==c&&Emoji.toggleStickers(c,!0)):((0,K.loadMarusiaSdk)().then((e=>{e&&(e.stopListening(),e.hide())})),void 0!==c&&Emoji.toggleStickers(c,!1))),d.prepareObjects(e.get().gid,a&&a.messageId).then((()=>{if(vt(e,r,s)||r!=e.get().peer)return;let a=d.dData.attaches;for(let e=0;e<a.length;e++)t.chooseMedia(a[e].type,a[e].id,a[e].object||{});if(Ye(d,i,this,e),o){let t=n().updateScroll();n().scrollFix(e,r,t)}yt(e,i,d.dData.txt)}))},sendMessage(){a([])},sendMessageFromKeyboard:(...t)=>He.call(null,e,n,f,i,...t),choose(e,s,i){t.chooseMedia(e,s,i)},updateChosenMedia(e,s,i){t.updateChosenMedia(e,s,i)},canAddMedia:()=>!t.hasRestrictingAttach()&&!dt(e.get().peer,e),isEmpty:e=>!(0,l.trim)(Emoji.val(s))&&!Ue(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,s,i){t.showMediaProgress(e,s,i)},updateState(e){this.restoreKeyboard(),vt(e,e.get().peer,s)},focusOn(e){Emoji.editableFocus(s,!1,!0)},setDraft(e,s,i=!0){const a=(0,p.getTab)(e,e.get().peer);(0,B.doesChatTabHaveFlag)(a,1024)&&!e.get().gid||(t.cancelCheckUrl(),h&&h.update(),e.setState({tfdraft:s}),s&&this.restoreDraft(e,n().getEditingMessage(),i))},clearText(e,a){Ue(a).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(s,""),Ze(a,i,n);let o=n().updateScroll();n().scrollFix(a,a.get().peer,o)},attachMessages(e,t){if(e.get().peer!==t)return;Ye(Ue(e),i,this,e);let s=n().updateScroll();n().scrollFix(e,t,s),yt(e,i)},detachMessages(t){const s=Ue(e).getFwdRaw();if(s){if(!!s.id.split(";").find((e=>Math.abs(e)===t.messageId)))return Ze(e,i,n).then((()=>{let t=n().updateScroll();n().scrollFix(e,e.get().peer,t)}))}return Promise.resolve()},cancelRecording(){u?.cancelRecording()},reHeight(e){let t=n().updateScroll();n().scrollFix(e,e.get().peer,t)},isBlocked:()=>dt(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers((0,N.getEmojiOptId)(e),!t)},saveText(e){Ue(e).setText(Emoji.val((0,r.geByClass1)("_im_text",i)))},resendAll(){v()},resendPeer(){b(e.get().peer)},unmount(){(0,y.destroyModule)(d),t.destroy(),c.unmount(),m.unmount(),h&&h.unmount(),Emoji.destroy((0,N.getEmojiOptId)(e)),u?.unmount()}}}function ct(e,t){return!!q.Ranges.isChatOrChannelPeer(e)&&t.get().tabs[e].data.kicked}function dt(e,t){return ct(e,t)||(0,p.getTab)(t,e)&&(0,p.getTab)(t,e).block_error>0||(0,g.isLocksAvailable)(t)&&(0,g.isPeerBlocked)(e,t)}function ut(e,t,s){let i=e.get().peer,a=Emoji.val(s);q.Ranges.isZeroOwner(i)||Ue(e).dData.txt==a||dt(i,e)||(t.checkMessageURLs(a,!0,ue),Ue(e).setText(a))}function _t(e){let t=Ue(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function gt(e,t){e.disabled=!0,e.contentEditable="false",(0,r.addClass)(e,"im-chat-input--text_disabled"),(0,r.addClass)(t,"im-chat-input_error"),(0,r.addClass)((0,r.geByClass1)("_im_page_history"),"is_tf_blocked")}function mt(e,t){e.disabled=!1,e.contentEditable="true",(0,r.removeClass)(e,"im-chat-input--text_disabled"),(0,r.removeClass)(t,"im-chat-input_error"),(0,r.removeClass)((0,r.geByClass1)("_im_page_history"),"is_tf_blocked")}const pt="renewSubscriptionButton",ht="im-chat-input--donut",ft="im-chat-input--business-notify";function vt(e,t,s){const i=(0,r.gpeByClass)("_im_chat_input_parent",s),a=(0,r.geByClass1)("_im_chat_input_error",i),n=(0,r.geByClass1)("im-chat-input--error",i);let o=(0,p.getTab)(e,t);const c=dt(t,e);if(c){gt(s,i);let c=function(e,t,s){switch(s.block_error){case Z:case Y:return S.getLang("mail_peer_deleted");case te:return S.getLang("mail_community_deleted");case X:return S.getLang("mail_group_banned_messages");case re:return S.getLang("mail_cant_send_messages_by_time");case le:return S.getLang("mail_cant_send_messages_by_web_bot");case W:case z:case Q:case ie:case ae:case ee:return q.Ranges.isGroupId(t)?S.getLang("mail_send_privacy_community_error"):S.getLang("mail_send_privacy_error");case ne:let s=(0,R.oCacheGet)(e,t);return(0,S.langSex)(s.sex,S.getLang("mail_blacklist_user","raw")).replace("{user}",s.kick_name);case J:return S.getLang("mail_cant_send_messages_to_community");case se:return S.getLang("mail_chat_youre_kicked");case oe:case de:return S.getLang("mail_chats_is_disabled");case 0:if(ct(t,e))return S.getLang("mail_chat_youre_kicked");const i=e.get().block_states[t].name;return S.getLang("mail_community_answering").replace("{username}",i);case ce:return S.getLang("mail_chats_user_not_don_error");default:return S.getLang("mail_send_privacy_error")}}(e,t,o);const d=function(e,t){return(0,p.getTab)(t,e)?.block_error===ce}(t,e),u=n.querySelector(`[data-type="${pt}"]`);if(d&&(n?.classList.add(ht),!u)){const e="im",t=document.createElement("button");t.textContent=S.getLang("mail_renew_subscription"),t.classList.add("flat_button"),t.dataset.type=pt,t.onclick=()=>(0,F.showDonutSubscribePopup)(null,null,o.ownerId,e,{type:"subscribe",params:{act:"subscribe_popup"}}),n.append(t)}if(u&&!d&&(n?.classList.remove(ht),u.remove()),(0,p.isChannelPeer)(o)&&(0,r.addClass)((0,r.geByClass1)("_im_page_history"),"is_channel"),(0,B.isBusinessNotifyTab)(o)&&n?.classList.add(ft),(0,g.isFvkcomgroup)(e,t)&&!e.get().gid){(0,r.addClass)(i,"is-f-vkcomgroup");let s=(0,l.inArray)(t,e.get().mutedPeers);c=(0,p.isChatActive)(o)?(0,l.getTemplate)("sImPeerMuteUnmute",{text:s?S.getLang("mail_im_unmute"):S.getLang("mail_im_mute"),type:s?"unmute":"mute"}):(0,l.getTemplate)("sImPeerReturnToChat",{text:S.getLang("mail_return_to_vkcomgroup")})}else(0,r.removeClass)(i,"is-f-vkcomgroup");return(0,r.val)(a,c),!0}return!c&&n?.classList.contains(ht)&&(n?.classList.remove(ht),n?.querySelector(`[data-type="${pt}"]`)?.remove()),o&&(0,g.tabIsMessageRequest)(o)&&!(0,g.tabIsRejectedMessageRequest)(o)&&!(0,U.partConfigEnabled)("simplified_start_conversation")?(gt(s,i),(0,r.addClass)(i,"is-message_request"),(0,r.val)(a,(0,l.getTemplate)("sImPeerAcceptOrRejectMessageRequest",{cls_accept:be,cls_reject:ye,mail_message_request_user_notice:S.getLang("mail_message_request_user_notice"),mail_message_request_accept:S.getLang("mail_message_request_accept"),mail_message_request_reject:S.getLang("mail_message_request_reject")})),!0):(i.classList.contains("is-message_request")&&(mt(s,i),(0,r.removeClass)(i,"is-message_request"),(0,r.val)(a,"")),s.disabled&&((0,r.removeClass)(i,"is-f-vkcomgroup"),(0,r.removeClass)((0,r.geByClass1)("_im_page_history"),"is_channel"),mt(s,i),(0,r.removeClass)(i,"is-message_request"),(0,r.val)(a,"")),!1)}function bt(e,t,s){return Promise.resolve().then((()=>{const i=null!=s?s:Emoji.val((0,r.geByClass1)("_im_text",t));if((0,l.trim)(i))return!(0,p.isAnyMessageBeingEdited)(e)||!(0,g.isMessageTooLong)(i);const a=Ue(e),n=(0,g.getNowEditingMessage)(e);return a.hasAttaches()&&!a.hasOnlyReplies(n)}))}function yt(e,t,s){const i=(0,r.geByClass1)("_im_send",t.parentNode);Ae(i,{fasthide:!0}),Promise.all([bt(e,t,s),(0,g.isVoiceMessageAvailable)(e)]).then((([t,s])=>{if((0,p.isAnyMessageBeingEdited)(e))(0,r.toggleClass)(i,"is_input_empty",!t),(0,r.attr)(i,"aria-label",S.getLang("mail_im_edit"));else{(0,r.toggleClass)(i,"im-send-btn_audio",!t&&s),(0,r.toggleClass)(i,"im-send-btn_send",t),t&&(0,r.removeClass)(i,"im-send-btn_saudio");const e=t?S.getLang("mail_send2"):S.getLang("mail_added_audiomsg");(0,r.attr)(i,"aria-label",e)}}))}function wt(e){const t=(0,r.geByClass1)(Se,e);t.classList.contains(Te)||t.classList.add(Te)}function Et(e,t,s){const i=(0,B.getCurrentTab)(e);if(!i)return;if(!q.Ranges.isChatOrChannelPeer(i.peerId)||(0,p.isChannelPeer)(i))return wt(t);const a=(s.match(D.MASS_MENTION_REGEXP)||[]).map((e=>e.slice(1)));if(0===a.length)return wt(t),void e.set((e=>(i.dontReopenWarningForCurrentMassMention=!1,Promise.resolve(e))));const n=(0,r.geByClass1)(Se,t),o=(0,r.geByClass1)("MassMentionWarning__title",n),l=(0,r.geByClass1)("MassMentionWarning__text",n),c=(e,t)=>{i.dontReopenWarningForCurrentMassMention||(o.innerHTML!==e&&(o.innerHTML=e),l.innerHTML!==t&&(l.innerHTML=t),n.classList.remove(Te))},d=D.MASS_MENTION_ALIASES.all.some((e=>a.includes(e))),u=D.MASS_MENTION_ALIASES.online.some((e=>a.includes(e)));switch(!0){case d&&i.membersCount>=11:return c(S.getLang("mail_im_mass_mention_warning_title"),S.getLang("mail_im_mass_mention_warning_many_people_mentioned_text",i.membersCount-1));case u&&i.membersCount>=30:return c(S.getLang("mail_im_mass_mention_warning_title"),S.getLang("mail_im_mass_mention_warning_maybe_many_people_mentioned_text"));default:return wt(t)}}function Ct(e,t){const s=!(0,g.isPeerCurrentUser)(e)&&!(0,g.isCommunityInterface)(t);return{[Me]:s&&q.Ranges.isUserId(e),[Pe]:s&&q.Ranges.isChatOrChannelPeer(e)}}function St(e){const t=e.get().mediaTypes||[["photo",S.getLang("mail_added_photo")],["video",S.getLang("profile_wall_video")],["audio",S.getLang("profile_wall_audio")],["doc",S.getLang("profile_wall_doc")],["map",S.getLang("profile_wall_map")],["gift",S.getLang("profile_wall_gift")]];return(e.get().moneyTransferAvail||e.get().moneyRequestAvail)&&t.push(["money",S.getLang("profile_wall_money")]),function(e,t){let[s,i]=t.get().mediaTypesServiceAB||[];if(!s&&!i)return e;[s,i]=s<=i?[s,i+1]:[s,i];const a=e.findIndex((([e])=>e===ke)),[[,...n]]=e.splice(a,2);return e.splice(s,0,[Me,...n]),e.splice(i,0,[Pe,...n]),e}(t,e)}function Tt(e,t,s,i,n){cur.share_timehash=t.get().share_timehash;let{callMutations:o,bindMutations:m}=(0,y.createMutations)(lt),h=(0,k.mount)(e,t,o),v=Ve.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);const{pushMessage:b,inspectQueue:w,resend:E,resendAll:I,resendPeer:P,setErrored:A,complete:R}=(0,f.initQueue)(v,qe.bind(null,t),{store:!0,key:"im_send_queue_"+vk.id,waitCommit:!0});let D=Re.bind(null,t,n,b,o,e),F=Re.bind(null,t,n,b,o,e),H=_t.bind(null,t);(0,r.hide)((0,r.geByClass1)("ms_items_more_helper",e));const j=St(t);let V,W=new window.MediaSelector((0,r.geByClass1)(_e,e),Ee,j,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(s,i,a,r){return s&&o().toggleKeyboard(!0),function(e,t,s,i,a,n,o,r,l){if(t.get().removingMedias)return;if("album"===a||"page"===a||"mail"===a||"reply"===a)return!1;if("share"===a&&!o.title)return!1;var c,d;n&&"string"==typeof a?(r&&Ue(t).addBindUrl(r,a,n),Ue(t).addAttach(a,n,o)):(Ue(t).syncWithSelector(l),"number"==typeof n&&l.chosenMedias[n]&&(c=l.chosenMedias[n],d=Ue(t),("string"==typeof c[0]&&"string"==typeof c[1]&&c[1]||"string"==typeof c[0]&&"group"===c[0])&&d.dData.cancelled.push(`${c[0]},${c[1]}`)));const u=e().updateScroll();if(e().scrollFix(t,t.get().peer,u),t.get().delayed_message&&!(0,_.isAnythingLoading)(t.get()))return s([]),!1;yt(t,i)}(n,t,V,e,s,i,a,r,W)},onMediaChange:function(){return function(e,t,s,i,a){if(t.get().removingMedias)return;let n=a.getMedias().find((e=>"poll"===e[0]));n&&Ue(t).addAttach(n[0],n[1],a.pollData(!0,!0)),yt(t,i)}(0,t,0,e,W)},editable:1,onChangedSize:function(){let s=n().updateScroll();n().scrollFix(t,t.get().peer,s),function(e){const t=(0,r.ge)(Ee).offsetHeight;(0,r.toggleClass)(e,"im-chat-input--overflowed",t>400)}(e)},sortable:1,teWidth:150,mail:1,teHeight:100,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}});V=je.bind(null,t,n,b,e,o,W);let Y=Ke.bind(null,t,e),z=(0,r.geByClass1)("_im_send",e);const Z=(0,g.isCommunityInterface)(t)?null:(0,c.mount)(e,t,Re.bind(null,t,n,b,o,e),(()=>{(0,r.addClass)(z,"im-send-btn_audio"),(0,r.removeClass)(z,"im-send-btn_static")}),(()=>{o().restoreKeyboard()}));!function(e,t){const s=(0,r.geByClass1)("_im_text",e);(window.Wall?Promise.resolve():window.stManager.add([window.jsc("web/page.js")])).then((function(){Wall.initComposer(s,{lang:{introText:S.getLang("profile_mention_start_typing"),noResult:S.getLang("profile_mention_not_found")},toup:!0,getValue:()=>q.Ranges.isChatOrChannelPeer(t.get().peer)?(window.Emoji&&Emoji.editableVal||r.val)(s):"",onShow:()=>{(0,r.addClass)(e,"im_mention_shown");let t=data(s,"composer");if(t&&t.wdd&&t.wdd.shown){let e=0,s=!1,i=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,(0,r.val)(t.wddInput,""),Composer.toggleSelectList(t)};(0,l.each)(t.wdd.shown,(function(){this[0]&&(e++,"@"+t.curTerm==this[2]&&(s=!0))})),!e||s&&1==e?i():(0,a.cancelStackPush)("im_mention",i)}},onHide:()=>{(0,r.removeClass)(e,"im_mention_shown"),(0,a.cancelStackFilter)("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=W,t.set(_.initTextStore.bind(null,w,E,A,R));let Q=(0,r.geByClass1)("_im_text",e);setTimeout((()=>{(0,N.getPeer)(t)&&o().setDraft(t,(0,p.getTabDraft)((0,B.getCurrentTab)(t))),Ge(t,e,W,V,D,F,h,n,o),o().updateMediaSelectorOptions(t)}),0);let X=Ze.bind(null,t,e,n),J=Qe.bind(null,t,Q,(()=>{const e=n().updateScroll();n().scrollFix(t,(0,N.getPeer)(t),e)})),ee=Xe.bind(null,t,s,i),te=et.bind(null,t,e,n),se=tt.bind(null,t,e,n),ie=Oe.bind(null,t);vt(t,t.get().peer,Q);const ae=e.querySelector("._im_keyboard_button"),ne=(0,d.mount)(t,e,He.bind(null,t,n,b,e,o),o),oe=(0,g.isCommunityInterface)(t)?(0,u.mount)(t,e.querySelector("._message_templates_container"),(e=>(0,x.setHTML)(Q,e)),(t=>(0,r.toggleClass)(e,"im-chat-input--textarea_show-templates",t))):null,re=(0,y.createModule)({handlers:(s,i)=>{s(z,"click",(()=>{wt(e),Promise.resolve().then((()=>bt(t,e))).then((async e=>{if(e||(0,p.isAnyMessageBeingEdited)(t)){let e;const s=t.get().peer;if((0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,L.isMarusiaPeer)(s)){e={communication_type:G.CommunicationType.text,voice_assistant:{support_process_commands_by_ids:!0}};const t=await(0,K.loadMarusiaSdk)();if(t&&!t.canSentMessage())return void t.onClick()}V([],e)}else(0,L.isMarusiaPeer)(t.get().peer)?(0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,K.loadMarusiaSdk)().then((e=>{e&&e.onClick()})):(0,g.isVoiceMessageAvailable)(t).then((e=>{if(!e)return;const s=Ue(t);xe(s)&&function(e){const t=document.querySelector(`.${Ce} .${me}`),s=e.getFwdRaw();if(s){const e=s.object;t&&(t.innerHTML=ze(e))}else t.innerHTML=""}(s),Ae(z,{fasthide:!0}),Z?.start(),setTimeout((()=>(0,r.removeClass)(z,"im-send-btn_saudio")),300)}))}))})),s(z,"mouseover",Y),s(Q,"focus",(()=>{t.get().longpoll.push([(0,O.transitionEvent)("message")]),cur.focused=t.get().peer})),s(Q,"blur",(()=>{let e=0===t.get().peer?"search":"default";t.get().longpoll.push([(0,O.transitionEvent)(e)]),cur.focused=!1})),s(ae,"click",(()=>o().toggleKeyboard(void 0))),s(ae,"mouseover",(()=>{(0,C.showTooltip)(ae,{text(){const e=(0,p.getCurrentKeyboard)(t);return!e||e.hide?S.getLang("mail_show_keyboard"):S.getLang("mail_hide_keyboard")},black:!0,shift:[4,5]})})),s((0,r.geByClass1)(Ie),"click",(()=>{!function(e,t){wt(t),e.set((e=>((0,B.getCurrentTab)(e).dontReopenWarningForCurrentMassMention=!0,Promise.resolve(e))))}(t,e),$e(Q)})),i(e.parentNode,"click",fe,te),i(e.parentNode,"click",ve,se),i(e.parentNode,"click",he,X),i(e.parentNode,"click",be,J),i(e.parentNode,"click",ye,ee),i(e,"click",pe,X),i(e,"click","_im_will_fwd",H),i(e,"keydown","_im_text",(e=>function(e,t,s,i){if(38===i.which&&s().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!(0,T.hasAccessibilityMode)()&&!(0,_.isAnythingLoading)(e.get())){let s=(0,M.findLastMessageToEdit)(e,(0,B.getCurrentTab)(e));if(s){if((0,L.isMarusiaPeer)(e.get().peer))return;t().startEditing((0,p.getMessage)(e,e.get().peer,s))}}}(t,n,o,e))),i(document.body,"click",we,ie)}}),le=m(t,W,Q,e,V,n,w,h,re,Z,ae,ne,oe,b,I,P);return le.initKeyboard(),(0,U.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,K.loadMarusiaSdk)().then((e=>{e&&(e.on("phrase_start",(e=>{(0,L.isMarusiaPeer)(t.get().peer)&&(We(Q,e),(0,$.disableMarusiaTextInput)(Q))})),e.on("phrase_update",(e=>{(0,L.isMarusiaPeer)(t.get().peer)&&We(Q,e)})),e.on("phrase_finish",(e=>{(0,L.isMarusiaPeer)(t.get().peer)&&(We(Q,e),(0,$.enableMarusiaTextInput)(Q))})),e.on("send_message",(e=>{(0,L.isMarusiaPeer)(t.get().peer)&&Le(b,$.MARUSIA_PEER_ID,{message:e.text,payload:JSON.stringify(e.payload),attaches:[]},t,n,o)})),e.on("error",(()=>{(0,L.isMarusiaPeer)(t.get().peer)&&(We(Q,void 0),(0,$.enableMarusiaTextInput)(Q))})),e.on("suggest_update",(()=>{if((0,g.isClassicInterface)(t)){let e=n().updateScroll();n().scrollFix(t,t.get().peer,e)}else n().scrollBottom()})))})),le}},279203:(e,t,s)=>{"use strict";s.d(t,{mount:()=>R});var i=s(365485),a=s(610989),n=s(20025),o=s(452314),r=s(948350),l=s(199835),c=s(693143),d=s(583790),u=s(846210),_=s(399290),g=s(879007),m=s(810903),p=s(77294),h=s(660546),f=s(388078);const v="_im_top_banner_button",b="_im_top_banner_hide",y="_im_top_banner_reject_mr",w="_im_top_banner_business_notify",E="_im_top_banner_spam",C="_im_top_banner_friend_add",S="_im_top_banner_button_gifts",T="_im_call_banner_join_btn",I="hiddenCallBanners";function k(e){return!e.children.length}function M(e,t,s={}){const i=(0,o.geByClass1)("_im_dialog_header",e);(0,o.toggleClass)(i,"im-page--chat-header_top-banner",t),(0,o.toggleClass)(i,"im-page--chat-header_top-banner--mr",!!s.messageRequest),(0,o.toggleClass)(i,"im-page--chat-header_top-banner--business-notify",!!s.businessNotify),(0,o.toggleClass)(i,"im-page--chat-header_top-banner--spam",!!s.spam)}function P(e,t){const s=(0,o.geByClass1)(b,e);s&&window.tooltips&&tooltips.hide(s),M(e,!1),t.innerHTML=""}function A(e,t,s){const i=t.participants,n=i.count>0?(0,a.langNumeric)(i.count,a.getLang("mail_im_n_chat_members","raw")):"";return(0,g.getTemplate)("sImCallBannerContent",{user_list:(0,h.renderCallUserList)(e,i.list),title:a.getLang("calls_group_call_banner_title"),desc:n,cls:s?"CallBanner--classic":""})}function L(e){const t=e.peerId;if(f.Ranges.isChatOrChannelPeer(e.peerId)&&!(0,c.isChatActive)(e))return!1;const s=e.callInProgress,i=cur.imDb.selectByKey(I);return i?!(!s||i[t]&&i[t]===s.join_link):!!s}function R(e,t,s){const h=(0,o.geByClass1)("_im_top_banner",e),f=(0,i.createModule)({handlers:(i,u)=>{const _=(0,o.geByClass1)("_im_dialog_header",e);u(e,"click",b,(()=>{const i=t.get().peer,a=(0,c.getTab)(t,i);L(a)?function(e){const t=e.peerId,s=e.callInProgress,i=cur.imDb.selectByKey(I)||{};cur.imDb.updateByKey(I,{...i,[t]:s.join_link})}(a):t.set((e=>(0,r.hideTopBannerAction)(i,e))),P(e,h);const n=!!(0,d.renderPinnedMessage)(t);(0,d.compensateHistoryHeightChange)(t,n,!0,s)})),u(e,"click",v,(i=>{const o=function(e,t,s,i,o){const c=e.target,u=t.get().peer,_=t.get().tabs[u];if(c.classList.contains(T)){const e=c.dataset.link;return(0,d.joinCallFromIm)(t,u,e,!1,d.CALL_ENTRY_POINT_JOIN_BANNER),!1}const g=c.dataset.payload,m=e=>{17===e?.error?.error_code&&(0,l.showNotification)({title:a.getLang("mail_changes_cant_be_applied"),text:a.getLang("mail_not_confirmed_phone")})};return g?_.has_verified_number?(t.set((e=>(0,r.callbackTopBannerAction)(u,g,e))).then((()=>{P(s,i)})).catch(m),!0):((0,l.showNotification)({title:a.getLang("mail_changes_cant_be_applied"),text:a.getLang("mail_not_confirmed_phone")}),!1):(c.classList.contains(y)&&(o().showMessageRequestRejectDialog(t),e.originalEvent.preventDefault()),c.classList.contains(C),c.classList.contains(w)&&(o().showBusinessNotifyDialog(),e.originalEvent.preventDefault()),c.classList.contains(S)&&((0,n.showBox)("al_gifts.php",{act:"get_gift_box",mid:u,ref:"im_birthday_banner"},{stat:["gifts.css",window.jsc("web/wide_dd.js"),"wide_dd.css"]}),(0,p.statlogsValueEvent)("gifts_im_birthday_banner","click",u),e.originalEvent.preventDefault()),!1)}(i,t,e,h,s),c=!o,u=!!(0,d.renderPinnedMessage)(t)||!o;(0,d.compensateHistoryHeightChange)(t,u,c,s)})),u(_,"mouseover",b,((e,t)=>{(0,m.showTooltip)(t,{text:a.getLang("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:document.body})}))}});return{renderPeer(t){const i=(0,c.getTab)(t,t.get().peer);if(!i)return;const n=i.top_banner,o=i.callInProgress,r=!k(h),l=L(i);!l&&!n||(0,c.isSearchShown)(t)?r&&P(e,h):(M(e,!0,{messageRequest:n&&"message_request_banner"===n.name,businessNotify:n&&"business_notify_banner"===n.name,spam:n&&"spam_dialog"===n.name}),h.innerHTML=l?function(e,t){return(0,g.getTemplate)("im_top_banner",{text:A(e,t,(0,c.isClassicInterface)(e)),icon:"",buttons:[(0,g.getTemplate)("sImCallBannerButton",{call_link:t.join_link,mail_join_chat:a.getLang("mail_join_chat")}),(0,g.getTemplate)("im_top_banner_hide_btn",{})].join(""),classes:"im-top-banner_call"})}(t,o):function(e){const t=e.icon?(0,g.getTemplate)("im_top_banner_icon",{icon:e.icon}):"";let s=e.text;"employees_banner"===e.name&&(s=(0,_.replaceHyperLinks)(s,(e=>(0,_.linksReplacer)(e))),s=(0,u.replaceMentions)(s));let i=(e.buttons||[]).map((e=>{let t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"reject_mr":return t+=` ${y}`,(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"business_notify":return t+=` ${w}`,(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"spam":return t+=` ${E}`,(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=` ${S}`,(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"friend_add":return t+=` ${C}`,(0,g.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t});default:return(0,g.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}}));return!1!==e.can_hide&&(i=i.concat([(0,g.getTemplate)("im_top_banner_hide_btn",{})])),(0,g.getTemplate)("im_top_banner",{text:s,icon:t,buttons:i.join(""),classes:{message_request_banner:"im-top-banner--mr",business_notify_banner:"im-top-banner--business-notify",spam_dialog:"im-top-banner--spam",spam_chat_invite_banner:"im-top-banner--invite-spam"}[e.name]})}(n),n&&"birthday"===n.name&&(0,p.statlogsValueEvent)("gifts_im_birthday_banner","view",t.get().peer));const m=!k(h);(0,d.compensateHistoryHeightChange)(t,m,r,s)},unmount(){(0,i.destroyModule)(f)}}}},156340:(e,t,s)=>{"use strict";s.d(t,{mount:()=>P});var i=s(20025),a=s(357889),n=s(490712),o=s(614212),r=s(317412),l=s(879007),c=s(452314),d=s(610989),u=s(365485),_=s(823169),g=s(948350),m=s(336476),p=s(476726);const h="_im_upload_dropbox",f="jpg jpeg png gif heic heif".split(" "),v=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function b(e){let t=f.slice(0,f.length);if("types"===e){const e=t.length;for(let s=0;s<e;++s)t.push(t[s].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+f.join(",."):"mask"===e?f.join("|"):""}function y(e,t,s){let n=void 0!==t.ind?t.ind:t,o=t.fileName?n+"_"+t.fileName:t;if((0,c.re)("upload"+o+"_progress_wrap"),e().unchoose(o),!(0,c.geByClass1)("popup_box_container")){let e=d.getLang("mail_add_doc_error");"wrong_music_file"===s?e=d.getLang("mail_upload_music_fail"):"wrong_arch_file"===s||"wrong_arch_mp3_file"===s?e=d.getLang("mail_upload_arch_fail"):"photo"===Upload.options[n].file_name?e=d.getLang("mail_add_photo_error"):"video_file"===Upload.options[n].file_name?e=d.getLang("video_upload_error"):"wrong_mp3_file"===s&&(e=d.getLang("docs_upload_mp3_fail")),setTimeout((0,i.showFastBox)({title:d.getLang("global_error")},e).hide,2e3)}(0,a.topError)("Upload failed",{dt:-1,type:102,url:((0,c.ge)("file_uploader_form"+n)||{}).action}),Upload.embed(n)}function w(e){const t=void 0!==e.ind?e.ind:e,s=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),i=s?t+"_"+s:e;let a=(0,c.ge)("upload"+i+"_progress_wrap");return a&&(0,c.hide)((0,c.geByClass1)("progress_x",a)),i}function E(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";const s="^("+b("mask")+")";return[].slice.call(t.items).every((e=>{let t=e.type.split("/");return new RegExp(s,"i").test(t[1])}))?"photo":[].slice.call(t.items).every((e=>"video"===e.type.split("/")[0]||~v.indexOf(e.type)))?"video":"doc"}function C(e){let t=(0,c.geByClass1)(h),s=(0,c.geByClass1)("im-page--chat-header").getBoundingClientRect(),i=(0,c.geByClass1)("im-chat-input").getBoundingClientRect();(s.width<10||i.bottom-s.bottom<10)&&(e="none"),t.style.top=s.bottom+"px",t.style.left=s.left+1+"px",t.style.width=s.width-2+"px",t.style.height=i.bottom-s.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function S(){(0,c.geByClass1)(h).classList.remove("im-dropbox--visible")}function T(e,t,s){return{loaded:t,total:s,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function I(e,t,s,i){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),i().reHeight(s)}function k(e,t,s,i,a){let r=t.get().upload_opts,d=(0,c.geByClass1)("_im_upload_photo",a),u=(0,c.geByClass1)("_im_drop_photo",a);return Upload.init(d,r.url,r.params,{accept:b("accept"),file_name:"photo",file_size_limit:26214400,file_types:b("types"),file_match:r.opts.ext_re,lang:r.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:r.opts.server,error:r.opts.default_error,error_hash:r.opts.error_hash,dropbox:u,dragEl:document.body,onNoFilteredCallback(e){Upload.onFileApiSend(i,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,i){let a=(0,o.parseJSON)(i);a.photos?function(e,t,s,i){const a=w(e);ajax.post("al_photos.php",(0,l.extend)({act:"choose_uploaded"},t),{onDone:function(e,t){i().choose("photo",e,(0,l.extend)(t,{upload_ind:a}))},onFail:y.bind(null,i,e)})}(e,a,0,s):I(e,i,t,s)},onUploadProgress(e,t,i){let a=void 0!==e.ind?e.ind:e;s().progress("photo",a,T(e,t,i))},onUploadError(e,t){(0,n.statlogsValueEvent)("upload_photo_fails",1,r.opts.server,t),y(s,e,t)},onDragEnter(e){if((0,p.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,m.isMarusiaPeer)(t.get().peer))return;const i=(0,c.geByClass1)("im-audio-message_recording");e.dataTransfer&&!i&&C(E(s,e.dataTransfer))},onDragOut(){S()},onDrop(){S()}})}function M(e,t,s,i){let a=t.get().upload_doc_opts,r=(0,c.geByClass1)("_im_upload_doc",i),d=(0,c.geByClass1)("_im_drop_doc",i);return Upload.init(r,a.url,a.params,{file_name:"file",file_size_limit:1024*(parseInt(a.opts.file_size_limit_in_MB)||2048)*1024,file_types:"*.*;",lang:a.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:a.opts.server,error:a.opts.default_error,error_hash:a.opts.error_hash,dropbox:d,dragEl:document.body,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,i){let n=(0,o.parseJSON)(i);n.file?function(e,t,s,i){const a=w(e);let n={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};s.opts.imhash&&(n=(0,l.extend)(n,{from_place:"from_gim",imhash:s.opts.imhash})),ajax.post("docs.php",(0,l.extend)(n,t),{onDone:function(e,t,s){i().choose("doc",e+"_"+t,(0,l.extend)(s,{upload_ind:a}))},onFail:y.bind(null,i,e)})}(e,n,a,s):I(e,i,t,s)},onUploadProgress(e,t,i){let a=void 0!==e.ind?e.ind:e;s().progress("doc",a,T(e,t,i))},onUploadError(e,t){(0,n.statlogsValueEvent)("upload_doc_fails",1,a.opts.server,t),y(s,e,t)}})}function P(e,t,s){(0,r.removeEvent)(document.body,"dragover dragenter");const a=(0,c.geByClass1)(h);let l=M(0,t,s,a),f=function(e,t,s,i,a){let r=t.get().upload_video_params;if(!r)return;let l=(0,c.geByClass1)("_im_upload_video",a),d=(0,c.geByClass1)("_im_drop_video",a);return r.options.visible_dropbox=!1,(0,_.getUploadModule)(l,d,r,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,i){let a=(0,o.parseJSON)(i);a.video_id?(0,_.onVideoUploaded)(e,a,t.get().textMediaSelector,((e,s)=>{const i=document.querySelector('[data-video="'+s+'"]'),a=e.editable.sizes.x[0]||e.thumb;if(i&&a){i.style.backgroundImage=`url(${a})`;const e=(0,c.gpeByClass)("_im_mess",i);"im"===cur.module&&e&&(0,g.updateVideoThumb)(t,e)}})):I(e,i,t,s)},onUploadProgress:function(e,t,i){let a=void 0!==e.ind?e.ind:e;s().progress("video",a,T(e,t,i))},onUploadError:function(e,t){(0,n.statlogsValueEvent)("upload_video_fails",1,r.options.server,t),y(s,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(i,e)},onDragEnter:function(e){if((0,p.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,m.isMarusiaPeer)(t.get().peer))return;const i=(0,c.geByClass1)("im-audio-message_recording");e.dataTransfer&&!i&&C(E(s,e.dataTransfer))},onDragOut:function(){S()},onDrop:function(){S()}})}(0,t,s,l,a),v=k(0,t,s,f,a);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;const w=(0,u.createModule)({handlers:e=>{let t=(0,c.ge)("im_full_upload");e(t,"change",(function a(n){if(!window.Upload||!n.target.files)return;if(s().canAddMedia()){const e=Array.from(n.target.files),t=e.filter((e=>Upload.checkFileType(e.name,b("types")))),s=e.filter((e=>Upload.checkFileType(e.name,(0,_.getUploadVideoExtMasks)("types"))));Upload.onFileApiSend(v,t),Upload.onFileApiSend(f,s)}else(0,i.showFastBox)(d.getLang("global_error"),d.getLang("global_error"));(0,u.destroyModule)(w);const o=t.cloneNode();o.value="",t.parentNode.replaceChild(o,t),t=o,e(t,"change",a)}))}});return{paste(e){Upload.onFileApiSend(v,e)},unmount(){(0,u.destroyModule)(w),Upload.deinit(v),Upload.deinit(f),Upload.deinit(l)}}}},322917:(e,t,s)=>{"use strict";s.d(t,{mount:()=>v});var i=s(810903),a=s(7144),n=s(879007),o=s(452314),r=s(610989),l=s(948350),c=s(365485);const d="_ui_multiselect_cancel";function u(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function _(e){return e.selection=[],Promise.resolve(e)}function g(e,t){return t.selection=t.selection.filter((t=>t.id!==e)),Promise.resolve(t)}function m(e,t,s,i,a,r,l){let c=(0,n.intval)((0,o.domData)(l,"peer"));tooltips.hide(l),t.set(g.bind(null,c)).then((n=>{h(e,i,t,a),s().selectionDeleted(t,c)}))}function p(e,t,s,i){e.set(l.setCurrentSearch.bind(null,s,!1)).then(t().onChange)}function h(e,t,s,i){let n=s.get().selection,l=uiSearch.getFieldEl(e);uiSearch.focus(e),n.length>0?(0,o.attr)(l,"placeholder",""):(0,o.attr)(l,"placeholder",(0,a.unclean)(r.getLang("mail_search_creation"))),t.innerHTML=n.map((e=>['<div class="token">',`<div class="token_title">${e.name}</div>`,`<div data-peer="${e.id}" class="token_del ${d}"></div>`,"</div>"])).reduce(((e,t)=>e.concat(t)),[]).join(""),(0,o.toggleClass)(e,"ui_multiselect_has_selection",n.length>0),(0,o.domFC)(e).scrollTop+=50,i()}function f(e,t){return(0,i.showTooltip)(t,{text:r.getLang("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function v(e,t,s){uiSearch.init(e,{onChange:p.bind(null,t,s)});let i=uiSearch.getFieldEl(e),a=(0,o.ce)("div",{className:"_ui_multiselection ui_multiselect_cnt"});i&&i.parentNode.insertBefore(a,i);let n=function(e){let t=0;return function(){let s=e.offsetWidth;(0,o.setStyle)(e,{width:1});let i=e.offsetLeft;t!==i?(t=i,s=e.parentNode.offsetWidth,(0,o.setStyle)(e,{width:Math.max(30,s-i-20)})):(0,o.setStyle)(e,{width:s})}}(i);t.set(_);let r=m.bind(null,e,t,s,a,n),l=t=>{document.activeElement!==i&&uiSearch.focus(e)};const v=(0,c.createModule)({handlers:(t,s)=>{s(e,"click",d,r),s(e,"mouseover",d,f),t(e,"click",l)}});return{addSelection:(s,i)=>t.set(u.bind(null,{id:s,name:i})).then(h.bind(null,e,a,t,n)),removeSelection:s=>t.set(g.bind(null,s)).then(h.bind(null,e,a,t,n)),resetSelection(){!function(e,t,s,i){e.set(_).then(h.bind(null,t,s,e,i))}(t,e,a,n)},focus(){uiSearch.focus(e)},save(){t.stash(),h(e,a,t,n)},restore(){t.pop(),h(e,a,t,n)},unmount(){uiSearch.destroy(e),(0,c.destroyModule)(v)}}}},241750:(e,t,s)=>{"use strict";s.d(t,{mount:()=>k});var i=s(583790),a=s(879007),n=s(452314),o=s(507035),r=s(814402),l=s(365485);function c(e,t){return(0,o.toArray)(e).find((e=>(0,n.domData)(e,"list-id")===t))}function d(e,t){return(0,o.toArray)(e).findIndex((e=>(0,n.domData)(e,"list-id")===t))}function u(e,t,s,i){if(s){_(e,t,i);const a=(0,n.domData)(s,"list-id"),o=a&&c(t.children,a);o&&i.forEach((e=>(0,n.addClass)(o,e))),e.setState({hoveredListItemId:a})}}function _(e,t,s){const i=(0,n.domQuery)("."+s.join("."),t);i&&(0,o.toArray)(i).forEach((e=>{s.forEach((t=>(0,n.removeClass)(e,t)))})),e.setState({hoveredListItemId:null})}function g(e,t){const s=t&&(0,n.domQuery)("."+t.join("."),e)[0];return s?(0,n.domData)(s,"list-id"):null}function m(e,t,s){return e.map(t).reduce(((e,t)=>(e[t]=!0,e)),s)}function p(e,t,s){return{ids:m(s.get().elements,e,{}),scrolls:t,activated:!0}}function h(e,t,s){return s.elements=s.elements.filter((s=>t(s)!==e)),delete s.ids[e],Promise.resolve(s)}function f(e,t,s){let i=[];s.elements=s.elements.map((s=>{const a=t(s),n=e.filter((e=>t(e)===a))[0];return i.push(a),n||s}));let n=e.filter((e=>!(0,a.inArray)(t(e),i)));return s.elements=s.elements.concat(n),Promise.resolve(s)}function v(e){let t={};return e.forEach((e=>{"r"===e[0]&&t[`a,${e[1]}`]?delete t[`a,${e[1]}`]:t[`${e[0]},${e[1]}`]=e})),Object.keys(t).map((e=>t[e]))}function b(e,t,s,i,a,o,r){for(let t=0;t<i;t++)e=(0,n.domNS)(e);let l=(0,n.se)(a(t));return(0,n.domData)(l,"list-id",s),e?o.insertBefore(l,e):o.appendChild(l),r&&r(l),e}function y(e,t,s,i,a){const r=i.get(),l=r.limit,c=r.offset,d=function(e,t){const s=t.get();return!s._sortedEls&&e&&t.setState({elements:s.elements.sort(e),_sortedEls:!0}),t.get().elements}(s().sortFn,i).slice(0,c+l),u=(0,o.toArray)(e.children).map((e=>(0,n.domData)(e,"list-id"))).filter((e=>!!e)),_=d.map((e=>s().idFn(e).toString())),g=function(e,t){let s=[],i=Math.max(e.length,t.length);for(let a=0;a<i;a++){let i=e[a],n=t[a];!i&&n?s.push(["a",n,a]):i&&!n?s.push(["r",i,a]):i!==n&&(s.push(["r",i,a]),s.push(["a",n,a]))}let a=v(s),n=v(s.reverse());return a.length>n.length?n:a}(u,_);if(function(e,t,s,i,a){if(0===t.length)return;const o=(t=t.sort(((e,t)=>e[2]-t[2]))).filter((e=>"a"===e[0])),r=t.filter((e=>"r"===e[0]));if(r.map((t=>e.children[t[2]])).forEach((e=>(0,n.re)(e))),0===o.length)return;let l=o.shift(),c=l[2],d=b(e.children[c],s[l[2]],l[1],0,i,e,a);for(let t=0;t<o.length;t++)l=o[t],d=b(e.children[c],s[l[2]],l[1],l[2]-c,i,e,a),c=l[2]}(e,g,d,s().renderFn,s().onRenderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(i,t),a)return g.filter((e=>"a"==e[0])).map((e=>parseInt(e[1])))}function w(e,t,s,i,a=!1,n=0,o=0){const r=e.get(),l=t.getContainer().children,c=d(l,i||r.hoveredListItemId);if(c<0)return;let u;u=r.limit+r.offset<c?e.setState({offset:c-r.limit+1}).then(y.bind(null,t.getContainer(),t,s)):Promise.resolve(),u.then((()=>{const e=l[c],s=t.scrollTop(),i=t.getScrollHeight(),r=e.offsetHeight;n="center"===n?-.5*i:n,o="center"===o?i/2:o;let d=a?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t);const u=s+n>e.offsetTop,_=r+e.offsetTop>s+i-o;u?d(e.offsetTop-n):_&&d(e.offsetTop-i+r+o)}))}function E(e,t,...s){return e.get().loading||e.get().stop||!e.get().activated?Promise.resolve([]):(e.get().loading=!0,t(...s).then((()=>{e.get().loading=!1})))}function C(e,t,s){return s.scrolls||(s.scrolls={}),s.scrolls[e]&&!t||(s.scrolls[e]={scrolled:s.scrolled||0,scrollItem:s.scrollItem}),Promise.resolve(s)}function S(e,t,s,a){const n=e.get(),o=n.elements,r=a.getContainer();let l=e.setState({offset:n.offset+n.limit}).then((()=>{let s,i=n.offset,l=n.limit;return l+i>o.length?s=t().more(i,l).then((t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t))).then(I.bind(null,e,r,a,t,n.pipeId)):(s=Promise.resolve(),y(r,a,t,e)),s}));if(!s){const e=o.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";(0,i.wrapLoading)(r)(l,"bottom",e)}return l}function T(e,t){let s=e.get().pipeId;return!(void 0!==s&&void 0!==t&&s!==t)}function I(e,t,s,i,a,n){return!!T(e,a)&&e.setState(function(e,t,s){const i=e.filter((e=>!s.ids[t(e)]));return{_sortedEls:!1,els:i,ids:m(i,t,s.ids),elements:s.elements.concat(i)}}(n,i().idFn,e.get())).then(y.bind(null,t,s,i))}function k(e,t,s){const i=E.bind(null,t,S.bind(null,t,s)),n=(e,i)=>{(t.get().activated||e)&&(void 0!==i&&t.get().elements.length>0&&t.setState({scrolled:i}),s().onScroll&&s().onScroll())},v=(0,r.createScroll)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:n.bind(null,!1),more:!!s().more&&i.bind(null,!1)}),b=(0,l.createModule)({handlers:(i,a)=>{a(e,"click",t.get().elCls,s().onClick)}});return t.setState(p(s().idFn,{},t)),{pipe:(e,i)=>(t.setState({pipeId:i}),e.then(I.bind(null,t,v.getContainer(),v,s,i))),replacePreserveOrder:e=>t.set(f.bind(null,e,s().idFn)).then(y.bind(null,v.getContainer(),v,s)),pipeReplace:(e,i,a=!1)=>(t.setState({pipeId:i,stop:!1}),e.then((e=>{if(T(t,i))return t.setState({elements:e,_sortedEls:!1,ids:m(e,s().idFn,{})}).then(y.bind(null,v.getContainer(),v,s,t,a))}))),wipe(){v.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,s)=>t.set(C.bind(null,e,s)),updateScroll(){v.update(!1,!0)},toTop(e,t=!1){t?v.smoothScroll(-v.scrollTop()):v.scrollTop(0),e&&n(e,0)},scrollTop:e=>v.scrollTop(e),restoreScroll(e){const s=t.get().scrolls,i=s[e];return i&&(t.setState({scrolls:(0,a.extend)({},s,{[e]:null})}),v.scrollTop(i.scrolled)),!!i},unsetScroll(e){t.setState({scrolls:(0,a.extend)({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){const s=v.scroll.scroller,i=v.scrollTop(),a=i+("up"===e?-1:1)*s.clientHeight;t?v.smoothScroll(a-i):v.scrollTop(a)},scrollToElement(e,i,a,n){w(t,v,s,e,i,a,n)},getScroller:()=>v.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?i(e,v):Promise.resolve([]),add:(e,i)=>I(t,v.getContainer(),v,s,i,e),hoverNextElement(e,i,a={}){const n=v.getContainer(),r=n.children,l=d(r,t.get().hoveredListItemId||g(n,i)),c=(0,o.toArray)(r).slice(l+1).find(s().hoverableFn);u(t,n,c,e),w(t,v,s,null,!1,a.top,a.bottom)},hoverPrevElement(e,i,a={}){const n=v.getContainer(),r=n.children,l=d(r,t.get().hoveredListItemId||g(n,i)),c=l>=0&&(0,o.toArray)(r).slice(0,l).reverse().find(s().hoverableFn);u(t,n,c,e),w(t,v,s,null,!1,a.top,a.bottom)},hoverFirstElement(e,i){const a=v.getContainer(),n=a.children,r=(0,o.toArray)(n).findIndex(s().hoverableFn),l=n[r];!t.get().hoveredListItemId&&l&&(u(t,a,l,e),w(t,v,s,r,!1,i.top,i.bottom))},hoverElement(e,i,a){const n=v.getContainer(),o=n.children,r=d(o,e),l=o[r];l&&(u(t,n,l,i),w(t,v,s,r,!1,a.top,a.bottom))},unhoverElements(e){_(t,v.getContainer(),e)},reset(){const e=t.get().scrolls;t.reset(),t.setState(p(s().idFn,e,t))},getHoveredElement:()=>c(v.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(h.bind(null,e,s().idFn)).then(y.bind(null,v.getContainer(),v,s))},unmount(){(0,l.destroyModule)(b),v.destroy()}}}},934052:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(879007),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(452314),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(317412),_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(248298),_web_lib_fx__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(663878),_web_lib_layout_body_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(22307),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(618913);const DATA_ATTR_SUBMENU_NAVIGABLE="data-uirmenu-submenu-navigable",uiRightMenu={go:function(e,t,s,i={}){if((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__.checkEvent)(t))return!0;const a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e),{navOptions:n,ignoreSelected:o=!1,switchMenuOptions:r}=i;if(!o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",a)==e)return!1;if(uiRightMenu.switchMenu(e,void 0,r),uiRightMenu.showProgress(e),!1===s)return!1;const l={onDone:(...t)=>{n?.onDone?.(...t),uiRightMenu.hideProgress(e)}},c={...n||void 0,...l};return nav.go(s||e,t,c)},switchMenu:function(e,t,s={}){const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",i),{preventSubmenuExpand:n=!1}=s;if(e==a&&!t)return!1;const o=[],r=[];if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(i,"_ui_rmenu_auto_expand")){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass)("_ui_rmenu_sublist",i),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"_ui_rmenu_subitem")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("_ui_rmenu_sublist",e):!!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domNS)(e),"_ui_rmenu_sublist")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domNS)(e);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(t,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(this)&&this!==s&&(o.push(this),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hide)(this))})),n||!s||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(s)||(r.push(s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.show)(s)),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(o,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.show)(this)})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(r,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hide)(this)}))}return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(a,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClass)(e,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(i,"_ui_rmenu_auto_expand")?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(o.concat(r),(function(){uiRightMenu.toggleSubmenu(this)})):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"_ui_rmenu_subitem")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(e))&&uiRightMenu.toggleSubmenu((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(e)),!1},unselectAll:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(e,"ui_rmenu_sliding"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",e),"ui_rmenu_item_sel")},isSelectedItem:e=>e.classList.contains("ui_rmenu_item_sel"),showProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e));const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_loading_item",e);t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(t,"ui_rmenu_loading_item");const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",e);(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__.hideProgress)(e),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__.showProgress)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domFC)(s).parentNode,"","",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClass)(e,"ui_rmenu_loading"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClass)(s,"ui_rmenu_loading_item")},hideProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e)),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__.hideProgress)(e);const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(e,"ui_rmenu_loading");const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_loading_item",t);s&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(s,"ui_rmenu_loading_item")},toggleSubmenu:function(name,ref,event){if(event&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__.checkEvent)(event))return;const isSubmenuNavigatedResult=toggleSubmenuNavigable(ref);if(isSubmenuNavigatedResult.navigated)return isSubmenuNavigatedResult.navGoResult;const menu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",ref);let el,submenu;if("string"==typeof name?submenu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_ui_rmenu_"+name+"_list",menu):(submenu=name,name=submenu.getAttribute("data-sublist-id")),el=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_ui_rmenu_"+name+"_toggle",menu),!submenu)return!1;el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(el,"ui_rmenu_item_expanded",!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(submenu)),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_4__.slideToggle)(submenu,submenu&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(submenu)[1]?100:0),setTimeout(_web_lib_layout_body_utils__WEBPACK_IMPORTED_MODULE_5__.updateNarrow,100);const onToggle=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"on-toggle");return onToggle&&setTimeout((function(){try{eval(onToggle)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,onToggle)}}),150),!1},selectLabelNode:e=>e?.querySelector(".ui_rmenu_label-text")};function isItemSubmenuNavigable(e){return e?.hasAttribute?.(DATA_ATTR_SUBMENU_NAVIGABLE)}function toggleSubmenuNavigable(e){if(isItemSubmenuNavigable(e)){if(!e.classList.contains("ui_rmenu_item_sel")){return{navigated:!0,navGoResult:uiRightMenu.go(e,void 0,void 0,{switchMenuOptions:{preventSubmenuExpand:!0}})}}}return{navigated:!1}}const __WEBPACK_DEFAULT_EXPORT__=uiRightMenu},621753:(e,t,s)=>{"use strict";s.d(t,{initDraggable:()=>a,removeDraggable:()=>n});var i=s(317412);function a(e,t){let s,a,n=function(i){s=void 0!==i.clientX?i.clientX:i.touches[0].clientX,a=void 0!==i.clientY?i.clientY:i.touches[0].clientY,t.onDrag&&t.onDrag.call(e,s,a)},o=function(r){t.onDrop&&t.onDrop.call(e,s,a),(0,i.removeEvent)(document,"mouseup touchend mouseleave",o),(0,i.removeEvent)(document,"mousemove touchmove",n)},r=function(r){(1===r.which||r.touches&&r.touches[0])&&((0,i.addEvent)(document,"mouseup touchend mouseleave",o),(0,i.addEvent)(document,"mousemove touchmove",n),s=void 0!==r.clientX?r.clientX:r.touches[0].clientX,a=void 0!==r.clientY?r.clientY:r.touches[0].clientY,t.onStartDrag&&t.onStartDrag.call(e,s,a),t.onDrag&&t.onDrag.call(e,s,a),(0,i.cancelEvent)(r))};e.beginDragHandler=r,(0,i.addEvent)(e,"mousedown touchstart",r)}function n(e){(0,i.removeEvent)(e,"mousedown touchstart",e.beginDragHandler)}},348089:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var i=s(452314);let a=[],n=0,o=!1;function r(e){a=a.reduce(((t,[s,i])=>i(e)?t:t.concat([[s,i]])),[])}function l(e,t=[]){return n++,{stop(){n--,function(e){a=a.filter((([t])=>t!==e)),0===n&&(document.body.removeEventListener("click",r,!0),o=!1)}(e)},replaceOrAdd(s){const n=a.filter((([t])=>e===t)),l=function(e,t){return 0===t.length?t=>(e(t),!0):s=>{const a=t.reduce(((e,t)=>e&&!(0,i.domClosest)(t,s.target)),!0);return a&&e(s),a}}(s,t);n.length>0?function(e,t){a=a.map((([s,i])=>s===e?[e,t]:[s,i]))}(e,l):function(e,t){!1===o&&(o=!0,document.body.addEventListener("click",r,!0)),a=a.concat([[e,t]])}(e,l)}}}},418368:(e,t,s)=>{"use strict";s.d(t,{create:()=>d});var i=s(485413),a=s(452314),n=s(317412),o=s(583790),r=s(945154);function l(e,t){return t.state=e,Promise.resolve(t)}function c(e,t,s,i,a){switch(t){case r.ARROW_UP:(0,o.isEditableFocused)()||(i.scroll(a,"up"),(0,n.cancelEvent)(s));break;case r.ARROW_DOWN:(0,o.isEditableFocused)()||(i.scroll(a,"down"),(0,n.cancelEvent)(s));break;case r.PAGE_UP:s.ctrlKey||(0,o.isClassicInterface)(a)||(i.scroll(a,"up",!0),(0,n.cancelEvent)(s));break;case r.PAGE_DOWN:s.ctrlKey||(0,o.isClassicInterface)(a)||(i.scroll(a,"down",!0),(0,n.cancelEvent)(s));break;case r.HOME:(0,o.isEditableFocused)()||(i.scroll(a,"up",!1,!0),(0,n.cancelEvent)(s));break;case r.END_KEY:(0,o.isEditableFocused)()||(i.scroll(a,"down",!1,!0),(0,n.cancelEvent)(s));break;case r.PRINTABLE:i.focustTxt(e)}}function d(e,t,s,d,u,_){let g=(0,i.default)({state:t||"default"});return{signal(t,i){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(g.get().state){case"default":return c(g,t,i,d,e);case"fwd":case"search":return function(e,t,s,i,l,c){switch(t){case r.ARROW_DOWN:i&&i.hoverNextDialog(c),(0,n.cancelEvent)(s);break;case r.ARROW_UP:i&&i.hoverPrevDialog(c),(0,n.cancelEvent)(s);break;case r.ENTER:(0,o.isEditableFocused)()&&!(0,a.gpeByClass)("_im_dialogs_search_input",document.activeElement)||i&&i.selectHoveredDialog(c);break;case r.PRINTABLE:l.focusInput()}}(0,t,i,s,u,e);case"create":return function(e,t,s,i,l){switch(t){case r.PAGE_UP:!s.ctrlKey&&(0,o.isClassicInterface)(l)&&(i.scroll("up"),(0,n.cancelEvent)(s));break;case r.PAGE_DOWN:!s.ctrlKey&&(0,o.isClassicInterface)(l)&&(i.scroll("down"),(0,n.cancelEvent)(s));break;case r.ARROW_DOWN:i.hoverNextElement(l);break;case r.ARROW_UP:i.hoverPrevElement(l);break;case r.ENTER:(0,a.gpeByClass)("_im_dialogs_creation_name",document.activeElement)?i.confirmCreate(l):(0,a.gpeByClass)("im-create--search",document.activeElement)&&i.selectElement(l);break;case r.PRINTABLE:i.focusSearch(l)}}(0,t,i,_,e);case"message":return function(e,t,s,i,a){switch(t){case r.HOME:case r.END_KEY:i.isEmpty(a)&&c(e,t,s,i,a);break;case r.PAGE_UP:case r.PAGE_DOWN:c(e,t,s,i,a)}}(g,t,i,d,e);default:throw new Error("Unknown state: "+g.get().state)}},transition:e=>g.set(l.bind(null,e))}}},637634:(e,t,s)=>{"use strict";s.d(t,{startLongPoll:()=>L,startLongPollForGroup:()=>A});var i=s(948350),a=s(490712),n=s(879007),o=s(485413),r=s(49071),l=s(891911),c=s(803898),d=s(58318),u=s(507035),_=s(28432),g=s(858587);const m=202,p=4,h=14,f=3e4;let v={},b=Date.now();function y(e,t){let s=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&(0,a.statlogsValueEvent)("im_longpoll",1,s+"0x",t.getResponseHeader("x-frontend")),v[s]=v[s]?v[s]+1:1,Date.now()-b>=f&&(Object.keys(v).forEach((e=>{(0,a.statlogsValueEvent)("im_longpoll",v[e],e+"0x",t.getResponseHeader("x-frontend"))})),v={},b=Date.now()))}function w(e,t){return Promise.resolve((0,n.extend)({},t,{timeout:e<64?2*e:e}))}function E(e,t){return Promise.resolve((0,n.extend)({},t,{imTs:e}))}function C(e){e.set((e=>Promise.resolve((0,n.extend)({},e,{stopped:!0})))).then((()=>{e.get().cancelToken()}))}function S(e,t){return t.cancelToken=e,Promise.resolve(t)}function T(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function I(e){return e.pauses||(e.pauses=[]),(0,u.lplog)("Aborting all pauses","error"),e.pauses.forEach((e=>e())),e.pauses=[],Promise.resolve(e)}function k(e,t,s,a){let{abort:n,pause:o}=a.failed?(0,c.abortablePause)(p,e):{};switch(a.failed){case 1:return(0,u.lplog)("Old timestamp, init resync","error"),e.set(T.bind(null,n)),s([l.resyncEvent()]),e.set(i.loadLongPollTs).then(o).then(M.bind(null,e,t,s));case 2:return(0,u.lplog)("Key is incorrect","error"),e.set(T.bind(null,n)),e.set(i.loadLongPollKey).then(o).then(M.bind(null,e,t,s));case 3:throw nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(E.bind(null,a.ts)).then((()=>a))}}function M(e,t,s){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));const i=e.get(),a=`${i.imUrl}/${i.imPart}`,{request:n,cancel:o}=(0,r.plaingetCancelable)(a,{act:"a_check",key:i.imKey,version:h,ts:i.imTs,wait:25,mode:i.mode});return e.set(S.bind(null,o)).then((()=>n)).then((([t,s])=>(s&&y(i,s),e.set(w.bind(null,1)),JSON.parse(t)))).catch((([e,t])=>(t&&y(i,t),Promise.reject(new Error(""))))).then(k.bind(null,e,t,s))}function P(e,t,s){e.get().stopped||((0,u.lplog)("New request"),M(e,s,t).then((e=>e.map(l.constructEvent))).then((e=>((0,u.lplog)("Request success","success"),e))).then(t).catch((t=>{if(!e.get().stopped)return(0,u.lplog)("Error, waiting: "+(t.message||"no message (probably browser reset)"),"error"),e.set(w.bind(null,s()?p/2:e.get().timeout)).then((()=>{let{abort:t,pause:s}=(0,c.abortablePause)(e.get().timeout,e);return e.set(T.bind(null,t)).then(s)}));(0,u.lplog)("Stopped longpoll")})).then(P.bind(null,e,t,s)))}function A(e){const t=new window.EventEmitter,s=(0,g.createLongpollEventsQueue)(e.ts,(e=>{t.trigger("data",e)})),i=(0,_.createLongpoll)(e,s.onLp);return{onData:e=>t.on("data",e),offData:e=>t.off("data",e),push:e=>t.trigger("data",e),pause:s.pause.bind(s),resume:s.resume.bind(s),abortWaiting:i.abortWaiting.bind(i),onLp:s.onLp.bind(s),stop:i.stopConnection.bind(i),isEnabled:()=>!(!i||i.isStopped())}}function L({id:e,gid:t,key:s,ts:i,url:a,lhost:n,lpstat:r}){const l="main",c=new EventEmitter,u=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,_=(0,d.initQueue)((function(e,t){return u&&window.longpollTesting_onImEvents(t),c.trigger("data",t),Promise.resolve({})})),{pause:g,resume:p,pushMessage:h,isPaused:f,reset:v}=_,b=(0,o.default)({id:e,gid:t,mode:m,timeout:1,imKey:s,imTs:i,imPart:a,imUrl:n,pause:!1,stat:r});return P(b,h.bind(null,l),f.bind(null,l)),{onData:e=>c.on("data",e),offData:e=>c.off("data",e),abortWaiting:()=>b.set(I),stop:C.bind(null,b),pause:g.bind(null,l),resume:p.bind(null,l),reset:v.bind(null,l),push:e=>c.trigger("data",e),isEnabled:()=>!b.get().pause&&!b.get().stopped}}},58318:(e,t,s)=>{"use strict";s.d(t,{initQueue:()=>v});var i=s(485413),a=s(879007),n=s(803898),o=s(476726);function r(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function l(e,t){let s=t.queues[e].currEv;return s?(t.queues[e].errored.push(s),r(e,t)):Promise.resolve(t)}function c(e,t,s){return s.queues[e]?(s.queues[e].errored=t?[]:s.queues[e].errored.concat(s.queues[e].evs),s.queues[e].evs=[],r(e,s)):Promise.resolve(s)}function d(e,t,s,i){let a=i.get().queues[e];if(a&&!a.currEv&&a.evs.length>0&&!a.pause){let n=d.bind(null,e,t,s,i),o=a.evs.shift();a.currEv=o,t(e,o).then((()=>{i.get().opts.waitCommit||i.set(r.bind(null,e))})).then(n).catch((t=>i.set(l.bind(null,e)).then((()=>{s(e,function(e,t){let s=m(e,t.get()).errored;return s.length>0&&s[s.length-1]}(e,i),t)})).then(n)))}}function u(e,t,s){let i=s.queues[e];return i.errored.filter((e=>e.mess.messageId===t)).forEach((e=>{e.failed=!1,i.evs.push(e)})),i.errored=i.errored.filter((e=>e.mess.messageId!==t)),Promise.resolve(s)}function _(e){const t=Date.now();return Object.keys(e.queues).forEach((s=>g(s,e,t,18e5))),Promise.resolve(e)}function g(e,t,s=0,i=0){const a=t.queues[e],n=[];return a.errored.forEach((e=>{e.ts>=s-i?(e.failed=!1,a.evs.push(e)):n.push(e)})),a.errored=n,Promise.resolve(t)}function m(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function p(e,t,s){return m(e,s).pause=t,Promise.resolve(s)}function h(e,t,s){return t.ts=Date.now(),m(e,s).evs.push(t),Promise.resolve(s)}function f(e){Object.keys(e.get().queues).forEach((t=>{e.set(l.bind(null,t)),e.set(c.bind(null,t,!1))}))}function v(e,t,s){let l=(0,i.default)({queues:{},debug:s&&s.debug,opts:(0,a.extend)({},s)},s);return s&&s.store?(l.setState(function(e){let t={};const s=Object.keys(e.queues),i=s.length;for(let a=0;a<i;a++){const i=s[a],n=e.queues[i];(n.currEv||n.evs.length||n.errored.length)&&(t[i]=n)}return{queues:t,opts:e.opts}}(l.get())),f(l)):f(l),{pushMessage:(s,i)=>l.set(h.bind(null,s,i)).then((a=>{(0,o.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[i.rid].push("queue push message"),d(s,e,t,a)})),resend:(s,i=null)=>l.set(u.bind(null,s,i)).then((()=>{let a=l.get().queues[s].evs.filter((e=>e.mess.messageId===i))[0];return d(s,e,t,l),a})),resendAll:()=>l.set(_).then((()=>{Object.keys(l.get().queues).forEach((s=>{d(s,e,t,l)}))})),resendPeer:s=>l.set(g.bind(null,s)).then((()=>{d(s,e,t,l)})),reset:s=>l.set(c.bind(null,s,!0)).then((i=>{d(s,e,t,i)})),setErrored:(e,t)=>l.set((s=>(m(e,s).errored=t,Promise.resolve(s)))),pause(e){l.set(p.bind(null,e,!0))},isPaused:e=>!!m(e,l.get()).pause,complete(s,i){const a=l.get();a.queues[s].currEv&&a.queues[s].currEv.rid===i&&l.set(r.bind(null,s)).then((()=>{d(s,e,t,l)}))},resume(s){l.set(p.bind(null,s,!1)).then((0,n.pause)(.1)).then((()=>{d(s,e,t,l)}))},inspectQueue(e,t=!1){if(!l.get().queues[e])return[];let s=l.get().queues[e];return(t&&s.currEv?[s.currEv]:[]).concat(s.evs.slice()).concat(s.errored.slice().map((e=>(0,a.extend)({},e,{failed:!0})))).sort(((e,t)=>e.ts-t.ts))}}}},357854:(e,t,s)=>{"use strict";s.d(t,{createWorker:()=>_});var i=s(803898),a=s(879007);let n=new Map,o=!1;function r(e){return e.queue||e.key}function l(){n.forEach((({onData:e,onUpdateKey:t,ts:s},i)=>{if(function(e){return!!window.curNotifier?.addQueues&&!curNotifier.addQueues[r(e)]}(i)){const a={...i,ts:s};Notifier.addKey(a,u.bind(null,e,t,a))}}))}function c(){o||(o=setInterval(l,3e3))}function d(e){!function(e){if(!window.curNotifier?.addQueues)return!1;delete curNotifier.addQueues[r(e)]}(e),n.delete(e),0===n.size&&(clearInterval(o),o=!1)}function u(e,t,s,o,r){if(r.failed)return d(s),void function(e,t,s,a){let o;switch(e){case 1:case 2:case 3:case 5:o=a(t,e);break;case 4:o=(0,i.pause)(1).then((()=>t));break;default:throw new Error("Unkonwn error from queue: "+e)}(0,i.pause)(3).then((()=>o)).then((e=>{n.set(e,{onUpdateKey:a,onData:s,ts:e.ts}),l(),c()}))}(r.err,s,e,t);const u=(0,a.intval)(r.ts);Object.assign(s,{ts:u}),function(e,t){let s;const i=e?.queue;if(i)for(let[e]of n)if(e?.queue===i){s=e;break}const a=s??e;n.set(a,t)}(s,{onData:e,onUpdateKey:t,ts:u}),r.events.map((e=>"string"==typeof e?e.split("<!>"):e)).forEach(e)}function _(e,t,s){return Notifier.addKey(e,u.bind(null,t,s,e)),n.set(e,{onData:t,onUpdateKey:s,ts:e.ts}),c(),{stop:d.bind(null,e)}}},823169:(e,t,s)=>{"use strict";s.d(t,{default:()=>v,getUploadModule:()=>w,getUploadVideoExtMasks:()=>b,onVideoUploaded:()=>E});var i=s(20025),a=s(7144),n=s(610989),o=s(357889),r=s(490712),l=s(614212),c=s(879007),d=s(850101),u=s(317412),_=s(688701),g=s(452314),m=s(769876),p=s(423212),h=s(36498),f=s(645084);const v={getUploadModule:(e,t,s,i,a)=>w(e,t,s,i,a),initModalVideoUploader(e){const t=cur.videoUploadParams,s=(0,g.ge)("choose_video_upload");if(!s)return!1;this.initDragEvents();const i={},a={};switch(e){case"article":i.onUploadProgress=()=>{},i.onUploadStartDone=e=>{window.cur.onMediaUploadStarted?.(e)},i.onUploadError=e=>{window.cur.onMediaUploadFail?.(e)};break;case"market":i.onUploadStart=({file:e})=>{window.cur.onMediaUploadStarted?.(e)}}return(0,f.isPostingPerfStatsEnabled)()&&window.Wall?.postingTimelineLogger&&(a.onUploadStart=e=>{window.Wall?.postingTimelineLogger?.logStartFileUploading({fileType:h.POSTING_FILE_TYPES.VIDEO,rawId:String(e?.fileName)})},a.onUploadError=e=>{window.Wall?.postingTimelineLogger?.logFileLoadingError({rawId:String(e?.fileName)})},a.onUploadComplete=(e,t)=>{t?.includes("error")?window.Wall?.postingTimelineLogger?.logFileLoadingError({rawId:String(e?.fileName),message:t}):window.Wall?.postingTimelineLogger?.logFileLoaded({rawId:String(e?.fileName)})}),w(s,boxLayerWrap,t,null,i,a)},initDragEvents(){const e=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);const t=(0,g.ge)("video_choose_upload_area_wrap");if((0,g.hasClass)(t,"video_choose_upload_area_enter"))return;(0,g.addClass)(t,"video_choose_upload_area_enter");const s=(0,g.ge)("video_choose_wrap"),i=(0,g.getXY)(s)[1],a=(0,g.getSize)(t)[1];return(0,g.hide)("video_choose_wrap"),(0,g.setStyle)(t,"height",(0,_.scrollGetY)()+(0,g.clientHeight)()-i+a),(0,u.cancelEvent)(e)},t=e=>(window.cur.dragTimeout&&(clearTimeout(window.cur.dragTimeout),delete window.cur.dragTimeout),window.cur.dragTimeout=setTimeout((()=>{const e=document.getElementById("video_choose_upload_area_wrap");e&&(e.classList.remove("video_choose_upload_area_enter"),e.style.height="auto",(0,g.show)("video_choose_wrap"))}),100),(0,u.cancelEvent)(e)),s=e=>{t();if(e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),(0,u.cancelEvent)(e)},i=()=>{(0,u.addEvent)(boxLayerWrap,"dragenter dragover",e),(0,u.addEvent)(boxLayerWrap,"dragleave",t),(0,u.addEvent)(boxLayerWrap,"drop",s)};i();const a=(0,d.curBox)().getOptions()?.onHide;setTimeout((0,d.curBox)().setOptions.pbind({onHide:()=>{if((0,u.removeEvent)(boxLayerWrap,"dragenter dragover",e),(0,u.removeEvent)(boxLayerWrap,"dragleave",t),(0,u.removeEvent)(boxLayerWrap,"drop",s),"function"==typeof a)return a()},onShow:()=>{Video.initChooseBox(),i()}}),0)}};function b(e){return"types"===e?[...m.VIDEO_UPLOAD_EXTS,...m.VIDEO_UPLOAD_EXTS.map((e=>e.toUpperCase()))].map((e=>`*.${e}`)).join(";"):"accept"===e?m.VIDEO_UPLOAD_INPUT_ACCEPT:""}function y(e){if(cur.leaving)return;const t=n.getLang("video_upload_changed");let s=!1;if((0,c.each)(window.cur.videoUploaders,((e,t)=>{Upload.isSomethingUploading(t)&&(s=!0)})),1===e){if(!s)return!0;const e=(0,i.showFastBox)({title:n.getLang("global_warning")},t,n.getLang("global_continue"),(function(){cur.leaving=!0,e.hide(),cur.onContinueCb&&cur.onContinueCb()}),n.getLang("global_cancel"),(function(){e.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return s?(0,a.winToUtf)(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}function w(e,t,s,a,d,u={}){if(!s)return;a=a||cur,(d=d||{}).onUploadStart||(d.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,t,s){if(!1===y(1))return cur.onContinueCb=nav.go.pbind(s),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=y,d.onUploadProgress(e,0,0),window.Wall?.showEditPost?.(),d.onUploadStartDone&&d.onUploadStartDone(e)}),d.onUploadComplete||(d.onUploadComplete=(e,t)=>{let s=(0,l.parseJSON)(t);if(s.video_id)E(e,s,a);else{"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e)}d.onUploadCompleteDone&&d.onUploadCompleteDone(),setTimeout((()=>{d.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&d.onUploadAllCompleteDone()}))}),d.onUploadProgress||(d.onUploadProgress=(e,t,s)=>{let i=void 0!==e.ind?e.ind:e;(0,g.show)("_im_media_preview"),a.showMediaProgress&&a.showMediaProgress("video",i,function(e,t,s){return{loaded:t,total:s,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,s))}),d.onUploadError||(d.onUploadError=(e,t)=>{(0,r.statlogsValueEvent)("upload_video_fails",1,s.options.server,t),function(e){let t=void 0!==e.ind?e.ind:e,s=e.fileName?t+"_"+e.fileName:e;if((0,g.re)("upload"+s+"_progress_wrap"),!(0,g.geByClass1)("popup_box_container")){let e=n.getLang("video_upload_error");setTimeout((0,i.showFastBox)({title:n.getLang("global_error")},e).hide,2e3)}(0,o.topError)("Upload failed",{dt:-1,type:102,url:((0,g.ge)("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;const _=cur.maxFiles-(cur.savedVideos||[]).length;s.lang&&(cur.lang=(0,c.extend)(cur.lang||{},s.lang));const p={accept:b("accept"),file_input:null,file_name:"video_file",file_size_limit:1024*(s.options.file_size_limit_in_GB||m.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:b("types"),chooseBox:1,chunked:1,chunkSize:m.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:document.body,dropbox:t,from:s.vars.from,lang:s.lang,max_attempts:3,max_files:_,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!s.options.hasOwnProperty("visible_dropbox")||s.options.visible_dropbox,eventCallbacks:u},h=Upload.init(e,"",{},Object.assign(p,d));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(h),h}function E(e,t,s,a){s=s||cur;const o=void 0!==e.ind?e.ind:e,r=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),l=r?o+"_"+r:e,d=t.owner_id+"_"+t.video_id,u=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo;let _=(0,g.ge)("upload"+l+"_progress_wrap");_&&(0,g.hide)((0,g.geByClass1)("progress_x",_)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:d},{onDone:e=>{u||s.chooseMedia("video",d,(0,c.extend)(e[d],{upload_ind:l,upload_new:!0}));const o=t.owner_id,r=t.video_id,_=t.video_hash;let m=0;const h=()=>{ajax.post("al_video.php?act=encode_progress",{owner_id:o,vid:r,hash:_,need_thumb:1},{onDone:t=>{let _=!0;if(t){if(t.error)return m=(0,p.getUploadErrorText)(t.error_details,n.getLang("video_upload_encode_error")),void setTimeout((0,i.showFastBox)({title:n.getLang("global_error")},m).hide,2e3);t.thumb&&100===parseInt(t.percents,10)&&(_=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:o,vid:r},{onDone:t=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(d,t),void(0,g.re)("upload"+l+"_progress_wrap");s.hasChosenMedia("video",d)?s.updateChosenMedia("video",d,(0,c.extend)(t,{upload_ind:l,upload_new:!0})):a&&a(e,d)}}))}var m;_&&(u||s.hasChosenMedia("video",d))&&setTimeout(h,1e3)},onFail:()=>{m++,m<3&&setTimeout(h,2e3*m)}})};h()}})}},536002:(e,t,s)=>{"use strict";s.d(t,{browser:()=>a,getWarningBrowserInfo:()=>n});const i=navigator.userAgent.toLowerCase(),a={version:(i.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test(i)&&/webkit|safari|khtml/i.test(i),edge:/(edge)\/(\d+)\.(\d+)/.test(i),chrome:/(chrome)\/(\d+)\.(\d+)/.test(i),firefox:/(firefox)\/(\d+)\.(\d+)/.test(i)};function n(e){const t=e?.find((e=>a[e.browser]&&void 0===e.version)),s=e?.find((e=>a[e.browser]&&String(a.version).startsWith(String(e.version))));return s??t??null}},890639:(e,t,s)=>{"use strict";s.d(t,{StickersSettingsService:()=>l});var i=s(331635),a=s(327813),n=s(174597),o=s(127126),r=s(726356);let l=class{async getSettings(){this.isGetSettingsLoading=!0;try{const{settings:e}=await this.api.getSettings({}),t=this.mapSettings(e);return this.setSettingsData(t),(0,r.updateSettingsCache)({animationAutoplay:t.autoplay,popupAutoplayOnGet:t.popup.autoplayOnGet,popupAutoplayOnSend:t.popup.autoplayOnSend,popupDisabledPeerIds:t.popup.disabledPeerIds}),t}finally{this.isGetSettingsLoading=!1}}async setSettings(e){this.isSetSettingsLoading=!0;try{const{settings:t}=await this.api.setSettings(e),s=this.mapSettings(t);return this.setSettingsData(s),(0,r.updateSettingsCache)({animationAutoplay:s.autoplay,popupAutoplayOnGet:s.popup.autoplayOnGet,popupAutoplayOnSend:s.popup.autoplayOnSend,popupDisabledPeerIds:s.popup.disabledPeerIds}),s}finally{this.isSetSettingsLoading=!1}}async setPopupSettings(e){this.isSetPopupSettingsLoading=!0;try{const t=await this.api.setPopupSettings(e),s=this.mapPopupSettings(t.popup);return this.popup=s,(0,r.updateSettingsCacheBySetPopupSettingsResponse)(t),s}finally{this.isSetPopupSettingsLoading=!1}}mapSettings(e){return{autoplay:Boolean(e?.animation_autoplay),popup:this.mapPopupSettings(e?.popup)}}mapPopupSettings(e){return{autoplayOnGet:Boolean(e?.autoplay.on_get),autoplayOnSend:Boolean(e?.autoplay.on_send),disabledPeerIds:e?.autoplay?.disabled_peer_ids??[]}}setSettingsData(e){(0,a.runInAction)((()=>{this.isAutoplayAnimation=e.autoplay,this.popup=e.popup}))}constructor(){this.api=new n.StickersApi,this.isGetSettingsLoading=!1,this.isSetSettingsLoading=!1,this.isSetPopupSettingsLoading=!1,this.isAutoplayAnimation=!1,this.popup={autoplayOnGet:!1,autoplayOnSend:!1,disabledPeerIds:[]},(0,a.makeAutoObservable)(this)}};l=(0,i.__decorate)([o.scope.global(),(0,i.__metadata)("design:paramtypes",[])],l)},174597:(e,t,s)=>{"use strict";s.d(t,{StickersApi:()=>a});var i=s(609897);class a extends i.ApiNamespace{get namespace(){return"stickers"}constructor(){super(...arguments),this.getSettings=this.makeMethod("getSettings"),this.setSettings=this.makeMethod("setSettings"),this.setPopupSettings=this.makeMethod("setPopupSettings")}}},792045:(e,t,s)=>{"use strict";s.d(t,{addConflictBlocksNative:()=>_,destroyByRemoveEventNative:()=>m,destroyBySpeedIncrementEventNative:()=>g,handlePlayPopUpNative:()=>u});var i=s(474848),a=s(205338),n=s(942451),o=s(136949),r=s(697033),l=s(920641),c=s(657112);const d=(0,n.makeSharedState)("sticker-popup",(()=>new l.PopupStickerService),{version:2})();function u({stickerElement:e,layers:t,onEndPlay:s,containersIdsToMountIn:n,zIndexMountNode:l,...u}){const _=document.createElement("div");let g;d.prepare({stickerElement:e,layers:t,mountNode:()=>{const t=e.closest(`[${c.CONTAINER_ID_DATA_PROPERTY}]`),s=t??document.body,{popupFullScreenSelector:u=c.FULL_SCREEN_DATA_DEFAULT_VALUE}=s.dataset,m=t?.dataset[c.CONTAINER_ID_DATASET_PROPERTY]&&n?.[t.dataset[c.CONTAINER_ID_DATASET_PROPERTY]],p=m?t:document.querySelector(u)??document.body;m&&(_.style.zIndex=String(l??2),_.style.position="relative"),p.prepend(_),g=(0,a.createRoot)(_),g.render((0,i.jsx)(r.PopupProvider,{popupStore:d,children:(0,i.jsx)(o.PopUpPortal,{portalElement:_})}))},onEndPlay:()=>{s?.(),g?.unmount(),_.remove()},...u})}function _(e){d.conflictBlocks.addConflictBlock(e)}function g(){d.destroyBySpeedIncrement()}function m(){d.destroyByRemove()}},900424:(e,t,s)=>{"use strict";s.d(t,{ContactListApp:()=>d});s(397139);var i=s(296540),a=s(269396),n=s(554312),o=s(742400),r=s(346440),l=s(175953),c=s(845164);const d=({store:e,env:t,onSelect:s})=>{const[d,u]=(0,i.useState)(e.getState());(0,i.useEffect)((()=>e.subscribe(u)),[e]);const _=l.safeGet(d.peers,d.viewer.id),{items:g,contacts:m,hasMore:p}=d.contacts;return i.createElement(c.ErrorBoundary,{fallbackRender:()=>null,onError:e=>t.logger.error("[ContactListApp] Error",e)},i.createElement("div",{className:"ContactListApp MEConfig"},i.createElement(r.Symbols,null),i.createElement(a.Provider,{env:t,state:d,dispatch:e.dispatch,featureFlags:e.featureFlags,owner:_},i.createElement(o.LayoutDataProvider,{mode:"two-column"},i.createElement(n.ContactList,{items:g,contacts:m,hasMore:p,onSelect:s})))))}},7988:(e,t,s)=>{"use strict";s.d(t,{Settings:()=>S});s(73243);var i=s(296540),a=s(870134),n=s(550084),o=s(27716),r=s(298684),l=s(180304),c=s(120757),d=s(758778),u=s(675277),_=s(817970),g=s(592837),m=s(342798),p=s(812628),h=s(455878),f=s(106962),v=(s(140083),s(793103),s(753457)),b=s(70915),y=s(500542),w=(s(843779),s(175953),s(280240)),E=s(207768),C=s(73514);s(821160);const S=({isLoading:e,set:t=new Set(["ctrSubmit","soundNotifications","showRecommendations","countOnlyNotMuted","autoUnarchive","transcriptAutoShow","theme","push"]),profileInfoControl:s})=>{const{lang:h,browserNotifications:f}=(0,b.useBrowserEnv)(),{settings:w}=(0,b.useViewer)(),E=(0,b.useFeatureFlags)(),S=(0,b.useDispatch)(),[k,P]=(0,i.useState)((()=>f?.getPermission()??"unknown")),[A,L]=(0,i.useState)(Boolean(f?.isExternal()));return(0,i.useEffect)((()=>{P(f?.getPermission()??"unknown"),f?.onSystemSettingChange((e=>{P(f?.getPermission()??"unknown"),L(Boolean(f?.isExternal())),S({type:"UserChangedBrowserNotifications",value:e})}))}),[f,S]),i.createElement("ul",{className:"Settings"},e&&i.createElement(y.OptimizedSpinner,{className:"Settings__loader"}),s&&i.createElement(n.OptionsListItemWrapper,{className:"Settings__profileOptionItem",isPadded:!1},s),t.has("ctrSubmit")&&i.createElement(n.OptionsListItem,{icon:i.createElement(o.Icon28SendCircleFillGray,null),title:h.use("me_settings_message_submit"),aside:i.createElement(T,{isCtrSubmitSelected:w.ctrSubmit,onChange:e=>S({type:"UserChangedSetting",setting:"ctrSubmit",value:e})})}),t.has("soundNotifications")&&i.createElement(n.OptionsListItem,{icon:i.createElement(r.Icon28VolumeCircleFillGray,null),title:h.use("me_settings_sound_notifications"),aside:i.createElement(v.Switch,{className:"Settings__switch",checked:w.soundNotifications,onChange:e=>S({type:"UserChangedSetting",setting:"soundNotifications",value:Boolean(e.target.checked)})})}),!E.vkm_settings_hide_suggested&&t.has("showRecommendations")&&i.createElement(n.OptionsListItem,{icon:i.createElement(l.Icon28UsersCircleFillGray,null),title:h.use("me_settings_show_recommendations"),aside:i.createElement(v.Switch,{className:"Settings__switch",checked:w.showRecommendations,onChange:e=>S({type:"UserChangedSetting",setting:"showRecommendations",value:Boolean(e.target.checked)})})}),t.has("countOnlyNotMuted")&&i.createElement(n.OptionsListItem,{icon:i.createElement(c.Icon28MessageUnreadCircleFillGray,null),title:h.use("me_settings_count_not_muted"),description:h.use("me_settings_count_not_muted_note"),aside:i.createElement(v.Switch,{className:"Settings__switch",checked:!w.countOnlyNotMuted,onChange:e=>S({type:"UserChangedSetting",setting:"countOnlyNotMuted",value:!Boolean(e.target.checked)})})}),t.has("autoUnarchive")&&i.createElement(n.OptionsListItem,{icon:i.createElement(d.Icon28ArchiveCircleFillGray,null),title:h.use("me_settings_auto_unarchive"),description:h.use("me_settings_auto_unarchive_note"),aside:i.createElement(v.Switch,{className:"Settings__switch",checked:w.autoUnarchive,onChange:e=>S({type:"UserChangedSetting",setting:"autoUnarchive",value:Boolean(e.target.checked)})})}),f&&i.createElement(n.OptionsListItem,{icon:i.createElement(u.Icon28NotificationCircleFillGray,null),title:h.use("me_settings_browser_notifications_messages_calls"),aside:i.createElement(I,{browserNotifications:f,isExternal:A,permission:k})}),w.teacherVerification&&i.createElement(n.OptionsListItem,{icon:i.createElement(_.Icon28EducationCircleFillGray,null),title:h.use("me_settings_teacher_verification_title"),description:h.use("me_settings_teacher_verification"),aside:i.createElement(a.ExternalLink,{href:C.SFERUM_VERIFICATION_LINK,className:"Settings__link"},h.use("me_settings_teacher_verification_link"))}),t.has("transcriptAutoShow")&&i.createElement(n.OptionsListItem,{icon:i.createElement(g.Icon28TextCircleFillGray,null),title:h.use("me_settings_auto_transcript"),aside:i.createElement(v.Switch,{className:"Settings__switch",checked:w.transcriptAutoShow,onChange:e=>S({type:"UserChangedSetting",setting:"transcriptAutoShow",value:Boolean(e.target.checked)})})}),E.vkm_reactions&&t.has("messageReactionAnimation")&&i.createElement(n.OptionsListItem,{icon:i.createElement(m.Icon16Stars,{fill:"var(--vkui--color_text_contrast)"}),hasIconBackground:!0,title:h.use("me_settings_message_reactions_animation"),aside:i.createElement(v.Switch,{className:"Settings__switch",checked:w.messageReactionAnimation,onChange:e=>S({type:"UserChangedSetting",setting:"messageReactionAnimation",value:Boolean(e.target.checked)})})}),E.vkm_reactions&&t.has("push")&&i.createElement(n.OptionsListItem,{icon:i.createElement(u.Icon28NotificationCircleFillGray,null),title:h.use("me_settings_reaction_notifications"),aside:i.createElement(v.Switch,{className:"Settings__switch",checked:w.push.messageReaction.isEnabled,onChange:e=>S({type:"UserChangedPushSetting",setting:"messageReaction",value:{isEnabled:Boolean(e.target.checked),withMessageText:!0}})})}),t.has("theme")&&i.createElement(n.OptionsListItem,{icon:i.createElement(p.Icon28SunglassesCircleFillGray,null),title:h.use("me_settings_theme"),aside:i.createElement(M,{theme:w.theme,onChange:e=>S({type:"SettingThemeUpdated",value:e})})}))},T=({isCtrSubmitSelected:e,onChange:t})=>{const{lang:s}=(0,b.useBrowserEnv)(),a=e?s.use("me_settings_message_submit_option_ctr"):s.use("me_settings_message_submit_option_default");return i.createElement("div",{className:"Settings__select"},i.createElement(w.Dropdown,{openType:"click",hideOnClick:!0,content:i.createElement(E.ActionsMenu,null,i.createElement(E.ActionsMenuAction,{onClick:()=>t(!1),title:s.use("me_settings_message_submit_option_default"),subtitle:s.use("me_settings_message_submit_option_default_note"),rightIcon:i.createElement(h.Icon24CheckCircleOn,{style:{width:"16px",height:"16px",visibility:e?"hidden":"visible"}}),type:"primary"}),i.createElement(E.ActionsMenuAction,{onClick:()=>t(!0),title:s.use("me_settings_message_submit_option_ctr"),subtitle:s.use("me_settings_message_submit_option_ctr_note"),rightIcon:i.createElement(h.Icon24CheckCircleOn,{style:{width:"16px",height:"16px",visibility:e?"visible":"hidden"}}),type:"primary"})),align:"center",position:"bottom"},i.createElement(v.Button,{mode:"tertiary",after:i.createElement(f.Icon12Dropdown,null)},a)))},I=({browserNotifications:e,permission:t,isExternal:s,ariaLabelledby:a})=>{const n=(0,b.useDispatch)(),{settings:o}=(0,b.useViewer)(),{lang:r}=(0,b.useBrowserEnv)();return s&&"default"!==t?i.createElement(v.Button,{mode:"tertiary",after:i.createElement(f.Icon12Dropdown,null),onClick:e.onExternal},r.use("me_settings_browser_notifications_external")):i.createElement(v.Switch,{className:"Settings__switch","aria-labelledby":a,checked:o.browserNotifications,onChange:t=>e.onChange(Boolean(t.target.checked)).then((e=>n({type:"UserChangedBrowserNotifications",value:e})))})},k=["light","dark","system"],M=({theme:e,onChange:t})=>{const{lang:s}=(0,b.useBrowserEnv)();return i.createElement("div",{className:"Settings__select"},i.createElement(w.Dropdown,{openType:"click",hideOnClick:!0,content:i.createElement(E.ActionsMenu,null,k.map((a=>i.createElement(E.ActionsMenuAction,{key:a,onClick:()=>t(a),title:s.use(`me_settings_theme_${a}`),rightIcon:i.createElement(h.Icon24CheckCircleOn,{style:{width:"16px",height:"16px",visibility:e===a?"visible":"hidden"}}),type:"primary"})))),align:"center",position:"top"},i.createElement(v.Button,{mode:"tertiary",after:i.createElement(f.Icon12Dropdown,null)},s.use(`me_settings_theme_${e}`))))}},907560:(e,t,s)=>{"use strict";s.d(t,{SettingsApp:()=>l});s(895619),s(154335);var i=s(296540),a=s(7988),n=s(269396),o=s(175953),r=s(845164);const l=({store:e,env:t,set:s})=>{const l=(0,i.useSyncExternalStore)(e.subscribe,e.getState),c=0===l.convoConn.pts,d=o.safeGet(l.peers,l.viewer.id);return i.createElement(r.ErrorBoundary,{fallbackRender:()=>null,onError:e=>t.logger.error("[SettingsApp] Error",e)},i.createElement(n.Provider,{env:t,state:l,dispatch:e.dispatch,featureFlags:e.featureFlags,owner:d},i.createElement(a.Settings,{isLoading:c,set:s})))}},594177:(e,t,s)=>{"use strict";function i(e){return 17===e?.error_code}function a(e){return i(e)&&Boolean(e.redirect_uri?.includes("act=validate"))}function n(e){return!!e&&"object"==typeof e&&"error_code"in e}s.d(t,{isApiError:()=>n,isPhoneValidationError:()=>a})},617923:(e,t,s)=>{"use strict";var i;s.d(t,{EntityType:()=>i,EventQueue:()=>a}),function(e){e.Online="online"}(i||(i={}));class a{constructor({getQueue:e,registerQueue:t}){this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=()=>{this.intervalId&&clearInterval(this.intervalId),0!==this.retriesLeft&&(this.retriesLeft--,this.getQueue().then((e=>{this.retriesLeft=this.MAX_RETRIES;const t={...e};this.intervalId=window.setInterval((()=>{this.registerQueue(t,((e,s)=>{if(void 0===s.err){t.ts=s.ts;for(const e of s.events)for(const t of this.listeners)t(e)}else this.restart()}))}),this.QUEUE_KEY_TTL)})).catch((e=>{console.error(e),setTimeout(this.restart,this.QUEUE_KEY_TTL)})))},this.subscribe=e=>(this.listeners.push(e),1===this.listeners.length&&this.restart(),()=>{this.listeners=this.listeners.filter((t=>t!==e)),0===this.listeners.length&&(this.retriesLeft=this.MAX_RETRIES,this.intervalId&&clearInterval(this.intervalId))}),this.registerQueue=t,this.getQueue=e}}},753158:(e,t,s)=>{"use strict";s.d(t,{createLongpollConnect:()=>f});var i=s(803898),a=s(49071),n=s(891911),o=s(476726);const r=1226,l=(0,o.partConfigEnabled)("me_web_read_by_cmid")?15:14,c=4,d=-3,u=-4,_=-5;function g(e,t){e.waitAbortFns.push(t)}function m(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});const{request:t,cancel:s}=(0,a.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode});return e.stopFn=s,t.then((([t,s])=>(e.onData(e,s),e.waitTimeout=2,JSON.parse(t)))).catch((([,t])=>(e.onData(e,t),Promise.reject(new Error(""))))).then((t=>function(e,t){const{abort:s,pause:a}=t.failed?(0,i.abortablePause)(c,null):{abort:()=>{},pause:()=>Promise.resolve()};switch(t.failed){case 1:return g(e,s),e.onHistoryLost(e,t).then((()=>e.onResult({ts:t.ts,updates:[[-1]]}))).then(a).then((()=>m(e)));case 2:return g(e,s),e.onKeyExpired(e,t).then((([t,s,i,a])=>e.onResult({ts:+a,updates:[[-2,t,`${s}/${i}`],[-1]]}))).then(a).then((()=>m(e)));case 3:return e.onLpBroken(e,t);default:return t.updates.some((e=>{switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}))?e.onHistoryLost(e,t).then((()=>e.onResult({ts:t.ts,updates:[[-1]]}))).then(a).then((()=>m(e))):Promise.resolve(t)}}(e,t)))}function p(e){e.isStoppedFn()||m(e).then(e.onResult.bind(e)).then((()=>e.isReconnecting&&h(e,_))).catch((t=>function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),h(e,d);const{abort:s,pause:a}=(0,i.abortablePause)(e.waitTimeout,null);return g(e,s),a().then((()=>h(e,u)))}(e,t))).then((()=>p(e)))}function h(e,t){e.isReconnecting=t===u,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function f(e,t){let s=!!e.stopped;const i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||l,mode:r,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:()=>s,onResult:e=>{e.ts&&o(i.ts,e.ts,e.updates.map(n.constructEvent))},onData:v(t.onData),onRequestError:v(t.onRequestError),onHistoryLost:b(t.onHistoryLost),onKeyExpired:b(t.onKeyExpired),onLpBroken:b(t.onHistoryLost)},{onEvents:a}=t;function o(e,t,s){i.ts=t;for(let e=0;e<s.length;++e)s[e].type===n.REFRESH_LP_KEY&&(i.key=s[e].key||"",i.url=s[e].url||"");a(e,t,s)}const c={options:i,isStopped:()=>s,stopConnection(){s=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,document.removeEventListener("resume",d),this.abortWaiting()},reinitConnection(){this.stopConnection(),document.addEventListener("resume",d),h(i,u),s=!1,p(i)},abortWaiting(){i.waitAbortFns.forEach((e=>e())),i.waitAbortFns=[],i.waitTimeout=2},onLp:o};function d(){c.abortWaiting()}return document.addEventListener("resume",d),p(i),c}function v(e){return e||(()=>{})}function b(e){return e?(...t)=>Promise.resolve(e(...t)):()=>Promise.reject()}},858587:(e,t,s)=>{"use strict";function i(e,t,s){let i=0,a=e,n=[],o=!1;function r(){!n.length||i>0||o||(t(n),n=[])}return{pause(){i++},resume(){i>0&&(i--,r())},onLp(e,t,i){o||(a>=e?(a=t,n.push(...i),r()):s&&(o=!0,s(a).then((([,e,t])=>{a=e,o=!1,n.push(...t),r()}))))}}}s.d(t,{createLongpollEventsQueue:()=>i})},132940:(e,t,s)=>{"use strict";s.d(t,{CategoriesModalBody:()=>l});var i=s(474848),a=s(193984),n=s(7630),o=s(296540);function r(e){return e.map((e=>e.items)).flat()}const l=({api:e,categories:t,selectedCategory:s,onItemClick:l,onItemView:c,onShowMoreClick:d,error:u,onError:_,reloadCategories:g})=>((0,o.useEffect)((()=>{t&&t.length&&c(r(t))}),[t]),u?(0,i.jsx)(n.ErrorBlock,{onReloadClick:g}):t?s?(0,i.jsx)(a.SkillsBlock,{api:e,categoryName:s,onItemClick:l,onItemView:c,onError:_}):(0,i.jsx)("div",{"data-testid":"marusia-skill-list",children:t.map((e=>(0,i.jsx)(a.CategoryBlock,{category:e,onShowMoreClick:d,onItemClick:e=>l(e,r(t))},e.name)))}):(0,i.jsx)(a.CategoriesSkeleton,{}))},428256:(e,t,s)=>{"use strict";s.d(t,{CategoriesSkeleton:()=>p,CategoryBlock:()=>_});var i=s(474848),a=s(625134),n=s(765668),o=s(445248),r=s(296916),l=s(515073),c=s(610989),d=s(810437),u=s(651446);const _=({category:e,onShowMoreClick:t,onItemClick:s})=>{const o=(0,i.jsx)(a.Header,{aside:(0,i.jsx)(n.Link,{onClick:()=>{t(e.name,e.title)},children:c.getLang("mail_marusia_modal_show_all")}),children:e.title});return(0,i.jsx)(u.CategoryGroup,{highlight:e.is_featured,header:o,children:e.items.map((e=>(0,i.jsx)(d.SkillItem,{item:e,onClick:s},e.title)))})},g=({subtitle:e})=>(0,i.jsx)(o.SimpleCell,{before:(0,i.jsx)(r.FakeAvatar,{size:28,children:(0,i.jsx)(l.Skeleton,{circle:!0,width:28,height:28})}),hasHover:!1,hasActive:!1,subtitle:e&&(0,i.jsx)(l.Skeleton,{width:70,height:12}),children:(0,i.jsx)(l.Skeleton,{width:140,height:16})}),m=({highlight:e})=>(0,i.jsxs)(u.CategoryGroup,{highlight:!!e,children:[(0,i.jsx)(g,{}),(0,i.jsx)(g,{subtitle:!0}),(0,i.jsx)(g,{subtitle:!0}),(0,i.jsx)(g,{subtitle:!0})]}),p=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m,{highlight:!0}),(0,i.jsx)(m,{}),(0,i.jsx)(m,{})]})},651446:(e,t,s)=>{"use strict";s.d(t,{CategoryGroup:()=>r});var i=s(474848),a=s(957485),n=s(500774),o=s(785118);const r=({children:e,highlight:t,header:s})=>{const r=(0,i.jsx)(n.Group,{className:t?a.default.highlight:void 0,mode:t?"card":"plain",padding:t?"m":"none",header:s,separator:t?"hide":"show",children:e});return t?(0,i.jsx)(o.Div,{mode:"horizontal",style:{paddingTop:16},children:r}):r}},7630:(e,t,s)=>{"use strict";s.d(t,{ErrorBlock:()=>l});var i=s(474848),a=s(923594),n=s(43723),o=s(533048),r=s(610989);const l=({onReloadClick:e})=>(0,i.jsx)(a.Placeholder,{icon:(0,i.jsx)(n.Icon56IllustrationAntenna,{}),action:(0,i.jsx)(o.Button,{mode:"tertiary",onClick:e,children:r.getLang("mail_marusia_modal_retry")}),children:r.getLang("mail_marusia_modal_error_text")})},810437:(e,t,s)=>{"use strict";s.d(t,{SkillItem:()=>d,SkillSkeleton:()=>u});var i=s(474848),a=s(923448),n=s(140083),o=s(753457),r=s(296916),l=s(445248),c=s(515073);const d=({item:e,onClick:t})=>{const s="dark"===(0,o.useAppearance)()?e.icons.dark:e.icons.light;return(0,i.jsx)(o.Cell,{"data-testid":"marusia-skill-item",onClick:()=>{t(e)},before:(0,i.jsx)(r.FakeAvatar,{size:28,children:(0,i.jsx)("img",{className:a.default.skillImage,src:s,alt:e.title})}),after:(0,i.jsx)(n.Icon24ChevronCompactRight,{className:a.default.icon}),subtitle:e.subtitle,children:e.title})},u=()=>(0,i.jsx)(l.SimpleCell,{before:(0,i.jsx)(r.FakeAvatar,{size:28,children:(0,i.jsx)(c.Skeleton,{circle:!0,width:28,height:28})}),hasHover:!1,hasActive:!1,subtitle:(0,i.jsx)(c.Skeleton,{width:70,height:12}),children:(0,i.jsx)(c.Skeleton,{width:140,height:16})})},559266:(e,t,s)=>{"use strict";s.d(t,{SkillsBlock:()=>r});var i=s(474848),a=s(296540),n=s(810437);const o=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{}),(0,i.jsx)(n.SkillSkeleton,{})]}),r=({api:e,categoryName:t,onItemClick:s,onItemView:r,onError:l})=>{const[c,d]=(0,a.useState)(null);return(0,a.useEffect)((()=>{e.skillList(t).then((e=>{d(e.result.items)})).catch(l)}),[e,t]),(0,a.useEffect)((()=>{c&&c.length&&r(c)}),[c]),(0,i.jsx)(i.Fragment,{children:c?c.map((e=>(0,i.jsx)(n.SkillItem,{item:e,onClick:e=>s(e,c)},e.title))):(0,i.jsx)(o,{})})}},193984:(e,t,s)=>{"use strict";s.d(t,{CategoriesModalBody:()=>i.CategoriesModalBody,CategoriesSkeleton:()=>a.CategoriesSkeleton,CategoryBlock:()=>a.CategoryBlock,SkillsBlock:()=>n.SkillsBlock,itemToSuggest:()=>r.itemToSuggest,useCategories:()=>o.useCategories});var i=s(132940),a=s(428256),n=s(559266),o=s(424758),r=s(287709)},424758:(e,t,s)=>{"use strict";s.d(t,{useCategories:()=>n});var i=s(296540);let a=null;const n=e=>{const[t,s]=(0,i.useState)(null),[n,o]=(0,i.useState)(null),[r,l]=(0,i.useState)(!1),c=()=>{a=null,o(null),l(!0)},d=()=>{l(!1),s(null),o(null),(e=>(a||(a=e.skillListCategories()),a))(e).then((e=>{s(e.result.categories)})).catch(c)};return(0,i.useEffect)((()=>{d()}),[]),{categories:t,reloadCategories:d,error:r,handleError:c,selectedCategory:n,setSelectedCategory:o}}},287709:(e,t,s)=>{"use strict";s.d(t,{itemToSuggest:()=>i});const i=e=>({type:"text_suggest",callback_data:"",payload:e.subtitle,text:e.subtitle})},615637:(e,t,s)=>{"use strict";s.d(t,{MarusiaButton:()=>_});var i=s(188720),a=s(589435),n=s(227930);const o="im-send-btn--marusia",r="MarusiaButtonOld--visible",l="MarusiaButtonOld--loading",c="MarusiaButtonOld__wave--active",d="MarusiaButtonOld__typing--active",u="MarusiaButtonOld__animation--hidden";class _{init({container:e}){this.button=e,this.container=this.button.querySelector("._marusia_button")??document.createElement("span"),this.wrapperContainer=this.container.querySelector("._marusia_wrapper")??document.createElement("span"),this.animationContainer=this.container.querySelector("._marusia_animation")??document.createElement("span"),this.typingContainer=this.container.querySelector("._marusia_typing")??document.createElement("span"),this.waveContainer=this.container.querySelector("._marusia_wave")??document.createElement("span"),this.animation=new a.LottieAnimation(this.animationContainer),this.wave=new i.Wave({min:0,max:128},2,{container:this.waveContainer,width:40,height:40,amplitude:.2,autostart:!1,cover:!0}),this.state=null,this.isInitialized=!0}setAnimations(e,t){return this.wrapperContainer.style.backgroundImage=`url(${t})`,this.animation.setAnimations(e)}setIconState(e){if(!this.isInitialized)return;if(!this.animation.haveAnimations())return;const t=this.state;if(this.state=e,t!==this.state)switch("listen"===this.state?this.wave.start():this.wave.stop(),this.waveContainer.classList.remove(c),this.typingContainer.classList.remove(d),this.animationContainer.classList.remove(u),e){case"ready":"loading"===t?this.animation.play("load_to_mic"):"answering"===t?this.animation.play("stop_to_mic"):"listen"===t?this.animation.play("load_to_mic"):"typing"===t?this.readyShownFirstTime||(this.readyShownFirstTime=!0,this.animation.play("intro")):this.animation.play("intro");break;case"typing":this.typingContainer.classList.add(d);break;case"loading":"listen"===t?this.animation.play("wave_to_load")?.then((()=>{n.playerStore.get().isPlaying||this.playLoadingLoop()})):"ready"===t?this.animation.play("mic_to_loader")?.then((()=>{this.playLoadingLoop()})):"answering"===t&&this.animation.play("stop_to_loader")?.then((()=>{this.playLoadingLoop()}));break;case"listen":"ready"===t?this.animation.play("mic_to_wave")?.then(this.showWave.bind(this)):"answering"===t?this.animation.play("stop_to_wave")?.then(this.showWave.bind(this)):"loading"===t&&this.animation.play("mic_to_wave")?.then(this.showWave.bind(this));break;case"answering":"loading"===t?this.animation.play("load_to_stop"):"listen"===t?this.animation.play("wave_to_stop"):"ready"===t&&this.animation.play("load_to_stop");break;case"error":"ready"===t&&this.animation.play("mic_to_error")}}hide(){this.isInitialized&&(this.button.classList.remove(o),this.container.classList.remove(r))}show(){this.isInitialized&&(this.button.classList.add(o),this.container.classList.add(r))}showPreload(){this.container.classList.add(l)}hidePreload(){this.container.classList.remove(l)}updateWave(e){this.wave.update(e)}dispose(){this.isInitialized&&(this.hide(),this.wave.dispose(),this.animationContainer.innerHTML="",this.waveContainer.innerHTML="",this.readyShownFirstTime=!1,this.state=null)}showWave(){"listen"===this.state&&(this.waveContainer.classList.add(c),this.animationContainer.classList.add(u))}playLoadingLoop(){"loading"===this.state&&this.animation.play("load_loop",{loop:!0})}constructor(){this.readyShownFirstTime=!1,this.isInitialized=!1}}},940547:(e,t,s)=>{"use strict";s.d(t,{MarusiaStatCollector:()=>o});var i=s(815169),a=s(667749),n=s(974930);class o{logPerformance(e){return this.performanceCollector.logEvent(e)}logConversationView(e){return this.conversationViewCollector.logEvent(e)}logConversationClick(e){return this.conversationClickCollector.logEvent(e)}constructor(){this.performanceCollector=new i.MarusiaPerformanceActionStatCollector,this.conversationViewCollector=new a.MarusiaConversationViewStatsCollector,this.conversationClickCollector=new n.MarusiaConversationClickStatsCollector}}},243443:(e,t,s)=>{"use strict";s.d(t,{SuggestManager:()=>l});var i=s(610989),a=s(134015);const n="MarusiaSuggestsOld--visible",o="MarusiaSuggestsOld__item";function r(e){let t="";return"text_suggest"===e.type&&(t=e.text),"event_suggest"===e.type&&(t=e.text),"url_suggest"===e.type&&(t=e.text),(0,a.replaceSpecialPhrases)(t)}class l{init({container:e,onSuggestClick:t,onSuggestListUpdate:s}){this.canvas=document.createElement("canvas"),this.container=e,this.suggestList=e.querySelector("._marusia_suggest_list")??document.createElement("div"),this.onSuggestClick=t,this.onSuggestListUpdate=s,this.suggestList.addEventListener("wheel",(e=>((e,t)=>{e.scrollLeft+=t.deltaY})(this.suggestList,e))),this.isInitialized=!0}toggleVisibility(e){this.container.classList.toggle(n,e)}show(){this.isInitialized&&this.container.classList.add(n)}hide(){this.isInitialized&&this.container.classList.remove(n)}clearSuggests(){this.suggestList.innerHTML="",this.onSuggestListUpdate?.([])}update(e,t=!1){this.currentCommands=e,this.toggleVisibility(!!e.length),this.clearSuggests(),(t?e:this.short(e)).forEach((e=>{const t=this.createSuggestItem(e);this.suggestList.appendChild(t)})),this.onSuggestListUpdate?.(e)}unmount(){this.isInitialized&&(this.hide(),this.suggestList.innerHTML="")}getSuggestWidthPx(e){return this.getTextWidth(r(e))+34}getTextWidth(e){const t=this.canvas.getContext("2d");if(!t)return 7*e.length;t.font=this.getContainerFont();return t.measureText(e).width}getContainerFont(){const e=getComputedStyle(this.suggestList);return`${e.getPropertyValue("font-weight")} ${e.getPropertyValue("font-size")} ${e.getPropertyValue("font-family")}`}short(e){let t=this.suggestList.offsetWidth,s=3,i=[],a=!0;return e.forEach((e=>{if(0===s)return void(a=!1);const n=this.getSuggestWidthPx(e);if(t-=n,t>=0)i.push(e);else{if(s-=1,0===s)return void(a=!1);t=1===s?500-n-118:500-n,t>=0&&i.push(e)}})),a||i.push({type:"more"}),i}createSuggestItem(e){if("more"===e.type)return this.createMoreItem();const t=document.createElement("div");return t.className=o,t.innerHTML=r(e),t.onclick=()=>{this.onSuggestClick(e,this.instanceId,this.currentCommands,"suggests")},t}createMoreItem(){const e=document.createElement("div");return e.className=o,e.innerHTML=i.getLang("mail_marusia_suggest_show_more"),e.onclick=()=>{this.update(this.currentCommands,!0)},e}constructor(e){this.instanceId=e,this.currentCommands=[],this.isInitialized=!1}}},935818:(e,t,s)=>{"use strict";s.d(t,{TtsPlayer:()=>r});var i=s(109465),a=s(381081),n=s(634180),o=s(227930);class r{init(){!1===this.isInitialized&&(this.player.src=i.SILENCE,this.player.play().catch((()=>{})),this.isInitialized=!0)}prepareSoundPlay(){this.soundPlayer.src=i.SILENCE,this.soundPlayer.play().catch((()=>{}))}prepareTtsPlay(){this.interruptCurrentAudio(),this.player.src=i.SILENCE,this.player.play().catch((()=>{}))}playSound(e){this.soundPlayer.src=e,this.soundPlayer.play().catch((()=>{}))}stop(e=!0){e&&this.restoreMediaVolume(),this.interruptCurrentAudio(),this.player.pause(),o.playerStore.setIsPlaying(!1)}play(e,t){return this.getTtsUrl(e,t).then((e=>(o.playerStore.setIsPlaying(!0),new Promise(((t,s)=>{this.player.src=e,this.reduceMediaVolume(),this.player.play().catch((()=>{})),this.interruptCurrentAudio=()=>s(new Error(n.MarusiaError.USER_INTERRUPT)),this.player.onended=()=>{o.playerStore.setIsPlaying(!1),this.restoreMediaVolume(),this.player.onended=null,t()}})))))}reduceMediaVolume(){null===this.prevVolume&&(this.prevVolume=this.audioPlayer.getVolume()),this.audioPlayer.setVolume(.01)}restoreMediaVolume(){null!==this.prevVolume&&(this.audioPlayer.setVolume(this.prevVolume),this.prevVolume=null)}async getTtsUrl(e,t){let s="";switch(t.type){case"tts":s=await this.getStreamUrl(e,t.stream_id);break;case"sound":s=t.url}return s}async getStreamUrl(e,t){const s=await this.api.getApiHost(),i=await(0,a.getSession)(this.api),n=this.api.generateDeviceId(),o={session_id:i.session_id,device_id:n,stream_id:t,phrase_id:e},r=new URLSearchParams(o).toString();return`${s.server_url}/stream?${r}`}constructor({audioPlayer:e,api:t}){this.isInitialized=!1,this.prevVolume=null,this.interruptCurrentAudio=()=>{},this.player=new Audio,this.soundPlayer=new Audio,this.audioPlayer=e,this.api=t}}},227930:(e,t,s)=>{"use strict";s.d(t,{playerStore:()=>i});const i=(()=>{let e=0;const t={isPlaying:!1};let s=[];const i=e=>{s.forEach((t=>{t.cb(e)}))};return{get:()=>t,set:(e,s)=>{t[e]=s,i(t)},setIsPlaying:e=>{t.isPlaying=e,i(t)},subscribe:t=>{const i=e++;return s.push({id:i,cb:t}),()=>{s=s.filter((e=>e.id!==i))}}}})()},589435:(e,t,s)=>{"use strict";s.d(t,{LottieAnimation:()=>n});var i=s(455548);const a="marusia";class n{haveAnimations(){return!!this.animations}setAnimations(e){return i.getLottieManager.then((e=>{e.observer.ignoreGroup(a)})),this.animations=Object.entries(e).reduce(((e,[t,s])=>({...e,[t]:e=>i.getLottieManager.then((i=>i.loadAnimation({name:t,animationData:s,group:a,containers:[this.targetEl],loop:!1,autoplay:!1,lazyLoading:!1,...e})))})),{}),Promise.resolve()}play(e,t){if(this.animations?.[e])return new Promise((async s=>{if(!this.animations)return void s();const i=await this.animations[e]({...t,autoplay:!0});i.hide(),i.addEventListener("loopComplete",(()=>{requestAnimationFrame((()=>{s()}))}),{once:!0}),i.addEventListener("enterFrame",(()=>{this.currentAnimation?.destroy(),this.currentAnimation=i,requestAnimationFrame((()=>{i.show()}))}),{once:!0})}))}constructor(e){this.animations=null,this.targetEl=e}}},2874:(e,t,s)=>{"use strict";s.d(t,{constructPlayerAudio:()=>r,extractPlaylistCommands:()=>m,getAudioList:()=>h,getCommandsToAutoplay:()=>p,getFullIdFromTuple:()=>u,getHashesForAudios:()=>o,getVoiceAssistantData:()=>l,isAudioAttach:()=>d});var i=s(59052),a=s(255944);const n="marusia_playlist_audio";async function o(e,t){const s=t.map((e=>`${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]}_${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]}_${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY]}`)).join(",");let a=null;try{a=await e.reloadAudios(s)}catch{}return a?(a.forEach((e=>{const s=t.find((t=>t[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]===e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]));s&&(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=s[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA])})),a):null}function r(e,t,s){const o=function(e){if(e.coverUrl)return`${e.coverUrl},${e.coverUrl}`;if(e.cover_url)return`${e.cover_url},${e.cover_url}`;if(e.album?.thumb?.photo_68&&e.album?.thumb?.photo_135){return`${e.album.thumb.photo_68},${e.album.thumb.photo_135}`}return""}(e),r=!!e.album&&[e.album.owner_id,e.album.id,e.album.access_key],l=function(e,t){switch(e){case a.MarusiaMediaType.podcast:return{podcast:!0,fave:!1,private:!1};case a.MarusiaMediaType.tale:case a.MarusiaMediaType.books:return{voiceAssistant:t,marusiaTale:!0};case a.MarusiaMediaType.radio:return{voiceAssistant:t,radio:!0,externalStream:!0};default:return{voiceAssistant:t}}}(t,s),c=new Array(27);let d=e.title,u=e.artist??"Marusia";return t===a.MarusiaMediaType.radio&&(d=`${e.artist} ${e.title}`,u=""),c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=e.id??0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=e.owner_id??0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]=e.url,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TITLE]=d,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER]=u,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]=e.duration??0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_ID]=e.album?.id??0,c[7]=0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_AUTHOR_LINK]="",c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_LYRICS]=0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_CONTEXT]=t===a.MarusiaMediaType.tale||t===a.MarusiaMediaType.books?"":"im",c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(l),c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_HASHES]="",c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_COVER_URL]=o,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ADS]=e.ads??{},c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_SUBTITLE]="",c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS]="",c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS]="",c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM]=r,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_CODE]=e.track_code??"",c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART]=0,c[23]=!0,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY]=e.access_key??n,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]=!1,c[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_PAGE_ID]="",c}function l(e,t){let s;const i=c(e),a=t.find((e=>e.attaches?.find((e=>e.id===i))));if(a){const e=a.attaches?.findIndex((e=>e.id===i));if(-1!==e){const t=a.kludges?.[`attach${e+1}_voice_assistant`];try{s=JSON.parse(t)}catch(e){}}}return s}function c(e){return(e.meta.owner_id??0)+"_"+(e.meta.id??0)}function d(e){return"type"in e&&("audio"===e.type||"podcast"===e.type)}function u(e){return`${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]??0}_${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]??0}`}function _(e){return"media"===e.type||"playlist"===e.type}function g(e){return Promise.all(e.map(((t,s)=>function(e,t,s){return 0===e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]?new Promise((a=>{const n=new Audio(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]);n.addEventListener("loadedmetadata",(()=>{s[t][i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]=n.duration,a()})),setTimeout(a,5e3)})):Promise.resolve()}(t,s,e))))}function m(e){if(!e.length)return[];const t=[];return e.filter(_).forEach((e=>{"media"===e.type&&t.push(e),"playlist"===e.type&&e.tracks.forEach((e=>{t.push({...e,type:"media"})}))})),t}function p(e,t){const s=t.map((e=>e.attaches??[])).flat().filter(d);if(!e.length)return[];const i=s.map((e=>e.id));let a=m(e);return a=a.filter((e=>i.includes(c(e)))),a}async function h(e,t){let s=t[e];const i=t.filter(((t,s)=>s<e)),a=s.media_type;if(i.filter((e=>"media"===e.type&&e.media_type===a)).length)return;const n=t.filter((e=>"media"===e.type&&e.media_type===a)).map((e=>r(e.meta,a,{source:e.meta?.source})));return await g(n),n}},489404:(e,t,s)=>{"use strict";async function i(e,t,s){s(await e.upgradeToken(t))}s.d(t,{processCommandNeedMoreVkPermissions:()=>i})},78863:(e,t,s)=>{"use strict";s.d(t,{MARUSIA_HELP_BUTTON_CLASS:()=>i});const i="_im_marusia_help"},639999:(e,t,s)=>{"use strict";s.d(t,{MarusiaSharedSdk:()=>v});var i=s(942451),a=s(408063),n=s(714209),o=s(634180),r=s(550801),l=s(754683),c=s(935818),d=s(227930),u=s(381081),_=s(134015),g=s(255944),m=s(308109),p=s(476726),h=s(940547);const f=(0,i.makeSharedState)("marusia-sdk",(()=>({vkcom:()=>{},mvk:()=>{},fastchat:()=>{}})),{version:0});class v{onPhraseUpdate(e){this.eventCallbacks.phrase_update?.(e.text_so_far||"...")}generateId(){return this.platform.entry+this._messageId++}enqueueCommand(e){this.processCommandsQueue.push(e)}isQueued(e){return!!this.processCommandsQueue.find((t=>t.id===e))}processCommandsFromQueue(e){if(0!==this.processCommandsQueue.length&&this.processCommandsQueue[0].id===e){const e=this.processCommandsQueue.shift();if(!e)return;if(this.isHidden)return;e.cb()}}clearQueue(){this.processCommandsQueue=[]}sendMessage(e,t,s,i){this.eventCallbacks.send_message?.({text:e,payload:{communication_type:t,voice_assistant:{support_process_commands_by_ids:!0,id:s.id}},instanceId:i}),this.enqueueCommand(s)}onPhraseFinish(e,t,s){const i=()=>{this.processCommands(t,s.result.commands,s.result.controls).then((()=>{this.setMarusiaState("ready");let t=!0;if(s.result.commands.length){"listen"===s.result.commands[s.result.commands.length-1].type&&(t=!1,this.onClick(e))}s.result.controls.some((e=>e.type===m.ControlType.CONTROL_TYPE_VOLUME))&&(t=!1),t&&this.ttsPlayer?.restoreMediaVolume()})).catch((e=>{this.onError(e)}))};if(null===s.result.asr_text)return this.clearTextInput(),this.eventCallbacks.phrase_finish?.(""),void i();this.eventCallbacks.phrase_finish?.(s.result.asr_text);const a={id:this.generateId(),cb:i};this.sendMessage(s.result.asr_text,o.CommunicationType.button,a,e),this.isRecording=!1}onStatusUpdate(e){switch(this.log("textSoFar",e,Object.entries(l.TextSoFarStatus).find((t=>t[1]===e))?.[0]),e){case l.TextSoFarStatus.INIT:this.isDisabled=!0,this.setMarusiaState("loading");break;case l.TextSoFarStatus.MEDIA_STREAM_ACQUIRED:this.staticStorage&&this.ttsPlayer?.playSound(this.staticStorage.sounds.sound_start),this.eventCallbacks.phrase_start?.("...");break;case l.TextSoFarStatus.PHRASE_CREATED:this.textSoFar?.start(),this.isDisabled=!1,this.setMarusiaState("listen"),this.isRecording=!0;break;case l.TextSoFarStatus.API_ERROR:this.isDisabled=!1,this.setMarusiaState("ready"),this.eventCallbacks.phrase_finish?.("");break;case l.TextSoFarStatus.GRACE_STOP:case l.TextSoFarStatus.PRE_RESULT:this.isDisabled=!0,this.staticStorage&&this.ttsPlayer?.playSound(this.staticStorage.sounds.sound_end),this.setMarusiaState("loading"),this.isRecording=!1;break;case l.TextSoFarStatus.NOTHING:this.isDisabled=!1,this.setMarusiaState("ready"),this.isRecording=!1,this.eventCallbacks.phrase_finish?.(""),this.ttsPlayer?.restoreMediaVolume();break;case l.TextSoFarStatus.INTERRUPT:this.isDisabled=!1,this.setMarusiaState("ready"),this.isRecording=!1,this.eventCallbacks.phrase_finish?.("");break;case l.TextSoFarStatus.SUCCESS:this.isDisabled=!1;break;case l.TextSoFarStatus.ERROR:this.isDisabled=!1,this.setMarusiaState("ready"),this.eventCallbacks.phrase_finish?.("")}}onAudioProcess(e){this.marusiaButton?.updateWave(e),this.eventCallbacks.wave_update?.(e)}onError(e){switch(this.log("onError",e,e.message),e.message){case o.MarusiaError.BACKEND_COMMAND_TIMEOUT:this.setMarusiaState("error");break;case o.MarusiaError.HIDDEN:this.setMarusiaState("ready");break;case o.MarusiaError.USER_INTERRUPT:this.ttsPlayer?.restoreMediaVolume(),this.setMarusiaState("ready");break;case o.MarusiaError.ATTACH_LOAD_TIMEOUT:break;default:this.log("unknown error",e,e.name,e.message)}this.eventCallbacks.error?.(e.message)}getMarusiaSessionId(){return(0,u.getSession)(this.api)}async loadStatic(){const e=await this.api.getWebStatic(),t=[...Object.entries(e.animations)],s=await Promise.all(t.map((e=>fetch(e[1]).then((e=>e.json()))))),i={sounds:e.sounds,images:e.images,animations:{}};return t.forEach(((t,a)=>{const n=t[0],o=s[a],r=e.images.marusia_bg.split("/");o.assets[0].u=r.slice(0,-1).join("/")+"/",o.assets[0].p=r[r.length-1],i.animations[n]=o})),i}async preload(){const e=await Promise.all([this.loadStatic(),this.getMarusiaSessionId()]);return this.eventCallbacks.session_create?.(),e}waitForBackendCommand(e){return new Promise(((t,s)=>{const i=e.phraseId+e.commandIds.flat().join("-"),a=setTimeout((()=>{this.backendCommandsQueue=this.backendCommandsQueue.filter((e=>e.id!==i)),s(o.MarusiaError.BACKEND_COMMAND_TIMEOUT)}),this.BACKEND_COMMAND_TIMEOUT);this.backendCommandsQueue.push({id:i,callback:()=>{clearTimeout(a);const s=this.backendCommandsQueue.find((e=>e.id===i));this.backendCommandsQueue=this.backendCommandsQueue.filter((e=>e.id!==i)),this.statCollector.logPerformance({key:"backend_command_processing_time",value:Date.now()-e.timeStart,entry_point:this.platform.entry}),t([...s?.events??[]])},events:[],signature:e})}))}processBackendCommands(e,t){return this.api.processBackendCommands(e,t),this.waitForBackendCommand({phraseId:e,commandIds:[...t],timeStart:Date.now()})}failIfHidden(){if(this.isHidden)throw new Error(o.MarusiaError.HIDDEN)}interruptProcessingCommands(){Object.keys(this.processingCommands).forEach((e=>{this.processingCommands[e]=!0}))}failIfInterrupted(e){if(this.processingCommands[e])throw new Error(o.MarusiaError.USER_INTERRUPT)}needNewChunk(e){return(0,_.isSuggestCommand)(e)||"playlist"===e.type||"media"===e.type}async processCommands(e,t,s){if(this.processingCommands[e]=!1,this.log(`[${e}] commands`,t),!this.api)return;let i=[],a=[];0===t.filter(_.isSuggestCommand).length&&this.clearSuggests();for(let s=0;s<t.length;s++){const n=t[s],o=s+1<t.length?t[s+1]:null,r=await this.api.isBackendCommand(n),l=!!o&&await this.api.isBackendCommand(o);if(this.failIfHidden(),this.needNewChunk(n)&&a.length&&(i.push(a),a=[]),r){if(a.push(s),o&&(l||this.needNewChunk(o)))continue;i.push(a),a=[]}else switch(this.log(`[${e}] exec`,n.type,n),n.type){case"tts":case"sound":await this.processTtsCommand(e,n);break;case"media":const i=[g.MarusiaMediaType.tale,g.MarusiaMediaType.music,g.MarusiaMediaType.books,g.MarusiaMediaType.radio];this.audioPlayer&&i.includes(n.media_type)&&await this.commands.processMedia(this.audioPlayer,s,t,e);break;case"playlist":this.audioPlayer&&this.commands.processPlaylist(this.audioPlayer,n,e);break;case"event_suggest":case"text_suggest":case"url_suggest":this.processSuggestCommands(t,s);break;case"portal_deeplink":this.commands.processPortalDeeplink(n);break;case"need_more_vk_permissions":this.commands.processNeedMoreVkPermissions(this.api,n,(()=>{if("text"in n.repeat_data)this.processTextPhrase(n.repeat_data.text);else{const e={};try{e.callback_data=JSON.parse(n.repeat_data.callback_data)}catch(e){this.log(e)}this.onMarusiaEvent(n.repeat_data.event,e)}})).catch((e=>{this.log("NeedMoreVkPermissions error",e)}));break;case"call_start":this.commands.processCallStart(n);break;case"send_event_data":"drop"===n.on_interrupt&&this.failIfInterrupted(e),this.processSendEventDataCommand(n);break;case"delay":await new Promise((e=>setTimeout(e,n.length)))}if(i.length){if(o&&(l||this.needNewChunk(o)))continue;const s=await this.processBackendCommands(e,i);this.log(`[${e}] GOT BACKEND CMD`,i,t.filter(((e,t)=>i.flat().includes(t)))),this.failIfHidden();const n=t.filter(((e,t)=>i.flat().includes(t))).filter((e=>"media"===e.type||"playlist"===e.type));this.audioPlayer&&await this.commands.autoPlayMediaAttaches(this.api,this.audioPlayer,n,s,e),i=[],a=[]}}s.forEach((e=>this.audioPlayer&&this.commands.executeControl(this.audioPlayer,e)))}isSuggestCommands(e){return e.every((e=>"event_suggest"===e.type||"text_suggest"===e.type||"url_suggest"===e.type))}async getSuggests(e){const t=await this.api.getSuggests(e);this.failIfHidden(),this.isSuggestCommands(t.items)&&(this.suggestManager?.update(t.items,this.suggestsFlat),this.eventCallbacks.suggest_update?.(t.items),t.items.length&&this.statCollector.logConversationView({suggest_item:{suggests:t.items.map((e=>({text:e.text})))},type:"suggests"}))}clearSuggests(){this.suggestManager?.clearSuggests(),this.eventCallbacks.suggest_update?.([]),this.suggestManager?.hide()}async onSuggestClick(e,t,s,i){if(s&&this.statCollector.logConversationClick({type:i??"hint",suggest_item:{action_index:s.findIndex((t=>t.text===e.text))+1,suggests:s.map((e=>({text:e.text})))}}),"url_suggest"===e.type)return void window.open((0,a.wrapAwayIfExternal)(e.url,!0),"_blank");this.clearSuggests(),this.stopListening();const n=(0,_.getSuggestContentForApi)(e),r={};try{r.callback_data=JSON.parse(e.callback_data)}catch(e){this.log(e)}const l={id:this.generateId(),cb:()=>{"event_suggest"===e.type?this.onMarusiaEvent(e.event,r):this.processTextPhrase(n,r)}};this.sendMessage((0,_.replaceSpecialPhrases)(n),o.CommunicationType.suggest,l,t)}processSuggestCommands(e,t){const s=e[t],i=e.filter(((e,s)=>s>t)).filter((e=>(0,_.isSuggestCommand)(e)));if(!(0,_.isSuggestCommand)(s))return;if(i.length)return;const a=e.filter(_.isSuggestCommand);this.suggestManager?.update(a,this.suggestsFlat),a.length&&this.statCollector.logConversationView({suggest_item:{suggests:a.map((e=>({text:e.text})))},type:"suggests"}),this.eventCallbacks.suggest_update?.(a)}async processTtsCommand(e,t){if(this.ttsPlayer)return this.ttsPlayer.play(e,t)}handleOutboundMessage(e){this.interruptProcessingCommands();const t=JSON.parse(e.kludges?.payload??"null");if(t)switch(t.communication_type){case o.CommunicationType.button:case o.CommunicationType.suggest:if(this.isQueued(t.voice_assistant.id)){if(e.local)return void this.setMarusiaState("loading");this.processCommandsFromQueue(t.voice_assistant.id)}break;case o.CommunicationType.text:e.local?(this.audioPlayer&&!this.audioPlayer.isPlaying()&&this.audioPlayer.preparePlay(),this.setMarusiaState("loading"),this.outboundMessageIds.push(e.randomId)):null!==e.randomId&&this.outboundMessageIds.includes(e.randomId)&&(this.outboundMessageIds=this.outboundMessageIds.filter((t=>t!==e.randomId)),this.processTextPhrase(e.text))}}handleInboundMessage(e){const t=JSON.parse(e.kludges?.payload??"null");if(!t||!t.voice_assistant)return;t.voice_assistant.commands?.length&&this.processPayloadCommands(t.voice_assistant.commands);const s=this.backendCommandsQueue.find((e=>e.signature.phraseId===t.voice_assistant?.phrase_id));if(!s)return;const i=s.signature.phraseId,a=s.signature.commandIds[0];(0,_.isPayloadForCommand)(t,{phraseId:i,commandIds:a})&&(s.signature.commandIds.shift(),s.events.push(e),0===s.signature.commandIds.length&&s.callback())}handleSendStartSession(e,t,s){(0,p.partConfigEnabled)("marusia_send_start_session")&&(e||t||s||this.api.sendStartSessionEvent())}hasDeeplinkParams(){const e=new URLSearchParams(window.location.search),t=e.get("text"),s=e.get("text_data"),i=e.get("event_name"),a=e.get("event_data");return!!(t||s||i||a)}handleDeeplink(){const e=new URLSearchParams(window.location.search),t=e.get("event_name"),s=e.get("event_data");if(t){const e=s?(0,_.parseBase64JSON)(s):null;this.onMarusiaEvent(t,{client_data:e})}}async onMarusiaEvent(e,t){const s=await this.api.phraseCreateEvent(e,t,this.audioPlayer?.getPlayerData());if(this.failIfHidden(),s)if("error"in s)this.onError(new Error(s.error));else try{await this.processCommands(s.result.phrase_id,s.result.phrase_result.commands,s.result.phrase_result.controls),this.setMarusiaState("ready")}catch(e){this.onError(e)}else this.setMarusiaState("error")}async processTextPhrase(e,t){let s;this.setMarusiaState("loading");try{s=await this.api.phraseCreateText(e,t,this.audioPlayer?.getPlayerData())}catch(e){s=null}this.failIfHidden(),s?this.processCommands(s.result.phrase_id,s.result.phrase_result.commands,s.result.phrase_result.controls).then((()=>{this.setMarusiaState("ready")})).catch((e=>{this.onError(e)})):this.setMarusiaState("error")}handleTextInput(e){const t=this.getTextFromInputEvent(e),s=n.browser.safari?"\n"!==t&&!!t:!!t;this.setMarusiaState(s?"typing":"ready")}textInputHaveText(){return!!this.textInput&&!!this.textInput.innerText}processSendEventDataCommand(e){const t={client_data:{}};try{t.client_data.send_event_data=JSON.parse(e.callback_data)}catch(e){}this.onMarusiaEvent(e.event,t)}processPayloadCommands(e){this.log("payload commands",e);for(let t=0;t<e.length;t++){const s=e[t];switch(s.type){case"vk_get_data_event":this.processSendEventDataCommand(s);break;case"event_suggest":case"text_suggest":case"url_suggest":this.processSuggestCommands(e,t)}}}async init(e){this.log("init",this,e,this.isInitialized),this.showCount+=1,this.suggestManager?.show();let t,s=e.draftText;"..."===s&&(this.clearTextInput(),s=""),this.show(!!s),this.initInterrupted=!1;try{t=await this.api.getLastMessageCommands()}catch(e){t=null}if(t&&t.length&&!e.needOnboarding&&this.processPayloadCommands(t),null!==t&&0!==t.length||e.needOnboarding||this.getSuggests(!!e.unreadMessages).catch((()=>{})),this.isInitialized||this.isLoading)return;this.handleSendStartSession(!!e.unreadMessages,e.needOnboarding,this.hasDeeplinkParams());const i=Date.now();this.setTextValue=e.setTextValue,this.onHelpClick=e=>{this.showSkillListModal(this.api,this.statCollector,((t,s)=>{this.onSuggestClick(t,e,s)}))},this.isLoading=!0,this.textInput=e.textInput??null,this.textInput&&(this.textInput.addEventListener("input",this.handleTextInput.bind(this)),this.isHidden||(0,_.disableMarusiaTextInput)(this.textInput)),e.iconContainer&&this.marusiaButton&&(this.marusiaButton.init({container:e.iconContainer}),this.isHidden||this.marusiaButton.show(),this.marusiaButton.showPreload());const[a,n]=await this.preload();this.initInterrupted?this.isLoading=!1:(this.sessionId=n.session_id,await(this.marusiaButton?.setAnimations(a.animations,a.images.marusia_bg)),this.staticStorage=a,this.ttsPlayer=new c.TtsPlayer({audioPlayer:this.audioPlayer,api:this.api}),this.ttsPlayer.init(),this.unsubscribeFromPlayerStore=d.playerStore.subscribe((e=>{e.isPlaying?(this.isSpeaking=!0,this.setMarusiaState("answering")):(this.isSpeaking=!1,this.setMarusiaState("ready"))})),this.marusiaButton?.hidePreload(),this.textInput&&!this.isHidden&&(0,_.enableMarusiaTextInput)(this.textInput),e.needOnboarding&&this.api?.getOnboarding().then((t=>{t.is_sent||this.getSuggests(!!e.unreadMessages).catch((()=>{}))})),this.isInitialized=!0,this.isLoading=!1,this.statCollector.logPerformance({key:"sdk_init_time",value:Date.now()-i,entry_point:this.platform.entry}),e.suggestContainer&&this.suggestManager&&(this.suggestManager.init({container:e.suggestContainer,onSuggestClick:this.onSuggestClick.bind(this),onSuggestListUpdate:this.eventCallbacks.suggest_update}),this.getSuggests(!!e.unreadMessages).catch((()=>{}))),this.setMarusiaState(this.textInputHaveText()?"typing":"ready"),this.handleDeeplink())}show(e){this.isHidden=!1,this.setMarusiaState(e?"typing":"ready"),this.marusiaButton?.show(),this.platform.show(),this.textInput&&(this.isLoading?(0,_.disableMarusiaTextInput)(this.textInput):(0,_.enableMarusiaTextInput)(this.textInput))}hide(){this.isHidden=!0,this.setMarusiaState("ready"),this.marusiaButton?.hide(),this.suggestManager?.hide(),this.platform.hide(),this.textInput&&(0,_.enableMarusiaTextInput)(this.textInput),this.clearQueue()}canSentMessage(){return"loading"!==this.marusiaState&&("listen"!==this.marusiaState&&("answering"!==this.marusiaState&&!this.isLoading))}onAddMessage(e){this.log(`onAddMessage skip: ${this.isHidden}`,e);try{if(this.isHidden)return;e.forEach((e=>{e.isOutbound?this.handleOutboundMessage(e):this.handleInboundMessage(e)}))}catch(e){console.error(e)}}log(...e){this.debug&&console.log(`[${this.platform.entry}]`,...e)}on(e,t){this.eventCallbacks[e]=t}setMarusiaState(e){this.log("setMarusiaState: ",e),this.marusiaState=e,this.marusiaButton?.setIconState(this.marusiaState),this.eventCallbacks.state_update?.(e)}interruptOtherEntries(){const e=f();Object.keys(e).forEach((t=>{t!==this.platform.entry&&e[t]()}))}interrupt(){this.isHidden||((this.textSoFar?.isRecording||this.textSoFar?.isCreatingPhrase)&&this.textSoFar.stop(!1,!0,!0),this.ttsPlayer?.stop(!1))}async onClick(e){this.interruptOtherEntries(),this.interruptProcessingCommands(),this.isInitialized&&!this.isDisabled&&"loading"!==this.marusiaState&&(this.isSpeaking?this.ttsPlayer?.stop():(this.ttsPlayer?.reduceMediaVolume(),this.ttsPlayer?.prepareSoundPlay(),this.ttsPlayer?.prepareTtsPlay(),this.audioPlayer&&!this.audioPlayer.isPlaying()&&this.audioPlayer.preparePlay(),this.textSoFar||(this.textSoFar=new r.TextSoFar(this.onPhraseUpdate.bind(this),this.onPhraseFinish.bind(this),this.onStatusUpdate.bind(this),this.onAudioProcess.bind(this),(()=>({isHidden:this.isHidden,currentShowCount:this.showCount})),this.api,this.audioPlayer??void 0),this.setMarusiaState("loading")),this.textSoFar.isRecording?(this.textSoFar.graceStop(),this.textSoFar.stop(!1,!0),this.ttsPlayer?.restoreMediaVolume()):(this.textSoFar.setInstanceId(e),await this.textSoFar.init())))}clearTextInput(){this.textInput&&this.setTextValue?.(this.textInput,"")}stopListening(){(this.textSoFar?.isRecording||this.textSoFar?.isCreatingPhrase)&&this.textSoFar.stop(!1,!0),this.ttsPlayer?.stop()}isReady(){return this.isInitialized&&!this.isLoading}dispose(){this.stopListening(),this.textSoFar=null,this.backendCommandsQueue=[],this.textInput&&(this.textInput.removeEventListener("input",this.handleTextInput.bind(this)),this.textInput=null),this.marusiaButton&&this.marusiaButton.dispose(),this.suggestManager?.unmount(),this.ttsPlayer?.stop(),this.ttsPlayer=null,this.unsubscribeFromPlayerStore(),this.hide(),this.isInitialized=!1,this.initInterrupted=!0}constructor(e){this.suggestsFlat=!1,this.debug=!1,this.statCollector=new h.MarusiaStatCollector,this.BACKEND_COMMAND_TIMEOUT=3e4,this.isInitialized=!1,this.suggestManager=null,this.isLoading=!1,this.isSpeaking=!1,this.isRecording=!1,this.isHidden=!0,this.isDisabled=!1,this.sessionId=null,this.staticStorage=null,this.marusiaState="ready",this.textInput=null,this.backendCommandsQueue=[],this.unsubscribeFromPlayerStore=()=>{},this.marusiaButton=null,this.ttsPlayer=null,this.textSoFar=null,this.onHelpClick=()=>{},this.outboundMessageIds=[],this.setTextValue=void 0,this.eventCallbacks={},this._messageId=0,this.processCommandsQueue=[],this.processingCommands={},this.showCount=0,this.initInterrupted=!1,this.platform=e.platform,this.api=e.api,this.showSkillListModal=e.showSkillListModal,this.audioPlayer=e.audioPlayer,this.commands=e.commands,this.getTextFromInputEvent=e.getTextFromInputEvent,this.suggestsFlat=!!e.suggestsFlat,this.debug=!!e.debug,e.suggestManager&&(this.suggestManager=e.suggestManager),e.marusiaButton&&(this.marusiaButton=e.marusiaButton),f()[this.platform.entry]=()=>this.interrupt()}}},188720:(e,t,s)=>{"use strict";s.d(t,{Wave:()=>n});var i=s(851240),a=s.n(i);class n{start(){this.wave.start()}stop(){this.wave.stop()}dispose(){this.wave.stop(),this.wave.dispose()}update(e){this.cache||(this.cache=new Uint8Array(e.frequencyBinCount)),e.getByteFrequencyData(this.cache);const t=n.getAverageVolume(this.cache),s=10*this.getAlignedVolume(t);this.wave.setAmplitude(s>this.maxVisibleAmp?this.maxVisibleAmp:s)}getAlignedVolume(e){const{min:t,max:s}=this.volumeRange;return((e=e<t?t:e>s?s:e)-t)/(s-t)}static getAverageVolume(e){return e.reduce(((e,t)=>e+t),0)/e.length}constructor(e,t,s){this.volumeRange=e,this.maxVisibleAmp=t,this.wave=new(a())(s)}}},281616:(e,t,s)=>{"use strict";var i;function a(e){return 6===e||5===e||3===e||4===e}function n(e){return 5===e||3===e}s.d(t,{isErrorOccurred:()=>n,isFinalStatus:()=>a}),function(e){e[e.OKAY_GO_ON=1]="OKAY_GO_ON",e[e.KEYWORD_CONFIRMED=2]="KEYWORD_CONFIRMED",e[e.KEYWORD_NOT_CONFIRMED=3]="KEYWORD_NOT_CONFIRMED",e[e.END_OF_PHRASE=4]="END_OF_PHRASE",e[e.ERROR_OCCURRED=5]="ERROR_OCCURRED",e[e.PHRASE_RECOGNIZED=6]="PHRASE_RECOGNIZED"}(i||(i={}))},550801:(e,t,s)=>{"use strict";s.d(t,{TextSoFar:()=>r});var i=s(610989),a=s(754683),n=s(281616),o=s(315258);class r{setInstanceId(e){this.instanceId=e}async init(){this.isCreatingPhrase=!0;const e=this.checkMarusiaVisibility().currentShowCount;this.currentShowCount=e,this.onStatusUpdate(a.TextSoFarStatus.INIT);try{const e={audio:{advanced:[{}]}};this.mediaStream=await navigator.mediaDevices.getUserMedia(e)}catch(e){this.onStatusUpdate(a.TextSoFarStatus.ERROR);let t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t=i.getLang("mail_audio_message_device_error");break;case"PermissionDeniedError":case"PermissionDismissedError":t=i.getLang("mail_audio_message_permission_error");break;case"Unsupported":t=i.getLang("mail_audio_message_unsupported_error")}throw this.onError(t),this.isCreatingPhrase=!1,e}this.onStatusUpdate(a.TextSoFarStatus.MEDIA_STREAM_ACQUIRED),this.recorder=new o.MarusiaMediaRecorder(this.mediaStream,this.onAudioProcess),this.abortController=new AbortController;try{const t=await this.api.createAsrPhrase(this.player?.getPlayerData(),this.abortController.signal);if(this.phraseId=t.result.phrase_id,this.shouldInterrupt(e))return this.stopRecorder(),void this.onStatusUpdate(a.TextSoFarStatus.API_ERROR)}catch(e){return this.stopRecorder(),void this.onStatusUpdate(a.TextSoFarStatus.API_ERROR)}finally{this.isCreatingPhrase=!1}this.onStatusUpdate(a.TextSoFarStatus.PHRASE_CREATED)}start(){this.attachDataAvailableHandler(),this.startRecorder()}shouldInterrupt(e){const t=this.checkMarusiaVisibility(),s=e??this.currentShowCount;return!(!t.isHidden&&s===t.currentShowCount)}startRecorder(){this.recorder.start(200),this.onStatusUpdate(a.TextSoFarStatus.RECORDING),this.isRecording=!0}stopRecorder(){this.recorder.stop(),this.recorder.stream.getTracks().forEach((e=>e.stop())),this.mediaStream=null,this.isRecording=!1,this.recorder.removeEventListener("dataavailable",this.dataAvailableCallback)}attachDataAvailableHandler(){let e=0;this.dataAvailableCallback=async t=>{this.enqueueChunk({chunkNumber:e++,eventData:t.data})},this.recorder.addEventListener("dataavailable",this.dataAvailableCallback)}enqueueChunk(e){this.chunks.push(e),this.gracefulStopRequested&&(this.recorder.removeEventListener("dataavailable",this.dataAvailableCallback),this.processChunks(!0)),!1===this.isChunksBeingProcessed&&this.processChunks()}async processChunks(e=!1){if(this.gracefulStopRequested&&!e)return;if("recording"===this.recorder.state&&0===this.chunks.length)return void(this.isChunksBeingProcessed=!1);if(0===this.chunks.length)return;this.isChunksBeingProcessed=!0;let t=this.chunks.shift();try{const s=await this.api.addChunk(this.phraseId,t.chunkNumber,e,t.eventData,this.abortController.signal);if(this.onPhraseUpdateHandler(s),(0,n.isFinalStatus)(s.status)||e)return void await this.stop((0,n.isErrorOccurred)(s.status));await this.processChunks()}catch(e){if("AbortError"===e.name)return;this.onStatusUpdate(a.TextSoFarStatus.API_ERROR),await this.stop(!0)}}graceStop(){this.gracefulStopRequested=!0,this.onStatusUpdate(a.TextSoFarStatus.GRACE_STOP)}async stop(e=!1,t=!1,s=!1){if(!1===this.gracefulStopRequested&&this.onStatusUpdate(a.TextSoFarStatus.PRE_RESULT),this.abortController.abort(),this.stopRecorder(),this.chunks=[],this.isChunksBeingProcessed=!1,this.gracefulStopRequested=!1,s)this.onStatusUpdate(a.TextSoFarStatus.INTERRUPT);else if(t)this.onStatusUpdate(a.TextSoFarStatus.NOTHING);else if(e)this.onStatusUpdate(a.TextSoFarStatus.ERROR);else try{const e=await this.api.getPhraseResult(this.phraseId);if(this.shouldInterrupt())return void this.onStatusUpdate(a.TextSoFarStatus.NOTHING);if(this.onPhraseFinishHandler(this.instanceId,this.phraseId,e),0===e.result.commands.length&&0===e.result.controls.length)return void this.onStatusUpdate(a.TextSoFarStatus.NOTHING);this.onStatusUpdate(a.TextSoFarStatus.SUCCESS)}catch(e){this.onStatusUpdate(a.TextSoFarStatus.API_ERROR)}}constructor(e,t,s,i,a,n,o){this.isRecording=!1,this.isCreatingPhrase=!1,this.chunks=[],this.abortController=new AbortController,this.isChunksBeingProcessed=!1,this.gracefulStopRequested=!1,this.onError=()=>{},this.currentShowCount=0,this.instanceId="",this.onPhraseUpdateHandler=e,this.onPhraseFinishHandler=t,this.onStatusUpdate=s,this.onAudioProcess=i,this.checkMarusiaVisibility=a,this.api=n,this.player=o}}},754683:(e,t,s)=>{"use strict";var i;s.d(t,{TextSoFarStatus:()=>i}),function(e){e[e.INIT=0]="INIT",e[e.MEDIA_STREAM_ACQUIRED=1]="MEDIA_STREAM_ACQUIRED",e[e.PHRASE_CREATED=2]="PHRASE_CREATED",e[e.RECORDING=3]="RECORDING",e[e.API_ERROR=4]="API_ERROR",e[e.GRACE_STOP=5]="GRACE_STOP",e[e.PRE_RESULT=6]="PRE_RESULT",e[e.NOTHING=7]="NOTHING",e[e.SUCCESS=8]="SUCCESS",e[e.ERROR=9]="ERROR",e[e.INTERRUPT=10]="INTERRUPT"}(i||(i={}))},308109:(e,t,s)=>{"use strict";var i;s.d(t,{ControlType:()=>i}),function(e){e.CONTROL_TYPE_RESUME="resume_control",e.CONTROL_TYPE_PAUSE="pause_control",e.CONTROL_TYPE_VOLUME="volume_control",e.CONTROL_TYPE_NEXT="next_control",e.CONTROL_TYPE_PREV="previous_control",e.CONTROL_TYPE_REPEAT="repeat_control",e.CONTROL_TYPE_REPEAT_PLAYLIST="repeat_playlist_control",e.CONTROL_TYPE_REWIND="rewind_control"}(i||(i={}))},909668:(e,t,s)=>{"use strict";s.d(t,{ATTACH_VIEW_EVENTS:()=>i,POSTING_STATS_NAME:()=>a});const i={grid:"grid_mode",carousel:"carousel_mode"},a="posting_web_stats"},955078:(e,t,s)=>{"use strict";s.d(t,{ErrorEvent:()=>a});var i=s(613699);class a{setMessage(e){this.message=e}setCode(e){this.code=e}getStatValue(){const{message:e,code:t}=this;return{message:e,code:t}}getStatEvent(){const e=this.getStatValue();return e?{type:i.POSTING_TIMELINE_EVENT_TYPES.ERROR,[i.POSTING_TIMELINE_EVENT_TYPES.ERROR]:e}:null}getValue(){const{message:e,code:t}=this;return{message:e,code:t}}}},834521:(e,t,s)=>{"use strict";s.d(t,{FileUploadingErrorEvent:()=>n});var i=s(614427),a=s(613699);class n{setFileType(e){this.fileType=e}setStartTime(e){this.timeRange.setStartTime(e)}setEndTime(e){this.timeRange.setEndTime(e)}setMessage(e){this.message=e}setCode(e){this.code=e}getStatValue(){const{fileType:e,timeRange:t,message:s,code:i}=this;if(e){const a=t.getStatValue();if(a)return{file_type:e,time_range:a,message:s,code:i}}return null}getStatEvent(){const e=this.getStatValue();return e?{type:a.POSTING_TIMELINE_EVENT_TYPES.FILE_UPLOADING_ERROR,[a.POSTING_TIMELINE_EVENT_TYPES.FILE_UPLOADING_ERROR]:e}:null}getValue(){const{fileType:e,timeRange:t,message:s,code:i}=this;return{fileType:e,timeRange:t,message:s,code:i}}constructor(){this.fileType=null,this.timeRange=new i.TimeRangeValue}}},67659:(e,t,s)=>{"use strict";s.d(t,{FileUploadingEvent:()=>n});var i=s(614427),a=s(613699);class n{setFileType(e){this.fileType=e}setStartTime(e){this.timeRange.setStartTime(e)}setEndTime(e){this.timeRange.setEndTime(e)}getStatValue(){const{fileType:e,timeRange:t}=this;if(e){const s=t.getStatValue();if(s)return{file_type:e,time_range:s}}return null}getStatEvent(){const e=this.getStatValue();return e?{type:a.POSTING_TIMELINE_EVENT_TYPES.FILE_UPLOADING,[a.POSTING_TIMELINE_EVENT_TYPES.FILE_UPLOADING]:e}:null}getValue(){const{fileType:e,timeRange:t}=this;return{fileType:e,timeRange:t}}constructor(){this.fileType=null,this.timeRange=new i.TimeRangeValue}}},721474:(e,t,s)=>{"use strict";s.d(t,{PickerAttachmentAttachingEvent:()=>n});var i=s(613699),a=s(614427);class n{setAttachmentType(e){this.attachmentType=e}setStartTime(e){this.timeRange.setStartTime(e)}setEndTime(e){this.timeRange.setEndTime(e)}getStatValue(){const{attachmentType:e,timeRange:t}=this;if(e){const s=t.getStatValue();if(s)return{time_range:s,attachment_type:e}}return null}getStatEvent(){const e=this.getStatValue();return e?{type:i.POSTING_TIMELINE_EVENT_TYPES.PICKER_ATTACHMENT_ATTACHING,[i.POSTING_TIMELINE_EVENT_TYPES.PICKER_ATTACHMENT_ATTACHING]:e}:null}getValue(){const{attachmentType:e,timeRange:t}=this;return{attachmentType:e,timeRange:t}}constructor(){this.attachmentType=null,this.timeRange=new a.TimeRangeValue}}},871546:(e,t,s)=>{"use strict";s.d(t,{PickerOpeningEvent:()=>n});var i=s(614427),a=s(613699);class n{setAttachmentType(e){this.attachmentType=e}setStartTime(e){this.timeRange.setStartTime(e)}setEndTime(e){this.timeRange.setEndTime(e)}getStatValue(){const{attachmentType:e,timeRange:t}=this;if(e){const s=t.getStatValue();if(s)return{time_range:s,attachment_type:e}}return null}getStatEvent(){const e=this.getStatValue();return e?{type:a.POSTING_TIMELINE_EVENT_TYPES.PICKER_OPENING,[a.POSTING_TIMELINE_EVENT_TYPES.PICKER_OPENING]:e}:null}getValue(){const{attachmentType:e,timeRange:t}=this;return{attachmentType:e,timeRange:t}}constructor(){this.attachmentType=null,this.timeRange=new i.TimeRangeValue}}},931073:(e,t,s)=>{"use strict";s.d(t,{PostPublishingErrorEvent:()=>n});var i=s(613699),a=s(614427);class n{setStartTime(e){this.timeRange.setStartTime(e)}setEndTime(e){this.timeRange.setEndTime(e)}setMessage(e){this.message=e}setCode(e){this.code=e}getStatValue(){const{timeRange:e,message:t,code:s}=this,i=e.getStatValue();return i?{time_range:i,message:t,code:s}:null}getStatEvent(){const e=this.getStatValue();return e?{type:i.POSTING_TIMELINE_EVENT_TYPES.POST_PUBLISHING_ERROR,[i.POSTING_TIMELINE_EVENT_TYPES.POST_PUBLISHING_ERROR]:e}:null}getValue(){const{timeRange:e,message:t,code:s}=this;return{timeRange:e,message:t,code:s}}constructor(){this.timeRange=new a.TimeRangeValue}}},42549:(e,t,s)=>{"use strict";s.d(t,{PostPublishingTimeRangeEvent:()=>n});var i=s(613699),a=s(614427);class n{setStartTime(e){this.value.setStartTime(e)}setEndTime(e){this.value.setEndTime(e)}getStatEvent(){const e=this.value.getStatValue();return e?{type:i.POSTING_TIMELINE_EVENT_TYPES.POST_PUBLISHING_TIME_RANGE,[i.POSTING_TIMELINE_EVENT_TYPES.POST_PUBLISHING_TIME_RANGE]:e}:null}getValue(){return this.value.getValue()}constructor(){this.value=new a.TimeRangeValue}}},614427:(e,t,s)=>{"use strict";s.d(t,{TimeRangeValue:()=>i});class i{setStartTime(e){null!==this.endTime&&e>this.endTime&&(this.endTime=null),this.startTime=e}setEndTime(e){null!==this.startTime&&this.startTime<=e&&(this.endTime=e)}getStatValue(){return null!==this.startTime&&null!==this.endTime&&this.startTime<=this.endTime?{start_time:this.startTime,end_time:this.endTime}:null}getValue(){const{startTime:e,endTime:t}=this;return{startTime:e,endTime:t}}constructor(){this.startTime=null,this.endTime=null}}},851598:(e,t,s)=>{"use strict";s.d(t,{ErrorEvent:()=>i.ErrorEvent,FileUploadingErrorEvent:()=>a.FileUploadingErrorEvent,PickerAttachmentAttachingEvent:()=>n.PickerAttachmentAttachingEvent,PostPublishingErrorEvent:()=>o.PostPublishingErrorEvent});var i=s(955078),a=s(834521),n=(s(67659),s(721474)),o=(s(871546),s(931073));s(42549)},36498:(e,t,s)=>{"use strict";s.d(t,{POSTING_FILE_TYPES:()=>a.POSTING_FILE_TYPES,POSTING_PICKER_TYPES:()=>a.POSTING_PICKER_TYPES,POSTING_TIMELINE_CREATION_ENTRY_POINTS:()=>a.POSTING_TIMELINE_CREATION_ENTRY_POINTS,POSTING_TIMELINE_POST_TYPES:()=>a.POSTING_TIMELINE_POST_TYPES,postingTimelineLogger:()=>n});var i=s(563786),a=s(613699);const n=new i.PostingTimelineLogger},563786:(e,t,s)=>{"use strict";s.d(t,{PostingTimelineLogger:()=>u});var i=s(869723),a=s(613699),n=s(871546),o=s(67659),r=s(42549),l=s(851598),c=s(155719),d=s(645084);class u{logStartTimeline(e){if(!(0,d.isPostingPerfStatsEnabled)())return;const{isEditing:t,postType:s,creationEntryPoint:i,trackCode:n}=e;this.screenStartTime=(0,c.getCurrentTimeValue)(),this.context={is_editing:t??!1,post_type:s,creation_entry_point:i??a.POSTING_TIMELINE_CREATION_ENTRY_POINTS.OTHER,track_code:n}}logScreenInitialization(){this.screenInitializedTime=(0,c.getCurrentTimeValue)()}logScreenInteractionReady(){this.screenInteractionTime=(0,c.getCurrentTimeValue)()}logScreenClose(){this.finishTimeline(),this.sendCurrentEvent()}logStartSending(){this.currentEvents.postPublishingTimeRange||(this.currentEvents.postPublishingTimeRange=new r.PostPublishingTimeRangeEvent),this.currentEvents.postPublishingTimeRange.setStartTime((0,c.getCurrentTimeMs)())}logSuccessfullySend(){this.currentEvents.postPublishingTimeRange&&(this.currentEvents.postPublishingTimeRange.setEndTime((0,c.getCurrentTimeMs)()),this.finishTimeline(),this.sendCurrentEvent())}logPostPublishingError({code:e,message:t}){const{postPublishingTimeRange:s}=this.currentEvents;if(!s)return;const i=s.getValue()?.startTime;if(!i)return;const a=new l.PostPublishingErrorEvent;a.setStartTime(i),a.setEndTime((0,c.getCurrentTimeMs)()),e&&a.setCode(e),t&&a.setMessage(t),this.events.push(a),delete this.currentEvents.postPublishingTimeRange}finishTimeline(){this.screenCloseTime=(0,c.getCurrentTimeValue)()}logPickerOpening({pickerType:e}){const t=new n.PickerOpeningEvent;t.setStartTime((0,c.getCurrentTimeMs)()),t.setAttachmentType(e),this.currentEvents.pickerOpening=t}logPickerReady(){const{pickerOpening:e}=this.currentEvents;e&&(e.setEndTime((0,c.getCurrentTimeMs)()),this.events.push(e),delete this.currentEvents.pickerOpening)}logStartFileUploading({fileType:e,rawId:t}){this.uploadingFiles[t]||(this.uploadingFiles[t]={startTime:(0,c.getCurrentTimeMs)(),fileType:e})}logFileLoaded({rawId:e}){if(!this.uploadingFiles[e])return;const{startTime:t,fileType:s}=this.uploadingFiles[e],i=new o.FileUploadingEvent;i.setStartTime(t),i.setEndTime((0,c.getCurrentTimeMs)()),i.setFileType(s),delete this.uploadingFiles[e],this.events.push(i)}logFileLoadingError({code:e,message:t,rawId:s}){const i=this.uploadingFiles[s];if(!i)return;const a=i.fileType,n=i.startTime;if(!n||!a)return;const o=new l.FileUploadingErrorEvent;o.setStartTime(n),o.setEndTime((0,c.getCurrentTimeMs)()),o.setFileType(a),e&&o.setCode(e),t&&o.setMessage(t),this.events.push(o),delete this.uploadingFiles[s]}logStartAttaching({pickerType:e}){const t=new l.PickerAttachmentAttachingEvent;t.setStartTime((0,c.getCurrentTimeMs)()),t.setAttachmentType(e),this.currentEvents.pickerAttachmentAttaching=t}logFinishAttaching(){const{pickerAttachmentAttaching:e}=this.currentEvents;e&&(e.setEndTime((0,c.getCurrentTimeMs)()),this.events.push(e),delete this.currentEvents.pickerAttachmentAttaching)}logError({code:e,message:t}){const s=new l.ErrorEvent;e&&s.setCode(e),t&&s.setMessage(t.slice(0,128)),this.events.push(s)}changePostType(e){this.context&&(this.context.post_type=e)}sendCurrentEvent(){const e=this.createStatEventItem();e&&this.postingTimelineCollector.logEvent(e),this.resetEventItem()}createStatEventItem(){const{screenStartTime:e,screenInitializedTime:t,screenInteractionTime:s,screenCloseTime:i,context:a,events:n}=this;if(e&&s&&t&&i&&a){const o=[];n.forEach((e=>{const t=e.getStatEvent();t&&(o.length<50||e instanceof r.PostPublishingTimeRangeEvent)&&o.push(t)}));return{screen_start_time:e,screen_initialized_time:t,screen_interaction_time:s,screen_close_time:i,context:a,events:o}}return null}resetEventItem(){this.screenStartTime=null,this.screenCloseTime=null,this.screenInitializedTime=null,this.screenInteractionTime=null,this.context=null,this.events=[],this.currentEvents={}}constructor(){this.screenStartTime=null,this.screenInteractionTime=null,this.screenInitializedTime=null,this.screenCloseTime=null,this.context=null,this.events=[],this.currentEvents={},this.uploadingFiles={},this.postingTimelineCollector=new i.PostingTimelineCollector}}},613699:(e,t,s)=>{"use strict";s.d(t,{POSTING_FILE_TYPES:()=>r,POSTING_PICKER_TYPES:()=>o,POSTING_TIMELINE_CREATION_ENTRY_POINTS:()=>a,POSTING_TIMELINE_EVENT_TYPES:()=>n,POSTING_TIMELINE_POST_TYPES:()=>i});const i={REGULAR:"regular",POSTPONED:"postponed",SUGGESTED:"suggested",POST_TEXT_LIVE:"post_text_live",POST_DONUT:"post_donut",EDIT:"edit",COMMENT:"comment",COMMENT_BOARD:"comment_board",COMMENT_MARKET:"comment_market"},a={PROFILE_INPUT:"profile_input",FEED_INPUT:"feed_input",COMMUNITY_INPUT:"community_input",OTHER:"other"},n={FILE_UPLOADING:"file_uploading",FILE_UPLOADING_ERROR:"file_uploading_error",PICKER_OPENING:"picker_opening",PICKER_ATTACHMENT_ATTACHING:"picker_attachment_attaching",POST_PUBLISHING_TIME_RANGE:"post_publishing_time_range",POST_PUBLISHING_ERROR:"post_publishing_error",ERROR:"error"},o={ALBUM:"album",ARTICLE:"article",DOCUMENT:"document",MARKET:"market",MUSIC:"music",PLACE:"place",PHOTO:"photo",PHOTO_VK:"photo_vk",POLL:"poll",SERVICE:"service",TAKE_PHOTO:"take_photo",VIDEO:"video",VIDEO_VK:"video_vk"},r={PHOTO:"photo",VIDEO:"video",DOCUMENT:"document"}},155719:(e,t,s)=>{"use strict";s.d(t,{getCurrentTimeMs:()=>i,getCurrentTimeValue:()=>a});const i=()=>Number(new Date),a=()=>({time:i()})},645084:(e,t,s)=>{"use strict";s.d(t,{isPostingPerfStatsEnabled:()=>l,isPostingStatsEnabled:()=>o,sendPostingEvent:()=>r});var i=s(490712),a=s(909668),n=s(476726);const o=()=>(0,n.partConfigEnabled)("posting_web_input_stats"),r=e=>{o()&&(0,i.statlogsValueEvent)(a.POSTING_STATS_NAME,"",e)},l=()=>(0,n.partConfigEnabled)("posting_web_perf_stats")},815169:(e,t,s)=>{"use strict";s.d(t,{MarusiaPerformanceActionStatCollector:()=>a});var i=s(581903);class a{logEvent(e){const t={type:"type_marusia_performance_item",type_marusia_performance_item:e};this.actionStatCollector.logEvent(t)}constructor(){this.productStatCollector=new i.ProductionStatCollector,this.actionStatCollector=new i.ActionStatCollector(this.productStatCollector)}}},428379:(e,t,s)=>{"use strict";s.d(t,{settingsChangesStatCollector:()=>a});var i=s(581903);const a=new class{logEvent(e){const t={type:"type_settings_changes_item",type_settings_changes_item:e};this.actionStatCollector.logEvent(t)}constructor(){this.productStatCollector=new i.ProductionStatCollector,this.actionStatCollector=new i.ActionStatCollector(this.productStatCollector)}}},974930:(e,t,s)=>{"use strict";s.d(t,{MarusiaConversationClickStatsCollector:()=>n});var i=s(581903),a=s(695290);class n{logEvent(e){const t={type:a.ClickProductionStatEventTypes.TYPE_MARUSIA_CONVERSATION_ITEM,[a.ClickProductionStatEventTypes.TYPE_MARUSIA_CONVERSATION_ITEM]:e},s={type:a.EventItemType.CLICK_ITEM};this.clickStatCollector.logEvent(t,s)}constructor(){this.productStatCollector=new i.ProductionStatCollector,this.clickStatCollector=new i.ClickStatCollector(this.productStatCollector)}}},869723:(e,t,s)=>{"use strict";s.d(t,{PostingTimelineCollector:()=>n});var i=s(695290),a=s(581903);class n{logEvent(e){const t={...this.productionStatCollector.getBaseEvent(),type:i.ActionProductionStatEventTypes.TYPE_POSTING_TIMELINE,[i.ActionProductionStatEventTypes.TYPE_POSTING_TIMELINE]:e};this.productionStatCollector.logEvent(t)}constructor(){this.productionStatCollector=new a.ProductionStatCollector}}},667749:(e,t,s)=>{"use strict";s.d(t,{MarusiaConversationViewStatsCollector:()=>n});var i=s(581903),a=s(695290);class n{logEvent(e){const t={end_view:"0",start_view:"0",type:a.ViewProductionStatEventTypes.TYPE_MARUSIA_CONVERSATION_ITEM,[a.ViewProductionStatEventTypes.TYPE_MARUSIA_CONVERSATION_ITEM]:e},s={type:a.EventItemType.EVENT};this.viewStatCollector.logEvent(t,s)}constructor(){this.productStatCollector=new i.ProductionStatCollector,this.viewStatCollector=new i.ViewStatCollector(this.productStatCollector)}}},745910:(e,t,s)=>{"use strict";s.d(t,{popupDestroyByRemoveEventNative:()=>n});var i=s(792045),a=s(805088);const n=()=>{(0,a.isPopUpStickersEnabled)()&&(0,i.destroyByRemoveEventNative)()}},769876:(e,t,s)=>{"use strict";s.d(t,{CLIP_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>c,SHORT_VIDEO_UPLOAD_EXTS:()=>a,SHORT_VIDEO_UPLOAD_INPUT_ACCEPT:()=>o,VIDEO_DEFAULT_THUMB_ID:()=>p,VIDEO_UPLOAD_CHUNK_MAX_RETRY_NUMBER:()=>_,VIDEO_UPLOAD_CHUNK_SIZE:()=>d,VIDEO_UPLOAD_EXTS:()=>n,VIDEO_UPLOAD_FILE_THREAD_NUMBER:()=>u,VIDEO_UPLOAD_INPUT_ACCEPT:()=>r,VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>l,VIDEO_UPLOAD_SUBTITLES_DISABLED:()=>g,VIDEO_UPLOAD_SUBTITLES_USER_LANG:()=>m});const i=e=>["video/*",...e.map((e=>`.${e}`))].join(","),a="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),n=[...a,"torrent"],o=i(a),r=i(n),l=5,c=8,d=4194304,u=4,_=10,g=-1,m=-2,p="0_0"},423212:(e,t,s)=>{"use strict";s.d(t,{checkFileType:()=>d,getUploadErrorInfo:()=>_,getUploadErrorText:()=>u,getVideoMetadata:()=>l,getVideoSize:()=>c,sendVideoMetadataStatsBeforeUpload:()=>g});var i,a=s(610989),n=s(769876),o=s(581903),r=s(695290);function l(e){return new Promise((t=>{try{const s=document.createElement("video");s.preload="metadata",s.onloadedmetadata=()=>{const e=s.duration||0,i=s.videoWidth,a=s.videoHeight;t({duration:e,width:i,height:a})},s.onerror=()=>t(null),s.src=window.URL.createObjectURL(e)}catch(e){t(null)}}))}function c(e){return e.size}function d(e,t){const s=(e.name.split(".").pop()||"").toLowerCase(),i=(t||n.VIDEO_UPLOAD_EXTS).includes(s);return!!(e.type&&e.type.match(/^video/i)||i)}function u(e,t){switch(e){case 100:return a.getLang("video_upload_encode_error_too_short_1s");case 101:return a.getLang("video_upload_encode_error_too_long");case 20:return a.getLang("video_upload_error_uploading");case-1:return a.getLang("video_upload_error_incorrect_publish_date");case-2:return a.getLang("video_upload_error_limit_postpone_posts");case-3:return a.getLang("video_upload_error_day_limit_postpone_posts");case-4:return a.getLang("video_upload_error_same_publish_date");case-5:return a.getLang("video_upload_error_day_limit_posts");default:return t||a.getLang("global_unknown_error")}}function _(e){switch(e){case-2:return a.getLang("video_upload_error_info_limit_postpone_posts");case-3:return a.getLang("video_upload_error_info_day_limit_postpone_posts");case-4:return a.getLang("video_upload_error_info_same_publish_date")}}!function(e){e[e.SHORT_VIDEO_TOO_SHORT=100]="SHORT_VIDEO_TOO_SHORT",e[e.SHORT_VIDEO_TOO_LONG=101]="SHORT_VIDEO_TOO_LONG",e[e.INCORRECT_PUBLISH_DATE=-1]="INCORRECT_PUBLISH_DATE",e[e.LIMIT_POSTPONE_POSTS=-2]="LIMIT_POSTPONE_POSTS",e[e.LIMIT_POSTPONE_POSTS_PER_DAY=-3]="LIMIT_POSTPONE_POSTS_PER_DAY",e[e.SAME_POSTPONE_POST_DATE=-4]="SAME_POSTPONE_POST_DATE",e[e.LIMIT_POSTS_PER_DAY=-5]="LIMIT_POSTS_PER_DAY",e[e.SHORT_VIDEO_CONVERT=20]="SHORT_VIDEO_CONVERT"}(i||(i={}));const g=async(e,t,s)=>{const i=await l(e);i?.duration&&i?.width&&o.videoUploadStatsCollector.logEvent({event_type:r.VideoUploadActionEventTypes.DECODE_VIDEO_METAINFO,video_owner_id:t,video_id:s,decode_metainfo:JSON.stringify({width:i.width,height:i.height,video_duration:i.duration,format:(e.name.split(".").pop()||"").toLowerCase()})})}},320637:(e,t,s)=>{"use strict";s.d(t,{showSkillListModal:()=>g});var i=s(474848),a=s(296540),n=s(209642),o=s(125852),r=s(439220),l=s(785118),c=s(610989),d=s(193984),u=s(272259);const _=({api:e,statCollector:t,onSkillClick:s,onClose:u,refreshCoordinates:_})=>{const{categories:g,error:m,reloadCategories:p,handleError:h,selectedCategory:f,setSelectedCategory:v}=(0,d.useCategories)(e);(0,a.useEffect)((()=>{_()}),[]);const b=(0,a.useCallback)((e=>{t.logConversationView({type:"hint",suggest_item:{suggests:e.map((e=>({text:e.title})))}})}),[t]);return(0,i.jsxs)(n.ModalBox,{"data-testid":"marusia-skill-modal",children:[(0,i.jsx)(o.ModalHeader,{onClose:u,closeAriaLabel:c.getLang("global_close"),backLabel:f&&c.getLang("global_back"),onBack:()=>{v(null)},children:f?.title??c.getLang("mail_marusia_bottom_sheet_skills_title")}),(0,i.jsx)(r.ModalScrollView,{height:m?void 0:525,children:(0,i.jsx)(l.Div,{mode:"horizontal",spacing:8,children:(0,i.jsx)(d.CategoriesModalBody,{api:e,categories:g,selectedCategory:f?.name,onItemClick:(e,t)=>{s((0,d.itemToSuggest)(e),t.map(d.itemToSuggest)),u()},onItemView:b,onShowMoreClick:(e,t)=>{v({name:e,title:t})},error:m,onError:h,reloadCategories:p})})})]})};function g(e,t,s){(0,u.showMessageBoxModal)((a=>(0,i.jsx)(_,{...a,api:e,statCollector:t,onSkillClick:s})),{width:420})}},319392:(e,t,s)=>{"use strict";s.d(t,{MarusiaVkcomAdapter:()=>o});var i=s(78863);const a="_im_page_history",n="im-page--marusia";class o{set onHelpClick(e){this._onHelpClick=e}show(){document.querySelector("."+a)?.classList.add(n),document.querySelector("."+i.MARUSIA_HELP_BUTTON_CLASS)?.addEventListener("click",this._onHelpClick)}hide(){document.querySelector("."+a)?.classList.remove(n),document.querySelector("."+i.MARUSIA_HELP_BUTTON_CLASS)?.removeEventListener("click",this._onHelpClick)}constructor(){this._onHelpClick=()=>{},this.entry="vkcom"}}},894921:(e,t,s)=>{"use strict";s.d(t,{MarusiaWebApi:()=>r});var i=s(777892),a=s(527966),n=s(223597);const o=new a.FetchService;class r extends i.MarusiaSharedApi{reloadAudios(e){return o.reloadAudios(e)}generateDeviceId(){return(0,n.generateDeviceId)("vk_web",this.debug)}}},753103:(e,t,s)=>{"use strict";s.d(t,{MarusiaWebCommands:()=>r});var i=s(937793),a=s(489404),n=s(735745),o=s(310996);class r{processMedia(e,t,s,a){return(0,i.processCommandMedia)(e,t,s,a)}processPlaylist(e,t,s){(0,i.processCommandPlaylist)(e,t,s)}processPortalDeeplink(e){window.open(e.url,"_self")}processNeedMoreVkPermissions(e,t,s){return(0,a.processCommandNeedMoreVkPermissions)(e,t,s)}processCallStart(e){(0,n.processCommandCallStart)(e)}autoPlayMediaAttaches(e,t,s,a,n){return(0,i.autoPlayMediaAttaches)(e,t,s,a,n)}executeControl(e,t){(0,o.executeControl)(e,t)}}},735745:(e,t,s)=>{"use strict";s.d(t,{processCommandCallStart:()=>a});var i=s(965776);function a(e){window.Calls&&window.Calls.call&&!window.Calls.isInActiveCall&&window.Calls.call({vkId:parseInt(String(e.recipient_id)),entryPoint:i.CallStatSource.CONVO_HEADER})}},937793:(e,t,s)=>{"use strict";s.d(t,{autoPlayMediaAttaches:()=>c,playAudioList:()=>l,processCommandMedia:()=>_,processCommandPlaylist:()=>g});var i=s(620626),a=s(134015),n=s(255944),o=s(634180),r=s(2874);function l(e,t,s,n){e.getCurrentPlaylist()&&e.deleteCurrentPlaylist();const o=new i.AudioPlaylist({accessHash:void 0,albumId:`im${a.MARUSIA_PEER_ID}_${s}`,blockId:"",hasMore:!1,ownerId:window.vk.id,type:n??i.AudioPlaylist.TYPE_TEMP});o.mergeWith({list:t}),e.addPlaylist(o),e.play((0,r.getFullIdFromTuple)(t[0]),o,"im")}async function c(e,t,s,i,a){if(!s.length)return;if(s.every(u)){return void l(t,s.map((e=>(0,r.constructPlayerAudio)(e.meta,n.MarusiaMediaType.books,{}))),a)}const c=(0,r.getCommandsToAutoplay)(s,i),d=c.every((e=>e.media_type===n.MarusiaMediaType.podcast));if(0===c.length)return;const _=i.filter((e=>e.attaches.some(r.isAudioAttach))).map((e=>document.querySelector(`._im_mess[data-msgid="${e.messageId}"]`))).filter(Boolean);var g;if(_&&await(g=_,new Promise(((e,t)=>{let s=!1;const i=setTimeout((()=>{s=!0,t(new Error(o.MarusiaError.ATTACH_LOAD_TIMEOUT))}),3e4),a=()=>{g.every((e=>!!e.querySelector("._audio_row")||!!e.querySelector(".im_msg_media_podcast")))?(clearTimeout(i),e()):s||setTimeout(a,100)};a()}))),d)return void _[0]?.querySelector(".podcast_snippet__play")?.click();const m=c.map((e=>(0,r.constructPlayerAudio)(e.meta,n.MarusiaMediaType.music,(0,r.getVoiceAssistantData)(e,i)))),p=await(0,r.getHashesForAudios)(e,m);p&&l(t,p,a)}function d(e){return"media"===e.type&&e.media_type===n.MarusiaMediaType.radio}function u(e){return"media"===e.type&&e.media_type===n.MarusiaMediaType.books}async function _(e,t,s,a){const o=s.find(d);if(o)return void function(e,t,s){l(e,[(0,r.constructPlayerAudio)(t.meta,n.MarusiaMediaType.radio,{source:t.meta.source})],s,i.AudioPlaylist.TYPE_RADIO)}(e,o,a);const c=await(0,r.getAudioList)(t,s);c&&l(e,c,a)}function g(e,t,s){l(e,t.tracks.map(((e,t)=>({...e,meta:{...e.meta,id:e.meta.id??t}}))).map((e=>(0,r.constructPlayerAudio)(e.meta,t.media_type))),s)}},310996:(e,t,s)=>{"use strict";s.d(t,{executeControl:()=>n});var i=s(116990),a=s(308109);function n(e,t){const s=document.querySelector("._audio_page_layout")?.firstChild,n=s?(0,i.currentAudioPage)(s):null;switch(t.type){case a.ControlType.CONTROL_TYPE_RESUME:e.play();break;case a.ControlType.CONTROL_TYPE_PAUSE:e.pause();break;case a.ControlType.CONTROL_TYPE_VOLUME:e.setVolume(t.level/100);break;case a.ControlType.CONTROL_TYPE_NEXT:e.playNext(!0);break;case a.ControlType.CONTROL_TYPE_PREV:e.seekToTime(0),setTimeout((()=>e.playPrev()));break;case a.ControlType.CONTROL_TYPE_REPEAT:e.toggleRepeatCurrentAudio(),n?.updateRepeatButton();break;case a.ControlType.CONTROL_TYPE_REPEAT_PLAYLIST:e.toggleRepeatAll(),n?.updateRepeatButton();break;case a.ControlType.CONTROL_TYPE_REWIND:e.seekToTime(t.elapsed)}}},729945:(e,t,s)=>{"use strict";s.r(t),s.d(t,{marusiaSdk:()=>m});var i=s(639999),a=s(753103),n=s(610052),o=s(320637),r=s(894921),l=s(327527),c=s(319392),d=s(243443),u=s(615637);const _=new c.MarusiaVkcomAdapter,g="vkcom-marusia",m=new i.MarusiaSharedSdk({platform:_,api:new r.MarusiaWebApi(window.__dev),showSkillListModal:o.showSkillListModal,audioPlayer:new n.MarusiaWebPlayerAdapter((0,l.getAudioPlayer)()),commands:new a.MarusiaWebCommands,getTextFromInputEvent:e=>e.target.innerText,debug:window.__dev,suggestManager:new d.SuggestManager(g),marusiaButton:new u.MarusiaButton});_.onHelpClick=()=>{m.onHelpClick(g)}},598824:(e,t,s)=>{"use strict";s.d(t,{loadMarusiaFCSdk:()=>o,loadMarusiaSdk:()=>n});var i=s(8520),a=s(143172);function n(){return(0,i.asyncImportLoader)((()=>Promise.resolve().then(s.bind(s,729945))),3).then((e=>{if(!e.marusiaSdk)throw new Error("MarusiaSdkEmptyError");return e.marusiaSdk})).catch((e=>(a.marusiaStats.logModuleLoadError(e.message),null)))}function o(){return(0,i.asyncImportLoader)((()=>s.e(42734).then(s.bind(s,555368))),3).then((e=>{if(!e.marusiaSdk)throw new Error("MarusiaFCSdkEmptyError");return e.marusiaSdk})).catch((e=>(a.marusiaStats.logModuleLoadError(e.message),null)))}},521337:(e,t,s)=>{"use strict";s.d(t,{BotButton:()=>u});var i=s(474848),a=s(296540),n=s(533048),o=s(8520),r=s(408063),l=s(628180),c=s(531868),d=s(349333);function u({button:e,keyboardAuthorId:t,sendMessage:s,store:u}){const[_,g]=(0,a.useState)(!1),m=(0,a.useMemo)((()=>(0,l.getButtonLabel)(e)),[e]),{mode:p,appearance:h}=(0,a.useMemo)((()=>{let t="primary",s="accent";switch((0,l.getButtonAppearance)(e)){case"primary":break;case"secondary":t="secondary";break;case"positive":s="positive";break;case"negative":s="negative"}return{mode:t,appearance:s}}),[e]);const f=(0,a.useMemo)((()=>e.action.type===l.BUTTON_TYPE_OPEN_LINK||e.action.type===l.BUTTON_TYPE_OPEN_MODAL_VIEW?{href:(0,r.wrapAwayIfExternal)(e.action.link,!0),target:"_blank",rel:"nofollow noopener"}:null),[e]);return(0,i.jsx)(n.Button,{className:(0,o.classNames)("BotButton",`BotButton--${e.action.type.replace("_","-")}`),onClick:function(){if(_)return;const i=(0,c.getCurrentTab)(u);return i?(0,l.handleButtonClick)(e.action,s,u,{keyboardAuthorId:t,peerId:i.peerId,onBeforeSend(){g(!0)},onSendSuccess(e){const t=()=>{g(!1)},s={timeout:window.setTimeout(t,l.CALLBACK_TIMEOUT_MS),onCallback:t};u.set((t=>(0,d.setPressedCallbackButton)({peerId:i.peerId,eventId:e},s,t))),g(!0)},onSendFail(){g(!1)}}):void 0},mode:p,appearance:h,loading:_,stretched:!0,...f,children:(0,i.jsx)("span",{className:"BotButton__labelWrap",children:(0,i.jsx)("span",{className:"BotButton__label",dangerouslySetInnerHTML:{__html:m}})})})}},614469:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var i=s(474848),a=s(296540),n=s(695676),o=s(428280),r=s(8520),l=s(693143),c=s(521337);class d extends a.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){const{store:e,send:t}=this.props,s=(0,l.getCurrentKeyboard)(e);return s&&s.buttons?(0,i.jsx)("div",{className:(0,r.classNames)("Keyboard",{"Keyboard--hidden":s.hide}),children:(0,i.jsx)(n.Scroll,{className:"Keyboard__scrollWrapper",children:(0,i.jsx)("div",{className:"Keyboard__container",children:s.buttons.map(((a,n)=>(0,i.jsx)("div",{className:"Keyboard__row",children:a.map(((n,o)=>(0,i.jsx)("div",{className:"Keyboard__button",style:{width:d.getButtonWidth(a.length)},children:(0,i.jsx)(c.BotButton,{button:n,sendMessage:t,keyboardAuthorId:s.author_id,store:e})},`cell-${o}`)))},`row-${n}`)))})})}):null}}const u=(0,o.connect)(d)},652249:(e,t,s)=>{"use strict";s.d(t,{MessageReactionsPopup:()=>v});var i=s(474848),a=s(910944),n=s(296540),o=s(610989),r=s(209642),l=s(125852),c=s(416124),d=s(358012),u=s(358678),_=s(439220),g=s(785118),m=s(445248),p=s(414698),h=s(531769),f=s(272259);const v=({getReactedPeers:e,reactionsData:t,onClose:s,refreshCoordinates:h})=>{const[v,w]=(0,n.useState)(new Map),[E,C]=(0,n.useState)([]),[S,T]=(0,n.useState)(new Map),[I,k]=(0,n.useState)(0),[M,P]=(0,n.useState)(0);(0,n.useEffect)((()=>{e().then((e=>{const s=e.counters.filter((({reaction_id:e})=>t.has(e))).map((e=>[e.reaction_id,e.count])).sort(((e,t)=>t[1]-e[1]));return C(s),P(e.count),h(),e})).then((e=>b(e,t))).then((e=>{w(e),T(e)}))}),[]);const A=s=>{if(k(s||0),M<=100&&!s)T(v);else if(M<=100){const e=new Map([...v].filter((([,e])=>e.reactionId===s)));T(e)}else e(s).then((e=>b(e,t))).then((e=>{w(e)}))};return 0===M?(0,i.jsx)(f.MessageBoxModalLoader,{refreshCoordinates:h}):(0,i.jsxs)(r.ModalBox,{children:[(0,i.jsx)(l.ModalHeader,{onClose:s,closeAriaLabel:o.getLang("global_close"),children:o.getLang("mail_reactions_popup_title")}),(0,i.jsxs)(c.ModalBody,{insetLevel:0,children:[E.length>1&&(0,i.jsxs)(d.ModalTabs,{children:[(0,i.jsx)(u.TabsItem,{selected:0===I,onClick:()=>A(),status:M,children:o.getLang("global_all")},0),E.map((([e,s])=>(0,i.jsx)(u.TabsItem,{selected:I===e,onClick:()=>A(e),status:s,children:y(t,e)},e)))]}),(0,i.jsx)(_.ModalScrollView,{height:475,children:(0,i.jsx)(g.Div,{children:[...S.values()].map((({photo:e,icon:t,userId:s,name:n,screenName:o})=>(0,i.jsx)(m.SimpleCell,{href:`/${o}`,before:(0,i.jsx)(p.Avatar,{size:40,src:e}),after:t,className:a.default.peer,target:"_blank",children:n},s)))})})]})]})};function b(e,t){const{profiles:s,groups:i,reactions:a}=e,n=new Map,o=new Map;return s?.forEach((e=>{o.set(e.id,{...e,name:`${e.first_name} ${e.last_name}`})})),i?.forEach((e=>{o.set(-e.id,e)})),0===o.size||a.forEach((e=>{const{reaction_id:s,user_id:i}=e,a=o.get(i),r=y(t,s);a&&n.set(i,{peerId:i,name:a.name,photo:a.photo_200,screenName:a.screen_name,icon:r,reactionId:s})})),n}function y(e,t){const s=t&&e.get(t);return s?(0,i.jsx)("img",{src:s.icon,className:a.default.icon}):(0,i.jsx)(h.Icon46MessageReaction404,{width:20,height:20})}},603723:(e,t,s)=>{"use strict";s.d(t,{PresetOptionsModal:()=>c});var i=s(474848),a=s(583652),n=s(505954),o=s(125852),r=s(603640),l=s(610989);const c=({flags:e,afterSave:t,onCancel:s,onSave:c})=>(0,i.jsx)(n.AppRootProvider,{children:(0,i.jsxs)(a.BaseModal,{onClose:s,className:"im-creation--modal-settings",children:[(0,i.jsx)(o.ModalHeader,{onClose:s,closeAriaLabel:l.getLang("global_close"),children:l.getLang("mail_chat_creation_settings")}),(0,i.jsx)(r.ChatSettingsOptions,{flags:e,back:s,isChatCreation:!0,onSave:c,afterSave:t})]})})},553481:(e,t,s)=>{"use strict";s.d(t,{default:()=>_});var i=s(474848),a=s(296540),n=s(695676),o=s(610989),r=s(428280),l=s(584554),c=s(8520),d=s(872453);class u extends a.Component{render(){const{getTemplates:e,showSettingsPopup:t,showCreatingTemplatePopup:s,isNeededRendering:a}=this.props,{isShowDropDown:r}=this.state;if(!a())return null;const u=e();return(0,i.jsxs)("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1),children:[(0,i.jsx)("div",{className:(0,c.classNames)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":r}),"aria-hidden":r,children:(0,i.jsx)("div",{className:"TemplatesDropDown__container",children:(0,i.jsx)(n.Scroll,{className:"TemplatesDropDown__scroll-wrapper",children:(0,i.jsxs)("div",{children:[" ",(0,i.jsxs)("header",{className:"TemplatesDropDown__header",children:[(0,i.jsx)("h2",{className:"TemplatesDropDown__title",children:o.getLang("mail_community_templates")}),(0,i.jsx)("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:t,children:o.getLang("mail_settings_configure")})]}),u.length?(0,i.jsx)("ul",{className:"TemplatesDropDown__list",children:u.map((e=>(0,i.jsxs)("li",{className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id),children:[(0,i.jsx)("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),(0,i.jsx)("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}})]},e.id)))}):(0,i.jsxs)("div",{className:"TemplatesDropDown__not-found-container",children:[(0,i.jsx)("span",{children:o.getLang("mail_community_templates_not_found")}),(0,i.jsx)(l.default,{onClick:s,children:o.getLang("mail_add_community_template")})]})]})})})}),(0,i.jsx)("button",{className:"TemplatesDropDown__icon",children:(0,i.jsx)(d.Icon24List,{})})]})}constructor(...e){super(...e),this.state={isShowDropDown:!1},this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})}}}const _=(0,r.connect)(u)},522465:(e,t,s)=>{"use strict";s.r(t),s.d(t,{EDIT:()=>b,MAIN:()=>v,default:()=>w});var i=s(474848),a=s(296540),n=s(610989),o=s(209642),r=s(125852),l=s(966576),c=s(428280),d=s(448830),u=s(695676),_=s(584554),g=s(963856),m=s(233859),p=s(948350),h=s(8520),f=s(20025);const v="main",b="edit";class y extends a.Component{go(e,{id:t=null,name:s="",text:i=""}={}){return new Promise((a=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:t,name:s,text:i}},(()=>{this.props.popup.updateBoxCoords(),a()})):a()}))}render(){const{getTemplates:e,closePopup:t}=this.props,{section:s,editableMessage:a}=this.state,c=e();return(0,i.jsxs)(o.ModalBox,{children:[(0,i.jsxs)(r.ModalHeader,{onClose:t,closeAriaLabel:n.getLang("global_close"),children:[s===v&&n.getLang("mail_community_templates"),s===b&&n.getLang("mail_add_community_template")]}),(0,i.jsxs)("main",{className:"TemplatesSettings__content",children:[s===v&&(c.length?(0,i.jsx)(u.Scroll,{className:"TemplatesSettings__scroll-wrapper",children:(0,i.jsx)("div",{className:"TemplatesSettings__list",children:c.map((e=>(0,i.jsxs)("section",{className:"TemplatesSettings__item",children:[(0,i.jsx)("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),(0,i.jsx)("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),(0,i.jsxs)("div",{className:"TemplatesSettings__buttons-row",children:[(0,i.jsx)(_.default,{onClick:()=>this.go(b,e),className:"TemplatesSettings__item-button",children:n.getLang("mail_settings_edit")}),(0,i.jsxs)("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true",children:[" ","·"," "]}),(0,i.jsx)(_.default,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button",children:n.getLang("mail_delete")})]})]},e.id)))})}):(0,i.jsxs)("div",{className:"TemplatesSettings__not-found-container",children:[(0,i.jsx)("span",{children:n.getLang("mail_community_templates_not_found")}),(0,i.jsx)(_.default,{onClick:()=>this.go(b),children:n.getLang("mail_add_community_template")})]})),s===b&&(0,i.jsxs)("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate,children:[(0,i.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,i.jsxs)("label",{className:"TemplatesSettings__label",htmlFor:"name",children:[n.getLang("mail_name"),":"]}),(0,i.jsxs)("div",{className:"TemplatesSettings__input-container",children:[(0,i.jsx)(g.default,{initialValue:a.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),(0,i.jsx)("span",{className:"TemplatesSettings__notice",children:n.getLang("mail_community_templates_input_size").replace("{min}","2").replace("{max}","200")})]})]}),(0,i.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,i.jsxs)("label",{className:"TemplatesSettings__label",htmlFor:"text",children:[n.getLang("mail_text"),":"]}),(0,i.jsxs)("div",{className:"TemplatesSettings__input-container",children:[(0,i.jsx)(g.WithEmoji,{title:n.getLang("global_emoji_hint"),children:(0,i.jsx)(g.default,{id:"text",name:"text",isMultiLine:!0,getRef:this.getTextAreaRef,initialValue:a.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")})}),(0,i.jsx)("span",{className:"TemplatesSettings__notice",children:n.getLang("mail_community_templates_input_size").replace("{min}","5").replace("{max}","2 000")})]})]}),(0,i.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,i.jsxs)("label",{className:"TemplatesSettings__label",children:[n.getLang("mail_hints"),":"]}),(0,i.jsx)("div",{className:"TemplatesSettings__input-container",children:(0,m.default)().map((e=>(0,i.jsx)(d.default,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",children:e.label},e.id)))})]})]})]}),(0,i.jsx)(l.ModalFooter,{before:(0,i.jsxs)(i.Fragment,{children:[s===v&&(0,i.jsx)(_.default,{onClick:()=>this.go(b),children:n.getLang("mail_add_community_template")}),s===b&&Boolean(a.id)&&(0,i.jsx)(_.default,{onClick:this.deleteTemplate.bind(null,a.id),children:n.getLang("mail_delete_community_template")})]}),actions:(0,i.jsxs)(i.Fragment,{children:[s===v&&(0,i.jsx)(d.default,{onClick:t,children:n.getLang("mail_close")}),s===b&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.default,{appearance:"tertiary",onClick:()=>this.go(v),children:n.getLang("mail_cancel")}),(0,i.jsx)(d.default,{onClick:this.saveTemplate,form:"create_template_form",type:"submit",children:n.getLang("mail_save")})]})]})})]})}constructor(e){super(e),this.setEditableMessage=({id:e,name:t,text:s})=>new Promise((i=>this.setState({editableMessage:{id:e,name:t,text:s}},i))),this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:(0,h.escape)(t)})),this.deleteTemplate=e=>Promise.resolve().then((()=>this.state.section!==v?this.go(v):Promise.resolve())).then((()=>this.props.store.set(p.deleteTemplate.bind(null,e)))).catch((()=>{(0,f.showFastBox)(n.getLang("mail_error"),n.getLang("mail_community_templates_delete_error"))})),this.saveTemplate=e=>{e.preventDefault();const{editableMessage:t}=this.state,{name:s,text:i}=t;s.length>200||s.length<2||s.length>2e3||i.length<5?(0,f.showFastBox)(n.getLang("mail_error"),n.getLang("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch((()=>{(0,f.showFastBox)(n.getLang("mail_error"),n.getLang("mail_community_templates_save_error"))})).then((()=>this.go(v)))},this.addHint=(e,t)=>{t.preventDefault();const{editableMessage:{id:s=null,name:i,text:a}}=this.state;return(0,g.setHTML)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:s,name:i,text:`${a}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}}y.defaultProps={section:v};const w=(0,c.connect)(y)},474831:(e,t,s)=>{"use strict";s.d(t,{CAROUSEL_LAYER_CLASS:()=>l,CAROUSEL_VIEWPORT_CLASS:()=>r,mount:()=>y});var i=s(365485),a=s(452314),n=s(248782);const o="_im_carousel",r="_im_carousel_viewport",l="_im_carousel_layer",c="_im_carousel_control",d="_im_carousel_control_left",u="_im_carousel_control_right",_="Carousel__control--hidden";function g(e){return(0,a.domClosest)(o,e.target)}function m(e,t){const s=t.querySelector(`.${d}`),i=t.querySelector(`.${u}`),a=t.querySelector(`.${r}`),n=t.querySelector(`.${l}`);if(!(i&&s&&a instanceof HTMLElement&&n instanceof HTMLElement))return;const o=a.offsetWidth,c=n.offsetWidth,g=o<c;s.classList.toggle(_,!g||e<=0),i.classList.toggle(_,!g||e+o>=c)}function p(e){const t=g(e),s=(0,a.domClosest)(c,e.target),i=Number(s.dataset.direction);if(!t)return;const n=t.querySelector(`.${r}`),o=t.querySelector(`.${l}`);if(!n||!o||!i)return;const d=Number(t.dataset.scrollCount)||1,u=Math.floor(o.offsetWidth/o.childElementCount),_=(Math.floor(n.scrollLeft/u)+i*d)*u;m(_,t),n.scrollTo({left:_,behavior:"smooth"})}const h=(0,n.debounce)((e=>{const t=g(e),s=t&&t.querySelector(`.${r}`);s&&m(s.scrollLeft,t)}),20);function f(e){const t=g(e);(t&&t.querySelector(`.${r}`)).addEventListener("scroll",h)}function v(e){const t=g(e);(t&&t.querySelector(`.${r}`)).removeEventListener("scroll",h)}function b(e){return{unmount(){(0,i.destroyModule)(e)}}}function y(e,t){const{bindMutations:s}=(0,i.createMutations)(b);return s((0,i.createModule)({handlers:(e,s)=>{s(t,"click",c,p),s(t,"mouseover",o,f),s(t,"mouseout",o,v)}}),e)}},111796:(e,t,s)=>{"use strict";s.d(t,{mount:()=>m});var i=s(365485),a=s(948350),n=s(583790),o=s(693143),r=s(822317),l=s(52554),c=s(610989),d=s(879007);const u="_im_dialogs_cog_settings",_="_im_to_unread",g="im-page--dialogs-filter";function m(e,t,s){const m=(e,i)=>{(0,n.showUnreadOnly)(t,s,a.changeDialogsTab).then((e=>{const a=t.get().active_tab;if(!e)return;const n=a===r.ConvoListFolder.UNREAD;i.innerHTML=(0,d.getTemplate)("im_filter",{filter:n?c.getLang("mail_to_all_dialogs"):c.getLang("mail_to_unread")}),a===r.ConvoListFolder.ALL&&s().updateRecommendationList(t)}))},p=(0,i.createModule)({handlers:(t,s)=>{s(e,"click",_,m)}});return function(e,t){return{updateFilter(t){const s=t.get().active_tab,i=s===r.ConvoListFolder.UNREAD;let a,n=[];((0,o.isSearching)(t)||[r.ConvoListFolder.BUSINESS_NOTIFY,r.ConvoListFolder.ARCHIVE,r.ConvoListFolder.MR].includes(s))&&n.push("im-page--dialogs-filter_hidden"),(0,l.getUnreadCountWithMuted)(t)>0?a=i?c.getLang("mail_to_all_dialogs"):c.getLang("mail_to_unread"):(a=c.getLang("mail_all_dialogs"),n.push("im-page--dialogs-filter_disabled"));const u=e.querySelector(`.${_}`);u&&(u.innerHTML=(0,d.getTemplate)("im_filter",{filter:a,cls:n.join(" ")}))},toggleButton(t,s){const i=e.querySelector(`.${g}`);i&&i.classList.toggle("im-page--dialogs-filter_hidden",s)},toggleLoader(t,s){const i=e.querySelector(`.${u}`);i&&i.classList.toggle("im-page--dialogs-settings_loading",s)},unmount(){(0,i.destroyModule)(t)}}}(e,p)}},890888:(e,t,s)=>{"use strict";s.d(t,{mount:()=>u,mountHistoryMsgsReactionsObserver:()=>_});var i=s(365485),a=s(485413),n=s(287841),o=s(52554),r=s(879007),l=s(531868),c=s(681009);function d(e,t,s,i){const{observer:a,targets:n}=s.get();n.forEach((e=>a.unobserve(e)));const r=function(e,t,s){const i=(0,o.getPeer)(e);if(!(0,l.isFullyLoadedTab)(e,i))return[];const a=(0,l.getTab)(e,i);return a&&a.msgs?Object.keys(a.msgs).reduce(((e,i)=>{if(!a.msgs)return e;const n=(0,c.parseMessage)(a.msgs[i]);if(!t(n,a))return e;const o=s||document,r=o.querySelector(`._im_mess_${i}`)||o.querySelector(`._im_expired_message_${i}`);return r&&e.push(r),e}),[]):[]}(e,i,t);s.setState({targets:r}),r.forEach((e=>a.observe(e)))}function u(e,t,s,n){const o=(0,a.default)({observer:new IntersectionObserver(s,{root:t}),targets:[]});d(e,t,o,n);const r=(0,i.createModule)({handlers:()=>{}});let l=!1;return{update(){l||d(e,t,o,n)},unmount(){const{observer:e}=o.get();e.disconnect(),(0,i.destroyModule)(r),l=!0}}}function _(e,t,s,l,c){const u=15e3,_=1e3;let g=new Set,m=new Map,p=new Map;function h(t){const s=(0,o.getPeer)(e),i=(0,o.getUnreadReactions)(e,s),a=[];for(let e of t)i.has(e)&&a.push(e);return a}const f=(0,n.throttle)((()=>{const e=h(Array.from(g));e.length&&c(e)}),100);const v=setInterval((function(){const e=Array.from(g),t=function(e){const t=Date.now(),s=e.some((e=>{const s=p.get(e),i=m.get(e);return s&&i&&t-s>=u&&t-i>=_}));return s&&e.forEach((e=>{p.set(e,t)})),s}(e),s=h(e);t&&l(e),s.length&&c(s)}),1e3),b=e=>{g=new Set;const{targets:t}=e.get(),s=new Map,i=new Map;t.forEach((e=>{const t=e.getAttribute("data-cmid"),a=t&&(0,r.intval)(t);if("number"==typeof a){const e=p.get(a)||Date.now(),t=m.get(a);t&&i.set(a,t),s.set(a,e)}})),p=s,m=i},y=(0,a.default)({observer:new IntersectionObserver((e=>{e.forEach((e=>{const t=e.target.getAttribute("data-cmid"),s=t&&(0,r.intval)(t);if("number"==typeof s){if(e.isIntersecting){g.add(s);const e=m.get(s)||Date.now();m.set(s,e)}else g.delete(s),m.delete(s);f()}}))}),{root:t}),targets:[]});d(e,t,y,(()=>!0)),b(y);const w=(0,i.createModule)({handlers:()=>{}});let E=!1;return s(),{update(){E||(d(e,t,y,(()=>!0)),b(y))},unmount(){const{observer:e}=y.get();e.disconnect(),(0,i.destroyModule)(w),E=!0,clearInterval(v)}}}},43658:(e,t,s)=>{"use strict";s.d(t,{mount:()=>_});var i=s(474848),a=s(440961),n=s(505954),o=s(614469),r=s(428280),l=s(365485),c=s(948350);function d(){return document.getElementById("_im_keyboard_container")}function u(e,t,s){return{init(){return new Promise((e=>{this.isMounted=!0,function(e,t,s){const l=d();if(l){const c=(0,i.jsx)(n.AppRootProvider,{children:(0,i.jsx)(r.default,{value:e,children:(0,i.jsx)(o.default,{send:t})})});a.render(c,l,s)}}(t,s,e)}))},toggle:(e,s,i)=>t.set(c.toggleKeyboard.bind(null,e,s,i)),unmount(){const t=d();t&&this.isMounted&&a.unmountComponentAtNode(t),this.isMounted=!1,(0,l.destroyModule)(e)}}}function _(e,t,s){const{bindMutations:i}=(0,l.createMutations)(u);return i((0,l.createModule)({handlers:()=>{}}),e,s)}},908081:(e,t,s)=>{"use strict";s.d(t,{mount:()=>u});var i=s(474848),a=s(365485),n=s(411953),o=s(52554),r=s(485413),l=s(652249),c=s(272259);function d(e){return{unmount:()=>function(e){(0,a.destroyModule)(e)}(e)}}function u(e,t){const{bindMutations:s}=(0,a.createMutations)(d),u=s((0,a.createModule)({handlers:()=>{}}),e);return function(e,t){const s=(0,r.unpackStore)(e),a=(0,o.getGroupId)(e),d=(0,o.getPeer)(e);(0,c.showMessageBoxModal)((({onClose:e,refreshCoordinates:o})=>(0,i.jsx)(l.MessageReactionsPopup,{onClose:e,getReactedPeers:e=>(0,n.getReactedPeers)(d,a,t,e),reactionsData:s.reactions,refreshCoordinates:o})),{width:420})}(e,t),u}},938900:(e,t,s)=>{"use strict";s.d(t,{mount:()=>C});var i=s(474848),a=s(205338),n=s(428280),o=s(505954),r=s(365485),l=s(948350),c=s(693143),d=s(531868),u=s(471424),_=s(233859),g=s(8520),m=s(530960),p=s(20025),h=s(52554);const f=s(553481).default,v=s(522465).default,{MAIN:b,EDIT:y}=s(522465);function w(e,t){return(0,_.default)().reduce(((t,s)=>t.replace(new RegExp(`({${s.id}})`,"gi"),s.process(e))),t).replace(/&lt;br&gt;/gi,"<br>")}function E(e,t,s,r,_){let f;return{closeSettingsPopup(){f&&f.hide()},showSettingsPopup(e){const s="TemplatesSettings",r={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:()=>{const r=document.getElementById(s);if(r){(0,a.createRoot)(r).render((0,i.jsx)(o.AppRootProvider,{children:(0,i.jsx)(n.default,{value:t,children:(0,i.jsx)(v,{popup:f,section:e,getTemplates:()=>(0,c.getTemplates)(t),saveTemplate:this.saveTemplate.bind(this),deleteTemplate:this.deleteTemplate.bind(this),closePopup:this.closeSettingsPopup.bind(this)})})}))}requestAnimationFrame((()=>f.updateBoxCoords()))}};f=new p.MessageBox(r).content(`<div id="${s}"></div>`),f.show()},applyTemplate(e){const s=(0,c.getTemplates)(t).find((({id:t})=>t===e));(0,u.statlogsCommunityTemplatesClickEvent)(),r(w(t,(0,m.prepareToWriting)(s.text)))},getPreparedTemplates:()=>(0,c.getTemplates)(t).map((e=>Object.assign({},e,{name:e.name,text:w(t,e.text)}))),saveTemplate(e){const s=(0,g.decodeHTMLEntities)(e.name),i=(0,g.decodeHTMLEntities)(e.text);return t.set(e.id?l.updateTemplate.bind(null,e.id,s,i):l.createTemplate.bind(null,s,i))},deleteTemplate:e=>t.set(l.deleteTemplate.bind(null,e)),isNeedRenderTemplates(){const e=(0,h.getPeer)(t);if(!e)return!1;if(!(0,c.isCommunityInterface)(t))return!1;const s=(0,d.getCurrentTab)(t);return(!s||!(0,c.isChannelPeer)(s))&&!(0,c.isCommunityChat)(t,e)},toggleImText(e=this.isNeedRenderTemplates()){_(e)},update(){this.toggleImText()},unmount(){this.toggleImText(!1)}}}function C(e,t,s,o){const{bindMutations:l}=(0,r.createMutations)(E),c=l((0,r.createModule)({handlers:()=>{}}),e,t,s,o);if("function"!=typeof c){c.toggleImText();const s=(0,a.createRoot)(t),o=(0,i.jsx)(n.default,{value:e,children:(0,i.jsx)(f,{getTemplates:c.getPreparedTemplates,applyTemplate:c.applyTemplate.bind(c),isNeededRendering:c.isNeedRenderTemplates,showSettingsPopup:c.showSettingsPopup.bind(c,b),showCreatingTemplatePopup:c.showSettingsPopup.bind(c,y)})});s.render(o)}return c}},250971:(e,t,s)=>{"use strict";var i=s(490712),a=s(180690),n=s(850101),o=s(103275),r=s(485413),l=s(958145),c=s(948350),d=s(406760),u=s(583790),_=s(879007),g=s(610989),m=s(805088),p=s(452314),h=s(355508),f=s.n(h),v=s(476726),b=s(171444),y=s(100072),w=s(944633),E=s(726356);s(319210);window.vk?.pe?.static_manager_dynamic_imports&&window.vk?.stDomain&&(s.p=window.vk.stDomain+"/dist/"),window.IM={init(e){if((0,_.addTemplates)(f()),window.cur.lang.dont_attach=g.getLang("mail_dont_add_media"),e.failed)return(0,o.mount)((0,p.geByClass1)("im-sick",(0,p.ge)("page_body")),null);localStorage.removeItem("im_sick_timer"),window.cur.ctrl_submit=Boolean(e.settings.ctrl_submit),window.cur.module="im",window.cur.mutedPeers=e.mutedPeers,window.cur.gid=e.gid,window.cur.peer=e.peer,window.cur.options={blacklist_hash:e.thash},window.StickerPickerViewer?.initPeerId();const t=-10800-60*(new Date).getTimezoneOffset(),s=e.timeshift,i=Object.entries(e.defaultReactions).reduce(((e,[t,s])=>e.set(Number(t),s)),new Map),h={...e,owners:void 0,tabbedPeers:(e.tabbedPeersArray||[]).map((e=>({peer:e,type:"perm"}))),blockedFlagUpdates:{},msgid:(0,_.intval)(window.nav.objLoc.msgid),timeshift:s-t,oCache:{},ref_id:window.nav.objLoc.ref,ref_source:window.nav.objLoc.ref_source,topConvTree:new Promise((()=>{})),hintsTree:new Promise((()=>{})),imTopConvList:new Promise((()=>{})),callbackEventButtons:new Map,reactions:i,pendingReadReactionsCmids:new Map,cmidToMessageIdMap:new Map};let y=(0,r.default)(h);e.owners?.forEach((e=>(0,d.oCacheAdd)(y,e))),(0,u.normalizeTabsGotFromServer)(y,y.get().tabs),window.cur.imClassicInterface=(0,u.isClassicInterface)(y);let C=(0,a.mount)((0,p.geByClass1)("js-im-page",(0,p.ge)("page_body")),y);(0,m.isPopUpStickersEnabledInVkCom)()&&(0,w.initStickersSettings)(y).then((()=>{C.updateActions(y);const e=(0,E.getSettingsCache)().subscribe((()=>{C.updateActions(y)}));(0,b.pushNavDestroy)((()=>{e()}))})),(0,c.updateMentions)(y.get()),e.group_calls_feature_tt_hash&&(0,u.showGroupCallsOnboardingBox)(y.get(),e.group_calls_feature_tt_hash),e.group_calls_new_year_feature_tt_hash&&(0,u.showGroupCallsNewYearTooltip)(y.get(),e.group_calls_new_year_feature_tt_hash),window.IMBRIDGE={chatPhotoSaved(e){(0,n.curBox)()?.hide();let t=(e||{})[1];return t?(window.cur.pvShown&&window.layers.fullhide(!0,!0),"im"!=window.cur.module||y.get().peer!=t?window.nav.go("/im?sel=c"+(t-2e9)):void 0):window.nav.reload()},syncHistory(){y.set((e=>(0,c.syncHistory)(e))).then((()=>{}),(()=>{}))},activateTab(e,t="notifications"){y.get().gid||y.get().longpoll.push([(0,l.changePeer)((0,_.intval)(e),!1,!1,!0,t)])},selectedPeer:()=>y.get().peer,openSettings(){C.openSettings()}},(0,v.partConfigEnabled)("debug_messenger")&&(window.IMBRIDGE.store=y);let S=!1;window.cur.nav.push((function(){return!!S||(y.get().audio_msg?.isRecording&&C.cancelRecording(),window.AudioMessagePlayer.detachPlayer(),C.route.apply(null,arguments))})),(0,b.pushNavDestroy)((function(){if(S)return!0;C.unmount(),window.IMBRIDGE=void 0,y.unmount(),window.store=void 0,S=!0,e=!1,y=!1,C=!1}))},initOnboarding:y.initOnboarding,updateHints:y.updateHints,activeHints:[],onboardingParams:{}};try{window.stManager.done(window.jsc("web/imn.js"))}catch(e){}requestIdleCallback((()=>{try{(0,i.statlogsValueEvent)("entries_requests",1,"imn","web")}catch{}}),{timeout:5e3})},944633:(e,t,s)=>{"use strict";s.d(t,{initStickersSettings:()=>l});var i=s(890639),a=s(755513),n=s(533243),o=s(726356),r=s(689938);const l=e=>(0,r.ensureDIRootWebContainer)().resolve(i.StickersSettingsService).getSettings().then((t=>{if(!t)throw new Error("no stickers settings");(0,o.setIsAnimationAutoplay)(t.autoplay),(0,o.setDisabledPeerIdsByUser)(t.popup.disabledPeerIds),(0,o.setIsPopupAutoplayOnSend)(t.popup.autoplayOnSend),(0,o.setIsPopupAutoplayOnGet)(t.popup.autoplayOnGet),e.setState({stickersSettingsLoaded:!0}).then((()=>e.set((e=>(0,n.setActions)(e)))))})).catch((e=>{(0,a.logStickersError)("initStickersSettings: "+e?.message)}))},39087:(e,t,s)=>{"use strict";s.d(t,{addMessageReactionOptimistic:()=>o,removeMessageReactionOptimistic:()=>r,setMessageFlag:()=>n});var i=s(205184),a=s(531868);function n(e,t,s,n,o){const r=(0,a.getTab)(e,t),l=(0,i.getMessage)(e,t,s);return r&&r.msgs&&l?(l.flags=o?l.flags|n:l.flags&~n,r.msgs[s]=l,Promise.resolve(e)):Promise.resolve(e)}function o(e,t,s,n){const o=(0,a.getTab)(n,e),r=(0,i.getMessage)(n,e,t),l=r?.kludges.reactions||[],c=n.id;if(!r||!o?.msgs)return Promise.resolve(n);const d=l.findIndex((e=>e.reaction_id===s));if(r.kludges.reaction_id=s,r.kludges.reactions||(r.kludges.reactions=[]),-1===d)r.kludges.reactions.push({reaction_id:s,count:1,user_ids:[c]});else{const e=l[d];e.user_ids?.unshift(c),e.count=e.count+1,r.kludges.reactions=[...l.slice(0,d),e,...l.slice(d+1)]}return o.msgs[t]=r,Promise.resolve(n)}function r(e,t,s,n){const o=(0,a.getTab)(n,e),r=(0,i.getMessage)(n,e,t);if(!r)return Promise.resolve(n);const l=r?.kludges.reactions||[],c=n.id;if(delete r.kludges.reaction_id,0===l.length||!o?.msgs)return Promise.resolve(n);const d=l.findIndex((e=>e.reaction_id===s)),u=l[d];return u.user_ids=u.user_ids?.filter((e=>e!==c)),u.count=u.count-1,r.kludges.reactions=[...l.slice(0,d),u,...l.slice(d+1)].filter((e=>0!==e.count)),o.msgs[t]=r,Promise.resolve(n)}},699584:(e,t,s)=>{"use strict";s.d(t,{ContactList:()=>u});var i=s(474848),a=s(900424),n=s(583652),o=s(929528),r=s(610989),l=s(440961),c=s(505954);const d=({store:e,browserEnv:t,onClose:s,onSelect:l})=>(0,i.jsx)(c.AppRootProvider,{children:(0,i.jsxs)(n.BaseModal,{onClose:s,disableBodyScroll:!0,children:[(0,i.jsx)(o.Modal.Header,{title:r.getLang("mail_contacts_list"),onClose:s}),(0,i.jsx)("div",{style:{width:550,height:560},children:(0,i.jsx)(a.ContactListApp,{store:e,env:t,onSelect:l})})]})});class u{renderContactListPopup(e,t){const s=u.getContainer(),a=()=>this.hide();s&&l.render((0,i.jsx)(d,{store:e,browserEnv:t,onClose:a,onSelect:e=>this.onSelectPeer(e)}),s)}static getContainer(){return document.getElementById("ContactList")}hide(){if(!this.isMounted)return;const e=u.getContainer();e&&l.unmountComponentAtNode(e),this.isMounted=!1}show(){const e=window.reforgedME?.contactListContext;if(!e)return;const{store:t,browserEnv:s}=e;this.renderContactListPopup(t,s),this.isMounted=!0}onSelectPeer(e){this.hide(),window.nav.go(`/im?sel=${e}`,null,{params:{entrypoint:"contacts_list"}})}constructor(){this.isMounted=!1}}},720461:(e,t,s)=>{"use strict";s.d(t,{Api:()=>m});var i=s(627412),a=s(592087),n=s(73514),o=s(465284),r=s(594177),l=s(631346),c=s(933052),d=s(714209),u=s(407033),_=s(476726);const g=["messages.getLongPollServer","messages.getLongPollHistory","messages.getDiff","queue.subscribe","account.setOnline"];class m{static dropCache(){indexedDB.deleteDatabase(p.CACHE_DB_NAME)}dangerouslyAbort(e){e&&(this.abortTrackers.get(e)?.(),this.abortTrackers.delete(e))}async fetchMany(e,t={}){if(this.isDisposed)throw Error("API уничтожен");const s=[],i=[],a=[];let n=0,o=!1;for(let r=e.length-1;r>=0;r--){const l=e[r];if(!l){i[r]="null";continue}if(t.usePrefetch){const e=this.prefetch(l.method,l.params);if(e){i[r]="null",a[r]=e,n++;continue}}const c=`res${r}`,d=`API.${l.method}(${JSON.stringify(this.enrichParams(l.method,l.params))})`;o?(s[r]=`var ${c}=fork(${d});`,i[r]=`wait(${c})`):(o=!0,s[r]=`var ${c}=${d};`,i[r]=`${c}`)}if(n===e.filter(Boolean).length)return a;const r=`${s.join("")}return [${i.join(",")}];`,l=await this.fetch("execute",{code:r},t);for(let e=0;e<l.length;e++)a[e]&&(l[e]=a[e]);return l}fetchSeq(e,t){if(this.isDisposed)return Promise.reject("API уничтожен");const s=[],i=[];for(let t=0;t<e.length;t++){const a=e[t];if(!a){i.push("null");continue}const n=`res${t}`;s.push(`var ${n}=API.${a.method}(${JSON.stringify(this.enrichParams(a.method,a.params))});`),i.push(`${n}`)}const a=`${s.join("")}return [${i.join(",")}];`;return this.fetch("execute",{code:a},t)}fetchForExternalLibs(e,t,s){return this.isDisposed?Promise.reject("API уничтожен"):this.fetch(e,t,{...s,fromExternalLib:!0})}prefetch(e,t){if(!this.prefetchCache)return;t=this.enrichParams(e,t);const s=this.prefetchCache.findIndex((s=>s.version===i.API_VERSION&&(s.method===e&&(Object.keys(t).length===Object.keys(s.request).length&&Object.keys(t).every((e=>t[e]===s.request[e])))))),a=this.prefetchCache[s];return a&&(this.prefetchCache.splice(s,1),!a.error)?a.response:void 0}online(){return new Promise((e=>{try{const t=window.navigator.onLine;(t||void 0===t)&&e(),window.addEventListener("online",(()=>e()),{once:!0})}catch(t){e()}}))}dispose(){this.isDisposed=!0,this.abortControllers.forEach((e=>e.abort()))}constructor(e,t){this.onApiUnavailable=t,this.isDisposed=!1,this.prefetchCache=window?.cur?.apiPrefetchCache||[],this.abortControllers=new Set,this.abortTrackers=new Map,this.fetch=async(e,t,s={})=>{if(this.isDisposed)throw Error("API уничтожен");if("queue.subscribe"===e)return{base_url:"mock",queues:[]};if(s.usePrefetch){const s=this.prefetch(e,t);if(s)return s}s.timeout||(s.timeout=1e4),s.fromExternalLib||(t=this.enrichParams(e,t));const i=g.includes(e),n=`${e} ${JSON.stringify(t)}`;let o=s.retries||0,c=0;for(;;)try{if(i&&window.curNotifier&&!window.curNotifier.is_server&&!d.browser.safari){await h((m=500,p=1500,Math.random()*(p-m+1)+m));const e=await this.cache.get(n);if(e)return e}const{response:o,abort:r}=this.request(e,t,s.timeout);let l;s.trackId&&this.abortTrackers.set(s.trackId,r);try{l=await o}catch(e){if(e&&"api_error"===e.type){const{error_code:t,error_message:s}=e.error;throw new a.IApi.RequestError(t,s,e.error)}throw e}finally{s.trackId&&this.abortTrackers.delete(s.trackId)}if(l.execute_errors)throw new a.IApi.ExecuteErrors(l.execute_errors.map((e=>new a.IApi.RequestError(e.error_code,`[API] RequestError: ${e.error_code} ${e.method} (${e.error_msg})`,e))),l.response);if(i)try{await this.cache.set(n,l)}catch(e){}return l}catch(e){if(e instanceof a.IApi.AbortError)throw e;c++;let t=[];if(e instanceof a.IApi.RequestError){const s=e.apiError;if((0,r.isApiError)(s)&&(0,r.isPhoneValidationError)(s)){if(!0===await new Promise(((t,s)=>{(0,l.validateMobileBox)({onDone:()=>{t(!0)},onFail:()=>s(e)})})))continue}t=[e]}e instanceof a.IApi.ExecuteErrors&&(t=e.list);const s=new Set;for(const e of t){switch(e.code){case u.API_ERROR_SECTION_DISABLED:throw this.onApiUnavailable&&this.onApiUnavailable(),e;case u.API_ERROR_TOO_MANY:if(s.has(e.code))continue;c=0,await h(2e3);break;case u.API_ERROR_UNKNOWN:case u.API_ERROR_FLOOD:case u.API_ERROR_SERVER:case u.API_ERROR_METHOD_DISABLED:case u.API_ERROR_RATE_LIMIT:break;default:throw e}s.add(e.code)}if(c===o+1)throw e;await h(Math.min(500*2**(c-1),2e4)),(0,_.partConfigEnabled)("vkm_use_browser_online_event")&&await this.online()}var m,p},this.request=(e,t,s)=>{const n=new AbortController;let o;this.abortControllers.add(n);let r=!1;s&&(o=window.setTimeout((()=>{r=!0,n.abort()}),s));const l={};for(const e of Object.keys(t))void 0!==t[e]&&(l[e]=t[e]);return{response:(0,c.api)(e,l,{version:i.API_VERSION},{signal:n.signal}).catch((t=>{if(n.signal.aborted)throw r?new a.IApi.TimeoutError(`[API] Timeout Error: ${e}`):new a.IApi.AbortError(`[API] Abort Error: ${e}`);throw t})).finally((()=>{o&&clearTimeout(o),this.abortControllers.delete(n)})),abort:()=>{n.abort()}}},this.enrichParams=(e,t)=>{switch(e.slice(0,e.indexOf("."))){case"users":case"friends":return{...t,fields:n.API_USER_FIELDS.join(",")};case"groups":return{...t,fields:n.API_GROUP_FIELDS.join(",")};default:return"extended"in t&&t.extended||"extended_filters"in t&&t.extended_filters?{...t,fields:Array.from(new Set([...n.API_USER_FIELDS,...n.API_GROUP_FIELDS])).join(",")}:t}},this.cache=new p(3e3,e)}}class p{get(e){return o.get(e,this.cache).then((t=>{if(void 0!==t){if(!(t.expiresAt<Date.now()))return setTimeout((()=>{o.del(e,this.cache).catch((()=>{}))}),Date.now()-t.expiresAt),t.response;o.del(e,this.cache).catch((()=>{}))}})).catch((()=>{}))}set(e,t){const s={response:t,expiresAt:Date.now()+this.invalidateTimeout};return o.set(e,s,this.cache).then((()=>{setTimeout((()=>{o.del(e,this.cache).catch((()=>{}))}),this.invalidateTimeout)})).catch((()=>{}))}constructor(e,t){this.invalidateTimeout=e,this.cache=o.createStore(p.CACHE_DB_NAME,"api-cache-"+t)}}function h(e){return new Promise((t=>setTimeout(t,e)))}p.CACHE_DB_NAME="reforged-db-v1"},174753:(e,t,s)=>{"use strict";s.d(t,{BrowserNotifications:()=>n});var i=s(77294),a=s(250682);class n{dispose(){}constructor(){this.isExternal=()=>!0,this.isEnabled=()=>window.DesktopNotifications.supported()&&!window.DesktopNotifications.checkPermissionNeeded()&&!a.ls.get("im_ui_notify_off"),this.onChange=e=>e&&!this.isEnabled()?new Promise((e=>{window.DesktopNotifications.requestPermission((()=>{this.statlogsBrowserNotificationsOn(),e(!window.DesktopNotifications.checkPermissionNeeded())}))})):!e&&this.isEnabled()?(a.ls.set("im_ui_notify_off",1),this.statlogsBrowserNotificationsOff(),Promise.resolve(!1)):Promise.resolve(e),this.onExternal=()=>window.nav.go("/settings?act=notify"),this.getPermission=()=>window.Notification?window.Notification.permission??"default":"unknown",this.onSystemSettingChange=e=>{"navigator"in window&&navigator.permissions&&navigator.permissions.query({name:"notifications"}).then((t=>{t.onchange=()=>{e("granted"===t.state)}}))},this.statlogsBrowserNotificationsOn=()=>{(0,i.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)},this.statlogsBrowserNotificationsOff=()=>{(0,i.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}}}},236275:(e,t,s)=>{"use strict";s.d(t,{GeoLocation:()=>a});var i=s(628180);class a{get(){return new Promise((e=>{(0,i.sendLocationFromKeyboard)((([,t])=>{const[s,i]=t.split("_");e([s,i])}))}))}dispose(){}}},694871:(e,t,s)=>{"use strict";s.d(t,{Idle:()=>i});class i{dispose(){window.clearTimeout(this.timeoutId),document.removeEventListener("mousemove",this.onActive),document.removeEventListener("keydown",this.onActive,!0),document.removeEventListener("visibilitychange",this.onVisibilityChange)}constructor(e){this.logger=e,this.listeners=new Set,this.isIdle=()=>void 0===this.timeoutId,this.subscribe=e=>(this.listeners.add(e),()=>{this.listeners.delete(e)}),this.onVisibilityChange=()=>{document.hidden?(document.removeEventListener("mousemove",this.onActive),document.removeEventListener("keydown",this.onActive,!0),this.onIdle()):(document.addEventListener("mousemove",this.onActive),document.addEventListener("keydown",this.onActive,!0),this.onActive())},this.onIdle=()=>{this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0,this.notify())},this.onActive=()=>{const e=void 0!==this.timeoutId;this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(this.onIdle,3e4),e||this.notify()},this.notify=()=>{this.logger.info("[IDLE]","user became "+(this.isIdle()?"idle":"active"));for(const e of this.listeners)e(this.isIdle())},this.onVisibilityChange(),document.addEventListener("visibilitychange",this.onVisibilityChange)}}},717153:(e,t,s)=>{"use strict";s.d(t,{Logger:()=>n});var i=s(592087),a=s(87223);class n{constructor(){this.visible=!1,this.configureScope=()=>{},this.info=(...e)=>{this.visible&&console.log(...e)},this.error=(e,t)=>{t?console.error(e,t):console.error(e);const s=e=>{(0,a.logError)(e,{environment:"messenger"})};if(t instanceof i.IApi.RequestError){const i=JSON.stringify(t);return s(new Error(e+" "+i))}if(t instanceof Error){const i=new Error(e+" "+t.message);return i.name=t.name,i.stack=t.stack,s(i)}return s("string"==typeof t?new Error(e+" "+t):new Error(e))},this.show=()=>{this.visible=!0},this.hide=()=>{this.visible=!1},this.dispose=()=>{}}}},201938:(e,t,s)=>{"use strict";s.d(t,{Notification:()=>u,communityNotification:()=>_});var i=s(839094),a=s(240515),n=s(476726),o=s(452314),r=s(7144),l=s(610989),c=s(536002);const d="/images/icons/favicons/";class u{getIconSuffix(){return window.devicePixelRatio>=1.25?"_2x":""}isIM(){return"im"===window.cur.module}isMasterTab(){return!(!window.curNotifier||!window.curNotifier.is_server)}isEnabled(){return!!window.vkmeIntegration&&!!this.isIM()}safariAudioPlayFix(e){document.body.addEventListener("mousedown",(function t(){const s=e.volume;e.volume=0,e.play().catch((()=>{})),e.pause(),e.currentTime=0,e.volume=s,document.body.removeEventListener("mousedown",t)}))}async play(){try{this.audio&&(this.audio.muted=!1,this.audio.addEventListener("ended",(()=>{this.audio&&(this.audio.muted=!0)}),{once:!0}),this.audio.load(),await this.audio.play())}catch(e){}}removeNotification(e,t){(0,n.partConfigEnabled)("vkm_switch_off_old_notifier_longpoll")&&window.pushNotifier?.removeMessageNotification&&window.pushNotifier.removeMessageNotification(e,t)}notify(){}notifyListeners(){}playSound(){this.isEnabled()&&this.isMasterTab()&&this.play()}setIdleCounter(e){if(this.isEnabled()&&this.idle.isIdle()){if(this.oldTitle||(this.oldTitle=document.title),0===e)return this.clear(),void(this.oldTitle=void 0);this.unreadCount=e,this.updateInterval||(this.updateInterval=window.setInterval((()=>this.updateTab()),this.titleUpdateInterval),this.updateTab())}}setCounters({showOnlyNotMuted:e,unread:t,unreadUnmuted:s}){if((0,n.partConfigEnabled)("vkm_switch_off_old_notifier_longpoll")){const i=e?s:t;(0,a.handlePageCount)(a.PAGE_ID_MESSENGER,i,"","",s>0)}else;}updateTab(){const e=this.getIconSuffix();if(this.oldTitle===document.title){const t=this.unreadCount>9?10:this.unreadCount;(0,i.setFavIcon)(d+"fav_im"+t+e+".ico"),(0,o.setDocumentTitle)((0,r.winToUtf)(l.getLang("mail_im_new_messages",this.unreadCount)))}else(0,o.setDocumentTitle)(this.oldTitle),(0,i.setFavIcon)(d+"fav_im"+e+".ico")}clear(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null,this.unreadCount=0,(0,i.setFavIcon)(d+"fav_im"+this.getIconSuffix()+".ico"),(0,o.setDocumentTitle)(this.oldTitle))}reset(){this.clear(),(0,i.setFavIcon)(d+"fav_logo"+this.getIconSuffix()+".ico")}dispose(){this.idleUnsubscribe?.(),this.reset()}constructor(e,t=1e3,s){this.idle=e,this.titleUpdateInterval=t,this.unreadCount=0,this.updateInterval=null,this.audio=null,this.audio=new Audio(s),this.audio.preload="auto",this.audio.loop=!1,this.audio.load(),c.browser.safari&&this.safariAudioPlayFix(this.audio),this.idleUnsubscribe=this.idle.subscribe((e=>{!e&&this.isEnabled()&&this.clear()}))}}const _={notify(){},notifyListeners(){},removeNotification(){},playSound(){},setCounters(){},setIdleCounter(){},clear(){},reset(){},dispose(){}}},544432:(e,t,s)=>{"use strict";s.d(t,{FCPlayer:()=>_,FCVoicePlayer:()=>u});var i=s(514640),a=s(327527),n=s(620626),o=s(561418),r=s(452314);const l=([e,t,s,i,a,n,,,,,,,,,,,,,,,o],r)=>({audioTrack:{id:`${t}_${e}`,url:s,progress:r,duration:n},title:i,artist:a,trackCode:o}),c=e=>{const[t,s]=e;return`${s}_${t}`},d=({audioTrack:e,title:t,artist:s,trackCode:i})=>{const{id:a,url:n,duration:o}=e,[r,l]=a.split("_");return[Number(l),Number(r),n,t,s,o,0,0,"",0,0,"im","[]","/////undefined/","",{},"","","",!1,i||"",0,0,0,"",!1]};class u extends o.EventBus{play(e){if(e.audioTrack.id===this.state.currentTrackEntity?.audioTrack.id&&"paused"===this.state.status)return this.state.currentTrackEntity=e,void this.resume();if(this.state.currentTrackEntity&&e.audioTrack.id!==this.state.currentTrackEntity.audioTrack.id){const{currentTrackEntity:e}=this.state,{audioTrack:t}=e;this.state={...this.state,status:"stopped",playedTimeAccumulator:{},currentTrackEntity:{...e,audioTrack:{...t,progress:0}}},this.emit("stateupdated",this.state)}const{url:t,duration:s,id:i}=e.audioTrack,a="MessagedConvoVoiceTrack"===e.kind?e.urlOgg:void 0,n=`<div id="audiomsgpl_${window.vk.id}_${i}" class="audio-msg-track " data-duration="${s}" data-mp3="${t}" data-ogg="${a}" <button class="audio-msg-track--btn"></button> <button class="audio-msg-track--transcriptToggle _msg_asr_toggle"> <span class="audio-msg-track--transcriptToggleShow"></span> <span class="audio-msg-track--transcriptToggleHide"></span> </button> <div class="audio-msg-track--duration"></div> <div class="audio-msg-track--wave-wrapper"> <svg class="audio-msg-track--wave"></svg></div></div>`;this.audioEl=(0,r.ce)("div",{innerHTML:n}).firstChild,this.audioEl.dataset.convoVoiceTrack=JSON.stringify(e),this.state={...this.state,status:"playing",playedTimeAccumulator:{},currentTrackEntity:e},this.emit("stateupdated",this.state),window.AudioMessagePlayer.togglePlay(this.audioEl),window.AudioMessagePlayer.seek(e.audioTrack.progress)}pause(){this.audioEl&&window.AudioMessagePlayer.toggle()}stop(){this.audioEl&&window.AudioMessagePlayer.toggle()}resume(){this.audioEl&&this.state.currentTrackEntity&&(this.audioEl.dataset.convoVoiceTrack=JSON.stringify(this.state.currentTrackEntity),window.AudioMessagePlayer.seek(this.state.currentTrackEntity.audioTrack.progress),window.AudioMessagePlayer.toggle())}isPlaying(){const{status:e}=this.getState();return"playing"===e}handleMediaMediatorResume(){this.resume()}handleMediaMediatorPause(){this.pause()}getState(){return this.state}playNext(){return!1}init(){}setVolume(){}setMute(){}playPrev(){}setShuffle(){}seek(){}setRepeatMode(){}setPlaybackRate(){}stopPlayer(){}constructor(e){super(),this.disposeActions=[],this.state={status:"stopped",playedTimeAccumulator:{},volume:100,playbackRate:1,mute:!1,shuffle:!1,repeatMode:"none"},this.dispose=()=>{this.disposeActions.forEach((e=>e()))},this.mediaMediator=e;const t=e=>{if(this.state.currentTrackEntity&&e!==this.audioEl){const{currentTrackEntity:e}=this.state,{audioTrack:t}=e;this.state={...this.state,status:"stopped",playedTimeAccumulator:{},currentTrackEntity:{...e,audioTrack:{...t,progress:0}}},this.emit("stateupdated",this.state),this.audioEl=void 0,this.state={status:"stopped",playedTimeAccumulator:{},volume:100,playbackRate:1,mute:!1,shuffle:!1,repeatMode:"none"},this.emit("stateupdated",this.state)}if(e===this.audioEl&&"string"==typeof e.dataset.audioTrack){const t=e.dataset.convoAudioTrack&&JSON.parse(e.dataset.convoAudioTrack);this.state={...this.state,status:"playing",currentTrackEntity:t},this.emit("stateupdated",this.state)}};window.AudioMessagePlayer.events.on("playing",t),this.disposeActions.push((()=>window.AudioMessagePlayer.events.off("playing",t)));const s=(e,t)=>{if(this.audioEl===t&&this.state.currentTrackEntity){const{currentTrackEntity:t}=this.state,{audioTrack:s}=t;this.state={...this.state,currentTrackEntity:{...t,audioTrack:{...s,progress:e}}},this.emit("stateupdated",this.state)}};window.AudioMessagePlayer.events.on("progress",s),this.disposeActions.push((()=>window.AudioMessagePlayer.events.off("progress",s)));const i=e=>{e===this.audioEl&&"playing"===this.state.status&&(this.state={...this.state,status:"paused"},this.emit("stateupdated",this.state))};window.AudioMessagePlayer.events.on("fc_paused",i),this.disposeActions.push((()=>window.AudioMessagePlayer.events.off("fc_paused",i)));const a=e=>{if(e===this.audioEl&&this.state.currentTrackEntity){const{currentTrackEntity:e}=this.state,{audioTrack:t}=e;this.state={...this.state,status:"ended",playedTimeAccumulator:{},currentTrackEntity:{...e,audioTrack:{...t,progress:0}}},this.emit("stateupdated",this.state),this.state={...this.state,status:"stopped",playedTimeAccumulator:{},currentTrackEntity:{...e,audioTrack:{...t,progress:0}}},this.emit("stateupdated",this.state)}};window.AudioMessagePlayer.events.on("finished",a),this.disposeActions.push((()=>window.AudioMessagePlayer.events.off("finished",a)))}}class _ extends o.EventBus{async getVkComPlayerPlaylist({peerId:e,playlistMeta:t,audios:s}){if("playlist"===t?.type||"artist"===t?.type){const e="playlist"===t.type?t.id:t.blockId,s="playlist"===t.type?t.accessKey:"",i="playlist"===t.type?"default":"artist_snippet",a=this.vkComPlayer.getPlaylist.bind(this.vkComPlayer,t.type,t.ownerId,e,s),n=a();return!!n.getAudiosCount()?n:((e,t,s)=>new Promise((i=>{e.load(0,(()=>{i(t())}),null,s)})))(n,a,i)}const i=this.vkComPlayer.getPlaylist(n.AudioPlaylist.TYPE_TEMP,window.vk.id,`im${e||""}`);return i.mergeWith({list:s}),i}async play(e,t){const{progress:s}=e.audioTrack,i=this.vkComPlayer.getPlaylistQueue(),a=i.shuffled,n=await this.getVkComPlayerPlaylist({peerId:"message"===e.source?.kind?e.source.peerId:void 0,playlistMeta:t?.getPlaylistMeta(),audios:t?.getConvoAudiosList().map(d)});await this.vkComPlayer.playAudioItem({audio:d(e),playlist:n,context:"im"}),i.shuffle(a);if(e===t?.getConvoAudiosShuffledList()[0]&&a){const t=i.indexOfAudio(d(e));i.moveAudio(t,0)}s>0&&this.vkComPlayer.seek(s),this.mediaMediator.handlePlayerOn(this)}pause(){this.vkComPlayer.isPlaying()&&this.vkComPlayer.pause()}stop(){this.vkComPlayer.stop()}resume(){this.vkComPlayer.isPlaying()||this.vkComPlayer.play()}isPlaying(){const{status:e}=this.getState();return"playing"===e}handleMediaMediatorResume(){this.resume(),this.isManualPause=!1}handleMediaMediatorPause(){this.pause(),this.isManualPause=!0}getState(){return this.state}playNext(){return!1}init(){}setVolume(){}setMute(){}playPrev(){}setShuffle(e){this.vkComPlayer.getPlaylistQueue().resetShuffle(),this.vkComPlayer.getPlaylistQueue().shuffle(e,!0)}seek(){}setRepeatMode(){}setPlaybackRate(){}stopPlayer(){}constructor(e){super(),this.vkComPlayer=(0,a.getAudioPlayer)(),this.disposeActions=[],this.isManualPause=!1,this.state={status:"stopped",playedTimeAccumulator:{},volume:100,playbackRate:1,mute:!1,shuffle:!1,repeatMode:"none"},this.updateState=e=>{this.state=e,this.emit("stateupdated",this.state)},this.dispose=()=>{this.disposeActions.forEach((e=>e()))},this.mediaMediator=e;const t=e=>{if(!e)return;const t={...this.state};if(t.currentTrackEntity&&t.currentTrackEntity.audioTrack){const{currentTrackEntity:e}=t,{audioTrack:s}=e;this.updateState({...t,status:"stopped",playedTimeAccumulator:{},currentTrackEntity:{...e,audioTrack:{...s,progress:0}}})}const s=l(e,0);this.updateState({...this.state,status:"playing",playedTimeAccumulator:{},currentTrackEntity:s})};this.vkComPlayer.on(this,i.events.PLAY_REQUESTED,t),this.disposeActions.push((()=>this.vkComPlayer.off(this,i.events.PLAY_REQUESTED,t)));const s=e=>{e&&(this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===c(e)||(this.state.currentTrackEntity=l(e,0)),this.updateState({...this.state,status:"playing"}),this.mediaMediator.handlePlayerOn(this))};this.vkComPlayer.on(this,i.events.PLAY,s),this.disposeActions.push((()=>this.vkComPlayer.off(this,i.events.PLAY,s)));const n=e=>{e&&(this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===c(e)||(this.state.currentTrackEntity=l(e,0)),this.updateState({...this.state,status:"paused"}))};this.vkComPlayer.on(this,i.events.PAUSE,n),this.disposeActions.push((()=>this.vkComPlayer.off(this,i.events.PAUSE,n)));const o=e=>{e?(this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===c(e)||(this.state.currentTrackEntity=l(e,1)),this.updateState({...this.state,status:"stopped"})):this.updateState({...this.state,currentTrackEntity:void 0,status:"stopped"})};this.vkComPlayer.on(this,[i.events.STOP,i.events.ENDED],o),this.disposeActions.push((()=>this.vkComPlayer.off(this,[i.events.STOP,i.events.ENDED],o)));const r=(e,t)=>{if(!e||"number"!=typeof t)return;this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===c(e)||(this.state.currentTrackEntity=l(e,t)),"stopped"===this.state.status&&t&&(this.state.status="paused");const s={...this.state},i=s.currentTrackEntity;this.updateState({...s,currentTrackEntity:{...i,audioTrack:{...i.audioTrack,progress:t||0}}})};this.vkComPlayer.on(this,i.events.PROGRESS,r),this.disposeActions.push((()=>this.vkComPlayer.off(this,i.events.PROGRESS,r)))}}},689460:(e,t,s)=>{"use strict";s.d(t,{ProxyStorage:()=>n});var i=s(534053),a=s(250682);class n{dispose(){this.storage.dispose()}constructor(e,t){this.identify=e=>{this.storage.identify(e)},this.get=e=>"settings-sound-notifications-on"===e?!a.ls.get("sound_notify_off"):this.storage.get(e),this.set=(e,t)=>{"settings-sound-notifications-on"!==e?this.storage.set(e,t):a.ls.set("sound_notify_off",Number(!t))},this.del=e=>{"settings-sound-notifications-on"!==e?this.storage.del(e):a.ls.remove("sound_notify_off")},this.getIDB=async e=>this.storage.getIDB(e),this.setIDB=async(e,t)=>{this.storage.setIDB(e,t)},this.updateIDB=async(e,t)=>{this.storage.updateIDB(e,t)},this.delIDB=async e=>{this.storage.delIDB(e)},this.storage=new i.Storage(e,t),this.dbName=e}}},585030:(e,t,s)=>{"use strict";s.d(t,{SharedEngine:()=>o});var i=s(417076),a=s(476726);const n="switch to slave";class o{dispose(){this.engine.dispose(),this.broadcastChannel&&(this.broadcastChannel.onmessage=null,this.broadcastChannel.close())}constructor(e,t){this.logger=e,this.isMaster=t,this.masterRequestAbortController=null,this.queued={kind:"Buffer",buffer:[]},this.ts=0,this.pts=0,this.connect=e=>(this.ts=e.ts,this.pts=e.pts,this.engine.connect(e)),this.disconnect=()=>{this.engine.disconnect()},this.poll=()=>this.engine.poll(),this.isConnected=()=>this.engine.isConnected(),this.switch=e=>{if(this.broadcast)switch(this.logger.info("[SHARED ENGINE] switch to",e),e){case"master":if(this.isMaster)return;switch(this.queued.kind){case"Callback":this.queued.cancel();break;case"Buffer":this.queued.buffer=[]}return void(this.isMaster=!0);case"slave":if(!this.isMaster)return;return(0,a.partConfigEnabled)("me_shared_engine_duplicate_events_fix")&&this.masterRequestAbortController?.abort(n),void(this.isMaster=!1)}},this.fetch=(e,t,s)=>Promise.resolve().then((()=>{if(!this.isMaster)return this.fetchSlave(s);return t.ts>this.ts?Promise.resolve({failed:1}):this.fetchMaster(e,t,s)})).then((e=>("ts"in e&&(this.ts=e.ts,this.pts=e.pts),e))),this.fetchMaster=(e,t,s)=>{const i=new Headers;i.append("Connection","keep-alive"),i.append("Content-Type","application/x-www-form-urlencoded");const a=Object.keys(t).reduce(((e,s)=>(void 0!==t[s]&&e.append(s,t[s]),e)),new URLSearchParams),o=new AbortController;this.masterRequestAbortController=o;const r=()=>o.abort(s.reason);return s.addEventListener("abort",r),fetch(e,{method:"POST",signal:o.signal,headers:i,body:a}).then((e=>{if(!e.ok)throw new Error(`ServerError ${e.status}`);return e.json()})).then((e=>{const t=this.ts;return this.logger.info("[SHARED ENGINE] from engine",{tsOld:t,data:e}),this.broadcast&&this.broadcast({type:"updates",payload:{tsOld:t,data:e}}),e})).catch((e=>{if(o.signal.aborted&&o.signal.reason===n)return{ts:this.ts,pts:this.pts,updates:[]};throw e})).finally((()=>{s.removeEventListener("abort",r),this.masterRequestAbortController=null}))},this.fetchSlave=e=>{if("Callback"===this.queued.kind)return Promise.reject(new Error("vkcom engine slave double fetch error"));const t=this.queued.buffer.shift(),s=t?Promise.resolve(t):new Promise(((t,s)=>{const i=()=>{this.queued={kind:"Buffer",buffer:[]},s(new DOMException(e.reason,"AbortError"))};e.addEventListener("abort",i),this.queued={kind:"Callback",push:s=>{e.removeEventListener("abort",i),this.queued={kind:"Buffer",buffer:[]},t(s)},cancel:()=>{e.removeEventListener("abort",i),this.queued={kind:"Buffer",buffer:[]},t({tsOld:this.ts,data:{ts:this.ts,pts:this.pts,updates:[]}})}}}));return s.then((e=>e.tsOld>this.ts?(this.queued={kind:"Buffer",buffer:[]},Promise.resolve({failed:1})):(0,a.partConfigEnabled)("me_shared_engine_duplicate_events_fix")&&e.tsOld<this.ts&&"updates"in e.data?e.data.ts<=this.ts?{ts:this.ts,pts:this.pts,updates:[]}:{failed:1}:e.data))},this.engine=new i.Engine(this.logger,((...e)=>this.fetch(...e))),this.version=this.engine.version,void 0!==window.BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("messenger-shared-engine"),this.broadcast=e=>this.broadcastChannel?.postMessage(e),this.broadcastChannel.onmessage=e=>{if("updates"===e.data.type){const t=e.data.payload;if(this.isMaster)return;if(this.logger.info("[SHARED ENGINE] broadcast received",t),!this.isConnected())return;return"Callback"===this.queued.kind?void this.queued.push(t):void this.queued.buffer.push(t)}this.logger.error("[SHARED ENGINE] Неизвестный бродкаст")})}}},425981:(e,t,s)=>{"use strict";s.d(t,{SharedQueue:()=>i});class i{connect(){if(this.isDisposed)return;if(this.isConnected())return;this.queued=this.empty();const e=window.Notifier.getEventQueueInstance();this.unsubscribe=e.subscribe((e=>{const t={kind:"Batch",ts:"1",events:[e]};if("Callback"===this.queued.kind){const e=this.queued.resolve;return this.queued=this.empty(),void e(t)}if(this.queued.buffer.length>=this.MAX_BUFFER_SIZE)return this.unsubscribe&&this.unsubscribe(),this.unsubscribe=null,void this.queued.buffer.push({kind:"Disconnected",reason:"backpressure"});this.queued.buffer.push(t)}))}dispose(){this.disconnect(),this.isDisposed=!0}constructor(){this.isDisposed=!1,this.MAX_BUFFER_SIZE=50,this.unsubscribe=null,this.empty=()=>({kind:"Buffer",buffer:[]}),this.poll=()=>{if("Callback"===this.queued.kind)return this.queued.reject("Queue.poll вызван дважды!"),new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}}));const e=this.queued.buffer.shift();if(e)return Promise.resolve(e);if(!this.isConnected())throw new Error("Queue.connect еще не был вызван!");return new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}}))},this.disconnect=()=>{switch(this.unsubscribe&&this.unsubscribe(),this.unsubscribe=null,this.queued.kind){case"Callback":this.queued.resolve({kind:"Disconnected",reason:"manual"}),this.queued=this.empty();break;case"Buffer":this.queued.buffer.push({kind:"Disconnected",reason:"manual"});break;default:this.queued}},this.isConnected=()=>!!this.unsubscribe,this.queued=this.empty()}}},780534:(e,t,s)=>{"use strict";s.d(t,{Stats:()=>d});var i=s(947291),a=s(499827),n=s(250983),o=s(428379),r=s(465094),l=s(354632),c=s(141229);class d{dispose(){}constructor(e){this.init=()=>{},this.trackExternalEvent=e=>{if("message_sent"===e.type)(0,c.tmrSendTimespentEvent)(c.MY_TRACKER_COUNT_EVENT_IDS.MESSAGE_SEND);else(0,l.exhaustivenessCheck)(e.type)},this.logEvent=e=>{if("type_im_messaging_performance_metric"===e.type)this.messengerStats.logEvent(e);else!function(e){switch(e.type){case"type_action":{const t=e.type_action;switch(t.type){case"type_ab_custom_metrics_item":i.customMetricsCollector.logEvent(t.type_ab_custom_metrics_item);break;case"type_messaging_action_item":a.messagingActionItemStatCollector.logEvent(t.type_messaging_action_item);break;case"type_messaging_audio_message_item":n.audioMessageStatCollector.logEvent(t.type_messaging_audio_message_item);break;case"type_settings_changes_item":o.settingsChangesStatCollector.logEvent(t.type_settings_changes_item)}break}case"type_navgo":{const t=e.type_navgo;r.navigationStat.logEvent(t);break}}}(e)},this.messengerStats=e}}},102104:(e,t,s)=>{"use strict";s.d(t,{Settings:()=>U});var i=s(474848),a=s(907560),n=s(90604),o=s(73514),r=s(398743),l=s(193496),c=s(513364),d=s(892496),u=s(170759),_=s(71883),g=s(249824),m=s(344107),p=s(349333),h=s(743207),f=s(544432),v=s(720461),b=s(694871),y=s(717153),w=s(689460),E=s(174753),C=s(201938),S=s(425981),T=s(585030),I=s(780534),k=s(236275),M=s(440961),P=s(273414),A=s(583652),L=s(496486),R=s(610989),x=s(354632),D=s(958145),O=s(803898),B=s(705744),N=s(505954);const F=({onClose:e,store:t,browserEnv:s})=>(0,i.jsx)(N.AppRootProvider,{children:(0,i.jsxs)(A.BaseModal,{onClose:e,children:[(0,i.jsx)(L.ModalHeader,{title:R.getLang("mail_im_settings_header"),onClose:e}),(0,i.jsx)(P.ModalBody,{hasScroll:!1,children:(0,i.jsx)("div",{style:{width:"560px",margin:"0 -25px",padding:"4px 20px"},children:(0,i.jsx)(a.SettingsApp,{store:t,env:s,set:new Set(["ctrSubmit","soundNotifications","showRecommendations","countOnlyNotMuted","autoUnarchive","transcriptAutoShow"])})})})]})});class U{renderSettingsPopup(e,t){const s=U.getContainer(),a=()=>this.hide();s&&M.render((0,i.jsx)(F,{onClose:a,store:e,browserEnv:t}),s)}static getContainer(){return document.querySelector("#MessengerSettings")}getContext(){if(window.reforgedME?.settingsContext)return window.reforgedME.settingsContext;if(this.ownContext)return this.ownContext;(0,n.initConfig)();const e=(0,B.getHostName)(),t=window.vk.id,s=(0,x.createFeatureFlags)(),i=new v.Api(t),a=new y.Logger,p=new w.ProxyStorage(o.STORAGE_DB_NAME,a),h=new T.SharedEngine(a,(0,x.isMasterTab)()),M=new r.Stats(s,(async e=>{const t=await i.fetch("statEvents.addWeb",{events:JSON.stringify(e)});t.failed_ids.length&&console.error(`[Stats]: Неправильный формат отправки статистики. failed_ids: ${t.failed_ids}`)}),p),P=new I.Stats(M),A=(0,x.createLang)(a),L={stack:new l.Stack,dispose:()=>{}},R=new c.Uploader(i,s),D=new d.MEAppMediaMediator,O=new f.FCPlayer(D),N=new f.FCVoicePlayer(D),F=new u.MEAppRecorder({},D,a),U=new x.VkComRouter(!1,s,e),H=new b.Idle(a),j={vkDomain:e,api:i,lang:A,logger:a,storage:p,player:O,voicePlayer:N,videoMessagePlayer:new _.MEAppVideoMessagePlayer(D),browserNotifications:new E.BrowserNotifications,externalEvents:new g.ExternalEvents,idle:H,stats:P,geoLocation:new k.GeoLocation,botKeyboard:{update:()=>{},subscribe:()=>()=>{},openApp:()=>{},openLink:()=>{},openSnackbar:()=>{},addEventId:()=>{},dispose:()=>{}},modals:L,router:U,uploader:R,voiceRecorder:F,isEduAvailable:!1},V={api:i,engine:h,queue:new S.SharedQueue,logger:a,storage:p,stats:P,notification:new C.Notification(H,1e3,"/mp3/bb2.mp3")},q=(0,m.createStore)(V,s,void 0,t);return q.start(),this.ownContext={store:q,browserEnv:j},this.ownContext}hide(){if(!this.isMounted)return;const e=U.getContainer();e&&M.unmountComponentAtNode(e),this.unsubscribe(),this.isMounted=!1}show(){const{store:e,browserEnv:t}=this.getContext();let s=e.getState().viewer.settings;this.unsubscribe=e.subscribe((e=>{const t=e.viewer.settings;s.ctrSubmit!==t.ctrSubmit&&(window.cur.ctrl_submit=t.ctrSubmit,this.imStore.set((e=>(0,p.setLocalSettingsValue)("ctrl_submit",Number(t.ctrSubmit),e)))),s.showRecommendations!==t.showRecommendations&&this.imStore.set((e=>(0,p.setLocalSettingsValue)("messages_recommendation_list_hidden",Number(!t.showRecommendations),e))).finally((()=>{if(!t.showRecommendations)return void this.imPageMutations().setRecommendationListVisibility(!1);this.imPageMutations().setRecommendationListVisibility(!0)||(this.hide(),window.nav.reload())})),s.countOnlyNotMuted!==t.countOnlyNotMuted&&this.imStore.set((e=>(0,p.setLocalSettingsValue)("show_only_not_muted_messages",Number(t.countOnlyNotMuted),e))).then((e=>{(0,h.updateUnreadCounter)(e)})),s.transcriptAutoShow!==t.transcriptAutoShow&&this.imStore.set((e=>(0,p.setLocalSettingsValue)("transcript_auto_show",Number(t.transcriptAutoShow),e))).then((()=>(0,O.pause)(.25))).then((()=>this.imStore.get().longpoll?.push([(0,D.changeVoiceTranscriptUI)()]))),s=e.viewer.settings})),this.renderSettingsPopup(e,t),this.isMounted=!0}constructor(e,t){this.isMounted=!1,this.imStore=e,this.imPageMutations=t}}},170482:(e,t,s)=>{"use strict";s.d(t,{prepareEmptyDialogStickersTemplate:()=>b,renderHistoryStub:()=>v});var i=s(240069),a=s(52554),n=s(879007),o=s(476726),r=s(177157),l=s(645024),c=s(596281),d=s(120862),u=s(622818),_=s(111871),g=s(531868),m=s(635903),p=s(452256),h=s(388078),f=s(391565);function v(e){const t=(0,a.getPeer)(e),s=h.Ranges.isContactId(t),i=t&&(0,g.getTab)(e,t),p=(0,r.getEmptyScreenUserInfo)(e,t);if(i&&(0,g.isCasperChatTab)(i))return(0,n.getTemplate)("sImEmptyCasper",{mail_im_empty_casper_chat:l.getLang("mail_im_empty_casper_chat")});const f=s||(0,g.isUserEmptyScreenRich)(e,t)&&p&&0!==p?.canWrite;if(!i||!(0,o.partConfigEnabled)("messages_new_empty_dialog_screen")||!f)return l.getLang("mail_im_here_history");const v=s?(0,m.prepareContactName)(i.tab):(0,n.stripHTML)(i.tab),y=s?(0,m.prepareContactName)(i.name):i.name,w=i.contact_name,E=s?l.getLang("mail_empty_history_with_contact").replace("{user_name}",y):(0,l.langSex)(i.sex,l.getLang("mail_empty_history_with_user","raw")).replace("{user_name}",y),C=w?(0,l.langSex)(i.sex,l.getLang("mail_saved_in_contacts_as","raw")).replace("{contact_name}",w):"";let S="";S=i.is_nft_photo&&i.photo?(0,n.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:i.photo,size:80}):i.photo?`<img src="${i.photo}" alt="${y}">`:(0,n.getTemplate)("sImContactAvatar",{name:(0,m.getUserInitials)(y),size:80,classes:""});const T=i.is_subscribed,I=T?"sImEmptyDialogStubUnsubscribeButton":"sImEmptyDialogStubSubscribeButton",k=(()=>{const e=i.is_subscribe_button;return e&&!T?l.getLang("mail_follow_to_friend"):e&&T?l.getLang("mail_you_are_following"):T?l.getLang("mail_friend_request_sent"):l.getLang("mail_add_to_friends")})(),M=s||i.is_friend?"":(0,n.getTemplate)(I,{button_text:k}),[P,A]=p?function(e){if(e.occupation){const{icon:t}="work"===e.occupationType?(0,c.getIcon20WorkOutline)():(0,d.getIcon20EducationOutline)();return[e.occupation,t]}if(e.bdate){const{icon:t}=(0,u.getIcon20CakeOutline)(),[s,i]=e.bdate.split("."),a=new Date;a.setDate(+s),a.setMonth(+i-1);return[(0,l.langDate)(a.getTime(),l.getLang("mail_birthday_day_month","raw"),0,l.getLang("months_of","raw"),!0),t]}if(e.city){const{icon:t}=(0,_.getIcon20HomeOutline)();return[e.city,t]}return["",""]}(p):["",""],L=p?.mutualFriends.length?function(e){const t=e.mutualFriends.map((e=>(0,n.getTemplate)("sImEmptyDialogStubMutualFriend",{name:e.name,src:e.photo}))).join("");return(0,n.getTemplate)("sImEmptyDialogStubMutualFriends",{friends:t,text:(0,l.langNumeric)(e.commonCount||0,l.getLang("mail_mutual_friends_count","raw"))})}(p):"",R=s?"":(0,n.getTemplate)("sImEmptyDialogStubUserInfo",{profile_href:i.href,subscribe_button:M,additional_info:P,additional_icon:A,mutual_friends:L,mail_view_profile:l.getLang("mail_view_profile")});return`${(0,n.getTemplate)("sImEmptyDialogStub",{avatar:S,name:v,stub_text:E,secondary_block:R,saved_as:C,classes:(0,a.isClassicInterface)(e)?"EmptyDialogStub--classic":""})}${b(e)}`}function b(e){const t=(0,a.getPeer)(e),s=(0,g.getTab)(e,t),o=(0,a.getEmojiOptId)(e);if(!s)return"";const r=s.is_new,l=window.stickersKeywords?.["привет"]||[],c=new Map;if(l.reduce(((e,t)=>{const{packId:s,sticker:i}=window.Emoji.stickersById?.[t]||{};return t<0||!i?e:e.set(t,[t,256,"",i[3],s,i[7]])}),c),r){(window.Emoji.stickers[i.Emoji.TAB_NEW_CONVO_STICKERS]?.stickers||[]).reduce(((e,t)=>{const s=t[0],{packId:i}=window.Emoji.stickersById?.[s]||{packId:0};return e.set(s,[s,256,"",t?.[3],i,t?.[7]])}),c)}const d=[...c.values()].reduce(((e,t)=>{const[s,,,i,a,r]=t,l=r?.length,c={sticker_id:s,sticker_url:p.Stickers.getStickerUrl(s,((0,n.isRetina)()?256:128)+"b"),animation_url:i,set_id:a||0,opt_id:o,layers:l?JSON.stringify(r).replace(/"/g,"'"):"",icon:l?f.POPUP_STICKER_ICON:""};let d="sImEmptyDialogSticker";return r?.length?d="sImEmptyDialogPopupSticker":i&&(d="sImEmptyDialogAnimatedSticker"),`${e}${(0,n.getTemplate)(d,c)}`}),"");if(!d)return"";const u=(0,n.getTemplate)("sImCarousel",{content:d,controls_class:"",scroll_count:"3"});return(0,n.getTemplate)("sImEmptyDialogStickers",{content:u})}},256756:(e,t,s)=>{"use strict";s.d(t,{updateFolderCounters:()=>r});var i=s(485413),a=s(822317),n=s(885635);const o=[a.ConvoListFolder.MR,a.ConvoListFolder.BUSINESS_NOTIFY,a.ConvoListFolder.ARCHIVE];function r(e){const t=(0,i.unpackStore)(e);o.forEach((e=>{const s=(0,n.getFolderUnreadCount)(t,e),i=document.querySelector(`._im_right_menu_counter[data-tab="${e}"]`);i&&(i.innerHTML=s,i.closest(".ui_rmenu_item")?.classList?.toggle("ui_rmenu_item_hidden",(0,n.isConvoListFolderHidden)(t,e)))}));const s=(0,n.getFolderMentionsCount)(t,a.ConvoListFolder.ARCHIVE),r=document.querySelector(`._im_right_menu_mentions[data-tab="${a.ConvoListFolder.ARCHIVE}"]`);r&&(r.dataset.mentions=s)}},891379:(e,t,s)=>{"use strict";function i(){window.cur.videoAutoplayScrollHandler&&window.cur.videoAutoplayScrollHandler()}s.d(t,{videoAutoPlayHandler:()=>i})},28432:(e,t,s)=>{"use strict";s.d(t,{createLongpoll:()=>c});var i=s(753158),a=s(592696),n=s(49071),o=s(948350),r=s(490712),l=s(388078);function c(e,t){return(0,i.createLongpollConnect)(e,{onEvents:t,onData:g,onRequestError:m,onHistoryLost:p,onKeyExpired:h,onLpBroken:f})}const d=3e4;let u={},_=Date.now();function g(e,t){if(!t||!t.status||!e.lpstat)return;const s=t.status.toString();t.status>=500&&t.status<600&&(0,r.statlogsValueEvent)("fc_longpoll",1,s,t.getResponseHeader("x-frontend")||""),u[s]=s in u?u[s]+1:1,Date.now()-_>=d&&(Object.keys(u).forEach((e=>{(0,r.statlogsValueEvent)("fc_longpoll",u[e],e,t.getResponseHeader("x-frontend")||"")})),u={},_=Date.now())}function m(e){(0,a.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function p(e,t){(0,a.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function h(e){return(0,a.lpLogFc)("red","LP failed: key is incorrect; refresh key"),(0,n.post)(o.CONTROLLER,{act:"a_get_key",uid:e.id,gid:l.Ranges.isGroupId(e.id)?l.Ranges.convertGroupIdToOwnerId(e.id):0},1e3)}function f(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},592696:(e,t,s)=>{"use strict";function i(e,t,...s){if(!window.vk.lpConfig.debug)return;const i=`background: ${e}; color: white`,a=new Date,n=e=>e<10?"0"+e.toString():e.toString();console.log(`%c ${a.getHours()}:${n(a.getMinutes())}:${n(a.getSeconds())}:${a.getMilliseconds()} ${t} `,i,...s)}function a(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function n(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function o(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function r(){o()&&(n().forEach((e=>{!a().find((t=>e.ev===t.ev))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,i("red","im not fc",e.ev))})),a().forEach((e=>{const t=n().find((t=>t.ev===e.ev));t&&t.warned&&!e.warned&&(e.warned=!0,i("red","now fc like im",e.ev))}))),function(){const e=Date.now()-3e4;window.lpBufferFc=a().filter((t=>t.time>e)),window.lpBufferIm=n().filter((t=>t.time>e))}()}function l(e){o()&&(a().push(...e.map((e=>({time:Date.now(),ev:JSON.stringify(e),warned:!1})))),setTimeout(r,0)),i("green","fc",...e)}s.d(t,{longpollTestingOnFcEvents:()=>l,lpLogFc:()=>i}),window.longpollTestingOnImEvents=function(e){o()&&(n().push(...e.map((e=>({time:Date.now(),ev:JSON.stringify(e),warned:!1})))),setTimeout(r,1100)),i("blue","im",...e)}},634438:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});const i=()=>{let e=[];onmessage=t=>{"encode"===t.data[0]?function(t){let s=t.length,i=new Uint8Array(2*s);for(let e=0;e<s;e++){let s=2*e,a=t[e];a>1?a=1:a<-1&&(a=-1),a*=32768,i[s]=a,i[s+1]=a>>8}e.push(i)}(t.data[1]):"dump"===t.data[0]&&function(t){let s=e.length?e[0].length:0,i=e.length*s,a=new Uint8Array(44+i),n=new DataView(a.buffer);n.setUint32(0,1380533830,!1),n.setUint32(4,36+i,!0),n.setUint32(8,1463899717,!1),n.setUint32(12,1718449184,!1),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,t,!0),n.setUint32(28,2*t,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),n.setUint32(36,1684108385,!1),n.setUint32(40,i,!0);for(let t=0;t<e.length;t++)a.set(e[t],t*s+44);e=[],postMessage(a.buffer,[a.buffer])}(t.data[1])}}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(s.exports,s,s.exports,__webpack_require__),s.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,s,i)=>{if(!t){var a=1/0;for(l=0;l<deferred.length;l++){for(var[t,s,i]=deferred[l],n=!0,o=0;o<t.length;o++)(!1&i||a>=i)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[o])))?t.splice(o--,1):(n=!1,i<a&&(a=i));if(n){deferred.splice(l--,1);var r=s();void 0!==r&&(e=r)}}return e}i=i||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>i;l--)deferred[l]=deferred[l-1];deferred[l]=[t,s,i]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var s=Object.create(null);__webpack_require__.r(s);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var a=2&t&&e;"object"==typeof a&&!~leafPrototypes.indexOf(a);a=getProto(a))Object.getOwnPropertyNames(a).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,__webpack_require__.d(s,i),s},__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,s)=>(__webpack_require__.f[s](e,t),t)),[])),__webpack_require__.u=e=>45458===e?"web/chunks/hls.c49a3f53.js":56229===e?"web/chunks/366130d1.async.1c06797d.js":30072===e?"web/chunks/showCaptchaPopup.a4740a52.js":19072===e?"web/chunks/left_menu_store.b41d694b.js":42255===e?"web/chunks/wikiModalExampleInitiator.bf570c13.js":56965===e?"web/chunks/stories_web_lib.ba126e07.js":17213===e?"web/chunks/2bd60279.async.ea157d31.js":42943===e?"web/chunks/video_web_lib.782f771d.js":53927===e?"web/chunks/questions_boxes_web.d05c4563.js":40482===e?"web/chunks/0ca8e07a.async.981f6895.js":12679===e?"web/chunks/2c4420c0.async.0fa14a60.js":40617===e?"web/chunks/93bd35f8.async.944fc663.js":27602===e?"web/chunks/2fea6d3f.async.fa8b17c6.js":24535===e?"web/chunks/4e9ddeeb.async.0371d26b.js":74336===e?"web/chunks/show_audio_playlist.c4ee742f.js":93033===e?"web/chunks/a6f550f7.async.84ccbfa1.js":89870===e?"web/chunks/5ad2d924.async.2e93ba52.js":17895===e?"web/chunks/money_transfer_box.50183b92.js":50905===e?"web/chunks/money_transfer.e2c2d345.js":21608===e?"web/chunks/bf8fbce1.async.1f467086.js":66118===e?"web/chunks/6fb21264.async.74f2b319.js":36237===e?"web/chunks/2fb8e07d.async.2c799e4e.js":56154===e?"web/chunks/cc6f5392.async.8d8a5bcd.js":58292===e?"web/chunks/437a8ce6.async.378b5454.js":49925===e?"web/chunks/8af15a4d.async.5eadc2fd.js":68349===e?"web/chunks/5f266f5f.async.3ed461f1.js":25459===e?"web/chunks/2c9432b5.async.06e9b990.js":84835===e?"web/chunks/unauth_action_box.29aa267e.js":23045===e?"web/chunks/0d674423.async.5458427b.js":71247===e?"web/chunks/364659da.async.59a0e75a.js":59886===e?"web/chunks/StoryPublisherV2.2ad86f85.js":70989===e?"web/chunks/4b497ab9.async.e13543c1.js":29311===e?"web/chunks/feed-client-nav-skeleton.774b8a5c.js":56091===e?"web/chunks/feed-client-nav-async-right-block.323099af.js":1715===e?"web/chunks/AudioLongtapModal.d6e38506.js":96649===e?"web/chunks/ecomm_market_product_attach.e1343ea9.js":51713===e?"web/chunks/voice_message_player.172315d5.js":9925===e?"web/chunks/speech.257a7e64.js":99595===e?"web/chunks/ReportForm.ee85cb0b.js":73248===e?"web/chunks/5792d39d.async.ad94820b.js":42099===e?"web/chunks/58131fc9.async.2e7c43e3.js":51943===e?"web/chunks/VideoUpload.8e2a8bde.js":73214===e?"web/chunks/SilentModeForms.c8c406fe.js":6694===e?"web/chunks/menu_settings.f0cec8c6.js":69706===e?"web/chunks/e0383668.async.b99eb451.js":23666===e?"web/chunks/rlottie.a7019eea.js":82915===e?"web/chunks/MarketItemsCarousel.778ac795.js":98875===e?"web/chunks/027f56ea.async.9c2d9378.js":43802===e?"web/chunks/d5b01a55.async.6a0ae0bd.js":59956===e?"web/chunks/463a83c5.async.fb5925ed.js":60648===e?"web/chunks/9c7a90fd.async.29f1c0c3.js":36502===e?"web/chunks/NewStickerPicker.2b684d9a.js":65437===e?"web/chunks/06f378a9.async.f54ff907.js":52731===e?"web/chunks/stickers-layer-view.8b6ecd29.js":16846===e?"web/chunks/stickers-layer-purchase-details-view.79416845.js":64273===e?"web/chunks/stickers-random-selector-view.7604d0a6.js":12318===e?"web/chunks/stickers-random-selector-packs-view.18dd3b30.js":71409===e?"web/chunks/stickers-random-selector-result-view.c13970f4.js":52007===e?"web/chunks/gift-modal-legacy.7fe8577b.js":64695===e?"web/chunks/e9ea6e09.async.8b6d2dfe.js":7894===e?"web/chunks/StickersKit-AgeRestrictionModal.a627c8ef.js":85128===e?"web/chunks/"+e+".f913690c.js":42734===e?"web/chunks/marusia-fc-sdk.56ddcbf8.js":10504===e?"web/chunks/StoriesCreatorVKApp.f31236ac.js":54833===e?"web/chunks/performance-stats.99d41d48.js":57088===e?"web/chunks/79f739a7.async.7b7d443d.js":32643===e?"web/chunks/story_blocks.0da84ca4.js":13410===e?"web/chunks/283c0b16.async.33f5912b.js":17448===e?"web/chunks/b1bc3b17.async.86dcbc32.js":99370===e?"web/chunks/VideoEditorModal.cd800b6f.js":95805===e?"web/chunks/PublishClipToVideoModal.fb197348.js":91906===e?"web/chunks/VideoUploadModal.07557685.js":74205===e?"web/chunks/VideoExternalUploadModal.15030051.js":36637===e?"web/chunks/ClipUploadModal.bb853a52.js":18493===e?"web/chunks/AddClipToVideoBlock.d29cc984.js":40953===e?"web/chunks/AddClipToVideoModal.6f004f3e.js":60274===e?"web/chunks/ClipPlayerModule.600f713b.js":60899===e?"chunks/"+e+".0471a2c1.js":40074===e?"chunks/"+e+".4d8e0cba.js":37557===e?"chunks/"+e+".46b5840d.js":29290===e?"chunks/"+e+".b54ef2c0.js":{17356:"web/chunks/videoplayer-interactive",57407:"web/chunks/shopify"}[e]+"."+{17356:"95a5926a",57407:"78df6599"}[e]+".js",__webpack_require__.miniCssF=e=>30072===e?"web/chunks/eba149c1.css":{74336:1,17895:1,50905:1}[e]?"web/chunks/43d06ff5.css":59886===e?"web/chunks/c3646f82.css":1715===e?"web/chunks/4aa73755.css":96649===e?"web/chunks/8272fe04.css":99595===e?"web/chunks/fb872de1.css":51943===e?"web/chunks/443c0dba.css":73214===e?"web/chunks/122e7a6e.css":6694===e?"web/chunks/c08e1f96.css":23666===e?"web/chunks/68f9f3a8.css":82915===e?"web/chunks/c44fecda.css":36502===e?"web/chunks/69f2cbe9.css":52731===e?"web/chunks/0972225c.css":16846===e?"web/chunks/3318c635.css":64273===e?"web/chunks/d57562b6.css":12318===e?"web/chunks/0ef038a3.css":71409===e?"web/chunks/d2224ca1.css":7894===e?"web/chunks/5ea70f5a.css":10504===e?"web/chunks/8a71df77.css":32643===e?"web/chunks/1deee1aa.css":99370===e?"web/chunks/aa88a2a7.css":95805===e?"web/chunks/70c35bc4.css":{91906:1,74205:1,36637:1}[e]?"web/chunks/f89919fd.css":18493===e?"web/chunks/85bd25a0.css":40953===e?"web/chunks/d66415b4.css":60274===e?"web/chunks/a9cca8ef.css":void 0,__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,s,i)=>{if(inProgress[e])inProgress[e].push(t);else{var a,n;if(void 0!==s)for(var o=document.getElementsByTagName("script"),r=0;r<o.length;r++){var l=o[r];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")=="vk:"+s){a=l;break}}a||(n=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,__webpack_require__.nc&&a.setAttribute("nonce",__webpack_require__.nc),a.setAttribute("data-webpack","vk:"+s),a.src=e),inProgress[e]=[t];var c=(t,s)=>{a.onerror=a.onload=null,clearTimeout(d);var i=inProgress[e];if(delete inProgress[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(s))),t)return t(s)},d=setTimeout(c.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=c.bind(null,a.onerror),a.onload=c.bind(null,a.onload),n&&document.head.appendChild(a)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",loadStylesheet=e=>new Promise(((t,s)=>{var i=__webpack_require__.miniCssF(e),a=__webpack_require__.p+i;if(((e,t)=>{for(var s=document.getElementsByTagName("link"),i=0;i<s.length;i++){var a=(o=s[i]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(a===e||a===t))return o}var n=document.getElementsByTagName("style");for(i=0;i<n.length;i++){var o;if((a=(o=n[i]).getAttribute("data-href"))===e||a===t)return o}})(i,a))return t();((e,t,s,i)=>{var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.onerror=a.onload=n=>{if(a.onerror=a.onload=null,"load"===n.type)s();else{var o=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=r,a.parentNode.removeChild(a),i(l)}},a.href=t,document.head.appendChild(a)})(e,a,t,s)})),installedCssChunks={7778:0},__webpack_require__.f.miniCss=(e,t)=>{installedCssChunks[e]?t.push(installedCssChunks[e]):0!==installedCssChunks[e]&&{1715:1,6694:1,7894:1,10504:1,12318:1,16846:1,17895:1,18493:1,23666:1,30072:1,32643:1,36502:1,36637:1,40953:1,50905:1,51943:1,52731:1,59886:1,60274:1,64273:1,71409:1,73214:1,74205:1,74336:1,82915:1,91906:1,95805:1,96649:1,99370:1,99595:1}[e]&&t.push(installedCssChunks[e]=loadStylesheet(e).then((()=>{installedCssChunks[e]=0}),(t=>{throw delete installedCssChunks[e],t})))},(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={7778:0};__webpack_require__.f.j=(t,s)=>{var i=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var a=new Promise(((s,a)=>i=e[t]=[s,a]));s.push(i[2]=a);var n=__webpack_require__.p+__webpack_require__.u(t),o=new Error;__webpack_require__.l(n,(s=>{if(__webpack_require__.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+n+")",o.name="ChunkLoadError",o.type=a,o.request=n,i[1](o)}}),"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,s)=>{var i,a,[n,o,r]=s,l=0;if(n.some((t=>0!==e[t]))){for(i in o)__webpack_require__.o(o,i)&&(__webpack_require__.m[i]=o[i]);if(r)var c=r(__webpack_require__)}for(t&&t(s);l<n.length;l++)a=n[l],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return __webpack_require__.O(c)},s=self.webpackChunkvkweb=self.webpackChunkvkweb||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var __webpack_exports__=__webpack_require__.O(void 0,[91498,50560,89631,85172,762,21529,79210,99364,35623,81765,23592,25304,73085,18373,60683,17430,61717,18887,12042,57656,15133,72672,19996,1934,94573,83259,52391],(()=>__webpack_require__(250971)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();