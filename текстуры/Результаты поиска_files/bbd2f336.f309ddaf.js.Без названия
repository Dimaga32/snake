"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[52391],{426622:(e,t,a)=>{a.d(t,{IconIllustrationSoundWaveLeft36h:()=>n});var n=(0,a(844990).makeIcon)("IconIllustrationSoundWaveLeft36h","illustration_sound_wave_left_36h","0 0 72 36",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 72 36" id="illustration_sound_wave_left_36h"><path d="M59.693 5.25a1.25 1.25 0 0 0-2.5 0v25.788a1.25 1.25 0 1 0 2.5 0zm-8.595 6.446a1.25 1.25 0 0 0-2.5 0V24.59a1.25 1.25 0 0 0 2.5 0zm15.942-1.25c.69 0 1.25.56 1.25 1.25V24.59a1.25 1.25 0 0 1-2.5 0V11.696c0-.69.56-1.25 1.25-1.25M42.5 14.275a1.25 1.25 0 0 0-2.5 0v7.737a1.25 1.25 0 0 0 2.5 0zM23.693 5.25a1.25 1.25 0 0 0-2.5 0v25.788a1.25 1.25 0 1 0 2.5 0zm-8.595 6.446a1.25 1.25 0 0 0-2.5 0V24.59a1.25 1.25 0 0 0 2.5 0zm15.942-1.25c.69 0 1.25.56 1.25 1.25V24.59a1.25 1.25 0 0 1-2.5 0V11.696c0-.69.56-1.25 1.25-1.25M6.5 14.275a1.25 1.25 0 0 0-2.5 0v7.737a1.25 1.25 0 0 0 2.5 0z" /></symbol>',72,36,!1,void 0)},155581:(e,t,a)=>{a.d(t,{IconIllustrationSoundWaveRight36h:()=>n});var n=(0,a(844990).makeIcon)("IconIllustrationSoundWaveRight36h","illustration_sound_wave_right_36h","0 0 72 36",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 72 36" id="illustration_sound_wave_right_36h"><path d="M12.307 5.25a1.25 1.25 0 0 1 2.5 0v25.788a1.25 1.25 0 1 1-2.5 0zm8.595 6.446a1.25 1.25 0 0 1 2.5 0V24.59a1.25 1.25 0 0 1-2.5 0zM4.96 10.446c-.69 0-1.25.56-1.25 1.25V24.59a1.25 1.25 0 0 0 2.5 0V11.696c0-.69-.56-1.25-1.25-1.25m24.54 3.829a1.25 1.25 0 0 1 2.5 0v7.737a1.25 1.25 0 0 1-2.5 0zM48.307 5.25a1.25 1.25 0 0 1 2.5 0v25.788a1.25 1.25 0 1 1-2.5 0zm8.595 6.446a1.25 1.25 0 0 1 2.5 0V24.59a1.25 1.25 0 0 1-2.5 0zm-15.942-1.25c-.69 0-1.25.56-1.25 1.25V24.59a1.25 1.25 0 0 0 2.5 0V11.696c0-.69-.56-1.25-1.25-1.25m24.54 3.829a1.25 1.25 0 0 1 2.5 0v7.737a1.25 1.25 0 0 1-2.5 0z" /></symbol>',72,36,!1,void 0)},423676:(e,t,a)=>{a.d(t,{VkIndexer:()=>n});var n=function(){function e(e,t,a){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=a||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var a=this.list[t];try{a._order=t}catch(e){}this.add(a)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,a={},n=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(a=t)?1:parseInt(a)||0)>=32?String.fromCharCode(t):e;var a})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),o=n.length;o--;){var s=n[o],r="";if(s){for(var i=0;i<6;i++){var c=s.charCodeAt(i);if(c){var l=this.toTranslit[c],d=s.substr(i,1);r+=null!=l?l:d}}a[r]=1}}return a},e.prototype.strToSearchPrefixes=function(e){for(var t=[],a=e.toLowerCase().split(this.delimiter),n=a.length;n--;){var o={},s=a[n],r="",i="",c="",l=s.length>1;if(s){for(var d=0;d<6;d++){var h=s.charCodeAt(d);if(h){var u=this.toTranslit[h],p=s.substr(d,1);if(r+=null!=u?u:p,l){var g=this.toLocalCase[p],_=this.toLocalTranslit[h];i+=null!=g?g:p,c+=null!=_?_:p}}}o[r]=1,l&&(o[i]=2,o[c]=3),t.push(o)}}return t},e.prototype.toIndexTree=function(e,t){for(var a=this.index,n=0;n<6;n++){var o=e.substr(n,1)||-1;a=a[o]?a[o]:a[o]=5==n?[]:{}}a.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),a=this.strToPrefixes(t);for(var n in a)if(a.hasOwnProperty(n)){for(var o=this.index,s=0;s<6;s++){var r=n.substr(s,1)||-1;if(!o[r])break;o=o[r]}if(o.length)for(var s in o)if(this.equals(o[s],e)){o.splice(s,1);break}}},e.prototype.equals=function(e,t){for(var a in e)if(e.hasOwnProperty(a))switch(typeof e[a]){case"object":if(!this.equals(e[a],t[a]))return!1;break;case"function":if(void 0===e[a]||e[a].toString()!=t[a].toString())return!1;break;default:if(e[a]!=t[a])return!1}for(var a in t)if(void 0===t[a])return!1;return!0},e.prototype.intersect=function(e,t){var a=[];if(o(e[0])||o(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var n=e.shift();n&&a.push(n)}t.shift()}return a},e.prototype.add=function(e){var t=this.prepareFunc(e),a=this.strToPrefixes(t);for(var n in a)a.hasOwnProperty(n)&&this.toIndexTree(n,e)},e.prototype.search=function(e){var t=this.index,a=this.strToSearchPrefixes(e),n=[],o=!1;for(var s in a)if(a.hasOwnProperty(s)){if(o&&!n)break;var r=this.localSearch(a[s],0,t);r.sort((function(e,t){return e._order-t._order})),n=o?this.intersect(n,r):r,o=!0}for(var i=n[0],c=n.length+1,l=[],d=1;d<c;d++){var h=n[d];h!=i&&(l.push(i),i=h)}return l},e.prototype.localSearch=function(e,t,a){if(!a)return[];var n={};for(var o in e)e.hasOwnProperty(o)&&(n[r=o.substr(t,1)||-1]||(n[r]={}),n[r][o]=1);if(6==t++)return a;var s=[];for(var r in n)if("-1"===r)for(var i in a)a.hasOwnProperty(i)&&s.push.apply(s,this.localSearch(n[r],t,a[i]));else{var c=this.localSearch(n[r],t,a[r]);s.push.apply(s,c)}return s},e}();function o(e){return!isNaN(e)}},549318:(e,t,a)=>{a.d(t,{Icon20Add:()=>n});var n=(0,a(844990).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="add_20"><path fill-rule="evenodd" d="M10 3a.75.75 0 0 1 .75.75v5.5h5.5a.75.75 0 0 1 0 1.5h-5.5v5.5a.75.75 0 0 1-1.5 0v-5.5h-5.5a.75.75 0 0 1 0-1.5h5.5v-5.5A.75.75 0 0 1 10 3" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},375899:(e,t,a)=>{a.d(t,{Icon20MailOutline:()=>n});var n=(0,a(844990).makeIcon)("Icon20MailOutline","mail_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="mail_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M6.577 2.5h6.846c1.773 0 2.418.18 3.067.528.64.343 1.14.845 1.483 1.486.347.65.527 1.296.527 3.074v4.824c0 1.778-.18 2.424-.527 3.074a3.57 3.57 0 0 1-1.483 1.486c-.649.347-1.294.528-3.067.528H6.577c-1.773 0-2.418-.18-3.067-.528a3.57 3.57 0 0 1-1.483-1.486c-.347-.65-.527-1.296-.527-3.074V7.588c0-1.778.18-2.424.527-3.074A3.57 3.57 0 0 1 3.51 3.028c.649-.347 1.294-.528 3.067-.528M3 12.412V7.588c0-1.598.156-1.997.33-2.328l4.463 4.464c.28.28.52.52.736.703.226.192.473.363.776.462a2.25 2.25 0 0 0 1.39 0c.303-.099.55-.27.776-.462.215-.182.456-.424.736-.703L16.67 5.26c.173.331.329.73.329 2.328v4.824c0 1.663-.169 2.027-.35 2.368q-.303.567-.868.87c-.34.181-.701.35-2.36.35H6.578c-1.658 0-2.02-.169-2.359-.35a2.07 2.07 0 0 1-.867-.87C3.169 14.44 3 14.075 3 12.412M13.423 4H6.577c-1.326 0-1.823.108-2.142.244l4.398 4.399c.306.305.504.502.666.64.156.133.23.166.27.179a.75.75 0 0 0 .463 0c.04-.013.113-.046.269-.179.162-.138.36-.335.666-.64l4.398-4.399C15.245 4.108 14.75 4 13.423 4" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},70252:(e,t,a)=>{a.d(t,{Icon20PhoneOutline:()=>n});var n=(0,a(844990).makeIcon)("Icon20PhoneOutline","phone_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" id="phone_outline_20"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v20H0z" opacity=".1" /><path fill="currentColor" fill-rule="nonzero" d="m7.78 2.7.7.833c1.373 1.628 1.229 4.054-.299 5.582l-.297.296c.226.38.633.878 1.23 1.475.53.53.984.912 1.344 1.149l.13.082.298-.297c1.526-1.527 3.95-1.672 5.58-.302l.833.702c1.46 1.229 1.602 3.419.346 4.894a3.86 3.86 0 0 1-2.29 1.289l-.506.06c-3.005.292-6.037-1.16-9.094-4.217s-4.51-6.09-4.226-9.025l.06-.515a3.83 3.83 0 0 1 1.3-2.354l.168-.135c1.462-1.107 3.54-.924 4.723.484m-3.911.788c-.321.276-.562.633-.698 1.033a2.4 2.4 0 0 0-.115.552c-.343 2.548.898 5.25 3.76 8.112 2.86 2.862 5.562 4.103 8.123 3.758a2.38 2.38 0 0 0 1.571-.81c.719-.844.636-2.082-.177-2.766l-.833-.701-.142-.112c-1.02-.739-2.471-.614-3.411.326l-.597.598-.088.076a.9.9 0 0 1-.862.133c-.648-.238-1.425-.818-2.346-1.74-.923-.923-1.503-1.7-1.74-2.347a.9.9 0 0 1 .209-.95l.598-.597.129-.137c.862-.987.906-2.44.084-3.416l-.702-.834-.112-.122c-.7-.697-1.853-.735-2.651-.056" /></g></symbol>',20,20,!1,void 0)},616140:(e,t,a)=>{a.d(t,{Icon20Sync:()=>n});var n=(0,a(844990).makeIcon)("Icon20Sync","sync_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="sync_20"><clipPath id="sync_20_a"><path d="M0 0h20v20H0z" /></clipPath><g fill="currentColor" clip-path="url(#sync_20_a)"><path d="M16.25 1.5a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1 0-1.5h1.081a6.98 6.98 0 0 0-4.33-1.5 6.98 6.98 0 0 0-4.95 2.05 6.98 6.98 0 0 0-1.973 5.996c.073.483-.278.954-.766.954a.69.69 0 0 1-.69-.563A8.5 8.5 0 0 1 1.5 10c0-2.174.83-4.35 2.49-6.01A8.48 8.48 0 0 1 10 1.5c1.958 0 3.918.673 5.5 2.019V2.25a.75.75 0 0 1 .75-.75M3 14.75a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H5.669C6.935 16.5 8.467 17 10 17a6.98 6.98 0 0 0 4.95-2.05 6.98 6.98 0 0 0 1.972-5.996C16.85 8.47 17.2 8 17.688 8a.69.69 0 0 1 .69.563q.122.714.122 1.437c0 2.174-.83 4.35-2.49 6.01A8.48 8.48 0 0 1 10 18.5a8.48 8.48 0 0 1-5.5-2.019v1.269a.75.75 0 0 1-1.5 0z" /></g></symbol>',20,20,!1,void 0)},194620:(e,t,a)=>{a.d(t,{default:()=>n});const n={background:"InfoBanner-module__background--OpAlW"}},60551:(e,t,a)=>{a.d(t,{default:()=>n});const n={container:"GroupChatInvites-module__container--c5rBK"}},887110:(e,t,a)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="m7.28 4.99-.52 1.2c-.04.1-.06.14-.09.17a.28.28 0 0 1-.09.07.62.62 0 0 1-.17.04l-.75.1c-2.15.3-3.23.46-3.68.96a1.86 1.86 0 0 0-.44 1.61c.13.67.98 1.35 2.68 2.7l.27.23c.08.06.12.09.14.13a.28.28 0 0 1 .04.11c.01.05 0 .1-.02.2l-.08.44c-.48 2.5-.71 3.75-.34 4.36a1.85 1.85 0 0 0 1.5.9c.72.02 1.7-.79 3.65-2.42l.34-.28c.1-.08.15-.12.2-.14a.28.28 0 0 1 .16 0c.06.02.11.06.21.14l.34.28c1.95 1.63 2.93 2.44 3.65 2.41a1.85 1.85 0 0 0 1.5-.89c.37-.6.14-1.86-.34-4.36l-.08-.45c-.02-.1-.03-.14-.02-.19a.28.28 0 0 1 .04-.11.62.62 0 0 1 .14-.13l.27-.22c1.7-1.36 2.55-2.04 2.68-2.7a1.86 1.86 0 0 0-.44-1.62c-.45-.5-1.53-.65-3.68-.96l-.75-.1c-.09-.02-.13-.02-.17-.04a.28.28 0 0 1-.1-.07l-.08-.16-.52-1.21c-.86-2-1.3-2.99-1.9-3.29a1.85 1.85 0 0 0-1.66 0C8.57 2 8.14 3 7.28 5Z"/></svg>',name:"favorite_20"}}a.d(t,{getIcon20Favorite:()=>n})},350870:(e,t,a)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M10.4 3.13a.92.92 0 0 0-.82 0c-.05.03-.19.13-.44.6-.24.45-.52 1.09-.92 2-.16.38-.33.74-.48 1.12-.02.05-.09.2-.2.33a1.02 1.02 0 0 1-.33.25c-.16.08-.35.1-.38.1l-.68.1c-1 .14-1.69.24-2.19.35-.52.13-.66.23-.7.27a.92.92 0 0 0-.21.8c0 .05.07.22.46.59.37.35.92.8 1.7 1.42l.25.2a1.02 1.02 0 0 1 .42 1.13l-.08.41a35.03 35.03 0 0 0-.43 2.56c-.07.64 0 .82.03.86a.92.92 0 0 0 .74.44c.05 0 .24-.02.77-.39.49-.34 1.13-.87 2.03-1.62l.31-.26.15-.12c.07-.04.17-.11.32-.15a1.02 1.02 0 0 1 .55 0c.15.04.25.1.32.15l.15.12.31.26c.9.75 1.54 1.28 2.03 1.62.53.37.72.4.77.4a.92.92 0 0 0 .74-.45c.03-.04.1-.22.03-.86-.06-.6-.21-1.4-.43-2.56l-.08-.42a1.25 1.25 0 0 1-.02-.4 1.03 1.03 0 0 1 .15-.42c.1-.17.26-.28.3-.3l.24-.2c.78-.63 1.33-1.07 1.7-1.42.39-.37.45-.54.46-.59a.92.92 0 0 0-.22-.8c-.03-.04-.17-.14-.7-.27-.5-.11-1.18-.21-2.18-.35l-.7-.1c-.04 0-.2-.03-.36-.1a1.02 1.02 0 0 1-.33-.25c-.12-.14-.19-.31-.2-.34l-.48-1.1c-.4-.92-.68-1.56-.92-2-.25-.48-.4-.58-.44-.6ZM8.9 1.76a2.45 2.45 0 0 1 2.2 0c.5.25.82.73 1.1 1.24.28.51.58 1.22.96 2.09l.41.95.53.07c.94.14 1.7.24 2.28.38.56.13 1.11.32 1.49.74a2.46 2.46 0 0 1 .58 2.12c-.11.55-.5 1-.9 1.4-.43.4-1.03.89-1.78 1.48l-.11.1.04.22c.21 1.1.38 1.99.45 2.66.06.64.07 1.3-.25 1.81a2.46 2.46 0 0 1-1.99 1.18c-.6.02-1.18-.3-1.7-.67-.56-.38-1.24-.95-2.1-1.67l-.11-.09-.11.09c-.87.72-1.55 1.29-2.1 1.67-.53.37-1.1.7-1.71.67a2.46 2.46 0 0 1-2-1.18c-.3-.51-.3-1.17-.24-1.81.07-.67.24-1.55.45-2.66l.04-.23-.11-.09c-.74-.6-1.35-1.07-1.77-1.48-.42-.4-.8-.85-.9-1.4a2.46 2.46 0 0 1 .58-2.12c.37-.42.92-.61 1.48-.74.58-.14 1.34-.24 2.28-.38l.53-.07.4-.95c.39-.87.7-1.58.97-2.1.28-.5.6-.98 1.1-1.23Z" clip-rule="evenodd"/></svg>',name:"favorite_outline_20"}}a.d(t,{getIcon20FavoriteOutline:()=>n})},478459:(e,t,a)=>{function n(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M12.6 2.22a.75.75 0 0 0-1.27.38l-.3 1.54a.3.3 0 0 1-.09.16L8.48 6.76a.3.3 0 0 1-.19.08l-3.86.3a1.01 1.01 0 0 0-.63 1.73l2.96 2.96-4.47 4.46a1 1 0 0 0 1.42 1.42l4.46-4.47 2.97 2.96c.61.62 1.65.22 1.72-.63l.3-3.86a.3.3 0 0 1 .08-.19l2.47-2.46a.3.3 0 0 1 .15-.08l1.54-.31c.58-.12.8-.84.38-1.27L12.6 2.22Z"/></svg>',name:"pin_20"}}a.d(t,{getIcon20Pin:()=>n})},914098:(e,t,a)=>{a.d(t,{checkContactListLoaded:()=>de,mount:()=>Te});var n=a(8520),o=a(810903),s=a(723561),r=a(7144),i=a(317412),c=a(177157),l=a(850101),d=a(610989),h=a(365485),u=a(199835),p=a(948350),g=a(583790),_=a(891911),m=a(958145),v=a(693143),C=a(510575),f=a(406760),b=a(800855),I=a(404619),S=a(712178),w=a(523868),y=a(531868),k=a(52554),x=a(452314),L=a(879007),T=a(505821),A=a(258643),P=a(478459),E=a(903277),M=a(887110),R=a(350870),j=a(905616),B=a(388078),N=a(205184),F=a(822317),D=a(678041),O=a(957081),U=a(510353),H=a(336476),$=a(134015),z=a(719614),V=a(476726);const G="_im_action",q="_im_page_peer_name",K="_ui_menu",W="_im_dialog_action_wrapper",Y="_im_dialog_call_action_wrapper",Z="_im_header_icon",Q="_im_mess_actions",J="_im_page_action",X="_im_chat_verified",ee="im-page--chat-header_chat",te="im-page--chat-header_vkcomgroup",ae="_im_page_peer_name",ne="_im_chat_members",oe="_im_page_reconnect",se="._im_page_status",re="im-page--chat-header_reconnected",ie="im-page--header-action_loading";function ce(e,t,a){return!e.map((e=>{const n=(0,v.getMessage)(t,a,e);return n&&(0,C.isImportant)(n)})).reduce(((e,t)=>e&&t),!0)}function le(e,t){const a=t.get(),n=a.peer,o=a.tabs[n].pinned;return 1===e.length&&o&&e[0]===(0,v.parserMessage)(o).messageId}function de(e){return e.get().contactsList?Promise.resolve(e):e.set(p.getContactsList)}function he(e,t,a){const o=d.getLang("mail_selected_shorted",t.length);_e({actions:!0},"im-page--chat-header"),(0,x.val)((0,x.geByClass1)("im-page--selected-messages"),(0,L.getTemplate)("im_selected_messages",{label:o.replace("{count}",t.length),tip:d.getLang("mail_deselect_all")}));const s=(0,v.getTab)(a,a.get().peer),r=t.some((e=>{const t=(0,v.getMessage)(a,a.get().peer,e);if(!t)return!1;const n=t.attaches[0];return!(!n||"widget"!==n.type)})),i=e.querySelector("."+Q),c=ce(t,a,a.get().peer),l=le(t,a),h=t.length>1,u=!h&&B.Ranges.isChatOrChannelPeer(s.peerId)&&(0,g.canPinMessage)(a,t[0]),p=(0,g.canForwardMessages)(a,t)&&!r,_=!h&&void 0!==t[0]&&(0,O.isUGCStickersEnabled)()&&(0,N.isMessageWithUGCSticker)(a,t[0]),m=e.querySelector(`.${J}[data-action="pin"]`),C=e.querySelector(`.${J}[data-action="star"]`),f=e.querySelector(`.${J}[data-action="respond"]`),b=e.querySelector(`.${J}[data-action="forward"]`),I=Boolean((0,v.tabIsOutgoingMessageRequest)(s)),S=Boolean((0,v.tabIsMessageRequest)(s)),w=(0,y.isBusinessNotifyPeer)(a,a.get().peer);i.className=(0,n.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!c&&!r,"im-page--mess-actions_pinned":l,"im-page--mess-actions_channel":B.Ranges.isChatOrChannelPeer(s)&&!a.get().gid,"im-page--mess-actions_multiple-selection":h,"im-page--mess-actions_no-pin-btn":!u,"im-page--mess-actions_out-mr":I,"im-page--mess-actions_in-mr":S,"im-page--mess-actions_business-notify":w,"im-page--mess-actions_no-important-btn":!(0,g.canMarkImportant)(a,t)||r,"im-page--mess-actions_no-report-to-ugc-sticker":!_,"im-page--mess-actions_no-spam":_}),m.innerHTML=l?(0,P.getIcon20Pin)().icon:(0,E.getIcon20PinOutline)().icon,C.innerHTML=c||r?(0,R.getIcon20FavoriteOutline)().icon:(0,M.getIcon20Favorite)().icon,t.length>1?A.FlatButton.setLabel(f,d.getLang("mail_forward_here")):A.FlatButton.setLabel(f,d.getLang("mail_im_mark_reply")),p?A.FlatButton.setDisabled(b,!1):A.FlatButton.setDisabled(b,!0),h&&!p||(0,y.isBusinessNotifyTab)(s)||r?A.FlatButton.setDisabled(f,!0):A.FlatButton.setDisabled(f,!1);const k=c?d.getLang("mail_im_toggle_important"):d.getLang("mail_im_toggle_important_off"),T=l?d.getLang("mail_unpin"):d.getLang("mail_pin");(0,x.attr)((0,x.geByClass1)("im-page-action_star",e),"aria-label",k),(0,x.attr)((0,x.geByClass1)("im-page-action_pin",e),"aria-label",T)}function ue(e,t,a){const n=t.get(),o=n.peer,s=n.tabs[o],r=(0,x.geByClass1)(X,e),i=(0,x.geByClass1)(g.PINNED_CONTAINER_CLASS,e),l=B.Ranges.isChatOrChannelPeer(o),d=l&&(0,v.isChannelPeer)(s),h=l&&(0,y.isBusinessNotifyTab)(s)&&(0,k.isBusinessNotifyEnabled)(t),u=n.selectedMessages&&!!n.selectedMessages.length,_=(0,c.isDialogWithYourself)(n.id,o);r.tt=!1;const m=s.is_nft_photo&&!_,C=(0,g.renderPhotosFromTab)(t,s,!1),I=m?(0,L.getTemplate)("im_simple_link",{href:d?"/club"+-s.ownerId:s.href,content:(0,L.getTemplate)("im_peer_photo_nft",{user_photo:(0,L.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:s.photo,size:30}),user_icon:s.photo_icon||"",modifier_class:"nim-peer_smaller"})}):(0,L.getTemplate)("im_simple_link",{href:d?"/club"+-s.ownerId:s.href,content:(0,L.getTemplate)("im_peer_photo",{online_class:"",owner_photo:C,modifier_class:"nim-peer_smaller"})});(0,x.val)((0,x.geByClass1)("im-page--aside-photo",e),I);const S=l&&(0,v.isChatActive)(s),w={muted:(0,L.inArray)(o,n.mutedPeers),verified:!!s.verified,verified_by_other_services:!s.verified&&!!s.verified_by_other_services,chat:l,vkcomgroup:d,actions:u,derelict:l&&!S&&!d&&!h,pinned:!1};if(l){const n=(0,v.getPinnedMessage)(t),s=function(e){const t=(0,v.getPinnedMessage)(e);if(!t||(0,f.oCacheGet)(e,t.userId))return!1;return t.userId}(t);n&&(0,b.isPinnedMessageVisibleInTab)(t,o)&&(s?t.set(p.loadChatMember.bind(null,{[o]:[s]})).then(ue.bind(null,e,t,a)):w.pinned=!0)}pe(t,s,e);const T=!s.top_banner&&i.innerHTML,A=!s.top_banner&&ge(t,e,i);let P=(0,x.geByClass1)(q,e);(0,x.removeClass)(P,g.DESELECT_ALL_CLASS),function(e,t,a){const n=a.length>0;(0,x.geByClass)(Z,e).forEach((e=>{if("star"===e.dataset.type&&(0,g.isFoldersAvailable)(t)&&((0,x.toggleClass)(e,"im-page--header-icon_shown",!n),(0,x.toggleClass)(e,"im-page--header-icon_star-active",(0,g.isImportant)(t))),"answer"===e.dataset.type&&(0,g.isFoldersAvailable)(t)&&(0,x.toggleClass)(e,"im-page--header-icon_shown",!n&&(0,g.isUnrespond)(t)),"search"===e.dataset.type&&!(0,g.isCommunityInterface)(t)){const a=t.get().peer,o=!n&&(0,g.isFullyLoadedTab)(t,a)&&(0,v.getTab)(t,a).offset&&!(0,g.isCommunityInterface)(t)&&(!(0,g.isCallToPeerAvailable)(t,a)||!(0,g.isClassicInterface)(t));(0,x.toggleClass)(e,"im-page--header-icon_shown",o)}})),xe(t)}(e,t,[]);const E=e.querySelector("._im_dialog_call_action_wrapper"),M=e.querySelector("._im_header_icon[data-type=call]");if(E&&E.classList.toggle("im-page--header-call-is-hidden",!(0,g.isCallToPeerAvailable)(t,o)||!!s.callInProgress),M&&(M.classList.toggle("im-page--header-icon_shown",(0,g.isCallToPeerAvailable)(t,o)&&!!s.callInProgress),M.classList.toggle("im-page--header-icon_call-active",!!s.callInProgress&&s.callInProgress.participants.count>0)),(0,g.isClassicInterface)(t)){let a=(0,x.geByClass1)("_im_page_back",e);(0,x.attr)(a,"href",`${(0,g.getBaseLink)(t)}?tab=${n.active_tab}`)}_e(w,"im-page--chat-header"),(0,g.compensateHistoryHeightChange)(t,A,T,a)}function pe(e,t,a){const n=B.Ranges.isChatOrChannelPeer(t.peerId),o=n&&(0,v.isChannelPeer)(t),s=n&&(0,v.isChatActive)(t),i=n&&(0,v.isCasperChatTab)(t),c=n&&(0,y.isBusinessNotifyTab)(t)&&(0,k.isBusinessNotifyEnabled)(e),l=B.Ranges.isContactId(t.peerId),h=t.isDonutChat;let u="";n?u=o?(0,L.getTemplate)("im_vkcomgroup_members",{name:d.getLang("mail_im_n_vkcomgroup_members",(0,g.getAliveMembersCount)(t))}):s?(0,L.getTemplate)("im_chat_members",{name:d.getLang("mail_im_n_chat_members",(0,g.getAliveMembersCount)(t))}):"":B.Ranges.isUserIdTransitional(t.peerId)&&(u=(0,g.getLastSeenTextInHeader)(e,t.peerId));let p=[];""!==u||c||p.push("im-page--title--1line"),i&&p.push("im-page--title--casper"),h&&p.push("im-page--title--donut"),c&&p.push("im-page--title--business-notify"),p=p.join(" ");const _=l?(0,g.prepareContactName)(t.name):t.tab;let m=(0,L.getTemplate)("im_simple_name",{name:_,href:o?"/club"+-t.ownerId:t.href,mail_network_reconnect:d.getLang("mail_network_reconnect"),name_attr:(0,r.stripHTML)(_),ads_union:t.ad_union_ids_attr,online:u,more_cls:p,more_children:c?(0,L.getTemplate)("sImSimpleNameBusinessNotifyLabel",{text:d.getLang("mail_tab_business_notify")}):""});(0,x.val)((0,x.geByClass1)("im-page--title-wrapper",a),m)}function ge(e,t,a){const n=(0,v.getPinnedMessage)(e),o=a||(0,x.geByClass1)(g.PINNED_CONTAINER_CLASS,t);if((0,x.removeClass)(o,"im-page--pinned_with-bar"),n&&(0,C.isMoneyRequest)(n)){if(void 0===n.kludges.attach1_tr_amount)return;n.kludges.attach1_total_amount&&(0,x.addClass)(o,"im-page--pinned_with-bar")}const s=(0,g.renderPinnedMessage)(e);return(0,x.val)(o,s),!!s}function _e(e,t){const a=(0,x.geByClass1)(t);Object.keys(e).forEach((n=>{(0,x.toggleClass)(a,`${t}_${n}`,!!e[n])}))}function me(e,t,a,n,o,s){e.set(p.removeMessagesWithRestore.bind(null,a,o,n)).then(t().removeMessagesRestore.bind(null,a,o,n)),(0,p.removeMessageSend)(a,o,null,n,e.get(),s).then((()=>{const n=(0,v.getTab)(e,o);a.includes(n.lastmsg)&&(0,p.loadActualLastMessage)(e,o).then((()=>{t().updateConvoInList(o,e),t().updateState(o,e)}))}))}function ve(e,t,a,n,o){const s=e.get().selectedMessages,r=(0,x.domData)(o,"action"),i=e.get().peer,c=(0,v.getTab)(e,i);let l=!0;if(!["star","delete"].includes(r)&&(0,v.tabIsOutgoingMessageRequest)(c))return fe(e,t,a);switch(r){case"delete":{let n=!(vk.id==i&&!e.get().gid)&&s.every((t=>(0,g.canMessageBeDeletedForAll)(e,(0,v.getMessage)(e,i,t))));if(n||s.length>1){l=!1;let o=(0,g.showMsgDeleteDialog)(i,s.length,n,(n=>{fe(e,t,a),o.hide(),cur.imDb.updateByKey("del_forall_checked",n),n?(0,p.removeMessageSend)(s,i,null,"deleteforall",e.get()):me(e,t,s,r,i)}))}else me(e,t,s,r,i);break}case"spam":(0,V.partConfigEnabled)("spam_message_types")?(0,D.showReportForm)("message",Number(i),s[0],void 0,void 0,{onReportCategorySelection:a=>{me(e,t,s,r,i,a)},isAfterMessageSelection:!0}):me(e,t,s,r,i);break;case"forward":if(!(0,g.canForwardMessages)(e,s))return;(0,p.processFwd)(s,i,e).then((t=>e.set(p.prepareForward.bind(null,t)))).then((()=>a().showForward(e))).catch((e=>console.error(e)));break;case"star":{const t=ce(s,e,i);e.set(p.favMessage.bind(null,s,t,i)),e.get().longpoll.push(s.map((e=>({type:t?_.SET_FLAGS:_.RESET_FLAGS,messageId:e,peerId:i,flags:_.FLAG_IMPORTANT}))));break}case"respond":{const a=e.get(),n=1===s.length;(0,p.processFwd)(s,a.peer,e).then((t=>e.set(p.forwardMessages.bind(null,t,a.tfdraft,n)))).then((()=>{t().respond(e,i)}));break}case"pin":{const a=(0,v.getLocalId)(e,s[0]);if(!(0,g.canPinMessage)(e,a))return;const n=le(s,e),o=n?p.unpinMessageOptimistic.bind(null,i):p.pinMessageOptimistic.bind(null,a,i),r=n?p.unpinMessage.bind(null,i):p.pinMessage.bind(null,a,i),c=ke.bind(null,t,i);e.set(p.checkChatMember.bind(null,e,a,i)).then((e=>e.set(o))).then(c).then((e=>e.set(r))).then(c);break}case F.ConvoAction.REPORT_UGC_STICKER:{if(!(0,O.isUGCStickersEnabled)())return;const a=(0,v.getMessage)(e,i,s[0]);if(!a)return;const n=(0,g.getAttachIdFromMessage)(a);if(!n)return;const o=()=>{e.set(p.removeMessagesWithRestore.bind(null,s,i,r)).then(t().removeMessagesRestore.bind(null,s,i,r))};(0,D.showReportForm)("ugc_sticker",Number(i),Number(n),o)}}l&&fe(e,t,a)}function Ce(e,t,a,n,o,s,r){const i=(0,x.domData)(r,"action"),c=n.querySelector(`.${W} .${K}`).parentNode,l=e.get().peer;(0,T.handleUiActionForPeer)(e,t,a,i,l,o,(e=>{17===e?.error?.error_code&&(0,u.showNotification)({title:d.getLang("mail_changes_cant_be_applied"),text:d.getLang("mail_not_confirmed_phone")})})),uiActionsMenu.toggle(c,!1),t().cancelEditing()}function fe(e,t,a){const n=e.get().selectedMessages;e.set(p.cleanSelected).then(a().changedMessageSelection).then(t().cleanSelection.bind(null,n))}function be(e,t,a,n){const s=(0,g.isClassicInterface)(e);let r,i;switch((0,x.domData)(n,"type")){case"star":i=[4,6],r=()=>(0,g.isImportant)(e)?d.getLang("mail_im_toggle_important_off"):d.getLang("mail_im_toggle_important");break;case"answer":i=[4,6],r=d.getLang("mail_end_conversation");break;case"search":i=s?[5,6]:[4,-9],r=d.getLang("mail_search_in_peer")}(0,o.showTooltip)(n,{text:r||"",black:1,shift:i,forcetoup:!0,appendParentCls:s?"_im_dialog_actions":"_im_mess_actions"})}function Ie(e,t,a){const n=(0,g.isClassicInterface)(e),s=(0,x.domData)(a.target,"action");"respond"!==s&&"forward"!==s&&(0,o.showTooltip)(a.target,{text:Se.bind(null,e,s)||"",black:1,shift:[2,n?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function Se(e,t){const a=e.get(),n=a.selectedMessages,o=a.peer;switch(t){case"pin":return le(n,e)?d.getLang("mail_unpin"):d.getLang("mail_pin");case"star":return ce(n,e,o)?d.getLang("mail_im_toggle_important"):d.getLang("mail_im_toggle_important_off");case"delete":return d.getLang("mail_delete");case"spam":return d.getLang("mail_im_mark_spam");case F.ConvoAction.REPORT_UGC_STICKER:return d.getLang("mail_im_report_ugc_sticker")}}function we(e,t,a,n,o){const s=(0,x.domData)(o,"type"),r=e.get().peer;switch(s){case"star":e.set(p.toggleDialogImportant.bind(null,r)).then((()=>{setTimeout((()=>be(e,0,0,o)),40)}));break;case"search":a().showSearch(e),window.tooltips&&tooltips.hide(o,{fasthide:!0});break;case"answer":(0,v.getTab)(e,r)&&(e.set(p.markDialogAnswered.bind(null,e.get().peer)),(0,l.showDoneBox)(d.getLang("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([(0,m.resetPeer)()]));break;case"call":if((0,g.isCallToPeerAvailable)(e,r)){const t=(0,v.getTab)(e,r).callInProgress;t&&(0,g.joinCallFromIm)(e,r,t.join_link,!1,g.CALL_ENTRY_POINT_JOIN_HEADER)}break;case"marusia_add_to_dialog":(0,U.showGroupChatInviteBox)(-$.MARUSIA_PEER_ID)}}function ye(e,t){const a=Number(t),n=(0,g.formatTimespan)(a,!0),o=d.getLang("mail_network_waiting").replace(/{timer}/gi,n);e.querySelector(se).innerHTML=o}function ke(e,t,a){return e().updateChatTopic(t,a),a}function xe(e){const t=e.get().peer,a=()=>(0,H.isMarusiaPeer)(e.get().peer),n=document.querySelector(".im-page--header-icon_marusia_add_to_dialog");if(n){const o=(0,H.isMarusiaPeer)(t)&&(0,g.isFullyLoadedTab)(e,t);n.classList.toggle("im-page--header-icon_shown",o),o&&(0,z.showMarusiaAddToDialogTooltip)(n,a)}}function Le(e,t,a,n){let o={};return{changeActions(t){const a=e.querySelector(`.${W} .${K}`),n=e.querySelector(`.${W}`),o=t.get().curActions||{},s=Object.keys(o).sort(((e,t)=>p.ACTION_PRIORITIES[e]-p.ACTION_PRIORITIES[t]));if(0===s.length)return void n.classList.add(ie);const r=(0,L.getTemplate)("sUiActionsMenuSeparator");let i="",c=0;for(let e=0;e<s.length;e++){const t=s[e];e>0&&(c/10|0)!=(p.ACTION_PRIORITIES[t]/10|0)&&(i+=r),i+=(0,L.getTemplate)("sImUiActionMenuItem",{action:t,name:o[t].name,icon:o[t].icon,classes:"_im_action",icon_html:o[t].iconHtml}),c=p.ACTION_PRIORITIES[t]}a.innerHTML=i,n.classList.remove(ie)},setNetworkWaitingStatus(t,a){o.interval&&clearInterval(o.interval);const n=(0,v.getTab)(a,(0,y.getCurrentTab)(a));n&&!(0,y.isBusinessNotifyTab)(n)&&(ye(e,t),o.timeout=t,o.interval=setInterval((()=>{o.timeout>1?(o.timeout--,ye(e,o.timeout)):(clearInterval(o.interval),o={})}),1e3))},setNetworkReconnectingStatus(t){o.interval&&clearInterval(o.interval),o={};const a=(0,v.getTab)(t,(0,y.getCurrentTab)(t));a&&!(0,y.isBusinessNotifyTab)(a)&&function(e){const t=e.querySelector(se),a=d.getLang("mail_network_reconnecting");t&&(t.innerHTML=a)}(e)},clearNetworkStatus(){o.interval&&clearInterval(o.interval),o={},e.querySelector(se).innerHTML=""},showSettings(t){const a=t.get(),o=(0,v.getTab)(t,a.peer);(0,v.isChatActive)(o)&&(0,I.mount)(e,t,n)},showForward(e){(0,S.mount)(e)},renderPeer(a){ue(e,a,t)},reRenderPinned(t){let a=(0,y.getCurrentTab)(t);a&&a.pinned&&ge(t,e)},reRenderTitle(t){const a=(0,y.getCurrentTab)(t);a&&pe(t,a,e)},renderActions(t){let a=t.get().selectedMessages||[];a.length>0&&he(e,a,t)},hideActions(t){if(!(0,g.isFullyLoadedTab)(t,t.get().peer)){(0,x.geByClass)(Z,e).forEach((e=>{(0,x.addClass)(e,ie)}));const t=(0,x.geByClass1)(W,e);(0,x.addClass)(t,ie);const a=(0,x.geByClass1)(Y,e);(0,x.addClass)(a,ie)}},showActions(t){if((0,g.isFullyLoadedTab)(t,t.get().peer)){(0,x.geByClass)(Z,e).forEach((e=>{(0,x.removeClass)(e,ie)}));const t=(0,x.geByClass1)(W,e);(0,x.removeClass)(t,ie);const a=(0,x.geByClass1)(Y,e);(0,x.removeClass)(a,ie)}},changedMessageSelection(a){const n=a.get(),o=n.peer;if(0===o||!n.tabs[o])return;let s=a.get().selectedMessages||[];s.length>0?he(e,s,a):ue(e,a,t)},updateLastSeen(t){!function(e,t){const a=e.get().peer,n=(0,x.geByClass1)("_im_page_peer_online",t);n&&B.Ranges.isUserIdTransitional(a)&&(0,v.getTab)(e,a)&&(0,g.applyInnerHtml)(n,(0,g.getLastSeenTextInHeader)(e,a))}(t,e)},deselectAll(e){fe(e,t,n)},updateState(e){t().updateState.bind(null,e)},unmount(){(0,h.destroyModule)(a),(0,s.cancelStackFilter)("forward")}}}function Te(e,t,a){const{callMutations:n,bindMutations:o}=(0,h.createMutations)(Le),s=new j.ConvoAttaches(t,a),r=ve.bind(null,t,a,n),c=Ce.bind(null,t,a,n,e,s),l=fe.bind(null,t,a,n),d=(e,a)=>{const n=t.get().peer,o=(0,v.getTab)(t,n);(0,g.showVerifiedTooltip)(a,(0,y.isBusinessNotifyTab)(o)?o.ownerId:n)},u=be.bind(null,t,e),_=Ie.bind(null,t,e),C=we.bind(null,t,e,a),f=()=>n().showSettings(t),b=a=>{const n=t.get().peer;B.Ranges.isContactId(n)&&((0,w.mount)(t,n,e),(0,i.cancelEvent)(a)),!(0,x.gpeByClass)(ee,a.target,e)||(0,x.gpeByClass)(te,a.target,e)||(0,i.checkEvent)(a)||(f(),(0,i.cancelEvent)(a))},I=()=>function(e,t){const a=()=>{t&&(t.classList.remove(re),t.removeEventListener("mouseleave",a))};t&&(t.classList.add(re),t.addEventListener("mouseleave",a)),e.get().longpoll.abortWaiting()}(t,e),S=(0,h.createModule)({handlers:(a,n)=>{n(e,"click",J,r),n(e,"click",G,c),n(e,"click",g.DESELECT_ALL_CLASS,l),n(e,"mouseover",X,d),n(e,"mouseover",Z,u),n(e,"mouseover",J,_),n(e,"click",Z,C),n(e,"click","_im_header_link",b),n(e,"click",ae,b),n(e,"click",ne,f),n(e,"click",oe,I),n(e,"click","_im_page_back",(e=>{(0,i.checkEvent)(e)||(t.get().longpoll.push([(0,m.resetPeer)()]),(0,i.cancelEvent)(e))}))}});return B.Ranges.isZeroOwner(t.get().peer)||setTimeout((()=>{t.set(p.setActions).then(n().changeActions)})),xe(t),o(e,a,S,n)}},523868:(e,t,a)=>{a.d(t,{mount:()=>u});var n=a(474848),o=(a(296540),a(365485)),s=a(440961),r=a(514051),i=a(914098);let c=null;function l(e,t,a){const o=d();if(o){const c=t-19e8;s.render((0,n.jsx)(r.ContactPopup,{store:e,onClose:a.closeContactPopup,getContactInfo:()=>function(e,t){return(0,i.checkContactListLoaded)(e).then((e=>{const a=function(e,t){const a=e.get().contactsList;return a?a.find((e=>e.id===t)):null}(e,t);return Promise.resolve(a)}))}(e,c)}),o)}}function d(){return document.getElementById("ContactPopup")}function h(e,t){return{unmount:()=>function(e,t){c&&t.unsubscribe(c);const a=d();a&&s.unmountComponentAtNode(a),(0,o.destroyModule)(e)}(e,t),closeContactPopup(){const e=d();s.unmountComponentAtNode(e)}}}function u(e,t,a,n){const{bindMutations:s}=(0,o.createMutations)(h),r=s((0,o.createModule)({handlers:(e,t)=>{}}),e);return l(e,t,r),r}},749613:(e,t,a)=>{a.d(t,{CaptchaType:()=>n,createCaptchaPopupService:()=>l});var n,o=a(32489),s=a(293721),r=a(418562),i=a(311606),c=a(884415);!function(e){e[e.IMAGE=0]="IMAGE",e[e.AUDIO=1]="AUDIO"}(n||(n={}));const l=()=>{const e=(0,s.createGate)(),t=(0,o.createEvent)(),a=(0,o.createEvent)(),n=(0,o.createEvent)(),l=(0,o.createEvent)(),d=(0,o.createEvent)(),h=(0,o.createEvent)(),u=(0,o.createEvent)(),p=(0,o.createEvent)(),g=(0,o.createEvent)(),_=(0,o.createEvent)(),m=(0,o.createEvent)();(0,o.forward)({from:e.close,to:m});const v=(0,o.createStore)("");v.on(e.open,((e,{captchaImage:t})=>t));const C=(0,o.createStore)("");C.on(e.open,((e,{captchaTrack:t})=>t));const f=(0,o.createStore)("");f.on(e.open,((e,{deviceId:t})=>t));const b=(0,o.createStore)(null);b.on(e.open,(()=>"CAPTCHA_MODAL_ACTIVE")),b.on(_,(()=>null));const I=(0,o.createStore)(null);I.on(e.open,((e,t)=>t.platform));const S=(0,o.createStore)("");S.reset(e.close),S.on(e.open,((e,{sid:t})=>t));const w=(0,o.createStore)("");w.reset(e.close),w.on([u,p],(()=>(0,r.default)()));const y=(0,o.createStore)(0);y.on(h,(e=>e+1)),y.reset(e.close);const k=(0,o.createStore)("");k.reset(e.close),k.on(t,((e,t)=>t));const x=(0,o.createStore)(!0);x.reset([e.close,h,u]),x.on(l,(()=>!0)),x.on(u,(()=>!0)),x.on(d,(()=>!1)),x.on(g,(()=>!1));const L=(0,o.createStore)(0);L.on(h,(e=>0===e?1:0));const T=(0,o.createStore)(!1);T.reset(e.close),T.on(a,(()=>!0)),T.on(n,(()=>!1));const A=(0,o.createStore)(!1);A.reset([e.close,h,u,p]),A.on(g,(()=>!0));const P=(0,o.createStore)("");P.reset([e.close,u]);const E=(0,o.createStore)(0);E.reset([e.close,m]),E.on([u,h],(()=>5));const{tick:M,isRunning:R}=(0,i.interval)({timeout:1e3,start:(0,o.merge)([u,h]),stop:m});E.on(M,(e=>e-1));const j=(0,o.createStore)(!1);j.reset(e.close);const B=(0,o.createStore)(!1);B.reset(e.close);const N=(0,o.createStore)(!0);N.reset(e.close),N.on(t,((e,t)=>""===t.trim()));const F=(0,o.createStore)(!0);return F.reset(e.close),F.on(h,(()=>!1)),(0,o.sample)({source:E,filter:e=>0===e,target:m}),(0,o.sample)({source:{isAudioPlaying:T,refreshCountdownRunning:R},fn:({isAudioPlaying:e,refreshCountdownRunning:t})=>e||t,target:[j,B]}),(0,o.sample)({clock:[e.open,p,h],source:{sid:S,hash:w,type:L,swapCount:y,platform:I,captchaImage:v,captchaTrack:C,deviceId:f,isFirst:F},fn:e=>(0,c.getCaptchaLink)(e),target:P}),(0,o.sample)({clock:u,source:{sid:S,hash:w,type:L,swapCount:y,platform:I,captchaImage:v,captchaTrack:C,deviceId:f},fn:e=>(0,c.getCaptchaLink)({...e,isRefresh:!0}),target:P}),{Gate:e,answerChanged:t,audioPlaying:a,audioPaused:n,captchaLoadingStarts:l,captchaLoadingEnds:d,captchaTypeToggled:h,captchaRefreshed:u,captchaReloaded:p,captchaLoadingErrorSet:g,closeCaptcha:_,$answer:k,$captchaLoading:x,$captchaType:L,$isAudioPlaying:T,$hasLoadCaptchaError:A,$captchaSrc:P,$refreshCountdown:E,$isRefreshButtonDisabled:j,$isCaptchaTypeToggleDisabled:B,$isSubmitButtonDisabled:N,$isCaptchaModalActive:b}}},161882:(e,t,a)=>{a.d(t,{CaptchaType:()=>n.CaptchaType,Platform:()=>o.Platform,createCaptchaPopupService:()=>n.createCaptchaPopupService});var n=a(749613),o=a(884415)},884415:(e,t,a)=>{a.d(t,{Platform:()=>n,getCaptchaLink:()=>r});var n,o=a(749613),s=a(105352);!function(e){e[e.VK_WEB=0]="VK_WEB",e[e.VK_M_WEB=1]="VK_M_WEB"}(n||(n={}));const r=({sid:e,hash:t,type:a,isRefresh:n,swapCount:r,platform:i,isFirst:c,captchaImage:l,captchaTrack:d,deviceId:h})=>{const u=t?`&v=${t}`:"",p=n?"&refresh=1":"",g=!n&&r>0?"&swap_type=1":"",_=c?"&first=1":"";let m;switch(i){case 0:default:m=s.VK_WEB_APP_ID;break;case 1:m=s.VK_MVK_APP_ID}switch(a){case o.CaptchaType.IMAGE:{let t="";if(l){const e=new URLSearchParams(l);t=e.has("device_id")?e.has("device_id")&&e.get("device_id")?`${l}&s=1&width=400&resized=1`:`${l.replace("device_id=",`device_id=${h}`)}&s=1&width=400&resized=1`:`${l}&resized=1&width=400&app_id=${m}&device_id=${h}`}else t=`/captcha.php?sid=${e}&s=1&resized=1&width=400&app_id=${m}&device_id=${h}`;return`${t}${u}${p}${g}${_}`}case o.CaptchaType.AUDIO:{let t="";if(d){const e=new URLSearchParams(d);t=e.has("device_id")?e.has("device_id")&&e.get("device_id")?`${d}`:`${d.replace("device_id=",`device_id=${h}`)}`:`${d}&app_id=${m}&device_id=${h}`}else t=`/sound_captcha.php?act=get&captcha_sid=${e}&app_id=${m}&device_id=${h}`;return`${t}${u}${p}${g}${_}`}default:return""}}},719614:(e,t,a)=>{a.d(t,{showMarusiaAddToDialogTooltip:()=>l});var n=a(812477),o=a(933052),s=a(610989);const r="voice_assistant:add_to_group_chat";let i,c;function l(e,t){i||(i=(0,o.api)("account.getHelpHints",{})),i.then((a=>{if(!t())return;if(a.items.find((e=>e.id===r))){if(!c){const{tooltip:t}=(0,n.helpHintTooltip)(e,{content:s.getLang("mail_marusia_add_to_dialog_tooltip"),isServerSideHideDisabled:!0},{width:184,forceSide:"bottom",align:"right",appendToParent:!0,withCloseButton:!1,autoAdjustToViewport:!1,noAutoHideOnWindowClick:!1,onClick:()=>{t.hide()}});c=t}(0,o.api)("account.hideHelpHint",{hint_id:r}),window.requestAnimationFrame((()=>{c&&c.show()}))}})).catch(console.error)}},186301:(e,t,a)=>{a.d(t,{handleCaptcha:()=>r});var n=a(20025),o=a(476726),s=a(816475);const r=e=>new Promise((t=>{if((0,o.partConfigEnabled)("vkcom_audio_captcha_enabled"))(0,s.showCaptchaPopup)({sid:e.captcha_sid,isRefreshEnabled:e.is_refresh_enabled,isSoundCaptchaAvailable:e.is_sound_captcha_available,isUiuxChangesEnabled:e.uiux_changes,captcha_track:e.captcha_track,captcha_img:e.captcha_img,onSubmit:(a,n)=>{t({captcha_sid:e.captcha_sid,captcha_key:a,is_sound_captcha:n})}});else{let a=null;const s=(0,o.partConfigEnabled)("vkcom_captcha_resized")?`${e.captcha_img}&resized=1&width=400`:e.captcha_img,r=e?.is_refresh_enabled||!1,i={imgSrc:s,onSubmit:(e,n)=>{t({captcha_sid:e,captcha_key:n,is_sound_captcha:0}),a&&a.hide()}};a=(0,n.showCaptchaBox)(e.captcha_sid,!1,null,i,r)}}))},816475:(e,t,a)=>{a.d(t,{showCaptchaPopup:()=>n.showCaptchaPopup});var n=a(766338)},506537:(e,t,a)=>{a.d(t,{CaptchaType:()=>n.CaptchaType,Platform:()=>n.Platform,captchaPopupService:()=>o});var n=a(161882);const o=(0,n.createCaptchaPopupService)()},766338:(e,t,a)=>{a.d(t,{showCaptchaPopup:()=>r});var n=a(474848),o=a(272259),s=a(121939);function r(e){(0,o.showMessageBoxModal)((t=>(0,n.jsx)(s.CaptchaPopup,{...t,...e,onClose:()=>{e.onClose&&e.onClose(),t.onClose()},onSubmit:(a,n)=>{e.onSubmit&&(e.onSubmit(a,n),t.onClose())}})),{width:300})}},705333:(e,t,a)=>{a.d(t,{CaptchaAnswerField:()=>d});var n=a(474848),o=a(296540),s=a(529558),r=a(753457),i=a(506537),c=a(610989),l=a(293721);const d=(0,o.forwardRef)((({disabled:e,captchaType:t,isUiuxChangesEnabled:a},d)=>{const h=(0,o.useRef)(null),u=(0,o.useRef)(null),p=(0,l.useStore)(i.captchaPopupService.$answer),g=(0,l.useEvent)(i.captchaPopupService.answerChanged),_=!!a&&t===i.CaptchaType.AUDIO,m=t===i.CaptchaType.IMAGE?c.getLang("vkconnect_auth_label_captcha"):a?c.getLang("vkconnect_auth_label_captcha_audio_new_ux"):c.getLang("vkconnect_auth_label_captcha_audio");return(0,o.useImperativeHandle)(d,(()=>({inputFieldRef:h,inputLabelRef:u}))),(0,n.jsx)(s.FormItem,{mode:"vertical",noPadding:!0,top:_?(0,n.jsx)("div",{tabIndex:0,ref:u,children:c.getLang("vkconnect_auth_audio_captcha_title")}):"",children:(0,n.jsx)(r.Input,{getRef:h,tabIndex:0,value:p,placeholder:m,disabled:e,onChange:e=>g(e.target.value)})})}))},473735:(e,t,a)=>{a.d(t,{CaptchaAnswerField:()=>n.CaptchaAnswerField});var n=a(705333)},90205:(e,t,a)=>{a.d(t,{CaptchaError:()=>l});var n=a(474848),o=a(753457),s=a(610989),r=a(293721),i=a(506537),c=a(765668);const l=(0,a(296540).forwardRef)((({captchaType:e},t)=>{const a=(0,r.useEvent)(i.captchaPopupService.captchaReloaded);return(0,n.jsxs)(o.Footer,{children:[(0,n.jsx)(n.Fragment,{children:e===i.CaptchaType.IMAGE?s.getLang("vkconnect_auth_captcha_loading_error_caption"):s.getLang("vkconnect_auth_audio_captcha_loading_error_caption")}),(0,n.jsx)(c.Link,{onClick:a,getRootRef:t,role:"button","aria-label":e===i.CaptchaType.IMAGE?s.getLang("vkconnect_auth_captcha_image_loading_error_retry_aria_label"):s.getLang("vkconnect_auth_captcha_sound_loading_error_retry_aria_label"),children:s.getLang("vkconnect_auth_captcha_loading_error_refresh_text")})]})}))},272247:(e,t,a)=>{a.d(t,{CaptchaError:()=>n.CaptchaError});var n=a(90205)},959179:(e,t,a)=>{a.d(t,{CaptchaInfoButton:()=>l});var n=a(474848),o=a(296540),s=a(580539),r=a(533048),i=a(234337),c=a(610989);const l=(0,o.forwardRef)((({onClick:e},t)=>(0,n.jsx)(r.Button,{getRootRef:t,tabIndex:0,appearance:"neutral",mode:"tertiary",size:"m",before:(0,n.jsx)(s.Icon24InfoCircleOutline,{className:(0,i.getColorClass)("color_icon_secondary")}),"aria-label":c.getLang("vkconnect_auth_audio_captcha_info_text"),onClick:e})))},991031:(e,t,a)=>{a.d(t,{CaptchaInfoButton:()=>n.CaptchaInfoButton});var n=a(959179)},901885:(e,t,a)=>{a.d(t,{CaptchaPopup:()=>x});var n=a(474848),o=a(296540),s=a(293721),r=a(209642),i=a(416124),c=a(785118),l=a(624338),d=a(828902),h=a(428918),u=a(757550),p=a(533048),g=a(753457),_=a(610989),m=a(476726),v=a(493192),C=a(272247),f=a(698035),b=a(707695),I=a(473735),S=a(934905),w=a(991031),y=a(725405),k=a(506537);const x=({sid:e,isRefreshEnabled:t,isSoundCaptchaAvailable:a,isUiuxChangesEnabled:x,captcha_track:L,captcha_img:T,onSubmit:A,onClose:P})=>{(0,s.useGate)(k.captchaPopupService.Gate,{sid:e,platform:k.Platform.VK_WEB,captchaTrack:L,captchaImage:T,deviceId:(0,S.getDeviceId)(k.Platform.VK_WEB)});const E=(0,m.partConfigEnabled)("vkcom_captcha_new_ux"),M=(0,s.useEvent)(k.captchaPopupService.captchaLoadingEnds),R=(0,s.useStore)(k.captchaPopupService.$hasLoadCaptchaError),j=(0,s.useStore)(k.captchaPopupService.$captchaLoading),B=(0,s.useEvent)(k.captchaPopupService.captchaLoadingErrorSet),N=(0,s.useStore)(k.captchaPopupService.$captchaType),F=(0,s.useStore)(k.captchaPopupService.$answer),D=(0,s.useStore)(k.captchaPopupService.$captchaSrc),O=(0,s.useStore)(k.captchaPopupService.$isSubmitButtonDisabled),U=(0,s.useStore)(k.captchaPopupService.$isCaptchaTypeToggleDisabled),H=(0,s.useEvent)(k.captchaPopupService.captchaTypeToggled),$=(0,s.useStore)(k.captchaPopupService.$isRefreshButtonDisabled),z=(0,s.useEvent)(k.captchaPopupService.captchaRefreshed),V=(0,s.useStore)(k.captchaPopupService.$refreshCountdown),G=(0,o.useRef)(null),q=(0,o.useRef)(null),K=(0,o.useRef)(null),W=(0,o.useRef)(null),Y=(0,o.useRef)(null),Z=(0,o.useRef)(null),Q=(0,o.useRef)(null),J=(0,o.useRef)(null),X=!!x&&N===k.CaptchaType.AUDIO,[ee,te]=(0,o.useState)(!1),ae=(0,s.useStore)(k.captchaPopupService.$isAudioPlaying),ne=(0,o.useRef)(!1),oe=e=>{e.preventDefault(),A&&A(F,Number(N===k.CaptchaType.AUDIO))},se=(0,o.useCallback)((e=>{const t=J.current||Q.current||q.current,n=K.current,o=W.current,s=Y.current,r=G?.current?.inputFieldRef.current,i=G?.current?.inputLabelRef.current,c=Z.current,{activeElement:l}=document,d=[t,n,o,s,r,i,c].includes(l)?l:t;if("Space"===e.code&&[n,o,s,c,t].some((e=>d===e))){e.preventDefault();d.click()}function h(){X&&!o?.disabled?o?.focus():u()}function u(){s?.disabled?p():s?.focus()}function p(){X&&i?i?.focus():g()}function g(){r?.disabled?_():r?.focus()}function _(){E||!c?.disabled?c?.focus():m()}function m(){t?.focus()}if(a&&"Tab"===e.key&&!e.shiftKey&&d)switch(e.preventDefault(),d){case t:E||!n?.disabled?n?.focus():h();break;case n:h();break;case o:u();break;case s:p();break;case i:g();break;case r:_();break;case c:m()}function v(){r?.disabled?C():r?.focus()}function C(){X?i?.focus():f()}function f(){s?.disabled?b():s?.focus()}function b(){X?o?.focus():I()}function I(){E||!n?.disabled?n?.focus():S()}function S(){t?.focus()}if(a&&"Tab"===e.key&&e.shiftKey&&d)switch(e.preventDefault(),d){case t:E||!c?.disabled?c?.focus():v();break;case c:v();break;case r:C();break;case i:f();break;case s:b();break;case o:I();break;case n:S()}}),[a,E,X]);(0,o.useEffect)((()=>(document.removeEventListener("keydown",se),document.addEventListener("keydown",se),()=>{document.removeEventListener("keydown",se)})),[se]),(0,o.useEffect)((()=>{if(X){const e=e=>{e.ctrlKey&&!ae&&J?.current?.click()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}}),[X,ae]),(0,o.useEffect)((()=>{const e=q.current;!j&&N===k.CaptchaType.IMAGE&&e&&(e.tabIndex=0,e.ariaLabel=_.getLang("vkconnect_auth_captcha_image_aria_label"),e.focus()),j||N!==k.CaptchaType.AUDIO||J.current?.focus()}),[j,N]),(0,o.useEffect)((()=>{const e=Q.current;R&&e&&e.focus()}),[R]),(0,o.useEffect)((()=>{N!==k.CaptchaType.AUDIO||x||(ne.current=!0)}),[N,x]);return(0,n.jsxs)(r.ModalBox,{children:[(0,n.jsx)(g.ModalDismissButton,{onClick:P}),(0,n.jsx)(i.ModalBody,{insetLevel:1,children:(0,n.jsxs)(c.Div,{mode:"vertical",spacing:4,paddingTop:8,paddingBottom:8,children:[(0,n.jsxs)(l.Image,{getRef:q,alt:_.getLang("vkconnect_auth_captcha_image_aria_label"),src:N===k.CaptchaType.IMAGE?D:"",onLoad:M,onError:B,width:268,height:102,children:[j&&(0,n.jsx)(d.Spinner,{}),!j&&R&&(0,n.jsx)(C.CaptchaError,{ref:Q,captchaType:N}),!R&&N===k.CaptchaType.AUDIO&&(0,n.jsx)(v.SoundCaptcha,{ref:J,src:D,disabled:!E&&ae,shouldAutoPlayRef:ne,captchaType:N,isUiuxChangesEnabled:x,onAudioPlay:()=>{x||G?.current?.inputFieldRef.current?.focus()}})]}),(0,n.jsx)(h.Spacing,{size:6}),(0,n.jsxs)(u.ButtonGroup,{mode:"horizontal",stretched:!0,gap:"s",style:{justifyContent:"space-between"},children:[t&&(0,n.jsx)(f.CaptchaRefreshButton,{ref:K,newCaptchaUX:E,disabled:!E&&($||X&&(j||R)),countdownValue:V,captchaType:N,isUiuxChangesEnabled:x,onRefresh:()=>{N!==k.CaptchaType.AUDIO||x||(ne.current=!0),z(),E&&G?.current?.inputFieldRef.current?.focus()}}),(X||a)&&(0,n.jsxs)(u.ButtonGroup,{mode:"horizontal",gap:"s",children:[X&&(0,n.jsx)(w.CaptchaInfoButton,{ref:W,onClick:()=>{te((e=>!e))}}),a&&(0,n.jsx)(b.CaptchaTypeButton,{ref:Y,disabled:!E&&U,captchaType:N,onToggle:()=>{H(),E&&G?.current?.inputFieldRef.current?.focus()}})]})]}),X&&ee&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Spacing,{size:8}),(0,n.jsx)(y.InfoBanner,{})]}),(0,n.jsx)(h.Spacing,{size:16}),(0,n.jsxs)("form",{onSubmit:oe,children:[(0,n.jsx)(I.CaptchaAnswerField,{ref:G,disabled:X&&(j||R),captchaType:N,isUiuxChangesEnabled:x}),(0,n.jsx)(h.Spacing,{size:12}),(0,n.jsx)(u.ButtonGroup,{mode:"vertical",align:"center",stretched:!0,children:(0,n.jsx)(p.Button,{getRootRef:Z,size:"l",stretched:!0,disabled:!E&&(O||X&&(j||R)),onClick:oe,tabIndex:0,children:_.getLang("vkconnect_auth_captcha_submit_button")})})]})]})})]})}},121939:(e,t,a)=>{a.d(t,{CaptchaPopup:()=>n.CaptchaPopup});var n=a(901885)},698035:(e,t,a)=>{a.d(t,{CaptchaRefreshButton:()=>d});var n=a(474848),o=a(296540),s=a(573638),r=a(533048),i=a(234337),c=a(506537),l=a(610989);const d=(0,o.forwardRef)((({newCaptchaUX:e,disabled:t,countdownValue:a,captchaType:o,isUiuxChangesEnabled:d,onRefresh:h},u)=>(0,n.jsx)(r.Button,{getRootRef:u,disabled:t,size:"m",appearance:"neutral",mode:"tertiary",before:(0,n.jsx)(s.Icon24Refresh,{className:(0,i.getColorClass)("color_icon_secondary")}),"aria-label":o===c.CaptchaType.IMAGE?l.getLang("vkconnect_auth_captcha_refresh_button_aria_label"):o===c.CaptchaType.AUDIO?d?l.getLang("vkconnect_auth_captcha_refresh_audio_button_aria_label_new_ux"):l.getLang("vkconnect_auth_captcha_refresh_audio_button_aria_label"):void 0,tabIndex:0,onClick:h,children:e||!a?l.getLang("vkconnect_refresh_captcha"):(0,l.langReplace)(l.getLang("vkconnect_refresh_captcha_via"),{time:String(a)})})))},153391:(e,t,a)=>{a.d(t,{CaptchaTypeButton:()=>h});var n=a(474848),o=a(296540),s=a(506537),r=a(963328),i=a(16547),c=a(533048),l=a(234337),d=a(610989);const h=(0,o.forwardRef)((({disabled:e,captchaType:t,onToggle:a},o)=>(0,n.jsx)(c.Button,{getRootRef:o,disabled:e,size:"m",appearance:"neutral",mode:"tertiary",before:t===s.CaptchaType.IMAGE?(0,n.jsx)(r.Icon24Headphones,{className:(0,l.getColorClass)("color_icon_secondary")}):(0,n.jsx)(i.Icon24TextOutline,{className:(0,l.getColorClass)("color_icon_secondary")}),onClick:a,"aria-label":t===s.CaptchaType.IMAGE?d.getLang("vkconnect_auth_captcha_enable_audio_aria_label"):d.getLang("vkconnect_auth_captcha_enable_image_aria_label"),tabIndex:0})))},707695:(e,t,a)=>{a.d(t,{CaptchaTypeButton:()=>n.CaptchaTypeButton});var n=a(153391)},40041:(e,t,a)=>{a.d(t,{InfoBanner:()=>i});var n=a(474848),o=a(618168),s=a(610989),r=a(194620);const i=()=>(0,n.jsx)(o.Banner,{noPadding:!0,size:"s",subheader:s.getLang("vkconnect_auth_audio_captcha_info_text"),mode:"image",imageTheme:"light",background:(0,n.jsx)("div",{className:r.default.background})})},725405:(e,t,a)=>{a.d(t,{InfoBanner:()=>n.InfoBanner});var n=a(40041)},647283:(e,t,a)=>{a.d(t,{SoundCaptcha:()=>p});var n=a(474848),o=a(296540),s=a(426622),r=a(155581),i=a(234337),c=a(595154),l=a(610989),d=a(205726),h=a(293721),u=a(506537);const p=(0,o.forwardRef)((({src:e,disabled:t,shouldAutoPlayRef:a,captchaType:p,isUiuxChangesEnabled:g,onAudioPlay:_},m)=>{const v=(0,o.useRef)(null),C=(0,h.useEvent)(u.captchaPopupService.audioPlaying),f=(0,h.useEvent)(u.captchaPopupService.audioPaused),b=(0,h.useEvent)(u.captchaPopupService.captchaLoadingErrorSet),I=(0,h.useEvent)(u.captchaPopupService.captchaLoadingStarts),S=(0,h.useEvent)(u.captchaPopupService.captchaLoadingEnds),w=(0,h.useStore)(u.captchaPopupService.$isAudioPlaying),y=(0,h.useStore)(u.captchaPopupService.$captchaLoading),k=()=>{const e=v.current;e?.readyState||e?.load(),a.current=!1,e?.play().then((()=>{_&&_()})).catch((()=>{b()}))};(0,o.useEffect)((()=>{const t=v.current;e&&t&&t.load()}),[e]);return(0,n.jsxs)(n.Fragment,{children:[e&&(0,n.jsx)("audio",{ref:v,preload:"none",src:e,onLoadStart:I,onCanPlay:()=>{S(),p===u.CaptchaType.AUDIO&&!w&&a.current&&k()},onPlay:C,onPause:f,onError:b}),!y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.IconIllustrationSoundWaveLeft36h,{className:(0,i.getColorClass)(w?"color_icon_accent_themed":"color_icon_tertiary")}),(0,n.jsx)(c.IconButton,{getRootRef:m,size:52,disabled:t,"aria-label":g?l.getLang("vkconnect_auth_captcha_play_audio_button_aria_label_new_ux"):l.getLang("vkconnect_auth_captcha_play_audio_button_aria_label"),className:(0,i.getColorClass)("color_text_accent_themed"),tabIndex:0,onClick:k,children:(0,n.jsx)(d.Icon40PlayCircle,{})}),(0,n.jsx)(r.IconIllustrationSoundWaveRight36h,{className:(0,i.getColorClass)(w?"color_icon_accent_themed":"color_icon_tertiary")})]})]})}))},493192:(e,t,a)=>{a.d(t,{SoundCaptcha:()=>n.SoundCaptcha});var n=a(647283)},934905:(e,t,a)=>{a.d(t,{getDeviceId:()=>i});var n=a(623702),o=a(418562),s=a(506537);const r="vk_web_captcha_device_id",i=e=>{let t;switch(e){case s.Platform.VK_WEB:t=r;break;case s.Platform.VK_M_WEB:t="vk_m_web_captcha_device_id";break;default:t=r}let a=n.vkLocalStorage.getItem(t);return a||(a=(0,o.default)(),n.vkLocalStorage.setItem(t,a)),a}},977277:(e,t,a)=>{a.d(t,{ChatCreation:()=>w});var n,o=a(474848),s=a(296540),r=a(610989),i=a(605536),c=a(370832),l=a(832811),d=a(755536),h=a(655175),u=a(281850),p=a(533048),g=a(273414),_=a(133836),m=a(485413),v=a(803898),C=a(911575),f=a(808148),b=a(914098),I=a(177157),S=a(885658);!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(n||(n={}));const w=({store:e,uploadAvatar:t,onClose:a,onBack:n,onCreateChat:w,onGoToConvo:y,preselectedUsers:k})=>{const[x,L]=(0,s.useState)([]),[T,A]=(0,s.useState)(0),[P,E]=(0,s.useState)(0),[M,R]=(0,s.useState)(""),[j,B]=(0,s.useState)(""),[N,F]=(0,s.useState)(void 0),[D,O]=(0,s.useState)(k?new Map(k.map((e=>[e.id,(0,d.getTokenFromUserItem)(e)]))):new Map);(0,s.useEffect)((()=>{(function(e){const t=(0,m.unpackStore)(e);return t.hintsTree.then((t=>{const a=t.list.map((([e,t,a])=>({id:+e,peerId:+e,name:t,photo:a})));return function(e,t){return(0,b.checkContactListLoaded)(e).then((e=>{const a=e.get().contactsList.filter((e=>!e.user)).sort(((e,t)=>e.id<t.id?1:-1)).map((e=>({id:(0,I.getContactPeerId)(e.id),peerId:(0,I.getContactPeerId)(e.id),name:e.name,photo:e.photo||""}))),n=a.splice(0,a.length<3?a.length:3);return[...t.slice(0,4),...n,...t.slice(4),...a]}))}(e,a)}))})(e).then((e=>{if(k){const t=k.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),a=k.concat(e.filter((e=>!t[e.peerId])));L(a)}else L(e)})).then((()=>A(1))).catch((()=>{A(4)}))}),[]);const U=(0,v.debouncedPromise)(C.searchHints,300),H=(t,a)=>U(t,a,f.HintsSearchType.FRIENDS_AND_CONTACTS,{},e.get()),$=()=>{const t=Array.from(D.keys()),a=N||void 0;return e.set((e=>(0,_.createChatAction)(e,a,t,M,P))).then((e=>{const t=e.get().next_peer;w(t),(0,S.collectChatCreateStats)(t,"create_chat__create_new")}))},z=()=>{A(3),t().then((e=>{if(e.photo&&e.photoData){const{photo:t,photoData:a}=e;B(t),F(a)}else F(void 0);A(1)})).catch((()=>{A(4)}))},V=()=>{B(""),F(void 0)};switch(T){case 2:return(0,o.jsx)(c.ChatCreationModal,{title:r.getLang("mail_chat_creation_settings"),onClose:a,onBack:()=>A(1),children:(0,o.jsx)(l.ChatSettingsContainer,{flags:P,setFlags:E,onClose:()=>A(1)})});case 1:return(0,o.jsxs)(c.ChatCreationModal,{title:r.getLang("mail_im_create_chat"),onBack:n,onClose:a,children:[(0,o.jsx)(d.UsersListContainer,{usersList:x,selectedMap:D,setSelectedMap:O,onServerSearch:H}),(0,o.jsx)(h.ConvoInfoContainer,{title:M,photo:j,selectedUserIds:Array.from(D.keys()),onTitleChange:R,onShowSettings:()=>A(2),onCreateChat:$,onUploadAvatar:z,onRemoveAvatar:V,onGoToConvo:y})]});case 4:return(0,o.jsxs)(c.ChatCreationModal,{title:r.getLang("global_error"),onClose:a,children:[(0,o.jsx)(g.ModalBody,{children:(0,o.jsx)("p",{children:r.getLang("global_error")})}),(0,o.jsx)(u.ModalFooter,{actionButtons:(0,o.jsx)(p.Button,{mode:"primary",size:"m",onClick:a,children:r.getLang("global_close")})})]});case 0:return(0,o.jsx)(i.default,{});case 3:return(0,o.jsx)(o.Fragment,{})}}},532444:(e,t,a)=>{a.d(t,{ChatCreationInfo:()=>d});var n=a(474848),o=a(315464),s=a(290988),r=a(907196),i=a(533048),c=a(610989),l=a(439894);const d=({onChangeTitle:e,onShowSettings:t,onButtonClickHandler:a,title:d,photo:h,loading:u,onUploadAvatar:p,onRemoveAvatar:g,isButtonDisabled:_,buttonText:m})=>(0,n.jsxs)("div",{className:"ChatCreationInfo",children:[(0,n.jsxs)("div",{className:"ChatCreationInfo__avatarWrapper",children:[(0,n.jsx)(o.default,{photo:h,title:d,className:"ChatCreationInfo__avatar",onClick:p}),h&&(0,n.jsx)(s.default,{text:c.getLang("mail_settings_remove_photo"),position:"t",align:"left",children:(0,n.jsx)("button",{onClick:g,className:"ChatCreationInfo__avatarRemove"})})]}),(0,n.jsx)(r.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:d,onChange:t=>e(t.target.value),placeholder:c.getLang("mail_im_chat_title_intro")}),(0,n.jsx)(s.default,{text:c.getLang("mail_chat_creation_settings_icon_tooltip"),position:"t",children:(0,n.jsx)("button",{className:"ChatCreationInfo__settings",onClick:t,"aria-label":c.getLang("mail_chat_creation_settings_icon_tooltip"),children:(0,n.jsx)(l.Icon24Settings,{})})}),(0,n.jsx)(i.Button,{size:"m",mode:"primary",disabled:_,loading:u,onClick:a,children:m})]})},370832:(e,t,a)=>{a.d(t,{ChatCreationModal:()=>i});var n=a(474848),o=a(583652),s=a(496486),r=a(610989);const i=({children:e,title:t,onClose:a,onBack:i})=>(0,n.jsxs)(o.BaseModal,{onClose:a,disableBodyScroll:!0,className:"ChatCreationModal",children:[(0,n.jsx)(s.ModalHeader,{title:t,onClose:a,backText:i?r.getLang("global_back"):void 0,onBack:i}),(0,n.jsx)("div",{className:"ChatCreationModal__content",children:e})]})},364096:(e,t,a)=>{a.d(t,{ChatCreationUserRow:()=>l});var n=a(474848),o=a(711660),s=a(826380),r=a(599754),i=a(583790),c=a(83504);const l=({data:e,onSelect:t,isSelected:a})=>{const l=e.photo?e.photo:(0,n.jsx)(c.ConversationNoPhoto,{id:e.peerId,text:(0,i.getUserInitials)(e.name),size:"34",specificType:7});return(0,n.jsx)(s.default,{"data-id":e.peerId,onClick:()=>t(e.peerId),selectable:!0,aside:(0,n.jsx)(r.ListMultiSelectControl,{isSelected:a}),children:(0,n.jsx)(o.default,{"data-id":e.peerId,size:"34",title:e.name,photo:l})})}},720440:(e,t,a)=>{a.d(t,{ChatCreationUserList:()=>r});var n=a(474848),o=a(815724),s=a(610989);const r=({usersList:e,onRemoveToken:t,onChange:a,onSelect:r,renderSuggest:i,tokens:c,query:l})=>(0,n.jsx)(o.default,{className:"ChatCreationUserList",tokens:c,removeTokenPlaceholder:s.getLang("mail_create_chat_remove_user"),onRemoveToken:t,placeholder:s.getLang("mail_search_creation"),value:l,onChange:a,onSelect:r,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:()=>{},notFoundText:s.getLang("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:i,data:e})},832811:(e,t,a)=>{a.d(t,{ChatSettingsContainer:()=>s});var n=a(474848),o=a(603640);const s=({setFlags:e,flags:t,onClose:a})=>(0,n.jsx)(o.ChatSettingsOptions,{flags:t,back:a,isChatCreation:!0,onSave:t=>(e(t),Promise.resolve()),afterSave:a})},655175:(e,t,a)=>{a.d(t,{ConvoInfoContainer:()=>i});var n=a(474848),o=a(532444),s=a(296540),r=a(610989);const i=({title:e,photo:t,selectedUserIds:a,onShowSettings:i,onTitleChange:l,onCreateChat:d,onUploadAvatar:h,onRemoveAvatar:u,onGoToConvo:p})=>{const[g,_]=(0,s.useState)(!1),[m,v]=(0,s.useState)(!c(e)),C=1===a.length&&!m&&!t,f=0!==a.length||m,b=(0,s.useCallback)((e=>{v(!c(e)),l(e)}),[]),I=!C&&!f,S=C?r.getLang("mail_im_go_to_dialog"):r.getLang("mail_im_create_chat");return(0,n.jsx)(o.ChatCreationInfo,{title:e,onResetTitle:()=>b(""),onChangeTitle:b,photo:t,onShowSettings:i,onButtonClickHandler:()=>{if(!g)if(_(!0),C){const[e]=a;p(+e)}else d().catch((()=>{_(!1)}))},loading:g,isButtonDisabled:I,onUploadAvatar:h,onRemoveAvatar:u,buttonText:S})};function c(e){return!e.trim().replace("\n","")}},755536:(e,t,a)=>{a.d(t,{UsersListContainer:()=>l,getTokenFromUserItem:()=>h});var n=a(474848),o=a(296540),s=a(720440),r=a(364096),i=a(500741),c=a(8520);const l=({usersList:e,selectedMap:t,setSelectedMap:a,onServerSearch:c})=>{const[l,u]=(0,o.useState)(""),[p,g]=(0,o.useState)(e.map((e=>e.peerId))),_=(0,o.useRef)(d(e)),m=(0,o.useCallback)((e=>e.name),[]),v=(0,o.useCallback)((e=>e.peerId),[]),C=(0,i.useIndexer)(Array.from(_.current.values()),m,v),f=(0,o.useMemo)((()=>Array.from(_.current.keys())),[_.current]),b=(0,o.useCallback)(((e,t)=>c(e,t)),[c]);(0,o.useEffect)((()=>{const e=C.search(l).map((e=>e.peerId));g(e),b(l,e).then((t=>{if(0!==l.length){const a=[],n=[];t.forEach((e=>{_.current.has(e.peerId)||(n.push(e.peerId),a.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),a.length&&(!function(e,t){const a=d(t);e.current=new Map([...Array.from(e.current.entries()),...Array.from(a.entries())])}(_,a),g([...e,...n]))}})).catch((()=>{}))}),[l]);const I=e=>{t.delete(e),a((()=>new Map(t)))},S=e=>{t.has(e)?I(e):((e=>{const n=_.current.get(e);n&&(t.set(e,h(n)),a((()=>new Map(t))))})(e),u(""))},w=(0,o.useCallback)((e=>{I(+e)}),[t]),y=(0,o.useCallback)((e=>{u(e.target.value)}),[l]),k=Array.from(t.values());return(0,n.jsx)(s.ChatCreationUserList,{query:l,tokens:k,usersList:l?p:f,onSelect:S,onChange:y,onRemoveToken:w,renderSuggest:e=>{const a=_.current.get(e);return a?(0,n.jsx)(r.ChatCreationUserRow,{data:a,onSelect:S,isSelected:t.has(e)},e):(0,n.jsx)(n.Fragment,{})}})};function d(e){return e.reduce(((e,t)=>(t.name=(0,c.decodeHTMLEntities)(t.name),e.set(t.id,t))),new Map)}function h(e){return{id:e.id.toString(),text:e.name}}},514051:(e,t,a)=>{a.d(t,{ContactPopup:()=>h});var n=a(474848),o=a(296540),s=a(583652),r=a(929528),i=a(710689),c=a(605536),l=a(610989),d=a(507035);const h=({getContactInfo:e,onClose:t})=>{const[a,h]=(0,o.useState)({kind:"loading"});switch((0,o.useEffect)((()=>{const a=e=>{(0,d.showErrorBox)(e),h({kind:"failed"}),t()};e().then((e=>{e?h({kind:"loaded",contact:e}):a(l.getLang("mail_contact_was_removed"))})).catch((()=>{a(l.getLang("global_error"))}))}),[]),a.kind){case"failed":return(0,n.jsx)(n.Fragment,{});case"loading":return(0,n.jsx)(c.default,{});case"loaded":return(0,n.jsxs)(s.BaseModal,{onClose:t,className:"ContactPopup",children:[(0,n.jsx)(r.Modal.Header,{title:l.getLang("mail_contact"),onClose:t}),(0,n.jsx)(i.ContactPopupContent,{contact:a.contact})]})}}},159269:(e,t,a)=>{a.d(t,{ContactIconRow:()=>d});var n=a(474848),o=a(70252),s=a(375899),r=a(679804),i=a(900421),c=a(616140);const l=e=>{switch(e){case"phone":return(0,n.jsx)(o.Icon20PhoneOutline,{});case"mail":return(0,n.jsx)(s.Icon20MailOutline,{});case"calendar":return(0,n.jsx)(r.Icon20CalendarOutline,{});case"location":return(0,n.jsx)(i.Icon20PlaceOutline,{});case"sync":return(0,n.jsx)(c.Icon20Sync,{})}},d=({icon:e,children:t})=>(0,n.jsxs)("div",{className:"ContactIconRow",children:[(0,n.jsx)("div",{className:"ContactIconRow__icon",children:l(e)}),(0,n.jsx)("div",{className:"ContactIconRow__text",children:t})]})},710689:(e,t,a)=>{a.d(t,{ContactPopupContent:()=>d});var n=a(474848),o=a(583790),s=a(159269),r=a(83504),i=a(102846),c=a(610989),l=a(177157);const d=({contact:e})=>{const t=(0,l.getContactPeerId)(e.id);return(0,n.jsxs)("div",{className:"ContactPopupContent",children:[(0,n.jsxs)("header",{className:"ContactPopupContent__header",children:[(0,n.jsx)("div",{className:"ContactPopupContent__photo",children:e.photo?(0,n.jsx)("img",{className:"ContactPopupContent__contactAvatarImage",src:e.photo,alt:e.name}):(0,n.jsx)(r.ConversationNoPhoto,{text:(0,o.getUserInitials)(e.name),size:"80",id:t,specificType:7},e.id)}),(0,n.jsx)("h3",{className:"ContactPopupContent__title",children:(0,n.jsx)(i.InnerHTML,{children:(0,o.prepareContactName)(e.name)})}),(0,n.jsx)("div",{className:"ContactPopupContent__meta",children:c.getLang("mail_from_contacts_list")})]}),(0,n.jsxs)("div",{className:"ContactPopupContent__info",children:[e.main_phone&&(0,n.jsx)(s.ContactIconRow,{icon:"phone",children:(0,o.formatPhoneNumber)(e.main_phone)}),e.emails[0]&&(0,n.jsx)(s.ContactIconRow,{icon:"mail",children:(0,n.jsx)("a",{href:`mailto:${e.emails[0]}`,children:e.emails[0]})})]}),e.sync_date&&(0,n.jsx)("div",{className:"ContactPopupContent__info",children:(0,n.jsx)(s.ContactIconRow,{icon:"sync",children:e.sync_date})})]})}},167093:(e,t,a)=>{a.d(t,{ConvoPicker:()=>f,convoPickerMode:()=>n});var n,o=a(474848),s=a(296540),r=a(8520),i=a(440961),c=a(776132),l=a(923594),d=a(828902),h=a(897252),u=a(945154),p=a(610989),g=a(807476),_=a(583790),m=a(826380),v=a(965266),C=a(321935);!function(e){e.DEFAULT="default",e.RADIO="radio"}(n||(n={}));const f=({searchValue:e="",isLoading:t=!1,convos:a,mode:n="default",selectedConvos:C=[],checkDisabled:f,onSearchValueChange:I,onSearchInputKeydown:S,onConvoSelect:w,onListLoadMore:y=(()=>{}),onAddClick:k,searchInputGetter:x,className:L,style:T,...A})=>{const P=(0,r.classNames)("ConvoPicker",L),E=(0,s.createRef)();let M;const[R,j]=(0,s.useState)(0),B=e=>{const t=Math.max(e-1,0);return f&&f(a[t])?B(t):t},N=e=>{const t=Math.min(e+1,a.length-1);return f&&f(a[t])?N(t):t},F=e=>{e!==R&&(j(e),(e=>{if(!M)return;const t=a[e].peerId,n=M.querySelector(`[data-id="${t}"]`);if(!(n&&n instanceof HTMLElement))return;const o=n.offsetTop,s=M.scrollTop;if(o<s)M.scrollTop=o;else{const e=M.offsetHeight,t=o+n.offsetHeight;t>s+e&&(M.scrollTop=t-e)}})(e))};(0,s.useEffect)((()=>{x&&E.current&&x(E.current)}),[]);const D=!!k&&!e,O=(D?[(0,o.jsx)(m.default,{selectable:!1,"data-id":0,children:(0,o.jsx)(v.ListAddControl,{onClick:k,size:34,children:p.getLang("mail_new_convo_from_invite")})},"add")]:[]).concat(a.map(((e,t)=>{const{peerId:a,photo:s,name:r,online:i}=e,c=!!f&&f(e);return(0,o.jsx)(g.ConvoPickerRow,{"data-id":a,peerId:a,photo:s,name:r,online:i,memberCount:(0,_.getChatMemberCount)(e),mode:n,isCasper:b(e),isSelected:C.includes(a),isActive:t===R,isDisabled:c,onClick:()=>{c||w(a)},onMouseEnter:()=>j(c?-1:t)},a)})));return(0,o.jsxs)("div",{className:P,onMouseLeave:()=>j(-1),style:T,...A,children:[(0,o.jsx)(c.BlockSearchInput,{value:e,onChange:I,onKeyDown:e=>{switch(e.which||e.keyCode){case u.ARROW_UP:F(B(R)),e.preventDefault();break;case u.ARROW_DOWN:F(N(R)),e.preventDefault();break;case u.ENTER:w(a[R].peerId),e.preventDefault()}S(e)},placeholder:p.getLang("mail_top_search"),autoFocus:!0,getRef:E},"search"),t&&(0,o.jsx)(l.Placeholder,{children:(0,o.jsx)(d.Spinner,{})}),!t&&e&&0===a.length&&(0,o.jsx)(l.Placeholder,{children:p.getLang("mail_im_search_empty_chats")}),!t&&(a.length>0||D)&&(0,o.jsx)(h.default,{virtualized:!0,className:"ConvoPicker__results",loadMore:y,hasMore:!1,ref:e=>{const t=i.findDOMNode(e);t&&t instanceof HTMLElement&&(M=t)},children:O},"results")]})};function b(e){const t=e.data?.flags;return!!t&&(t&C.MAIL_CHAT_FLAG_IS_CASPER)>0}},807476:(e,t,a)=>{a.d(t,{ConvoPickerRow:()=>g});var n=a(474848),o=a(8520),s=a(826380),r=a(711660),i=a(583790),c=a(167093),l=a(720988),d=a(83504),h=a(315464),u=a(714209),p=a(388078);const g=({peerId:e,name:t,photo:a,online:g,memberCount:_,mode:m=c.convoPickerMode.DEFAULT,isSelected:v,isDisabled:C,isActive:f,isCasper:b,className:I,...S})=>{const w=function(e,t,a,o=0){const s=p.Ranges.isContactId(e);if(Array.isArray(a))return(0,n.jsx)(l.default,{photos:a});if(s)return(0,n.jsx)(d.ConversationNoPhoto,{id:e,text:(0,i.getUserInitials)(t),size:"34",specificType:7});return(0,n.jsx)(h.default,{isOnline:!!o,isMobile:!!u.mobPlatforms[o],title:t,photo:a,onlineSize:"s"})}(e,t,a,g),y=b?`<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          ${t}\n        </span>\n      </span>`:t,k=m===c.convoPickerMode.RADIO?(0,n.jsx)("span",{className:(0,o.classNames)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":v})}):void 0,x=(0,o.classNames)("ConvoPickerRow",I,{"ConvoPickerRow--disabled":C});return(0,n.jsx)(s.default,{active:f,selectable:!C,canBeHovered:!1,chevron:m===c.convoPickerMode.DEFAULT&&!C,aside:k,className:x,...S,children:(0,n.jsx)(r.default,{ignoreDecodeHTML:!0,size:"34",title:(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:y}}),photo:w,description:_,className:"ConvoPickerRow__itemContent"})})}},389383:(e,t,a)=>{a.d(t,{MessageForward:()=>L});var n=a(474848),o=a(296540),s=a(8520),r=a(850101),i=a(125852),c=a(828902),l=a(167093),d=a(948350),h=a(803898),u=a(583790),p=a(693143),g=a(531868),_=a(958145),m=a(610989),v=a(471424),C=a(523977),f=a(428280),b=a(20025),I=a(177157),S=a(390768),w=a(955599),y=a(388078);const k=(0,h.debouncedPromise)(d.searchHints,300);class x extends o.Component{componentDidMount(){this.props.updatePopup();const e={noStickers:!0,onSend:this.send};window.Emoji.init(this.input,e),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){const{store:e,closePopup:t}=this.props,{mode:a,loading:o,selected:r,found:d,sending:h}=this.state,u=(0,s.classNames)("MessageForward",{"MessageForward--form":0===a&&!!r});return(0,n.jsxs)("section",{className:u,children:[(0,n.jsx)(i.ModalHeader,{indicator:(0,p.isCommunityInterface)(e)&&(0,n.jsx)("span",{className:"MessageForward__switch",onClick:this.toggleMode,children:0===a?m.getLang("mail_forward_to_community_messages"):m.getLang("mail_forward_to_im")}),onClose:t,closeAriaLabel:m.getLang("global_close"),children:m.getLang("mail_forward_messages")}),(0,n.jsxs)("div",{className:"MessageForward__content",children:[(0,n.jsx)(l.ConvoPicker,{searchValue:this.state.value,isLoading:o,convos:d.map((t=>t||(0,p.getTab)(e,t.peerId))),mode:1===a?l.convoPickerMode.DEFAULT:l.convoPickerMode.RADIO,selectedConvos:[r],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),(0,n.jsxs)("footer",{className:"MessageForward__footer",ref:this.getFormRef,children:[(0,n.jsxs)("div",{className:"MessageForward__form _emoji_field_wrap",children:[(0,n.jsx)("div",{className:"MessageForward__input",tabIndex:0,contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:m.getLang("mail_im_enter_msg")}),(0,n.jsx)("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap",children:(0,n.jsx)("div",{ref:this.getEmojiButtonRef,"data-testid":"message-forward-emoji-smile",className:"emoji_smile _emoji_btn",title:m.getLang("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,children:(0,n.jsx)(S.Icon24SmileOutline,{})})})]}),h?(0,n.jsx)("div",{className:"MessageForward__send-spinner",children:(0,n.jsx)(c.Spinner,{})}):(0,n.jsx)("button",{className:"MessageForward__send",onClick:this.send,children:(0,n.jsx)(w.Icon24Send,{})})]},"footer")]})]})}constructor(e){super(e),this.toggleMode=()=>{const e=this.props.store;if((0,p.isCommunityInterface)(e)){const t=0===this.state.mode?1:0,a=0===t?d.searchImTopConv:d.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},(()=>a("",e.get()).then((e=>this.setSearchResults(this.filterResults(e)))).then((()=>this.searchInput.focus())).catch((e=>console.error(e)))))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});const{value:t}=e.target;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{const t=(0,p.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter((e=>{const a=e.peerId;return(!t||!y.Ranges.isGroupId(a))&&(!(t&&y.Ranges.isChatOrChannelPeer(a)&&!(0,g.doesChatTabHaveFlag)(e,1024))&&!(!t&&y.Ranges.isChatOrChannelPeer(a)&&(0,g.doesChatTabHaveFlag)(e,1024)))}))},this.onSearch=e=>{const{store:t}=this.props,a=t.get(),n=(0,p.isCommunityInterface)(t)&&0===this.state.mode,o=n?d.searchImTopConv:d.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})):o(e,a).then((t=>{const o=t.map((e=>e.peerId));return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?k(e,o,"all",{hidegid:n},a):Promise.resolve([])})).then((t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)})).catch((()=>{}))},this.emptySearch=()=>{const{store:e}=this.props,t=e.get(),a=t.dialog_tabs.all;let n={},o={};return(0,d.searchTopConv)("",t).then((s=>{s.forEach((e=>{o[e.peerId]=e}));return[t.peer].concat(a.filter((e=>e!==t.peer))).map((t=>{const a=(0,p.getTab)(e,t);return n[t]=!0,{name:o[t]&&o[t].tab||a.tab,photo:o[t]&&o[t].photo||a.photo,lastmsg:a.lastmsg,major_sort_id:a.major_sort_id,minor_sort_id:a.minor_sort_id,data:a.data,peerId:t}})).concat(s.filter((e=>!n[e.peerId]))).sort(((a,n)=>a.peerId===t.peer?-1:n.peerId===t.peer?1:(0,I.sortFn)(e,a,n)))}))},this.sendRecipient=e=>{const t=this.props.store,a=t.get();1===this.state.mode?(a.longpoll?.push([(0,_.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),(0,v.statlogsForwardEvent)(t),(0,p.isCommunityInterface)(t)&&(0,v.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},(()=>{window.Emoji.focus(this.input)}))},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=(e,t,a=!1)=>{if(!this.unmounted)if(t){const t=e.filter((e=>!this.found[e.peerId]));t.forEach((e=>{this.found[e.peerId]=!0})),this.setState({found:[...this.state.found,...t],loading:a})}else this.found=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),this.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),window.Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),window.Emoji.hide(this.emojiButton,e)},this.send=()=>{const e=this.props.store,t=this.state.selected,a=window.Emoji.val(this.input).trim(),n=new C.ImDraft({},0),o=e.get().pendingForward;if(t&&!(0,u.isMessageTooLong)(a)){this.setState({sending:!0});const s=(0,p.isCommunityInterface)(e)&&0===this.state.mode;s||n.addAttach("mail",o?.msgIds.join(";"),o?.object||null);const i={message:a,attaches:n.dData.attaches.map((e=>[e.type,e.id]))||[]},c={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:s?o?.msgIds.join(";"):void 0}};new Promise((a=>{(0,d.loadHashes)([t],{hidegid:!0},e.get()).then((([e])=>a(e[t])))})).then((a=>e.set(d.sendMessage.bind(null,t,i,{hash:a,...c})))).then((()=>{(0,v.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),(0,r.showDoneBox)(m.getLang("mail_send3"))})).catch((e=>{this.unmounted||this.setState({sending:!1},(()=>{(0,b.showFastBox)(m.getLang("mail_error"),e)}))}))}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(window.Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})).catch((e=>console.error(e)))}}const L=(0,f.connect)(x)},393852:(e,t,a)=>{a.d(t,{UserConvoInviteContainer:()=>T});var n,o=a(474848),s=a(296540),r=a(759880),i=a(281850),c=a(415782),l=a(167093),d=a(133836),h=a(40473),u=a(531868),p=a(20025),g=a(610989),_=a(605536),m=a(911575),v=a(645024),C=a(349333),f=a(533243),b=a(805340),I=a(723561),S=a(177157),w=a(808148),y=a(977277),k=a(518289),x=a(885658),L=a(388078);!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(n||(n={}));const T=({user:e,store:t,onClose:a,onInviteSent:n,onGoToConvo:T})=>{const[A,P]=(0,s.useState)(0),[E,M]=(0,s.useState)(!function(e){const t=e.get(),a=t.chatList||t.dialog_tabs?.all;return Boolean(a&&a.length>0)}(t)),[R,j]=(0,s.useState)(!0),[B,N]=(0,s.useState)(!1),[F,D]=(0,s.useState)(function(e){const t=e.get(),a=t.chatList||(t.dialog_tabs?.all||[]).filter(L.Ranges.isChatOrChannelPeer);if(a&&a.length>0)return a.map((t=>(0,u.getTab)(e,t)));return[]}(t)),[O,U]=(0,s.useState)(""),H=(0,s.useCallback)((e=>{U(e.target.value)}),[O]),$=(0,s.useCallback)((()=>{}),[]),z=(0,s.useRef)(null),[V,G]=(0,b.useHints)(t,F,O,{queryType:w.HintsSearchType.ALL,filterFn:e=>L.Ranges.isChatOrChannelPeer(e.peerId)});(0,s.useEffect)((()=>((0,m.loadConversations)(t.get(),h.ConvoFilters.CHATS,200).then((e=>{const t=e.items;return D((0,S.mergeConvoLists)(F,t)),t})).then((e=>{const a=e.reduce(((e,t)=>(e[t.peerId]=t,e)),{});return t.set((t=>(0,f.mergeTabs)(t,a).then((t=>(0,C.setChatList)(t,e.map((e=>e.peerId)))))))})).finally((()=>M(!1))),(0,I.cancelStackPush)("convo_invite",(()=>{})),()=>{setTimeout((()=>(0,I.cancelStackFilter)("convo_invite")),0)})),[]);const q=e.inv_name?(0,v.langStr)((0,v.langSex)(e.sex,g.getLang("mail_im_invite_user","raw")),"user",e.inv_name):g.getLang("mail_convo_invite_title");return(0,o.jsxs)(o.Fragment,{children:[0===A&&(0,o.jsx)(r.UserConvoInviteModal,{title:q,onCloseModal:a,footer:(0,o.jsx)(i.ModalFooter,{children:(0,o.jsx)(c.Checkbox,{noPadding:!0,stretched:!1,checked:R,onChange:e=>j(e.target.checked),children:g.getLang("mail_im_chat_add_members_show_history")})}),children:(0,o.jsx)(l.ConvoPicker,{convos:V.map((e=>(0,u.getTab)(t,e.peerId)||e)),searchValue:O,onSearchValueChange:H,onSearchInputKeydown:$,onConvoSelect:o=>{N(!0),Promise.resolve().then((()=>t.set((t=>(0,d.addNewMember)(o,[e.id],R,t))))).then((()=>n(o))).then((()=>{a(),N(!1)})).catch((e=>{N(!1),(0,p.showFastBox)(g.getLang("global_error"),e)}))},checkDisabled:e=>!e.canInvite,searchInputGetter:e=>z.current=e,isLoading:E||G&&0===V.length,style:{height:410},onAddClick:()=>P(1)})}),1===A&&(0,o.jsx)(y.ChatCreation,{store:t,uploadAvatar:k.uploadConvoPhoto,onClose:a,onBack:()=>P(0),onCreateChat:e=>{n(e).then((()=>{}),(()=>{})),a(),(0,x.collectChatCreateStats)(e,"create_chat__create_invite")},onGoToConvo:e=>{T(e),a()},preselectedUsers:[{id:e.id,peerId:e.id,name:e.name,photo:e.photo}]}),B&&(0,o.jsx)(_.default,{})]})}},759880:(e,t,a)=>{a.d(t,{UserConvoInviteModal:()=>i});var n=a(474848),o=a(583652),s=a(610989),r=a(496486);const i=({title:e,onCloseModal:t,footer:a,isWithBackButton:i=!1,onBackClick:c,children:l})=>(0,n.jsxs)(o.BaseModal,{className:"UserConvoInviteModal",disableBodyScroll:!0,onClose:t,children:[(0,n.jsx)(r.ModalHeader,{title:e,onClose:t,backText:i?s.getLang("global_back"):void 0,onBack:c,className:"UserConvoInviteModal__header"}),(0,n.jsx)("div",{className:"UserConvoInviteModal__content",children:l}),a]})},712178:(e,t,a)=>{a.d(t,{mount:()=>C});var n=a(474848),o=a(365485),s=a(452314),r=a(850101),i=a(440961),c=a(428280),l=a(505954),d=a(389383),h=a(948350),u=a(20025);let p;function g(){p&&p.hide()}function _(){p&&p.updateBoxCoords()}function m(){return document.querySelector("#MessageForward")}function v(e){const t=document.querySelector("#box_layer_wrap"),a=document.querySelector("#box_loader"),n=(0,s.isVisible)(t);return{unmount(){const t=m();t&&i.unmountComponentAtNode(t),(0,o.destroyModule)(e)},showLoader(){(0,r.boxRefreshCoords)(a),(0,s.show)(a),n||(0,s.show)(t)},hideLoader(){(0,s.hide)(a),n||(0,s.hide)(t)}}}function C(e){const{bindMutations:t}=(0,o.createMutations)(v),a=t((0,o.createModule)({handlers:()=>{}})),s={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){const t=m();t&&i.render((0,n.jsx)(l.AppRootProvider,{children:(0,n.jsx)(c.default,{value:e,children:(0,n.jsx)(d.MessageForward,{closePopup:g,updatePopup:_})})}),t)}(e),requestAnimationFrame((()=>p.updateBoxCoords()))},onHideAttempt:()=>(e.set(h.prepareForward.bind(null,null)),e.set(h.cleanSelected),a.unmount(),!0)};return a.showLoader(),Promise.resolve().then((()=>{a.hideLoader(),p=new u.MessageBox(s).content('<div id="MessageForward"></div>').show()})),a}},911326:(e,t,a)=>{a.d(t,{mount:()=>d});var n=a(474848),o=a(365485),s=a(440961),r=a(393852),i=a(505954);function c(){const e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;const a=document.createElement("section");return a.setAttribute("id",e),document.body.appendChild(a),a}function l(e){return{unmount:()=>{const t=c();t&&s.unmountComponentAtNode(t),(0,o.destroyModule)(e)}}}function d(e,t,a,d){const{bindMutations:h}=(0,o.createMutations)(l),u=h((0,o.createModule)({handlers:()=>{}}));return function(e,t,a,o,l){const d=c();s.render((0,n.jsx)(i.AppRootProvider,{children:(0,n.jsx)(r.UserConvoInviteContainer,{user:a,store:e,onClose:t.unmount,onInviteSent:o,onGoToConvo:l})}),d)}(e,u,t,a,d),u}},510353:(e,t,a)=>{a.r(t),a.d(t,{showGroupChatInviteBox:()=>w});var n=a(474848),o=a(296540),s=a(8520),r=a(753457),i=a(209642),c=a(125852),l=a(785118),d=a(451538),h=a(414698),u=a(966576),p=a(533048),g=a(377788),_=a(610989),m=a(618913),v=a(850101),C=a(20025),f=a(211981),b=a(60551),I=a(272259);class S extends o.Component{onRemoveToken(e){return e=Number(e),this.setState({selected:this.state.selected.filter((t=>t!==e))}),Promise.resolve()}onChange(e){this.isSearching=!0;const t=e.target.value;this.searchChats(t,((e,t)=>{this.abortOngoingRequest&&this.abortOngoingRequest(),this.abortOngoingRequest=e,t.then((e=>{e.forEach((e=>{this.data[e.peer_id]||this.indexer.add(e),this.data[e.peer_id]=e})),this.isSearching=!1,this.setState({found:(0,s.uniqueArray)(this.state.found.concat(e.map((e=>Number(e.peer_id)))))})})).catch((e=>{(0,m.debugLog)("cancelled promise",e)}))})),this.setState({value:t,found:(0,s.uniqueArray)(this.indexer.search(t).map((e=>Number(e.peer_id))))})}onSelect(e){let t;e=Number(e),t=this.state.selected.includes(e)?this.state.selected.filter((t=>t!==e)):this.state.selected.concat(e),t=t.slice(0,10);let a=this.state.value;return t.length!==this.state.selected.length&&(a=""),this.setState({selected:t,value:a}),Promise.resolve()}onAddBots(){this.setState({loading:!0});const e=this.state.selected;var t,a,n;(t=-this.props.groupId,a=e,n=this.props.addHash,new Promise(((e,o)=>{window.ajax.post("/al_im.php",{act:"a_add_bots_to_chat",bot_id:t,peer_ids:a.join(","),add_hash:n},{onDone(t){e(t)},onFail:e=>(o(e),!0)})}))).then((e=>{this.props.onClose(),(0,v.showDoneBox)(e)})).catch((e=>((0,C.showFastBox)(_.getLang("global_error"),e),!0))).finally((()=>{this.setState({loading:!1})}))}render(){const{selected:e,value:t}=this.state,a=Object.keys(e).length,o=""===t?this.state.defaultData:this.state.found;return(0,n.jsxs)(i.ModalBox,{children:[(0,n.jsx)(c.ModalHeader,{closeAriaLabel:_.getLang("global_close"),onClose:()=>this.props.onClose(),children:this.props.title}),(0,n.jsx)(l.Div,{className:b.default.container,children:(0,n.jsx)(d.ChipsInputCellList,{value:e.map((e=>({value:e,label:(0,s.decodeHTMLEntities)(this.data[e].name),removeAriaLabel:_.getLang("groups_invite_chat_remove")}))),onChange:e=>{this.setState({selected:e.map((e=>e.value))})},placeholder:_.getLang("groups_invite_chat_search"),inputValue:t,onInputChange:e=>{this.onChange(e)},hasScroll:!0,isEmpty:!o.length,emptyPlaceholderText:t.length?_.getLang("groups_invite_chat_not_found"):_.getLang("groups_invite_chat_no_chats"),autoFocus:!0,children:o.map((t=>{const a=this.data[t],{photo:o,name:i}=a,c=(0,s.decodeHTMLEntities)(i),l=e.includes(t);return(0,n.jsx)(r.Cell,{mode:"selectable",checked:l,onChange:()=>this.onSelect(t),before:"string"==typeof o?(0,n.jsx)(h.Avatar,{size:34,src:o}):(0,n.jsx)(h.Avatar,{size:34,initials:Array.from(c)[0],gradientColor:(0,r.calcInitialsAvatarColor)(t)}),badgeAfterTitle:a.is_casper?(0,n.jsx)(g.Icon16Ghost,{}):null,children:c},t)}))})}),(0,n.jsx)(u.ModalFooter,{actions:(0,n.jsx)(p.Button,{size:"m",mode:"primary",disabled:0===a,onClick:this.onAddBots.bind(this),loading:this.state.loading,children:_.getLang("groups_invite_chat_invite")})})]})}constructor(e){super(e),this.searchChats=(0,s.debounce)(((e,t)=>{const{abort:a,promise:n}=function(e,t){let a,n;const o=new Promise(((o,s)=>{a=s,n=window.ajax.post("/al_im.php",{act:"a_search_chats",q:e,group_id:t},{onDone(e){o(e)},onFail:()=>!0})}));return{abort(){n.abort(),a()},promise:o}}(e,this.props.groupId);t(a,n)}),200),this.indexer=new f.vkIndexer([],(e=>e.name)),this.data={},e.initialData.forEach((e=>{this.data[e.peer_id]||this.indexer.add(e),this.data[e.peer_id]=e})),this.state={selected:[],value:"",loading:!1,found:[],defaultData:e.initialData.map((e=>Number(e.peer_id)))}}}const w=e=>{window.ajax.post("/al_groups.php",{act:"a_search_chats_box",group_id:e},{onDone(t){!function(e,t){(0,I.showMessageBoxModal)((a=>(0,n.jsx)(S,{...a,title:e.title,initialData:e.results.map((e=>({...e,peer_id:Number(e.peer_id)}))),addHash:e.add_hash,groupId:t})),{width:560})}((0,s.decodeHTMLEntitiesDeep)(t),e)},showProgress:()=>(0,v.showBoxLoader)(),hideProgress:()=>(0,v.hideBoxLoader)()})}},505821:(e,t,a)=>{a.d(t,{handleUiActionForPeer:()=>A});var n=a(822317),o=a(583790),s=a(948350),r=a(927984),i=a(958145),c=a(610989),l=a(20025),d=a(911575),h=a(507035),u=a(885658),p=a(199835),g=a(635903),_=a(205922),m=a(911326),v=a(800855),C=a(52554),f=a(879007),b=a(248298),I=a(411953),S=a(533243),w=a(850101),y=a(531868),k=a(891911),x=a(520581),L=a(476726),T=a(678041);function A(e,t,a,A,P,E,M=(e=>console.error("im_ui_action",{error:e},!1))){switch(A){case n.ConvoAction.CLEAR:{const a=(0,y.getTab)(e,P);let n=(0,o.showFlushChat)(a,P,(()=>{(0,o.cleanHistory)(e,n,t,s.flushHistory,P)}));break}case n.ConvoAction.MEDIA:(0,L.partConfigEnabled)("me_fc_attaches_new_modal")?E.show(P):(0,r.showWiki)({w:"history"+(0,o.convertPeerToUrl)(P)+"_photo"},null,{});break;case n.ConvoAction.CALL_AUDIO:case n.ConvoAction.CALL_VIDEO:(0,o.isCallToPeerAvailable)(e,P)&&(0,o.startCallFromIm)(e,P,A===n.ConvoAction.CALL_VIDEO,[],o.CALL_ENTRY_POINT_HEADER);break;case n.ConvoAction.CALL_APP:(0,o.isCallToPeerAvailable)(e,P)&&window.Calls?.showStartCallModal&&(0,o.startCallFromIm)(e,P,!1,[],o.CALL_ENTRY_POINT_HEADER,!0);break;case n.ConvoAction.CALL_BY_NAME:(0,o.isCallToPeerAvailable)(e,P)&&window.Calls?.showCallByNamePopup&&(0,o.startCallFromIm)(e,P,!1,[],o.CALL_ENTRY_POINT_HEADER,!1,!0);break;case n.ConvoAction.SEARCH:t().showSearch?.(e);break;case n.ConvoAction.ADD_FRIEND:{const a=e.get().tabs[P],n=(0,_.oCacheGet)(e,P);if(!a||!n)return;const o={type:"done_box",text:a.is_subscribed_to_me?c.getLang("mail_im_friend_added").replace("{name}",n.first_name_gen):(0,c.langSex)(n.sex,c.getLang("mail_im_friend_request_sent","raw")).replace("{name}",n.first_name)};e.set((e=>(0,x.setPeerSubscribedStatus)(P,!1,e))).then((()=>e.set(S.setActions))).then((()=>{(0,p.showNotification)(o),t().updateState?.(P,e),t().updateActions?.(e)})).catch(M);break}case n.ConvoAction.BLOCK_NOTIFY:case n.ConvoAction.BLOCK_COMMUNITY:e.set(s.toggleCommunityMessages.bind(null,!1,P)).then((()=>{e.get()?.longpoll?.push([(0,i.resetPeer)()]),(0,w.showDoneBox)(c.getLang("mail_community_was_blocked"))})).catch(M);break;case n.ConvoAction.ALLOW_COMMUNITY:e.set(s.toggleCommunityMessages.bind(null,!0,P)).then((()=>a().changeActions?.(e))).catch(M);break;case n.ConvoAction.BLOCK:(0,o.showBlacklistBox)(P,e).once("success",(t=>{t.delta&&((0,w.showDoneBox)(t.msg),e.get()?.longpoll?.push([(0,i.resetPeer)()]))}));break;case n.ConvoAction.UNBLOCK_USER:e.set((e=>(0,x.setPeerBanStatus)(P,!0,e))).then((()=>e.set(S.setActions))).then((()=>{(0,w.showDoneBox)(c.getLang("mail_peer_was_unblocked")),t().updateState?.(P,e),t().updateActions?.(e)})).catch(M);break;case n.ConvoAction.BLOCK_USER:{const a=(0,l.showFastBox)(c.getLang("mail_blacklist_confirm"),c.getLang("mail_blacklist_message"),c.getLang("box_yes"),(function(){a.hide(),e.set((e=>(0,x.setPeerBanStatus)(P,!1,e))).then((()=>e.set(S.setActions))).then((()=>{(0,w.showDoneBox)(c.getLang("mail_peer_was_blocked")),t().updateState?.(P,e),t().updateActions?.(e)})).catch(M)}),c.getLang("box_no"));break}case n.ConvoAction.REPORT_USER:if(window.cur.viewAsBox)return void window.cur.viewAsBox();(0,T.showReportForm)("user",P,0);break;case n.ConvoAction.LEAVE:{const a=(0,o.showLeaveDialog)(e,P,(n=>{const r=e.set(s.leaveChat.bind(null,P)).then((()=>e.set(s.unpinMessageOptimistic.bind(null,P))));n&&r.then((()=>(0,o.cleanHistory)(e,a,t,s.flushHistory,P,n))).catch(M),a.hide(),e.get()?.longpoll?.push([(0,i.resetPeer)()])}));break}case n.ConvoAction.UNREAD:(0,s.markDialogUnread)(P,e.get()).catch(M);break;case n.ConvoAction.RETURN:e.set(s.returnToChat.bind(null,P)).then((e=>e.set(s.getPinnedMessage.bind(null,P)))).then(t().updateChatTopic?.bind(null,P)).catch((e=>{(0,l.showFastBox)(c.getLang("global_error"),e),M(e)}));break;case n.ConvoAction.MUTE:case n.ConvoAction.UNMUTE:{const a=A===n.ConvoAction.MUTE;e.set((e=>(0,s.setMutedPeer)(P,a,e))).then((e=>t().updateState?.(P,e))).then((()=>e.set((e=>(0,s.toggleMutePeer)(P,a,-1,e))))).catch(M);break}case n.ConvoAction.PIN_CONVO:(0,d.pinConvoHandler)(e.get(),P).catch((e=>{(0,h.showErrorBox)(e),M(e)}));break;case n.ConvoAction.UNPIN_CONVO:(0,d.unpinConvoHandler)(e.get(),P).catch((e=>{(0,h.showErrorBox)(e),M(e)}));break;case n.ConvoAction.ON_STICKERS_POPUP_ANIMATION:e.set((e=>(0,d.toggleStickersPopupAnimation)({data:e,peerId:P,value:1}))).then((()=>e.set(S.setActions))).then((()=>{t().updateActions?.(e),t().updateState?.(P,e)})).catch(M);break;case n.ConvoAction.OFF_STICKERS_POPUP_ANIMATION:e.set((e=>(0,d.toggleStickersPopupAnimation)({data:e,peerId:P,value:0}))).then((()=>e.set(S.setActions))).then((()=>{t().updateActions?.(e),t().updateState?.(P,e)})).catch(M);break;case n.ConvoAction.CHAT_INVITE:(0,o.inviteUser)(e,P,t,s.setCreationType);break;case n.ConvoAction.USER_INVITE:{const t=(0,y.getTab)(e,P);if(t&&((0,y.isUserConvo)(t)||(0,y.isContactConvo)(t))&&t.canBeAddedToChat){(0,u.collectConvoInviteStats)(u.ConvoInviteEntryPoint.DIALOG_ACTIONS,P);const a=(0,y.isContactConvo)(t)?(0,g.makeUserFromUserConvo)(t):(0,_.oCacheGet)(e,P),n=t=>Promise.resolve(e.get().longpoll?.push([(0,i.changePeer)(t,!1,!1,!1,"convo_invite")])),o=t=>e.get().longpoll?.push([(0,i.changePeer)(t,!1,!1,!1,"convo_invite")]);a&&(0,m.mount)(e,a,n,o)}break}case n.ConvoAction.CREATE_CHAT:{const a=(0,y.getTab)(e,P),n=[[P,a?.tab]];e.set(s.setCreationType.bind(null,"chat",[])).then((()=>t().showCreation?.(e,n))).catch(M);break}case n.ConvoAction.PIN_HIDE:(0,v.pinnedMessageHide)(e,(0,C.getPeer)(e),t);break;case n.ConvoAction.PIN_UNHIDE:(0,v.pinnedMessageUnHide)(e,(0,C.getPeer)(e),t);break;case n.ConvoAction.UNPIN:(0,v.pinnedMessageUnpin)(e,(0,C.getPeer)(e),t);break;case n.ConvoAction.SETTINGS:a().showSettings?.(e);break;case n.ConvoAction.DISABLE_BUSINESS_NOTIFY:{const a=(0,y.getTab)(e,P),n=a&&(0,y.isChatConvo)(a)&&a.ownerId;if(!n)return;const o=new l.MessageBox({title:c.getLang("mail_business_notify_disable_box_title")}).content((0,f.getTemplate)("sImBusinessNotifyDisableBoxContent",{text:c.getLang("mail_business_notify_disable_box_text")})).addButton(c.getLang("mail_business_notify_disable_box_button"),(a=>{(0,b.lockButton)(a),e.set((e=>(0,S.setConvoBusinessNotifyEnabled)(e,P,!1))).then((()=>e.set(S.setActions))).then((()=>(t().updateActions?.(e),t().updateState?.(P,e),(0,I.denyMessagesFromGroup)({group_id:-n})))).then((()=>{o.hide()})).catch(M)})).show();break}case n.ConvoAction.ENABLE_BUSINESS_NOTIFY:{const a=(0,y.getTab)(e,P),n=a&&(0,y.isChatConvo)(a)&&a.ownerId;if(!n)return;e.set((e=>(0,S.setConvoBusinessNotifyEnabled)(e,P,!0))).then((()=>e.set(S.setActions))).then((()=>(t().updateActions?.(e),t().updateState?.(P,e),(0,I.allowMessagesFromGroup)({group_id:-n})))).catch(M);break}case n.ConvoAction.ARCHIVE:if(!(0,y.getTab)(e,P))break;e.set((e=>(0,s.updateFolderState)(P,n.FOLDER_MASKS[n.FOLDER_ARCHIVE],k.SET_DIRECTORIES,!0,!1,(0,h.unpackStore)(e)))).then((()=>e.set(S.setActions))).then((()=>{t().updateActions?.(e),t().removePeer?.(e,P),t().updateFolderCounters?.(e),t().addEntityToArchiveMentionsMap?.(e,P)})).then((()=>(0,I.archiveConversation)({peer_id:P}))).catch(M);break;case n.ConvoAction.UNARCHIVE:if(!(0,y.getTab)(e,P))break;e.set((e=>(0,s.updateFolderState)(P,n.FOLDER_MASKS[n.FOLDER_ARCHIVE],k.RESET_DIRECTORIES,!0,!1,(0,h.unpackStore)(e)))).then((()=>e.set(S.setActions))).then((()=>{t().updateActions?.(e),t().removePeer?.(e,P);const a=(0,h.unpackStore)(e);a.active_tab!==n.ConvoListFolder.ARCHIVE||a.dialog_tabs[n.ConvoListFolder.ARCHIVE]?.length||a?.longpoll?.push([(0,i.changeTab)(n.ConvoListFolder.ALL)])})).then((()=>(0,I.unarchiveConversation)({peer_id:P}))).catch(M);break;case n.ConvoAction.CALL_FINISH:{const t=(0,y.getTab)(e,P),a=t?.callInProgress?.call_id;t?.callInProgress?.can_finish_call&&a&&(0,I.forceCallFinish)(a).catch(M);break}}}},500741:(e,t,a)=>{a.d(t,{useIndexer:()=>s});var n=a(423676),o=a(296540);const s=(e,t,a)=>{const s=(0,o.useRef)(null);s.current=s.current?s.current:new n.VkIndexer(e,t);const r=s.current,i=(0,o.useCallback)((e=>e.reduce(((e,t)=>(e[a(t)]=!0,e)),{})),[]),[c,l]=(0,o.useState)(e),[d,h]=(0,o.useState)(i(e));return(0,o.useEffect)((()=>{const t=i(e),n=e.filter((e=>!d[a(e)])),o=c.filter((e=>!t[a(e)]));(n.length||o.length)&&(n.forEach((e=>{r.add(e)})),o.forEach((e=>{r.remove(e)})),l(e),h(t))}),[e]),r}},805340:(e,t,a)=>{a.d(t,{useHints:()=>h});var n=a(296540),o=a(803898),s=a(911575),r=a(500741),i=a(177157),c=a(808148);const l=(0,o.debouncedPromise)(s.searchHints,300),d=()=>!0;function h(e,t,a,o){const[s,h]=(0,n.useState)(t),[u,p]=(0,n.useState)(!1),g=(0,n.useRef)(a),_=(0,n.useCallback)((e=>e.name),[]),m=(0,n.useCallback)((e=>e.peerId),[]),v=(0,r.useIndexer)(t,_,m),C=(0,n.useCallback)((e=>o.filterFn?e.filter(o.filterFn):e),[o.filterFn]);return(0,n.useEffect)((()=>{if(g.current=a,a){const t=v.search(a),n=t.map((e=>e.peerId));h(C(t)),p(!0),l(a,n,o.queryType||c.HintsSearchType.ALL,o,e.get()).then((e=>{g.current===a&&(h((0,i.mergeConvoLists)(t,e,o.filterFn||d)),p(!1))})).catch((()=>{}))}else h(C(t)),p(!1)}),[a,t]),[s,u]}},518289:(e,t,a)=>{a.d(t,{uploadConvoPhoto:()=>r});var n=a(7144),o=a(850101),s=a(808148);function r(){const e=2e9+Math.round((0,n.rand)(1e6,2e6));return new Promise((t=>{window.cur.recieveCropResult=a=>{window.cur.recieveCropResult=!1,(0,s.ownerPhoto)(JSON.parse(a).data[0],e).then((e=>{const n=Array.isArray(e)?e[0]:e;t({photo:n,photoData:a}),(0,o.curBox)()?.hide(!0)}),(()=>{}))},window.Page.ownerPhoto(e),(0,o.curBox)()?.setOptions({onHideAttempt:e=>(e||t({}),!0)})}))}},40473:(e,t,a)=>{var n;a.d(t,{ConvoFilters:()=>n}),function(e){e.ALL="all",e.ARCHIVE="archive",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(n||(n={}))},678041:(e,t,a)=>{a.d(t,{ReportReasonIds:()=>u,afterCommentReportSubmit:()=>g,showReportForm:()=>p});var n=a(474848),o=a(618913),s=a(610989),r=a(921004),i=a(811042),c=a(186301),l=a(507607),d=a(272259);(0,r.initApi)();const h=window.vk;var u;function p(e,t,o,s,r,i,c,h){const u=(0,l.asyncComponent)((()=>Promise.all([a.e(91498),a.e(89631),a.e(99595)]).then(a.bind(a,930887))),(({ReportForm:e})=>e));(0,d.showMessageBoxModalSuspense)((a=>(0,n.jsx)(u,{...a,reportSource:e,reportSourceOwnerId:t,reportSourceId:o,onSubmit:s,messengerAdditionalData:i,from:c,adData:h})),{onDestroy:r})}function g(e,t,a){const n=function(e,t,a){switch(e){case"photo":return`#post${t}photo_${a}`;case"video":return`#post${t}video_${a}mv`;case"market":return`#post${t}market_${a}`}}(e,t,a);if("photo"===e){const e=document.querySelector(`${n} .dld`);null!==e&&(e.outerHTML="")}const r=document.querySelector(`${n} .reply_wrap`);null!==r?(r.style.display="none",r.outerHTML+=`<div class="dld">${s.getLang("global_report_sent")}</div>`):(0,o.debugLog)(`Unable to hide report button for ${e} comment`)}(0,i.setLoginConfig)({onCaptcha:c.handleCaptcha,domain:h?.apiConfigDomains?.loginDomain}),(0,i.setApiConfig)({onCaptcha:c.handleCaptcha,domain:h?.apiConfigDomains?.apiDomain}),function(e){e[e.NotOriginalContent=28]="NotOriginalContent"}(u||(u={}))}}]);try{stManager.done("dist/web/chunks/bbd2f336.f309ddaf.js")}catch(e){}