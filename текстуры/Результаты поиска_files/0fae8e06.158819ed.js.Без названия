"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[19996],{885318:(e,t,o)=>{function r(e){var t=new Date;return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function a(e){return r(new Date(e.getTime()+864e5))}function s(e){return r(new Date(e.getTime()-864e5))}o.d(t,{isToday:()=>r,isTomorrow:()=>s,isYesterday:()=>a})},790767:(e,t,o)=>{o.d(t,{initLang:()=>a,langNumeric:()=>n,langSex:()=>s,langWordNumeric:()=>i});var r;o(885318);function a(e){e.source,r=e.config}function s(e,t){if(!Array.isArray(t))return t;var o=r(),a=t[1];return o?(o.sexRules.some((function(o){return"*"===o[0]||e==o[0]&&t[o[1]]?(a=t[o[1]],!0):void 0})),a):a}function n(e,t,o){var a,s=r();if(!t||!s)return e;Array.isArray(t)?(a=t[1],e!==Math.floor(e)?a=t[s.numRules.float]:s.numRules.int.some((function(o){if("*"===o[0])return a=t[o[2]],!0;var r=o[0]?e%o[0]:e;return Array.isArray(o[1])&&-1!==o[1].indexOf(r)?(a=t[o[2]],!0):void 0}))):a=t;var n=e+"";if(o){for(var i=e.toString().split("."),c=[],u=i[0].length-3;u>-3;u-=3)c.unshift(i[0].slice(u>0?u:0,u+3));i[0]=c.join(s.numDel),n=i.join(s.numDec)}return a=(a||"%s").replace("%s",n)}function i(e,t,o){return Array.isArray(t)&&e<t.length?t[e]:n(e,o)}},319210:()=>{},924676:()=>{},627412:(e,t,o)=>{o.d(t,{API_VERSION:()=>r});const r="5.238"},267260:(e,t,o)=>{o.d(t,{createBrowserHistory:()=>c,createMemoryHistory:()=>u,parsePath:()=>g});var r,a=o(58168);!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));var s=function(e){return e};var n="beforeunload",i="popstate";function c(e){void 0===e&&(e={});var t=e.window,o=void 0===t?document.defaultView:t,c=o.history;function u(){var e=o.location,t=e.pathname,r=e.search,a=e.hash,n=c.state||{};return[n.idx,s({pathname:t,search:r,hash:a,state:n.usr||null,key:n.key||"default"})]}var d=null;o.addEventListener(i,(function(){if(d)P.call(d),d=null;else{var e=r.Pop,t=u(),o=t[0],a=t[1];if(P.length){if(null!=o){var s=v-o;s&&(d={action:e,location:a,retry:function(){S(-1*s)}},S(s))}}else C(e)}}));var _=r.Pop,k=u(),v=k[0],I=k[1],f=h(),P=h();function R(e){return"string"==typeof e?e:p(e)}function w(e,t){return void 0===t&&(t=null),s((0,a.default)({pathname:I.pathname,hash:"",search:""},"string"==typeof e?g(e):e,{state:t,key:m()}))}function b(e,t){return[{usr:e.state,key:e.key,idx:t},R(e)]}function y(e,t,o){return!P.length||(P.call({action:e,location:t,retry:o}),!1)}function C(e){_=e;var t=u();v=t[0],I=t[1],f.call({action:_,location:I})}function S(e){c.go(e)}null==v&&(v=0,c.replaceState((0,a.default)({},c.state,{idx:v}),""));var $={get action(){return _},get location(){return I},createHref:R,push:function e(t,a){var s=r.Push,n=w(t,a);if(y(s,n,(function(){e(t,a)}))){var i=b(n,v+1),u=i[0],d=i[1];try{c.pushState(u,"",d)}catch(e){o.location.assign(d)}C(s)}},replace:function e(t,o){var a=r.Replace,s=w(t,o);if(y(a,s,(function(){e(t,o)}))){var n=b(s,v),i=n[0],u=n[1];c.replaceState(i,"",u),C(a)}},go:S,back:function(){S(-1)},forward:function(){S(1)},listen:function(e){return f.push(e)},block:function(e){var t=P.push(e);return 1===P.length&&o.addEventListener(n,l),function(){t(),P.length||o.removeEventListener(n,l)}}};return $}function u(e){void 0===e&&(e={});var t=e,o=t.initialEntries,n=void 0===o?["/"]:o,i=t.initialIndex,c=n.map((function(e){return s((0,a.default)({pathname:"/",search:"",hash:"",state:null,key:m()},"string"==typeof e?g(e):e))})),u=d(null==i?c.length-1:i,0,c.length-1),l=r.Pop,_=c[u],k=h(),v=h();function I(e,t){return void 0===t&&(t=null),s((0,a.default)({pathname:_.pathname,search:"",hash:""},"string"==typeof e?g(e):e,{state:t,key:m()}))}function f(e,t,o){return!v.length||(v.call({action:e,location:t,retry:o}),!1)}function P(e,t){l=e,_=t,k.call({action:l,location:_})}function R(e){var t=d(u+e,0,c.length-1),o=r.Pop,a=c[t];f(o,a,(function(){R(e)}))&&(u=t,P(o,a))}var w={get index(){return u},get action(){return l},get location(){return _},createHref:function(e){return"string"==typeof e?e:p(e)},push:function e(t,o){var a=r.Push,s=I(t,o);f(a,s,(function(){e(t,o)}))&&(u+=1,c.splice(u,c.length,s),P(a,s))},replace:function e(t,o){var a=r.Replace,s=I(t,o);f(a,s,(function(){e(t,o)}))&&(c[u]=s,P(a,s))},go:R,back:function(){R(-1)},forward:function(){R(1)},listen:function(e){return k.push(e)},block:function(e){return v.push(e)}};return w}function d(e,t,o){return Math.min(Math.max(e,t),o)}function l(e){e.preventDefault(),e.returnValue=""}function h(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function m(){return Math.random().toString(36).substr(2,8)}function p(e){var t=e.pathname,o=void 0===t?"/":t,r=e.search,a=void 0===r?"":r,s=e.hash,n=void 0===s?"":s;return a&&"?"!==a&&(o+="?"===a.charAt(0)?a:"?"+a),n&&"#"!==n&&(o+="#"===n.charAt(0)?n:"#"+n),o}function g(e){var t={};if(e){var o=e.indexOf("#");o>=0&&(t.hash=e.substr(o),e=e.substr(0,o));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}},825685:(e,t,o)=>{o.d(t,{copyInviteLinkHref:()=>i,showInviteLinkBox:()=>n});var r=o(20025),a=o(452314),s=o(258643);function n(e){new c(e).show()}function i(e){let t=!1;const o=(0,a.attr)(e,"href");window.copyToClipboard(o);const r=(0,a.domPN)((0,a.domPN)(e));let s=(0,a.geByClass1)("invite-link-actions",r),n=(0,a.geByClass1)("invite-link-actions-copied",r);return(0,a.hide)(s),(0,a.show)(n),(0,a.setStyle)(n,{opacity:1}),t=setTimeout((()=>{(0,a.setStyle)(n,{opacity:0}),(0,a.hide)(n),(0,a.show)(s),clearTimeout(t)}),2e3),!1}class c{show(){const e={params:{width:450,hideButtons:!0},onDone:(e,t)=>this.onShowBoxDone(t)};this.box=(0,r.showBox)("invite.php",{act:"group_invite_link_box",invite_link_id:this.inviteLinkId},e)}join(e,t,o,r){if(s.FlatButton.isLocked(this.joinButton))return!1;const a={hash:e,link:t,gid:o,act:"enter"};ajax.post("al_groups.php",a,{onDone:()=>{nav.go(r)},showProgress:()=>s.FlatButton.lock(this.joinButton),hideProgress:()=>s.FlatButton.unlock(this.joinButton)})}onShowBoxDone(e){const{hash:t="",link:o="",groupId:r="",groupLink:a=""}=e;t?(this.joinButton=this.box.bodyNode.querySelector(".group-join-button"),this.joinButton.addEventListener("click",(()=>{this.join(t,o,r,a)}))):this.box.setOptions({hideButtons:!1})}constructor(e){this.inviteLinkId=e}}},59818:(e,t,o)=>{o.d(t,{Lang:()=>d});var r=o(790767),a=o(869859),s=o(104650),n=o.n(s),i=o(399332),c=o(401193);const u="reforged-lang-debug";class d{dispose(){}constructor(e,t){this.isDebug=!1,this.decodedKeys={},this.toggleDebug=()=>{this.isDebug=!this.isDebug;try{this.isDebug?localStorage.setItem(u,"true"):localStorage.removeItem(u)}catch{}window.location.reload()},this.use=(e,...t)=>this.fold(e,(e=>e),(e=>e.join("")),...t),this.fold=(e,t,o,...a)=>{if(this.isDebug)return t(e);try{const s=a[0];let n=this.getTemplate(e);if(!n)return t(e);if(!s)return Array.isArray(n)?t(e):t(n);if("num"in s)s.values={formatted:this.formatNumber(s.num,s.formatted),...s.values||{}},"short"===s.formatted&&(s.num=Math.min(1e3,s.num)),n="fallback"in s?(0,r.langWordNumeric)(s.num,n,this.getTemplate(s.fallback)).toString():(0,r.langNumeric)(s.num,n).toString();else if("sex"in s){const e={female:"1",male:"2",unknown:"*"};n=(0,r.langSex)(e[s.sex],n)}else if("now"in s){const e=new Date(s.now),t=new Date(s.date);n=h(e,t)?n[3]:function(e,t){const o=new Date(t.getTime()+i.Time.Day);return h(e,o)}(e,t)?n[2]:function(e,t){const o=new Date(t.getTime()-i.Time.Day);return h(e,o)}(e,t)?n[4]:n[1],s.values={...this.splitDate(t,{shortMonths:s.shortMonths,genMonths:s.genMonths,capMonths:s.capMonths,shortWeekdays:s.shortWeekdays}),...s.values||{}}}if(Array.isArray(n)||!n)return t(e);if("values"in s&&Object.keys(s.values).length>0){const e=m.Grammar.tryParse(n),r=(e,a)=>{switch(a.type){case"StaticPlaceholder":{const t=s.values[a.name];e.push(t);break}case"FunctionPlaceholder":{const t=s.values[a.name],n=a.inner.reduce(r,[]);e.push(t(o(n)));break}case"Text":e.push(t(a.text));break;default:}return e},a=e.reduce(r,[]);return o(a)}return t(n)}catch{return t(e)}},this.formatDate=(e,t)=>{const o=new Date(e),r=new Date(t.now);try{switch(t.variant){case"time":{const{hour:e,minute:t,am_pm:r}=this.splitDate(o);return`${e}:${t} ${r}`}case"time-ago":{const t=Math.floor((r.getTime()-e)/1e3);switch(!0){case t<60:return this.use("global_just_now");case t<3600:{const e=Math.floor(t/60);return this.use("global_word_mins_ago",{num:e,fallback:"global_mins_ago"})}case t<43200:{const e=Math.floor(t/60/60);return this.use("global_word_hours_ago",{num:e,fallback:"global_hours_ago"})}default:return(0,c.isSameYear)(r,new Date(e))?this.use("global_short_date_time",{now:r.getTime(),date:e}):this.use("global_date_year_time",{now:r.getTime(),date:e})}}default:return(0,c.exhaustivenessCheck)(t.variant)}}catch(e){return this.logger.error(`[LANG] Ошибка форматирования даты ${t.variant}`,e),o.toISOString()}},this.formatNumber=(e,t="regular")=>{if("regular"===t)return e.toString().split(".").join(this.translations.config.numDec);let o,r;switch(!0){case e>1e9:o=e/1e9,r="B";break;case e>1e6:o=e/1e6,r="M";break;case e>1e3:o=e/1e3,r="K";break;default:o=e,r=""}const[a,s]=o.toFixed(1).split(".");return(Number(s)?[a,s]:[a]).join(this.translations.config.numDec)+r},this.getTemplate=e=>{if(!this.decodedKeys[e]){const t=this.translations.keys[e];if(!t)return;this.decodedKeys[e]=Array.isArray(t)?t.map(l):l(t)}return this.decodedKeys[e]},this.splitDate=(e,t={})=>{const o=(()=>{const e=t.shortMonths??!1,o=t.genMonths??!0,r=t.capMonths??!1;if(e)return this.getTemplate("global_months_short_of");const a=`${o}_${r}`;switch(a){case"false_false":return this.getTemplate("global_months");case"true_true":return this.getTemplate("global_months_cap_of");case"true_false":return this.getTemplate("global_months_of");case"false_true":return this.getTemplate("global_months_cap");default:return(0,c.exhaustivenessCheck)(a)}})(),r=t.shortWeekdays?this.getTemplate("global_week_days_short"):this.getTemplate("global_week_days"),a=e.getMinutes().toString().padStart(2,"0");let s=e.getHours().toString().padStart(2,"0");const n=e.getDate(),i=o[e.getMonth()]||o[0],u=r[(e.getDay()+6)%7]||r[0],d=e.getFullYear();let l="";const{timeSys:h}=this.translations.config;return"12hour"===h[0]&&(l=e.getHours()>11?h[2]:h[1],s=(e.getHours()%12==0?12:e.getHours()%12).toString().padStart(2,"0")),{year:d,month:i,weekday:u,day:n,hour:s,minute:a,am_pm:l}},this.logger=e,this.translations=t,(0,r.initLang)({source:()=>t.keys,config:()=>t.config}),this.locale=t.config.locale;try{this.isDebug=!!localStorage.getItem(u)}catch{}}}function l(e){return(0,a.decodeHTMLEntities)(e).replace(/<br\s*\/?>/gi,"\n")}function h(e,t){const o=e.getDate(),r=e.getMonth(),a=e.getFullYear();return t.getFullYear()===a&&t.getMonth()===r&&t.getDate()===o}const m=n().createLanguage({Grammar:e=>n().alt(e.FunctionPlaceholder,e.StaticPlaceholder,e.Text).many(),StaticPlaceholder:e=>n().seqObj(n().string("{"),["name",e.Name],n().string("}")).map((({name:e})=>({type:"StaticPlaceholder",name:e}))),FunctionPlaceholder:e=>n().seqObj(n().string("{"),["name",e.Name],n().string("}")).chain((({name:t})=>n().alt(e.StaticPlaceholder,e.Text).many().skip(n().string(`{/${t}}`)).map((e=>({type:"FunctionPlaceholder",name:t,inner:e}))))),Name:()=>n().regex(/[a-zA-Z0-9_]+/),Text:()=>n().regex(/[^{}]+/).map((e=>({type:"Text",text:(0,a.decodeHTMLEntities)(e)})))})},194073:(e,t,o)=>{o.d(t,{DEFAULT_FEATURE_FLAGS:()=>r});const r={me_fc_multiple_windows:!0,me_fc_message_actions:!1,me_sticker_packs:{helloKeywordPack:[],helloStickersPack:[]},me_community_messages_enabled:!1,me_message_selecting:!1,me_channels:!1,vkm_new_read_indicator:!1,vkm_convo_member_temporary_ban:!1,vkm_profile_info_screen_name:!1,vkm_hide_forward_author:!1,vkm_composer_new:!1,vkm_reactions:!1,vkm_mediascope_collect:!1,vkm_widget_attaches:!1,vkm_prds:!1,vkm_marusia_chat:!1,vkm_marusia_group_chat:!1,vkm_marusia_main_chat:!1,vkm_stats_config:{sendingAmount:1e3,perfSendingProbability:.1},vkm_new_chunk_parser:!1,vkm_ugc_stickers_in_keyboard:!1,vkm_add_non_friends:!1,vkm_convo_antispam_card:!1,vkm_add_non_friends_by_phone:!1,vkm_channels_postponed:!1,vkm_write_non_friends_by_phone:!1,vkm_settings_experimental:!1,vkm_baseurl_avatars:!1,vkm_convo_forbid_writing_all:!1,vkm_message_preview_on_hover:!1,vkm_new_music_attaches:!1,vkm_settings_hide_suggested:!1,vkm_autoplay_video:!1,vkm_channels_short_polling:!1,vkm_channels_search:!1,vkm_bubble_theme_default_value:!1,vkm_up_drafted_convos_in_list:!1,vkm_recommended_folders:!1,vkm_business_folder:!1,vkm_personal_folder:!1,vkm_sublists_in_folder:!1,vkm_new_convo_folder_logic:!1,vkm_avatar_area_selector:!1,vkm_upload_v2:!1,vkm_upload_v2_voice:!1,vkm_resync_glph_replacement:!1,vkm_history_warm_up:!1,vkm_missing_data_rework:!1,vkm_members_search_pagination:!1,vkm_new_attach_video:!1,vkm_channels_post_new_design:!1,vkm_new_attach_post:!1,vkm_admin_can_delete_message:!1,vkm_forward_modal_multipick:!1,vkm_send_private_message_link:!1,vkm_spam_message_types:!1,vkm_new_remove_empty_forwards:!1,vkm_edu_achievements:!1,vkm_channel_media_viewer:!1,vkm_chat_channel_long_name:!1,vkm_channel_can_message:!1,vkm_add_phone_in_chat_creation:!1,vkm_edu_safe_account:!1,vkm_stickers_popup:!1,vkm_edu_global_users_search:!1,vkm_calls_short_links:!1,vkm_change_edu_profile_data:!1,vkm_error_modal_edu_channel:!1,vkm_chat_join_account_switch:!1,vkm_call_join_account_switch:!1,vkm_sw_notification_click:!1,vkm_theme_styles_settings:!1,vkm_internal_sferum_links:!1,vkm_channels_members:!1,vkm_chat_list_collapse:!1,vkm_channel_account_switch:!1,vkm_media_share:!1,vkm_promo_auto_open:!1,vkm_edu_enable_bday_in_convo:!1,vkm_edu_precreated_convos:!1,vkm_sferum_banner_channels:!1,vkm_edu_integration_banner:!1,vkm_delete_chat:!1,vkm_edu_new_call_preview:!1,vkm_birthday_banner_edu:!1,vkm_birthday_sticker_pack:[],vkm_photo_save_to_album:!1,vkm_media_viewer_report:!1,vkm_convo_posts_stats_collect:!1,vkm_gifs_autoplay:!1,vkm_edu_message_request:!1,vkm_convo_check_can_read:!1,vkm_edu_profile_switch_video:!1,vkm_mini_apps_new_sdk:!1,vkm_reactions_sync_time:!1,vkm_show_inviter:!1,vkm_stickers_animation_setting:!1,vkm_edu_chatmembers_sort:!1,vkm_enable_schedule_edu:!1,vkm_video_chat:!1,vas_gifts_random_pack:!1,vkm_performance_stats_in_vkcom:!1,vkm_pinned_channels:!1,vkm_edu_account_org_info:!1,vkm_edu_org_navigation:!1}},136872:(e,t,o)=>{o.d(t,{deleteThread:()=>l,isEmpty:()=>c,markDeleted:()=>u,newNormal:()=>m,resolveCmid:()=>s,restoreDeleted:()=>d,restoreThread:()=>h,toPlainText:()=>i,toRawText:()=>p,toWallReplyAttach:()=>n});var r=o(596917),a=o(175953);function s(e){return(Number.isNaN(e)||void 0===e)&&(e=0),e}function n(e){return{kind:"WallReply",attaches:e.attaches,chunks:e.chunks,id:e.cmid,postId:e.postCmid,authorId:e.peerId,date:e.sentAt,ownerId:a.resolveId(e.channelId)}}function i(e,t){return r.toPlainText(e.chunks,t)}function c(e){return 0===e.chunks.length&&!Object.keys(e.attaches).find((e=>"unknown"!==e))}function u(e,t){return{...e,kind:"MarkedDeleted",isThreadDeleted:t}}function d(e){return{...e,kind:"Normal"}}function l(e){e.isThreadDeleted=!0}function h(e){e.isThreadDeleted=!1}function m(e,t){return{...e,kind:"Normal",replies:{count:0,history:[]},chunks:r.fromServerText(t),likes:{count:0,reactionId:void 0,availableReactionIds:[],peerIds:new Set}}}function p(e){return r.toRawText(e.chunks)}},68655:(e,t,o)=>{o.d(t,{Router:()=>I,applyParentRouteParam:()=>w});var r=o(104650),a=o.n(r),s=o(999230),n=o(267260),i=o(401193),c=o(103026),u=o(136872),d=o(728921),l=o(175953),h=o(649166),m=o(302551),p=o(254335),g=o(520828),_=o(73514),k=o(462700);const v=["Article","Link","Poll","MiniApp","Gift","Geo"];class I{get screenRoute(){const e=f(this.history.location);return this.screenRouteMemo.path!==e&&(this.screenRouteMemo.path=e,this.screenRouteMemo.route=this.fromUrl(e)),this.screenRouteMemo.route}getStackUtils(e=this.screenRoute){return new R(e)}push(e){this.go(e,s.IRouter.Action.Push)}toUrl(e){if(s.IRouter.isProxyRoute(e)){const t=this.fromProxyRoute(e);if(t)return s.IRouter.isRuntimeRoute(t)?null:this.toUrlInternal(t);switch(e.kind){case"AttachMediaProxyRoute":case"VkProxyRoute":case"StickersStoreProxyRoute":return null;case"AttachProxyRoute":if(this.checkIsolation()&&!v.includes(e.attach.kind))return null;return this.parseUtils.getAttachLink(e.attach,this.vkDomain)||e.fallbackUrl||null;case"HashtagProxyRoute":return this.checkIsolation()?null:`https://${this.vkDomain}/feed?q=${encodeURIComponent(e.tag)}&section=search`;case"ChatJoinProxyRoute":return`https://vk.me/join/${e.joinHash}`;case"CallJoinProxyRoute":return`https://${this.vkDomain}/call/join/${encodeURIComponent(e.callJoinHash)}`;case"CallJoinShortenedProxyRoute":return this.checkIsolation()?`https://${_.SFERUM_DOMAIN}/?call=${e.callJoinId}${e.password?`&p=${e.password}`:""}`:`https://${_.WEB_VK_ME_DOMAIN}/call/${e.callJoinId}${e.password?`?p=${e.password}`:""}`;case"ChannelJoinProxyRoute":const t=`https://${this.vkDomain}/club${e.channelId}`;return e.postCmid?`${t}?w=wall${e.postCmid}`:t;case"GiftsCatalogProxyRoute":if(this.checkIsolation())return null;const o=new URLSearchParams;return o.append("act","send"),e.peerId&&o.append("mid",String(e.peerId)),`https://${this.vkDomain}/gifts?${o}`;case"HashtagMentionProxyRoute":return this.checkIsolation()||!e.authorId?null:`https://${this.vkDomain}/wall${e.authorId}?q=${encodeURIComponent(e.tag)}`;case"ScreenNameProxyRoute":return this.checkIsolation()?null:`https://${this.vkDomain}/${e.screenName}`;case"StickerPackProxyRoute":return this.checkIsolation()?null:e.externalUrl?e.externalUrl:`https://${this.vkDomain}/stickers/${e.stickerPackName}`;case"SferumChannelProxyRoute":const r=`https://${_.SFERUM_DOMAIN}/?p=channel&channelId=${e.channelId}`;return e.postCmid?`${r}&postId=${e.postCmid}`:r;default:(0,i.exhaustivenessCheck)(e)}}return this.toUrlInternal(e)}toUrlInternal(e){return this.addBasePath(this.parseUtils.toUrl(e))}fromProxyRoute(e){switch(e.kind){case"AttachProxyRoute":switch(e.attach.kind){case"MiniApp":switch(e.attach.type){case"app":case"game":case"html5_game":return null;default:const t=Number(e.attach.appLink.match(/_(-\d+)/)?.[1]),o=isNaN(t)?void 0:l.resolveId(t),r=o&&l.isGroupPeerId(o)?o:void 0;return this.getStackUtils().push({kind:"MiniAppModal",miniAppId:e.attach.id,hash:e.attach.hash,groupPeerId:r})}case"Wall":case"WallHistory":return this.featureFlags.me_channels&&c.isChannelId(e.attach.authorId)?{kind:"ChannelRoute",channelId:c.resolveId(e.attach.authorId),postCmid:m.resolveCmid(e.attach.id),tab:e.tab}:null;case"WallReply":return this.featureFlags.me_channels&&c.isChannelId(e.attach.ownerId)?{kind:"ChannelRoute",channelId:c.resolveId(e.attach.ownerId),postCmid:m.resolveCmid(e.attach.postId),commentCmid:u.resolveCmid(e.attach.id),tab:e.tab}:null;case"Event":return this.featureFlags.me_channels?{kind:"ChannelRoute",channelId:c.resolveId(e.attach.id)}:null;case"Link":{const t=(0,k.getCallJoinHash)(e.attach.url);if(t)return{kind:"CallJoinRoute",callJoinHash:t};const o=(0,k.getCallJoinId)(e.attach.url);if(o)return{kind:"CallJoinShortenedRoute",callJoinId:o.callJoinId};const r=(0,k.getChatJoinHash)(e.attach.url);return r?{kind:"ChatJoinRoute",chatJoinHash:r}:null}case"Audio":case"Album":case"AudioPlaylist":case"Artist":case"Podcast":case"Doc":case"Sticker":case"UgcSticker":case"Voice":case"Market":case"MoneyTransfer":case"MoneyRequest":case"Gift":case"Graffiti":case"MarketAlbum":case"FinishedCall":case"Poll":case"Story":case"Narrative":case"Article":case"Geo":case"ActiveCall":case"DonutLink":case"InviteLink":case"VideoMessage":case"Curator":case"MiniAppWidget":case"Question":case"StickerPack":case"Widget":return null;default:return(0,i.exhaustivenessCheck)(e.attach)}case"AttachMediaProxyRoute":{let t;if(e.source)switch(e.source.kind){case"message":t={kind:s.IRouter.RouteSourceKind.Message,cmid:e.source.cmid,peerId:e.source.peerId,mediaViewerItemPosition:e.source.mediaViewerItemPosition,messageAccessKey:e.attach.messageAccessKey};break;case"post":t={kind:s.IRouter.RouteSourceKind.Post,cmid:e.source.cmid,channelId:e.source.channelId,mediaViewerItemPosition:e.source.mediaViewerItemPosition};break;case"postponedPost":t={kind:s.IRouter.RouteSourceKind.PostponedPost,cmid:e.source.cmid,channelId:e.source.channelId};break;case"comment":t={kind:s.IRouter.RouteSourceKind.Comment,commentCmid:e.source.commentCmid,postCmid:e.source.postCmid,channelId:e.source.channelId};break;case"composer":t={kind:s.IRouter.RouteSourceKind.Composer};break;case"channelComposer":t={kind:s.IRouter.RouteSourceKind.ChannelComposer};break;case"commentsComposer":t={kind:s.IRouter.RouteSourceKind.CommentsComposer};break;default:(0,i.exhaustivenessCheck)(e.source)}const o={Photo:"PhotoModal",Video:"VideoModal"};return this.getStackUtils().push({kind:o[e.attach.kind],id:e.attach.id,ownerId:e.attach.ownerId,accessKey:e.attach.accessKey,source:t,tab:e.tab})}case"StickersStoreProxyRoute":return{kind:"RedirectRuntimeRoute",redirectUrl:`https://${this.vkDomain}/stickers`};case"HashtagProxyRoute":case"ChatJoinProxyRoute":case"CallJoinProxyRoute":case"CallJoinShortenedProxyRoute":case"ChannelJoinProxyRoute":case"GiftsCatalogProxyRoute":case"HashtagMentionProxyRoute":case"ScreenNameProxyRoute":case"VkProxyRoute":case"StickerPackProxyRoute":case"SferumChannelProxyRoute":return null;default:(0,i.exhaustivenessCheck)(e)}}dispose(){}constructor(e,t,o,r,a){this.runtimeRoute=null,this.listeners=new Set,this.screenRouteMemo={path:"",route:{kind:"MainRoute"}},this.checkIsolation=()=>!1,this.notifyListeners=(e,t)=>{[...this.listeners].forEach((o=>o(e,t)))},this.handleRuntimeRouteChange=(e,t)=>{this.runtimeRoute="EmptyRuntimeRoute"===e.kind?null:e,this.notifyListeners({...this.screenRoute},t)},this.handleScreenRouteChange=()=>{this.runtimeRoute=null},this.addBasePath=e=>this.basePath?`${this.basePath}${"/"===e?"":e}`:e,this.removeBasePath=e=>{return this.basePath?e.replace(new RegExp(`^${t=this.basePath,t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}`),""):e;var t},this.fromEntity=(e,t)=>{if(s.IRouter.isProxyRoute(e)){const t=this.fromProxyRoute(e);return t?s.IRouter.isRuntimeRoute(t)?{route:t,url:this.toUrl(e)}:{route:{...t,tab:this.screenRoute.tab},url:this.toUrl(e)||this.toUrl(t)}:{route:null,url:this.toUrl(e)}}if(s.IRouter.isStackable(e)){let o;const r=this.getStackUtils();switch(t){case s.IRouter.Action.Push:o=r.push(e);break;case s.IRouter.Action.Replace:o=r.replace(e);break;case s.IRouter.Action.Pop:o=r.pop();break;default:(0,i.exhaustivenessCheck)(t)}return{route:o,url:this.toUrl(o)}}return{route:e,url:s.IRouter.isRuntimeRoute(e)?null:this.toUrl(e)}},this.go=(e,t)=>{const{route:o,url:r}=this.fromEntity(e,t);if(s.IRouter.isRuntimeRoute(o))return this.handleRuntimeRouteChange(o,t);if(o&&r)switch(t){case s.IRouter.Action.Push:case s.IRouter.Action.Pop:return this.history.push(r);case s.IRouter.Action.Replace:return this.history.replace(r);default:(0,i.exhaustivenessCheck)(t)}r&&window.open((0,k.prepareLink)(this.vkDomain,r),"_blank")},this.replace=e=>{this.go(e,s.IRouter.Action.Replace)},this.pop=()=>{this.go(this.getStackUtils().pop(),s.IRouter.Action.Push)},this.back=()=>{this.history.back()},this.forward=()=>{this.history.forward()},this.subscribe=e=>{const t=this.history.listen((({location:t})=>{const o=this.fromUrl(f(t));this.handleScreenRouteChange(),e(o)}));return this.listeners.add(e),()=>{this.listeners.delete(e),t()}},this.fromExternalUrl=e=>{const t=this.fromUrl(e);if("NotFoundRoute"!==t.kind)return t;let o;try{o=new URL(e)}catch(e){return t}const r=o.pathname.split("/")[1]||"";if(o.hostname===_.WEB_VK_ME_DOMAIN){const e=o.pathname+o.search+o.hash,t=this.fromUrl(e);switch(t.kind){case"ChannelsListRoute":case"ChannelRoute":case"ConvoRoute":return t;default:if(t.modal?.length||t.rp?.length)return{...this.screenRoute,modal:t.modal,rp:t.rp}}}if(_.VK_DOMAINS.includes(o.hostname)||o.hostname===this.vkDomain){if("reforged.php"===r)return t;const e=o.searchParams.get("w")||"";if(e.startsWith("chats"))return t;if(e.startsWith("wall")||r.startsWith("wall")){const[a,s,n]=function(e){const[t,r,a]=e.slice(4).split("_");return function(e,t,r){const a=o.searchParams.get("reply");let s;r?s=u.resolveCmid(parseInt(r)):a&&(s=u.resolveCmid(parseInt(a)));return[e?c.resolveId(parseInt(e)):void 0,t?m.resolveCmid(parseInt(t)):void 0,s]}(t,r,a)}(e||r);if(a&&this.featureFlags.me_channels)return{...t,kind:"ChannelRoute",channelId:a,postCmid:s,commentCmid:n,search:o.searchParams.get("q")||void 0}}return"groups"===r?{kind:"ChannelsListRoute"}:{kind:"ScreenNameProxyRoute",screenName:r}}if(!this.featureFlags.vkm_internal_sferum_links&&o.hostname===_.SFERUM_DOMAIN&&"channel"===o.searchParams.get("p")){const e=o.searchParams.get("channelId"),t=o.searchParams.get("postId");if(e)return{kind:"ChannelRoute",channelId:c.resolveId(parseInt(e)),...t&&{postCmid:m.resolveCmid(parseInt(t))},sferum:!0}}if(this.featureFlags.vkm_internal_sferum_links&&_.SFERUM_RELATED_DOMAINS.includes(o.hostname)){const e="channel"===o.searchParams.get("p"),t="messages"===o.searchParams.get("p"),r=o.searchParams.get("call_link");if(e){const e=o.searchParams.get("channelId"),t=o.searchParams.get("postId");if(e)return{kind:"ChannelRoute",sferum:!0,channelId:c.resolveId(parseInt(e)),...t&&{postCmid:m.resolveCmid(parseInt(t))}}}if(t){const e=o.searchParams.get("join"),t=o.searchParams.get("peerId");if(e)return{kind:"MainRoute",chatJoinHash:e};if(t)return{kind:"ConvoRoute",peerId:l.resolveId(parseInt(t)),entrypoint:"list_all",sferum:!0}}if(r)return{kind:"MainRoute",callJoinHash:r}}return t},this.fromUrl=e=>this.parseUtils.fromUrl(this.removeBasePath(e)),this.featureFlags=e,this.vkDomain=t,this.basePath=o,this.globalHistory=a,this.parseUtils=new P(e),this.push=this.push.bind(this),this.toUrl=this.toUrl.bind(this),this.fromProxyRoute=this.fromProxyRoute.bind(this),this.history=a||(r?(0,n.createMemoryHistory)():(0,n.createBrowserHistory)())}}function f(e){return`${e.pathname}${e.search}${e.hash||"#"}`}class P{constructor(e){this.routeParamsDelimiter="_",this.routeParamsDelimiterParser=a().string(this.routeParamsDelimiter),this.routeParamsOptionalDelimiterParser=this.routeParamsDelimiterParser.or(a().string("")),this.parser=a().createLanguage({Modal:e=>a().alt(e.Poll,e.NewFolder,e.EditFolder,e.Important,e.MiniApp,e.MiniAppCatalog,e.SpaceRoomCreate,e.SpaceRoomUpdate,e.SpaceSectionCreate,e.PhotoSourceMessage,e.PhotoSourcePost,e.RouteSourcePostponedPost,e.PhotoSourceComment,e.PhotoSourceComposer,e.PhotoSourceChannelComposer,e.PhotoSourceCommentsComposer,e.PhotoSourceLess,e.VideoSourceMessage,e.VideoSourcePost,e.VideoSourcePostponedPost,e.VideoSourceComment,e.VideoSourceComposer,e.VideoSourceChannelComposer,e.VideoSourceCommentsComposer,e.VideoSourceLess),RightPanel:e=>a().alt(e.Peer,e.ChannelPanel,e.SpacePanel),ScreenRoutes:e=>a().alt(e.Convo,e.Channel,e.ChannelsList,e.CallJoin,e.CallJoinShortened,e.ChatJoin,e.Settings,e.SpaceRoomRoute,e.SpaceRoute,e.Main),Main:()=>a().regexp(/\/?/).map((()=>({kind:"MainRoute"}))),CallJoin:()=>a().seqObj(a().string("/call/join/"),["callJoinHash",a().regexp(/^(.*)+$/)]).map((e=>({kind:"CallJoinRoute",callJoinHash:e.callJoinHash}))),CallJoinShortened:()=>a().seqObj(a().string("/call/"),["callJoinId",a().regexp(/^(.*)+$/)]).map((e=>({kind:"CallJoinShortenedRoute",callJoinId:e.callJoinId}))),ChatJoin:()=>a().seqObj(a().string("/chat/join/"),["chatJoinHash",a().regexp(/^(.*)+$/)]).map((e=>({kind:"ChatJoinRoute",chatJoinHash:e.chatJoinHash}))),Convo:()=>a().seqObj(a().string("/convo/"),["peerId",a().regexp(/(-)?[0-9]{1,10}$/)]).map((e=>({kind:"ConvoRoute",peerId:l.resolveId(Number(e.peerId)),entrypoint:"unknown"}))),Channel:()=>a().seqObj(a().string("/channels/"),["channelId",a().regexp(/(-)[0-9]{1,10}$/)]).map((e=>({kind:"ChannelRoute",channelId:c.resolveId(Number(e.channelId))}))),ChannelsList:()=>a().regexp(/\/channels\/?/).map((()=>({kind:"ChannelsListRoute"}))),Settings:()=>a().seqObj(a().regexp(/\/settings\/?/),["section",a().alt(...s.IRouter.SettingsRouteSectionKeys.map((e=>a().string(e))),a().seq(a().all,a().succeed("start")).map((e=>e[1])))],a().all).map((e=>({kind:"SettingsRoute",section:e.section}))),SpaceRoute:()=>a().seqObj(a().string("/space"),["spaceId",a().regexp(/\d*/)]).map((e=>({kind:"SpaceRoute",spaceId:p.resolveId(Number(e.spaceId))}))),SpaceRoomRoute:()=>a().seqObj(a().string("/space"),["spaceId",a().regexp(/\d*/)],a().string("/room"),["roomId",a().regexp(/\d*/)]).map((e=>({kind:"SpaceRoomRoute",spaceId:p.resolveId(Number(e.spaceId)),roomId:p.resolveRoomId(Number(e.roomId))}))),Peer:()=>a().seqObj(a().string("peer"),["peerId",a().regexp(/(-)?\d*/)],["section",a().alt(a().eof,a().seq(this.routeParamsDelimiterParser,a().alt(...s.IRouter.PeerPanelTabKeys.map((e=>a().string(e))))).map((e=>e[1])))]).map((e=>({kind:"PeerPanel",peerId:l.resolveId(Number(e.peerId)),section:e.section}))),ChannelPanel:()=>a().seqObj(a().string("channel"),["channelId",a().regexp(/(-)[0-9]{1,10}/)],["section",a().alt(a().eof,a().seq(this.routeParamsDelimiterParser,a().alt(...s.IRouter.ChannelPanelSectionKeys.map((e=>a().string(e))))).map((e=>e[1])))]).map((e=>({kind:"ChannelPanel",channelId:c.resolveId(Number(e.channelId)),section:e.section}))),SpacePanel:()=>a().seqObj(a().string("space"),["spaceId",a().regexp(/\d*/)]).map((e=>({kind:"SpacePanel",spaceId:p.resolveId(Number(e.spaceId))}))),Poll:()=>a().seqObj(a().string("poll"),["ownerId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["pollId",a().regexp(/(-)?\d*/)]).map((e=>({kind:"PollModal",ownerId:l.resolveId(Number(e.ownerId)),pollId:Number(e.pollId)}))),NewFolder:()=>a().seqObj(a().string("newFolder"),["peerId",a().regexp(/(-)?\d*/)]).map((e=>{const t=e.peerId&&l.resolveId(Number(e.peerId));return{kind:"NewFolderModal",...t&&{peerId:t}}})),EditFolder:()=>a().seqObj(a().string("editFolder"),["folderId",a().regexp(/(-)?\d*/)]).map((e=>{const t=d.resolveId(Number(e.folderId));return{kind:"EditFolderModal",...t&&{folderId:t}}})),Important:()=>a().string("important").map((()=>({kind:"ImportantMessagesModal"}))),MiniAppCatalog:()=>a().string("services").map((()=>({kind:"MiniAppCatalogModal"}))),SpaceRoomCreate:()=>a().seqObj(a().string("space-room-create"),this.routeParamsDelimiterParser,["spaceId",a().regexp(/\d*/)],this.routeParamsOptionalDelimiterParser,["sectionId",a().regexp(/\d*/)]).map((e=>{const t=e.sectionId&&p.resolveSectionId(Number(e.sectionId));return{kind:"SpaceRoomCreateModal",spaceId:p.resolveId(Number(e.spaceId)),...t&&{sectionId:t}}})),SpaceRoomUpdate:()=>a().seqObj(a().string("space-room-update"),this.routeParamsDelimiterParser,["spaceId",a().regexp(/\d*/)],this.routeParamsDelimiterParser,["roomId",a().regexp(/\d*/)]).map((e=>({kind:"SpaceRoomUpdateModal",spaceId:p.resolveId(Number(e.spaceId)),roomId:p.resolveRoomId(Number(e.roomId))}))),SpaceSectionCreate:()=>a().seqObj(a().string("space-section-create"),this.routeParamsDelimiterParser,["spaceId",a().regexp(/\d*/)]).map((e=>({kind:"SpaceSectionCreateModal",spaceId:p.resolveId(Number(e.spaceId))}))),MiniApp:()=>a().seqObj(a().string("miniapp"),["miniAppId",a().regexp(/(-)?\d+/)],["groupPeerId",a().alt(a().eof,a().seq(this.routeParamsDelimiterParser,a().regexp(/(-\d+)?/)).map((e=>e[1])))]).map((e=>{const t=e.groupPeerId&&Number(e.groupPeerId),o=t?l.resolveId(t):void 0,r=o&&l.isGroupPeerId(o)?o:void 0;return{kind:"MiniAppModal",miniAppId:(0,g.resolveMiniAppId)(Number(e.miniAppId)),...r&&{groupPeerId:r}}})),Photo:e=>a().seqObj(a().string("photo"),["ownerId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["id",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["accessKey",e.AccessKey]),PhotoSourceLess:e=>a().seqObj(["photo",e.Photo]).map((e=>({kind:"PhotoModal",ownerId:l.resolveId(Number(e.photo.ownerId)),id:Number(e.photo.id),accessKey:e.photo.accessKey}))),PhotoSourceMessage:e=>a().seqObj(["photo",e.PhotoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Message.toString()),this.routeParamsDelimiterParser,["peerId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["cmid",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["messageAccessKey",e.AccessKey],this.routeParamsOptionalDelimiterParser,["mediaViewerItemPosition",a().regexp(/\d*/)]).map((e=>({...e.photo,source:{kind:s.IRouter.RouteSourceKind.Message,peerId:l.resolveId(Number(e.peerId)),cmid:h.resolveCmid(Number(e.cmid)),messageAccessKey:e.messageAccessKey,...e.mediaViewerItemPosition&&{mediaViewerItemPosition:parseInt(e.mediaViewerItemPosition,10)}}}))),PhotoSourcePost:e=>a().seqObj(["photo",e.PhotoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Post.toString()),this.routeParamsDelimiterParser,["channelId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["cmid",a().regexp(/(-)?\d*/)],this.routeParamsOptionalDelimiterParser,["mediaViewerItemPosition",a().regexp(/\d*/)]).map((e=>({...e.photo,source:{kind:s.IRouter.RouteSourceKind.Post,channelId:c.resolveId(Number(e.channelId)),cmid:m.resolveCmid(Number(e.cmid)),...e.mediaViewerItemPosition&&{mediaViewerItemPosition:parseInt(e.mediaViewerItemPosition,10)}}}))),RouteSourcePostponedPost:e=>a().seqObj(["photo",e.PhotoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.PostponedPost.toString()),this.routeParamsDelimiterParser,["channelId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["cmid",a().regexp(/(-)?\d*/)]).map((e=>({...e.photo,source:{kind:s.IRouter.RouteSourceKind.PostponedPost,channelId:c.resolveId(Number(e.channelId)),cmid:m.resolveCmid(Number(e.cmid))}}))),PhotoSourceComment:e=>a().seqObj(["photo",e.PhotoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Comment.toString()),this.routeParamsDelimiterParser,["channelId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["postCmid",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["commentCmid",a().regexp(/(-)?\d*/)]).map((e=>({...e.photo,source:{kind:s.IRouter.RouteSourceKind.Comment,channelId:c.resolveId(Number(e.channelId)),postCmid:m.resolveCmid(Number(e.postCmid)),commentCmid:u.resolveCmid(Number(e.commentCmid))}}))),PhotoSourceComposer:e=>a().seqObj(["photo",e.PhotoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Composer.toString())).map((e=>({...e.photo,source:{kind:s.IRouter.RouteSourceKind.Composer}}))),PhotoSourceChannelComposer:e=>a().seqObj(["photo",e.PhotoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.ChannelComposer.toString())).map((e=>({...e.photo,source:{kind:s.IRouter.RouteSourceKind.ChannelComposer}}))),PhotoSourceCommentsComposer:e=>a().seqObj(["photo",e.PhotoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.CommentsComposer.toString())).map((e=>({...e.photo,source:{kind:s.IRouter.RouteSourceKind.CommentsComposer}}))),Video:e=>a().seqObj(a().string("video"),["ownerId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["id",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["accessKey",e.AccessKey]),VideoSourceLess:e=>a().seqObj(["video",e.Video]).map((e=>({kind:"VideoModal",ownerId:Number(e.video.ownerId),id:Number(e.video.id),accessKey:e.video.accessKey}))),VideoSourceMessage:e=>a().seqObj(["video",e.VideoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Message.toString()),this.routeParamsDelimiterParser,["peerId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["cmid",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["messageAccessKey",e.AccessKey],this.routeParamsOptionalDelimiterParser,["mediaViewerItemPosition",a().regexp(/\d*/)]).map((e=>({...e.video,source:{kind:s.IRouter.RouteSourceKind.Message,peerId:l.resolveId(Number(e.peerId)),cmid:h.resolveCmid(Number(e.cmid)),messageAccessKey:e.messageAccessKey,...e.mediaViewerItemPosition&&{mediaViewerItemPosition:parseInt(e.mediaViewerItemPosition,10)}}}))),VideoSourcePost:e=>a().seqObj(["video",e.VideoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Post.toString()),this.routeParamsDelimiterParser,["channelId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["cmid",a().regexp(/(-)?\d*/)],this.routeParamsOptionalDelimiterParser,["mediaViewerItemPosition",a().regexp(/\d*/)]).map((e=>({...e.video,source:{kind:s.IRouter.RouteSourceKind.Post,channelId:c.resolveId(Number(e.channelId)),cmid:m.resolveCmid(Number(e.cmid)),...e.mediaViewerItemPosition&&{mediaViewerItemPosition:parseInt(e.mediaViewerItemPosition,10)}}}))),VideoSourcePostponedPost:e=>a().seqObj(["video",e.VideoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.PostponedPost.toString()),this.routeParamsDelimiterParser,["channelId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["cmid",a().regexp(/(-)?\d*/)]).map((e=>({...e.video,source:{kind:s.IRouter.RouteSourceKind.PostponedPost,channelId:c.resolveId(Number(e.channelId)),cmid:m.resolveCmid(Number(e.cmid))}}))),VideoSourceComment:e=>a().seqObj(["video",e.VideoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Comment.toString()),this.routeParamsDelimiterParser,["channelId",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["postCmid",a().regexp(/(-)?\d*/)],this.routeParamsDelimiterParser,["commentCmid",a().regexp(/(-)?\d*/)]).map((e=>({...e.video,source:{kind:s.IRouter.RouteSourceKind.Comment,channelId:c.resolveId(Number(e.channelId)),postCmid:m.resolveCmid(Number(e.postCmid)),commentCmid:u.resolveCmid(Number(e.commentCmid))}}))),VideoSourceComposer:e=>a().seqObj(["video",e.VideoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.Composer.toString())).map((e=>({...e.video,source:{kind:s.IRouter.RouteSourceKind.Composer}}))),VideoSourceChannelComposer:e=>a().seqObj(["video",e.VideoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.ChannelComposer.toString())).map((e=>({...e.video,source:{kind:s.IRouter.RouteSourceKind.ChannelComposer}}))),VideoSourceCommentsComposer:e=>a().seqObj(["video",e.VideoSourceLess],this.routeParamsDelimiterParser,a().string(s.IRouter.RouteSourceKind.CommentsComposer.toString())).map((e=>({...e.video,source:{kind:s.IRouter.RouteSourceKind.CommentsComposer}}))),AccessKey:()=>a().regexp(/[-0-9a-zA-Z]*/)}),this.fromUrl=e=>{const t=(0,n.parsePath)(e),o=new URLSearchParams(t.search),r=this.parseParams(o);if(!t.pathname)return{kind:"MainRoute",...r};try{const a=this.parser.ScreenRoutes.tryParse(t.pathname);switch(a.kind){case"MainRoute":{const s=o.get("call"),d=o.get("call_id"),p=o.get("chat");return{kind:"MainRoute",...s&&{callJoinHash:s},...p&&{chatJoinHash:p},...d&&{callJoinId:d},...this.parseConvoRouteExtraParams(o),...r}}case"CallJoinRoute":return{kind:"CallJoinRoute",callJoinHash:a.callJoinHash,...r};case"ChatJoinRoute":return{kind:"ChatJoinRoute",chatJoinHash:a.chatJoinHash,...r};case"CallJoinShortenedRoute":return{kind:"CallJoinShortenedRoute",callJoinId:a.callJoinId,...r};case"ConvoRoute":{const g=o.get("search"),_=o.get("chat_invite"),k=o.get("call_id"),v=o.get("call_join"),I=o.get("cmid"),f=o.get("ref"),P=o.get("ref_source"),R=o.get("highlight"),w=o.get("parent_route"),b=o.get("sferum"),y=o.get("entrypoint")||"unknown";let C;if(w){const S=this.fromUrl(window.atob(w));"ConvoRoute"!==S.kind&&"ChannelRoute"!==S.kind||(C=S)}return{kind:"ConvoRoute",peerId:l.resolveId(Number(a.peerId)),sferum:b?Boolean(b):void 0,...y&&{entrypoint:y},...f&&{ref:f},...P&&{refSource:P},..._&&{chatJoinHash:_},...v&&{callJoinHash:v},...k&&{callJoinId:k},...null!=g?{search:g}:{},...I&&{cmid:h.resolveCmid(Number(I))},...R&&{highlightQuery:R},...this.parseConvoRouteExtraParams(o),...C&&{parentRoute:C},...r}}case"ChannelRoute":{const $=o.get("cmid"),x=o.get("comment"),M=o.get("sferum"),D=o.get("search"),A=this.featureFlags.vkm_channels_postponed?U(o):void 0,L=o.get("parent_route");let N;if(L){const K=this.fromUrl(window.atob(L));"ConvoRoute"!==K.kind&&"ChannelRoute"!==K.kind||(N=K)}return{kind:"ChannelRoute",channelId:c.resolveId(Number(a.channelId)),postCmid:null!==$?m.resolveCmid(Number($)):void 0,commentCmid:null!==x?u.resolveCmid(Number(x)):void 0,sferum:M?Boolean(M):void 0,postponed:A,...null!=D?{search:D}:{},...this.parseConvoRouteExtraParams(o),...N&&{parentRoute:N},...r};function U(e){const t=e.get("postponed");if(!t)return;const o=m.resolveCmid(Number(t));return!(o>0)||o}}case"ChannelsListRoute":return{kind:"ChannelsListRoute",...this.parseConvoRouteExtraParams(o),...r};case"NotFoundRoute":return{kind:"NotFoundRoute",...r};case"SettingsRoute":{const E=o.get("back");let J;return E&&(J=this.fromUrl(window.atob(E))),{...a,back:J,...r}}case"SpaceRoute":return{kind:"SpaceRoute",spaceId:a.spaceId,...r};case"SpaceRoomRoute":{const j=o.get("cmid");return{kind:a.kind,spaceId:a.spaceId,roomId:a.roomId,cmid:j?h.resolveCmid(Number(j)):void 0,...r}}default:(0,i.exhaustivenessCheck)(a)}}catch(V){}return{kind:"NotFoundRoute",...r}},this.toUrl=e=>{const t=(t=new URLSearchParams)=>{const o=this.createGlobalQueryFromRoute(e,t),r=[];for(const[e,t]of o.entries())r.push(`${e}=${encodeURIComponent(t)||""}`);return r.length?`?${r.join("&")}`:""};switch(e.kind){case"ConvoRoute":{const o=this.createConvoExtraParamsQueryFromRoute(e);return void 0!==e.search&&o.append("search",String(e.search)),void 0!==e.highlightQuery&&o.append("highlight",e.highlightQuery),e.cmid&&o.append("cmid",String(e.cmid)),e.chatJoinHash&&o.append("chat_invite",e.chatJoinHash),e.callJoinHash&&o.append("call_join",e.callJoinHash),e.callJoinId&&o.append("call_id",e.callJoinId),e.parentRoute&&o.append("parent_route",window.btoa(this.toUrl(e.parentRoute))),e.entrypoint&&o.append("entrypoint",e.entrypoint),`/convo/${e.peerId}${t(o)}`}case"ChannelsListRoute":{const o=this.createConvoExtraParamsQueryFromRoute(e);return`${c.CHANNELS_BASE_PATH}${t(o)}`}case"ChannelRoute":{const o=new URLSearchParams;return void 0!==e.commentCmid&&o.append("comment",e.commentCmid.toString()),void 0!==e.search&&o.append("search",String(e.search)),void 0!==e.postCmid&&o.append("cmid",e.postCmid.toString()),void 0!==e.postponed&&o.append("postponed",e.postponed.toString()),e.parentRoute&&o.append("parent_route",window.btoa(this.toUrl(e.parentRoute))),`${c.CHANNELS_BASE_PATH}/${e.channelId}${t(o)}`}case"MainRoute":{const o=this.createConvoExtraParamsQueryFromRoute(e);return e.callJoinHash&&o.set("call",e.callJoinHash),e.chatJoinHash&&o.set("chat",e.chatJoinHash),e.callJoinId&&o.set("call_id",e.callJoinId),`/${t(o)}`}case"CallJoinRoute":return`/call/join/${e.callJoinHash}${t()}`;case"CallJoinShortenedRoute":return`/call/${e.callJoinId}${t()}`;case"ChatJoinRoute":return`/chat/join/${e.chatJoinHash}${t()}`;case"SettingsRoute":const o=new URLSearchParams;return e.back&&o.append("back",window.btoa(this.toUrl(e.back))),`/settings/${e.section}`+t(o);case"NotFoundRoute":return`/${t()}`;case"SpaceRoute":return`${`/space${e.spaceId}`}${t()}`;case"SpaceRoomRoute":{const o=new URLSearchParams;void 0!==e.cmid&&o.append("cmid",e.cmid.toString());return`${`/space${e.spaceId}/room${e.roomId}`}${t(o)}`}default:(0,i.exhaustivenessCheck)(e)}},this.toRightPanelParam=e=>{const t=e.kind;switch(t){case"PeerPanel":return e.section?`peer${e.peerId}${this.routeParamsDelimiter}${e.section}`:`peer${e.peerId}`;case"ChannelPanel":return e.section?`channel${e.channelId}${this.routeParamsDelimiter}${e.section}`:`channel${e.channelId}`;case"SpacePanel":return`space${e.spaceId}`;default:(0,i.exhaustivenessCheck)(t)}},this.toModalParam=e=>{switch(e.kind){case"MiniAppModal":{const t=new URLSearchParams;return e.referer&&t.append("vk_ref",e.referer),e.webviewUrl&&t.append("webview_url",e.webviewUrl),e.entrypoint&&t.append("entrypoint",e.entrypoint),e.hash&&t.append("hash",e.hash),{param:`miniapp${e.miniAppId}${e.groupPeerId?`${this.routeParamsDelimiter}${e.groupPeerId}`:""}`,query:t}}case"MiniAppCatalogModal":return{param:"services"};case"SpaceRoomCreateModal":{const t=[e.spaceId];return e.sectionId&&t.push(e.sectionId),{param:`space-room-create_${t.join(this.routeParamsDelimiter)}`}}case"SpaceRoomUpdateModal":return{param:`space-room-update_${e.spaceId}${this.routeParamsDelimiter}${e.roomId}`};case"SpaceSectionCreateModal":return{param:`space-section-create${this.routeParamsDelimiter}${e.spaceId}`};case"PollModal":return{param:`poll${e.ownerId}${this.routeParamsDelimiter}${e.pollId}`};case"NewFolderModal":return{param:"newFolder"+(e.peerId?`${e.peerId}`:"")};case"EditFolderModal":return{param:`editFolder${e.folderId}`};case"ImportantMessagesModal":return{param:"important"};case"PhotoModal":case"VideoModal":const t="PhotoModal"===e.kind?"photo":"video",o=[e.ownerId.toString(),e.id.toString(),e.accessKey||""];if(e.source)switch(o.push(e.source.kind.toString()),e.source.kind){case s.IRouter.RouteSourceKind.Message:o.push(e.source.peerId.toString(),e.source.cmid.toString(),e.source.messageAccessKey||"",(e.source.mediaViewerItemPosition??0).toString());break;case s.IRouter.RouteSourceKind.Post:o.push(e.source.channelId.toString(),e.source.cmid.toString(),(e.source.mediaViewerItemPosition??0).toString());break;case s.IRouter.RouteSourceKind.PostponedPost:o.push(e.source.channelId.toString(),e.source.cmid.toString());break;case s.IRouter.RouteSourceKind.Comment:o.push(e.source.channelId.toString(),e.source.postCmid.toString(),e.source.commentCmid.toString());break;case s.IRouter.RouteSourceKind.Composer:case s.IRouter.RouteSourceKind.ChannelComposer:case s.IRouter.RouteSourceKind.CommentsComposer:break;default:(0,i.exhaustivenessCheck)(e.source)}return{param:`${t}${o.join(this.routeParamsDelimiter)}`};default:(0,i.exhaustivenessCheck)(e)}},this.parseParams=e=>{const t={};return s.IRouter.globalParamsKeys.reduce(((o,r)=>{switch(r){case"createPoll":t[r]=Boolean(e.get(r));break;case"folder":const o=e.get("folder");o&&(t.folder=d.resolveId(Number(o)));break;case"tab":t.tab=function(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return}}(e.get("tab"));break;case"sferum":t.sferum="true"===e.get("sferum");break;case"p":const a=e.get("p");a&&(t.p=a);break;case"modal":const s=[];for(const t of e.getAll("modal"))try{const o=this.parser.Modal.tryParse(t);"MiniAppModal"===o.kind&&(e.has("hash")&&(o.hash=e.get("hash")||void 0),e.has("vk_ref")&&(o.referer=e.get("vk_ref")||void 0),e.has("webview_url")&&(o.webviewUrl=e.get("webview_url")||void 0),e.has("entrypoint")&&(o.entrypoint=e.get("entrypoint")||void 0)),s.push(o)}catch(e){}s.length&&(t.modal=s);break;case"rp":const n=[];for(const t of e.getAll("rp"))try{n.push(this.parser.RightPanel.tryParse(t))}catch(e){}n.length&&(t.rp=n);break;default:(0,i.exhaustivenessCheck)(r)}return o}),{}),t},this.parseConvoRouteExtraParams=e=>s.IRouter.convoRouteExtraParamsKeys.reduce(((t,o)=>(e.has(o)&&(t[o]=!0),t)),{}),this.createGlobalQueryFromRoute=(e,t=new URLSearchParams)=>(s.IRouter.globalParamsKeys.forEach((o=>{if(o in e)switch(o){case"createPoll":case"folder":case"sferum":case"p":case"tab":{const r=e[o];r?t.append(o,r.toString()):t.delete(o);break}case"modal":e.modal?.forEach((e=>{const r=this.toModalParam(e);t.append(o,r.param),r.query?.forEach(((e,o)=>t.append(o,e)))}));break;case"rp":e.rp?.forEach((e=>{const r=this.toRightPanelParam(e);t.append(o,r)}));break;default:(0,i.exhaustivenessCheck)(o)}})),t),this.createConvoExtraParamsQueryFromRoute=(e,t=new URLSearchParams)=>(s.IRouter.convoRouteExtraParamsKeys.forEach((o=>{o in e&&(e[o]?t.append(o,""):t.delete(o))})),t),this.getAttachLink=(e,t)=>{switch(e.kind){case"Audio":return`https://${t}/audio${e.ownerId}_${e.id}`;case"AudioPlaylist":const o=e.accessKey?`_${e.accessKey}`:"";return`https://${t}/music/${e.type}/${e.ownerId}_${e.id}${o}`;case"Artist":return`https://${t}/artist/${e.id}`;case"Podcast":return`https://${t}/im?z=podcast${e.ownerId}_${e.id}`;case"Doc":return`https://${t}/doc${e.ownerId}_${e.id}`;case"Sticker":return`https://${t}/stickers`;case"UgcSticker":return"";case"Link":case"StickerPack":return e.url;case"Voice":return"";case"Market":return`https://${t}/market${e.ownerId}?w=product${e.ownerId}_${e.id}`;case"MoneyTransfer":case"MoneyRequest":return"";case"Gift":return`https://${t}/gifts`;case"Graffiti":return"";case"MarketAlbum":return`https://${t}/market${e.ownerId}?section=album_${e.id}`;case"FinishedCall":return"";case"Poll":return`https://${t}/im?w=poll${e.ownerId}_${e.id}`;case"Story":return`https://${t}/im?w=story${e.ownerId}_${e.id}/${e.ownerId}_${e.id}`;case"Narrative":return`https://${t}/narrative${e.ownerId}_${e.id}`;case"Album":return`https://${t}/album${e.ownerId}_${e.id}`;case"Event":return`https://${t}/public${l.toRealId(e.id)}`;case"Article":return e.url;case"Wall":case"WallHistory":return`https://${t}/wall${e.ownerId}_${e.id}`;case"WallReply":return`https://${t}/wall${e.ownerId}_${e.postId}?reply=${e.id}`+(e.parentsStack&&e.parentsStack.length>0?`&thread=${e.parentsStack.join("_")}`:"");case"Geo":case"ActiveCall":return"";case"MiniApp":case"MiniAppWidget":switch(e.type){case"app":case"game":case"html5_game":return`https://${t}/${e.appLink}`;default:return`https://${t}/im?w=${e.appLink}`}case"DonutLink":return`https://${t}/donut/club${l.toRealId(e.ownerId)}`;case"InviteLink":case"Curator":return e.url;case"VideoMessage":case"Widget":case"Question":return"";default:return(0,i.exhaustivenessCheck)(e)}},this.featureFlags=e}}class R{mutate(e){return{...this.route,...e}}_push(e,t){return(t||[]).concat(e)}_replace(e,t){return(t||[]).slice(0,-1).concat(e)}_pop(e){return e?.length&&e.length>1?e.slice(0,-1):void 0}constructor(e){this.push=e=>s.IRouter.isModal(e)?this.mutate({modal:this._push(e,this.route.modal)}):s.IRouter.isRightPanel(e)?this.mutate({modal:void 0,rp:this._replace(e,this.route.rp)}):void(0,i.exhaustivenessCheck)(e),this.replace=e=>s.IRouter.isModal(e)?this.mutate({modal:this._replace(e,this.route.modal)}):s.IRouter.isRightPanel(e)?this.mutate({modal:void 0,rp:this._replace(e,this.route.rp)}):void(0,i.exhaustivenessCheck)(e),this.pop=()=>{for(const e of s.IRouter.stackableLevels)switch(e){case s.IRouter.StackableType.Modal:if(this.route.modal?.length)return this.mutate({modal:this._pop(this.route.modal)});break;case s.IRouter.StackableType.RightPanel:if(this.route.rp?.length)return this.mutate({rp:this._pop(this.route.rp)});break;default:(0,i.exhaustivenessCheck)(e)}return this.mutate()},this.route=e}}const w=(e,t)=>{const o={...e},r="ConvoRoute"===o.kind&&"ConvoRoute"===t.kind&&o.peerId!==t.peerId,a="ChannelRoute"===o.kind&&"ChannelRoute"===t.kind&&o.channelId!==t.channelId,s="ChannelRoute"===o.kind&&"ConvoRoute"===t.kind,n="ConvoRoute"===o.kind&&"ChannelRoute"===t.kind;return r||a||s||n?("ConvoRoute"===o.kind&&o.cmid&&(o.cmid=void 0),"ChannelRoute"===o.kind&&o.postCmid&&(o.postCmid=void 0),{...t,parentRoute:o}):t}},354632:(e,t,o)=>{o.d(t,{FC_IDENTIFIER_PREFIX:()=>P,IDENTIFIER_PREFIX:()=>f,VKME_VKCALL_CONTAINER_ID:()=>S,VkComRouter:()=>b,createFeatureFlags:()=>R,createLang:()=>w,exhaustivenessCheck:()=>C,getCurrentModule:()=>x,isMasterTab:()=>y,isStandaloneProd:()=>$});var r=o(194073),a=o(59818),s=o(68655),n=(o(319210),o(924676),o(476726)),i=o(465094),c=o(714209),u=o(805088),d=o(744025),l=o(825685),h=o(20025),m=o(927984),p=o(119243),g=o(610989),_=o(388078),k=o(815019),v=o(359136),I=o(957081);const f="vkme",P="fastchats";function R(){const e={helloStickersPack:[21,12467,53098,50456,50459,18164,134,51117,16263,4275,6329,12296,21560,13312,20952,56896,20465,11607,53320,53647],helloKeywordPack:window.stickersKeywords?.["привет"]?.filter((e=>e>0))||[]};return{...r.DEFAULT_FEATURE_FLAGS,me_fc_multiple_windows:!0,me_sticker_packs:e,me_fc_message_actions:(0,n.partConfigEnabled)("me_fc_message_actions"),me_message_selecting:(0,n.partConfigEnabled)("me_message_selecting"),vkm_hide_forward_author:(0,n.partConfigEnabled)("vkm_hide_forward_author"),vkm_mediascope_collect:(0,n.partConfigEnabled)("messenger_mediascope_stats_collect"),vkm_widget_attaches:(0,n.partConfigEnabled)("vkm_widget_attaches"),vkm_reactions:(0,n.partConfigEnabled)("vkm_reactions"),vkm_marusia_chat:(0,n.partConfigEnabled)("vkm_marusia_chat"),vkm_marusia_main_chat:(0,n.partConfigEnabled)("vkm_marusia_main_chat"),vkm_ugc_stickers_in_keyboard:(0,I.isUGCStickersEnabled)(),vkm_stickers_popup:(0,u.isPopUpStickersEnabled)()}}function w(e){const t=[g.getLang("month1","raw"),g.getLang("month2","raw"),g.getLang("month3","raw"),g.getLang("month4","raw"),g.getLang("month5","raw"),g.getLang("month6","raw"),g.getLang("month7","raw"),g.getLang("month8","raw"),g.getLang("month9","raw"),g.getLang("month10","raw"),g.getLang("month11","raw"),g.getLang("month12","raw")],o=Object.values(g.getLang("months_of","raw")),r=Object.values(g.getLang("months_sm_of","raw")),s=[g.getLang("global_monday","raw"),g.getLang("global_tuesday","raw"),g.getLang("global_wednesday","raw"),g.getLang("global_thursday","raw"),g.getLang("global_friday","raw"),g.getLang("global_saturday","raw"),g.getLang("global_sunday","raw")],n=[g.getLang("global_monday_short","raw"),g.getLang("global_tuesday_short","raw"),g.getLang("global_wednesday_short","raw"),g.getLang("global_thursday_short","raw"),g.getLang("global_friday_short","raw"),g.getLang("global_saturday_short","raw"),g.getLang("global_sunday_short","raw")];return new a.Lang(e,{keys:{...window.lang,global_months:t,global_months_of:o,global_months_short_of:r,global_week_days:s,global_week_days_short:n},config:window.langConfig})}class b extends s.Router{toUrl(e){switch(e.kind){case"SpaceRoute":case"HashtagProxyRoute":case"HashtagMentionProxyRoute":case"ChatJoinProxyRoute":case"ScreenNameProxyRoute":case"CallJoinProxyRoute":case"CallJoinShortenedProxyRoute":case"ChannelJoinProxyRoute":case"StickerPackProxyRoute":case"StickersStoreProxyRoute":case"GiftsCatalogProxyRoute":case"SferumChannelProxyRoute":return super.toUrl(e);case"AttachProxyRoute":switch(e.attach.kind){case"MiniApp":return e.attach.shareUrl;case"MoneyTransfer":case"MoneyRequest":case"Geo":return"#";default:return super.toUrl(e)}case"VkProxyRoute":return e.pathname;case"AttachMediaProxyRoute":switch(e.attach.kind){case"Photo":{if((0,n.partConfigEnabled)("vkm_integration_media_viewer"))return super.toUrl(e);const t=e.attach.accessKey?`/${e.attach.accessKey}`:"";return`/im?z=photo${e.attach.ownerId}_${e.attach.id}${t}`}case"Video":{if((0,n.partConfigEnabled)("vkm_integration_media_viewer")&&e.attach.isFromMessage)return super.toUrl(e);const t=e.attach.accessKey?`/${e.attach.accessKey}`:"";return`/im?z=${"short_video"===e.attach.type?"clip":"video"}${e.attach.ownerId}_${e.attach.id}${t}`}default:C(e.attach)}default:{const t=e.modal?.slice(-1).pop(),o=e.rp?.slice(-1).pop();if(t)switch(t.kind){case"PollModal":{const{pollId:e,ownerId:o}=t;return`/im?w=poll${o}_${e}`}case"MiniAppModal":{let e=t.hash;if(t.webviewUrl){const o=new URL(t.webviewUrl).hash;e=o.length?o.substr(1):e}return`/app${t.miniAppId}${t.groupPeerId?`_${t.groupPeerId}`:""}${e?`#${e}`:""}`}}else if(o&&"PeerPanel"===o.kind){const{peerId:t,screenName:r}=o;return r?`/${r}`:_.Ranges.isUserIdTransitional(t)?`/id${t}`:_.Ranges.isGroupId(t)?`/club${Math.abs(t)}`:_.Ranges.isContactId(t)?"/im?sel=mr"+(t-1e9):(0,n.partConfigEnabled)("vkm_reforged_in_vkcom")&&this.isIm?super.toUrl(e):`/im?sel=${t}`}switch(e.kind){case"SettingsRoute":default:return super.toUrl(e);case"ConvoRoute":return(0,n.partConfigEnabled)("vkm_reforged_in_vkcom")&&this.isIm?super.toUrl(e):e.search?(0,n.partConfigEnabled)("vkm_reforged_in_vkcom")?super.toUrl(e):`/im?sel=${e.peerId}&st=${encodeURIComponent(e.search)}`:`/im?sel=${e.peerId}`}}}}push(e){let t=null;switch(e.kind){case"AttachMediaProxyRoute":{const t=e.attach;if((0,n.partConfigEnabled)("vkm_integration_media_viewer"))return void("Video"!==t.kind||t.isFromMessage?super.push(e):(0,d.showVideo)(`${t.ownerId}_${t.id}`,t.accessKey||"",{autoplay:1,minimized:0,module:"",queue:1}));switch(t.kind){case"Photo":{const o="c_uniq_tag",r={},a="vkcomIntegrationAdditionalParam"in e&&e.vkcomIntegrationAdditionalParam;let s;const n=Boolean("message"===e.source?.kind&&a),i=(n?t.vkcomWebViewToken:t.messageAccessKey)||t.messageAccessKey||t.accessKey||"";if(t.sizes.forEach(((e,t)=>{const a=new URLSearchParams(e.url);a.delete(o);const s=decodeURIComponent(a.toString());r[t]=s,r[`${t}_`]=[s,e.width,e.height]})),n&&a){const e=[];s=a.reduce(((e,t)=>(e.push(`${t.ownerId}_${t.id}/${t.vkcomWebViewToken}`),e)),e).join(";")}return void(0,m.showPhoto)(`${t.ownerId}_${t.id}`,i,{additional:{draft_photos:s},temp:r,queue:1})}case"Video":return void(0,d.showVideo)(`${t.ownerId}_${t.id}`,t.accessKey||"",{autoplay:1,minimized:0,module:"",queue:1});default:C(t)}break}case"AttachProxyRoute":{const o=e.attach;switch(o.kind){case"MiniApp":return void window.open(o.shareUrl,"_blank");case"Wall":case"WallHistory":return void(0,m.showWiki)({w:`wall${o.ownerId}_${o.id}`});case"WallReply":return void(0,m.showWiki)({w:`wall${o.ownerId}_${o.postId}`,reply:o.id});case"Poll":return void(0,m.showWiki)({w:`poll${o.ownerId}_${o.id}`},!1,void 0,{queue:1});case"Story":return void(0,p.showStory)(`story${o.ownerId}_${o.id}/${o.ownerId}_${o.id}`);case"Narrative":return void(0,p.showNarrative)(o.ownerId,o.id);case"Gift":return o.isStickerStyle&&o.id?window.Emoji.clickSticker(Math.abs(o.id)):void(0,h.showBox)("al_gifts.php",{act:"box",tab:"sent",mid:window.vk.id},{cache:1,stat:["page.css","gifts.css",window.jsc("web/gifts.js")]});case"MoneyTransfer":return void(0,h.showBox)("al_payments.php?act=money_transfer_history_box",{});case"MoneyRequest":{const e=void 0!==o.userCount;return o.isUserOwner?void(e?(0,h.showBox)("al_payments.php",{act:"money_transfer_history_owner_box",request_id:`${o.fromId}_${o.toId}:${o.id}`}):(0,h.showBox)("al_payments.php?act=money_transfer_history_box",{})):void v.MoneyTransfer.showMoneyTransferBox({to_id:o.fromId,amount:o.amount,currency:o.currencyCode,owner_id:o.toId,request_id:o.id,hash:o.hash,request:`${o.fromId};${o.amount};${o.currencyCode};${o.toId}`})}case"Geo":return void(0,h.showBox)("al_places.php",{act:"show_photo_place",lat:o.coordinates.latitude,long:o.coordinates.longitude,provider:4});case"MiniApp":return void window.open(`/${o.appLink}`);case"Article":return void window.open(`${o.url}`);case"Link":{const t=o.url||e.fallbackUrl;if(t?.startsWith(`${window.location.origin}/invite/`)){const e=new RegExp(`${window.location.origin}/invite/(\\S*)`),o=t.match(e)?.[1];if(o)return void(0,l.showInviteLinkBox)(o)}return void super.push(e)}case"Event":return void super.push(e);default:t=this.toUrl(e)}break}case"HashtagProxyRoute":case"HashtagMentionProxyRoute":case"ScreenNameProxyRoute":case"VkProxyRoute":case"SferumChannelProxyRoute":default:t=this.toUrl(e);break;case"StickerPackProxyRoute":return void(0,k.previewSticker)(e.stickerPackId,e.randomPackAttemptId);case"StickersStoreProxyRoute":return void window.Emoji?.showStickersStore(void 0,void 0,{peerId:e.peerId});case"GiftsCatalogProxyRoute":return void(0,h.showBox)("al_gifts.php",{stat:["gifts.css",window.jsc("web/gifts.js")],act:"get_gift_box",mid:e.peerId});case"MiniAppModal":{const t=this.toUrl({kind:"MainRoute",modal:[e]}),o=e.referer,r=e.webviewUrl,a=e.fromPeerId,s=o||"snippet_im",n={};if(r){const e=new URL(r);["vk_chat_id","vk_message_id"].forEach((t=>{const o=e.searchParams.get(t);o&&(n[t]=encodeURIComponent(o))}))}const i={w:t.replace("/",""),app_ref:s,...n};return void(t&&(!e.groupPeerId&&a?(0,m.showApp)(void 0,e.miniAppId,!1,{ref:s},null,{layer:!0,peer_id:a,urlHash:e.hash,...n}):(0,m.showWiki)(i,!1)))}case"PollModal":{const{pollId:t,ownerId:o}=e;return void(0,m.showWiki)({w:`poll${o}_${t}`},!1,void 0,{queue:1})}case"PhotoModal":{const{ownerId:t,id:o,accessKey:r}=e;return void(0,m.showPhoto)(`${t}_${o}`,r,{})}case"VideoModal":{const{ownerId:t,id:o,accessKey:r}=e;return void(0,d.showVideo)(`${t}_${o}`,r||"",{autoplay:1,minimized:0,module:"",queue:1})}case"ChannelPanel":case"PeerPanel":t=(0,n.partConfigEnabled)("vkm_reforged_in_vkcom")&&this.isIm?super.toUrl({...this.screenRoute,rp:[e]}):this.toUrl({kind:"MainRoute",rp:[e]});break;case"ConvoRoute":if((0,n.partConfigEnabled)("vkm_reforged_in_vkcom")&&this.isIm){const o="ConvoRoute"===this.screenRoute.kind&&this.screenRoute.peerId!==e.peerId,r="ConvoRoute"===this.screenRoute.kind&&this.screenRoute.entrypoint!==e.entrypoint,a="ConvoRoute"!==this.screenRoute.kind;if(o||r||a){const t={type:e.entrypoint,id:e.peerId};i.navigationStat.sendGo("im_chat",{destinationItem:t})}t=super.toUrl(e)}else t=this.toUrl(e);break;case"SpacePanel":case"SpaceRoute":case"SpaceRoomRoute":case"AudioRestrictionRuntimeRoute":case"EmptyRuntimeRoute":case"RedirectRuntimeRoute":case"ModalMessageRuntimeRoute":case"CallJoinRoute":case"ChannelRoute":case"ChannelsListRoute":case"ChatJoinRoute":case"CallJoinShortenedRoute":case"SettingsRoute":case"MainRoute":case"NotFoundRoute":case"MiniAppCatalogModal":case"ImportantMessagesModal":case"NewFolderModal":case"EditFolderModal":case"SpaceSectionCreateModal":case"SpaceRoomCreateModal":case"SpaceRoomUpdateModal":case"SpaceSectionCreateModal":return void super.push(e)}t&&window.nav.go(t)}constructor(e,...t){super(...t),this.fromExternalUrl=e=>this.fromUrl(e),this.pop=()=>{this.push(this.getStackUtils().pop())},this.isIm=e}}function y(){return!window.curNotifier||window.curNotifier.is_server||c.browser.safari}function C(e){throw new Error("Exhaustivness failure! This should never happen.")}const S="callsApp";function $(){return"web.vk.me"===window.location.hostname}function x(){return window.cur.module||window.location.pathname.split("/")[1]}}}]);try{stManager.done("dist/web/chunks/0fae8e06.158819ed.js")}catch(e){}