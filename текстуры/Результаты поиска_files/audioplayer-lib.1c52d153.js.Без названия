"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[79210],{936315:(e,t,i)=>{i.d(t,{default:()=>o});const o={root:"AudioPlayerBlockCompactLayout-module__root--BnuDa"}},903987:(e,t,i)=>{i.d(t,{default:()=>o});const o={fixed:"AudioPlayerBlockDefaultLayout-module__fixed--PM5g2",shown:"AudioPlayerBlockDefaultLayout-module__shown--aBBZI"}},634161:(e,t,i)=>{i.d(t,{default:()=>o});const o={root:"AudioPlayerBlockSectionsLayout-module__root--P3xRs",compact:"AudioPlayerBlockSectionsLayout-module__compact--jtPaX",playbackControls:"AudioPlayerBlockSectionsLayout-module__playbackControls--GGpCx",userControls:"AudioPlayerBlockSectionsLayout-module__userControls--c5FwD",episode:"AudioPlayerBlockSectionsLayout-module__episode--YFGNT",radio:"AudioPlayerBlockSectionsLayout-module__radio--Pbqxf",playbackBody:"AudioPlayerBlockSectionsLayout-module__playbackBody--HNLKs"}},167634:(e,t,i)=>{i.d(t,{default:()=>o});const o={root:"AudioPlayerPlaybackControlsContainer-module__root--XOdnm",playbackControls:"AudioPlayerPlaybackControlsContainer-module__playbackControls--cUwI8",episode:"AudioPlayerPlaybackControlsContainer-module__episode--tel8r",radio:"AudioPlayerPlaybackControlsContainer-module__radio--oyB2G",compact:"AudioPlayerPlaybackControlsContainer-module__compact--IJ04g",playbackButtonsContainer:"AudioPlayerPlaybackControlsContainer-module__playbackButtonsContainer--TYuxY",playbackButton:"AudioPlayerPlaybackControlsContainer-module__playbackButton--LV72Z",playbackSpeed:"AudioPlayerPlaybackControlsContainer-module__playbackSpeed--NBrRN"}},371698:(e,t,i)=>{i.d(t,{default:()=>o});const o={root:"AudioPlayerUserControlsContainer-module__root--HSgCX",volumeSlider:"AudioPlayerUserControlsContainer-module__volumeSlider--O43ve",episode:"AudioPlayerUserControlsContainer-module__episode--PD2gl",compact:"AudioPlayerUserControlsContainer-module__compact--eOgvb",userButtonsContainer:"AudioPlayerUserControlsContainer-module__userButtonsContainer--mrGk6",userButton:"AudioPlayerUserControlsContainer-module__userButton--oEgSt"}},682400:(e,t,i)=>{i.d(t,{default:()=>o});const o={credits:"AudioLyricsCredits-module__credits--S9k5F"}},930450:(e,t,i)=>{i.d(t,{default:()=>o});const o={content:"AudioLyricsLayout-module__content--qf_Yy",scroll:"AudioLyricsLayout-module__scroll--wJDq5"}},687886:(e,t,i)=>{i.d(t,{default:()=>o});const o={line:"AudioLyricsLine-module__line--s3hes",clickable:"AudioLyricsLine-module__clickable--OJBiN",inactive:"AudioLyricsLine-module__inactive--MjGoK",text:"AudioLyricsLine-module__text--ARcYc",interlude:"AudioLyricsLine-module__interlude--eHu4q"}},205044:(e,t,i)=>{i.d(t,{default:()=>o});const o={countdown:"AudioLyricsLottieCountdown-module__countdown--xnMll",animation:"AudioLyricsLottieCountdown-module__animation--Hv4JE"}},991120:(e,t,i)=>{i.d(t,{default:()=>o});const o={countdown:"KaraokeAudioLyrics-module__countdown--rxPAe",hidden:"KaraokeAudioLyrics-module__hidden--Vfva1"}},953699:(e,t,i)=>{i.d(t,{default:()=>o});const o={layout:"AudioLyricsModal-module__layout--zf3gZ",header:"AudioLyricsModal-module__header--t6ZIw",player:"AudioLyricsModal-module__player--mvaOq",content:"AudioLyricsModal-module__content--QIPUe",headerWrapper:"AudioLyricsModal-module__headerWrapper--jzEy1",playerWrapper:"AudioLyricsModal-module__playerWrapper--iHo9M"}},262588:(e,t,i)=>{i.d(t,{default:()=>o});const o={cover:"AudioCover-module__cover--Aj8O5",placeholder:"AudioCover-module__placeholder--Sdf3D",blur:"AudioCover-module__blur--s1UC5",image:"AudioCover-module__image--I14zD"}},647229:(e,t,i)=>{i.d(t,{default:()=>o});const o={header:"AudioLyricsModalHeader-module__header--qIw0j",cover:"AudioLyricsModalHeader-module__cover--sV8Ra",info:"AudioLyricsModalHeader-module__info--CuvjM",titleContainer:"AudioLyricsModalHeader-module__titleContainer--e87SK",title:"AudioLyricsModalHeader-module__title--IWyD_",explicit:"AudioLyricsModalHeader-module__explicit--sGAOq",performer:"AudioLyricsModalHeader-module__performer--ZSPqT"}},556683:(e,t,i)=>{i.d(t,{default:()=>o});const o={player:"AudioLyricsPlayer-module__player--AG_Bu",progress:"AudioLyricsPlayer-module__progress--r9eYA",slider:"AudioLyricsPlayer-module__slider--yAux4",time:"AudioLyricsPlayer-module__time--E3uaA",controls:"AudioLyricsPlayer-module__controls--lQ6yc"}},482485:(e,t,i)=>{i.d(t,{default:()=>o});const o={button:"PlayButton-module__button--M8npB"}},756483:(e,t,i)=>{i.d(t,{default:()=>o});const o={button:"TertiaryIconButton-module__button--QFuju"}},523019:(e,t,i)=>{i.d(t,{default:()=>o});const o={slider:"AudioSlider-module__slider--WVvAT",ads:"AudioSlider-module__ads--AeRSv"}},539067:(e,t,i)=>{i.d(t,{default:()=>o});const o={view:"CustomScrollView-module__view--lbeDQ",box:"CustomScrollView-module__box--YPfVM",barY:"CustomScrollView-module__barY--vvyOo",trackerY:"CustomScrollView-module__trackerY--u8vOb",hidden:"CustomScrollView-module__hidden--pAOOr"}},508541:(e,t,i)=>{i.d(t,{drawAlbumPartRow:()=>s});var o=i(610989);function s(e){return`<div class="audio_album_part_row">${o.getLang("audio_album_part").replace("{part}",e)}</div>`}},818094:(e,t,i)=>{i.d(t,{getAlbumParts:()=>s});var o=i(59052);function s(e){if(e&&e.getAudiosCount()&&e.isFullyLoadable()&&!e.hasMore()){const t=e.getAudiosList(),i=e.getAudiosCount(),s=[];let a=0;for(let e=0;e<i;e++){const i=t[e][o.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART];i>a&&(a=i,s.push({number:i,offset:e}))}if(s.length>1)return s}return!1}},448909:(e,t,i)=>{i.d(t,{showAudioAlbum:()=>l});var o=i(280357),s=i(671300),a=i(143148);function l(e,t){return cur.viewAsBox?cur.viewAsBox():(t=s.AudioUtils.audioTupleToAudioObject(t),layers.fullhide&&layers.fullhide(),(0,a.onAdditionalEvent)(e,t,{type:o.TYPE_SHOW_ALBUM}),s.AudioUtils.showAudioPlaylist(t.album[0],t.album[1],t.album[2]))}},852435:(e,t,i)=>{i.d(t,{followArtist:()=>n});var o=i(248298),s=i(671300),a=i(610989),l=i(258643),r=i(850101);function n(e,t,i,n){(0,o.lockButton)(n),ajax.post("al_artist.php",{act:"follow",artist_id:e,ref:t,hash:i},{onFail:()=>(0,o.unlockButton)(n),onDone:i=>{(0,o.unlockButton)(n),l.FlatButton.setLabel(n,a.getLang("audio_following_artist_button")),n.classList.add("MusicAuthor__follow_btn__followed"),(0,r.showDoneBoxFull)("",{},{text:a.getLang("audio_follow_artist_success_notification_text"),title:a.getLang("audio_follow_artist_success_notification_title")}),n.onclick=o=>{o.preventDefault(),s.AudioUtils.unfollowArtist(e,t,i,n)}}})}},701785:(e,t,i)=>{function o(e,t){ajax.post("al_artist.php",{act:"track_to_official",hash:e,url:t},{onFail:()=>!0})}i.d(t,{trackArtistToOfficial:()=>o})},728664:(e,t,i)=>{i.d(t,{unfollowArtist:()=>n});var o=i(248298),s=i(671300),a=i(610989),l=i(452314),r=i(258643);function n(e,t,i,n){(0,o.lockButton)(n),ajax.post("al_artist.php",{act:"unfollow",artist_id:e,ref:t,hash:i},{onFail:()=>(0,o.unlockButton)(n),onDone:i=>{if(n){(0,o.unlockButton)(n);(0,l.hasClass)(n,"MusicAuthor__follow_btn__can_follow")?(r.FlatButton.setLabel(n,a.getLang("audio_follow_artist_button")),n.classList.remove("MusicAuthor__follow_btn__followed"),n.onclick=o=>{o.preventDefault(),s.AudioUtils.followArtist(e,t,i,n)}):(0,l.re)(n)}}})}},807558:(e,t,i)=>{i.d(t,{getRowActionName:()=>u});var o=i(610989),s=i(671300),a=i(476726),l=i(579032),r=i(119265),n=i(847891),d=i(156693);function u(e,t,i){const u=(0,a.partConfigEnabled)("add_audio_to_effector_web"),_=r.AudioPageProxy.ensure(),c=(0,l.ensureAudioPageService)(),h=c.$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState()[t.fullId]?.state?.text,p=t.fullId in c.$deletedFromMyMusicAudiosIdentitiesMap.getState(),y=n.Ranges.isGroupId(_.ownerId)&&_.ownerId===t.ownerId&&(0,d.getGroupAudioFullId)(t,_.ownerId)in c.$deletedFromGroupAudiosIdentitiesMap.getState(),A=t.fullId in c.$myMusicIdentitiesMap.getState();let g,P=s.AudioUtils.getAddRestoreInfo();switch(e){case"current_delete":g=o.getLang("audio_delete_from_current");break;case"recoms_delete":g=o.getLang("audio_dont_show");break;case"listened_delete":g=o.getLang("audio_remove_from_list");break;case"delete":if(s.AudioUtils.isPodcast(t))g=o.getLang("audio_podcast_delete_episode");else if(window.AudioPage&&window.AudioPage.isInRecentPlayed(i))g=o.getLang("audio_remove_from_list");else if(u)g=h||o.getLang("global_delete_audio");else{let e=P[t.fullId];g=e&&e.deleteAll?e.deleteAll.text:o.getLang("global_delete_audio")}break;case"restore_recoms":g=o.getLang("audio_restore_audio");break;case"more":g=o.getLang("global_media_selector_more");break;case"add":let e=P[t.fullId];if(e&&P[e.addedFullId]&&(e=null),s.AudioUtils.isPodcast(t))g=o.getLang("audio_podcast_restore_episode");else if(u?p||y:e&&"deleted"===e.state)g=o.getLang("audio_restore_audio");else if(u?A:e&&"added"===e.state)g=o.getLang("global_delete_audio");else{let e=!1;window.AudioPage&&(e=currentAudioPage(i)),!e&&window.cur.audioPage&&(e=window.cur.audioPage),g=e&&e.getOwnerId()<0&&e.canAddToGroup()&&e.getOwnerId()!==t.ownerId?o.getLang("audio_add_to_group"):o.getLang("audio_add_to_audio")}break;case"edit":g=s.AudioUtils.isPodcast(t)?o.getLang("audio_podcast_edit_episode"):o.getLang("audio_edit_audio");break;case"next":g=o.getLang("audio_set_next_audio");break;case"recoms":g=o.getLang("audio_show_recommendations");break;case"fave":g=s.AudioUtils.isPodcast(t)?o.getLang("audio_podcast_listen_later"):"";break;case"lyrics":g=o.getLang("audio_show_lyrics");break;case"snippet":g=o.getLang("audio_longtap_tooltip_text");break;default:g=""}return g}},656296:(e,t,i)=>{i.d(t,{hasAudioHQBodyClass:()=>s});var o=i(59052);function s(){return document.body.classList.contains(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS)}},938450:(e,t,i)=>{i.d(t,{renderAudioDiag:()=>l});var o=i(452314),s=i(879007),a=i(59052);function l(){let e=(0,o.ge)("audio_diag_log"),t=ls.get(a.AUDIO_PLAYER_ENUMS.LOG_LS_KEY)||[];e&&(0,s.each)(t,(function(t,i){let s=new Date(i.shift()).toUTCString();i=i.join(", "),e.appendChild((0,o.se)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+s+"</span>"+i+"</div>"))}))}},159076:(e,t,i)=>{i.d(t,{toggleAudioHQBodyClass:()=>s});var o=i(59052);function s(){let e=AudioPlayer.showHQLabel();document.body.classList.toggle(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS,e)}},486686:(e,t,i)=>{i.d(t,{updateQueueReceivedPost:()=>a});var o=i(452314),s=i(879007);function a(e){e&&(0,s.each)((0,o.geByClass)("_audio_row",e),(function(){(0,o.domData)(this,"new-post","groups"==cur.module?"wall":"feed")}))}},620626:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AudioPlaylist:()=>AudioPlaylist});var _swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(434518),_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(763812),_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7144),_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(514640),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(850101),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(879007),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(327527),_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(671300),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(49038),_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(211981),_web_audio_FetchService__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(527966),_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(539217),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(8520),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(441914),_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(59052),_lastPlayedAudioIdentity=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__._)("_lastPlayedAudioIdentity"),_audioListSource=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__._)("_audioListSource");class AudioPlaylist{static splitId(e){let[t,i,...o]=e.split("_");return o=o.join("_"),[t,i,o]}static getFullIdFromData(e){const t=e||{},{ownerId:i,id:o,albumId:s,accessHash:a}=t;return`${i||vk.id}_${o||s||0}${a?"_"+a:""}`}get lastPlayedAudio(){const e=this.getSelf();return(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]&&e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e._list)&&"playlist"===e.getType()?e._list.find((e=>e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]===(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity].ownerId&&e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]===(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity].id)):null}updatePlaylist(e){const t=this.getSelf();let i=!1;return t&&e?(t._title!==e.title&&(t._title=e.title,i=!0),t._titleLang!==e.titleLang&&(t._titleLang=e.titleLang,i=!0),i):i}_ensureIndex(e){const t=this.getSelf();if(t._index)return void(e&&e());const i=t.getAudiosList();if(!i)return;const o=(e,t)=>{const i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(t);return i>=33&&i<48?String.fromCharCode(i):e};t._index=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_6__.vkIndexer(i,(e=>(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]+" "+e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,o)),e)}cleanIndex(){this.getSelf()._index=null}search(e,t){let i=this.getSelf();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)||(e={q:e}),this._ensureIndex((()=>{let o=i._index?i._index.search(e.q):[];return o=o.filter((function(t){return!e.lyrics||""!==t[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_LYRICS]})),t(o)}))}setNextOffset(e){this._nextOffset=e}getNextOffset(){let e=this.getSelf();return e._forceReload?0:""===e._nextOffset?e._nextOffset:e._nextOffset||this.getAudiosCount()}getIsFakeId(){return this.getSelf()._isFakeId}setIsFakeId(e){this.getSelf()._isFakeId=e}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getExpire(){return this.getSelf()._expire}getOwnerId(){return+this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getNoConsecutivePlay(){return this.getSelf()._noConsecutivePlay}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getContext(){return this.getSelf()._context}setContext(e){this.getSelf()._context=e}getTrackCodeRef(){return this.getBlockId()||this.getContext()}getRef(){return this.getSelf()._ref}getRawId(){return this.getSelf()._implPlay_rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getTitleLang(){return null==this.getSelf()._titleLang?null:this.getSelf()._titleLang}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}setFromId(e){this.getSelf()._fromId=e}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getFriendId(){return this.getSelf()._friend}getNoDiscover(){return this.getSelf()._noDiscover}getAudiosList(){return this.getSelf()._list}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){let e=this.getSelf()._live;return!!e&&(e=e.split(","),{hostId:e[0],audioId:e[1],hash:e[2]})}getAudiosCount(){let e=this.getSelf();return Array.isArray(e._list)?e._list.length:0}getTotalDuration(){let e=this.getAudiosList(),t=0;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(e,(function(e,i){t+=i[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_DURATION]})),t}getAudio(e){if(!e)return null;let t=this.getSelf();"string"==typeof e&&(e=e.split("_"));for(let i=0,o=t._list.length;i<o;i++)if(e[0]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID])return t._list[i];return null}getAudioAt(e){let t=this.getSelf();return e<t._list.length?t._list[e]:null}setLocalFoundCount(e){this.getSelf()._localFoundTotal=e}setAdsAllowed(e){return this.getSelf()._isAdsAllowed=e}setFollowed(e){let t=this.getAddClasses()||"";return t=t.replace("audio_playlist__followed",""),e&&(t+=" audio_playlist__followed"),this.getSelf()._addClasses=t,this.getSelf()._isFollowed=e}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}getForceReload(){return this.getSelf()._forceReload}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}isLoadable(){return this.getSelf()._isLoadable}getFeedOffset(){return this._feedOffset}getFeedFrom(){return this._feedFrom}_unref(){let e=this._ref;if(!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e))return;let t={};for(let i in e)if(e.hasOwnProperty(i)&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e[i])&&0===i.indexOf("_")){let o=e[i];t[i.substr(1)]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(o)?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(o):o}t.hasMore=!1,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._albumId=t.albumId,this._list=[],this._fetchService=t.fetchService,this.mergeWith(t)}equals(e){return this.getSelf()===e.getSelf()}serialize(){return JSON.stringify(this.asObject())}indexOfAudio(e){if(!e)return-1;let t=[];(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isString)(e)?t=e.split("_"):(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?t=[e.ownerId,e.id]:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(t=[e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID]]);const i=this.getAudiosList();if(!i)return-1;for(let e=0,o=i.length;e<o;e++)if(i[e]&&t[0]==i[e][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==i[e][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID])return e;return-1}asObject(){let e={};return e.type=this.getType()||AudioPlaylist.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=this.getNextOffset(),e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=window.getAudioPlayer()._getPlayingContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=this.getExpire?this.getExpire():null,e.blockId=this.getBlockId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(e.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),this.getType()===AudioPlaylist.TYPE_RADIO&&(e.list=this.getAudiosList()),e}asPlaylistData(){return{type:this.getType(),ownerId:this.getOwnerId(),id:this.getId(),title:this.getTitle(),hasMore:this.hasMore(),list:this.getAudiosList(),nextOffset:this.getNextOffset(),subtitle:this.getSubtitle(),totalCount:this.getTotalCount(),blockId:this.getBlockId()}}toString(){return this.getId()}clean(e){e||this._unref();let t=this.getSelf();t._hasMore=!0,t._list=[],t._feedOffset=t._feedFrom=0,t._nextOffset=0}initSortedList(e){return this.getSelf()._list=e||[]}setForceReload(e){let t=this.getSelf();return e&&(t._hasMore=!0),t._forceReload=e}getBlockId(){return this.getSelf()._blockId}async getAudioIds(e){const t={playlist_id:this.getFullId(),block_id:this.getBlockId(),trackType:e,context:this.getContext(),ref:this.getTrackCodeRef()},{audioIds:i,lastPlayedAudioRawId:o=null}=await this.getSelf()._fetchService.getAudioIdsBySource(t,{audioListId:this.getFullId(),audioListSource:(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_audioListSource)[_audioListSource],ref:this.getTrackCodeRef()});return o&&((0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_13__.mapAPIRawIdToAudioIdentity)(o)),i}loadAll(e,t=""){if(!this.isFullyLoadable())return e&&e(this);this.load(0,e,!0,"default",t)}loadByBlockId(e,t,i,o="default"){const s=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__.getAudioPlayer)(),a=(e,t=null)=>{const i=this._onDoneLoading;delete this._onDoneLoading,delete this._loadingAll,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(i||[],((e,i)=>{i&&i(this,t)}))},l=this.getNextOffset();if(this.getAudiosCount()&&(!e||e!==l))return t&&t(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(t),this._loadingAll)return;if(i)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__.loadAllPlaylistAudios)(this,a);const r=s.getPlaylistByBlockId(this._blockId);r&&s.notify(_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_1__.events.PLAYLIST_START_LOADING,r.getPlaylistId(),r.getBlockId()),ajax.post("al_audio.php?act=load_block_playlist",{block_id:this._blockId,start_from:l},{onDone:e=>{this._blockId=e.blockId,s.mergePlaylistData(this,e),a(),s.saveStateCurrentPlaylist(),""===this.getNextOffset()&&(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}})}load(offset,onDone,needAll,trackType="default",viewType=null){const audioPlayer=window.getAudioPlayer();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(offset)?(onDone=offset,offset=0):offset=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(offset),this.getSelf().isExpired()&&(this.getSelf()._hasMore=!0,this.getSelf().setForceReload(!0));const searchParams=this.getSearchParams();let wasPreload=!1,countAvailable=this.getType()===this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(e,t,i)=>{let o=this._onDoneLoading;i||(delete this._onDoneLoading,delete this._loadingAll);(!wasPreload||wasPreload&&cur.audioChooseBox&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_2__.curBox)())&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(o||[],((i,o)=>{o&&o(e,t)})),i&&(wasPreload=!0)},params;if(this.getSelf().getForceReload()&&(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery))return onDone&&onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(onDone),this._loadingAll)return onDone&&onDone(this);if(needAll)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__.loadAllPlaylistAudios)(this,callOnDones,viewType);offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout),this.getSelf().getForceReload()&&this.getSelf().setForceReload(!1);let isCatalog=!1;if(this._blockId)params={act:"load_block_playlist",block_id:this._blockId,start_from:this.getNextOffset()},isCatalog=!0;else{const e=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();params={act:"load_section",type:this.getType(),owner_id:e,playlist_id:this.getPlaylistId(),offset,context:this.getContext(),access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(nav.objLoc.claim),track_type:trackType,ref:this.getTrackCodeRef()}}return ajax.post("al_audio.php",params,{onDone:(loadedPlaylist,tpl,langs,templatesScript,data)=>{if(!loadedPlaylist)return this.getSelf().setNextOffset(""),void(isCatalog?onDone&&onDone(loadedPlaylist):callOnDones(loadedPlaylist));window.addTemplates({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),this._loadingAll&&!needAll||(audioPlayer.mergePlaylistData(this,loadedPlaylist),isCatalog?onDone&&onDone(loadedPlaylist.list):callOnDones(loadedPlaylist),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1))},onFail:()=>!0,cache:this.getType()===AudioPlaylist.TYPE_SEARCH?1:0})}isExpired(){const e=this.getExpire();return!!e&&new Date(1e3*e).getTime()<(new Date).getTime()}mergeInfo(e){this._albumId=e.id||this._albumId;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","noConsecutivePlay","originalList","ownerId","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","subTitle","title","titleLang","noDiscover","totalCount","totalCountHash","type","wallQuery","wallType","expire"],((t,i)=>{void 0!==e[i]&&(this["_"+i]=e[i])}))}mergeWith(e){let t=e.list;this.isExpired()&&(this.getSelf()._list=[]),t&&t.length&&(this.getType()===AudioPlaylist.TYPE_RADIO?this.pushAudio(t,0):this.pushAudio(t)),this.mergeInfo(e)}pushAudio(e,t){this._unref();const i=void 0===t,o=e=>{const o=this.getAudiosList(),s=[];for(let a=0;a<e.length;a++){const l=e[a],r=this.indexOfAudio(l);r<0?s.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(l)):i||(s.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(l)),o.splice(r,1),r<t&&t--)}for(const e of s)e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,""));i?o.push(...s):o.splice(t,0,...s),this._index&&s.forEach((e=>this._index.add(e)))};(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e[0])?o(e):e&&e.length&&o([e])}moveAudio(e,t){this._unref();let i=this._list.splice(e,1);e<t&&(t-=1),this._list.splice(t,0,i[0])}removeAudio(e){let t=this.indexOfAudio(e);if(t>=0){this._unref();let e=this._list.splice(t,1);this._index?.remove(e[0]);return window.getAudioPlayer().saveStateCurrentPlaylist(),t}return-1}sendSearchStats(e){if("search_play"===e){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:e,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextAudio(...e){return this.getSelf()._fetchNextAudio(...e)}fetchNextLiveAudio(e){let t=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:t.hostId,hash:t.hash},{onDone:t=>e&&e(t),onFail:()=>!0})}constructor(e,t,i){Object.defineProperty(this,_audioListSource,{get:get_audioListSource,set:void 0}),Object.defineProperty(this,_lastPlayedAudioIdentity,{writable:!0,value:void 0}),(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]=null;let o={};if(e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e.getId))return e.isReference()?(window.getAudioPlayer().addPlaylist(this),e):(this._ref=e,void window.getAudioPlayer().addPlaylist(this));(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?o=e:(o.ownerId=t,o.type=e,o.albumId=i||++AudioPlaylist.plIndex),this._type=o.type,this._ownerId=o.ownerId||vk.id,this._albumId=o.albumId||0,this._fromId=o.fromId||0,this._list=[],this._context=o.context||"",this._blockId=o.blockId,this._isFakeId=!1,this._expire=o.expire||null,this._noDiscover=o.hasOwnProperty("noDiscover")?o.noDiscover:null,this._nextOffset=o.nextOffset,this._forceReload=!1,this._fetchService=new _web_audio_FetchService__WEBPACK_IMPORTED_MODULE_7__.FetchService,this._noConsecutivePlay=!1,this._isLoadable=o.loadable||!1,this._fetchNextAudio=o.fetchNextAudio||null,this.mergeWith(o),window.getAudioPlayer().addPlaylist(this)}}function get_audioListSource(){return"playlist"===this.getType()&&(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__.isNumber)(this.getOwnerId())&&(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__.isNumber)(this.getAlbumId())?"playlist":null}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_MY="my",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.TYPE_RADIO="radio",AudioPlaylist.TYPE_ARTICLE_TTS="article_tts",AudioPlaylist.TYPE_VKMIX=_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_8__.PLAYLIST_TYPE_VKMIX,AudioPlaylist.DEFAULT_PLAYLIST_ID=-1,AudioPlaylist.RADIO_PLAYLIST_ID=-110},691474:(e,t,i)=>{i.d(t,{TopAudioPlayer:()=>p});var o=i(671300),s=i(714209),a=i(327527),l=i(610989),r=i(317412),n=i(879007),d=i(452314),u=i(514640),_=i(988668),c=i(638338);const h="top_audio_player_enabled";class p{static init(){let e=(0,d.ge)("top_audio_player"),t=(0,d.data)(e,"object");t||(t=new p(e),(0,d.data)(e,"object",t))}init(){let e=this;function t(t){return(0,d.hasClass)(this,"top_audio_player_play")?(e.ap.podcastSetActionRef(e.ap.getCurrentAudio(),e.ap.isPlaying()?o.AudioUtils.PodcastsLogs.ACTION_PAUSE:o.AudioUtils.PodcastsLogs.ACTION_PLAY,"top_player"),e.ap.isPlaying()?e.ap.pauseByButton():e.ap.playByButton(),!1):(0,d.hasClass)(this,"top_audio_player_prev")?(e.ap.playPrevByButton(),!1):(0,d.hasClass)(this,"top_audio_player_next")?(e.ap.playNextByButton(),!1):void 0}this.ap.on(this,u.events.UPDATE,this.onUpdate.bind(this)),this.ap.on(this,u.events.PLAY,this.onPlay.bind(this)),this.ap.on(this,u.events.PLAY_REQUESTED,this.onPlay.bind(this)),this.ap.on(this,[u.events.PAUSE,u.events.STOP],this.onPause.bind(this)),this.ap.top=this,(0,n.each)(["prev","play","next"],(function(i,o){(0,r.addEvent)((0,d.geByClass1)("top_audio_player_"+o,e._el),"click",t)})),(0,r.addEvent)(this._el,"mousedown",(function(t){if(!(0,d.gpeByClass)("top_audio_player_btn",t.target,e._el))return 1!=t.which||(0,d.hasClass)(t.target,"top_audio_player_btn")||(0,d.hasClass)(t.target,"top_audio_player_act_icon")||o.AudioUtils.getLayer().toggle(),(0,r.cancelEvent)(t)})),(0,r.addEvent)((0,d.ge)("top_audio"),"mousedown",(function(e){return!0!==(0,r.checkEvent)(e)&&(o.AudioUtils.getLayer().toggle(),(0,r.cancelEvent)(e))})),s.browser.safari||(0,r.addEvent)(document,"keydown keyup",(function(e){(0,d.toggleClass)((0,d.ge)("top_audio_play"),"shuffle",e.shiftKey)})),this._resetAudio(),this._updateTitle(this.ap.getCurrentAudio())}onPause(){this._el&&((0,d.removeClass)(this._el,"top_audio_player_playing"),this._el.querySelector(".top_audio_player_play svg").outerHTML=(0,_.getIcon24Play)().icon);const e=(0,d.geByClass1)("_top_audio_player_play_blind_label");e&&(e.innerHTML=l.getLang("global_audio_play"))}onPlay(e,t,i){this._hideButton(),requestAnimationFrame((function(){const e=o.AudioUtils.getLayer();e&&e.isShown()&&e.updatePosition()})),(0,d.addClass)(this._el,h),(0,d.toggleClass)(this._el,"top_audio_player_playing",!0),this._el.querySelector(".top_audio_player_play svg").outerHTML=(0,c.getIcon24Pause)().icon;const s=(0,d.geByClass1)("_top_audio_player_play_blind_label");s&&(s.innerHTML=this.ap.isPlaying()?l.getLang("global_audio_pause"):l.getLang("global_audio_play")),this._updateTitle(e,i)}onUpdate(e){e?(this._updateTitle(e),this._hideButton(),(0,d.addClass)(this._el,h)):this._resetAudio()}_updateTitle(e,t){if(t=(0,n.intval)(t),e=o.AudioUtils.audioTupleToAudioObject(e),(0,d.toggleClass)(this._el,"audio_player_podcast",o.AudioUtils.isPodcast(e)),(0,d.toggleClass)(this._el,"audio_player_article_tts",o.AudioUtils.isArticleTts(e)),(0,d.toggleClass)(this._el,"audio_player_external_stream_audio",o.AudioUtils.isExternalStream(e)),(0,d.toggleClass)(this._el,"audio_player_radio_marusia",o.AudioUtils.isRadio(e)&&o.AudioUtils.isMarusiaTrack(e)),!e)return;void 0!==this._currTitleReTO&&clearTimeout(this._currTitleReTO);const i=(0,d.geByClass1)("top_audio_player_title_out",this._el);(0,d.re)(i);const s=(0,d.geByClass1)("top_audio_player_title",this._el);if(0!==t){let i=t<0?-10:10,o=`opacity: 0; top: ${i}px; left: ${s.offsetLeft}px`,a=this.getTitleText(e),l=(0,d.se)('<div class="top_audio_player_title top_audio_player_title_next" style="'+o+'">'+a+"</div>");l.setAttribute("onmouseover","setTitle(this)"),t>0?(0,d.domInsertAfter)(l,s):(0,d.domInsertBefore)(l,s),(0,d.addClass)(s,"top_audio_player_title_out"),(0,d.setStyle)(s,{top:-i,opacity:0}),setTimeout((function(){(0,d.setStyle)(l,{top:0,opacity:1})}),10),clearTimeout(this._currTitleReTO),this._currTitleReTO=setTimeout((function(){(0,d.re)(s),(0,d.removeClass)(l,"top_audio_player_title_next")}),p.TITLE_CHANGE_ANIM_SPEED)}else s&&(s.innerHTML=this.getTitleText(e),s.titleSet=0,s.setAttribute("onmouseover","setTitle(this)"))}getTitleText(e){return[e.performer,e.title].filter((e=>!!e)).join(" &mdash; ")}_resetAudio(){(0,d.removeClass)(this._playIconBtn,h),(0,d.removeClass)(this._el,h),(0,d.removeClass)(this._el,"top_audio_player_playing"),(0,d.removeClass)(this._el,"audio_player_podcast"),(0,d.removeClass)(this._el,"audio_player_article_tts"),(0,d.removeClass)(this._el,"audio_player_external_stream_audio"),(0,d.removeClass)(this._el,"audio_player_radio_marusia"),(0,d.show)(this._audioBtnGroup);let e=o.AudioUtils.getLayer();e&&e.isShown()&&e.updatePosition()}_hideButton(){(0,d.hide)(this._audioBtnGroup),(0,d.hasClass)(this._playIconBtn,h)||(0,d.addClass)(this._playIconBtn,h)}constructor(e){this.ap=(0,a.getAudioPlayer)(),this._el=e,this._playIconBtn=(0,d.ge)("top_audio"),this._audioBtnGroup=(0,d.ge)("top_audio_btn_group"),this.init()}}p.TITLE_CHANGE_ANIM_SPEED=190},148818:(e,t,i)=>{i.d(t,{WebPlayerAdapter:()=>d});var o=i(888610),s=i(879007),a=i(671300),l=i(452314),r=i(735477),n=i(449502);class d extends o.AudioStatsPlayerAdapter{getPausedBy(e){const{pausedByVideo:t,pausedByStories:i,pausedByAudio:o,pausedByQueue:s}=this.player;return t&&e<t||window.Videoview&&Videoview.isLayerShown()?"video":i&&e<i||window.cur&&cur.storyLayer?"stories":o&&e<o?"audio":s&&e<s?"queue":null}getState(){let e=super.getState();const t=this.getAudioId();if(t){const e=(0,l.geByClass)("_audio_row_"+t+" audio_row__current",(0,l.ge)("page_layout"));if(e&&e.length)return o.FULL_SCREEN_STATE}return e}getAudio(){return(0,r.audioTupleToAudioObject)(this.player.getCurrentAudio())}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){const e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[a.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*(0,n.unLogF)(this.player.getVolume()))}getAudioId(){const e=this.player.getCurrentAudio();if(e)return e[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[a.AudioUtils.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){const e=this.player.getCurrentAudio();if(e)return e[a.AudioUtils.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){const e=this.player._prevAudio;if(e)return e[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[a.AudioUtils.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){const e=this.player._prevPlaylist;return e&&!e.getIsFakeId()?e.getFullId():null}getPlaylistId(){const e=this.player.getCurrentPlaylist();return e&&!e.getIsFakeId()?e.getFullId():null}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getSearchParams(){const e=this.player.getCurrentPlaylist();if(e)return e.getSearchParams()}isShuffledPlaylist(){const e=this.player.getPlaylistQueue();if(e)return e.shuffled}isRealPlaylist(){const e=this.player.getCurrentPlaylist();return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){const e=this.player._prevPlaylist;return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){const e=this.player.getCurrentAudio();return a.AudioUtils.isPodcast(e)}isExternalStream(){const e=this.player.getCurrentAudio();return a.AudioUtils.isExternalStream(e)}isRadio(){const e=this.player.getCurrentAudio();return a.AudioUtils.isRadio(e)}isMarusiaTrack(){const e=this.player.getCurrentAudio();return a.AudioUtils.isMarusiaTrack(e)}isLastTrack(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();if(!e)return!1;if(e&&!t)return!0;return t.indexOfAudio(e)+1===t.getAudiosCount()}getTrackPosition(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return e?e&&!t?0:t.indexOfAudio(e):null}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(e){let t=e&&e.hash;const i=(0,s.extend)({act:"listened_data",impl:this.getType(),hash:t,v:5,loc:nav.strLoc},e);ajax.post("al_audio.php",i,{onDone:e=>{this.player.setAdsConfig&&this.player.setAdsConfig(e)},onFail:()=>!0})}getPlaylistQueue(){this.player.getPlaylistQueue()}}},637653:(e,t,i)=>{i.d(t,{followCurator:()=>d});var o=i(248298),s=i(671300),a=i(610989),l=i(258643),r=i(327527),n=i(514640);function d(e,t,i){(0,o.lockButton)(i),ajax.post("al_curator.php",{act:"follow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(i),onDone:t=>{(0,r.getAudioPlayer)().notify(n.events.CURATOR_FOLLOW),(0,o.unlockButton)(i),l.FlatButton.setLabel(i,a.getLang("audio_following_artist_button")),i.classList.add("MusicAuthor__follow_btn__followed"),i.onclick=o=>{o.preventDefault(),s.AudioUtils.unfollowCurator(e,t,i)}}})}},659940:(e,t,i)=>{i.d(t,{unfollowCurator:()=>d});var o=i(248298),s=i(671300),a=i(610989),l=i(258643),r=i(327527),n=i(514640);function d(e,t,i){(0,o.lockButton)(i),ajax.post("al_curator.php",{act:"unfollow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(i),onDone:t=>{(0,r.getAudioPlayer)().notify(n.events.CURATOR_UNFOLLOW),(0,o.unlockButton)(i),l.FlatButton.setLabel(i,a.getLang("audio_follow_artist_button")),i.classList.remove("MusicAuthor__follow_btn__followed"),i.onclick=o=>{o.preventDefault(),s.AudioUtils.followCurator(e,t,i)}}})}},104479:(e,t,i)=>{i.d(t,{addToGroupBox:()=>r});var o=i(452314),s=i(610989),a=i(20025),l=i(850101);function r(e,t,i){const r=e+"_"+t,n=(0,a.showBox)("al_audio.php",{act:"add_to_groups_box",playlist_id:r,access_hash:i}).setButtons(s.getLang("Save"),(()=>{let e=[];for(let t in cur.wdd.follow_playlist_wwd.selected)e.push(cur.wdd.follow_playlist_wwd.selected[t][0]);e.length&&((0,o.ge)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:e,hash:(0,o.ge)("add_playlist_to_group_hash").value,playlist_id:r},{onDone(e){n.hide(),(0,l.showDoneBox)(e)},onFail:e=>((0,o.ge)("add_playlist_to_group_fail").innerHTML=e,!0)}))}))}},448818:(e,t,i)=>{i.d(t,{removeFromGroup:()=>n});var o=i(452314),s=i(610989),a=i(20025),l=i(850101),r=i(388078);function n(e,t,i,n=null){const d=e+"_"+t;let u=null;const _=cur.audioPage&&cur.audioPage._ownerId;if(r.Ranges.isGroupId(_))u=-_;else{const e=cur.group_id;r.Ranges.isGroupId(-e)&&(u=e)}if(u){let e=(0,a.showBox)("al_audio.php",{act:"delete_from_group_box",playlist_id:d,group_id:u}).setButtons(s.getLang("global_yes"),(()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:u,hash:i,playlist_id:d},{onDone(t){if(e.hide(),(0,l.showDoneBox)(t),n){const e=(0,o.gpeByClass)("audio_pl_snippet2",n);e&&e.classList.remove("audio_pl__can_remove_from_club")}},onFail:t=>(e.hide(),(0,l.showDoneBox)(t),!0)})}),s.getLang("global_cancel"),(()=>e.hide())).show()}}},779016:(e,t,i)=>{i.d(t,{addToPlaylistsBoxInit:()=>c});var o=i(452314),s=i(317412),a=i(879007),l=i(850101),r=i(248298),n=i(610989),d=i(248782),u=i(30295),_=i(94785);function c(e,t,i,h,p){if("undefined"==typeof AutoList)return window.stManager.add(window.jsc("web/auto_list.js"),(()=>{c(e,t,i,h,p)}));let y=(0,l.curBox)(),A=(0,o.geByClass1)("_audio_atp_content",y.bodyNode),g=(0,o.geByClass1)("_audio_atp_list",y.bodyNode),P=(0,o.ge)("audio_atp_search"),f=(0,o.geByClass1)("_audio_atp_empty"),m=(0,o.getSize)(A)[1];(0,o.setStyle)(g,{height:m-(0,o.getSize)(P)[1]});let E,w="";function v(){E&&E.destroy(),g.innerHTML="";let e=[];e=w?h.filter((e=>e[2].toLowerCase().indexOf(w)>=0)):h,(0,o.toggle)(g,0!=e.length),(0,o.toggle)(f,0==e.length),E=new AutoList(g,{onNeedRows:(t,i)=>{let o=[],s=i,a=Math.min(e.length,i+30);for(let t=s;t<a;t++){let i=e[t];if(i){let e=i[4]?"ape_selected":"";let t=`<div class="ape_check">\n              <div class="ape_check--unchecked">${(0,u.getIcon24CheckCircleOff)().icon}</div>\n              <div class="ape_check--checked">${(0,_.getIcon24CheckCircleOn)().icon}</div>\n            </div>`,s=`<div class="ape_pl_item _ape_pl_item ${e}" data-id="${i[1]}">${t}<div class="ape_pl_item_inner"><span class="ape_pl_title">${i[2]}</span> <span class="ape_pl_size">${i[3]}</span></div></div>`;o.push(s)}}t(o)}})}v(),cur.addToPlaylistSearch=(0,d.debounce)((function(e){w=(0,a.trim)(e).toLowerCase(),v()}),200);let I={},C={};(0,s.addEvent)(g,"click",(e=>{let t=(0,o.domClosest)("_ape_pl_item",e.target),i=(0,o.domData)(t,"id");(0,o.toggleClass)(t,"ape_selected")?(C[i]=!0,delete I[i]):(I[i]=!0,delete C[i])})),y.removeButtons(),y.addButton(n.getLang("global_save"),(o=>{let s=Object.keys(C),a=Object.keys(I);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:s.join(","),remove_pl_ids:a.join(","),owner_id:e,audio_owner_id:t,audio_id:i,hash:p},{showProgress:()=>(0,r.lockButton)(o),hideProgress:()=>(0,r.unlockButton)(o),onDone:()=>{y.hide()},onFail:()=>(y.hide(),!0)})}),"ok",!0),y.addButton(n.getLang("global_cancel"),y.hide.bind(this),"no",!0)}},68998:(e,t,i)=>{i.d(t,{claimPlaylist:()=>s});var o=i(850101);function s(e,t,i){const s=nav.objLoc.claim;if(!s)return;const a={act:i?"a_unclaim_playlist":"a_claim_playlist",claim:s,type:"audio",owner_id:e,playlist_id:t};ajax.post("al_claims.php",a,{onDone:e=>{(0,o.showDoneBox)(e)}})}},629577:(e,t,i)=>{i.d(t,{copyPlaylistLink:()=>d});var o=i(448904),s=i(610989),a=i(490712),l=i(850101),r=i(703544),n=i(302495);function d(e,t,i){(0,a.statlogsValueEvent)("audio_copy_link",vk.id),(0,n.logSearchPlaylistClickOut)(n.SearchClickActionMap.COPY_LINK_OUT),(0,o.copyToClipboard)((0,r.getPlaylistUrl)(e,t,i,!0)),(0,l.showDoneBox)(s.getLang("audio_playlist_link_copied"))}},989904:(e,t,i)=>{function o(e,t,i,o){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/auto_list.js")],(function(){ajax.post("al_audio.php?act=playlists_edit_data",{owner_id:e,playlist_id:t},{onDone:function(s){s.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[e]=s.audio_playlist_cover_upload_options),s.editorial_playlists_params&&(cur.editorialPlaylistsParams=s.editorial_playlists_params),AudioPage.editPlaylist(e,t,i,o)},onFail:()=>!0})}))}i.d(t,{editPlaylist:()=>o})},538157:(e,t,i)=>{i.d(t,{followPlaylist:()=>h});var o=i(452314),s=i(327527),a=i(610989),l=i(7144),r=i(850101),n=i(879007),d=i(20025),u=i(514640),_=i(302495);let c=[];function h(e,t,i,h,p=!1,y=""){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;let A=(0,s.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,i);function g(s){const a=(0,o.domData)(e,"text-followed"),l=(0,o.domData)(e,"text-follow"),r=s?a:l;(0,o.domData)(e,"tooltip-text",r);((0,o.geByClass1)("audio_pl_snippet__action_btn_add_text",e)||e).innerHTML=r,A.setFollowed(s);let d=A.getAddClasses()||"";d=d.replace("audio_pl__followed",""),s&&(d+=" audio_pl__followed"),A.mergeWith({addClasses:d}),(0,n.each)((0,o.geByClass)(`_audio_pl_${t}_${i}`),((t,i)=>{(0,o.toggleClass)(i,"audio_pl__followed",s);const a=i.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];a&&(a.innerHTML=e.innerHTML)}))}function P(e){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(e){let e=null;c=c.filter((o=>{const s=o.playlistId===i&&o.playlistOwnerId===t;return s&&(e=o.pl),!s})),e&&cur.audioPage._data.playlists.unshift(e)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter((e=>{const o=e.id===i&&e.owner_id===t;return o&&c.push({playlistId:i,playlistOwnerId:t,pl:e}),!o}));cur.audioPage.updatePlaylistsCounter(vk.id)}}let f=(0,o.gpeByClass)("_audio_pl",e),m=(0,o.toggleClass)(f,"audio_pl__followed");(0,_.logSearchPlaylistClickOut)(m?_.SearchClickActionMap.ADD_TO_ME_OUT:_.SearchClickActionMap.REMOVE_FROM_ME_OUT),g(m),P(m),ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:t,playlist_id:i,hash:h,showcase:p,block_id:y},{onDone(e){(0,l.isObject)(e)&&m&&(0,s.getAudioPlayer)().notify(u.events.MUSIC_PLAYLISTS_ADD,e)},onFail:e=>(new d.MessageBox({title:a.getLang("global_error")}).content(e).setButtons(a.getLang("audio_ok"),(function(){(0,r.curBox)().hide()})).show(),g(!1),P(!1),!0)})}},198155:(e,t,i)=>{i.d(t,{getContextPlaylist:()=>r});var o=i(452314),s=i(671300),a=i(327527),l=i(879007);function r(e,t){let i=(0,a.getAudioPlayer)(),r=s.AudioUtils.getAudioFromEl(e,!0);if(!r)return{};function n(e){return[].slice.call(e)}let d=null,u=[],_=(0,o.domData)(e,"new-post"),c=!1,h=null,p=AudioPlaylist.TYPE_TEMP,y=vk.id,A=null,g={},P=window.AudioPage&&currentAudioPage(e);if((0,o.traverseParent)(e,(e=>c=(0,o.domData)(e,"audio-context"))),c=r.context||c,c=c||("audio"==cur.module?cur.submodule:cur.module),t||"autoplay"===c)return{context:c};let[f,m]=s.AudioUtils.contextSplit(c),E=(0,o.gpeByClass)("_audio_pl",e),w=!1;if(E){const e=(0,o.domData)(E,"playlist-id");h=i.getPlaylistByBlockId(e),h||(h=i.getPlaylist(...AudioPlaylist.splitId(e||"")));const t=(0,o.domData)(E,"no-consecutive-play");t&&h.mergeWith({noConsecutivePlay:t});let s=(0,o.domData)(E,"title")||"";s&&h.mergeWith({title:(0,l.clean)(s)});let a=(0,o.domData)(E,"access-hash")||"";a&&h.mergeWith({accessHash:a})}else if(P&&P.getPageCurrentPlaylist())h=P.getPageCurrentPlaylist();else if("module"==f){let e=m;h=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),u=[d]}else if(0===r.context.indexOf("admin"))h=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,r.ownerId,0,r.accessKey),h.getAudiosCount()||h.setForceReload(!0);else if(0===r.context.indexOf("im"))d=(0,o.gpeByClass)("_im_peer_history",e),d=d||(0,o.gpeByClass)("_fc_tab_log_msgs",e),A="im"+(cur.peer||"");else if(0===r.context.indexOf("board"))w=!0,A=r.context,u=n((0,o.geByClass)("_wall_audio_rows",d));else if(0===r.context.indexOf("widget"))w=!0,A=r.context;else if(0===r.context.indexOf("wiki"))w=!0,A="wiki";else if(0===r.context.indexOf("post")){p=AudioPlaylist.TYPE_WALL,A=r.context,w=!0;let e=r.context.replace("post","").split("_");y=e[0],g={postId:e[1]}}else if(0===r.context.indexOf("choose"))A=r.context;else if("feed"==_||0===r.context.indexOf("feed")||0===r.context.indexOf("feedsearch"))A="feed",w=!0,u=n((0,o.geByClass)("wall_text",d));else if("group_wall"==f||"user_wall"==f||0===r.context.indexOf("reply")||"wall"==_){p=AudioPlaylist.TYPE_WALL,y=cur.oid;let t=(m||"").split("_")[1],i=cur.wallQuery||"",s=(0,o.ge)("wall_search"),a=(0,l.inArray)(cur.wallType,["own","full_own"])?"own":"all";A=hashCode(a+"_"+i),w=!0,"wall"==cur.module&&(0,o.val)(s)&&(i=(0,o.val)(s)),t&&(g={postId:t,wallQuery:i,wallType:a}),0===r.context.indexOf("reply")&&(u=n([(0,o.gpeByClass)("_replies_list",e)]),A="reply"+A,w=!0);const _=(0,o.gpeByClass)("wide_column",e);if(_){const e=(0,o.geByClass)("wall_text",_);u=Array.isArray(e)&&e.length>0?u.concat(e):u.concat(n([d]))}else u=u.concat(n([d]))}else"article"==f&&(h=cur.articlePlaylist);return d||(d=(0,o.domPN)(e)),u=u.filter((function(e){return!!e})),u&&0!=u.length||(u=[d]),h=h||i.getPlaylist(p,y,A),"function"==typeof h.setIsFakeId&&h.setIsFakeId(w),h=h.getAudiosCount()?h:s.AudioUtils.initDomPlaylist(h,u),h.mergeWith(g||{}),-1==h.indexOfAudio(r)&&(h=s.AudioUtils.initDomPlaylist(h,[(0,o.domPN)(e)])),0===r.context.indexOf("im")&&h.setContext(`im:${cur.peer||""}`),{playlist:h,context:c}}},318921:(e,t,i)=>{function o(){return window.playlistAddRestoreInfo||(window.playlistAddRestoreInfo={}),window.playlistAddRestoreInfo}i.d(t,{getPlaylistAddRestoreInfo:()=>o})},783159:(e,t,i)=>{i.d(t,{hidePlaylistFromRecoms:()=>l});var o=i(772994),s=i(610989),a=i(850101);function l(e,t,i){ajax.post("al_audio.php?act=hide_playlist_from_recoms",{owner_id:e,playlist_id:t,access_hash:i},{onDone(){(0,a.showDoneBox)(s.getLang("audio_playlist_recoms_was_hidden"));let o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=s.getLang("audio_playlist_recoms_show"),o.setAttribute("onclick","AudioUtils.showPlaylistInRecoms("+e+", "+t+", '"+i+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,o.showErrorBox)(e||s.getLang("global_unknown_error"))}})}},965416:(e,t,i)=>{i.d(t,{initDomPlaylist:()=>a});var o=i(879007),s=i(261362);function a(e,t){let i=[];return(0,o.each)(t,(function(e,t){t&&[...t.querySelectorAll("._audio_row")].forEach((e=>{i.push((0,s.getAudioFromEl)(e))}))})),e.pushAudio(i),e}},890482:(e,t,i)=>{i.d(t,{initRowPlaylistsChooser:()=>s});var o=i(671300);function s(e,t,i,s){let a,l=o.AudioUtils.audioTupleToAudioObject(e);a=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,o.AudioUtils.playlistsByAudioDataCache=o.AudioUtils.playlistsByAudioDataCache||{};let r=o.AudioUtils.playlistsByAudioDataCache,n=a+"_"+l.ownerId+"_"+l.id;r[n]?o.AudioUtils._showPlaylistsChooser(i,t,r[n],a,l,e):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:a,audio_owner_id:l.ownerId,audio_id:l.id},{onDone:(d,u,_)=>{let c=r[n]={playlists:d,morePlaylists:u,newPlaylistHash:_};o.AudioUtils._showPlaylistsChooser(i,t,c,a,l,e,s)},onFail:()=>!0})}},49038:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{loadAllPlaylistAudios:()=>loadAllPlaylistAudios});var _web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(879007),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(327527);const AUDIO_LOAD_CHUNK_SIZE=1e3;let chunks,isDeleted,isAttach,onDone,playlist,preloadedCount,totalCount;function loadAllPlaylistAudios(e,t,i=!1){if(e.getForceReload())e.list=[];else if(!e.hasMore()||!e.isFullyLoadable())return onDone&&onDone();e.setForceReload(!1),chunks=[],isAttach="attach"===i,onDone=t,playlist=e,preloadedCount=0,totalCount=e.getTotalCount(),loadChunk(0,(()=>{isDeleted?onAllLoaded():(isAttach&&onAllLoaded(),loadAllChunks(onAllLoaded,1))}))}function onAllLoaded(){if(isDeleted)return onDone&&onDone(null,isDeleted);let e=[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(chunks,(function(t,i){i&&(e=e.concat(i))}));if((0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().getPlaylists().forEach((t=>{t.getId()===playlist.getId()&&(t._list=e)})),(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,{hasMore:!1}),onDone){onDone(playlist,!1,isAttach&&totalCount>preloadedCount)}}function loadAllChunks(e,t){t=t||0;let i=Math.max(0,Math.ceil((totalCount-preloadedCount)/AUDIO_LOAD_CHUNK_SIZE));if(isAttach&&t&&totalCount>preloadedCount&&i===t&&i++,i-t<=0)e();else{const o=new CallHub(e,i-t);for(let e=t;e<i;e++)loadChunk(e,(()=>{o.done()}))}}function loadChunk(chunkIndex,callback){const isPreload=isAttach&&!chunkIndex?1:0;let offset=chunkIndex*AUDIO_LOAD_CHUNK_SIZE;preloadedCount&&(offset=Math.abs(AUDIO_LOAD_CHUNK_SIZE-preloadedCount-chunkIndex*AUDIO_LOAD_CHUNK_SIZE)),ajax.post("al_audio.php?act=load_section",{type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset,is_loading_all:1,is_preload:isPreload,context:playlist.getContext(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.intval)(nav.objLoc.claim),ref:playlist.getTrackCodeRef()},{onDone:function(data,tpl,langs,templatesScript){if(0===chunkIndex){if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.addTemplates)({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,callback();isDeleted=!1,totalCount=data.totalCount,preloadedCount=data.list.length,(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,callback()},onFail:()=>!0})}},472128:(e,t,i)=>{i.d(t,{onAudioAddedToPlaylist:()=>l});var o=i(452314),s=i(327527),a=i(879007);function l(e,t,i,l){(0,s.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t).pushAudio(l,0),(0,a.each)((0,o.geByClass)(`_audio_pl_${e}_${t}`),((e,t)=>{(0,o.domReplaceEl)(t,(0,o.se)(i))}))}},190168:(e,t,i)=>{function o(e,t){let i=t.getAccessHash();cur.chooseMedia("audio_playlist",t.getOwnerId()+"_"+t.getPlaylistId()+(i?":"+i:""),{id:t.getPlaylistId(),ownerId:t.getOwnerId(),coverUrl:t.getCoverUrl(),gridCovers:t.getGridCovers(),title:t.getTitle(),authorName:t.getAuthorName(),authorHref:t.getAuthorHref(),accessHash:t.getAccessHash()})}i.d(t,{onPlaylistChoose:()=>o})},494483:(e,t,i)=>{i.d(t,{showAudioPlaylist:()=>A});var o=i(330690),s=i(452314),a=i(671300),l=i(714209),r=i(327527),n=i(610989),d=i(850101),u=i(879007),_=i(317412),c=i(20025),h=i(459841),p=i(703544),y=i(203240);function A(e,t,i,A,g,P){if(cur.apLayer)return(0,_.cancelEvent)(g);if(vk.widget)return!0;if(g&&(g.metaKey&&l.browser.mac||g.ctrlKey))return;let f=null;return window.Photoview&&window.cur&&cur.pvShown&&(f=(0,u.clone)(nav.objLoc),Photoview.hide(!0)),(0,d.boxRefreshCoords)(boxLoader),(0,s.show)(boxLoader),(0,s.show)(boxLayerWrap),window.stManager.add([window.jsc("web/auto_list.js"),"audio.css"],(function(){const l=(0,r.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,i),g=new o.AudioNavScreenProvider;let m,E,w;function v(e){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,E&&(0,_.removeEvent)(window.audioPlaylistLayerWrap,"click",E),w&&(0,_.removeEvent)(document.body,"keydown",w),delete cur.apLayer,delete cur.apLayerPlaylistId,(0,s.removeClass)(layerBG,"ap_layer_bg_dark"),f?nav.change(f):nav.change({z:!1}),layerQueue.pop(),g.popModal(m)}l.setContext(A),l.setForceReload(!0),l.setFromId(cur.oid),l.loadAll((function(l,I){if((0,s.hide)(boxLoader),(0,s.hide)(boxLayerWrap),I){let e=n.getLang("audio_error_deleted_playlist_box").split("/");return new c.MessageBox({title:e[0]}).content(e[1]).setButtons(n.getLang("global_close"),(function(){(0,d.curBox)().hide(),f&&nav.change(f)})).show(),void nav.setLoc((0,u.extend)(nav.objLoc,{z:!1}))}let C=(0,u.extend)(nav.objLoc,{z:"audio_playlist"+e+"_"+t+(i?"/"+i:"")});nav.setLoc(C),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=(0,s.se)('<div id="ap_layer_wrap" class="ap_layer_wrap" role="dialog" aria-modal="true"></div>'),document.body.appendChild(window.audioPlaylistLayerWrap));window.audioPlaylistLayerWrap.innerHTML="";const b=l&&l.getAudiosList?l.getAudiosList().length:0,T=l.isBlocked&&l.isBlocked();let k=(0,p.getPlaylistUrl)(l.getOwnerId(),l.getPlaylistId(),l.getAccessHash()),L=(0,u.getTemplate)("audio_playlist_snippet",{title:l.getTitle(),subTitle:l.getSubtitle(),description:l.getDescription(),coverStyle:l.getCoverUrl()?"background-image:url('"+l.getCoverUrl()+"'); background-size: cover;":"",authorLine:l.getAuthorLine(),infoLine1:l.getInfoLine1(),infoLine2:l.getInfoLine2(),id:l.getPlaylistId(),ownerId:l.getOwnerId(),href:k,addCls:l.getAddClasses(),followHash:l.getFollowHash(),accessHash:l.getAccessHash(),editHash:l.getEditHash(),deleteHash:l.getDeleteHash(),replaceHash:l.getReplaceHash(),gridCovers:l.getGridCovers(),type:l.getType(),context:A,followButtonText:l.isFollowed()?n.getLang("audio_playlist_btn_added"):n.getLang("audio_playlist_btn_add")});if(cur.apLayer=(0,s.se)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${L}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),T){(0,s.geByClass1)("audio_pl_snippet__body",cur.apLayer).innerHTML=(0,u.getTemplate)("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),(0,_.addEvent)(window.audioPlaylistLayerWrap,"click",E=function(e){e.target!=window.audioPlaylistLayerWrap&&e.target!=(0,s.geByClass1)("_ap_layer__close",cur.apLayer)||layers&&layers.fullhide&&layers.fullhide()}),(0,_.addEvent)(document.body,"keydown",w=function(e){if(27==e.keyCode)return layers&&layers.fullhide&&layers.fullhide(),(0,_.cancelEvent)(e)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),(0,s.addClass)(layerBG,"ap_layer_bg_dark"),m=l.isOfficial()?o.AudioNavScreenModalType.Album:o.AudioNavScreenModalType.Playlist,g.pushModal(m);const M=(0,s.geByClass1)("_audio_pl_snippet__list",cur.apLayer),S=a.AudioUtils.getAlbumParts(l);let D=0;b&&!T&&(cur.apLayerAutoList=new h.default(M,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(e,t){let i=[],o=l.getAudiosList();for(let e=t-=D;e<t+30;e++){const t=o[e];if(!t)break;if(S&&S.length&&S[0].offset===e){const e=S.shift();D++,i.push(a.AudioUtils.drawAlbumPartRow(e.number))}i.push(a.AudioUtils.drawAudio(t))}e(i)}}));(0,d.boxRefreshCoords)(cur.apLayer),(0,r.getAudioPlayer)().updateCurrentPlaying(),layers.fullhide=v,cur.apLayerPlaylistId=[e,t],(0,y.setFocusIsNeed)(window.audioPlaylistLayerWrap),P&&P()}))})),!1}},393641:(e,t,i)=>{i.d(t,{showPlaylistInRecoms:()=>l});var o=i(772994),s=i(610989),a=i(850101);function l(e,t,i){ajax.post("al_audio.php?act=show_playlist_in_recoms",{owner_id:e,playlist_id:t,access_hash:i},{onDone(){(0,a.showDoneBox)(s.getLang("audio_playlist_recoms_was_showed"));let o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=s.getLang("audio_playlist_recoms_hide"),o.setAttribute("onclick","AudioUtils.hidePlaylistFromRecoms("+e+", "+t+", '"+i+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,o.showErrorBox)(e||s.getLang("global_unknown_error"))}})}},706039:(e,t,i)=>{i.d(t,{showPlaylistsChooser:()=>_});var o=i(452314),s=i(671300),a=i(610989),l=i(20025),r=i(879007),n=i(280357),d=i(143148),u=i(302495);function _(e,t,i,_,c,h,p){let y=i.playlists,A=i.newPlaylistHash,g=i.morePlaylists;s.AudioUtils.copiedToPlaylistAudios=s.AudioUtils.copiedToPlaylistAudios||{},s.AudioUtils.copiedToPlaylistAudiosHashes=s.AudioUtils.copiedToPlaylistAudiosHashes||{};let P=t,f=(0,o.se)((0,o.rs)(s.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,a.getLang("audio_add_to_new_pl"),"audio_row__action_playlist"]));if((0,o.domInsertAfter)(f,P),P=f,f.addEventListener("click",(()=>{s.AudioUtils.editPlaylist(_,!1,"edit",{addAudio:h,newPlaylistHash:A})})),(0,r.each)(y,((e,t)=>{let i=!0,a=t[0]+"_"+t[1]+"_"+c.fullId,l=s.AudioUtils.copiedToPlaylistAudios[a],_="audio_row__action_playlist";(t[3]||l)&&(i=!1,_+=" audio_row__more_playlist_added");let h=(0,o.se)((0,o.rs)(s.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+t[0]+"_"+t[1],0,t[2],_]));(0,o.domInsertAfter)(h,P),P=h;let y=!1;h.addEventListener("click",(()=>{if(y)return;y=!0;let e=c.ownerId,l=c.id,_=s.AudioUtils.copiedToPlaylistAudios[a];_&&(_=_.split("_"),e=_[0],l=_[1]),i&&(s.AudioUtils.copiedToPlaylistAudiosHashes[a]=t[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:t[4],playlist_id:t[1],playlist_owner_id:t[0],audio_owner_id:e,audio_id:l,do_add:(0,r.intval)(i)},{onDone:(e,o,l)=>{(0,d.onAdditionalEvent)(p,c,{type:i?n.TYPE_ADDED:n.TYPE_REMOVED,subtype:n.SUBTYPE_PLAYLIST}),s.AudioUtils.copiedToPlaylistAudios[a]=!!i&&l,t[4]=i?e:s.AudioUtils.copiedToPlaylistAudiosHashes[a],i=!i,y=!1},onFail:()=>!0}),(0,u.logSearchAudioClick)(u.SearchClickActionMap.ADD_TO_PLAYLIST,c?.trackCode),(0,o.toggleClass)(h,"audio_row__more_playlist_added",i)}))})),g){let e=(0,o.se)((0,o.rs)(s.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,a.getLang("audio_row_show_all_playlists"),"audio_row__action_playlist"]));e.addEventListener("click",(()=>{(0,l.showBox)("al_audio.php?act=more_playlists_add",{owner_id:_,audio_owner_id:c.ownerId,audio_id:c.id},{params:{bodyStyle:"padding: 0px",width:560}})})),(0,o.domInsertAfter)(e,P),P=e}e.updatePosition()}},965428:(e,t,i)=>{i.d(t,{turnPlaylistDiscover:()=>s});var o=i(850101);function s(e,t){const i={act:"turn_playlist_discover",owner_id:e,playlist_id:t};ajax.post("al_audio.php",i,{onDone:e=>{(0,o.showDoneBox)(e)}})}},33594:(e,t,i)=>{i.d(t,{deleteEpisode:()=>s});var o=i(944762);function s(e,t){(0,o.isPodcast)(t)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.deleteEpisode(t.fullId,t.deleteHash)}))}},80959:(e,t,i)=>{i.d(t,{editEpisode:()=>s});var o=i(944762);function s(e,t){(0,o.isPodcast)(t)&&(cur.podcastEditData={audioId:t.fullId},window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.edit(t.fullId)})))}},747587:(e,t,i)=>{i.d(t,{faveEpisode:()=>l});var o=i(944762),s=i(668592),a=i(927984);function l(e,t){if(!e||!(0,o.isPodcast)(t))return;const i=(0,s.getAudioExtra)(t).faveHash;(0,a.bookmarkPodcast)(e.querySelector(".audio_row__action_fave"),t.fullId,i)}},476689:(e,t,i)=>{i.d(t,{isPrivatePodcast:()=>a});var o=i(944762),s=i(668592);function a(e){return!(!(0,o.isPodcast)(e)||!(0,s.getAudioExtra)(e).private)}},108687:(e,t,i)=>{i.d(t,{openEpisode:()=>l});var o=i(927984),s=i(735477),a=i(944762);function l(e,t){t=(0,s.audioTupleToAudioObject)(t),(0,a.isPodcast)(t)&&(0,o.showPodcast)(e,t.fullId,null,"audio")}},697034:(e,t,i)=>{i.r(t),i.d(t,{ACTION_HEARTBEAT:()=>r,ACTION_PAUSE:()=>a,ACTION_PLAY:()=>s,ACTION_SEEK:()=>l,ACTION_TIME_MARKER:()=>n,log:()=>d});var o=i(944762);const s="play",a="pause",l="seek",r="heartbeat",n="time_marker";function d(e,t){const i=t.audio;(0,o.isPodcast)(i)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.log(e,t)}))}},134931:(e,t,i)=>{i.d(t,{restoreEpisode:()=>s});var o=i(944762);function s(e,t){(0,o.isPodcast)(t)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.restoreEpisode(t.fullId,t.editHash)}))}},521183:(e,t,i)=>{function o(e,t){cur.audioPage&&cur.audioPage.showRecoms(!1,t.fullId)}i.d(t,{showRecoms:()=>o})},182720:(e,t,i)=>{i.d(t,{audioSearchPerformer:()=>s});var o=i(7144);function s(e,t,i){let s=!!window.AudioPage&&currentAudioPage(e),a=window.AudioPage&&currentAudioPage(e)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout((function(){s&&a?(t=(0,o.unclean)(t).replace(/<em>|<\/em>/g,""),nav.change({q:t,performer:1},i,{searchPerformer:!0,nav:!0,isLayer:s.isLayer()})):nav.go(e,i)}),50)}},143148:(e,t,i)=>{i.d(t,{onAdditionalEvent:()=>_});var o=i(280357),s=i(689938),a=i(572466),l=i(148818),r=i(327527),n=i(968308),d=i(198155),u=i(735477);function _(e,t,i={}){const _=new o.AudioStats(new l.WebPlayerAdapter((0,r.getAudioPlayer)(),(0,s.ensureDIRootWebContainer)().resolve(a.EmitterFactory))),c=t&&t.context||e&&(0,n.getContext)(e)||"",h=(0,r.getAudioPlayer)();let p,y=h.getCurrentAudio()?(0,u.audioTupleToAudioObject)(h.getCurrentAudio()):null;p=y&&t.fullId===y.fullId?h.getCurrentPlaylist():(0,d.getContextPlaylist)(e).playlist;const A=p?p.getFullId():"",g={...t,context:c,playlistId:A,...i};_.sendCurrentAudioEvent({type:g.type,subtype:i.subtype||g.subtype||_.getPlaySubtype(),ownerId:g.ownerId,audioId:g.id,trackCode:g.trackCode,state:_.playerAdapter.getState(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):"",context:g.context,playlistId:g.playlistId})}},618640:(e,t,i)=>{i.d(t,{addAudioToOwner:()=>s});var o=i(317412);function s(e,t){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+e),(0,o.cancelEvent)(t)}},573931:(e,t,i)=>{i.d(t,{cancelReplacement:()=>s});var o=i(452314);function s(e,t,i){ajax.post("al_audio.php",{act:"cancel_replacement",hash:t,audio_id:e},{onFail:()=>!0}),(0,o.re)(i)}},863431:(e,t,i)=>{i.d(t,{chooseAudioBox:()=>a});var o=i(452314),s=i(317412);function a(e,t,i){if(void 0!==e.selected)cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,(0,o.removeClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.add;else{let i=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",t.owner_id+"_"+t.id,t.info),(!cur.attachCount||cur.attachCount()>i)&&cur.lastAddMedia&&(e.selected=cur.lastAddMedia.chosenMedias.length-1,(0,o.addClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.cancel)}return(0,s.cancelEvent)(i)}},706449:(e,t,i)=>{i.d(t,{claim:()=>l});var o=i(452314),s=i(217944),a=i(735477);function l(e,t,i){(0,o.addClass)(t,"audio_moder_claimed"),(0,s.onRowOver)(t,!1,!0),e=(0,a.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_claim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId})}},310666:(e,t,i)=>{i.d(t,{deleteAudio:()=>y});var o=i(452314),s=i(327527),a=i(879007),l=i(248298),r=i(20025),n=i(610989),d=i(280357),u=i(143148),_=i(671300),c=i(432800),h=i(476726),p=i(579032);function y(e,t){const i=(0,h.partConfigEnabled)("add_audio_to_effector_web");if(i){const i=(0,p.ensureAudioPageService)();return i.setUserId(window.vk.id),void i.deleteAudioLegacyFx({audioEl:e,audio:t})}function y(t){return(0,o.domData)(e,"in-progress",(0,a.intval)(t))}if(window.tooltips&&tooltips.hideAll(),(0,a.intval)((0,o.domData)(e,"in-progress")))return;y(!0);let A=!1;t.isClaimed&&(A=!0);let g=_.AudioUtils.getAddRestoreInfo(),P=g[t.fullId];P&&P.deleteAll?(0,r.showFastBox)({title:n.getLang("audio_delete_all_title"),dark:1,onHide:()=>y(!1)},P.deleteConfirmMsg||"",n.getLang("global_delete"),(function(e){let t=(0,a.extend)({act:"delete_all"},P.deleteAll);ajax.post("al_audio.php",t,{showProgress:()=>(0,l.lockButton)(e),onDone:function(){let e=(0,s.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,P.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);(0,s.getAudioPlayer)().deletePlaylist(e),nav.reload()},onFail:()=>!0})}),n.getLang("global_cancel")):(A?(0,o.re)(e):(0,o.addClass)(e,"audio_row__deleted"),ajax.post("al_audio.php",{act:"delete_audio",oid:t.ownerId,aid:t.id,hash:t.deleteHash,restore:1,track_code:t.trackCode},{onDone:async(o,s)=>{const a=(0,c.ensureAudioDislikesInMyMusicWebService)();(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_REMOVED}),A||y(!1),g[t.fullId]={state:"deleted",deleteAll:o,deleteConfirmMsg:s},i&&await a.deleteFromMyMusicFx({audio:t,audioEl:e,forceRemoveFromStoreParams:{oldIdentity:t,newIdentity:t}}),A&&_.AudioUtils.deleteDeletedAudios(),_.AudioUtils.onRowOver(e,!1,!0)},onFail:()=>!0}),_.AudioUtils.onRowOver(e,!1,!0))}},790683:(e,t,i)=>{i.d(t,{deleteCurrentAudio:()=>a});var o=i(452314),s=i(327527);function a(e,t){window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(e);const i=(0,s.getAudioPlayer)(),a=i.getPlaylistQueue();a&&(a.removeAudio(t.fullId),i.saveStateCurrentPlaylist()),(0,o.re)(e)}},669862:(e,t,i)=>{i.d(t,{deleteDeletedAudios:()=>n});var o=i(879007),s=i(327527),a=i(940242),l=i(476726),r=i(579032);function n(){if((0,l.partConfigEnabled)("add_audio_to_effector_web")){const e=(0,r.ensureAudioPageService)().$deletedFromMyMusicAudiosIdentitiesMap.getState();Object.keys(e).forEach((e=>{(0,s.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}else(0,o.each)((0,a.getAddRestoreInfo)(),((e,t)=>{"deleted"===t.state&&(0,s.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}},804001:(e,t,i)=>{i.d(t,{drawAudio:()=>h,getDurationMod:()=>c});var o=i(735477),s=i(671300),a=i(37055),l=i(879007),r=i(307188),n=i(391111);const d=600,u=3600,_=36e3;function c(e){return e<d?"s":e<u?"m":e<_?"l":"n"}function h(e,t){let i=JSON.parse((0,l.getTemplate)("audio_bits_to_cls")),d=e[s.AudioUtils.AUDIO_ITEM_INDEX_FLAGS],u=[];for(let e=0;e<32;e++){let t=1<<e;d&t&&u.push(i[t])}const _=(0,o.audioTupleToAudioObject)(e),h=s.AudioUtils.isPodcast(e);h&&(u.push("audio_podcast"),s.AudioUtils.isPrivatePodcast(e)&&u.push("audio_podcast_private")),t&&u.push(t);const p=e[s.AudioUtils.AUDIO_ITEM_INDEX_COVER_URL],y=p?.split(/(,(?!\d))/g).filter((e=>","!==e)),[A=""]=y??[];let g,P=s.AudioUtils.getAudioPerformers(e),f=e[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION],m=(0,r.formatTime)(f),E=(0,l.clean)(JSON.stringify(e));try{const t=(0,l.getTemplate)("podcast_row",e);g=h&&t?t:(0,l.getTemplate)("audio_row",e)}catch(e){return""}let w="";return _.hasTrackPage&&(u.push("audio_has_track_page"),w=`/audio${_.trackPageId}`),(0,n.isRadio)(_)&&u.push("audio_row--radio"),g=g.replace(/%cls%/,(()=>u.join(" "))),g=g.replace(/%duration%/,(()=>m)),g=g.replace(/%serialized%/,(()=>E)),g=g.replace(/%cover_image%/,(()=>function(e,t){let i="";if(e)i=`<img class='audio_row__cover' alt='${t}' src='${e}' loading='lazy' decoding='async' width='40' height='40' />`;else{const{icon:e}=(0,a.getIcon24Song)();i=`<div class='audio_row__cover audio_row__without_cover'>${e}</div>`}return i}(A,_.title))),g=g.replace(/%performers%/,(()=>P)),g=g.replaceAll(/%track_url%/g,(()=>w)),g=g.replace(/%duration_mod%/,(()=>c(f))),g=g.replace(/%chart_info_position%/,(()=>{return(t=e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].position)?`<div class="audio_row__position">${t}</div>`:"";var t})),g=g.replace(/%chart_info_state%/,(()=>function(e){let t="";switch(e){case 0:t="audio_row__state-new_release";break;case 1:t="audio_row__state-no_changes";break;case 2:t="audio_row__state-moved_up";break;case 3:t="audio_row__state-moved_down";break;case 4:t="audio_row__state-crown";break;default:t=""}return t?`<div class="audio_row__state ${t}"></div>`:""}(e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].state))),g}},950783:(e,t,i)=>{i.d(t,{editAudio:()=>s});var o=i(20025);function s(e,t,i){(0,o.showBox)("al_audio.php",{act:"edit_audio_box",aid:t.fullId,force_edit_hash:i},{params:{width:"456px",bodyStyle:"padding: 20px;",hideButtons:1},dark:1})}},268158:(e,t,i)=>{i.d(t,{getActionIcon:()=>A});var o=i(787576),s=i(722371),a=i(488439),l=i(365045),r=i(594289),n=i(84367),d=i(146194),u=i(44500),_=i(26152),c=i(947209),h=i(203882),p=i(563442);const y={current_delete:(0,o.getIcon20Cancel)(),recoms_delete:(0,o.getIcon20Cancel)(),listened_delete:(0,o.getIcon20Cancel)(),delete:(0,o.getIcon20Cancel)(),restore_recoms:(0,s.getIcon20Add)(),more:(0,a.getIcon20More)(),edit:(0,l.getIcon20WriteOutline)(),recoms:(0,r.getIcon20Stars)(),lyrics:(0,n.getIcon20TextTtOutline)(),snippet:(0,d.getIcon20FlashOutline)()};function A(e){const t=y[e];let i="";if(t)i=g(t);else switch(e){case"add":i=g((0,u.getIcon20Check)())+g((0,s.getIcon20Add)());break;case"next":i=`<div class="audio_row__icon--horizontal">${g((0,_.getIcon20ListPlayOutline)())+g((0,c.getIcon20ListAddOutline)())}</div>`;break;case"fave":i=g((0,h.getIcon24FavoriteOutline)())+g((0,p.getIcon24Favorite)())}return i}function g(e){return`<div class="audio_row__icon audio_row__icon_${e.name}">${e.icon}</div>`}},940242:(e,t,i)=>{function o(){return window.audioAddRestoreInfo||(window.audioAddRestoreInfo={}),window.audioAddRestoreInfo}i.d(t,{getAddRestoreInfo:()=>o})},261362:(e,t,i)=>{i.d(t,{getAudioFromEl:()=>a});var o=i(452314),s=i(671300);function a(e,t){e=(0,o.domClosest)("_audio_row",e);let i=(0,o.data)(e,"audio")||JSON.parse((0,o.domData)(e,"audio"));if(!i)return null;if(t){i=s.AudioUtils.audioTupleToAudioObject(i),i.isDeleted=(0,o.hasClass)(e,"audio_row__deleted"),i.isCurrent=(0,o.hasClass)(e,s.AudioUtils.AUDIO_CURRENT_CLS),i.isPlaying=(0,o.hasClass)(e,s.AudioUtils.AUDIO_PLAYING_CLS),i.isFromCurrentPlaylist=!!(0,o.gpeByClass)("_audio_section__current",e),i.isFromAutoplay=!!(0,o.gpeByClass)("Autoplay--container",e),i.isNumeric=!!(0,o.gpeByClass)("audio_numeric",e),i.isWithCovers=!!(0,o.gpeByClass)("audio_w_covers",e),i.withInlinePlayer=!i.isWithCovers&&!(0,o.gpeByClass)("audio_no_inline_player",e),i.isInSnippet=!!(0,o.gpeByClass)("_audio_pl_snippet__list",e),i.isInEditBox=!!(0,o.gpeByClass)("_audio_pl_edit_box",e),i.isInRecomsBlock=!!(0,o.gpeByClass)("_audio_recoms_blocks",e),i.isInFastChat=!!(0,o.gpeByClass)("fc_tab",e),i.isInAttach=!!(0,o.gpeByClass)("media_preview",e),i.isSetClaimed=(0,o.hasClass)(e,"audio_moder_claimed"),i.isPodcastListSnippet=(0,o.hasClass)(e,"podcast_list_snippet");const t=(0,o.gpeByClass)("_audio_pl",e);i.isCurrentAlbumSnippet=!!i.album&&!!t&&t.dataset.playlistId===`playlist_${i.album[0]}_${i.album[1]}`}return i}},703261:(e,t,i)=>{i.d(t,{onAudioChoose:()=>r});var o=i(879007),s=i(610989),a=i(452314),l=i(317412);function r(e,t,i,r){if((0,o.isUndefined)(t.selected)){let e=cur.attachCount&&cur.attachCount()||0;const o=i.fullId+(i.accessKey?"_"+i.accessKey:"");if(cur.chooseMedia("audio",o,r),(!cur.attachCount||cur.attachCount()>e)&&cur.lastAddMedia){t.selected=cur.lastAddMedia.chosenMedias.length-1,(0,a.addClass)((0,a.domPN)(t),"audio_selected");let e=(0,a.getSize)(t)[0];(0,a.setStyle)(t,"width",e),t.innerHTML=s.getLang("global_cancel")}}else cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,(0,a.removeClass)((0,a.domPN)(t),"audio_selected"),t.innerHTML=s.getLang("global_add_media");return(0,l.cancelEvent)(e)}},922107:(e,t,i)=>{i.d(t,{onRowLeave:()=>l});var o=i(452314),s=i(402409),a=i(476726);function l(e){if(!((0,a.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,a.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return void r(e);const t=s.AudioRowMoreTooltipController.ensure();t.isShown?t.events.once(s.AudioRowMoreTooltipControllerEventType.Closed,(()=>{window.tooltips?.hideAll?.(e),r(e)})):r(e)}function r(e){(0,o.data)(e,"leaved",!0);let t=(0,o.data)(e,"tt");if(t&&t.isShown())return;if(clearTimeout(window.audioRowHoverTO),!(0,o.data)(e,"actions"))return;let i=(0,o.geByClass1)("_audio_row__actions",e),s=(0,o.geByClass1)("_audio_row__duration",e);(0,o.re)(i),(0,o.setStyle)(s,"visibility","visible"),(0,o.data)(e,"actions",0)}},217944:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{onRowOver:()=>onRowOver});var _vkontakte_internal_domains__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(392248),_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(452314),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(671300),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(327527),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(610989),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(317412),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(879007),_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(268158),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(476726),_shared_audioplayer_AudioPlayerAdapter_audioObject_audioObjectToApiAudio__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(748690),_web_audio_components_AudioLongtap_showAudioLongtapModal__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(439677),_web_audio_components_AudioLongtap_showAudioLongtapModalEffector__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(843225),_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(402409),_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(996538),_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(119265),_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(302495),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(332583),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(255053),_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(579032);function onRowOver(audioEl,event,forceRedraw,audioLinkPathname,audioAccessKey){const longTapEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_longtap_web"),copyLinkEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_tooltip_copy_link_web"),showMoreTooltipRedesignEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled"),myMusicRefactoringEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("add_audio_to_effector_web");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_list_snippet")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_snippet__controls"))return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"leaved",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions")&&!forceRedraw)return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"no_extra"))return;clearTimeout(window.audioRowHoverTO);const ap=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_15__.getAudioPlayer)();window.audioRowHoverTO=setTimeout((()=>{window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(audioEl);let audio=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl),audioObject=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl,!0);showMoreTooltipRedesignEnabled&&unmountRowMoreTooltip();const playerUI=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_15__.getAudioPlayerUI)();let actions=[],moreActions=[],context=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getContextPlaylist(audioEl,!0),[sectionContext,blockContext]=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.contextSplit(context),extra=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject);const copyAudioLink=()=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.COPY_LINK,audio?.trackCode),audioLinkPathname?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLink.call(null,audioLinkPathname):_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLinkByIdentity.call(null,audioObject,audioAccessKey));if(context=sectionContext,audioObject.isDeleted)if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"===context)actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{let e=!1;if(myMusicRefactoringEnabled){const t=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_14__.ensureAudioPageService)().$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState();e=audioObject.fullId in t}else{const t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo();e=t[audioObject.fullId]&&t[audioObject.fullId].deleteAll}e&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{let actionsList=[!longTapEnabled&&"next","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actionsList=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isExternalStream(audioObject))actionsList=[];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=[longTapEnabled&&"snippet","recoms",!longTapEnabled&&"next","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=["add"];else if(context)if("my_audios_block"===blockContext)actionsList=["recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else switch(context){case"search_results":"search_owned_audios"===blockContext&&(actionsList=["recoms","edit",!longTapEnabled&&"next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),longTapEnabled&&actionsList.unshift("snippet");break;case"catalog":actionsList=[longTapEnabled&&"snippet","recoms","edit",!longTapEnabled&&"next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"album_page":actionsList=[longTapEnabled&&"snippet","recoms",!longTapEnabled&&"next","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"my":case"module":case"user_list":case"group_list":actionsList=[longTapEnabled&&"snippet",playerUI.lyrics.enabled&&"lyrics","recoms","edit",!longTapEnabled&&"next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"my_audios_short":actionsList=[playerUI.lyrics.enabled&&"lyrics","recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"edit_playlist":actionsList=["add",!longTapEnabled&&"next","edit"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;case"apps_edit":actionsList=["apps_edit_delete"];break;case"clips":case"clip_effect_list":audioObject.isOriginalSound&&(actionsList=[]);break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),longTapEnabled&&actionsList.unshift("snippet")}("moderation_video"===context||window.AdminVideoCatalogue)&&(actionsList=["link_to_clip"]),actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.each)(extra.moder_actions,((i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])})),audioObject.isCurrentAlbumSnippet&&(actionsList=actionsList.filter((e=>"open_album"!==e))),vk.id||(actionsList=actionsList.filter((e=>"open_album"===e)));const addDeleteAction=()=>{audioObject.isFromCurrentPlaylist?audioObject.isFromAutoplay||audioObject.isCurrent||actions.push(["current_delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']):audioObject.canDelete&&!vk.widget&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"'])},currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget;actionsList.forEach((e=>{switch(e){case"next":audioObject.isCurrent||audioObject.isClaimed||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":let e=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&cur.audioPage.getOwnerId()!==audioObject.ownerId&&(e=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=e&&actions.push(["add",(...e)=>{if(myMusicRefactoringEnabled){const e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo()?.[audioObject?.fullId];(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.logSearchAudioClick)("added"===e?.state?_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.REMOVE_FROM_ME:_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.ADD_TO_ME,audioObject?.trackCode)}else{const e=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_16__.ensureMyMusicService)().$identitiesMap.getState();(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.logSearchAudioClick)((0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_17__.getAudioFullId)(audioObject)in e?_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.REMOVE_FROM_ME:_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.ADD_TO_ME,audioObject?.trackCode)}return _web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio(...e)},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.replaceWithOriginal.bind(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils,audioEl,audioObject))},_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":addDeleteAction();break;case"apps_edit_delete":actions.push(["delete",window.AppsEdit.removeAudio,"",'onmouseover="AppsEdit.showRemoveAudioTooltip(this)"']);break;case"fave":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&actions.push(["fave",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"copy_link":copyLinkEnabled&&!audioObject.isClaimed&&moreActions.push(["copy_link",copyAudioLink,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang("audio_copy_audio_link")]);break;case"share":audioObject.isClaimed||moreActions.push(["share",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.SHARE,audioObject?.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.shareAudio(...e)),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.OPEN_ALBUM,audioObject?.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioAlbum(...e)),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang("audio_open_album")]);break;case"open_episode":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.openEpisode,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang("audio_podcast_open_episode")]);break;case"lyrics":audioObject.hasLyrics&&actions.push(["lyrics",()=>{playerUI.lyrics.open({audio,playlist:context.playlist,context:audioObject.context||context.context})},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"snippet":actions.push(["snippet",()=>{const e=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_mobx")&&(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_mobx_longtap");if((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.SHOW_SNIPPET,audioObject?.trackCode),!e)return(0,_web_audio_components_AudioLongtap_showAudioLongtapModalEffector__WEBPACK_IMPORTED_MODULE_9__.showAudioLongtapModalEffector)(audioObject,audioEl);const t=(0,_shared_audioplayer_AudioPlayerAdapter_audioObject_audioObjectToApiAudio__WEBPACK_IMPORTED_MODULE_7__.audioObjectToApiAudio)(audioObject),i=(0,_vkontakte_internal_domains__WEBPACK_IMPORTED_MODULE_18__.toMusicSnippetAudioData)(t);return(0,_web_audio_components_AudioLongtap_showAudioLongtapModal__WEBPACK_IMPORTED_MODULE_8__.showAudioLongtapModal)(i,audioObject?.trackCode)},"",'onmouseover="audioShowActionTooltip(this)"']),moreActions.push(["next",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_13__.SearchClickActionMap.LISTEN_NEXT,audioObject?.trackCode),ap.setNext.apply(ap,e)),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang("audio_set_next_audio")])}})),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__actions audio_row__actions"></div>');if(actions.forEach((t=>{let i=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getRowActionName(t[0],audioObject,audioEl),o=(0,_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_5__.getActionIcon)(t[0]),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)(`<button\naria-label="${i}"\ndata-action="${t[0]}"\ndata-testid="audio_row_action_${t[0]}"\nclass="audio_row__action audio_row__action_${t[0]} _audio_row__action_${t[0]}${t[4]?" "+t[4]:""}" ${t[3]||""}>\n${t[2]||o}\n</button>`);t[1]&&s.addEventListener("click",(e=>(t[1]&&t[1].call(window,audioEl,audioObject),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)))),e.appendChild(s)})),myMusicRefactoringEnabled){const e=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_14__.ensureAudioPageService)().$myMusicIdentitiesMap.getState(),t=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_17__.getAudioFullId)(audioObject)in e;let i=!1;audioEl&&(audioEl.closest(".CatalogBlock__my_audios_block")||audioEl.closest(".CatalogBlock__my_audios"))&&(i=!0),t&&!i&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(audioEl,"audio_row__added")}else{const e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo();let t=e[audioObject.fullId];t&&e[t.addedFullId]&&(t=null),t&&"added"===t.state&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(audioEl,"audio_row__added")}let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__info",audioEl),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__duration",audioEl),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__actions",audioEl);if(!t)return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"visibility","hidden"),t.appendChild(e);let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__action_more",e);moreActions.length&&s&&(showMoreTooltipRedesignEnabled?mountRowMoreTooltip(s,{audioEl,audioTuple:audio,audio:audioObject,audioLinkPathname,audioAccessKey}):setMoreAction(audioEl,audio,audioObject,moreActions,s)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions",1)}audioObject.showInfo&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioInfo(audioEl,audioObject,!1)}),forceRedraw?0:10)}function setMoreAction(e,t,i,o,s){const a=_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_12__.AudioPageProxy.ensure().emitter,l=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_tooltip_copy_link_web"),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("im-page_classic",e),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history_w",e),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history",e),u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_chat_body_abs",e),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("wk_history_audio_content",e),h=e.closest(".CatalogBlock"),p={};d?(p.getWrapEl=()=>r?null:u,p.appendTo=d):c?p.appendTo=c:h?p.appendTo=h:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("post",e)?p.appendTo=document.body:p.appendToParent=!0;const y=new ElementTooltip(s,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.extend)({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:_,bottomGap:r&&n?parseInt((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getStyle)(n,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(t,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"leaved")&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.onRowLeave(e)}},p));o.forEach((o=>{const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,o));switch(s?.setAttribute("data-testid",`audio_row_more_action_${o[0]}`),o[0]){case"add_to_playlist":let r,n;s.addEventListener("mouseenter",r=()=>{clearTimeout(n),n=setTimeout((()=>{s.removeEventListener("mouseenter",r),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,s,y,e)}),150)}),s.addEventListener("click",(()=>{n||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,s,y,e)})),s.addEventListener("mouseleave",(()=>{clearTimeout(n)}));break;case"copy_link":if(!l)break;s.addEventListener("click",(t=>(o[1].call(window,e,i).then((()=>{a.emit(_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_12__.AudioPageEventType.AudioLinkCopied)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(t))));break;default:s.addEventListener("click",(t=>(o[1].call(window,e,i),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(t))))}_.appendChild(s)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.addEvent)(s,"click",(e=>{y.isShown()||y.show(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"tt",y)}function mountRowMoreTooltip(e,t){if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const i=_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_10__.AudioRowMoreTooltipController.ensure(),o=(0,_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_10__.ensureAudioRowMoreTooltipService)(),s=e?.closest?.(`.${_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_11__.AUDIO_LAYER_CONTAINER_CLASS_NAME}`);e.addEventListener("mouseenter",(()=>{i.checkIsMounted(e)||(i.checkIsMounted()&&unmountRowMoreTooltip(),Boolean(t?.audioEl)&&window.tooltips?.hideAll?.(t.audioEl),o.init(t),i.mount(e,s||void 0))})),e.addEventListener("click",(e=>{e?.preventDefault(),e?.stopPropagation()}))}function unmountRowMoreTooltip(){if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const e=_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_10__.AudioRowMoreTooltipController.ensure();e.isMounted&&e.unmount()}},965210:(e,t,i)=>{i.d(t,{replaceWithOriginal:()=>n});var o=i(452314),s=i(327527),a=i(59052),l=i(804001),r=i(735477);function n(e,t,i){(t=t||(0,s.getAudioPlayer)().getCurrentAudio())&&(t=(0,r.audioTupleToAudioObject)(t),ajax.post("al_audio.php",{act:"replace_with_original",hash:t.replaceHash,audio_id:t.fullId},{onDone:function(s){let r=JSON.parse(t.extra).claim.original;r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=s,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=t.ownerId;let n=(0,o.se)((0,l.drawAudio)(r));e.parentElement.insertBefore(n,e),e.parentElement.removeChild(e),i&&i()},onFail:()=>(i(),!0)}))}},806398:(e,t,i)=>{i.d(t,{shareAudio:()=>u});var o=i(280357),s=i(327527),a=i(20025),l=i(850101),r=i(143148),n=i(944762),d=i(735477);function u(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(!(t=t||(0,s.getAudioPlayer)().getCurrentAudio()))return;t=(0,d.audioTupleToAudioObject)(t);const i=(0,n.isPodcast)(t)?"podcast":"audio";return(0,r.onAdditionalEvent)(e,t,{type:o.TYPE_SHARE_AUDIO}),!(0,a.showBox)("like.php",{act:"publish_box",object:i+t.fullId,list:t.actionHash,to:"mail"},{stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")],onFail:function(e){return(0,l.showDoneBox)(e),!0},params:{shareButtonElement:e}})}},173236:(e,t,i)=>{i.d(t,{showAudioRestriction:()=>f});var o=i(735477),s=i(610989),a=i(850101),l=i(879007),r=i(804001),n=i(59052),d=i(452314),u=i(507035),_=i(327527),c=i(20025),h=i(490712),p=i(7144),y=i(258643),A=i(221844),g=i(344588);function P(e){const t=y.FlatButton.render({children:s.getLang("global_close"),appearance:y.FlatButtonAppearance.PRIMARY,size:y.FlatButtonSize.M,restAttrs:{onclick:"curBox().hide()"}});(0,c.showFastBox)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{(0,h.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()" aria-label="${s.getLang("global_close")}">\n      ${(0,A.getIcon24Cancel)().icon}\n    </button>\n    <div class="audio_restriction_box__icon">${(0,g.getIcon56PensiveFace)().icon}</div>\n    <div class="audio_restriction_box__title">${s.getLang("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n      ${t}\n    </div>\n  `)}function f(e,t={}){if(!e)return!1;if((e=(0,o.audioTupleToAudioObject)(e)).restrictionStatus){if(e.actionHash){(0,h.statlogsValueEvent)("audio_restriction_popup","show",e.restrictionStatus);const i=(0,c.showBox)("al_audio.php",{act:"restriction_box",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{hideButtons:!0,onShow:function(){let i=(0,a.curBox)();(0,p.isFunction)(t.onShow)&&t.onShow(),i&&i.once("click:ok",(()=>{(0,h.statlogsValueEvent)("audio_restriction_popup","click",e.restrictionStatus)}))},onHide:i=>{(0,p.isFunction)(t.onHide)&&t.onHide(),i||(0,h.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+e.restrictionStatus,onDone:(t,i)=>{if(i&&i.play){t.hide();const s=function(e){const t=(0,d.geByClass)("_audio_row_"+e.fullId);if(!t||!t.length)return!1;const i=(0,u.parseJSON)((0,d.domData)(t[0],"audio"));if(!i)return!1;const o=(0,u.parseJSON)(i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]);o&&delete o.claim,i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&=~n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT,i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(o);const s=(0,_.getAudioPlayer)().getCurrentPlaylist(),a=(0,d.se)((0,r.drawAudio)(i,"no_extra"));if(s){const e=i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],t=s.getAudio(e);t&&(t[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],t[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],t[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=i[n.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA])}return(0,l.each)(t,((e,t)=>{const o=e>0?(0,d.se)((0,r.drawAudio)(i,"no_extra")):a;t.parentElement.insertBefore(o,t),t.parentElement.removeChild(t)})),a}(i.audio?(0,o.audioTupleToAudioObject)(i.audio):e),a=(0,_.getAudioPlayer)();s&&a.toggleAudio(s,{target:s})}},onFail:()=>(i&&i.hide(),P(e),!0)})}else P(e);return!0}return!1}},199369:(e,t,i)=>{i.d(t,{toggleAddAudioLegacy:()=>v});var o=i(452314),s=i(671300),a=i(327527),l=i(850101),r=i(879007),n=i(514640),d=i(280357),u=i(143148),_=i(198155),c=i(7144),h=i(96526),p=i(610989),y=i(624216),A=i(317412),g=i(20025),P=i(476726),f=i(332583),m=i(255053),E=i(760325),w=i(847891);function v(e,t,i=(()=>{}),v=""){const I=window.vk.id;if(!function(e){return(0,E.isNumber)(e)&&w.Ranges.isUserId(e)}(I))return void console.error("The user is not authorized, it is impossible to add or delete audio");if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function C(t){return(0,o.domData)(e,"in-progress",(0,r.intval)(t))}if((0,r.intval)((0,o.domData)(e,"in-progress")))return;if(C(!0),!(t=t||s.AudioUtils.getAudioFromEl(e,!0)))return;const b=window.AudioPage&&currentAudioPage(e),T=(0,f.ensureMyMusicService)(),k=b&&b.getOwnerId()<0&&b.canAddToGroup()&&b.getOwnerId()!==t.ownerId;let L=k?-b.getOwnerId():0,M=s.AudioUtils.getAddRestoreInfo(),S=M[t.fullId];S&&M[S.addedFullId]&&(S=null);let D=(0,o.geByClass1)("_audio_row_"+t.fullId);D=D!=e&&D;let O=b&&b.getPageCurrentPlaylist();const x=(0,_.getContextPlaylist)(e)??{context:v};let R={group_id:L,audio_owner_id:t.ownerId,audio_id:t.id,hash:t.addHash,from:x&&x.context||"",track_code:t.trackCode};const U=(0,P.partConfigEnabled)("audio_longtap_web"),B=(0,P.partConfigEnabled)("audio_my_music_api_web_enabled");if(k||t.accessKey!==t.addHash&&t.accessKey!==t.deleteHash)if(S){if("deleted"==S.state)B?T.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:I}).then((()=>{s.AudioUtils.getAudioTrackCodeFromPlaylist(x.playlist,t).then((i=>{(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),C(!1)})).catch((t=>{const i=t?.error?.error_msg;return i&&new g.MessageBox({title:p.getLang("global_error")}).content(i).setButtons(p.getLang("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,o.removeClass)(e,"audio_row__added"),C(!1),!0})):y.ajax.post("al_audio.php",{act:"restore_audio",oid:t.ownerId,aid:t.id,hash:t.restoreHash,track_code:t.trackCode},{onDone:function(){s.AudioUtils.getAudioTrackCodeFromPlaylist(x.playlist,t).then((i=>{(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),C(!1)},onFail:()=>(C(!1),!0)}),(0,o.removeClass)(e,"audio_row__deleted"),delete M[t.fullId],s.AudioUtils.onRowOver(e,!1,!0);else if("added"==S.state){const i=()=>{s.AudioUtils.getAudioTrackCodeFromPlaylist(x.playlist,t).then((i=>{(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_REMOVED,trackCode:i})}));const i=(0,a.getAudioPlayer)();i&&(i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,L?-L:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(S.addedFullId),i.notify(n.events.MUSIC_AUDIOS_DELETE,t,{audioElement:e})),C(!1)},l=()=>(C(!1),!0);if(U&&!S.audio.deleteHash){const{id:e,ownerId:o}=S.audio,s=(0,m.getAudioFullId)({id:e,ownerId:o}),a=T.$identitiesMap.getState()[s]?.id;a&&I&&T.deleteFx({identity:{id:a,ownerId:I,accessKey:t.accessKey}}).then(i).catch(l)}else y.ajax.post("al_audio.php",{act:"delete_audio",oid:S.audio.ownerId,aid:S.audio.id,hash:S.audio.deleteHash,track_code:t.trackCode},{onDone:i,onFail:l});if((0,o.removeClass)(e,"audio_row__added"),U&&!B){const e={id:t.id,ownerId:t.ownerId},i=(0,m.getAudioFullId)(e),o=T.$identitiesMap.getState()[i];T.removeFromStore({oldIdentity:e,newIdentity:o})}D&&(0,o.removeClass)(D,"audio_row__added"),delete M[t.fullId],(0,a.getAudioPlayer)().notify(n.events.REMOVED,t.fullId,S.addedFullId)}}else!k&&B?T.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:I}).then((({id:o,ownerId:l})=>{if(s.AudioUtils.getAudioTrackCodeFromPlaylist(x.playlist,t).then((i=>{(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),o&&l){let s=l+"_"+o;M[t.fullId]={state:"added",addedFullId:s,audio:t},(0,a.getAudioPlayer)().notify(n.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),(0,c.isFunction)(i)&&i()}C(!1)})).catch((t=>{const i=t?.error?.error_msg;return i&&new g.MessageBox({title:p.getLang("global_error")}).content(i).setButtons(p.getLang("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,o.removeClass)(e,"audio_row__added"),C(!1),!0})):y.ajax.post("al_audio.php?act=add",R,{onDone:function(l,r){if(s.AudioUtils.getAudioTrackCodeFromPlaylist(x.playlist,t).then((i=>{(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),l){let d=l[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+l[s.AudioUtils.AUDIO_ITEM_INDEX_ID];M[t.fullId]={state:"added",addedFullId:d,audio:s.AudioUtils.audioTupleToAudioObject(l)},U&&T.addToStore({oldIdentity:{id:t.id,ownerId:t.ownerId},newIdentity:{id:l[s.AudioUtils.AUDIO_ITEM_INDEX_ID],ownerId:l[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}}),(0,a.getAudioPlayer)().notify(n.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),(0,c.isFunction)(i)&&i(),function(e,t){if(!t||!t.id)return;const i=e?.parentElement?.querySelector(".audio_page_player_share");if(!i)return;const s=(0,o.se)(`\n    <div class="ta_l">\n      <div>${t.text}</div>\n    </div>\n `),a=()=>{window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t.hash,hint_id:t.id})};(0,A.addEvent)(s,"click",a);const l=new h.ElementTooltip(i,{appendToParent:!0,cls:"feature_intro_tt feature_intro_blue_tt feature_intro_blue_tt--heightSmall",content:s,offset:[0,10],align:h.ElementTooltip.ALIGN_RIGHT,onHide:a});l.show(),i.addEventListener("mouseenter",(()=>{l.hide()}))}(e,r)}C(!1)},onFail:function(t){return t&&new g.MessageBox({title:p.getLang("global_error")}).content(t).setButtons(p.getLang("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,o.removeClass)(e,"audio_row__added"),C(!1),!0}}),(0,o.addClass)(e,"audio_row__added"),D&&(0,o.addClass)(D,"audio_row__added"),(0,a.getAudioPlayer)().notify(n.events.ADDED,t.fullId),b&&O&&b.onUserAction(t,O);else{const i=()=>{C(!1)};if(S){if("added"==S.state){const s=()=>{(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_REMOVED,trackCode:t.trackCode});const i=(0,a.getAudioPlayer)();i&&(i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,L?-L:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(S.addedFullId),i.notify(n.events.MUSIC_AUDIOS_DELETE,t,{audioElement:e})),C(!1)};T.deleteFx({identity:{id:t.id,ownerId:window.vk.id,accessKey:t.accessKey}}).then(s).catch(i),(0,o.removeClass)(e,"audio_row__added"),D&&(0,o.removeClass)(D,"audio_row__added"),delete M[t.fullId],(0,a.getAudioPlayer)().notify(n.events.REMOVED,t.fullId,S.addedFullId)}}else{const s=i=>{(0,u.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:t.trackCode}),M[t.fullId]={state:"added",addedFullId:(0,m.getAudioFullId)({ownerId:i.ownerId,id:i.id}),audio:{}},(0,a.getAudioPlayer)().notify(n.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),C(!1)};T.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:window.vk.id}).then(s).catch((()=>{(0,o.removeClass)(e,"audio_row__added"),i()})),(0,o.addClass)(e,"audio_row__added"),D&&(0,o.addClass)(D,"audio_row__added"),(0,a.getAudioPlayer)().notify(n.events.ADDED,t.fullId),b&&O&&b.onUserAction(t,O)}}}},485739:(e,t,i)=>{i.d(t,{toggleAudioLyrics:()=>a});var o=i(452314),s=i(671300);function a(e,t){let i=(0,o.geByClass1)("_audio_row__lyrics",e);if(i){if((0,o.toggle)(i)){let t=(0,o.getSize)(e)[1],s=(0,o.getSize)(i)[1];(0,o.setStyle)(e,"height",t+s),(0,o.data)(e,"prevHeight",t)}else{let t=(0,o.data)(e,"prevHeight");(0,o.setStyle)(e,"height",t)}}else{(0,o.addClass)(e,"audio_loading");const a={act:"get_lyrics",aid:t.fullId,lid:t.lyrics};s.AudioUtils.isPodcast(t)&&(a.podcast=!0),ajax.post("al_audio.php",a,{onDone:function(a){(0,o.removeClass)(e,"audio_loading"),i=(0,o.se)(`<div class="_audio_row__lyrics audio_row__lyrics" data-nodrag="1" style="display:none;"><div class="audio_row__lyrics_inner">${a}</div></div>`),(0,o.geByClass1)("_audio_row_content",e).appendChild(i),s.AudioUtils.toggleAudioLyrics(e,t)},onFail:()=>!0})}}},262144:(e,t,i)=>{i.d(t,{unclaim:()=>l});var o=i(452314),s=i(217944),a=i(735477);function l(e,t,i){(0,o.removeClass)(t,"audio_moder_claimed"),(0,s.onRowOver)(t,!1,!0),e=(0,a.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_unclaim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId,hash:e.actionHash})}},93403:(e,t,i)=>{i.d(t,{initUpload:()=>h});var o=i(452314),s=i(671300),a=i(714209),l=i(240515),r=i(610989),n=i(850101),d=i(879007),u=i(387674),_=i(476726),c=i(490712);function h(e,t,i,h,p,y,A,g,P,f,m,E){cur.loadAudioDone=function(t,i){if(cur.audioPage){if(cur.boxClose&&cur.audioPage.onAudioAllUploaded(),cur.audioPage.onAudioUploaded(t,i),cur.boxClose){delete cur.boxClose;let t=cur.audiosLoaded>1?r.getLang("audio_success_msg_multiple"):r.getLang("audio_success_msg");e.setOptions({title:r.getLang("audio_uploading_over"),bodyStyle:"padding: 16px 23px;"}),e.content(t),(0,o.hide)(e.progress),setTimeout((function(){e.hide(200)}),2e3),delete cur.audiosLoaded,_tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],(0,l.globalHistoryDestroy)(_tbLink.loc))}}else cur.boxClose&&nav.go("/audios"+i[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],!1,{onDone(){cur.__phinputs=cur.__phinputs||[],(0,l.globalHistoryDestroy)(nav.objLoc[0])}})},cur.loadAudioFailed=function(i,s){(0,o.hide)(e.progress),Upload.embed(i);let a=(0,o.ge)("audio_new_error"),l=a&&(0,o.domFC)(a),n=s.split("|");if(!l)return;s=n[0],n=n[1];let u=(0,d.intval)(s);(0,_.partConfigEnabled)("audio_show_upload_real_error_code")&&(u=s),(0,c.statlogsValueEvent)("load_audio_failed_code",u),l.innerHTML=n||(t[s]||r.getLang("audio_loading_error").replace("{code}",u)),(0,o.show)(a)},Upload.init("audio_add_upload_btn",i,h,{file_name:"file",file_size_limit:p,file_types_description:"Audio files (*.mp3)",file_types:"*.mp3;*.MP3",accept:"audio/mpeg",lang:y,onUploadStart:function(t,i){"form"===Upload.types[t]&&(0,o.show)(e.progress),"form"!==Upload.types[t]&&"fileApi"!==Upload.types[t]||((0,o.geByClass1)("file",(0,o.ge)("audio_add_upload_btn")).disabled=!0),(0,n.curBox)().changed=!0},onUploadProgress:function(e,t,i){if(!(0,o.ge)("form"+e+"_progress")){let t=Upload.obj[e],i=(0,o.getSize)(t)[1]/2+10,s=t.firstChild;for(;s;)1===s.nodeType&&(s.id==="uploader"+e&&a.browser.msie?(0,o.setStyle)(s,{position:"relative",left:"-5000px"}):(0,o.setStyle)(s,{visibility:"hidden"})),s=s.nextSibling;t.appendChild((0,o.ce)("div",{innerHTML:'<div class="audio_progress_wrap"><div id="form'+e+'_progress" class="audio_progress" style="width: 0%;"></div></div></div>'},{height:i+"px",marginTop:-i+"px"}))}let s=(0,d.intval)(t/i*100);(0,o.setStyle)((0,o.ge)("form"+e+"_progress"),{width:s+"%"})},onUploadComplete:function(e,t){let i;this.use_go_uploader||(t=t.replace(/\+/g," "));try{i=JSON.parse(t)}catch(e){i=(0,u.fromQueryString)(t)}let o={};this.use_go_uploader?o={act:"done_add",upldr:1,go_uploader_response:t}:(i.title=decodeURIComponent(i.title),i.artist=decodeURIComponent(i.artist),o={...i,act:"done_add",upldr:1}),i.code?cur.loadAudioFailed(e,i.code):ajax.post("al_audio.php",o,{onDone:function(t){cur.loadAudioDone(e,t)},onFail:function(t){return cur.loadAudioFailed(e,t),!0}})},onUploadCompleteAll:function(e,t){cur.boxClose=!0},onUploadError:cur.loadAudioFailed,clear:1,multiple:1,force_max_files:!0,max_files:A,max_files_hide_last:1,type:"audio",max_attempts:3,reverse_files:1,server:g,error:P,error_hash:f,dropbox:"choose_audio_dropbox",use_go_uploader:E}),e.setControlsText(m)}},916654:(e,t,i)=>{i.d(t,{getUMAInfo:()=>s});var o=i(20025);function s(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions",id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{width:1e3}})}},862059:(e,t,i)=>{i.d(t,{getUMAInfoAlbum:()=>s});var o=i(20025);function s(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e},{params:{width:750}})}},671300:(e,t,i)=>{i.d(t,{AudioUtils:()=>He});var o=i(59052),s=i(182720),a=i(485739),l=i(807558),r=i(217944),n=i(922107),d=i(472128),u=i(706039),_=i(890482),c=i(779016),h=i(521183),p=i(806398),y=i(448909),A=i(108687),g=i(965210),P=i(950783),f=i(80959),m=i(790683),E=i(310666),w=i(33594),v=i(134931),I=i(669862),C=i(747587),b=i(273570),T=i(494483),k=i(895749),L=i(703261),M=i(190168),S=i(989904),D=i(538157),O=i(72023),x=i(19260),R=i(815958),U=i(289882),B=i(145608),N=i(888658),F=i(486686),j=i(159076),W=i(656296),K=i(940242),$=i(318921),H=i(492460),Y=i(618640),V=i(863431),Q=i(567005),G=i(694581),q=i(804001),X=i(57599),z=i(261362),J=i(365224),Z=i(735477),ee=i(965416),te=i(198155),ie=i(891332),oe=i(938450),se=i(706449),ae=i(262144),le=i(916654),re=i(862059),ne=i(682174),de=i(573931),ue=i(448818),_e=i(104479),ce=i(944762),he=i(668089),pe=i(950911),ye=i(339330),Ae=i(476689),ge=i(697034),Pe=i(629577),fe=i(173236),me=i(818094),Ee=i(508541),we=i(852435),ve=i(728664),Ie=i(637653),Ce=i(659940),be=i(202775),Te=i(367702),ke=i(701785),Le=i(68998),Me=i(93403),Se=i(965428),De=i(783159),Oe=i(393641),xe=i(149143),Re=i(244579),Ue=i(454785),Be=i(523186),Ne=i(668592),Fe=i(746964),je=i(391111),We=i(866953),Ke=i(160785),$e=i(731302);const He={...o.AUDIO_PLAYER_ENUMS,audioSearchPerformer:s.audioSearchPerformer,toggleAudioLyrics:a.toggleAudioLyrics,getRowActionName:l.getRowActionName,initRowPlaylistsChooser:_.initRowPlaylistsChooser,addToPlaylistsBoxInit:c.addToPlaylistsBoxInit,showRecoms:h.showRecoms,shareAudio:p.shareAudio,showAudioAlbum:y.showAudioAlbum,openEpisode:A.openEpisode,replaceWithOriginal:g.replaceWithOriginal,editAudio:P.editAudio,editEpisode:f.editEpisode,deleteCurrentAudio:m.deleteCurrentAudio,deleteAudio:E.deleteAudio,deleteEpisode:w.deleteEpisode,restoreEpisode:v.restoreEpisode,deleteDeletedAudios:I.deleteDeletedAudios,faveEpisode:C.faveEpisode,contextSplit:b.contextSplit,showAudioPlaylist:T.showAudioPlaylist,setAudioLastListRefCookieDebounced:k.setAudioLastListRefCookieDebounced,editPlaylist:S.editPlaylist,followPlaylist:D.followPlaylist,openPlaylistOwner:O.openPlaylistOwner,onPlayNextPlaylist:x.onPlayNextPlaylist,onPlayPlaylistShuffled:R.onPlayPlaylistShuffled,onSharePlaylistClick:U.onSharePlaylistClick,getAudioTrackCodeFromPlaylist:B.getAudioTrackCodeFromPlaylist,getLayer:N.getLayer,updateQueueReceivedPost:F.updateQueueReceivedPost,toggleAudioHQBodyClass:j.toggleAudioHQBodyClass,hasAudioHQBodyClass:W.hasAudioHQBodyClass,getAddRestoreInfo:K.getAddRestoreInfo,getPlaylistAddRestoreInfo:$.getPlaylistAddRestoreInfo,toggleAddAudio:H.toggleAddAudio,addAudioToOwner:Y.addAudioToOwner,chooseAudioBox:V.chooseAudioBox,getAudioArtistsString:Q.getAudioArtistsString,getAudioPerformers:G.getAudioPerformers,drawAudio:q.drawAudio,isClaimedAudio:X.isClaimedAudio,getDurationMod:q.getDurationMod,getAudioExtra:Ne.getAudioExtra,mergeAudioExtra:Fe.mergeAudioExtra,getAudioFromEl:z.getAudioFromEl,getAudioFullId:J.getAudioFullId,audioTupleToAudioObject:Z.audioTupleToAudioObject,initDomPlaylist:ee.initDomPlaylist,getContextPlaylist:te.getContextPlaylist,renderAudioDiag:oe.renderAudioDiag,claim:se.claim,unclaim:ae.unclaim,getUMAInfo:le.getUMAInfo,getUMAInfoAlbum:re.getUMAInfoAlbum,showAudioInfo:ne.showAudioInfo,cancelReplacement:de.cancelReplacement,removeFromGroup:ue.removeFromGroup,addToGroupBox:_e.addToGroupBox,showAudioRestriction:fe.showAudioRestriction,isPodcast:ce.isPodcast,isArticleTts:he.isArticleTts,isRadio:je.isRadio,isExternalStream:We.isExternalStream,isMarusiaTrack:pe.isMarusiaTrack,isMarusiaTale:ye.isMarusiaTale,isPrivatePodcast:Ae.isPrivatePodcast,followArtist:we.followArtist,unfollowArtist:ve.unfollowArtist,followCurator:Ie.followCurator,unfollowCurator:Ce.unfollowCurator,followOwner:be.followOwner,unfollowOwner:Te.unfollowOwner,trackArtistToOfficial:ke.trackArtistToOfficial,PodcastsLogs:ge,copyAudioLink:$e.copyAudioLink,copyAudioLinkByIdentity:Ke.copyAudioLinkByIdentity,copyPlaylistLink:Pe.copyPlaylistLink,getAlbumParts:me.getAlbumParts,drawAlbumPartRow:Ee.drawAlbumPartRow,onRowOver:r.onRowOver,onRowLeave:n.onRowLeave,onAudioAddedToPlaylist:d.onAudioAddedToPlaylist,onAudioChoose:L.onAudioChoose,onPlaylistChoose:M.onPlaylistChoose,claimPlaylist:Le.claimPlaylist,initUpload:Me.initUpload,turnPlaylistDiscover:Se.turnPlaylistDiscover,hidePlaylistFromRecoms:De.hidePlaylistFromRecoms,showPlaylistInRecoms:Oe.showPlaylistInRecoms,hideCatalogBlock:xe.hideCatalogBlock,mergeAudioTupleWithoutContext:Re.mergeAudioTupleWithoutContext,followRadiostation:Ue.followRadiostation,unfollowRadiostation:Be.unfollowRadiostation,_showPlaylistsChooser:u.showPlaylistsChooser,debugLog:ie.debugLog}},958739:(e,t,i)=>{i.d(t,{connectListenQueue:()=>A});var o=i(349091),s=i(671300),a=i(327527),l=i(20025),r=i(596793),n=i(476726);const d=3e4;let u=null,_=null,c=!1,h=0;const p=new o.WebQueueListener((function(e){if(e.failed)return void A(!0);const t=(0,a.getAudioPlayer)(),i=t.isPlaying(),o=t.getCurrentAudio(),r=s.AudioUtils.isPodcast(o);for(let o=0;o<e.events.length;o++){let s=e.events[o].data;if("start"===s.type&&AudioPlayer.getDeviceId()!==s.uuid&&!_&&!r&&i){t.pausedByQueue=Date.now(),t.pause(),_=(0,l.showBox)("al_audio.php",{act:"start_playback_box",uuid:s.uuid,device_name:s.device_name},{params:{hideButtons:!0,onHide:()=>{_=!1}},containerClass:"audio_playback_box"});break}}})),y=new o.WebQueueListener((function(e){e.events.length&&e.events.forEach((e=>{1===e.data.product_id&&(vk.audioAdsConfig.enabled=!e.data.active)}))}));function A(e){if(!window.Notifier||!vk.id)return;let t=window.ap&&(0,a.getAudioPlayer)(),i=t&&t.getCurrentAudio(),o=window.Notifier&&!vk.widget,l=!c&&i?p.listenQueueKey:y.listenQueueKey,_=s.AudioUtils.isPodcast(i);(e||o&&!_&&!l)&&(i||(0,n.partConfigEnabled)("audio_subscription_update"))&&(i=i?s.AudioUtils.audioTupleToAudioObject(i):{},function(e={},t=(()=>{}),i=(()=>!0)){ajax.post("al_audio.php",{act:"queue_params",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{onDone:t,onFail:i})}(i,(e=>{const t=function(e){const t=(0,r.unpackQueues)(e);t.audio&&p.connect(t.audio);t.subscription&&y.connect(t.subscription);return t}(e);c=!i||!t.audio,(t.audio||t.subscription)&&(u&&clearTimeout(u),u=window.setTimeout((()=>A(!0)),d))}),(()=>(h++,h<3&&A(!0),!0))))}},273570:(e,t,i)=>{i.d(t,{contextSplit:()=>s});var o=i(7144);function s(e){return(0,o.isObject)(e)&&(e=e.context),(e||"").split(":")}},891332:(e,t,i)=>{function o(){}i.d(t,{debugLog:()=>o})},968308:(e,t,i)=>{i.d(t,{getContext:()=>a});var o=i(198155),s=i(273570);function a(e){const t=window.currentAudioPage&&window.currentAudioPage(e),i=t&&t.getPageCurrentPlaylist();let a,l=(0,o.getContextPlaylist)(e,!0);return l&&(l=(0,s.contextSplit)(l),Array.isArray(l)&&l.length>0&&(a=l[0])),("search"===a&&i&&i.getSearchQid()||"search"===window.cur.module&&window.cur.qid)&&(a="search:external"),a}},888658:(e,t,i)=>{function o(){let e=window.audioLayer;return e||(window.audioLayer=e=new AudioLayer),e}i.d(t,{getLayer:()=>o})},703544:(e,t,i)=>{i.d(t,{getPlaylistUrl:()=>s});var o=i(388078);function s(e,t,i,s=!1){const a=`/music/${o.Ranges.isOfficialPlaylist(e)?"album":"playlist"}/${e}_${t}${i?`_${i}`:""}`;return s?`${location.protocol}//${location.host}${a}`:a}},682174:(e,t,i)=>{i.d(t,{showAudioInfo:()=>a});var o=i(859887),s=i(850101);function a(e,t,i){if(!t.showInfo)return;if(e.dataset.showedInfo)return;e.dataset.showedInfo=!0;const a=t.performer.split("], "),l=a.length>1?a[1]:a[0],r=encodeURI(l+" - "+t.title),n=`<a href="/search?c[section]=audio&c[q]=${r}" target="_blank">Найти VK</a>`,d=`<a href="${t.adminUrl}?act=audio&raw_id=${t.fullId}" target="_blank">Admin</a>`,u=`<a href="${t.adminUrl}?act=matched_segments_visualization&full_id=${t.fullId}" target="_blank">M4</a>`,_=`<a href="/away.php?to=${encodeURIComponent(t.umaQueryUrl+"?query="+r)}" target="_blank">Найти UMA</a>`,c=document.createElement("div");c.classList.add("AudioInfo__container"),c.innerHTML=" • "+_+" • "+n+" • "+d+" • "+u,c.style.fontSize="x-small",i&&c.classList.add("AudioInfo__container--secondary");const h=document.createElement("span");h.innerText="ID: "+t.fullId,h.classList.add("AudioInfo__copyLink"),h.onclick=e=>{(0,o.copyTextToClipboard)(t.fullId).then((()=>{(0,s.showDoneBox)("ID аудиозаписи скопирован в буфер обмена")}))},e.parentElement.insertBefore(c,e.nextSibling),c.prepend(h)}},996538:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AUDIO_LAYER_CONTAINER_CLASS_NAME:()=>AUDIO_LAYER_CONTAINER_CLASS_NAME,default:()=>AudioLayer});var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(618913),_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(723561),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(452314),_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(486848);const AUDIO_LAYER_CONTAINER_CLASS_NAME="audio_layer_container";class AudioLayer{static prepare(e){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/suggester.js"),window.jsc("web/auto_list.js"),window.jsc("web/indexer.js")],(()=>{e&&e()}))}toggle(e,t){this._initTooltip();let i=this._els.tooltip,o=void 0!==e?e:!i.isShown();o&&this.initPage(),o?(i.show(),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_3__.cancelStackPush)("top_audio",(()=>{this.toggle(!1,!0)}),!0)):(t||(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_3__.cancelStackPop)(),i.hide()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(this._els.topNotaBtn,"TopNavBtn--active",o)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.layerPlace),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)("ts_wrap")[0]-e[0]-1,i=0;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(this._els.topNotaBtnGroup)){i=-t+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.topNotaBtn)[0]-e[0])+15}else{i=-t+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.topPlayBtn)[0]-e[0])+3}return{left:t,top:-1,arrowPosition:i}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="${AUDIO_LAYER_CONTAINER_CLASS_NAME}">\n        <div class="top_audio_loading">\n          ${(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.se)(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}))}initPage(){this._page||((0,_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_2__.ensureAutoplayService)().init(),ajax.post("al_audio.php",{act:"layer",is_layer:1,section:window.ap.getCurrentPlaylist()?"current":"all"},{onDone:(html,data,templatesScript)=>{if(this._els.tooltip.isShown()){try{eval(templatesScript)}catch(e){(0,_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.logEvalError)(e,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_audio_page_layout",this._els.container),data),this._initSection=data.initSection||void 0,this._page.onLayerShow(this._initSection)}},onFail:()=>!0}))}constructor(){this._els={layerPlace:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.ge)("top_audio_layer_place"),topPlayBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_top_audio_player_play"),topNotaBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("TopNavBtn__audio"),topNotaBtnGroup:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.ge)("top_audio_btn_group")}}}},13709:(e,t,i)=>{i.d(t,{AudioPlayer:()=>pe});var o=i(264544),s=i(327813),a=i(689938),l=i(314710),r=i(214450),n=i(572466),d=i(121092),u=i(671300),_=i(714209),c=i(839094),h=i(927984),p=i(610989),y=i(618913),A=i(7144),g=i(20025),P=i(490712),f=i(317412),m=i(178487),E=i(850101),w=i(772546),v=i(879007),I=i(620626),C=i(434487),b=i(452314),T=i(148818),k=i(260007),L=i(280357),M=i(620407),S=i(836901),D=i(603354),O=i(514640),x=i(418562),R=i(109465),U=i(561418),B=i(735477),N=i(188143),F=i(623702),j=i(625330),W=i(958739),K=i(803898),$=i(591060),H=i(244579),Y=i(365224),V=i(476726),Q=i(33362),G=i(253693),q=i(609116),X=i(807635),z=i(527966),J=i(59052),Z=i(504952),ee=i(391111),te=i(777725),ie=i(560631),oe=i(153208),se=i(668089),ae=i(624107),le=i(118415),re=i(836681),ne=i(302495),de=i(382399),ue=i(122611),_e=i(327527);let ce={};const he=(0,K.throttledPromise)((()=>{}),1500,!0);class pe{static getVersion(){return 15}static _sendLCNotification(){const e=window.Notifier;e&&e.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}}static showHQLabel(e){return void 0===e?!!pe._lsGet(pe.LS_SHOW_HQ_LABEL):(e=!!e,pe._lsSet(pe.LS_SHOW_HQ_LABEL,e),u.AudioUtils.toggleAudioHQBodyClass(),e)}static getAudioElementsByAudioId(e,t){return(0,b.geByClass)(`_audio_row_${e}`,t)}static getDeviceId(){let e=pe._lsGet(pe.LS_UUID);return e||(e=(0,x.default)(),pe._lsSet(pe.LS_UUID,e)),e}static showSubscriptionPopup(){(0,g.showBox)("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return pe._lsGet(pe.LS_DURATION_TYPE)}static _setTabIcon(e){(0,c.setFavIcon)(pe.tabIcons[e])}static _getLsFullKey(e){return`${pe.LS_PREFIX}${e}_${vk.id}`}static _lsGet(e){return ls.get(pe._getLsFullKey(e))}static _lsSet(e,t){return ls.set(pe._getLsFullKey(e),t)}static _lsRemove(e){return ls.remove(pe._getLsFullKey(e))}static _podcastGetStates(){return(pe._lsGet(pe.LS_PODCASTS)||ce).states||{}}static _podcastSetStates(e){const t=pe._lsGet(pe.LS_PODCASTS)||ce;t.states=e,pe._lsSet(pe.LS_PODCASTS,t),ce=t}static podcastToggleFave(e,t){if(!t)return;t=u.AudioUtils.audioTupleToAudioObject(t);const i=u.AudioUtils.getAudioExtra(t).faveHash;i&&window.bookmarkPodcast(e,t.fullId,i)}static podcastGetPlaybackRate(){return(pe._lsGet(pe.LS_PODCASTS)||ce).rate||1}static getLang(e){const t=(0,_e.getAudioPlayer)();return t&&t.langs?t.langs[e]:e}static clearDeprecatedCacheKeys(){pe._iterateCacheKeys((e=>e===pe.LS_VER))}static clearOutdatedCacheKeys(){(pe._lsGet(pe.LS_SAVED)||0)<(0,A.vkNow)()-72e5&&pe._iterateCacheKeys(((e,t)=>!(0,v.inArray)(t,[pe.LS_PL,pe.LS_TRACK,pe.LS_PROGRESS])))}getCurrentAudioLs(){return ap.getCurrentAudio()||pe._lsGet(pe.LS_TRACK)||null}static clearAllCacheKeys(){pe._iterateCacheKeys((()=>!1)),(0,w.setCookie)("remixcurr_audio","",-1)}static _iterateCacheKeys(e){F.vkLocalStorage.getPrefixedKeys(`${pe.LS_KEY_PREFIX}_`).forEach((t=>{const[,i,o]=t.split("_");e(i,o)||F.vkLocalStorage.removeItem(o)}))}_initImpl(){this._impl&&this._impl.destroy();let e=0,t=!1;const i=t=>{if(-1===e)return;if(t&&(e++,this.implTaskManager.delay(200),e>3)){e=-1;const t=new window.MessageBox({title:p.getLang("global_error")}).content(p.getLang("audio_error_loading")).setButtons("Ok",(function(){e=0,(0,E.curBox)().hide()}));return t.show(),(0,S.setWorkerTimeout)((function(){e=0,t.hide()}),3e3),this.notify(O.events.ENDED),void this.notify(O.events.FAILED)}const i=this.getCurrentAudio(),o=this.getCurrentAudioData();if(u.AudioUtils.isPodcast(i))this.setIsPlaying(!1),this.notify(O.events.PAUSE),this.notify(O.events.ENDED),this.stop();else if(this._repeatCurrent)this._autoNext=!0,this.notify(O.events.ENDED),this.notify(O.events.PROGRESS,0),this.implTaskManager.seekImmediate(0),(0,S.setWorkerTimeout)((()=>{this._impl&&this._impl.clearAudioNode&&(o&&this.emitter.emit("stopAudio",{reason:t?ue.AudioPlayerStopAudioEventReason.Error:ue.AudioPlayerStopAudioEventReason.Repeat,audio:o,progressTime:this.getCurrentProgressTime()}),this._impl.stop(),o&&this.emitter.emit("playAudio",{reason:ue.AudioPlayerPlayAudioEventReason.Repeat,audio:o,progressTime:0}),this._implSetUrl(i)),this._implPlay()}));else{if(this.setIsPlaying(!1),o){let e;e=t?ue.AudioPlayerStopAudioEventReason.Error:this.ads.isActive?ue.AudioPlayerStopAudioEventReason.Adv:ue.AudioPlayerStopAudioEventReason.QueueContinuation,this.emitter.emit("stopAudio",{reason:e,audio:o,progressTime:this.getCurrentProgressTime()})}this.notify(O.events.ENDED),this._playNextMarked({auto:!0,reason:t?ue.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError:ue.AudioPlayerPlayAudioEventReason.QueueContinuation})}},o={onPause:()=>{this.setIsPlaying(!1),this.setIsPaused(!0),this.notify(O.events.PAUSE),t=!1,this.switchConnection.emit("pause")},onPlay:()=>{this.setIsPaused(!1),this.setIsPlaying(!0),this.setVolume(this.getVolume()),this.notify(O.events.PLAY),t=!1,this.switchConnection.emit("play")},onBufferUpdate:e=>{this.notify(O.events.BUFFERED,e)},onEnd:i,onFail:()=>{this._sendPlayerErrorStats(this._impl),i(!0)},onCanPlay:()=>this.notify(O.events.CAN_PLAY),onProgressUpdate:(e,i)=>{const o=this.getCurrentAudio();if(this._muteProgressEvents||!o)return;const s=this._impl.getDuration()||o[u.AudioUtils.AUDIO_ITEM_INDEX_DURATION];this.notify(O.events.PROGRESS,e,s,i),!vk.id&&s-i<pe.UNAUTH_FADE_TIME&&!t&&(t=!0,this.fadeOut(1e3*pe.UNAUTH_FADE_TIME))},onFrequency:e=>{this.notify(O.events.FREQ_UPDATE,e)},defaultVolume:this._userVolume};this._impl=new M.AudioPlayerHTML5(o),this.implTaskManager=new j.AudioTaskManager(this._impl),this.implTaskManager.setVolume(0)}get nextEvents(){return this.emitter.listenable}get events(){return this.nextEvents}fadeIn(e=300){this.implTaskManager.setVolume(this.getVolume(),!0,e)}fadeOut(e=300){this.implTaskManager.setVolume(0,!0,e)}onMediaKeyPressedEvent(e){if(this.getCurrentAudio())switch(e.keyCode){case 179:this.isPlaying()?this.pauseByButton():this.playByButton();break;case 178:this._stopAudio({reason:ue.AudioPlayerStopAudioEventReason.Unknown}),this._seek({amount:0});break;case 177:this.playPrevByButton();break;case 176:this.playNextByButton()}}setAdsConfig(e){this.ads&&this.ads.setAdsConfig(e)}deletePlaylist(e){for(let t=0;t<this._playlists.length;t++)this._playlists[t]===e&&this._playlists.splice(t,1)}mergePlaylistData(e,t){this._playlists.forEach((i=>{i.getId()===e.getId()&&i.getOwnerId()===e.getOwnerId()&&(i.hasMore()?i.mergeWith(t):i.mergeInfo(t))}))}deleteCurrentPlaylist(){const e=(0,V.partConfigEnabled)("audio_player_stats_web")||(0,V.partConfigEnabled)("audio_my_tracker_web");e&&this.stop(ue.AudioPlayerStopAudioEventReason.Clear),this.getPlaylistQueue().removeSortedList(),this._currentAudio=null,this.setCurrentPlaylist(null),this.notify(O.events.UPDATE),this.notify(O.events.PLAYLIST_CHANGED),e||this.stop(ue.AudioPlayerStopAudioEventReason.Clear),this.updateCurrentPlaying()}updateCurrentPlaying(e){e=!!e;const t=u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());let i=[];if(t){const e=(0,b.geByClass)("_audio_row_"+t.fullId);i=i.concat([].slice.call(e))}const o=document.querySelectorAll(".AudioRadiostationItem"),s=(0,ee.isRadio)(t)&&this.isPlaying();Array.from(o).forEach((e=>{e.classList.toggle("AudioRadiostationItem--playing",s&&parseInt(e.dataset.id)===t.id)}));for(let t=0,o=this._currentPlayingRows.length;t<o;t++){const o=this._currentPlayingRows[t];o&&!(0,v.inArray)(o,i)&&this.toggleCurrentAudioRow(o,!1,e)}if(t)for(let t=0,o=i.length;t<o;t++){const o=i[t];if(o){if((0,b.gpeByClass)("article_editor_canvas",o))continue;this.toggleCurrentAudioRow(o,!0,e)}}this._currentPlayingRows=i,(0,v.each)((0,b.geByClass)("_audio_pl"),((e,t)=>(0,b.removeClass)(t,"audio_pl__playing")));const a=this.getCurrentPlaylist();if(this.isPlaying()&&a){const e=(0,b.geByClass)(`_audio_pl_${a.getOwnerId()}_${a.getPlaylistId()}`);e&&(0,v.each)(e,((e,t)=>(0,b.addClass)(t,"audio_pl__playing")))}}scrollToCurrentPlaying(e,t){const i=pe.getAudioElementsByAudioId(e);window.AudioPage&&i.forEach((e=>{const i=window.currentAudioPage(e);if(i&&i._scroll){const e=i.getCurrentSectionEl()||i.getPageContainer();pe.getAudioElementsByAudioId(t,e).length||i.drawMore(),i.scrollIntoView(pe.getAudioElementsByAudioId(t,e)[0],150)}}))}toggleCurrentAudioRow(e,t,i){const o=u.AudioUtils.getAudioFromEl(e,!0);(0,b.addClass)(e,u.AudioUtils.AUDIO_CURRENT_CLS),o.withInlinePlayer&&(0,b.toggleClass)(e,"audio_row__player_transition",i),(i=!!o.withInlinePlayer&&i)?setTimeout((()=>this._updateAudioEl(t,e,o,i)),0):this._updateAudioEl(t,e,o,i)}_updateAudioEl(e,t,i,o){const s=(0,b.geByClass1)("_audio_row__play_btn",t),a=(0,b.geByClass1)("_audio_row__title",t),l=(0,b.geByClass1)("_audio_row__duration",t);let r=u.AudioUtils.getDurationMod(e?i.duration:i.duration*this.getCurrentProgress());e&&t&&!1===this.isPlaying()&&((0,b.removeClass)(t,"audio_row__playing"),s&&(0,b.attr)(s,"aria-label",p.getLang("global_audio_play")),a&&(0,b.attr)(a,"role",""));let n=(e,t="")=>{if(l){let i=u.AudioUtils.getDurationMod(e);l.innerHTML=t+(0,m.formatTime)(e),i!==r&&((0,b.replaceClass)(l,u.AudioUtils.AUDIO_DURATION_CLS+"-"+r,u.AudioUtils.AUDIO_DURATION_CLS+"-"+i),r=i)}};if(i.withInlinePlayer&&(e?this._addRowPlayer(t):this._removeRowPlayer(t)),e){this.on(t,[O.events.PLAY,O.events.PLAY_REQUESTED],(e=>{u.AudioUtils.audioTupleToAudioObject(e).fullId===i.fullId&&((0,b.addClass)(t,u.AudioUtils.AUDIO_PLAYING_CLS),s&&(0,b.attr)(s,"aria-label",p.getLang("global_audio_pause")),a&&(0,b.attr)(a,"role","heading"))})),this.on(t,O.events.PROGRESS,((e,t,o)=>{if(!i.withInlinePlayer&&this.ads.isActive)return void n(i.duration);o=parseInt(o);let s=0,a="";pe.getDurationType()?(s=Math.round(o-t*o),a="-"):s=Math.round(t*o),n(s,a)}));let e=(0,b.data)(t,"bars");if(!e&&(i.isWithCovers||i.isNumeric||i.isPodcastListSnippet)){if(e=(0,b.se)('<canvas class="audio_row__sound_bars"></canvas>'),i.isPodcastListSnippet?(0,b.geByClass1)("podcast_list_snippet__cover",t).appendChild(e):t.appendChild(e),e.width=u.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,A.isRetina)()?2:1),e.height=u.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,A.isRetina)()?2:1),e.style.width=u.AudioUtils.AUDIO_ROW_COVER_SIZE,e.style.height=u.AudioUtils.AUDIO_ROW_COVER_SIZE,(0,A.isRetina)()){e.getContext("2d").scale(2,2)}const o=getComputedStyle(e).color;this.on(t,O.events.FREQ_UPDATE,((t,i)=>ye(e,i,o))),ye(e,[0,0,0,0],o),(0,b.data)(t,"bars",e)}(0,b.toggleClass)(t,u.AudioUtils.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(t),(0,b.removeClass)(t,u.AudioUtils.AUDIO_PLAYING_CLS),(0,b.removeClass)(t,u.AudioUtils.AUDIO_CURRENT_CLS),n(i.duration),s&&(0,b.attr)(s,"aria-label",p.getLang("global_audio_play")),a&&(0,b.attr)(a,"role","");let e=(0,b.data)(t,"bars");e&&((0,b.re)(e),(0,b.data)(t,"bars",null))}o?setTimeout((()=>{const e=u.AudioUtils.getAudioFromEl(t,!0);(0,b.toggleClass)(t,u.AudioUtils.AUDIO_CURRENT_CLS,!!e.isCurrent)}),0):(0,b.toggleClass)(t,u.AudioUtils.AUDIO_CURRENT_CLS,e)}_removeRowPlayer(e){(0,b.removeClass)(e,u.AudioUtils.AUDIO_CURRENT_CLS);const t=(0,b.data)(e,"player_inited");if(!t)return;setTimeout((()=>(0,b.re)((0,b.geByClass1)("_audio_inline_player",e))),200);const i=(0,b.geByClass1)("_audio_duration",e);i&&(i.innerHTML=(0,m.formatTime)(u.AudioUtils.getAudioFromEl(e,!0).duration)),this.off(e),(0,v.each)(t.sliders,((e,t)=>t.destroy())),(0,b.data)(e,"player_inited",!1);const o=(0,b.geByClass1)("has_audio_player",e);o&&(0,b.removeClass)(o,"has_audio_player")}_addRowPlayer(e){if((0,b.geByClass1)("_audio_inline_player",e)||(0,b.hasClass)(e,"podcast_list_snippet")||(0,b.hasClass)(e,"podcast_snippet__controls")||(0,b.hasClass)(e,"PodcastWidget__player"))return;const t=(0,b.se)(vk.audioInlinePlayerTpl||(0,v.getTemplate)("audio_inline_player")),i=(0,b.geByClass1)("_audio_player__place",e);i.appendChild(t),(0,b.addClass)(i,"has_audio_player");const o=new window.Slider((0,b.geByClass1)("audio_inline_player_volume",t),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>this.setVolume(e)}),s=new window.Slider((0,b.geByClass1)("audio_inline_player_progress",t),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>(0,m.formatTime)(Math.round(e*this._impl.getDuration())),onEndDragging:e=>{const i=u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());i&&u.AudioUtils.isPodcast(i)&&this.podcastSetActionRef(i,u.AudioUtils.PodcastsLogs.ACTION_SEEK,"",t),this.seekBySlider(e)}});this.ads.isActive&&s.toggleAdState(!0),vk.id||s.setBlocked(!0),this.on(e,O.events.AD_DEINITED,(()=>{})),this.on(e,O.events.AD_READY,(()=>{})),this.on(e,O.events.AD_STARTED,(()=>{s.toggleAdState(!0),s.setBackValue(0)})),this.on(e,O.events.AD_COMPLETED,(()=>s.toggleAdState(!1))),this.on(e,O.events.START_LOADING,(()=>s.toggleLoading(!0))),this.on(e,O.events.CAN_PLAY,(()=>s.toggleLoading(!1))),this.on(e,O.events.BUFFERED,((e,t)=>s.setBackValue(t))),this.on(e,O.events.PROGRESS,((e,t)=>{s.toggleLoading(!1),s.setValue(t)})),this.on(e,O.events.VOLUME,((e,t)=>{o.setValue(t,!0)})),(0,b.data)(e,"player_inited",{sliders:[o,s]})}hasStatusExport(){for(let e in this._statusExport)if(this._statusExport.hasOwnProperty(e)&&this._statusExport[e])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(e,t=!1){this._statusExport=e,t&&this.setStatusExportInfoStorage(e)}setStatusExportInfoStorage(e){pe._lsSet(pe.LS_STATUS_EXPORT,e)}deleteAudioFromAllPlaylists(e){e=(0,A.isObject)(e)||(0,A.isArray)(e)?u.AudioUtils.audioTupleToAudioObject(e).fullId:e,(0,v.each)(this._playlists,((t,i)=>i.removeAudio(e))),this.getPlaylistQueue().removeAudio(e),this.saveStateCurrentPlaylist()}updateAudio(e,t){let i="";return(0,A.isString)(e)?i=e:(0,A.isArray)(e)&&(i=u.AudioUtils.audioTupleToAudioObject(e).fullId),t||(t=e),(0,v.each)(this._playlists,((o,s)=>{const a=s.getAudiosList();for(let o=0,s=a.length;o<s;o++)u.AudioUtils.getAudioFullId(a[o])===i&&(a[o]=(0,H.mergeAudioTupleWithoutContext)(e,t))})),this._currentAudio&&u.AudioUtils.getAudioFullId(this._currentAudio)===i&&(this.setCurrentAudio((0,H.mergeAudioTupleWithoutContext)(e,t)),this.notify(O.events.CURRENT_CHANGED)),this.notify(O.events.UPDATE),e}_triggerTNSPixel(){const e=pe._lsGet("tns_triggered_time_v3")||0,t=(0,A.vkNow)();t-e<864e5||(pe._lsSet("tns_triggered_time_v3",t),(0,A.vkImage)().src=`https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/${(0,A.irand)(1,1e9)}`)}_restoreVolumeState(){pe.clearDeprecatedCacheKeys(),pe.clearOutdatedCacheKeys();const e=pe._lsGet(pe.LS_VOLUME);this._userVolume=null==e||!1===e?R.DEFAULT_VOLUME:e}restoreState(){if(vk.widget)return;if(pe.clearDeprecatedCacheKeys(),pe.clearOutdatedCacheKeys(),window.cur.audioPreventRestoreTrack)return;this.setCurrentAudio(pe._lsGet(pe.LS_TRACK));let e=pe._lsGet(pe.LS_PL);if(e){e=JSON.parse(e);const t=this.hasPlaylist(e.type,e.ownerId,e.albumId);e.type===I.AudioPlaylist.TYPE_RADIO&&t?this.setCurrentPlaylist(t):(this.setCurrentPlaylist(new I.AudioPlaylist(e)),e.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=e.originalPlaylistRawId)),this.getPlaylistQueue().setSortedQueue(e.list,e.source),this._initPlayingContext(this._currentPlaylist.getContext())}this._currentPlaylist&&this._currentAudio?this.notify(O.events.UPDATE):(this.setCurrentPlaylist(null),this.setCurrentAudio(null));const t=this._currentAudio[u.AudioUtils.AUDIO_ITEM_INDEX_DURATION];let i=0;if(u.AudioUtils.isPodcast(this._currentAudio)){const e=pe._podcastGetStates(),o=`${this._currentAudio[u.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[u.AudioUtils.AUDIO_ITEM_INDEX_ID]}`;i=((e[o]||{}).position||0)/t}else i=pe._lsGet(pe.LS_PROGRESS)||0;this._currentAudio&&this._impl&&this._implSetUrl(this._currentAudio,!0).then((()=>i&&i<1?this.implTaskManager.seek(i):this.implTaskManager.setVolume(0))).then((()=>{const e=(0,N.toTrackedAudioData)(this._currentAudio);e&&this.emitter.emit("stateRestore",{audio:e,progressTime:i*t*1e3})})).catch((()=>{this.deleteCurrentPlaylist()})).finally((()=>{this.notify(O.events.CURRENT_CHANGED)})),this._updatePlaybackRate(),this._currentAudio?this.mediaFocusChannel.start():this.mediaFocusChannel.stop()}_implPlay(){const e=u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());return this.implTaskManager.play().then((()=>{if(this._muteProgressEvents=!1,this._allowPrefetchNext=!_.browser.safari,e.actionHash&&((0,W.connectListenQueue)(),ajax.post("al_audio.php",{act:"start_playback",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash,uuid:pe.getDeviceId()},{onFail:()=>!0})),u.AudioUtils.isPodcast(e)){const t=this._podcastRestoreState();this._podcastUpdateState(e,t,0,u.AudioUtils.PodcastsLogs.ACTION_PLAY)}this.notify(O.events.IMPL_PLAY)}))}_implSetUrl(e,t){this.implTaskManager.clearTask(j.TaskName.URL),t||this.notify(O.events.START_LOADING);const i=(0,B.audioTupleToAudioObject)(e);return this._ensureHasURL(i).then((e=>{if(e.url)return this.implTaskManager.setUrl(e.url).catch((()=>{this.implTaskManager.clearAllTasks(),this.notify(O.events.FAILED),this.isPlaying()&&this._playNextMarked({auto:!0,reason:ue.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError})}));throw new Error}))}toggleDurationType(){const e=pe._lsGet(pe.LS_DURATION_TYPE);pe._lsSet(pe.LS_DURATION_TYPE,!e),this.notify(O.events.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}getCurrentProgressTime(){if(this.getCurrentAudioData().type===o.AudioType.Radio)return 1e3*this.getListenedTime();const e=this.getCurrentAudio(),t=this._impl.getDuration()??e?.[u.AudioUtils.AUDIO_ITEM_INDEX_DURATION]??0;return this.getCurrentProgress()*t*1e3}_initEvents(){const e=window.Notifier;e&&(e.addRecvClbk("audio_start","audio",(()=>{this.audioPlayersSwitch.pause(),(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel()),this.pausedByVideo=null})),e.addRecvClbk(re.PreviewAudioPlayerNotification.start,"audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByPreview=Date.now())})),e.addRecvClbk(re.PreviewAudioPlayerNotification.stop,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk(re.PreviewAudioPlayerNotification.pause,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk("video_start","audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","audio",(()=>{!this.isPlaying()&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.resumeChannel(),this.pausedByVideo=null)})),e.addRecvClbk("logged_off","audio",(()=>{cur.loggingOff=!0,pe.clearAllCacheKeys(),this.stop()})),e.addRecvClbk("stories_video_start","audio",(()=>{this.isPlaying()&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByStories=(0,A.vkNow)())})),e.addRecvClbk("stories_video_end","audio",(()=>{!this.isPlaying()&&this.pausedByStories&&((0,A.vkNow)()-this.pausedByStories<18e4&&this.resumeChannel(),this.pausedByStories=null)}))),new oe.RadiostationEventsHandling}addPlaylist(e){const t=this.hasPlaylist(e.getId());t?(t.mergeWith(e.asObject()),t.getType()===I.AudioPlaylist.TYPE_RADIO&&this._currentPlaylist===t&&this.getPlaylistQueue().setSortedQueue(t.getAudiosList())):this._playlists.push(e)}_cleanUpPlaylists(){let e=0,t=-1;for(let i=this._playlists.length-1;i>=0;i--){const o=this._playlists[i];if(!o.isReference()&&(e+=o.getAudiosCount(),e>4e3)){t=i;break}}if(-1===t)return;t+=1;const i=this._playlists.slice(0,t),o=this.getCurrentPlaylist(),s=[];for(let e=0;e<i.length;e++){let a=i[e];if(o===a&&(a=!1),a&&!a.isReference())for(let e=t;e<this._playlists.length;e++){const t=this._playlists[e];t.isReference()&&t.getSelf()===a&&(a=!1)}a&&s.push(e)}for(let e=0;e<s.length;e++){const t=s[e];this._playlists.splice(t,1)}s.length&&(0,y.debugLog)("AudioPlayer - "+s.length+" playlists removed")}hasPlaylist(e,t,i,o){let s;if(o)return this._playlists.find((e=>e.getBlockId()===o||e.getAlbumId()===o))||!1;s=void 0!==t&&void 0!==i?`${e}_${t}_${i}`:e;for(let e=0;e<this._playlists.length;e++){let t=this._playlists[e];if(!t.isReference()&&t.getId()===s)return t}return!1}getPlaylistByBlockId(e){return this.hasPlaylist(null,null,null,e)||null}getPlaylistsByType(e){return this._playlists.filter((t=>t.getType()===e))||null}getPlaylist(e,t,i,o=void 0,s="",a=""){!e||t||i||([e,t,i]=I.AudioPlaylist.splitId(e));const l=this.hasPlaylist(e,t,i,s);if(l)return l.mergeWith({accessHash:o}),l;return new I.AudioPlaylist({type:e,ownerId:t,albumId:i,hasMore:e!==I.AudioPlaylist.TYPE_TEMP,accessHash:o,blockId:s})}getPlaylistQueue(){return this._playlistQueue}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||u.AudioUtils.getAudioFullId(this._currentAudio)===u.AudioUtils.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(e,t){if(vk&&vk.widget&&!vk.id&&window.Widgets)return window.Widgets.oauth(),!1;const i="audio_row__added_next";if(!(0,b.hasClass)(e,i)){(0,b.addClass)(e,i);const o=this.getCurrentPlaylist(),s=this.getPlaylistQueue();if(o){const e=u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(e&&t.fullId===e.fullId)return;const i=s.indexOfAudio(e);if(-1===i)return;this.notify(O.events.PLAY_NEXT,e.fullId,t.fullId);const o=this.getPlaylistQueue(),a=s.indexOfAudio(t);-1!==a?o.moveAudio(a,i+1):(o.addAudio((0,$.serializeAudio)(t),i+1),this.getCurrentPlaylist().pushAudio((0,$.serializeAudio)(t),i+1)),this.saveStateCurrentPlaylist()}else{const i=u.AudioUtils.getContextPlaylist(e);this._play(t,i.playlist,i.context)}const a=window.AudioPage&&window.currentAudioPage(e);if(a){const e=a.getPageCurrentPlaylist();e&&a.onUserAction(t,e)}}}on(e,t,i){(0,A.isArray)(t)||(t=[t]);const o=(...e)=>i(...e);for(const i of t)this.subscribers.push({context:e,et:i,cb:o});return()=>{this.subscribers=this.subscribers.filter((e=>e.cb!==o))}}off(e){this.subscribers=this.subscribers.filter((t=>t.context!==e))}connectEvents(){this.eventBus.precheck=e=>!!this._impl&&!(!this.ads.isActive&&this._muteProgressEvents&&(0,v.inArray)(e,[O.events.BUFFERED,O.events.PROGRESS])),this.eventBus.onAnyCallBack=(e,...t)=>this.onEvent(e,...t),this.subscribe(O.events.VOLUME,(()=>pe._lsSet(pe.LS_VOLUME,this._userVolume))),this.subscribe(O.events.PLAY_REQUESTED,(()=>{this.updateCurrentPlaying(!0),this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),pe._setTabIcon("play")})),this.subscribe(O.events.IMPL_PLAY,(()=>{this._sendStatusExport()})),this.subscribe(O.events.PLAY,(()=>{this.updateCurrentPlaying(!0),pe._setTabIcon("play")})),this.subscribe(O.events.PLAYLIST_CHANGED,(()=>{this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio()})),this.subscribe(O.events.PROGRESS,(async(e,t,i)=>{const o=this.getCurrentAudio(),s=(0,B.audioTupleToAudioObject)(o);if(this._listenedTime=i,u.AudioUtils.isPodcast(s))e&&i&&this._podcastUpdateState(s,e,i,u.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT);else if(!this.ads.isActive){let e=this._impl.getCurrentProgress();if(vk.widget||pe._lsSet(pe.LS_PROGRESS,e),!vk.widget&&this._allowPrefetchNext&&e>=.8){const e=await this.getNextAudio();e&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(e))}}})),this.subscribe(O.events.PAUSE,(()=>{this.updateCurrentPlaying(!0);const e=this.getCurrentAudio(),t=(0,B.audioTupleToAudioObject)(e);u.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),u.AudioUtils.PodcastsLogs.ACTION_PAUSE),pe._setTabIcon("pause")})),this.subscribe(O.events.SEEK,(e=>{const t=this.getCurrentAudio(),i=(0,B.audioTupleToAudioObject)(t);e.reason&&this.emitter.emit("seek",{...e,progressTime:this.getCurrentProgressTime()}),u.AudioUtils.isPodcast(i)&&this._podcastUpdateState(i,this.getCurrentProgress(),this._impl.getPlayedTime(),u.AudioUtils.PodcastsLogs.ACTION_SEEK)})),this.subscribe(O.events.ENDED,(()=>{const e=this.getCurrentAudio(),t=(0,B.audioTupleToAudioObject)(e);u.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),u.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT),window.vk&&!window.vk.widget&&!window.vk.id&&(0,V.partConfigEnabled)("audio_unauth_preview_box")&&(this.stop(),G.Unauthorized.showMoreBox(null,0,Q.UnauthorizedSourceType.AUDIO))})),this.subscribe(O.events.AD_STARTED,(()=>{const e=this.ads.getCurrentAd()?.id;e?this.emitter.emit("playAdv",{reason:ue.AudioPlayerPlayAudioEventReason.Unknown,advId:e,progressTime:this.getCurrentProgressTime()}):Ae("playAdv")})),this.subscribe(O.events.RADIOSTATION_FOLLOW,(e=>(0,ie.updateFaveStatusAfterFollow)(e,!0))),this.subscribe(O.events.RADIOSTATION_UNFOLLOW,(e=>(0,ie.updateFaveStatusAfterFollow)(e,!1)))}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}onEvent(e,t,i,o){const s=(0,V.partConfigEnabled)("audio_player_stats_web")||(0,V.partConfigEnabled)("audio_my_tracker_web");if((0,v.inArray)(e,[O.events.PLAY,O.events.PLAY_REQUESTED,O.events.PAUSE])&&(this.subscribers=this.subscribers.filter((e=>!(e.context instanceof Element)||bodyNode.contains(e.context)))),s)for(const s of this.subscribers)try{s.et===e&&s.cb(this.getCurrentAudio(),t,i,o)}finally{continue}else(0,v.each)(this.subscribers||[],((s,a)=>{a.et===e&&a.cb(this.getCurrentAudio(),t,i,o)}))}notify(e,...t){this.eventBus.emit(e,...t)}addWithReplacePlaylists(e){const t=e.reduce(((e,t)=>(e[I.AudioPlaylist.getFullIdFromData(t)]=t,e)),{}),i={};this._playlists.forEach(((e,o)=>{const s=e.getFullId();if(t[s]){this._playlists.slice(o,1);const e=t[s];new I.AudioPlaylist(e),i[s]=!0}})),Object.keys(t).forEach((e=>{i[e]||new I.AudioPlaylist(t[e])}))}_sendPlayerErrorStats(e){const t=u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!t)return;const{full_id:i}=t,o=(0,v.extend)({audio:i,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},e.getErrorData());ajax.post("al_audio.php?act=player_error_stats",o)}playLive(e,t){const i=this.getPlaylist(I.AudioPlaylist.TYPE_LIVE,vk.id,b.data[0]),o=this.getPlaylistQueue();i.mergeWith({live:e,hasMore:!1}),e=i.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:e.audioId,host_id:e.hostId,hash:e.hash},(0,v.extend)(t,{onDone:(e,t,s)=>{i.mergeWith({title:t&&t.title,list:[e]}),o.addAudio(e),this.playByButton({audio:e,livePlaylist:i,context:s})},onFail:()=>!0}))}_listenStatusExport(){window.addEventListener("storage",(e=>{if(e.key===pe.LS_PREFIX+pe.LS_STATUS_EXPORT){const e=pe._lsGet(pe.LS_STATUS_EXPORT);this.setStatusExportInfo(e),cur.audioPage&&cur.audioPage.updateStatusExportControls()}}))}_sendStatusExport(){const e=u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!e)return;const t=this.statusSent?this.statusSent.split(","):[!1,0],i=(0,A.vkNow)()-parseInt(t[1]),o=e.accessKey,s=Boolean(this.isRepeatCurrentAudio())||Boolean(this.isRepeatAll())&&1===this.getPlaylistQueue()?.length;if(this.hasStatusExport()&&!u.AudioUtils.isPodcast(e)&&(s||e.id!=t[0]||i>3e5)){const t=this.getCurrentPlaylist(),i=t?t.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:e.fullId,hash:vk.statusExportHash,top:i&&(i.top_audio||i.top)?1:0,access_key:o},{onFail:()=>!0}),0),this.statusSent=e.id+","+(0,A.vkNow)()}}saveStateCurrentPlaylist(){const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();if(vk.widget||!e||!t||(0,se.isArticleTts)(this._currentAudio))return;const i=this._getPreparePlayQueueForSaving(e,t);pe._lsSet(pe.LS_PL,i),pe._lsSet(pe.LS_SAVED,(0,A.vkNow)())}_getPreparePlayQueueForSaving(e,t){const i=e.asObject();i.type&&(i.type=I.AudioPlaylist.TYPE_TEMP);let o=this.getCurrentAudio(),s=Math.max(0,t.indexOfAudio(o));const a={...i,list:(0,v.clone)(t.list.slice(Math.max(0,s-100),s+300),!0),source:t.source};return(0,v.each)(a.list,(function(e,t){(0,ee.isRadio)(t)||(t[u.AudioUtils.AUDIO_ITEM_INDEX_URL]="")})),JSON.stringify(a)}_saveStateCurrentAudio(){if(vk.widget)return;const e=this.getCurrentAudio();if(!e||(0,se.isArticleTts)(e))pe._lsSet(pe.LS_TRACK,null),(0,w.setCookie)("remixcurr_audio",null,1);else{const t=(0,v.clone)(e);(0,ee.isRadio)(e)||(t[u.AudioUtils.AUDIO_ITEM_INDEX_URL]=""),pe._lsSet(pe.LS_TRACK,t),(0,w.setCookie)("remixcurr_audio",`${e[u.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${e[u.AudioUtils.AUDIO_ITEM_INDEX_ID]}`,1)}}getListenedTime(){return this._listenedTime}seekCurrentAudio(e,t){if(this.ads.isActive)return!1;const i=(t=t||10)/u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio()).duration;let o=this.getCurrentProgress()+(e?i:-i);o=Math.max(0,Math.min(1,o)),this.seekByButton(o)}setVolume(e,t=!1){const i=Math.min(1,Math.max(0,e));this._userVolume!==i&&(this._userVolume=i,this.notify(O.events.VOLUME,i)),this.implTaskManager.setVolume(i,t),this.ads.updateVolume()}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seekByButton(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?ue.AudioPlayerSeekEventReason.TapBack:ue.AudioPlayerSeekEventReason.TapForward})}seekBySlider(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?ue.AudioPlayerSeekEventReason.SliderBack:ue.AudioPlayerSeekEventReason.SliderForward})}seek(e){return this._seek({amount:e,reason:ue.AudioPlayerSeekEventReason.Unknown})}_seek({amount:e,reason:t}){const i=this.getCurrentAudioData(),o=this.getCurrentProgressTime();this.implTaskManager.seek(e),this.notify(O.events.SEEK,{reason:t,audio:i,fromTime:o})}seekToTimeByButton(e,t){const i=this._seekTimeToAmount(e),o=i-this.getCurrentProgress();return this._seekToTime({amount:i,ref:t,reason:o<0?ue.AudioPlayerSeekEventReason.TapBack:ue.AudioPlayerSeekEventReason.TapForward})}seekToTime(e,t){return this._seekToTime({amount:this._seekTimeToAmount(e),ref:t,reason:ue.AudioPlayerSeekEventReason.Unknown})}_seekToTime({amount:e,ref:t,reason:i}){const o=this.getCurrentAudio();if(!o)return 0;if(this._seek({amount:e,reason:i}),u.AudioUtils.isPodcast(o)){let e="";const i=u.AudioUtils.audioTupleToAudioObject(o);t&&(e=u.AudioUtils.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(i,u.AudioUtils.PodcastsLogs.ACTION_SEEK,t)),this._podcastUpdateState(i,progress,0,e)}return progress}_seekTimeToAmount(e){const t=this.getCurrentAudio();if(!t)return 0;let i=e/t[u.AudioUtils.AUDIO_ITEM_INDEX_DURATION];return i=Math.max(0,i),i=Math.min(i,1),i}_ensureHasURL(e){this._currentUrlEnsure=this._currentUrlEnsure||{};const t=[];if(!e)return Promise.reject();if(e.url)return Promise.resolve(e);const i=this.getPlaylistQueue(),o=i.indexOfAudio(e);return o>=0?i.getAudioAt(o).then((e=>u.AudioUtils.audioTupleToAudioObject(e))):(this._currentUrlEnsure[e.fullId]||t.push(e.fullId+"_"+e.actionHash+"_"+e.urlHash),(()=>{let i;return!t.length&&this.currentEnsureUrlPromise?i=this.currentEnsureUrlPromise:(i=new Promise(((e,i)=>{this.ensureUrlReject&&this.ensureUrlReject(),this.ensureUrlReject=i,he().then((()=>this.fetchAudioUrls(t))).then((t=>{this.ensureUrlReject=null,e(t)})).catch((o=>{switch(o){case"bad_hash":this.ensureUrlReject=null,this.fetchAudios(t).then((e=>this.fetchAudioUrls(e))).then(e).catch((()=>!0));break;case"no_audios":this.ensureUrlReject=null,i()}return!0}))})),this.currentEnsureUrlPromise=i),i.then((t=>(Array.isArray(t)&&t.forEach((t=>{if(e.fullId===(0,Y.getAudioFullId)(t)){const i=(0,B.audioTupleToAudioObject)(t);e.url=i.url,e.ads=i.ads,e.flags=i.flags,e.extra=i.extra}})),e)))})())}fetchAudioUrls(e){return new Promise(((t,i)=>{ajax.post("al_audio.php?act=reload_audio",{ids:e.join(",")},{onDone:(e,i,o)=>{this.setStatusExportInfo(i),o&&this._podcastSaveData(o),(0,v.each)(e,((e,t)=>{t=u.AudioUtils.audioTupleToAudioObject(t);let i={};i[u.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,i[u.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,i[u.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,i[u.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra,this.updateAudio(t.fullId,i),this._currentAudio&&(0,Y.getAudioFullId)(this._currentAudio)===t.fullId&&(this._currentAudio[u.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,this._currentAudio[u.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,this._currentAudio[u.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,this._currentAudio[u.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra),delete this._currentUrlEnsure[t.fullId]})),t(e)},onFail:e=>(i(e),!0)})}))}fetchAudios(e){return new Promise(((t,i)=>{ajax.post("al_audio.php?act=reload_audios",{audio_ids:e.join(",")},{onDone:e=>{const o=[],s=this.getCurrentPlaylist().getAudiosList();if(!Array.isArray(e))return void i();const a=e.reduce(((e,t)=>(e[(0,Y.getAudioFullId)(t)]=t,e)),{});for(let e=0;e<s.length;e++){const t=(0,Y.getAudioFullId)(s[e]);if(a[t]){s[e]=a[t];const i=(0,B.audioTupleToAudioObject)(a[t]);o.push(`${i.fullId}_${i.actionHash}_${i.urlHash}`)}}t(o)}})}))}toggleAudio(e,t){if(vk&&vk.widget&&window.Widgets&&!vk.widgetPodcast&&!vk.id&&!(0,V.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;if((0,b.domClosest)("_audio_row__tt",t.target))return(0,f.cancelEvent)(t);const i=(0,b.domClosest)("_audio_row",e),o=u.AudioUtils.getAudioFromEl(i,!0);if(window.getSelection&&window.getSelection().rangeCount){const e=window.getSelection().getRangeAt(0);if(e){const{commonAncestorContainer:t}=e;if(t&&(0,b.domClosest)("_audio_row",t)===i&&e.startOffset!==e.endOffset)return!1}}if(t&&(0,b.hasClass)(t.target,"mem_link"))return nav.go((0,b.attr)(t.target,"href"),t,{navigateToUploader:!0}),(0,f.cancelEvent)(t);if((0,b.hasClass)(t.target,"_audio_row__title_inner")){if(u.AudioUtils.isPodcast(o))return(0,h.showPodcast)(i,o.fullId),(0,f.cancelEvent)(t);if(o.lyrics&&!o.isInAttach&&!(0,V.partConfigEnabled)("audio_use_web_new_version_lyrics"))return u.AudioUtils.toggleAudioLyrics(i,o),(0,f.cancelEvent)(t);if(o.hasTrackPage&&!o.isClaimed)return;(0,f.cancelEvent)(t)}if((0,b.hasClass)(t.target.parentNode,"audio_row__performers")){if((0,f.checkEvent)(t)||vk.widget)return!0;if(!(0,b.gpeByClass)("_ape_audio_item",t.target)){const e=(0,b.domData)(t.target,"performer");if(e)return u.AudioUtils.audioSearchPerformer(t.target,e,t),(0,f.cancelEvent)(t)}return!0}let s=cur.cancelClick||t&&((0,b.hasClass)(t.target,"audio_lyrics")||(0,b.domClosest)("_audio_duration_wrap",t.target)||(0,b.domClosest)("_audio_inline_player",t.target)||(0,b.domClosest)("audio_performer",t.target));const a=(0,b.hasClass)(t.target,"slider")||(0,b.domClosest)("slider",t.target),l=cur._sliderMouseUpNowEl&&(cur._sliderMouseUpNowEl===(0,b.geByClass1)("audio_inline_player_progress",i)||cur._sliderMouseUpNowEl===(0,b.geByClass1)("audio_inline_player_volume",i));if((a||l)&&(s=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,s)return!0;if(u.AudioUtils.isClaimedAudio(o)||o.isReplaceable){const e=u.AudioUtils.getAudioExtra(o).claim;if(e)return void((0,b.hasClass)(i,"no_actions")||o.isInEditBox||window.showAudioClaimWarning(o,e,u.AudioUtils.replaceWithOriginal.bind(u.AudioUtils,i,o)))}if(this.podcastSetActionRef(o,o.isPlaying?u.AudioUtils.PodcastsLogs.ACTION_PAUSE:u.AudioUtils.PodcastsLogs.ACTION_PLAY,"",i),o.isPlaying)this.pauseByButton(),(0,ne.logSearchAudioClick)(ne.SearchClickActionMap.PAUSE,o?.trackCode);else{const t=u.AudioUtils.getContextPlaylist(i),s=this.getPlaylistQueue();if((0,ne.logSearchAudioClick)(ne.SearchClickActionMap.PLAY,o?.trackCode),s.shuffled&&window.AudioPage){const i=window.currentAudioPage(e),o=i&&i.getCurrentSection();(!i||!(o&&"current"===o&&("placeholder_audios_wrapper"===t.context||"autoplay"===t.context)))&&this.getPlaylistQueue().resetShuffle()}if(s.isAutoplaySupported&&"autoplay"===t.context?this.playAudioItem({audio:o.fullId,playlist:null,context:o.context}):(this.playAudioItem({audio:o.fullId,playlist:t.playlist,context:o.context||t.context}),cur.audioPage&&cur.audioPage.onUserAction(o,t.playlist)),this._specialProjectController){const e=(0,te.getSpecialProjectId)(o);e&&this._specialProjectController.tryModal(e,o.trackCode)}}u.AudioUtils.onRowOver(i,!1,!0)}playNextPlaylist(e,t,i){const o=this.getPlaylist(I.AudioPlaylist.TYPE_PLAYLIST,e,t,i);o.loadAll((()=>{const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();e?(e.pushAudio(o.getAudiosList()),t.addPlaylist(o)):(t.addPlaylist(o),this.setCurrentPlaylist(new I.AudioPlaylist(o)),t.getAudioAt(0).then((e=>{e&&(this.setCurrentAudio(e),this.notify(O.events.UPDATE),this.notify(O.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),this.isPlaying()||this.playList({audio:e.fullId,playlist:o}))}))),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}))}setNextPlaylist(e,t,i){const o=this.getPlaylist(I.AudioPlaylist.TYPE_PLAYLIST,e,t,i);o.loadAll((()=>{const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue(),i=o.getAudiosList(),s=this._currentAudio?t.indexOfAudio(this._currentAudio):-1,a=this._currentAudio?e?.indexOfAudio(this._currentAudio)??-1:-1;t.addAudio(i,s+1),e?e.pushAudio(i,a+1):(this.setCurrentPlaylist(new I.AudioPlaylist(o)),t.getAudioAt(0).then((e=>{if(e&&(this.setCurrentAudio(e),this.notify(O.events.UPDATE),this.notify(O.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),!this.isPlaying())){const[t,i]=e,o=`${i}_${t}`;this._play(o,this._currentPlaylist)}})))}))}playPlaylist(e,t,i,o,s){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!(0,V.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;this.playNextInPlaylist(e,t,i,o,{shuffled:s,preDoPlay:e=>{s&&(e.shuffled&&e.resetShuffle(),e.shuffle(!0,!0),cur.audioPage&&cur.audioPage.updateShuffleButton())},isNewListStart:!0})}playBlock(e,t,i,o,s,a="default"){this.playNextInPlaylist(e,t,i,o,{type:s,trackType:a,shuffled:!1})}playNextInPlaylist(e,t,i,o,s={}){const{isNewListStart:a=!1}=s,l=this.getCurrentPlaylist(),r=this.getPlaylist(s.type||I.AudioPlaylist.TYPE_PLAYLIST,e,t,i,"",o),n=this.getPlaylistQueue();if(r.setContext(o),l&&l.getId()===r.getId()&&this.isPlaying()&&!s.shuffled)this.pauseByButton();else{let e=!1;const t=()=>{e||(n.setSortedQueue(r.getAudiosList()),e=!0,s.shuffled&&this.setCurrentPlaylist(r),s.preDoPlay&&s.preDoPlay(n),n.getFirstAudio().then((e=>{if(e){if(this._specialProjectController){const t=(0,te.getSpecialProjectId)(e);t&&this._specialProjectController.tryModal(t,e.trackCode)}this.playList({audio:e,playlist:r,context:o,isNewListStart:a})}})))};if(r.getAudiosCount()&&!s.shuffled&&!r.isExpired())return void t(r);this._impl&&this._impl.preparePlay&&!this.ads.isActive&&this._impl.preparePlay(),this.notify(O.events.PLAYLIST_START_LOADING,r.getOwnerId(),r.getPlaylistId()),r.load(0,t,null,s.trackType)}}_initPlayingContext(e){this._playingContext=e}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}resume({reason:e}={}){this.isPaused()&&this._playMarked({reason:e})}async playByButton({audio:e,playlist:t,context:i}={}){return this._playMarked({audio:e,playlist:t,context:i,reason:ue.AudioPlayerPlayAudioEventReason.PlayButton})}async playAudioItem({audio:e,playlist:t,context:i}={}){return this._playMarked({audio:e,playlist:t,context:i,reason:ue.AudioPlayerPlayAudioEventReason.AudioButton})}async playList({audio:e,playlist:t,context:i,isNewListStart:o=!1}={}){return this._playMarked({audio:e,playlist:t,context:i,reason:ue.AudioPlayerPlayAudioEventReason.ListButton,playbackStartMode:o?"resumeLast":"normal"})}async playShuffledList({audio:e,playlist:t,context:i}={}){return this._playMarked({audio:e,playlist:t,context:i,reason:ue.AudioPlayerPlayAudioEventReason.MixAndPlayButton})}async resumeChannel({audio:e,playlist:t,context:i}={}){return this._playMarked({audio:e,playlist:t,context:i,reason:ue.AudioPlayerPlayAudioEventReason.ChannelAutoResume})}async _playMarked({audio:e,playlist:t,context:i,seq:o,autoNext:s,reason:a,playbackStartMode:l}){return this._play(e,t,i,o,s,a,{playbackStartMode:l})}async play(e,t,i,o,s,a){return this._play(e,t,i,o,s,a)}async _play(e,t,i,o,s,a,l={}){const{playbackStartMode:r="normal"}=l;if(a=a??ue.AudioPlayerPlayAudioEventReason.Unknown,cur.loggingOff)return;if(!this._impl)return;let n;this._seq=o,this._autoNext=s,this._prevAudio=this._currentAudio,((0,A.isObject)(e)||(0,A.isArray)(e))&&(n=e,(e=u.AudioUtils.audioTupleToAudioObject(e))&&(e=e.fullId));const d=this.getPlaylistQueue(),{isAutoplaySupported:_,isAutoplayEnabled:c}=d;let h=u.AudioUtils.audioTupleToAudioObject(this._currentAudio),p=this.getCurrentPlaylist();!e&&h&&(e=h.fullId);let g=!1,P=e&&h&&e==h.fullId;const f=async i=>{if(this.mediaFocusChannel.start(),!P){const e=c&&t&&t.getNoConsecutivePlay();if(i&&t)if(e)await d.addNoConsecutivePlaylist(t,i);else if(await d.addPlaylist(t),!g&&"resumeLast"===r){const e=t.lastPlayedAudio;e&&(i=e)}t&&!e&&d.list.length<t.getAudiosCount()&&d.addAudio(t.getAudiosList()),t&&t.getType()===I.AudioPlaylist.TYPE_SEARCH&&t.indexOfAudio(i)>=t.getLocalFoundCount()&&t.sendSearchStats("search_play"),h&&u.AudioUtils.isPodcast(h)&&this.isPlaying()&&this._podcastUpdateState(h,this.getCurrentProgress(),this._impl.getPlayedTime(),u.AudioUtils.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0}),this.ads.isActive||this.ads.deinit()}if(pe._sendLCNotification(),P)if(this.ads.isActive){const e=this.ads.getCurrentAd()?.id;this.ads.resume(),e?this.emitter.emit("playAdv",{reason:a,advId:e,progressTime:this.getCurrentProgressTime()}):Ae("playAdv")}else this.isPlaying()||(d.autoplayQueue?.source||d.setAutoplaySourceFromPlaylist(t),this.setIsPlaying(!0),this.implTaskManager.clearAllTasks(),this.emitter.emit("playAudio",{reason:a,audio:(0,N.toTrackedAudioData)(h),progressTime:this.getCurrentProgressTime()}),this._implSetUrl(h).then((()=>{this._implPlay(),this._updatePlaybackRate(),this.implTaskManager.setVolume(this.getVolume(),!!this._impl.getCurrentProgress()),u.AudioUtils.isPodcast(i)&&this._podcastUpdateState(u.AudioUtils.audioTupleToAudioObject(i),this.getCurrentProgress(),this._impl.getPlayedTime())})).catch((()=>{})));else if(e&&i){const t=this.getCurrentAudioData(),l=(0,ue.getStopReasonForPlayReason)(a);if(t&&l&&!P&&this.emitter.emit("stopAudio",{reason:l,audio:t,progressTime:this.getCurrentProgressTime()}),!s&&h&&this._impl.setUrl(R.SILENCE),this.setCurrentAudio(i),this.setIsPlaying(!0),this.ads.isActive){const e=this.ads.getCurrentAd()?.id;this.ads.resume(),e?this.emitter.emit("playAdv",{reason:a,advId:e,progressTime:this.getCurrentProgressTime()}):Ae("playAdv")}else this.notify(O.events.PLAY_REQUESTED,!0,parseInt(o),s),this._muteProgressEvents=!0,this.implTaskManager.clearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay(),this.ads.startPlay(u.AudioUtils.audioTupleToAudioObject(i),(()=>this.playAfterAd(a))),this.notify(O.events.PROGRESS,0);this.updateCurrentPlaying(!0),h&&this.scrollToCurrentPlaying(h.fullId,e)}};if(_&&"autoplay"===i||(0,A.isArray)(n)&&"autoplay"===n[u.AudioUtils.AUDIO_ITEM_INDEX_CONTEXT]){const t=d.autoplayQueue.getAudioById(e);if(t)return this.eventBus.emit(O.AudioPlayerEventType.PLAY_TRACK_FROM_AUTOPLAY,t),f(t)}if(t?p&&(g=P?t.getFullId()===p.getSelf().getFullId():t===p.getSelf()||t===p):(t=p,g=!0),g||i||(0,y.debugLog)("New playlist play init without context"),i&&(this._prevContext=this._playingContext,this._initPlayingContext(i)),!g){if(this._cleanUpPlaylists(),this._currentPlaylist)if(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio,c&&t.getNoConsecutivePlay()){t.getAudio(e);const i=Array.isArray(n)?n:t.getAudio(e);await d.addNoConsecutivePlaylist(t,i)}else await d.setSortedQueueByPlaylist(t);this.setCurrentPlaylist(new I.AudioPlaylist(t)),this.notify(O.events.PLAYLIST_CHANGED)}if(!(d.indexOfAudio(e)>=0)){let i=t?.getAudio(e);!i&&n&&(i=n),d.addAudio(i)}f(await d.getAudio(e))}playAfterAd(e){this.notify(O.events.CURRENT_CHANGED);const t=this.getCurrentAudio();t&&(this.emitter.emit("playAudio",{reason:e,audio:(0,N.toTrackedAudioData)(t),progressTime:this.getCurrentProgressTime()}),this.notify(O.events.UPDATE),this._implSetUrl(t).then((()=>{this._implPlay(),this._updatePlaybackRate(),vk.id?this.implTaskManager.setVolume(this.getVolume()):this.fadeIn(1e3*pe.UNAUTH_FADE_TIME),this._triggerTNSPixel()})).catch((()=>(this._pauseAudio({reason:ue.AudioPlayerPauseAudioEventReason.Unknown}),!0))))}instantPlay(e,t,i){const o=!_.browser.safari&&t&&t.shiftKey;this.playPlaylist(vk.id,I.AudioPlaylist.DEFAULT_PLAYLIST_ID,i,"header",o),(0,P.statlogsValueEvent)("client_header_play_button",o?"shuffle":"play"),setTimeout((()=>{(0,b.addClass)(e,"loading")}),400)}_prefetchAudio(e){(e=u.AudioUtils.audioTupleToAudioObject(e))&&e.url&&this._impl.prefetch(e.url)}getCurrentPlaylist(){return this._currentPlaylist}setCurrentPlaylist(e){this._currentPlaylist=e}getPlaylists(){return(0,v.clone)(this._playlists)}pauseByButton(){return this._pauseAudio({reason:ue.AudioPlayerPauseAudioEventReason.PauseButton})}pauseByMediaSession(){return this._pauseAudio({reason:ue.AudioPlayerPauseAudioEventReason.MediaSession})}pauseByChangeChannel(){return this._pauseAudio({reason:ue.AudioPlayerPauseAudioEventReason.ChannelAutoPause})}pause(){return this._pauseAudio({reason:ue.AudioPlayerPauseAudioEventReason.Unknown})}_pauseAudio({reason:e}){const t=this.getCurrentAudioData(),i=this.getCurrentProgressTime(),o=this.ads.isActive;if(o&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),o){const t=this.ads.getCurrentAd()?.id;this.ads.resume(),t?this.emitter.emit("pauseAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):Ae("pauseAdv")}else this.emitter.emit("pauseAudio",{reason:e,audio:t,progressTime:i})}_stopCurrentAudio({reason:e}){const t=this.getCurrentAudioData(),i=this.getCurrentProgressTime(),o=this.ads.isActive;if(o&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),o){const t=this.ads.getCurrentAd()?.id;t?this.emitter.emit("stopAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):Ae("stopAdv")}else this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:i})}stop(e){if(this.setIsPlaying(!1),this.ads.isActive){const t=this.ads.getCurrentAd()?.id;this.ads.stop(),e&&(t?this.emitter.emit("stopAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):Ae("stopAdv"))}else{const t=this.getCurrentAudioData();t&&e&&this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:this.getCurrentProgressTime()}),this._impl.stop()}this.notify(O.events.STOP),this.switchConnection.emit("stop"),this.mediaFocusChannel.stop()}isPlaying(){return this._isPlaying}setIsPlaying(e){this._isPlaying=e,this.notify(O.events.PLAYER_IS_PLAYING_CHANGED,e)}isPaused(){return this._isPaused}setIsPaused(e){this._isPaused=e}getCurrentAudio(){if(this._currentAudio&&!this._currentAudio[J.EAudioTupleIndex.CONTEXT]){const e=this._getPlayingContext();e&&(this._currentAudio[J.EAudioTupleIndex.CONTEXT]=e)}return this._currentAudio}setCurrentAudio(e){this._currentAudio=e}getCurrentAudioData(){return(0,N.toTrackedAudioData)(this.getCurrentAudio())||null}getPreviousAudio(){return this._prevAudio}playNextByButton(e){this._playNextMarked({auto:e,reason:ue.AudioPlayerPlayAudioEventReason.NextButton})}playNextByMediaSession(e){this._playNextMarked({auto:e,reason:ue.AudioPlayerPlayAudioEventReason.NextMediaSession})}playPrevByButton(){this._playPrevMarked({reason:ue.AudioPlayerPlayAudioEventReason.PrevButton})}playPrevByMediaSession(){this._playPrevMarked({reason:ue.AudioPlayerPlayAudioEventReason.PrevMediaSession})}_playNextMarked({auto:e,reason:t}){this.playNext(e,t)}_playPrevMarked({reason:e}){this.playPrev(e)}playNext(e,t){this._playNext(1,e,t)}playPrev(e){this._playNext(-1,void 0,e)}_playNext(e,t,i){if(this.ads.isActive)return;const o=this.getCurrentAudio(),s=this.getCurrentPlaylist(),a=this.getPlaylistQueue(),l=(e,o)=>{u.AudioUtils.isClaimedAudio(e)||this._playMarked({audio:e,playlist:s,context:!1,seq:o,autoNext:t,reason:i})};if(o&&s)if(e>0)a.getNextAudio(o,{ignoreClaimed:!0,repeat:this.isRepeatAll()&&!s.isLoadable()}).then((async e=>{if(e)l(e,1);else if(s.isLive())this._muteProgressEvents=!0,s.fetchNextLiveAudio((e=>{if(e){const t=this.getPlaylistQueue(),i=t.indexOfAudio(e);i>=0?t.moveAudio(i,t.length-1):t.addAudio(e)}l(e)}));else if(s.isLoadable()){const e=await s.fetchNextAudio();if(e){this.getPlaylistQueue().addAudio(e),this.getCurrentPlaylist().pushAudio(e)}l(e)}else a.getFirstAudio(!0).then((t=>{if(t){if(e=t,!this.isRepeatAll()){if(a.indexOfAudio(o)+1===a.length)return this.implTaskManager.seekImmediate(0),this.stop(i),void(u.AudioUtils.isClaimedAudio(e)||(this.setCurrentAudio(e),this._implSetUrl(this._currentAudio),this.updateCurrentPlaying(!0),this.notify(O.events.CURRENT_CHANGED),this.notify(O.events.UPDATE)))}l(e,1)}}))}));else{a.indexOfAudio(this._currentAudio)<1||this._impl.getCurrentTime()>5?this.seekByButton(0):a.getPrevAudio(o,{ignoreClaimed:!0}).then((e=>{e?l(e,-1):this.seekByButton(0)}))}}async getPrevAudio(){const e=this.getPlaylistQueue(),t=this.getCurrentAudio();return t?e.getPrevAudio(t,{ignoreClaimed:!0,repeat:this.isRepeatAll()}):e.getLastAudio(!0)}async getNextAudio(){const e=this.getPlaylistQueue(),t=this.getCurrentAudio();return t?e.getNextAudio(t,{ignoreClaimed:!0,repeat:this.isRepeatAll()}):e.getFirstAudio(!0)}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(e,t,i,o,s){const a=pe._podcastGetStates(),l=Math.round(e.duration*t);a[e.fullId]={t:(0,A.vkNow)(),position:l},pe._podcastSetStates(a),o&&this._podcastSendLogs(o,e,i,l,s)}_podcastSendLogs(e,t,i,o,s){if(!t||!e||!u.AudioUtils.isPodcast(t)||cur._podcastsActionId&&cur._podcastsActionId[e]&&this._podcastsActionLastId[e]===cur._podcastsActionId[e])return;const a=this._podcastsActionRef[t.fullId]||{},l=a[e]||{};u.AudioUtils.PodcastsLogs.log(e,(0,v.extend)({audio:t,position:o,listen:i},l,s||{})),delete a[e],this._podcastsActionLastId[e]=cur._podcastsActionId?cur._podcastsActionId[e]:null}podcastSetActionRef(e,t,i,o){e=u.AudioUtils.audioTupleToAudioObject(e),t&&u.AudioUtils.isPodcast(e)&&(this._podcastsActionRef[e.fullId]=this._podcastsActionRef[e.fullId]||{},this._podcastsActionRef[e.fullId][t]={ref:i,refEl:o},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[t]=(0,A.irand)(0,1e6))}toggleRadio(e,t){const i=this.getPlaylist(I.AudioPlaylist.TYPE_RADIO,t,I.AudioPlaylist.RADIO_PLAYLIST_ID),o=i.getAudiosList().find((t=>t[J.EAudioTupleIndex.ID]===e));o&&(this.isPlaying()&&(0,ee.isRadio)(this._currentAudio)&&o[J.EAudioTupleIndex.ID]===this._currentAudio[J.EAudioTupleIndex.ID]?this.pauseByButton():this.playAudioItem({audio:o,playlist:i}))}_podcastCleanStates(){const e=pe._podcastGetStates();let t=!1;return(0,v.each)(e,((i,o)=>{Date.now()-o.t>2419200&&(delete e[i],t=!0)})),t&&pe._podcastSetStates(e),e}_podcastSaveData(e){const t=pe._podcastGetStates();(0,v.each)(e,((e,i)=>{const o=i.state;if(!o)return;const s=+o[1];(!t[e]||!t[e][1]||s&&s>t[e][1])&&(t[e]={position:+o[0],t:Date.now()})})),pe._podcastSetStates(t)}_podcastRestoreState(){const e=u.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!u.AudioUtils.isPodcast(e))return 0;let t=0;if(cur.podcastSeekToTime)t=this._seekToTime({amount:cur.podcastSeekToTime,ref:cur.podcastSeekToTimeRef}),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef;else{t=((pe._podcastGetStates()[e.fullId]||{}).position||0)/e.duration,t&&t<1&&this.implTaskManager.seek(t)}return t&&t<1?(this.updateCurrentPlaying(),t):0}getCurrentFaveStatus(){return!!u.AudioUtils.isPodcast(this._currentAudio)&&u.AudioUtils.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){const e=u.AudioUtils.isPodcast(this._currentAudio)||u.AudioUtils.isArticleTts(this._currentAudio),t=!this.ads.isActive&&e?pe.podcastGetPlaybackRate():1;this.implTaskManager.updatePlaybackRate(t)}podcastChangePlaybackRate(e){const t=pe._lsGet(pe.LS_PODCASTS)||ce;let i=t.rate||1;e?i-=pe.PLAYBACK_RATE_STEP:i+=pe.PLAYBACK_RATE_STEP,!e&&i>pe.PLAYBACK_RATE_MAX?i=1:e&&i<1&&(i=pe.PLAYBACK_RATE_MAX),t.rate=i,pe._lsSet(pe.LS_PODCASTS,t),ce=t,this._updatePlaybackRate()}playAudio(e){let t=I.AudioPlaylist.TYPE_TEMP;(0,se.isArticleTts)(e)&&(t=I.AudioPlaylist.TYPE_ARTICLE_TTS);const i=new I.AudioPlaylist(t);i.mergeWith({list:[e]}),this.playAudioItem({audio:e,playlist:i})}updateAudioDislikeStatus(e,t){if(!((0,V.partConfigEnabled)("dislikes_web_enabled")||(0,V.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const i=this.getCurrentPlaylist()?.getAudiosList()?.find((t=>u.AudioUtils.getAudioFullId(t)===e));if(!i)return;let o={dislike:t};Boolean(i[J.EAudioTupleIndex.EXTRA])&&(o=u.AudioUtils.mergeAudioExtra(u.AudioUtils.getAudioExtra(i[J.EAudioTupleIndex.EXTRA]),o)),i[J.EAudioTupleIndex.EXTRA]=o,Boolean(this._currentAudio)&&u.AudioUtils.getAudioFullId(this._currentAudio)===e&&(this._currentAudio[J.EAudioTupleIndex.EXTRA]=o,this._saveStateCurrentAudio()),this.saveStateCurrentPlaylist(),this.notify(O.AudioPlayerEventType.CURRENT_AUDIO_DISLIKE_STATUS_UPDATE)}constructor(){if(this.ensureUrlReject=null,this.statsListener=null,this.myTrackerListener=null,this.mediaFocusChannel=l.MediaFocus.ensure().createChannel("audio"),this._currentAudio=null,this._isPlaying=!1,this._isPaused=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!0,this._specialProjectController=(0,V.partConfigEnabled)("audio_special_project_web")?ae.SpecialProjectController.init(le.showWebSpecialProjectModal):null,vk.isBanned)return;u.AudioUtils.debugLog("Player creation"),this.emitter=(0,ue.createAudioPlayerEventEmitter)((0,a.ensureDIRootWebContainer)()),this.eventBus=new U.EventBus,this.audioPlayersSwitch=r.MediaPlayersSwitch.ensure((0,a.ensureDIRootWebContainer)()),this.switchConnection=this.audioPlayersSwitch.connect({resume:({reason:e})=>{this.resume({reason:e})},pause:()=>{this.pauseByChangeChannel()},stop:()=>{this.stop()}}),this._playlistQueue=new k.PlaylistQueue(new z.FetchService,this.eventBus);const e=new T.WebPlayerAdapter(this,(0,a.ensureDIRootWebContainer)().resolve(n.EmitterFactory));(0,V.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new de.AudioPlayerStatsListener(e)),(0,V.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new de.AudioPlayerMyTrackerListener(e,(0,a.ensureDIRootWebContainer)().resolve(d.MyTracker))),this.stats=new L.AudioStats(e),this.lyrics=new Z.AudioLyricsProvider,this.ads=new D.AudioAds(this,pe.getVersion()),this.connectEvents(),(0,W.connectListenQueue)(),this._restoreVolumeState(),this._initImpl(),this._initEvents(),this._podcastCleanStates(),this._listenStatusExport(),(0,C.onDomReady)((()=>{const e=()=>{try{this.restoreState()}catch(e){pe._lsRemove(pe.LS_TRACK),pe._lsRemove(pe.LS_PL)}u.AudioUtils.toggleAudioHQBodyClass(),this.updateCurrentPlaying()};window.ap?e():window.addEventListener(_e.AUDIO_PLAYER_INITED_EVENT,e,{once:!0})}));const t=new X.WebMediaSessionAdapter(this);new q.AudioMediaSession(t,this.mediaFocusChannel.mediaSession).init(),(0,V.partConfigEnabled)("audio_mobx")&&(0,s.makeObservable)(this,{_isPlaying:s.observable,_isPaused:s.observable,_currentAudio:s.observable,_currentPlaylist:s.observable,setIsPlaying:s.action,setIsPaused:s.action,setCurrentAudio:s.action,setCurrentPlaylist:s.action})}}function ye(e,t,i){let o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),o.fillStyle=i;for(let e=0;e<4;e++){let i=2+12*t[e];o.fillRect(13+4*e,12-i+14,2,i)}}function Ae(e){console.warn(`Missed stat event ${e}`)}pe.UNAUTH_FADE_TIME=.8,pe.LS_VER="v20",pe.LS_KEY_PREFIX="audio",pe.LS_PREFIX=pe.LS_KEY_PREFIX+"_"+pe.LS_VER+"_",pe.LS_STATUS_EXPORT=pe.LS_KEY_PREFIX+"_status_export",pe.LS_VOLUME="vol",pe.LS_PL="pl",pe.LS_TRACK="track",pe.LS_SAVED="saved",pe.LS_PROGRESS="progress",pe.LS_PODCASTS="podcasts",pe.LS_DURATION_TYPE="dur_type",pe.LS_UUID="uuid",pe.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",pe.LS_SHOW_HQ_LABEL="_audio_show_hq_label",pe.PLAYBACK_RATE_STEP=.5,pe.PLAYBACK_RATE_MAX=_.browser.safari?2:3,pe.tabIcons={def:"/images/icons/favicons/fav_logo.ico",play:"/images/icons/favicons/fav_play.ico",pause:"/images/icons/favicons/fav_pause.ico"}},960534:(e,t,i)=>{i.d(t,{init:()=>u});var o=i(996538),s=i(671300),a=i(691474),l=i(620626),r=i(13709),n=i(844090),d=i(401535);function u(){window.AudioLayer=o.default,window.AudioUtils=s.AudioUtils,window.TopAudioPlayer=a.TopAudioPlayer,window.AudioPlaylist=l.AudioPlaylist,window.AudioPlayer=r.AudioPlayer,window.AudioPlayerUI=n.AudioPlayerUI,(0,d.moduleReady)("audio-player")}},183753:(e,t,i)=>{i.d(t,{AudioMixPlaylistAdapter:()=>a});var o=i(787654),s=i(255053);class a{get list(){return this.playlist.items.map((e=>(0,o.apiAudioToAudioTuple)(e.apiAudio)))}get length(){return this.playlist.items.length}get lastPlayedAudio(){return null}constructor(e){this.getType=()=>this.type,this.getBlockId=()=>this.blockId,this.getPlaylistId=()=>this.playlistId,this.getContext=()=>this.context,this.getFullId=()=>this.playlistId||"",this.getAudio=e=>this.list.filter((t=>e===`${t[1]}_${t[0]}`))[0],this.getAudioIds=async()=>this.playlist.items.map((e=>({access_key:e.apiAudio?.access_key||"",audio_raw_id:(0,s.getAudioFullId)(e),track_code:e.apiAudio?.track_code||""}))),this.getAudios=()=>Promise.resolve(),this.getAudiosList=()=>this.list,this.isLive=()=>!1,this.isLoadable=()=>this.loadable,this.getAudiosCount=()=>this.length,this.getAudioAt=e=>{const t=this.playlist.audioAt(e);if(t)return(0,o.apiAudioToAudioTuple)(t.apiAudio)},this.fetchNextAudio=async()=>{if(!this.loadable)throw new Error("Cannot fetch next audio without loading the playlist (loadable === false).");try{const e=await this.playlist.ensureAt(this.getAudiosCount());return(0,o.apiAudioToAudioTuple)(e.apiAudio)}catch(e){throw new Error("Failed to ensure the next audio in the playlist.")}},this.playlist=e,this.loadable=this.playlist.infinite,this.albumId=0,this.blockId="",this.type=this.playlist.type,this.playlistId=this.playlist.id,this.context=this.playlist.context}}},610052:(e,t,i)=>{i.d(t,{MarusiaWebPlayerAdapter:()=>a});var o=i(671300),s=i(514640);class a{play(e,t,i){this.player.play(e,t,i)}pause(){this.player.pause()}playNext(e){this.player.playNext(e)}playPrev(){this.player.playPrev()}seekToTime(e){this.player.seekToTime(e)}toggleRepeatCurrentAudio(){this.player.toggleRepeatCurrentAudio()}toggleRepeatAll(){this.player.toggleRepeatAll()}getVolume(){return this.player.getVolume()}setVolume(e){this.player.setVolume(e)}getCurrentPlaylist(){return this.player.getCurrentPlaylist()?.getSelf()}deleteCurrentPlaylist(){this.player.deleteCurrentPlaylist()}addPlaylist(e){this.player.addPlaylist(e)}isPlaying(){return this.player.isPlaying()}getCurrentAudio(){return this.player.getCurrentAudio()}getProgressInSeconds(){const e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[o.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getPlayerData(){return{position:this.getCurrentPlaylist()?.indexOfAudio(this.getCurrentAudio())??0,duration:this.player._impl?.getDuration()??0,elapsed:this.getProgressInSeconds(),state:this.isPlaying()?"PLAY":"PAUSE",volume:Math.round(100*this.getVolume())}}preparePlay(){this.touched||this.player._impl?.preparePlay()}constructor(e){this.touched=!1,this.player=e,this.player.subscribe(s.AudioPlayerEventType.PLAY,(()=>{this.touched=!0}))}}},16230:(e,t,i)=>{i.d(t,{MusicMixAdapter:()=>s});var o=i(787654);class s{get list(){return this.playlist.items.map((e=>(0,o.apiAudioToAudioTuple)(e.context.apiAudio,{useCache:!0})))}get length(){return this.playlist.items.length}constructor(e){this.getType=()=>this.type,this.getBlockId=()=>this.blockId,this.getPlaylistId=()=>this.playlistId,this.getContext=()=>this.context,this.getFullId=()=>this.playlistId||"",this.getAudio=e=>this.list.filter((t=>e===`${t[1]}_${t[0]}`))[0],this.getAudioIds=async()=>this.playlist.items.map((e=>({access_key:e.identity.accessKey||"",audio_raw_id:e.identity.rawId,track_code:e.context.trackCode||""}))),this.getAudios=()=>Promise.resolve(),this.getAudiosList=()=>this.list,this.isLive=()=>!1,this.isLoadable=()=>this.loadable,this.getAudiosCount=()=>this.length,this.getAudioAt=e=>{const t=this.playlist.audioAt(e);if(t)return(0,o.apiAudioToAudioTuple)(t.context.apiAudio,{useCache:!0})},this.fetchNextAudio=async()=>{if(!this.loadable)throw new Error("Cannot fetch next audio without loading the playlist (loadable === false).");try{const e=await this.playlist.ensureAt(this.getAudiosCount());return(0,o.apiAudioToAudioTuple)(e.context.apiAudio,{useCache:!0})}catch(e){throw new Error("Failed to ensure the next audio in the playlist.")}},this.playlist=e,this.loadable=this.playlist.infinite,this.albumId=0,this.blockId="",this.playlistId=this.playlist.identity.id,this.type="vkmix",this.context="vkmix:vk_mix"}}},202775:(e,t,i)=>{i.d(t,{followOwner:()=>a});var o=i(514640),s=i(327527);function a(e,t){window.ajax.post("/al_audio.php?act=follow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,s.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_FOLLOW)}})}},367702:(e,t,i)=>{i.d(t,{unfollowOwner:()=>a});var o=i(514640),s=i(327527);function a(e,t){window.ajax.post("/al_audio.php?act=unfollow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,s.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_UNFOLLOW)}})}},470999:(e,t,i)=>{i.d(t,{addAudioPlaylistToMyAudioPlaylists:()=>l});var o=i(850101),s=i(610989),a=i(735477);async function l(e,t,i){const l=t.getTitle(),r=(await t.getAudiosList()).map((e=>{const t=(0,a.audioTupleToAudioObject)(e);return{id:t.id,ownerId:t.owner_id}})),n=await i.createFx({blockId:e,audios:r.reverse(),title:l});return(0,o.showDoneBoxFull)("",{},{title:s.getLang("audio_save_recommendation_audio_block_as_playlist_success_notification_title"),text:s.getLang("audio_save_recommendation_audio_block_as_playlist_success_notification_text")}),n}},145608:(e,t,i)=>{async function o(e,t){if(!e)return t.trackCode;const i=await e.getAudioIds();return i?.find((e=>e?.audio_raw_id===t.fullId))?.track_code||t.trackCode}i.d(t,{getAudioTrackCodeFromPlaylist:()=>o})},19260:(e,t,i)=>{i.d(t,{onPlayNextPlaylist:()=>s});var o=i(302495);function s(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.LISTEN_NEXT_OUT)}},815958:(e,t,i)=>{i.d(t,{onPlayPlaylistShuffled:()=>s});var o=i(302495);function s(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.MIX_ALL_OUT)}},289882:(e,t,i)=>{i.d(t,{onSharePlaylistClick:()=>s});var o=i(302495);function s(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.SHARE_OUT)}},72023:(e,t,i)=>{i.d(t,{openPlaylistOwner:()=>s});var o=i(302495);function s(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.OPEN_OWNER_OUT)}},153208:(e,t,i)=>{i.d(t,{RadiostationEventsHandling:()=>r});var o=i(823875),s=i(327527),a=i(454785),l=i(523186);class r{connectFollowingEvents(){this.tq.setInteractiveHandler("Music/follow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,a.followRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{e.target instanceof HTMLElement&&(e.target.dataset.taskClick="Music/unfollow_radiostation")}))}))}connectUnFollowingEvents(){this.tq.setInteractiveHandler("Music/unfollow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,l.unfollowRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{e.target instanceof HTMLElement&&(e.target.dataset.taskClick="Music/follow_radiostation")}))}))}connectPlayToggleEvent(){this.tq.setInteractiveHandler("Music/toggle_radio_play",(({payload:e})=>{if(e.dataAttrs){const{stationId:t,playlistOwnerId:i}=e.dataAttrs;if(!t||!i)return;const o=(0,s.getAudioPlayer)();o&&o.toggleRadio(parseInt(t,10),parseInt(i,10))}}))}constructor(){try{this.tq=(0,o.tq)()}catch(e){return}this.connectFollowingEvents(),this.connectUnFollowingEvents(),this.connectPlayToggleEvent()}}},454785:(e,t,i)=>{i.d(t,{followRadiostation:()=>r});var o=i(527966),s=i(327527),a=i(514640),l=i(119265);function r(e,t){const i=new o.FetchService,r=l.AudioPageProxy.ensure().emitter;return i.followRadiostation(e,t).then((t=>{if(t){const t=(0,s.getAudioPlayer)();t&&t.notify(a.events.RADIOSTATION_FOLLOW,e),r.emit(l.AudioPageEventType.RadioStationFollowed)}}))}},523186:(e,t,i)=>{i.d(t,{unfollowRadiostation:()=>l});var o=i(527966),s=i(327527),a=i(514640);function l(e,t){return(new o.FetchService).unfollowRadiostation(e,t).then((t=>{if(t){const t=(0,s.getAudioPlayer)();t&&t.notify(a.events.RADIOSTATION_UNFOLLOW,e)}}))}},560631:(e,t,i)=>{i.d(t,{updateFaveStatusAfterFollow:()=>u});var o=i(391111),s=i(59052),a=i(620626),l=i(261362),r=i(668592),n=i(327527),d=i(514640);function u(e,t){const i=(0,n.getAudioPlayer)();i.getPlaylistsByType(a.AudioPlaylist.TYPE_RADIO).forEach((i=>{i.getAudiosList().forEach((i=>{i[s.EAudioTupleIndex.ID]===e&&_(i,t)}))})),Array.from(document.querySelectorAll(".audio_player_radio_station._audio_page_player")).forEach((i=>{const o=(0,l.getAudioFromEl)(i);o&&o[s.EAudioTupleIndex.ID]===e&&(_(o,t),i.dataset.audio=JSON.stringify(o))}));const r=i.getCurrentPlaylist();r&&r.getType()===a.AudioPlaylist.TYPE_RADIO&&i.saveStateCurrentPlaylist();const u=i.getCurrentAudio();(0,o.isRadio)(u)&&(_(u,t),i._saveStateCurrentAudio(),u[s.EAudioTupleIndex.ID]===e&&i.notify(d.AudioPlayerEventType.CURRENT_RADIOSTATION_FOLLOW_STATUS_UPDATE,t))}function _(e,t){const i=(0,r.getAudioExtra)(e);i&&i.fave!==t&&(i.fave=t,e[s.EAudioTupleIndex.EXTRA]=i)}},731302:(e,t,i)=>{i.d(t,{copyAudioLink:()=>s});var o=i(106149);async function s(e){const t=function(e){if(!new RegExp(/^\/?audio\-?\d+\_\-?\d+(\_[A-Za-z\d]+)*$/).test(e))return console.error("Invalid audio URL for audio pathname",e),null;try{return new URL(e,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio pathname",e),null}}(e);if(t)return(0,o.copyToClipboard)(t)}},160785:(e,t,i)=>{i.d(t,{copyAudioLinkByIdentity:()=>a});var o=i(106149),s=i(580334);async function a(e,t){if(!e?.id||!e?.ownerId)return void console.error("Invalid AudioIdentity object",e);const i=function(e){const t=(0,s.getAudioAccessId)(e),i=`audio${t}`;try{return new URL(i,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio identity",e),null}}({id:e.id,ownerId:e.ownerId,accessKey:e?.accessKey||t||void 0});return i?(0,o.copyToClipboard)(i):void 0}},492460:(e,t,i)=>{i.d(t,{toggleAddAudio:()=>l});var o=i(579032),s=i(199369),a=i(476726);function l(e,t,i=(()=>{}),l=""){if((0,a.partConfigEnabled)("add_audio_to_effector_web")){const s=(0,o.ensureAudioPageService)();s.setUserId(window.vk.id),s.toggleAddAudioFx({audioEl:e,audio:t,onSuccess:i,audioRef:l})}else(0,s.toggleAddAudioLegacy)(e,t,i,l)}},449502:(e,t,i)=>{i.d(t,{unLogF:()=>o});const o=e=>Math.log(1+34*e)/Math.log(35)},907535:(e,t,i)=>{i.d(t,{AudioSnippetsPlayer:()=>I});var o=i(331635),s=i(327813),a=i(214450),l=i(121092),r=i(572466),n=i(127126),d=i(930996),u=i(450507),_=i(933693),c=i(689938),h=i(382399),p=i(122611),y=i(476726),A=i(625330),g=i(620407),P=i(561418),f=i(109465),m=i(514640),E=i(13709),w=i(494360);const v=1.5;class I{get events(){return this.emitter.listenable}get progress(){return this._progress}get playedTime(){return this._playedTime}get volume(){return this._volume}get state(){return this._state}setState(e){const t={...this.state,...e};(0,d.shallowEqual)(this.state,t)||(this._state=t,(0,d.shallowEqual)(t.currentQueueState,this.state.currentQueueState)||this.currentQueueStateDidChange(),this.notify(m.events.SNIPPET_PLAYER_STATE_CHANGED,this.state),this.emitter.emit("stateChanged",this.state))}currentQueueStateDidChange(){const{state:e,pendingImplAudio:t,isPlaying:i}=this,{currentQueueState:o,playingQueueState:s}=e,{list:a,audio:l,lastReason:r}=o;!i||t&&t===l||(0,d.shallowEqual)(o,s)||l&&a&&this.play(l,{list:a.audios,reason:r??p.AudioPlayerPlayAudioEventReason.Unknown})}get isPlaying(){return this.state.isPlaying||!!this.pendingImplAudio}reset(){this.pausedByVisibility=!1,this.stop(p.AudioPlayerStopAudioEventReason.Unknown),this.queue.reset()}get currentAudio(){return this.queue.currentAudio||null}addToQueue(...e){this.queue.add(...e)}async resume(e){this.state.isPaused&&await this.play(void 0,{reason:e})}async play(e,{list:t,volume:i,reason:o}={}){const s=e||this.currentAudio;if(!s)throw new Error("[AudioSnippetPlayer]: Audio is not defined");let a=t;a||(a=this.queue.findListByAudio(s),a||(a=[s],this.addToQueue(a))),this.queue.moveTo(o??p.AudioPlayerPlayAudioEventReason.AudioButton,a,s),await this.implPlayAudio(s,i,o)}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}stop(e){this.stopCurrentPlayingAudioState(e),this.implStop(),this.notify(m.events.STOP_SNIPPET),this.switchConnection.emit("stop")}stopCurrentPlayingAudioState(e){const t=this.state.playingQueueState?.audio,i=this.getCurrentProgressTime();this.setState({isPlaying:!1,playingQueueState:null}),t&&this.emitter.emit("stopAudio",{reason:e??p.AudioPlayerStopAudioEventReason.Unknown,audio:t,progressTime:i})}async playNext(){const{audio:e,list:t}=this.queue.moveToNext();e&&t&&(await this.play(e,{list:t.audios,reason:p.AudioPlayerPlayAudioEventReason.NextButton}),this.notify(m.events.SNIPPET_PLAYER_PLAY_NEXT_SNIPPET))}async playPrev(){const{audio:e,list:t}=this.queue.moveToPrev();e&&t&&(await this.play(e,{list:t.audios,reason:p.AudioPlayerPlayAudioEventReason.PrevButton}),this.notify(m.events.SNIPPET_PLAYER_PLAY_PREV_SNIPPET))}async pause(e){const{isPlaying:t}=this.state,i=this.state.playingQueueState?.audio,o=this.getCurrentProgressTime();this.taskManager.setVolume(0,!0),await this.taskManager.pause(),t&&i&&this.emitter.emit("pauseAudio",{reason:e??p.AudioPlayerPauseAudioEventReason.Unknown,audio:i,progressTime:o})}async implPlayAudio(e,t,i){if(e!==this.pendingImplAudio){E.AudioPlayer._sendLCNotification();try{this.pendingImplAudio=e,e===this.implAudio?await this.implPlayUrl():await this.implChangeAudio(e,t,i)}finally{this.pendingImplAudio=null}this.fadeIn(),e===this.getPlayingAudio()&&this.emitter.emit("playAudio",{reason:i??p.AudioPlayerPlayAudioEventReason.Unknown,audio:e,progressTime:0})}}async implChangeAudio(e,t,i){(0,s.runInAction)((()=>{this.setState({isPlaying:!1})})),this.getPlayingAudio()&&(this.stopCurrentPlayingAudioState((0,p.getStopReasonForPlayReason)(i)??p.AudioPlayerStopAudioEventReason.Unknown),this.implStop()),this._volume=t||this._volume,this.taskManager.setVolume(0,!1);const o=e.url;if(!o)return;this.seek(0);const a=this.queue.state;try{await this.implPlayUrl(o)}catch(e){if(e instanceof u.DebounceAbortError)return;throw e}this.getPlayingAudio()&&this.stopCurrentPlayingAudioState((0,p.getStopReasonForPlayReason)(i)??p.AudioPlayerStopAudioEventReason.Unknown),(0,s.runInAction)((()=>{this.implAudio=e,this.setState({isPlaying:!0,playingQueueState:a})}))}implStop(){this.impl.stop(),this.implAudio=null}seek(e){this.taskManager.seek(e)}fadeIn(){this.taskManager.setVolume(this._volume,!0,1500)}fadeOut(){this.taskManager.setVolume(0,!0,1500)}getPlayingAudio(){return this.state.playingQueueState?.audio??null}getVolume(){return this._volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(e,t){this.myTracker=e,this.visibilityObserver=_.PageVisibilityObserver.ensure(),this.eventBus=new P.EventBus,this.pendingImplAudio=null,this.implAudio=null,this.listenedTime=0,this.pausedByVisibility=!1,this._volume=f.DEFAULT_VOLUME,this.fading=!1,this._progress=0,this._playedTime=0,this.queue=new w.AudioSnippetsPlayerQueue((e=>{this.setState({currentQueueState:e})})),this._state={isPlaying:!1,isPaused:!1,currentQueueState:this.queue.state,playingQueueState:null},this.implPlayUrl=(0,u.debounceTask)((async e=>{e&&(this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks()),await this.taskManager.play()})),this.handleVisibilityChange=e=>{e?this.pausedByVisibility&&(this.pausedByVisibility=!1,this.isPlaying||this.play(void 0,{reason:p.AudioPlayerPlayAudioEventReason.Autoplay})):this.isPlaying&&(this.pausedByVisibility=!0,this.pause(p.AudioPlayerPauseAudioEventReason.Paywall),this.notify(m.events.SNIPPET_PLAYER_PAUSED_BY_VISIBILITY),this.emitter.emit("paused",{reason:"visibility"}))},this.emitter=t.create(),this.switchConnection=a.MediaPlayersSwitch.ensure((0,c.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(p.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:(e={})=>{this.pause(p.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(m.events.SNIPPET_PLAYER_CHANGE_SOURCE),this.emitter.emit("changeSource"),e?.initiatedByCalls&&(this.notify(m.events.SNIPPET_PLAYER_PAUSED_BY_INCOMING_CALL),this.emitter.emit("paused",{reason:"call"}))},stop:()=>{this.stop(p.AudioPlayerStopAudioEventReason.Unknown)}});const i={onPause:()=>{this.setState({isPlaying:!1,isPaused:!0}),this.fading=!1,this.switchConnection.emit("pause")},onPlay:()=>{this.setState({isPlaying:!0,isPaused:!1}),this.fading=!1,this.switchConnection.emit("play")},onBufferUpdate:e=>{e&&this.notify(m.events.SNIPPET_BUFFERED,this.currentAudio)},onEnd:()=>{this.notify(m.events.SNIPPET_PLAYER_SNIPPET_PLAYING_END),this.playNext(),this.emitter.emit("end")},onFail:e=>{this.notify(m.events.SNIPPET_PLAYER_FAIL),this.stop(p.AudioPlayerStopAudioEventReason.Error),this.emitter.emit("fail")},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{(0,s.runInAction)((()=>{this._progress=e,this._playedTime=t})),this.listenedTime=t;const i=this.impl.getDuration();i&&i-t<v&&!this.fading&&(this.fading=!0,this.fadeOut()),this.notify(m.events.PROGRESS_SNIPPET,e,t),this.emitter.emit("progress",{progress:e,playedTime:t})},defaultVolume:0};this.visibilityObserver.on("change",this.handleVisibilityChange),this.eventBus=new P.EventBus,this.impl=new g.AudioPlayerHTML5(i),this.taskManager=new A.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,v),(0,y.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new h.AudioPlayerStatsListener(this)),(0,y.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new h.AudioPlayerMyTrackerListener(this,this.myTracker)),(0,s.makeAutoObservable)(this,{_state:s.observable.shallow})}}I=(0,o.__decorate)([n.scope.container(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[void 0===l.MyTracker?Object:l.MyTracker,void 0===r.EmitterFactory?Object:r.EmitterFactory])],I)},494360:(e,t,i)=>{i.d(t,{AudioSnippetsPlayerQueue:()=>l});var o=i(327813),s=i(930996);const a={lists:[],listIndex:0,list:null,audio:null,lastReason:null};class l{add(...e){e.length&&this.setState({lists:[...this.state.lists,...e.map((e=>({audios:e,audioIndex:0})))]})}reset(){this._state=a}findListByAudio(e){return this.state.lists.find((t=>t?.audios.includes(e)))?.audios}has(e,t){const i=this.state.lists.find((t=>t.audios===e))?.audios;return t?!!i?.includes(t):!!i}moveTo(e,t,i){const{current:o}=this;if(t===o.list?.audios&&i===o.audio)return;const{lists:s}=this.state,a=s.findIndex((e=>e?.audios===t)),l=s[a];if(!l)throw new Error("AudioSnippetsPlayerQueue.moveTo: list not found");const r=i?t.indexOf(i):l.audioIndex;if(r<0)throw new Error("AudioSnippetsPlayerQueue.moveTo: audio not found");const n=[...s];return n[a]={...n[a],audioIndex:r},this.setState({lists:n,listIndex:a,lastReason:e}),this.current}moveToPrev(){const{listIndex:e,lists:t}=this.state,{listIndex:i,audioIndex:o}=this.getPrevIndexes(),s=[...t];return s[e]&&(s[e]={...s[e],audioIndex:0}),s[i]&&(s[i]={...s[i],audioIndex:o}),this.setState({listIndex:i}),this.current}get prevAudio(){const{listIndex:e,audioIndex:t}=this.getPrevIndexes();return this.state.lists[e]?.audios[t]}moveToNext(){const{listIndex:e,lists:t}=this.state,{listIndex:i,audioIndex:o}=this.getNextIndexes(),s=[...t];return s[e]&&(s[e]={...s[e],audioIndex:0}),s[i]&&(s[i]={...s[i],audioIndex:o}),this.setState({lists:s,listIndex:i}),this.current}get nextAudio(){const{listIndex:e,audioIndex:t}=this.getNextIndexes();return this.state.lists[e]?.audios[t]}get currentList(){return this._state.list}get currentAudio(){return this._state.audio}get current(){return{list:this.currentList,audio:this.currentAudio}}get state(){return{...this.current,...this._state}}setState(e){const t={...this.state,...e},i=t.lists[t.listIndex]||null;t.list=i,t.audio=i&&i.audios[i.audioIndex]||null,(0,s.shallowEqual)(this.state,t)||(this._state=t,this.listener(this._state))}getPrevIndexes(){if(!this.currentList)return{listIndex:0,audioIndex:0};let e=this.currentList.audioIndex-1,{listIndex:t,lists:i}=this.state;return e<0&&(t--,t<0&&(t=i.length-1),e=Math.max(0,(i[t]?.audios.length??0)-1)),{listIndex:t,audioIndex:e}}getNextIndexes(){const{currentList:e}=this;if(!e)return{listIndex:0,audioIndex:0};let t=e.audioIndex+1,{listIndex:i,lists:o}=this.state;return t>=e.audios.length&&(i++,t=0),i>=o.length&&(i=0),{listIndex:i,audioIndex:t}}constructor(e){this._state=a,this.listener=e,(0,o.makeAutoObservable)(this)}}},355342:(e,t,i)=>{i.d(t,{AudioSnippetsPlayer:()=>o.AudioSnippetsPlayer});var o=i(907535)},836681:(e,t,i)=>{i.d(t,{PreviewAudioPlayer:()=>I,PreviewAudioPlayerNotification:()=>v});var o=i(327813),s=i(264544),a=i(689938),l=i(214450),r=i(121092),n=i(382399),d=i(476726),u=i(625330),_=i(620407),c=i(561418),h=i(514640),p=i(109465),y=i(7144),A=i(188143),g=i(122611);let P;const f=1.5,m={from:0,to:0},E={url:"",clip:m},w=e=>e/1e3,v={start:"audio_preview_start",stop:"audio_preview_stop",pause:"audio_preview_pause"};class I{get events(){return this.emitter.listenable}setCurrentTrackCode(e){this._currentTrackCode=e}setCurrentPreview(e){this.audioPreviewsState.set(e.identity,e)}getCurrentPreview(e){return this.audioPreviewsState.get(e)||E}initEvents(){const e=window.Notifier;e?(e.addRecvClbk("audio_start","preview",(()=>{this.playing&&(this.pausedByAudio=Date.now(),this.pause(g.AudioPlayerPauseAudioEventReason.ChannelAutoPause)),this.pausedByAudio=null})),e.addRecvClbk("video_start","preview",(()=>{this.playing&&(this.pause(g.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","preview",(()=>{!this.playing&&this.currentAudio?.url&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.play(this.currentAudio.identity,this.volume,g.AudioPlayerPlayAudioEventReason.ChannelAutoResume),this.pausedByVideo=null)})),e.addRecvClbk("logged_off","preview",(()=>{this.stop(),this.taskManager.clearAllTasks()})),e.addRecvClbk("stories_video_start","preview",(()=>{this.playing&&(this.pause(g.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByStories=(0,y.vkNow)())})),e.addRecvClbk("stories_video_end","preview",(()=>{!this.playing&&this.pausedByStories&&this.currentAudio&&((0,y.vkNow)()-this.pausedByStories<18e4&&this.play(this.currentAudio.identity,this.volume,g.AudioPlayerPlayAudioEventReason.ChannelAutoResume),this.pausedByStories=null)}))):console.log("[PreviewAudioPlayer]: notifier has not found!")}sendLCNotification(e){const t=window.Notifier;t&&t.lcSend(e)}static ensure(){return P||(P=new I),P}resetFailedAudio(){this.failedAudio=null}setCurrentAudio(e){this._currentAudio=e}async implPlay(e){this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks(),await this.taskManager.play(),this.sendLCNotification(v.start),this._playing=!0}async seek(e){const t=this.getPlayingAudio(),i=this.getCurrentProgressTime(),o=e-this.getCurrentProgress();await this.taskManager.seek(e),t&&this.emitter.emit("seek",{reason:o<0?g.AudioPlayerSeekEventReason.SliderBack:g.AudioPlayerSeekEventReason.SliderForward,audio:t,fromTime:i,progressTime:this.getCurrentProgressTime()})}async fallbackPlay(e){if(null===e)return;let t=e.url||"";const i=this.getCurrentPreview(e.identity),o=i.clip?i.clip.from:m.from;await this.implPlay(t),this.fadeIn(1500),this.seek(o/1e3)}fadeIn(e=300){this.taskManager.setVolume(this.volume,!0,e)}fadeOut(e=300){this.taskManager.setVolume(0,!0,e)}get previewLength(){if(this.currentAudio){const e=this.getCurrentPreview(this.currentAudio.identity);if(!e)return 0;if(e.clip){const{clip:t}=e;return w(t.to-t.from)}return 0}return 0}stop(e){const t=this.getPlayingAudio(),i=this.getCurrentProgressTime();this._playing=!1,this._currentAudio=null,this.impl.stop(),this.sendLCNotification(v.stop),this.switchConnection.emit("stop"),this.setPlaybackTime(0),this.setStatusPreview(h.events.STOP_PREVIEW),t&&this.emitter.emit("stopAudio",{audio:t,reason:e??g.AudioPlayerStopAudioEventReason.Unknown,progressTime:i})}resume(e){this._paused&&this.currentAudio&&this.currentAudio?.url&&this.play(this.currentAudio.identity,this.volume,e)}async pause(e){const t=this.getPlayingAudio(),i=this.getCurrentProgressTime();await this.taskManager.setVolume(0,!0),await this.taskManager.pause(),this.sendLCNotification(v.pause),t&&this.emitter.emit("pauseAudio",{audio:t,reason:e??g.AudioPlayerPauseAudioEventReason.Unknown,progressTime:i})}async play(e,t,i){this.setStatusPreview(h.events.PLAY_PREVIEW),this.volume=t||p.DEFAULT_VOLUME,this.taskManager.setVolume(0,!1),this.resetFailedAudio();const{url:o,clip:s}=this.getCurrentPreview(e);if(this._timelinePosition=s?.from??0,o){this.seek(0),await this.implPlay(o),this.fadeIn(1500);const e=this.getPlayingAudio();e&&this.emitter.emit("playAudio",{audio:e,reason:i??g.AudioPlayerPlayAudioEventReason.AudioButton,progressTime:this.getCurrentProgressTime()})}}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}get playbackDuration(){return this._playbackDuration}get timelinePosition(){return this._timelinePosition}set timelinePosition(e){this._timelinePosition=e}get currentAudio(){return this._currentAudio}get playing(){return this._playing}get paused(){return this._paused}get progress(){return this._progress}get playbackTime(){return this._playbackTime}get statusPreview(){return this._statusPreview}getPlayingAudio(){const{currentAudio:e}=this;if(e&&(this.playing||this.paused)){let t=(0,A.toSnippetAudioData)(e,this._currentTrackCode);return t?{...t,type:s.AudioType.MusicSnippet}:null}return null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}setProgress(e){this._progress=e}setPlaybackTime(e){this._playbackTime=e}setPaused(e){this._paused=e}setStatusPreview(e){this._statusPreview=e}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,g.createAudioPlayerEventEmitter)((0,a.ensureDIRootWebContainer)()),this._playing=!1,this._paused=!1,this._progress=0,this._playbackTime=0,this._statusPreview=h.events.PLAY_PREVIEW,this._playbackDuration=0,this._timelinePosition=0,this.failedAudio=null,this.fading=!1,this.pausedByAudio=null,this.pausedByVideo=null,this.pausedByStories=null,this.listenedTime=0,this.audioPreviewsState=new Map,this.switchConnection=l.MediaPlayersSwitch.ensure((0,a.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(g.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:()=>{this.pause(g.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(h.events.SNIPPET_PLAYER_CHANGE_SOURCE)},stop:()=>{this.stop()}});const e={onPause:()=>{this._playing=!1,this.setPaused(!0),this.fading=!1,this.failedAudio||(this.notify(h.events.STOP_PREVIEW,this.currentAudio),this._playbackDuration=0,this._timelinePosition=0,this.switchConnection.emit("pause"))},onPlay:()=>{this._playing=!0,this.setPaused(!0),this.fading=!1,this._playbackDuration=0,this.notify(h.events.PLAY_PREVIEW,this.currentAudio),this.switchConnection.emit("play"),this.setStatusPreview(h.events.PLAY_PREVIEW)},onBufferUpdate:e=>{e&&this.notify(h.events.PREVIEW_BUFFERED,this.currentAudio)},onEnd:()=>{this.failedAudio||(this.notify(h.events.END_PREVIEW,this.currentAudio),this.setStatusPreview(h.events.END_PREVIEW))},onFail:e=>{if(this.failedAudio)return this.resetFailedAudio(),void this.stop(g.AudioPlayerStopAudioEventReason.Error);this.failedAudio=this.currentAudio;this.currentAudio;this.stop(g.AudioPlayerStopAudioEventReason.Error),this.fallbackPlay(this.failedAudio)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{const i=this.impl.getDuration();let o=m;this.listenedTime=t,this.currentAudio&&(o=this.getCurrentPreview(this.currentAudio.identity).clip??m),this.failedAudio&&(o=this.getCurrentPreview(this.failedAudio.identity).clip??m),i&&i-t<f&&!this.fading&&(this.fading=!0,this.fadeOut(1500));const s=(o.to-o.from)/1e3,a=(l=e,r=i,Math.round(l*r));var l,r,n,d;if(this._playbackDuration=a,this._timelinePosition=(n=w(o.from),d=this._playbackDuration,n+d),this.currentAudio){const i=Math.round(w(o.from)+t);return this.setProgress(e),this.setPlaybackTime(i),void this.notify(h.events.PROGRESS_PREVIEW,e,i)}if(a&&a===this._playbackDuration)return;const u=a?a-o.from/100:0,_=u/s,c=Math.round(t);this.setProgress(e),this.setPlaybackTime(0),this.notify(h.events.PROGRESS_PREVIEW,_,c);u>o.to/1e3&&(this.resetFailedAudio(),this.stop())},defaultVolume:0};this.eventBus=new c.EventBus,this.impl=new _.AudioPlayerHTML5(e),this.taskManager=new u.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,f),this.initEvents(),(0,d.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new n.AudioPlayerStatsListener(this)),(0,d.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new n.AudioPlayerMyTrackerListener(this,(0,a.ensureDIRootWebContainer)().resolve(r.MyTracker))),(0,o.makeAutoObservable)(this)}}},191457:(e,t,i)=>{i.d(t,{PreviewAudioPlayerEffector:()=>T});var o=i(264544),s=i(689938),a=i(214450),l=i(121092),r=i(382399),n=i(476726),d=i(625330),u=i(620407),_=i(561418),c=i(514640),h=i(355110),p=i(109465),y=i(284353),A=i(7144),g=i(188143),P=i(122611);let f;const m=1.5,E={from:0,to:0},w={url:"",clip:E},v=e=>e/1e3,I="audio_preview_start",C="audio_preview_stop",b="audio_preview_pause";class T{get events(){return this.emitter.listenable}getCurrentPreview(e){return h.audioPreviewsService.$audioPreviewEntities.getState()[e]||w}initEvents(){const e=window.Notifier;e?(e.addRecvClbk("audio_start","preview",(()=>{this.playing&&(this.pausedByAudio=Date.now(),this.pause(P.AudioPlayerPauseAudioEventReason.ChannelAutoPause)),this.pausedByAudio=null})),e.addRecvClbk("video_start","preview",(()=>{this.playing&&(this.pause(P.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","preview",(()=>{if(!this.playing&&this.currentAudio?.url&&this.pausedByVideo){if(Date.now()-this.pausedByVideo<18e4){const{url:e}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(e,this.volume,P.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByVideo=null}})),e.addRecvClbk("logged_off","preview",(()=>{this.stop(),this.taskManager.clearAllTasks()})),e.addRecvClbk("stories_video_start","preview",(()=>{this.playing&&(this.pause(P.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByStories=(0,A.vkNow)())})),e.addRecvClbk("stories_video_end","preview",(()=>{if(!this.playing&&this.pausedByStories){if((0,A.vkNow)()-this.pausedByStories<18e4){const{url:e}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(e,this.volume,P.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByStories=null}}))):console.log("[PreviewAudioPlayerEffector]: notifier has not found!")}sendLCNotification(e){const t=window.Notifier;t&&t.lcSend(e)}static ensure(){return f||(f=new T),f}resetFailedAudio(){this.failedAudio=null}setCurrentAudio(e){this._currentAudio=e}async implPlay(e){this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks(),await this.taskManager.play(),this.sendLCNotification(I),this._playing=!0}async seek(e){const t=this.getPlayingAudio(),i=this.getCurrentProgressTime(),o=e-this.getCurrentProgress();await this.taskManager.seek(e),t&&this.emitter.emit("seek",{reason:o<0?P.AudioPlayerSeekEventReason.SliderBack:P.AudioPlayerSeekEventReason.SliderForward,audio:t,fromTime:i,progressTime:this.getCurrentProgressTime()})}async fallbackPlay(e,t){const[i,o]=e.split("_");let s=t||"";if(!s){const t=(0,y.ensureAudiosService)();await t.fetchAudiosFx([{ownerId:+i,id:+o}]);const a=t.$audioEntities.getState()[e];s=a?.url??""}const a=this.getCurrentPreview(`${i}_${o}`).clip.from;await this.implPlay(s),this.fadeIn(1500),this.seek(a/1e3)}fadeIn(e=300){this.taskManager.setVolume(this.volume,!0,e)}fadeOut(e=300){this.taskManager.setVolume(0,!0,e)}get previewLength(){const e=this.currentAudio?.fullId;if(e){const t=this.getCurrentPreview(e);if(!t)return 0;const{clip:i}=t;return v(i.to-i.from)}return 0}get playbackDuration(){return this._playbackDuration}get timelinePosition(){return this._timelinePosition}set timelinePosition(e){this._timelinePosition=e}stop(e){const t=this.getPlayingAudio(),i=this.getCurrentProgressTime();this._playing=!1,this._currentAudio=null,this.impl.stop(),this.sendLCNotification(C),this.switchConnection.emit("stop"),t&&this.emitter.emit("stopAudio",{audio:t,reason:e??P.AudioPlayerStopAudioEventReason.Unknown,progressTime:i})}resume(e){if(!this._paused||!this.currentAudio?.url)return;const{url:t}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(t,this.volume,e)}async pause(e){const t=this.getPlayingAudio(),i=this.getCurrentProgressTime();await this.taskManager.setVolume(0,!0),await this.taskManager.pause(),this.sendLCNotification(b),t&&this.emitter.emit("pauseAudio",{audio:t,reason:e??P.AudioPlayerPauseAudioEventReason.Unknown,progressTime:i})}async play(e,t,i){this.volume=t||p.DEFAULT_VOLUME,this.taskManager.setVolume(0,!1),this.resetFailedAudio();const{url:o,clip:s}=this.getCurrentPreview(e);if(this._timelinePosition=s?.from??0,o){this.seek(0),await this.implPlay(o),this.fadeIn(1500);const e=this.getPlayingAudio();e&&this.emitter.emit("playAudio",{audio:e,reason:i??P.AudioPlayerPlayAudioEventReason.AudioButton,progressTime:this.getCurrentProgressTime()})}}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}get currentAudio(){return this._currentAudio}get playing(){return this._playing}get paused(){return this._paused}getPlayingAudio(){const{currentAudio:e}=this;if(e&&(this.playing||this.paused)){let t=(0,g.toTrackedAudioData)(e);if(!t)return null;if(t.type!==o.AudioType.MusicTrack)throw new Error(`Invalid preview audio type: ${t.type}`);return{...t,type:o.AudioType.MusicSnippet}}return null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,P.createAudioPlayerEventEmitter)((0,s.ensureDIRootWebContainer)()),this._playing=!1,this._paused=!1,this.failedAudio=null,this.fading=!1,this._playbackDuration=0,this._timelinePosition=0,this.pausedByAudio=null,this.pausedByVideo=null,this.pausedByStories=null,this.listenedTime=0,this.switchConnection=a.MediaPlayersSwitch.ensure((0,s.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(P.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:()=>{this.pause(P.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(c.events.SNIPPET_PLAYER_CHANGE_SOURCE)},stop:()=>{this.stop()}});const e={onPause:()=>{this._playing=!1,this._paused=!0,this.fading=!1,this.failedAudio||(this.notify(c.events.STOP_PREVIEW,this.currentAudio),this._playbackDuration=0,this._timelinePosition=0,this.switchConnection.emit("pause"))},onPlay:()=>{this._playing=!0,this._paused=!1,this.fading=!1,this._playbackDuration=0,this.notify(c.events.PLAY_PREVIEW,this.currentAudio),this.switchConnection.emit("play")},onBufferUpdate:e=>{e&&this.notify(c.events.PREVIEW_BUFFERED,this.currentAudio)},onEnd:()=>{this.failedAudio||this.notify(c.events.END_PREVIEW,this.currentAudio)},onFail:e=>{if(this.failedAudio)return this.resetFailedAudio(),void this.stop(P.AudioPlayerStopAudioEventReason.Error);this.failedAudio=this.currentAudio;this.currentAudio;this.stop(P.AudioPlayerStopAudioEventReason.Error);let t=this.failedAudio?.fullId??"";this.fallbackPlay(t,this.failedAudio?.url)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{const i=this.impl.getDuration();let o=E;this.listenedTime=t,this.currentAudio&&(o=this.getCurrentPreview(this.currentAudio.fullId).clip),this.failedAudio&&(o=this.getCurrentPreview(this.failedAudio.fullId).clip),i&&i-t<m&&!this.fading&&(this.fading=!0,this.fadeOut(1500));const s=(o.to-o.from)/1e3,a=(l=e,r=i,Math.round(l*r));var l,r,n,d;if(this._playbackDuration=a,this._timelinePosition=(n=v(o.from),d=this._playbackDuration,n+d),this.currentAudio){const i=Math.round(v(o.from)+t);return void this.notify(c.events.PROGRESS_PREVIEW,e,i)}if(a&&a===this._playbackDuration)return;const u=a?a-o.from/100:0,_=u/s,h=Math.round(t);Math.round(v(o.from)-t);this.notify(c.events.PROGRESS_PREVIEW,_,h);u>o.to/1e3&&(this.resetFailedAudio(),this.stop())},defaultVolume:0};this.eventBus=new _.EventBus,this.impl=new u.AudioPlayerHTML5(e),this.taskManager=new d.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,m),this.initEvents(),(0,n.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new r.AudioPlayerStatsListener(this)),(0,n.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new r.AudioPlayerMyTrackerListener(this,(0,s.ensureDIRootWebContainer)().resolve(l.MyTracker)))}}},802800:(e,t,i)=>{i.d(t,{WebAudioPlayerAdapter:()=>c});var o=i(689938),s=i(572466),a=i(205971),l=i(620626),r=i(148818),n=i(997508),d=i(787654),u=i(706436),_=i(159995);class c{playAudio(e,t,i,a){const n=new r.WebPlayerAdapter(this.webAudioPlayer,(0,o.ensureDIRootWebContainer)().resolve(s.EmitterFactory)).getPlaylistId(),u=a?this.webAudioPlayer.getPlaylist(a.type,a.ownerId,a.albumId,"",a.blockId,a.context):n?this.webAudioPlayer.getCurrentPlaylist():this.webAudioPlayer.getPlaylist(l.AudioPlaylist.TYPE_TEMP,window.vk.id),_=(0,d.apiAudioToAudioTuple)(e),c=t?.map((e=>(0,d.apiAudioToAudioTuple)(e)));this.webAudioPlayer.getPlaylistQueue().setSortedQueue(c),this.webAudioPlayer.playAudioItem({audio:_,playlist:u,context:i})}playPlaylist(e,t){this.webAudioPlayer.playPlaylist(e.owner_id,e.id,e.access_key,t)}playBlockPlaylist(e){const t=this.webAudioPlayer.getCurrentPlaylist(),i=this.webAudioPlayer.getPlaylistByBlockId(e)||new l.AudioPlaylist({hasMore:!0,blockId:e});if(t&&t.equals(i)&&this.webAudioPlayer.isPlaying())this.webAudioPlayer.pauseByButton();else{const e=i.getContext();i.loadByBlockId("",(t=>{this.webAudioPlayer.playList({audio:t.getAudiosList()[0],playlist:t,context:e})}))}}playRadio(e,t,i,o){const s=this.webAudioPlayer.getPlaylist(a.AudioPlayerAdapterPlaylistType.RADIO,t.ownerId,_.RADIO_PLAYLIST_ID,void 0,t.blockId),l=(0,u.apiRadioToAudioTuple)(e,o),r=i?.map((e=>(0,u.apiRadioToAudioTuple)(e,o)));r&&this.webAudioPlayer.getPlaylistQueue().setSortedQueue(r),this.webAudioPlayer.playAudioItem({audio:l,playlist:s,context:o})}playPreviousAudio(){this.webAudioPlayer.playPrev()}playNextAudio(){this.webAudioPlayer.playNext()}pauseByButton(){this.webAudioPlayer.pauseByButton()}pauseByChangeChannel(){this.webAudioPlayer.pauseByChangeChannel()}pause(){this.webAudioPlayer.pause()}resume(){this.webAudioPlayer.resume()}stop(){this.webAudioPlayer.stop()}setVolume(e){this.webAudioPlayer.setVolume(e)}setCurrentAudioProgress(e){this.webAudioPlayer.seek(e)}getCurrentAudio(){return(0,n.audioTupleToApiAudio)(this.webAudioPlayer.getCurrentAudio())}getCurrentAudioProgress(){return this.webAudioPlayer.getCurrentProgress()}getCurrentAudioVolume(){return this.webAudioPlayer.getVolume()}getCurrentPlaylist(){const e=this.webAudioPlayer.getCurrentPlaylist();if(!e)return null;const t=e.getPlaylistId(),i=e.getOwnerId();if("string"==typeof t)return null;const o=e.getCoverUrl(),s=o?{width:300,height:300,photo_300:o,sizes:[{width:300,height:300,src:o,type:"z"}]}:void 0,a={access_key:e.getAccessHash(),title:e.getTitle(),subtitle:e.getSubtitle(),count:e.getTotalCount(),plays:e.getListens(),update_time:e.getLastUpdated(),is_following:e.isFollowed(),album_type:e.getType(),description:e.getDescription(),photo:s,thumbs:s?[s]:void 0};return e?.isFollowed?.()?a.original={owner_id:i,playlist_id:t,access_key:e.getAccessHash()}:(a.owner_id=i,a.id=t),a}getCurrentPlaylistId(){return this.webAudioPlayer.getCurrentPlaylist()?.getPlaylistId()}subscribe(e,t,i){return this.webAudioPlayer.on(i,e,t)}unsubscribe(e,t,i){if(void 0!==i)return this.webAudioPlayer.off(i)}isPlaying(){return this.webAudioPlayer.isPlaying()}notify(e,...t){this.webAudioPlayer.notify(e,...t)}constructor(e){this.webAudioPlayer=e,this.ads=e.ads}}},349091:(e,t,i)=>{i.d(t,{WebQueueListener:()=>s});var o=i(398128);class s extends o.QueueListener{connect(e){e&&this.listenQueueKey!==e.key&&(this.connected=!0,this.listenQueueKey=e.key,window.Notifier.addKey({key:e.key,ts:e.timestamp},((e,t)=>this.queueHandler(t))))}constructor(e){super(e)}}},868578:(e,t,i)=>{i.d(t,{AudioSnippetsPlayer:()=>E});var o=i(930996),s=i(450507),a=i(933693),l=i(214450),r=i(121092),n=i(689938),d=i(382399),u=i(476726),_=i(625330),c=i(620407),h=i(561418),p=i(109465),y=i(514640),A=i(541843),g=i(13709),P=i(122611);const f=1.5;let m=null;class E{get events(){return this.emitter.listenable}static ensure(){return m||(m=new E),m}getState(){return this.state}setState(e){const t=this.getState(),i={...this.state,...e};(0,o.shallowEqual)(this.state,i)||(this.state=i,(0,o.shallowEqual)(i.currentQueueState,t.currentQueueState)||this.currentQueueStateDidChange(),this.notify(y.events.SNIPPET_PLAYER_STATE_CHANGED,this.getState()))}currentQueueStateDidChange(){const{pendingImplAudio:e,isPlaying:t}=this,i=this.getState(),{currentQueueState:s,playingQueueState:a}=i,{list:l,audio:r,lastReason:n}=s;!t||e&&e===r||(0,o.shallowEqual)(s,a)||r&&l&&this.play(r,{list:l.audios,reason:n??P.AudioPlayerPlayAudioEventReason.Unknown})}get isPlaying(){return this.state.isPlaying||!!this.pendingImplAudio}reset(){this.pausedByVisibility=!1,this.stop(P.AudioPlayerStopAudioEventReason.Unknown),this.queue.reset()}get currentAudio(){return this.queue.currentAudio||null}addToQueue(...e){this.queue.add(...e)}async resume(e){this.state.isPaused&&await this.play(void 0,{reason:e})}async play(e,{list:t,volume:i,reason:o}={}){const s=e||this.currentAudio;if(!s)throw new Error("[AudioSnippetPlayer]: Audio is not defined");let a=t;a||(a=this.queue.findListByAudio(s),a||(a=[s],this.addToQueue(a))),this.queue.moveTo(o??P.AudioPlayerPlayAudioEventReason.AudioButton,a,s),await this.implPlayAudio(s,i,o)}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}stop(e){this.stopCurrentPlayingAudioState(e),this.implStop(),this.notify(y.events.STOP_SNIPPET),this.switchConnection.emit("stop")}stopCurrentPlayingAudioState(e){const t=this.state.playingQueueState?.audio,i=this.getCurrentProgressTime();this.setState({isPlaying:!1,playingQueueState:null}),t&&this.emitter.emit("stopAudio",{reason:e??P.AudioPlayerStopAudioEventReason.Unknown,audio:t,progressTime:i})}async playNext(){const{audio:e,list:t}=this.queue.moveToNext();e&&t&&(await this.play(e,{list:t.audios,reason:P.AudioPlayerPlayAudioEventReason.NextButton}),this.notify(y.events.SNIPPET_PLAYER_PLAY_NEXT_SNIPPET))}async playPrev(){const{audio:e,list:t}=this.queue.moveToPrev();e&&t&&(await this.play(e,{list:t.audios,reason:P.AudioPlayerPlayAudioEventReason.PrevButton}),this.notify(y.events.SNIPPET_PLAYER_PLAY_PREV_SNIPPET))}async pause(e){const{isPlaying:t}=this.state,i=this.state.playingQueueState?.audio,o=this.getCurrentProgressTime();this.taskManager.setVolume(0,!0),await this.taskManager.pause(),t&&i&&this.emitter.emit("pauseAudio",{reason:e??P.AudioPlayerPauseAudioEventReason.Unknown,audio:i,progressTime:o})}async implPlayAudio(e,t,i){if(e!==this.pendingImplAudio){g.AudioPlayer._sendLCNotification();try{this.pendingImplAudio=e,e===this.implAudio?await this.implPlayUrl():await this.implChangeAudio(e,t,i)}finally{this.pendingImplAudio=null}this.fadeIn(),e===this.getPlayingAudio()&&this.emitter.emit("playAudio",{reason:i??P.AudioPlayerPlayAudioEventReason.Unknown,audio:e,progressTime:0})}}async implChangeAudio(e,t,i){this.setState({isPlaying:!1}),this.getPlayingAudio()&&(this.stopCurrentPlayingAudioState((0,P.getStopReasonForPlayReason)(i)??P.AudioPlayerStopAudioEventReason.Unknown),this.implStop()),this.volume=t||this.volume,this.taskManager.setVolume(0,!1);const o=e.url;if(!o)return;this.seek(0);const a=this.queue.getState();try{await this.implPlayUrl(o)}catch(e){if(e instanceof s.DebounceAbortError)return;throw e}this.getPlayingAudio()&&this.stopCurrentPlayingAudioState((0,P.getStopReasonForPlayReason)(i)??P.AudioPlayerStopAudioEventReason.Unknown),this.implAudio=e,this.setState({isPlaying:!0,playingQueueState:a})}implStop(){this.impl.stop(),this.implAudio=null}seek(e){this.taskManager.seek(e)}fadeIn(){this.taskManager.setVolume(this.volume,!0,1500)}fadeOut(){this.taskManager.setVolume(0,!0,1500)}getPlayingAudio(){return this.state.playingQueueState?.audio??null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,P.createAudioPlayerEventEmitter)((0,n.ensureDIRootWebContainer)()),this.visibilityObserver=a.PageVisibilityObserver.ensure(),this.eventBus=new h.EventBus,this.pendingImplAudio=null,this.implAudio=null,this.listenedTime=0,this.pausedByVisibility=!1,this.volume=p.DEFAULT_VOLUME,this.fading=!1,this.queue=new A.AudioSnippetsPlayerQueue((e=>{this.setState({currentQueueState:e})})),this.implPlayUrl=(0,s.debounceTask)((async e=>{e&&(this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks()),await this.taskManager.play()})),this.handleVisibilityChange=e=>{e?this.pausedByVisibility&&(this.pausedByVisibility=!1,this.isPlaying||this.play(void 0,{reason:P.AudioPlayerPlayAudioEventReason.Autoplay})):this.isPlaying&&(this.pausedByVisibility=!0,this.pause(P.AudioPlayerPauseAudioEventReason.Paywall),this.notify(y.events.SNIPPET_PLAYER_PAUSED_BY_VISIBILITY))},this.state={isPlaying:!1,isPaused:!1,currentQueueState:this.queue.getState(),playingQueueState:null},this.switchConnection=l.MediaPlayersSwitch.ensure((0,n.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(P.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:(e={})=>{this.pause(P.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(y.events.SNIPPET_PLAYER_CHANGE_SOURCE),e?.initiatedByCalls&&this.notify(y.events.SNIPPET_PLAYER_PAUSED_BY_INCOMING_CALL)},stop:()=>{this.stop(P.AudioPlayerStopAudioEventReason.Unknown)}});const e={onPause:()=>{this.setState({isPlaying:!1,isPaused:!0}),this.fading=!1,this.switchConnection.emit("pause")},onPlay:()=>{this.setState({isPlaying:!0,isPaused:!1}),this.fading=!1,this.switchConnection.emit("play")},onBufferUpdate:e=>{e&&this.notify(y.events.SNIPPET_BUFFERED,this.currentAudio)},onEnd:()=>{this.notify(y.events.SNIPPET_PLAYER_SNIPPET_PLAYING_END),this.playNext()},onFail:e=>{this.notify(y.events.SNIPPET_PLAYER_FAIL),this.stop(P.AudioPlayerStopAudioEventReason.Error)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{this.listenedTime=t;const i=this.impl.getDuration();i&&i-t<f&&!this.fading&&(this.fading=!0,this.fadeOut()),this.notify(y.events.PROGRESS_SNIPPET,e,t)},defaultVolume:0};this.visibilityObserver.on("change",this.handleVisibilityChange),this.eventBus=new h.EventBus,this.impl=new c.AudioPlayerHTML5(e),this.taskManager=new _.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,f),(0,u.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new d.AudioPlayerStatsListener(this)),(0,u.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new d.AudioPlayerMyTrackerListener(this,(0,n.ensureDIRootWebContainer)().resolve(r.MyTracker)))}}},541843:(e,t,i)=>{i.d(t,{AudioSnippetsPlayerQueue:()=>a});var o=i(930996);const s={lists:[],listIndex:0,list:null,audio:null,lastReason:null};class a{add(...e){e.length&&this.setState({lists:[...this.state.lists,...e.map((e=>({audios:e,audioIndex:0})))]})}reset(){this.state=s}findListByAudio(e){return this.state.lists.find((t=>t?.audios.includes(e)))?.audios}has(e,t){const i=this.state.lists.find((t=>t.audios===e))?.audios;return t?!!i?.includes(t):!!i}moveTo(e,t,i){const{current:o}=this;if(t===o.list?.audios&&i===o.audio)return;const{lists:s}=this.state,a=s.findIndex((e=>e?.audios===t)),l=s[a];if(!l)throw new Error("AudioSnippetsPlayerQueue.moveTo: list not found");const r=i?t.indexOf(i):l.audioIndex;if(r<0)throw new Error("AudioSnippetsPlayerQueue.moveTo: audio not found");const n=[...s];return n[a]={...n[a],audioIndex:r},this.setState({lists:n,listIndex:a,lastReason:e}),this.current}moveToPrev(){const{listIndex:e,lists:t}=this.state,{listIndex:i,audioIndex:o}=this.getPrevIndexes(),s=[...t];return s[e]&&(s[e]={...s[e],audioIndex:0}),s[i]&&(s[i]={...s[i],audioIndex:o}),this.setState({listIndex:i}),this.current}get prevAudio(){const{listIndex:e,audioIndex:t}=this.getPrevIndexes();return this.state.lists[e]?.audios[t]}moveToNext(){const{listIndex:e,lists:t}=this.state,{listIndex:i,audioIndex:o}=this.getNextIndexes(),s=[...t];return s[e]&&(s[e]={...s[e],audioIndex:0}),s[i]&&(s[i]={...s[i],audioIndex:o}),this.setState({lists:s,listIndex:i}),this.current}get nextAudio(){const{listIndex:e,audioIndex:t}=this.getNextIndexes();return this.state.lists[e]?.audios[t]}get currentList(){return this.state.list}get currentAudio(){return this.state.audio}get current(){return{list:this.currentList,audio:this.currentAudio}}getState(){return{...this.current,lists:this.state.lists,listIndex:this.state.listIndex,lastReason:this.state.lastReason}}setState(e){const t={...this.state,...e},i=t.lists[t.listIndex]||null;t.list=i,t.audio=i&&i.audios[i.audioIndex]||null,(0,o.shallowEqual)(this.state,t)||(this.state=t,this.listener(this.getState()))}getPrevIndexes(){if(!this.currentList)return{listIndex:0,audioIndex:0};let e=this.currentList.audioIndex-1,{listIndex:t,lists:i}=this.state;return e<0&&(t--,t<0&&(t=i.length-1),e=Math.max(0,(i[t]?.audios.length??0)-1)),{listIndex:t,audioIndex:e}}getNextIndexes(){const{currentList:e}=this;if(!e)return{listIndex:0,audioIndex:0};let t=e.audioIndex+1,{listIndex:i,lists:o}=this.state;return t>=e.audios.length&&(i++,t=0),i>=o.length&&(i=0),{listIndex:i,audioIndex:t}}constructor(e){this.state=s,this.listener=e}}},678515:(e,t,i)=>{i.d(t,{AudioSnippetsPlayer:()=>o.AudioSnippetsPlayer});var o=i(868578)},727412:(e,t,i)=>{i.d(t,{speechLoader:()=>s,voiceMessagePlayerLoader:()=>o});const o=()=>window.AudioMessagePlayer&&window.AudioMessagePlayer.loaded?Promise.resolve(window.AudioMessagePlayer):Promise.all([i.e(79210),i.e(51713)]).then(i.bind(i,689488)).then((()=>window.AudioMessagePlayer)),s=()=>Promise.all([i.e(79210),i.e(9925)]).then(i.bind(i,31264))},31264:(e,t,i)=>{i.r(t);var o=i(407412),s=i(612627);const a={isSupport:()=>!(!window.AudioContext||!(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)),getAvailableMicrophones:()=>o.AudioRecorder.isSupport()?o.AudioRecorder.getAvailableMicrophones():Promise.resolve([]),newRecorder:()=>(window.Promise||(window.Promise=Promise),new o.AudioRecorder),resample:(e,t,i)=>(0,s.fastResample)(e,t,i),createVisualization:i(350655).createVisualization};window.Speech=a},174530:(e,t,i)=>{i.d(t,{AudioPlayerBlockApplication:()=>r});var o=i(474848),s=i(505954),a=i(664165),l=i(975903);function r(e){return(0,o.jsx)(s.AppRootProvider,{children:(0,o.jsx)(l.AudioPlayerBlockContext.Provider,{value:{isCompact:e.initData?.isCompact||!1},children:(0,o.jsx)(a.AudioPlayerBlockContainer,{...e})})})}},963553:(e,t,i)=>{i.d(t,{AudioPlayerBlockAdLink:()=>n});var o=i(474848),s=i(175712),a=i(707763),l=i(610989),r=i(490712);function n(){return(0,o.jsxs)(s.Join,{separator:" · ",children:[(0,o.jsx)("span",{children:l.getLang("global_audio_ad")}),(0,o.jsx)(a.AudioLink,{href:"/vk_music",onClick:()=>{(0,r.statlogsValueEvent)("audio_web_ad_link","click")},mode:"link",children:l.getLang("global_audio_ads_off")})]})}},956180:(e,t,i)=>{i.d(t,{AudioPlayerBlockAdLink:()=>o.AudioPlayerBlockAdLink});var o=i(963553)},926127:(e,t,i)=>{i.d(t,{AudioPlayerBlockAudioTitle:()=>n});var o=i(474848),s=i(175712),a=i(234337),l=i(707763),r=i(956180);function n({isAd:e,subtitle:t,title:i,...l}){return e?(0,o.jsx)(r.AudioPlayerBlockAdLink,{}):t?(0,o.jsxs)(s.Join,{separator:" ",children:[(0,o.jsx)(d,{title:i,...l}),(0,o.jsx)("span",{className:(0,a.getColorClass)("color_text_secondary"),children:t})]}):(0,o.jsx)(d,{title:i,...l})}function d({title:e,href:t,onClick:i}){return t?(0,o.jsx)(l.AudioLink,{href:t,onClick:i,mode:"primary",children:e}):(0,o.jsx)("span",{className:(0,a.getColorClass)("color_text_primary"),children:e})}},790302:(e,t,i)=>{i.d(t,{AudioPlayerBlockCompactLayout:()=>l});var o=i(474848),s=i(520276),a=i(936315);function l({isRadio:e,isEpisode:t}){return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:a.default.root,children:(0,o.jsx)(s.AudioPlayerBlockSectionsLayout,{compact:!0,isRadio:e,isEpisode:t})})})}},279917:(e,t,i)=>{i.d(t,{AudioPlayerBlockCompactLayout:()=>o.AudioPlayerBlockCompactLayout});var o=i(790302)},980454:(e,t,i)=>{i.d(t,{AudioPlayerBlockDefaultLayout:()=>p});var o=i(474848),s=i(428918),a=i(500774),l=i(520276),r=i(296540),n=i(452314),d=i(119265),u=i(688701),_=i(8520),c=i(903987);const h=d.AudioPageProxy.ensure();function p({isRadio:e,isEpisode:t}){const i=(0,r.useRef)(null),[d,p]=(0,r.useState)(!1),[y,A]=(0,r.useState)(!1),g=(0,r.useMemo)((()=>(0,n.getSize)("page_header_wrap")[1]),[]),P=(0,r.useCallback)((()=>{const e=(0,u.scrollGetY)(),t=i?.current?.clientHeight??0;let o=(0,n.getXY)(h.contentBlock)[1]??0;o>0&&(o-=16);const s=e>o,a=(0,_.isNumber)(t)?t-g+84:0,l=e<a+t;if(e<a)return A(!1),void p(!1);if(s!==d&&s!==y){if(s)return void p(!0);A(!1)}l&&A(!1)}),[d,y,g]);return(0,r.useEffect)((()=>{if(d===y)return;const e=setTimeout((()=>{A(d)}),0);return()=>{clearTimeout(e)}}),[d]),(0,r.useEffect)((()=>(window.addEventListener("scroll",P),()=>{window.removeEventListener("scroll",P)})),[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.Spacing,{size:d?72:16}),(0,o.jsx)("div",{className:(0,_.classNames)(d&&c.default.fixed,y&&c.default.shown),onTransitionEnd:()=>{y||p(!1)},ref:i,children:(0,o.jsx)(a.Group,{separator:"hide",noTopRounded:d,noBottomRounded:d,children:(0,o.jsx)(l.AudioPlayerBlockSectionsLayout,{isEpisode:t,isRadio:e})})})]})}},401541:(e,t,i)=>{i.d(t,{AudioPlayerBlockDefaultLayout:()=>o.AudioPlayerBlockDefaultLayout});var o=i(980454)},987304:(e,t,i)=>{i.d(t,{AudioPlayerBlockLayout:()=>l});var o=i(474848),s=i(401541),a=i(279917);function l({compact:e,isRadio:t,isEpisode:i}){return(0,o.jsx)(o.Fragment,{children:e?(0,o.jsx)(a.AudioPlayerBlockCompactLayout,{isRadio:t,isEpisode:i}):(0,o.jsx)(s.AudioPlayerBlockDefaultLayout,{isRadio:t,isEpisode:i})})}},801176:(e,t,i)=>{i.d(t,{AudioPlayerBlockLayout:()=>o.AudioPlayerBlockLayout});var o=i(987304)},747960:(e,t,i)=>{i.d(t,{AudioPlayerBlockSectionsLayout:()=>d});var o=i(474848),s=i(8520),a=i(634161),l=i(919880),r=i(907486),n=i(396434);function d({isRadio:e,isEpisode:t,compact:i=!1}){return(0,o.jsxs)("div",{"data-testid":"audioplayerblocksectionslayout",className:(0,s.classNames)(a.default.root,i&&a.default.compact,t&&a.default.episode,e&&a.default.radio),children:[(0,o.jsx)("div",{"data-testid":"audioplayerblocksectionslayout-playbackcontrols",className:a.default.playbackControls,children:(0,o.jsx)(l.AudioPlayerBlockPlaybackControlsContainer,{})}),(0,o.jsx)("div",{"data-testid":"audioplayerblocksectionslayout-playbackbody",className:a.default.playbackBody,children:(0,o.jsx)(r.AudioPlayerBlockPlaybackBodyContainer,{})}),(0,o.jsx)("div",{"data-testid":"audioplayerblocksectionslayout-usercontrols",className:a.default.userControls,children:(0,o.jsx)(n.AudioPlayerBlockUserControlsContainer,{})})]})}},520276:(e,t,i)=>{i.d(t,{AudioPlayerBlockSectionsLayout:()=>o.AudioPlayerBlockSectionsLayout});var o=i(747960)},853177:(e,t,i)=>{i.d(t,{LS_AUDIOPLAYER_BLOCK_NON_ZERO_VOLUME:()=>s,LS_AUDIOPLAYER_BLOCK_PREFIX:()=>o});const o="audioplayer_block_",s="non_zero_volume"},564126:(e,t,i)=>{i.d(t,{AudioBroadcastTooltipContainer:()=>A});var o=i(474848),s=i(349826),a=i(625134),l=i(428918),r=i(106412),n=i(234337),d=i(610989),u=i(818987),_=i(7034),c=i(47745),h=i(293721),p=i(296540);const{broadcastService:y}=(0,c.ensureAudioPlayerBlockService)();function A(){const e=(0,h.useUnit)(y.$isBroadcastActive),t=(0,h.useUnit)(y.$isProfileActive),i=(0,h.useUnit)(y.$broadcastClubs),c=(0,h.useUnit)(y.$isBroadcastInfoLoading),A=(0,h.useUnit)(y.$activeBroadcastClubIdsMap),g=(0,h.useUnit)(y.$loadingBroadcastClubIdsMap),P=(0,h.useUnit)(y.$isProfileActiveLoading),f=(0,h.useUnit)(y.$isResetBroadcastLoading),m=(0,h.useUnit)(y.toggleIsProfileActiveFx),E=(0,h.useUnit)(y.toggleIsActiveClubFx),w=(0,h.useUnit)(y.toggleBroadcastFx),v=(0,p.useMemo)((()=>Object.keys(g).length>0),[g]),I=(0,p.useMemo)((()=>e?"audio-player-block-broadcast-disable-button":"audio-player-block-broadcast-enable-button"),[e]);return(0,o.jsx)(s.DropdownActionSheet,{usePortal:!1,trigger:"hover",width:288,content:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.Header,{children:d.getLang("audio_player_block_broadcast_tooltip_title")}),(0,o.jsx)(l.Spacing,{size:9}),(0,o.jsx)(s.DropdownActionSheet.Item,{before:(0,o.jsx)(s.DropdownActionSheet.Checkbox,{type:"square",checked:t,readOnly:!0}),onClick:m,loading:P,disabled:P||f,keepOpen:!0,"data-testid":"audio-player-block-broadcast-profile-checkbox",children:d.getLang("audio_player_block_broadcast_tooltip_user_page_checkbox")}),i.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.DropdownActionSheet.Separator,{}),(0,o.jsx)(r.DropdownActionSubSheet,{loading:c,disabled:c||f,before:(0,o.jsx)(_.Icon20Users3Outline,{className:(0,n.getColorClass)("color_icon_secondary")}),maxHeight:178,sheet:(0,o.jsx)(o.Fragment,{children:i.map((e=>(0,o.jsx)(p.Fragment,{children:(0,o.jsx)(r.DropdownActionSubSheet.Item,{loading:Boolean(g[e.id]),disabled:Boolean(g[e.id])||f,before:(0,o.jsx)(s.DropdownActionSheet.Checkbox,{type:"square",checked:Boolean(A[e.id]),"data-testid":"audio-player-block-broadcast-club-checkbox",readOnly:!0}),onClick:()=>E(e.id),keepOpen:!0,children:e.title})},e.id)))}),children:d.getLang("audio_player_block_broadcast_tooltip_clubs_container_title")})]})]}),children:(0,o.jsx)(u.AudioBroadcastIconButton,{active:e,noPadding:!0,hoverMode:"opacity",activeMode:"opacity","aria-label":d.getLang("audio_player_block_broadcast_tooltip_title"),onClick:w,disabled:f||P||v,"data-testid":I})})}},840953:(e,t,i)=>{i.d(t,{AudioBroadcastTooltipContainer:()=>o.AudioBroadcastTooltipContainer});var o=i(564126)},487390:(e,t,i)=>{i.d(t,{AudioPlayerBlockContainer:()=>u});var o=i(474848),s=i(296540),a=i(293721),l=i(367001),r=i(975903),n=i(801176);const d=(0,l.ensureAudioPlayerBlockService)();function u(e){const t=(0,a.useUnit)(d.init),{isCompact:i}=(0,r.useAudioPlayerBlockContext)(),l=(0,a.useUnit)(d.$isRadio),u=(0,a.useUnit)(d.$isEpisode);return(0,s.useEffect)((()=>{t(e.initData)}),[]),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(n.AudioPlayerBlockLayout,{compact:i,isRadio:l,isEpisode:u})})}},664165:(e,t,i)=>{i.d(t,{AudioPlayerBlockContainer:()=>o.AudioPlayerBlockContainer});var o=i(487390)},349958:(e,t,i)=>{i.d(t,{AudioPlayerBlockPlaybackBodyContainer:()=>x});var o=i(474848),s=i(293721),a=i(367001),l=i(975903),r=i(510251),n=i(650223),d=i(393183),u=i(707763),_=i(378021),c=i(687389),h=i(659931),p=i(320830),y=i(776372),A=i(377037),g=i(818987),P=i(296540),f=i(490712),m=i(610989),E=i(927984),w=i(505773),v=i(996538),I=i(476726),C=i(926127),b=i(760325),T=i(287013);const k=(0,I.partConfigEnabled)("dislikes_web_enabled")||(0,I.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled"),L=(0,a.ensureAudioPlayerBlockService)(),{playerService:M,dislikesService:S,myMusicService:D,groupsMusicService:O}=L;function x(){const{isCompact:e}=(0,l.useAudioPlayerBlockContext)(),t=(0,P.useRef)(null),i=(0,s.useUnit)(L.$currentGroupId),a=(0,s.useUnit)(L.$currentAudio),I=(0,s.useUnit)(L.$isRadio),x=(0,s.useUnit)(L.$isEpisode),R=(0,s.useUnit)(L.$audioFullId),U=(0,s.useUnit)(L.$audioTitle),B=(0,s.useUnit)(L.$audioSubtitle),N=(0,s.useUnit)(L.$audioLink),F=(0,s.useUnit)(L.$audioPerformer),j=(0,s.useUnit)(L.$audioHasLyrics),W=(0,s.useUnit)(L.$artist),K=(0,s.useUnit)(L.$coverSrc),$=(0,s.useUnit)(L.$isExplicit),H=(0,s.useUnit)(L.$duration),Y=(0,s.useUnit)(D.$isAudioAddedToMyMusic),V=(0,s.useUnit)(D.$canAddAudioToMyMusic),Q=(0,s.useUnit)(D.$isMyMusicActionLoading),G=(0,s.useUnit)(O.$isAudioAddedToCurrentGroup),q=(0,s.useUnit)(O.$canAddAudioToCurrentGroup),X=(0,s.useUnit)(O.$isGroupsMusicActionLoading),z=(0,s.useUnit)(S.$isAudioDisliked),J=(0,s.useUnit)(S.$isDislikeActionLoading),Z=(0,s.useUnit)(M.$isPending),ee=(0,s.useUnit)(M.$progress),te=(0,s.useUnit)(M.$loadingProgress),ie=(0,s.useUnit)(M.$negativeDurationTypeEnabled),oe=(0,s.useUnit)(M.$isAd),se=(0,s.useUnit)(M.$currentAd),ae=(0,s.useUnit)(L.showLyricsFx),le=(0,s.useUnit)(D.addFx),re=(0,s.useUnit)(D.deleteFx),ne=(0,s.useUnit)(O.addFx),de=(0,s.useUnit)(O.deleteFx),ue=(0,s.useUnit)(S.addFx),_e=(0,s.useUnit)(S.removeFx),ce=(0,s.useUnit)(M.seekBySliderFx),he=(0,s.useUnit)(M.toggleNegativeDurationTypeFx),pe=(0,A.useArtists)(W?.main??[]),ye=(0,A.useArtists)(W?.feat??[]),Ae=R?`/audio?audio_id=${R}&section=recoms_audio`:void 0,ge=(0,P.useMemo)((()=>(0,b.isNumber)(i)?G?m.getLang("audio_player_block_remove_from_group_hint"):m.getLang("audio_player_block_add_to_group_hint"):Y?m.getLang("audio_player_block_remove_from_my_music_hint"):m.getLang("audio_player_block_add_to_my_music_hint")),[Y,G,i]),Pe=(0,P.useMemo)((()=>(0,b.isNumber)(i)?G?"audio-player-block-delete-audio-to-group-button":"audio-player-block-add-audio-from-group-button":Y?"audio-player-block-delete-audio-to-my-music-button":"audio-player-block-add-audio-from-my-music-button"),[Y,G,i]),fe=(0,P.useMemo)((()=>z?"audio-player-block-remove-dislike-button":"audio-player-block-add-dislike-button"),[z]),me=(0,P.useMemo)((()=>0!==pe.length&&0!==ye.length&&F?`/audio?performer=1&q=${encodeURIComponent(F)}`:null),[pe,ye,F]),Ee=(0,P.useMemo)((()=>F?(0,T.decodeHTML)(F):null),[F]),we=(0,P.useCallback)((e=>{x&&(0,E.showPodcast)(t.current,R,e,"player")}),[R,x]),ve=(0,P.useCallback)((()=>{(0,f.statlogsValueEvent)("audio_recoms_by_track_button_click",!0)}),[R]),Ie=(0,P.useCallback)((e=>{const{currentTarget:t}=e,i=w.AudioAdActionsModalController.ensure(),o=t?.closest?.(`.${v.AUDIO_LAYER_CONTAINER_CLASS_NAME}`);i.isOpen(t)?i.close(t):se&&i.open(t,se,o||void 0)}),[se]),Ce=Boolean(me)&&Boolean(Ee);return(0,o.jsx)("div",{ref:t,children:(0,o.jsxs)(r.AudioPlayerPlaybackBody,{size:e?"s":"m",cover:oe?null:(0,o.jsx)(n.AudioPlayerAudioCover,{size:e?"s":"m",src:K??void 0,"data-testid":"audio-player-block-audio-cover"}),audioInfo:(0,o.jsx)(d.AudioPlayerAudioInfo,{ageRated:$&&!oe,title:(0,o.jsx)(C.AudioPlayerBlockAudioTitle,{isAd:oe,title:U,subtitle:B,href:N,onClick:x?we:void 0,"data-testid":"audio-player-block-audio-title"}),subtitle:oe?m.getLang("global_audio_ad_more"):Ce?(0,o.jsx)(u.AudioLink,{"data-performer":Ee,href:me,children:Ee}):(0,o.jsx)(_.AudioArtists,{raw:W?.raw??"",main:pe,feat:ye,"data-testid":"audio-player-block-audio-artists"}),onAdOpen:oe?Ie:void 0}),progressBar:I?void 0:(0,o.jsx)(c.AudioPlayerPlaybackProgressBar,{duration:H??0,playbackProgress:ee,loadingProgress:te,onPlaybackProgressChange:ce,readOnly:oe,pending:Z,"data-testid":"audio-player-block-progress-bar"}),progressTime:!I&&(0,o.jsx)(h.AudioPlayerPlaybackProgressTime,{duration:H??0,progress:ee??0,mode:ie?"reversed":"normal",ariaLabel:m.getLang("audio_player_block_playback_progress_time_aria_label"),onModeChange:he,"data-testid":"audio-player-block-progress-time-button"}),children:[((0,b.isNumber)(i)?q:V)&&!I&&!x&&!oe&&(0,o.jsx)(p.TextTooltip,{text:ge,children:(0,o.jsx)(y.AudioMyMusicIconButton,{type:((0,b.isNumber)(i)?G:Y)?"delete":"add",mode:"secondary",noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:()=>{(0,b.isNumber)(i)?(G?de:ne)():(Y?re:le)()},disabled:((0,b.isNumber)(i)?X:Q)||!a,"aria-label":ge,"data-testid":Pe})}),k&&!I&&!x&&!oe&&(0,o.jsx)(p.TextTooltip,{text:m.getLang("audio_action_dislike"),children:(0,o.jsx)(g.AudioDislikeIconButton,{added:z,noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:()=>{z?_e():ue({skipDeletionAudioFromMyMusic:(0,b.isNumber)(i)})},disabled:J||!a,"aria-label":m.getLang("audio_action_dislike"),"data-testid":fe})}),!I&&!x&&Ae&&!oe&&(0,o.jsx)(p.TextTooltip,{text:m.getLang("audio_show_recommendations"),children:(0,o.jsx)(g.AudioRecomsIconLink,{onClick:ve,href:Ae,disabled:!a,"aria-label":m.getLang("audio_show_recommendations"),"data-testid":"audio-player-block-recoms-link"})}),!I&&!x&&!oe&&(0,o.jsx)(p.TextTooltip,{text:m.getLang("audio_show_lyrics"),children:(0,o.jsx)(g.AudioLyricsIconButton,{noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:ae,disabled:!j||!a,"aria-label":m.getLang("audio_show_lyrics"),"data-testid":"audio-player-block-lyrics-button"})})]})})}},377037:(e,t,i)=>{i.d(t,{useArtists:()=>o.useArtists});var o=i(592852)},592852:(e,t,i)=>{i.d(t,{useArtists:()=>a});var o=i(296540),s=i(287013);function a(e){return(0,o.useMemo)((()=>e?e?.map((e=>function(e){return{name:(0,s.decodeHTML)(e.name),href:`/artist/${e.id}`}}(e))):[]),[e])}},907486:(e,t,i)=>{i.d(t,{AudioPlayerBlockPlaybackBodyContainer:()=>o.AudioPlayerBlockPlaybackBodyContainer});var o=i(349958)},740442:(e,t,i)=>{i.d(t,{AudioPlayerBlockPlaybackControlsContainer:()=>f});var o=i(474848),s=i(293721),a=i(367001),l=i(818987),r=i(167634),n=i(739547),d=i(320830),u=i(746219),_=i(296540),c=i(975903),h=i(610989),p=i(490712),y=i(13709),A=i(8520);const g=(0,a.ensureAudioPlayerBlockService)(),{playerService:P}=g;function f(){const{isCompact:e}=(0,c.useAudioPlayerBlockContext)(),t=(0,_.useRef)(null),i=(0,s.useUnit)(g.$isRadio),a=(0,s.useUnit)(g.$isEpisode),f=(0,s.useUnit)(P.$isPlaying),m=(0,s.useUnit)(P.$playbackSpeed),E=(0,s.useUnit)(P.$isShuffled),w=(0,s.useUnit)(P.$isRepeatCurrentAudio),v=(0,s.useUnit)(P.$isRepeatAll),I=(0,s.useUnit)(g.toggleShuffleFx),C=(0,s.useUnit)(g.toggleRepeatFx),b=(0,s.useUnit)(g.playFx),T=(0,s.useUnit)(g.pauseFx),k=(0,s.useUnit)(P.playNextByButtonFx),L=(0,s.useUnit)(P.playPrevByButtonFx),M=(0,s.useUnit)(P.updatePlaybackSpeedFx),S=(0,_.useMemo)((()=>v?"repeat":w?"repeat-one":"not-repeat"),[w,v]);return(0,o.jsxs)("div",{className:(0,A.classNames)(r.default.root,e&&r.default.compact,a&&r.default.episode,i&&r.default.radio),children:[(0,o.jsx)("div",{className:r.default.playbackControls,children:(0,o.jsx)(n.AudioPlayerPlaybackControls,{state:f?"play":"pause",stateButtonAriaLabel:f?h.getLang("global_audio_pause"):h.getLang("global_audio_play"),backwardAriaLabel:h.getLang("global_audio_prev"),forwardAriaLabel:h.getLang("global_audio_next"),getStateButtonRootRef:t,onStateChange:()=>{const{current:e}=t;e&&(f?T:b)({buttonEl:e})},onBackwardClick:L,onForwardClick:k,spacing:e?4:8})}),!i&&!a&&(0,o.jsxs)("div",{className:r.default.playbackButtonsContainer,children:[(0,o.jsx)("div",{className:r.default.playbackButton,children:(0,o.jsx)(d.TextTooltip,{text:h.getLang("audio_shuffle"),children:(0,o.jsx)(l.AudioShuffleIconButton,{active:E,noPadding:!0,hoverMode:"opacity",activeMode:"opacity","aria-label":h.getLang("audio_shuffle"),onClick:()=>{(0,p.statlogsValueEvent)("audio_sort_stat","audio_sort","shuffle_player",e?"layer":"page"),I()},"data-testid":"audio-player-block-shuffle-button"})})}),(0,o.jsx)("div",{className:r.default.playbackButton,children:(0,o.jsx)(d.TextTooltip,{text:h.getLang("audio_repeat_tooltip"),children:(0,o.jsx)(l.AudioRepeatIconButton,{state:S,noPadding:!0,hoverMode:"opacity",activeMode:"opacity","aria-label":h.getLang("audio_repeat_tooltip"),onClick:C,"data-testid":"audio-player-block-repeat-button"})})})]}),a&&(0,o.jsx)("div",{className:r.default.playbackSpeed,children:(0,o.jsx)(u.AudioPlayerPlaybackSpeedPicker,{speed:m,tooltipText:h.getLang("audio_playback_rate"),ariaLabel:h.getLang("audio_playback_rate"),onSpeedChange:()=>{m<y.AudioPlayer.PLAYBACK_RATE_MAX?M(m+.5):M(1)},"data-testid":"audio-player-block-speed-picker"})})]})}},919880:(e,t,i)=>{i.d(t,{AudioPlayerBlockPlaybackControlsContainer:()=>o.AudioPlayerBlockPlaybackControlsContainer});var o=i(740442)},821502:(e,t,i)=>{i.d(t,{AudioPlayerBlockUserControlsContainer:()=>m});var o=i(474848),s=i(293721),a=i(367001),l=i(818987),r=i(371698),n=i(320830),d=i(975903),u=i(776372),_=i(840953),c=i(610989),h=i(296540),p=i(8520),y=i(957562);const A=(0,a.ensureAudioPlayerBlockService)(),{playerService:g,myRadioStationsService:P,podcastFavoritesService:f}=A;function m(){const{isCompact:e}=(0,d.useAudioPlayerBlockContext)(),t=(0,s.useUnit)(A.$currentAudio),i=(0,s.useUnit)(A.$audioFullId),a=(0,s.useUnit)(A.$isRadio),g=(0,s.useUnit)(A.$isEpisode),m=(0,s.useUnit)(f.$isPodcastInFavorites),E=(0,s.useUnit)(f.$isFavoritesActionLoading),w=(0,s.useUnit)(A.shareAudioFx),v=(0,s.useUnit)(P.$isRadioStationFollowed),I=(0,s.useUnit)(P.$isFollowActionLoading),C=(0,s.useUnit)(P.followFx),b=(0,s.useUnit)(P.unfollowFx),T=(0,s.useUnit)(f.addFx),k=(0,s.useUnit)(f.deleteFx),L=(0,h.useMemo)((()=>v?c.getLang("audio_player_block_remove_from_my_music_hint"):c.getLang("audio_player_block_add_to_my_music_hint")),[v]),M=(0,h.useMemo)((()=>v?"audio-player-block-unfollow-radio-station":"audio-player-block-follow-radio-station"),[v]),S=(0,h.useMemo)((()=>m?"audio-player-block-podcast-remove-from-favorites":"audio-player-block-podcast-add-to-favorites"),[m]),D=(0,h.useMemo)((()=>m?c.getLang("audio_player_block_podcast_remove_from_favorites_hint"):c.getLang("audio_player_block_podcast_add_to_favorites_hint")),[m]);return(0,o.jsxs)("div",{className:(0,p.classNames)(r.default.root,e&&r.default.compact,g&&r.default.episode),children:[(0,o.jsx)("div",{className:r.default.volumeSlider,children:(0,o.jsx)(y.AudioVolumeSliderContainer,{})}),(0,o.jsxs)("div",{className:r.default.userButtonsContainer,children:[a&&!g&&(0,o.jsx)("div",{className:r.default.userButton,children:(0,o.jsx)(n.TextTooltip,{text:L,children:(0,o.jsx)(u.AudioMyMusicIconButton,{type:v?"delete":"add",mode:"secondary",noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:()=>{a||console.error(`Audio ith fullId ${i} is not a radio station`),(v?b:C)()},disabled:I||!t,"aria-label":L,"data-testid":M})})}),!a&&!g&&(0,o.jsx)("div",{className:r.default.userButton,children:(0,o.jsx)(_.AudioBroadcastTooltipContainer,{})}),g&&(0,o.jsx)("div",{className:r.default.userButton,children:(0,o.jsx)(n.TextTooltip,{text:D,children:(0,o.jsx)(l.AudioFavoritesIconButton,{added:m,noPadding:!0,hoverMode:"opacity",activeMode:"opacity",disabled:!t||E,onClick:m?k:T,"aria-label":D,"data-testid":S})})}),!a&&(0,o.jsx)("div",{className:r.default.userButton,children:(0,o.jsx)(n.TextTooltip,{text:c.getLang("audio_share"),children:(0,o.jsx)(l.AudioShareIconButton,{noPadding:!0,hoverMode:"opacity",activeMode:"opacity",onClick:w,disabled:!t,"aria-label":c.getLang("audio_share"),"data-testid":"audio-player-block-share-button"})})})]})]})}},396434:(e,t,i)=>{i.d(t,{AudioPlayerBlockUserControlsContainer:()=>o.AudioPlayerBlockUserControlsContainer});var o=i(821502)},122920:(e,t,i)=>{i.d(t,{AudioVolumeSliderContainer:()=>_});var o=i(474848),s=i(610989),a=i(975903),l=i(293721),r=i(47745),n=i(515131);const d=(0,r.ensureAudioPlayerBlockService)(),{playerService:u}=d;function _(){const{isCompact:e}=(0,a.useAudioPlayerBlockContext)(),t=(0,l.useUnit)(u.$volume),i=(0,l.useUnit)(d.toggleMuteVolumeFx),r=(0,l.useUnit)(u.updateVolumeFx),_=e=>{r(e)};return e?(0,o.jsx)(n.AudioPlayerVolumeSlider,{scale:"logarithmic",size:"xs",volume:t,onVolumeChange:_,"data-testid":"audio-player-block-volume-slider"}):(0,o.jsx)(n.AudioPlayerVolumeSlider,{scale:"logarithmic",size:"m",volume:t,muteButtonAriaLabel:s.getLang("audio_player_block_volume_slider_mute_button_aria_label"),onVolumeChange:_,onMuteButtonClick:i,"data-testid":"audio-player-block-volume-slider"})}},957562:(e,t,i)=>{i.d(t,{AudioVolumeSliderContainer:()=>o.AudioVolumeSliderContainer});var o=i(122920)},975903:(e,t,i)=>{i.d(t,{AudioPlayerBlockContext:()=>s,useAudioPlayerBlockContext:()=>a});var o=i(316769);const{Context:s,useContext:a}=(0,o.makeStrictContext)({name:"AudioPlayerBlockContext",defaultValue:{isCompact:!1}})},490524:(e,t,i)=>{i.d(t,{AudioPlayerBlockApplication:()=>o.AudioPlayerBlockApplication});var o=i(174530)},682768:(e,t,i)=>{i.d(t,{createAudioPlayerBlockBroadcastService:()=>c});var o=i(32489),s=i(624216),a=i(313100),l=i(810780),r=i(7144),n=i(30052),d=i(255053),u=i(278758),_=i(540401);function c({domain:e,$audio:t}){const i=(0,_.ensureAudioPlayerService)(),c=e.createStore(!1),h=e.createStore([]),{$activeBroadcastClubIdsMap:p,activeBroadcastClubIdsMapApi:y}=(0,a.createActiveBroadcastClubIdsMap)({domain:e,$broadcastClubs:h}),A=(0,o.combine)({isProfileActive:c,audio:t}),g=(0,o.combine)({isProfileActive:c,activeBroadcastClubIdsMap:p}).map((({isProfileActive:e,activeBroadcastClubIdsMap:t})=>e||Object.keys(t).length>0)),{$broadcastClubIdsMap:P,broadcastClubIdsMapApi:f}=(0,a.createBroadcastClubIdsMap)({domain:e}),m=e.createEffect((async()=>{try{const e=await s.ajax.promisifiedPost("al_audio.php?act=status_tt",{});if(!e?.[1])throw new Error("Unknown error when fetching audio broadcast info");return(0,a.mapBroadcastApiDataToBroadcastInfo)(e?.[1])}catch(e){throw new Error("Error when fetching audio broadcast info",{cause:e})}})),E=(0,o.attach)({source:t,async effect(e){if(!e)throw new Error("Audio not exist");i.emitFx({eventName:"broadcastStatusToggled",data:{status:!1,targetOwnerId:0}}),await s.ajax.promisifiedPost("al_audio.php?act=toggle_status",{exp:0,oid:0,hash:window.vk.statusExportHash,id:(0,d.getAudioFullId)(e),top:0,access_key:e.accessKey})}}),w=(0,o.attach)({source:A,async effect({isProfileActive:e,audio:t}){if(!t)throw new Error("Audio not exist");i.emitFx({eventName:"broadcastStatusToggled",data:{status:!e,targetOwnerId:window.vk.id}}),await s.ajax.promisifiedPost("al_audio.php?act=toggle_status",{exp:(0,r.intval)(!e),oid:window.vk.id,hash:window.vk.statusExportHash,id:(0,d.getAudioFullId)(t),top:0,access_key:t.accessKey})}}),v=(0,o.attach)({source:g,async effect(e){e?await E():await w()}}),I=(0,o.attach)({source:(0,o.combine)({activeBroadcastClubIdsMap:p,audio:t}),async effect({activeBroadcastClubIdsMap:e,audio:t},o){if(!t)throw new Error("Audio not exist");const a=Boolean(e[o]);i.emitFx({eventName:"broadcastStatusToggled",data:{status:!a,targetOwnerId:o}}),await s.ajax.promisifiedPost("al_audio.php?act=toggle_status",{exp:(0,r.intval)(!a),oid:o,hash:window.vk.statusExportHash,id:(0,d.getAudioFullId)(t),top:0,access_key:t.accessKey})}}),C=m.pending,b=w.pending,T=E.pending;return(0,o.sample)({source:c,clock:w.done,fn:e=>!e,target:c}),(0,o.sample)({source:p,clock:I.done,fn:(e,{params:t})=>({clubId:t,isActive:Boolean(e[t])}),target:(0,n.condition)({if:({isActive:e})=>e,then:y.remove.prepend((({clubId:e})=>e)),else:y.add.prepend((({clubId:e})=>e))})}),(0,o.sample)({clock:I,target:f.add}),(0,o.sample)({clock:I.done,fn:({params:e})=>e,target:f.remove}),(0,u.reset)({clock:E.done,target:[c,p]}),(0,l.spread)({source:m.doneData,targets:{isProfileActive:c,clubs:h}}),{$isBroadcastActive:g,$isProfileActive:c,$activeBroadcastClubIdsMap:p,$broadcastClubs:h,$isBroadcastInfoLoading:C,$loadingBroadcastClubIdsMap:P,$isProfileActiveLoading:b,$isResetBroadcastLoading:T,fetchBroadcastInfoFx:m,resetBroadcastFx:E,toggleIsProfileActiveFx:w,toggleIsActiveClubFx:I,toggleBroadcastFx:v}}},884712:(e,t,i)=>{i.d(t,{createAudioPlayerBlockBroadcastService:()=>o.createAudioPlayerBlockBroadcastService});var o=i(682768)},581108:(e,t,i)=>{i.d(t,{createActiveBroadcastClubIdsMap:()=>a});var o=i(32489),s=i(313100);function a({domain:e,$broadcastClubs:t}){const{$broadcastClubIdsMap:i,broadcastClubIdsMapApi:a}=(0,s.createBroadcastClubIdsMap)({domain:e});return(0,o.sample)({clock:t,fn:e=>Object.values(e).reduce(((e,t)=>(t.isActive&&(e[t.id]=!0),e)),{}),target:i}),{$activeBroadcastClubIdsMap:i,activeBroadcastClubIdsMapApi:a}}},873086:(e,t,i)=>{i.d(t,{createBroadcastClubIdsMap:()=>l});var o=i(32489),s=i(958955),a=i(918081);function l({domain:e}){const t=e.createStore({});return{$broadcastClubIdsMap:t,broadcastClubIdsMapApi:(0,o.createApi)(t,{add:(e,t)=>(0,s.addPairToMap)(e,{key:t,value:!0}),remove:(e,t)=>(0,a.removePairFromMap)(e,t)})}}},766185:(e,t,i)=>{i.d(t,{createActiveBroadcastClubIdsMap:()=>s.createActiveBroadcastClubIdsMap,createBroadcastClubIdsMap:()=>o.createBroadcastClubIdsMap});var o=i(873086),s=i(581108)},136642:(e,t,i)=>{i.d(t,{mapBroadcastApiDataToBroadcastInfo:()=>o.mapBroadcastApiDataToBroadcastInfo});var o=i(41389)},41389:(e,t,i)=>{i.d(t,{mapBroadcastApiDataToBroadcastInfo:()=>s});var o=i(287013);function s(e){return{isProfileActive:e.is_profile_active,clubs:e.clubs.map((e=>({id:e.id,isActive:Boolean(e.is_active),title:e.title?(0,o.decodeHTML)(e.title):""})))}}},313100:(e,t,i)=>{i.d(t,{createActiveBroadcastClubIdsMap:()=>o.createActiveBroadcastClubIdsMap,createBroadcastClubIdsMap:()=>o.createBroadcastClubIdsMap,mapBroadcastApiDataToBroadcastInfo:()=>s.mapBroadcastApiDataToBroadcastInfo});var o=i(766185),s=i(136642)},838556:(e,t,i)=>{i.d(t,{createAudioPlayerBlockGroupsMusicService:()=>d});var o=i(760325),s=i(847891),a=i(156693),l=i(32489),r=i(119265),n=i(851579);function d({$audio:e,$currentGroupId:t}){const i=r.AudioPageProxy.ensure(),d=(0,n.ensureGroupsAudioMusicWebService)(),u=e.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId,trackCode:e.trackCode}:null));return{$isAudioAddedToCurrentGroup:(0,l.combine)({identity:u,groupsMusicIdentitiesMap:d.$identitiesMap,groupId:t}).map((({identity:e,groupsMusicIdentitiesMap:t,groupId:i})=>(0,n.isAddedToGroup)({identity:e,groupsMusicIdentitiesMap:t,groupId:i}))),$canAddAudioToCurrentGroup:(0,l.combine)({groupId:t,audio:e}).map((({audio:e,groupId:t})=>!(!e||!(0,o.isNumber)(t))&&Boolean(i.ownerId&&(0,o.isNumber)(i.ownerId)&&s.Ranges.isGroupId(+i.ownerId)&&i.canAddToGroup&&e.ownerId!==+i.ownerId))),$isGroupsMusicActionLoading:(0,l.combine)({identity:u,fullIdsMap:d.$loadingIdentitiesMap,groupId:t}).map((({identity:e,fullIdsMap:t,groupId:i})=>!!(0,o.isNumber)(i)&&Boolean(e&&t[(0,a.getGroupAudioFullId)(e,i)]))),addFx:(0,l.attach)({source:(0,l.combine)({audio:e,groupId:t}),async effect({audio:e,groupId:t}){if(!(0,o.isNumber)(t))throw new Error("Group not exists");await d.addFx({audio:e,groupId:t})}}),deleteFx:(0,l.attach)({source:(0,l.combine)({audio:e,groupId:t}),async effect({audio:e,groupId:t}){if(!(0,o.isNumber)(t))throw new Error("Group not exists");await d.deleteFx({audio:e,groupId:t})}})}}},229440:(e,t,i)=>{i.d(t,{createAudioPlayerBlockGroupsMusicService:()=>o.createAudioPlayerBlockGroupsMusicService});var o=i(838556)},445718:(e,t,i)=>{i.d(t,{createAudioPlayerBlockInitDataService:()=>n});var o=i(810780),s=i(735477),a=i(264874),l=i(297420),r=i(630082);function n({domain:e,playerService:t}){const i=e.createEvent(),s=(0,l.not)((0,r.equals)(t.$currentAudio,null)),n=e.createStore(null),u=e.createStore(null);return(0,o.spread)({source:(0,a.once)(i).map(d),targets:{audio:n,audioTuple:u}}),{$isInitDataNotActual:s,$audio:n,$audioTuple:u,init:i}}function d(e){return{audio:e.firstAudio?(0,s.audioTupleToAudioObject)(e.firstAudio):null,audioTuple:e.firstAudio||null}}},497511:(e,t,i)=>{i.d(t,{createAudioPlayerBlockInitDataService:()=>o.createAudioPlayerBlockInitDataService});var o=i(445718)},917580:(e,t,i)=>{i.d(t,{createAudioPlayerBlockMyAudioPodcastFavoritesService:()=>d});var o=i(401986),s=i(471027),a=i(303651),l=i(32489),r=i(668592),n=i(501036);function d({domain:e,$podcast:t,playerBlockEmitter:i}){const d=(0,o.ensureAudioPodcastsFaveService)(),{$fullIdsMap:u,fullIdsMapApi:_}=(0,s.createFullIdsMap)(e),{$fullIdsMap:c,fullIdsMapApi:h}=(0,s.createFullIdsMap)(e),p=t.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId,podcastId:e.id}:null)),y=(0,l.combine)({identity:p,fullIdsMap:u}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,a.getPodcastAudioFullId)(e)]))),A=(0,l.combine)({identity:p,fullIdsMap:c}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,a.getPodcastAudioFullId)(e)]))),g=(0,l.combine)({favoritesMap:d.$identitiesMap,podcast:t,podcastIdentity:p,isFavoritesActionInitialized:y}).map((({favoritesMap:e,podcast:t,podcastIdentity:i,isFavoritesActionInitialized:o})=>!(!t||!i)&&(!!e[(0,a.getPodcastAudioFullId)(i)]||!o&&((0,r.getAudioExtra)(t)?.fave??!1)))),P=(0,l.attach)({source:(0,l.combine)({podcast:t,isPodcastInFavorites:g}),async effect({podcast:e,isPodcastInFavorites:t},o){if(!o||!e)throw new Error("Podcast not exist");if(t)throw new Error("Podcast already in favorites");try{await d.addFx({identity:o}),i.emit(n.AudioPlayerBlockServiceEventType.PodcastAddedToFavorites,{podcastId:e.id,id:e.id,ownerId:e.ownerId,accessKey:e.accessKey})}catch(e){throw new Error("Failed to add podcast to favorites",{cause:e})}}}),f=(0,l.attach)({source:g,async effect(e,t){if(!t)throw new Error("Podcast not exist");if(!e)throw new Error("Podcast is not in favorites");try{await d.deleteFx({identity:t})}catch(e){throw new Error("Failed to delete podcast from favorites",{cause:e})}}}),m=(0,l.attach)({source:p,async effect(e){await P(e)}}),E=(0,l.attach)({source:p,async effect(e){await f(e)}});return(0,l.sample)({clock:[P.done,f.done],filter:({params:e})=>Boolean(e),fn:({params:e})=>(0,a.getPodcastAudioFullId)(e),target:_.add}),(0,l.sample)({clock:[P,f],filter:e=>Boolean(e),fn:e=>(0,a.getPodcastAudioFullId)(e),target:h.add}),(0,l.sample)({clock:[P.finally,f.finally],filter:({params:e})=>Boolean(e),fn:({params:e})=>(0,a.getPodcastAudioFullId)(e),target:h.remove}),{$isPodcastInFavorites:g,$isFavoritesActionLoading:A,addFx:m,deleteFx:E}}},908342:(e,t,i)=>{i.d(t,{createAudioPlayerBlockMyAudioPodcastFavoritesService:()=>o.createAudioPlayerBlockMyAudioPodcastFavoritesService});var o=i(917580)},11132:(e,t,i)=>{i.d(t,{createAudioPlayerBlockMyMusicService:()=>r});var o=i(255053),s=i(32489),a=i(753421),l=i(432800);function r({$audio:e}){const t=(0,l.ensureAudioDislikesInMyMusicWebService)(),i=e.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId,trackCode:e.trackCode}:null)),r=(0,s.combine)({identity:i,fullIdsMap:t.$myMusicInitializedIdentitiesMap}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,o.getAudioFullId)(e)])));return{$isAudioAddedToMyMusic:(0,s.combine)({identity:i,myMusicIdentitiesMap:t.$myMusicIdentitiesMap,isMyMusicActionInitialized:r}).map((({identity:e,myMusicIdentitiesMap:t,isMyMusicActionInitialized:i})=>(0,a.isMy)({identity:e,myMusicIdentitiesMap:t,isMyMusicActionInitialized:i,userId:window.vk.id}))),$canAddAudioToMyMusic:e.map((e=>!!e&&e.ownerId!==window.vk.id)),$isMyMusicActionLoading:(0,s.combine)({identity:i,fullIdsMap:t.$myMusicLoadingIdentitiesMap}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,o.getAudioFullId)(e)]))),addFx:(0,s.attach)({source:e,async effect(e){await t.addToMyMusicFx({audio:e})}}),deleteFx:(0,s.attach)({source:e,async effect(e){await t.deleteFromMyMusicFx({audio:e})}})}}},186698:(e,t,i)=>{i.d(t,{createAudioPlayerBlockMyMusicService:()=>o.createAudioPlayerBlockMyMusicService});var o=i(11132)},894186:(e,t,i)=>{i.d(t,{createAudioPlayerBlockMyRadioStationsService:()=>_});var o=i(515706),s=i(471027),a=i(255053),l=i(32489),r=i(671300),n=i(540401),d=i(514640),u=i(501036);function _({domain:e,$radioStation:t,playerBlockEmitter:i}){const _=(0,o.ensureMyAudioRadioStationsService)(),c=(0,n.ensureAudioPlayerService)(),h=e.createStore(!1),{$fullIdsMap:p,fullIdsMapApi:y}=(0,s.createFullIdsMap)(e),A=t.map((e=>e&&e.id&&e.ownerId?{id:e.id,ownerId:e.ownerId}:null)),g=(0,l.combine)({identity:A,fullIdsMap:p}).map((({identity:e,fullIdsMap:t})=>Boolean(e&&t[(0,a.getAudioFullId)(e)]))),P=(0,l.attach)({source:h,async effect(e,t){if(!t)throw new Error("Radio station not exist");if(e)throw new Error("Radio station already followed");try{await _.followFx({identity:t}),c.notifyFx({eventType:d.AudioPlayerEventType.RADIOSTATION_FOLLOW,params:[t.id]}),i.emit(u.AudioPlayerBlockServiceEventType.RadioStationFollowed,{stationId:t.id})}catch(e){throw new Error("Failed to follow ration station",{cause:e})}}}),f=(0,l.attach)({source:h,async effect(e,t){if(!t)throw new Error("Radio station not exist");if(!e)throw new Error("Radio station not followed");try{await _.unfollowFx({identity:t}),c.notifyFx({eventType:d.AudioPlayerEventType.RADIOSTATION_UNFOLLOW,params:[t.id]})}catch(e){throw new Error("Failed to unfollow radio station",{cause:e})}}}),m=(0,l.attach)({source:A,async effect(e){await P(e)}}),E=(0,l.attach)({source:A,async effect(e){await f(e)}});return(0,l.sample)({clock:[P,f],filter:e=>Boolean(e),fn:e=>(0,a.getAudioFullId)(e),target:y.add}),(0,l.sample)({clock:[P.finally,f.finally],filter:({params:e})=>Boolean(e),fn:({params:e})=>(0,a.getAudioFullId)(e),target:y.remove}),(0,l.sample)({clock:t,fn:e=>!!e&&(r.AudioUtils.getAudioExtra(e)?.fave??!1),target:h}),(0,l.sample)({clock:c.notifyCurrentRadioStationFollowStatusUpdate,target:h}),{$isRadioStationFollowed:h,$isFollowActionLoading:g,followFx:m,unfollowFx:E}}},470381:(e,t,i)=>{i.d(t,{createAudioPlayerBlockMyRadioStationsService:()=>o.createAudioPlayerBlockMyRadioStationsService});var o=i(894186)},143722:(e,t,i)=>{i.d(t,{createAudioPlayerBlockService:()=>I});var o=i(94359),s=i(919225),a=i(760325),l=i(32489),r=i(119265),n=i(671300),d=i(668592),u=i(594541),_=i(620626),c=i(540401),h=i(115674),p=i(497511),y=i(197787),A=i(186698),g=i(478508),P=i(884712),f=i(327527),m=i(470381),E=i(278758),w=i(229440),v=i(908342);function I(e){const t=(0,o.getEffectorServiceDomain)(e),i=new s.Emitter,I=r.AudioPageProxy.ensure(),C=(0,c.ensureAudioPlayerService)(),b=(0,p.createAudioPlayerBlockInitDataService)({domain:t,playerService:C}),T=t.createEvent(),k=(0,l.restore)(T,null),L=t.createStore(!1),M=(0,h.either)(b.$isInitDataNotActual,C.$currentAudio,b.$audio),S=(0,h.either)(b.$isInitDataNotActual,C.$currentAudioTuple,b.$audioTuple),D=(0,A.createAudioPlayerBlockMyMusicService)({domain:t,$audio:M}),O=(0,w.createAudioPlayerBlockGroupsMusicService)({domain:t,$audio:M,$currentGroupId:k}),x=(0,P.createAudioPlayerBlockBroadcastService)({domain:t,$audio:M}),R=(0,m.createAudioPlayerBlockMyRadioStationsService)({domain:t,$radioStation:M,playerBlockEmitter:i}),U=(0,g.createMusicAudioMyDislikesService)({domain:t,$audio:M}),B=(0,v.createAudioPlayerBlockMyAudioPodcastFavoritesService)({domain:t,$podcast:M,playerBlockEmitter:i}),{$artist:N,$duration:F,$audioFullId:j,$coverSrc:W,$audioTitle:K,$audioSubtitle:$,$audioHasLyrics:H,$audioLink:Y,$audioPerformer:V,$isRadio:Q,$isEpisode:G,$isExplicit:q}=(0,y.createAudioInfoStores)(M),X=(0,h.either)(C.$isAd,C.$duration,F),z=(0,l.attach)({source:(0,l.combine)({playerPlaylist:C.$currentPlaylist,currentAudioTuple:S}),effect({playerPlaylist:e,currentAudioTuple:t},{buttonEl:i}){const o=I.currentPlaylist,s=C.getPlaylistQueue();let a=t||I.readyAudio;const l=()=>{if(!a)return;if(n.AudioUtils.isClaimedAudio(a)){const e=(0,d.getAudioExtra)(n.AudioUtils.audioTupleToAudioObject(a)),t=e?.claim;return void(0,u.showAudioClaimWarning)(a,t)}let t;t=e&&-1!==s?.indexOfAudio(a)?e:o&&-1!==o.indexOfAudio(a)?o:new _.AudioPlaylist(_.AudioPlaylist.TYPE_TEMP,window.vk.id),I.destroyReadyAudio(),I.audioStartReadyAudio=!0,C.podcastSetActionRefFx({audio:a,actionType:c.AudioPlayerPodcastActionType.Play,refEl:i}),C.playFx({audio:a,playlist:t,byPlayerButton:!0})};!a&&o?s?.getAudioAt(0).then((e=>{a=e,l()})):l()}}),J=(0,l.attach)({source:M,effect(e,{buttonEl:t}){e&&(C.podcastSetActionRefFx({audio:e,actionType:c.AudioPlayerPodcastActionType.Pause,refEl:t}),C.pauseFx())}}),Z=(0,y.createToggleMuteVolumeFx)(t,C),ee=(0,l.attach)({source:M,effect(e){const t=C.getPlaylistQueue();if(!t||t.isEmpty())return;let i=e;const o=()=>{t.shuffled?t.resetShuffle():t.shuffle(!0),"current"===I.currentSection&&I.initAudioRowsAutoList(!0),C.playFx(i?{audio:i}:void 0),C.updatedIsShuffledFx()};i?o():t.getAudioAt(0).then((e=>{i=e,o()}))}}),te=(0,l.attach)({source:(0,l.combine)({isRepeatCurrentAudio:C.$isRepeatCurrentAudio,isRepeatAll:C.$isRepeatAll}),effect({isRepeatCurrentAudio:e,isRepeatAll:t}){t||e?C.toggleRepeatCurrentAudioFx():C.toggleRepeatAllFx()}}),ie=(0,l.attach)({source:M,effect(e){const t=e||I.readyAudio;t&&n.AudioUtils.shareAudio(!1,t)}}),oe=(0,l.attach)({source:(0,l.combine)({currentAudioTuple:S,currentAudio:M}),effect({currentAudioTuple:e,currentAudio:t}){const i=e||I.readyAudio;if(i){(0,f.getAudioPlayerUI)().lyrics.open({audio:i,playlist:null,context:t?.context})}}}),se=(0,l.attach)({source:M,async effect(e){if(!e)throw new Error("Audio not exists");const t=I.ownerId&&(0,a.isNumber)(I.ownerId)&&I.ownerId<0&&I.canAddToGroup;T(t?-I.ownerId:null)}});return(0,l.sample)({clock:C.notifyPlaylistClearRequested,fn:()=>!0,target:[L,x.resetBroadcastFx]}),(0,l.sample)({clock:M,source:(0,l.combine)({isRadio:Q,isEpisode:G,isPlayerPlaylistClearRequested:L}),filter:({isRadio:e,isEpisode:t,isPlayerPlaylistClearRequested:i})=>!e&&!t&&!i,target:x.fetchBroadcastInfoFx}),(0,l.sample)({clock:M,target:se}),(0,E.reset)({clock:C.notifyAudioStartedPlaying,target:L}),I.events.on(r.AudioPageEventType.Updated,(()=>{se()})),{$currentAudio:M,$audioFullId:j,$coverSrc:W,$audioTitle:K,$audioLink:Y,$audioPerformer:V,$audioSubtitle:$,$audioHasLyrics:H,$duration:X,$artist:N,$isEpisode:G,$isExplicit:q,$isRadio:Q,$currentGroupId:k,init:b.init,playFx:z,pauseFx:J,toggleMuteVolumeFx:Z,toggleShuffleFx:ee,toggleRepeatFx:te,shareAudioFx:ie,showLyricsFx:oe,playerService:C,myMusicService:D,groupsMusicService:O,broadcastService:x,myRadioStationsService:R,dislikesService:U,podcastFavoritesService:B,events:i.listenable}}},501036:(e,t,i)=>{var o;i.d(t,{AudioPlayerBlockServiceEventType:()=>o}),function(e){e.RadioStationFollowed="radioStationFollowed",e.PodcastAddedToFavorites="podcastAddedToFavorites"}(o||(o={}))},367001:(e,t,i)=>{i.d(t,{ensureAudioPlayerBlockService:()=>l});var o=i(942451),s=i(32489),a=i(143722);const l=(0,o.makeSharedState)("audio/audioPage/audioPlayerBlock",(()=>(0,a.createAudioPlayerBlockService)({domain:(0,s.createDomain)("audio/audioPage/audioPlayerBlock"),name:"audio/audioPage/audioPlayerBlock"})),{version:2})},951294:(e,t,i)=>{i.d(t,{createAudioInfoStores:()=>r});var o=i(32489),s=i(647923),a=i(671300),l=i(287013);function r(e){const t=e.map((e=>e?{raw:e.performer?(0,l.decodeHTML)(e.performer):"",main:Array.isArray(e.mainArtists)?e.mainArtists?.map(s.mapAPIAudioArtistToAudioDataArtistInfo):[],feat:Array.isArray(e.featArtists)?e.featArtists?.map(s.mapAPIAudioArtistToAudioDataArtistInfo):[]}:null)),i=e.map((e=>e&&Number.isFinite(e.duration)?e.duration:null)),r=e.map((e=>e?.fullId??null)),n=e.map((e=>e?.coverUrl_p??null)),d=e.map((e=>e?.title?(0,l.decodeHTML)(e.title):"")),u=e.map((e=>e?.subTitle?(0,l.decodeHTML)(e.subTitle):"")),_=e.map((e=>Boolean(e?.hasLyrics))),c=e.map((e=>e?.trackPageId||null)),h=e.map((e=>Boolean(e?.isExplicit))),p=e.map((e=>Boolean(e&&a.AudioUtils.isRadio(e)))),y=e.map((e=>Boolean(e&&a.AudioUtils.isPodcast(e))));return{$artist:t,$duration:i,$audioFullId:r,$coverSrc:n,$audioTitle:d,$audioSubtitle:u,$audioHasLyrics:_,$audioLink:(0,o.combine)({audioFullId:r,isEpisode:y,audioPageId:c}).map((({audioFullId:e,isEpisode:t,audioPageId:i})=>t&&e?`/podcast${e}`:i?`/audio${i}`:"")),$audioPerformer:e.map((e=>e?.performer?e.performer:null)),$isExplicit:h,$isRadio:p,$isEpisode:y}}},404909:(e,t,i)=>{i.d(t,{createToggleMuteVolumeFx:()=>r});var o=i(32489),s=i(225604),a=i(30052),l=i(853177);function r(e,t){const i=e.createStore(0);return(0,s.persist)({store:i,keyPrefix:l.LS_AUDIOPLAYER_BLOCK_PREFIX,key:l.LS_AUDIOPLAYER_BLOCK_NON_ZERO_VOLUME}),(0,a.condition)({source:t.$volume,if:e=>0!==e,then:i}),(0,o.attach)({source:(0,o.combine)({volume:t.$volume,lastNonZeroVolume:i}),effect:({volume:e,lastNonZeroVolume:i})=>{t.updateVolumeFx(0===e?i:0)}})}},104318:(e,t,i)=>{i.d(t,{createAudioInfoStores:()=>o.createAudioInfoStores,createToggleMuteVolumeFx:()=>s.createToggleMuteVolumeFx});var o=i(951294),s=i(404909)},197787:(e,t,i)=>{i.d(t,{createAudioInfoStores:()=>o.createAudioInfoStores,createToggleMuteVolumeFx:()=>o.createToggleMuteVolumeFx});var o=i(104318)},47745:(e,t,i)=>{i.d(t,{ensureAudioPlayerBlockService:()=>o.ensureAudioPlayerBlockService});i(497511);var o=i(367001)},844090:(e,t,i)=>{i.d(t,{AudioPlayerUI:()=>s});var o=i(715977);class s{constructor({audioPlayer:e}){this.lyrics=new o.AudioPlayerLyricsUI({audioPlayer:e})}}},969433:(e,t,i)=>{i.d(t,{AudioLyricsModalController:()=>l});var o=i(474848),s=i(272259),a=i(507607);class l{open(e){this.mount(e)}destroy(){this.unmount()}mount({audio:e,playlist:t,context:i}){if(this.onCloseFn)return;const{AudioLyricsModalApplication:a}=this;(0,s.showMessageBoxModalSuspense)((s=>(this.onCloseFn=s.onClose,(0,o.jsx)(a,{...s,audio:e,playlist:t,context:i,audioPlayer:this.audioPlayer}))),{width:490,onDestroy:()=>{this.onCloseFn=null}})}constructor({audioPlayer:e}){this.onCloseFn=null,this.AudioLyricsModalApplication=(0,a.asyncComponent)((()=>Promise.all([i.e(91498),i.e(89631),i.e(79210),i.e(69706),i.e(447)]).then(i.bind(i,221944))),(e=>e.AudioLyricsModalApplication)),this.unmount=()=>{this.onCloseFn&&this.onCloseFn(),this.onCloseFn=null},this.audioPlayer=e}}},224073:(e,t,i)=>{i.d(t,{AudioLyricsCredits:()=>a});var o=i(474848),s=i(682400);function a({children:e}){return(0,o.jsx)("div",{className:s.default.credits,children:e})}},666955:(e,t,i)=>{i.d(t,{AudioLyricsLayout:()=>l});var o=i(474848),s=i(130816),a=i(930450);function l({children:e,scrollRef:t,compensationTop:i,height:l,width:r,onWheel:n,onScroll:d,onTouchStart:u,onTouchMove:_,onTouchEnd:c,onTrackerDragStart:h,onTrackerDragStop:p}){return(0,o.jsx)("div",{style:{height:l,width:r},children:(0,o.jsx)(s.CustomScrollView,{boxRef:t,className:a.default.scroll,onWheel:n,onScroll:d,onTouchStart:u,onTouchMove:_,onTouchEnd:c,onTrackerDragStart:h,onTrackerDragStop:p,children:(0,o.jsx)("div",{className:a.default.content,style:{paddingTop:i||void 0},children:e})})})}},572295:(e,t,i)=>{i.d(t,{AudioLyricsLine:()=>n});var o=i(474848),s=i(296540),a=i(8520),l=i(689485),r=i(687886);const n=(0,s.forwardRef)((function({text:e,interlude:t,active:i,onClick:s},n){const d=(0,a.classNames)(r.default.line,!1===i&&r.default.inactive,s&&r.default.clickable),u=()=>{s&&s()};return e?(0,o.jsx)("div",{ref:n,className:d,onClick:u,children:(0,o.jsx)("div",{className:r.default.text,children:e})}):t?(0,o.jsx)("div",{ref:n,className:(0,a.classNames)(d,r.default.interlude),onClick:u,children:(0,o.jsx)("div",{className:(0,a.classNames)("foo",r.default.text),children:(0,o.jsx)(l.Icon32SongOutline,{})})}):null}))},404533:(e,t,i)=>{i.d(t,{AudioLyricsLottieCountdown:()=>_});var o=i(474848),s=i(296540),a=i(441120),l=i(930095),r=i(795063),n=i(772957),d=i(205044);const u="audio_lyric_countdown";function _({time:e,playing:t}){const i=(0,s.useRef)(null),a=function(e){if(e<=0)return 0;if(e<=4330)return 2;return 1}(e),{lottieContainerRef:_,lottiePlayerRef:h,lottieLoaded:p}=(0,l.useLottie)({name:"dots",group:u,loop:!0,autoplay:!1,color:"currentColor",animationData:r},{show:!1}),{lottieContainerRef:y,lottiePlayerRef:A,lottieLoaded:g}=(0,l.useLottie)({name:"s3",group:u,loop:!1,autoplay:!1,color:"currentColor",animationData:n},{show:!1}),P=p&&g;return(0,s.useLayoutEffect)((()=>{if(!P)return;const e=e=>{!function(e,t){e?.show(),t&&e?.play()}(e,t),i.current=e},o=t=>{const o=i.current;if(!o)return void e(t);if(!o.options.loop)return c(o),void e(t);const s=()=>{c(o),e(t),o.removeEventListener("loopComplete",s)};return o.addEventListener("loopComplete",s),()=>{o.removeEventListener("loopComplete",s)}};switch(a){case 0:{const e=setTimeout((()=>{o(null)}),1e3);return()=>{clearTimeout(e)}}case 1:return o(h.current);case 2:return o(A.current)}}),[a,P]),(0,s.useLayoutEffect)((()=>{if(!P)return;const e=i.current;if(e){if(!t){e.options.loop||e.pause();const t=()=>{e.pause(),e.removeEventListener("loopComplete",t)};return e.addEventListener("loopComplete",t),()=>{e.removeEventListener("loopComplete",t)}}e.play()}}),[t,P]),(0,o.jsxs)("div",{className:d.default.countdown,children:[(0,o.jsx)("div",{ref:_,className:d.default.animation}),(0,o.jsx)("div",{ref:y,className:d.default.animation})]})}function c(e){e?.hide(),e?.stop()}a.LottieManager.observer.ignoreGroup(u)},58949:(e,t,i)=>{i.d(t,{KaraokeAudioLyrics:()=>y});var o=i(474848),s=i(296540),a=i(8520),l=i(304888),r=i(666955),n=i(572295),d=i(224073),u=i(404533),_=i(680290),c=i(776027),h=i(892558),p=i(991120);function y({lines:e,credits:t,timeMs:i,isPlaying:y,compensationTop:A=0,height:g,width:P}){const f=e[0].begin,m=f>=5e3,E=i-f>2e3,{isManualScrollMode:w,onManualScroll:v,setScrollModeAuto:I}=(0,c.useManualScrollMode)({isPlaying:y}),{currentLineIndex:C}=(0,h.useTimingLines)({lines:e,timeMs:i,withCountdown:m}),b=(0,s.useRef)(null),T=(0,s.useRef)(null);(0,s.useLayoutEffect)((()=>{if(w)return;const e=T.current,t=b.current;if(t){const i=Math.max(0,(e?.offsetTop||0)-A);t.scrollTo({top:i,behavior:"smooth"})}}),[C,w,m]);const k=(0,_.useEventProcess)({timeout:3e3}),L=(0,_.useEventProcess)({timeout:3e3}),M=(0,_.useEventProcess)({timeout:100}),S=(0,s.useMemo)((()=>(0,a.throttle)((()=>{v()}),50)),[v]),D=(0,l.useEventCallback)((()=>{M.start()})),O=(0,s.useMemo)((()=>(0,a.throttle)((()=>{D()}),50)),[D]),x=(0,l.useEventCallback)((()=>{k.ref.current&&k.update();(k.ref.current||L.ref.current||M.ref.current)&&S()})),R=(0,s.useMemo)((()=>(0,a.throttle)((()=>{x()}),50)),[x]);return(0,o.jsxs)(r.AudioLyricsLayout,{scrollRef:b,onWheel:O,onTrackerDragStart:k.start,onTrackerDragStop:k.end,onTouchStart:L.start,onTouchEnd:L.end,onTouchMove:L.update,onScroll:R,compensationTop:A,height:g,width:P,children:[m&&(0,o.jsx)("div",{className:(0,a.classNames)(p.default.countdown,E&&p.default.hidden),children:(0,o.jsx)(u.AudioLyricsLottieCountdown,{time:Math.max(0,f-i),playing:y})}),e.map(((e,t)=>{const{changeProgress:i}=e,s=t===C,a=i&&(()=>{i(),k.end(),L.end(),M.end(),I()});return(0,o.jsx)(n.AudioLyricsLine,{ref:s?T:void 0,text:e.text,interlude:e.interlude,active:s||w,onClick:a},t)})),!!t&&(0,o.jsx)(d.AudioLyricsCredits,{children:t})]})}},680290:(e,t,i)=>{i.d(t,{useEventProcess:()=>a});var o=i(296540),s=i(304888);function a({timeout:e,onChange:t}={}){const i=(0,o.useRef)(!1),a=(0,o.useRef)(),l=e=>{i.current=e,t&&t(e)},r=()=>{"number"==typeof e&&(clearTimeout(a.current),a.current=setTimeout((()=>{a.current=void 0,l(!1)}),5e3))},n=(0,s.useEventCallback)((()=>{l(!0),r()})),d=(0,s.useEventCallback)((()=>{i.current&&null===a.current||r()})),u=(0,s.useEventCallback)((()=>{l(!1)}));return{ref:i,start:n,update:d,end:u}}},776027:(e,t,i)=>{i.d(t,{useManualScrollMode:()=>s});var o=i(296540);function s({isPlaying:e}){const[t,i]=function(){const e=(0,o.useRef)(),[t,i]=(0,o.useState)(!1),s=(0,o.useCallback)((t=>{i(t),clearTimeout(e.current),t&&(e.current=setTimeout((()=>{i(!1)}),5e3))}),[]);return(0,o.useEffect)((()=>()=>{clearTimeout(e.current)}),[]),[t,s]}(),[s,a]=(0,o.useState)(t);(0,o.useEffect)((()=>{a(e?t:e=>e||t)}),[e,t]);const l=(0,o.useCallback)((()=>{i(!0)}),[]);return{isManualScrollMode:s,setScrollModeAuto:(0,o.useCallback)((()=>{i(!1)}),[]),onManualScroll:l}}},892558:(e,t,i)=>{i.d(t,{useTimingLines:()=>s});var o=i(296540);function s({lines:e,timeMs:t,withCountdown:i}){const s=(0,o.useRef)(-1),a=(0,o.useRef)(0);let l,r;const n=()=>{r=e[s.current],l=e[a.current]};for(n(),r&&r.begin>t&&(s.current=e.findIndex((e=>e.begin>=t))-Number(i),a.current=s.current+1,n());l&&t>=l.begin;)s.current=a.current,a.current++,n();return{currentLine:r,nextLine:l,currentLineIndex:s.current,nextLineIndex:a.current}}},167627:(e,t,i)=>{i.d(t,{StaticAudioLyrics:()=>r});var o=i(474848),s=i(666955),a=i(572295),l=i(224073);function r({lines:e,credits:t,compensationTop:i,height:r,width:n}){return(0,o.jsxs)(s.AudioLyricsLayout,{height:r,width:n,compensationTop:i,children:[e.map(((e,t)=>(0,o.jsx)(a.AudioLyricsLine,{text:e.text,interlude:e.interlude},t))),!!t&&(0,o.jsx)(l.AudioLyricsCredits,{children:t})]})}},459030:(e,t,i)=>{i.d(t,{KaraokeAudioLyrics:()=>s.KaraokeAudioLyrics,StaticAudioLyrics:()=>o.StaticAudioLyrics});var o=i(167627),s=i(58949)},611061:(e,t,i)=>{i.d(t,{AudioLyricsAds:()=>r});var o=i(474848),s=i(923594),a=i(615270),l=i(610989);function r(){return(0,o.jsx)(s.Placeholder,{icon:(0,o.jsx)(a.IconIllustrationAdvertising56h,{}),children:l.getLang("audio_lyrics_ads")})}},207722:(e,t,i)=>{i.d(t,{AudioLyricsError:()=>n});var o=i(474848),s=i(923594),a=i(533048),l=i(208225),r=i(610989);function n({onRetryClick:e}){return(0,o.jsx)(s.Placeholder,{action:(0,o.jsx)(a.Button,{size:"l",mode:"secondary",before:(0,o.jsx)(l.Icon24RefreshOutline,{}),onClick:()=>{e()},children:r.getLang("audio_lyrics_error_btn_retry")}),children:r.getLang("audio_lyrics_error")})}},948344:(e,t,i)=>{i.d(t,{AudioLyricsModal:()=>r});var o=i(474848),s=i(209642),a=i(753457),l=i(953699);function r({header:e,content:t,player:i,onClose:r}){return(0,o.jsxs)(s.ModalBox,{children:[(0,o.jsx)(a.ModalDismissButton,{onClick:()=>r()}),(0,o.jsxs)("div",{className:l.default.layout,children:[(0,o.jsx)("div",{className:l.default.headerWrapper,children:(0,o.jsx)("div",{className:l.default.header,children:e})}),(0,o.jsx)("div",{className:l.default.content,children:t}),(0,o.jsx)("div",{className:l.default.playerWrapper,children:(0,o.jsx)("div",{className:l.default.player,children:i})})]})]})}},238203:(e,t,i)=>{i.d(t,{AudioCover:()=>d});var o=i(474848),s=i(296540),a=i(8520),l=i(607413),r=i(714209),n=i(262588);function d({url:e}){const[t,i]=(0,s.useState)(!1);return(0,s.useLayoutEffect)((()=>{i(!1)}),[e]),!e||t?(0,o.jsx)("div",{className:(0,a.classNames)(n.default.cover,n.default.placeholder),children:(0,o.jsx)(l.Icon28SongOutline,{})}):(0,o.jsxs)("div",{className:n.default.cover,children:[!r.browser.safari&&(0,o.jsx)("div",{className:n.default.blur,style:{backgroundImage:`url(${e})`}}),(0,o.jsx)("img",{src:e,className:n.default.image,onError:()=>{i(!0)}})]})}},749630:(e,t,i)=>{i.d(t,{AudioLyricsModalHeader:()=>r});var o=i(474848),s=i(982069),a=i(238203),l=i(647229);function r({title:e,explicit:t,performer:i,coverUrl:r}){return(0,o.jsxs)("div",{className:l.default.header,children:[(0,o.jsx)("div",{className:l.default.cover,children:(0,o.jsx)(a.AudioCover,{url:r})}),(0,o.jsxs)("div",{className:l.default.info,children:[(0,o.jsxs)("div",{className:l.default.titleContainer,children:[(0,o.jsx)("span",{className:l.default.title,children:e}),t&&(0,o.jsx)("div",{className:l.default.explicit,children:(0,o.jsx)(s.Icon12Explicit,{})})]}),(0,o.jsx)("span",{className:l.default.performer,children:i})]})]})}},548220:(e,t,i)=>{i.d(t,{AudioLyricsNotFound:()=>r});var o=i(474848),s=i(923594),a=i(690470),l=i(610989);function r(){return(0,o.jsx)(s.Placeholder,{icon:(0,o.jsx)(a.IconIllustrationLyrics56h,{}),children:l.getLang("audio_track_has_no_lyrics_yet")})}},137056:(e,t,i)=>{i.d(t,{AudioLyricsPlayer:()=>u});var o=i(474848),s=i(343074),a=i(487650),l=i(206176),r=i(29878),n=i(181856),d=i(556683);function u(e){const{isPlaying:t,isAds:i}=e;return(0,o.jsxs)("div",{className:d.default.player,children:[(0,o.jsxs)("div",{className:d.default.progress,children:[(0,o.jsx)("div",{className:d.default.slider,children:(0,o.jsx)(l.AudioSlider,{value:e.progress,backValue:e.buffered,onDragEnd:e.onChangeProgress,disabled:e.sliderDisabled,type:i?"ads":"audio"})}),(0,o.jsx)("div",{className:d.default.time,children:e.time})]}),(0,o.jsxs)("div",{className:d.default.controls,children:[(0,o.jsx)(n.TertiaryIconButton,{onClick:e.onPlayPrev,disabled:e.prevDisabled,children:(0,o.jsx)(s.Icon24SkipBack,{})}),(0,o.jsx)(r.PlayButton,{icon:t?"pause":"play",onClick:e.onTogglePlaying,disabled:e.playDisabled}),(0,o.jsx)(n.TertiaryIconButton,{onClick:e.onPlayNext,disabled:e.nextDisabled,children:(0,o.jsx)(a.Icon24SkipForward,{})})]})]})}},29878:(e,t,i)=>{i.d(t,{PlayButton:()=>r});var o=i(474848),s=i(800483),a=i(47677),l=i(482485);function r(e){return(0,o.jsx)("button",{type:"button",...e,className:l.default.button,children:"play"===e.icon?(0,o.jsx)(s.Icon24Play,{}):(0,o.jsx)(a.Icon24Pause,{})})}},181856:(e,t,i)=>{i.d(t,{TertiaryIconButton:()=>a});var o=i(474848),s=i(756483);function a(e){return(0,o.jsx)("button",{type:"button",...e,className:s.default.button})}},206176:(e,t,i)=>{i.d(t,{AudioSlider:()=>u});var o=i(474848),s=i(296540),a=i(8520),l=i(304888),r=i(703799),n=i(290522),d=i(523019);function u({value:e,backValue:t,disabled:i,onDragEnd:u,type:_}){const c=(0,s.useRef)(null),h=(0,s.useRef)(),p=(0,l.useEventCallback)(u);return(0,s.useEffect)((()=>{const o=c.current,s=new n.default(o,{value:e,backValue:t,size:1,withBackLine:"number"==typeof t,onEndDragging:p});return h.current=s,s.setBlocked(i),()=>{s.destroy()}}),[]),(0,s.useLayoutEffect)((()=>{const e=h.current;e&&e.toggleAdState("ads"===_)}),["ads"===_]),(0,r.useUpdateLayoutEffect)((()=>{const e=h.current;e&&e.setBlocked(i)}),[i]),(0,r.useUpdateLayoutEffect)((()=>{const t=h.current;t&&t.setValue(e)}),[e]),(0,r.useUpdateLayoutEffect)((()=>{const e=h.current;e&&e.setBackValue(t)}),[t]),(0,o.jsx)("div",{className:(0,a.classNames)(d.default.slider,"ads"===_&&d.default.ads),children:(0,o.jsx)("div",{ref:c})})}},130816:(e,t,i)=>{i.d(t,{CustomScrollView:()=>c});var o=i(474848),s=i(296540),a=i(8520),l=i(775985),r=i(317552),n=i(982478),d=i(175937),u=i(25310),_=i(539067);const c=({className:e,children:t,boxRef:i,windowResize:c,autoHideScrollbar:h=!1,autoHideScrollbarDelay:p,onWheel:y,onScroll:A,onTouchStart:g,onTouchMove:P,onTouchEnd:f,onTrackerDragStart:m,onTrackerDragStop:E})=>{const{document:w,window:v}=(0,l.useDOM)(),I=s.useRef(NaN),C=s.useRef(0),b=s.useRef(0),T=s.useRef(0),k=s.useRef(0),L=s.useRef(""),M=s.useRef(0),S=s.useRef(0),D=(0,n.useExternRef)(i),O=s.useRef(null),x=s.useRef(null),R=e=>{const t=e/(k.current-b.current);(e=>{C.current=e,null!==x.current&&(x.current.style[L.current]=`translate(0, ${e}px)`)})((b.current-T.current)*t)},U=()=>{if(!D.current||!O.current||!x.current)return;const e=D.current.clientHeight,t=D.current.scrollHeight,i=e/t,o=Math.max(e*i,40);I.current=i,b.current=e,k.current=t,T.current=o,i>=1?O.current.style.display="none":(O.current.style.display="",x.current.style.height=`${o}px`,R(D.current.scrollTop))},B=(0,d.useEventListener)("resize",U);(0,r.useIsomorphicLayoutEffect)((()=>{c&&v&&B.add(v)}),[c,v]),(0,r.useIsomorphicLayoutEffect)((()=>{let e=x.current?.style,t="";void 0!==e&&("transform"in e?t="transform":"webkitTransform"in e&&(t="webkitTransform")),L.current=t}),[]),(0,r.useIsomorphicLayoutEffect)(U);const{trackerVisible:N,onTargetScroll:F,onTrackerDragStart:j,onTrackerDragStop:W,onTrackerMouseEnter:K,onTrackerMouseLeave:$}=(0,u.useTrackerVisibility)(h,p),H=[(0,d.useEventListener)("mousemove",(e=>{e.preventDefault();const t=e.clientY-M.current;(e=>{const t=e/(b.current-T.current);null!==D.current&&(D.current.scrollTop=(k.current-b.current)*t)})(Math.min(Math.max(S.current+t,0),b.current-T.current))})),(0,d.useEventListener)("mouseup",(e=>{e.preventDefault(),h&&W(),E&&E(),H.forEach((e=>e.remove()))}))];return(0,o.jsxs)("div",{className:(0,a.classNames)(_.default.view,e),children:[(0,o.jsx)("div",{className:(0,a.classNames)(_.default.barY,"lyrics_CustomScrollView__barY"),ref:O,children:(0,o.jsx)("div",{className:(0,a.classNames)(_.default.trackerY,!N&&_.default.hidden),onMouseEnter:h?K:void 0,onMouseLeave:h?$:void 0,ref:x,onMouseDown:e=>{var t;e.preventDefault(),M.current=e.clientY,S.current=C.current,h&&j(),m&&m(),(t=w)&&H.forEach((e=>e.add(t)))}})}),(0,o.jsx)("div",{className:_.default.box,tabIndex:-1,ref:D,onScroll:()=>{I.current>=1||!D.current||(h&&F(),R(D.current.scrollTop),A&&A())},onWheel:y,onTouchStart:g,onTouchMove:P,onTouchEnd:f,children:t})]})}},25310:(e,t,i)=>{i.d(t,{useTrackerVisibility:()=>l});var o=i(296540),s=i(8520);const a=s.canUseDOM?o.useLayoutEffect:o.useEffect;const l=(e=!1,t=500)=>{const[i,l]=o.useState(!e),r=o.useRef(!1),n=o.useRef(!1),{set:d,clear:u}=function(e,t){const i=o.useRef({cb:e,duration:t});a((()=>{i.current.cb=e,i.current.duration=t}),[e,t]);const l=o.useRef(),r=o.useCallback((()=>{s.canUseDOM&&l?.current&&clearTimeout(l.current)}),[]),n=o.useCallback(((e=i.current.duration)=>{r(),s.canUseDOM&&(l.current=setTimeout((()=>{const{cb:e}=i.current;"function"==typeof e&&e()}),e))}),[r]);return a((()=>r),[]),{set:n,clear:r}}((()=>l(!1)),t),_=o.useCallback((()=>{u(),l(!0),n.current=!0}),[u]),c=o.useCallback((()=>{n.current=!1,r.current||d()}),[d,r]),h=o.useCallback((()=>{n.current||(l(!0),d())}),[d]);return{trackerVisible:i,onTrackerDragStart:_,onTrackerDragStop:c,onTrackerMouseEnter:o.useCallback((()=>{u(),r.current=!0,l(!0)}),[u]),onTrackerMouseLeave:o.useCallback((()=>{h(),r.current=!1}),[h]),onTargetScroll:o.useCallback((()=>{h()}),[h])}}},721312:(e,t,i)=>{i.d(t,{AudioLyricsContainer:()=>n});var o=i(474848),s=i(296540),a=i(584191),l=i(416176),r=i(459030);function n({lines:e,credits:t,compensationTop:i,height:n,width:d}){const{audio:u,player:{isPlaying:_,isCurrentAudio:c,progress:{ms:h,duration:p},actions:{changeProgress:y}}}=(0,l.useAudioLyricsModalStore)(),A=(0,s.useMemo)((()=>e.karaoke?.map((e=>c?{...e,changeProgress:()=>{const t=e.begin/(1e3*p);y(t),a.AudioLyricsStatCollector.ensure().changeAudioProgressByLine(u)}}:e))),[e.karaoke,c,u,p]);if(A)return(0,o.jsx)(r.KaraokeAudioLyrics,{lines:A,credits:t,timeMs:h,isPlaying:_,compensationTop:i,height:n,width:d});const g=e.static||e.ugc;return g?(0,o.jsx)(r.StaticAudioLyrics,{lines:g,credits:t,compensationTop:i,height:n,width:d}):null}},221944:(e,t,i)=>{i.r(t),i.d(t,{AudioLyricsModalApplication:()=>l});var o=i(474848),s=i(527088),a=i(416176);function l({audioPlayer:e,audio:t,playlist:i,context:l,onClose:r}){return(0,o.jsx)(a.AudioLyricsModalStoreProvider,{audio:t,playlist:i,context:l,audioPlayer:e,children:(0,o.jsx)(s.AudioLyricsModalContainer,{onClose:r})})}},527088:(e,t,i)=>{i.d(t,{AudioLyricsModalContainer:()=>n});var o=i(474848),s=i(881860),a=i(103304),l=i(430618),r=i(948344);function n(e){return(0,o.jsx)(r.AudioLyricsModal,{header:(0,o.jsx)(s.AudioLyricsModalHeaderContainer,{}),content:(0,o.jsx)(a.AudioLyricsModalContentContainer,{}),player:(0,o.jsx)(l.AudioLyricsPlayerContainer,{}),onClose:e.onClose})}},103304:(e,t,i)=>{i.d(t,{AudioLyricsModalContentContainer:()=>u});var o=i(474848),s=i(828902),a=i(721312),l=i(416176),r=i(548220),n=i(611061),d=i(207722);function u(){const{lyrics:{isLoading:e,isError:t,data:i,actions:{fetchCurrent:u}},player:{isAds:_}}=(0,l.useAudioLyricsModalStore)();return _?(0,o.jsx)(n.AudioLyricsAds,{}):e?(0,o.jsx)(s.Spinner,{size:"large"}):t?(0,o.jsx)(d.AudioLyricsError,{onRetryClick:u}):i?(0,o.jsx)(a.AudioLyricsContainer,{lines:i.lines,credits:i.credits,compensationTop:24,height:"100%",width:"100%"}):(0,o.jsx)(r.AudioLyricsNotFound,{})}},881860:(e,t,i)=>{i.d(t,{AudioLyricsModalHeaderContainer:()=>r});var o=i(474848),s=i(287013),a=i(749630),l=i(416176);function r(){const{audioObject:e}=(0,l.useAudioLyricsModalStore)();return(0,o.jsx)(a.AudioLyricsModalHeader,{title:(0,s.decodeHTML)(e.title||""),performer:(0,s.decodeHTML)(e.performer||""),explicit:e.isExplicit,coverUrl:e.coverUrl_p||void 0})}},210519:(e,t,i)=>{i.d(t,{AudioLyricsModalStoreProvider:()=>_});var o=i(474848),s=i(296540),a=i(735477),l=i(656145),r=i(641705),n=i(567541),d=i(677362),u=i(595299);function _({audioPlayer:e,audio:t,playlist:i,context:_,children:c}){const[h,p]=(0,s.useState)(t),y=(0,s.useMemo)((()=>(0,a.audioTupleToAudioObject)(h)),[h]),A=(0,l.usePlayerStore)({audioPlayer:e,audio:h,playlist:i,context:_,setAudio:p}),g=(0,r.useLyricsStore)({audioPlayer:e,audio:h,prevAudio:A.prevAudio,nextAudio:A.nextAudio}),P=(0,s.useMemo)((()=>({player:A,lyrics:g,audio:h,audioObject:y,audioPlayer:e})),[A,g,h,y,e]);return(0,n.usePrefetchEffect)(P),(0,d.useMountEventsEffect)(P),(0,o.jsx)(u.AudioLyricsModalStoreContext.Provider,{value:P,children:c})}},595299:(e,t,i)=>{i.d(t,{AudioLyricsModalStoreContext:()=>s,useAudioLyricsModalStore:()=>a});var o=i(316769);const{Context:s,useContext:a}=(0,o.makeStrictContext)({name:"AudioLyricsModalStore"})},416176:(e,t,i)=>{i.d(t,{AudioLyricsModalStoreProvider:()=>s.AudioLyricsModalStoreProvider,useAudioLyricsModalStore:()=>o.useAudioLyricsModalStore});var o=i(595299),s=i(210519)},542795:(e,t,i)=>{i.d(t,{useLyricsActions:()=>a});var o=i(296540),s=i(304888);function a({audioPlayer:e,audio:t,prevAudio:i,nextAudio:a}){const l=(0,s.useEventCallback)((()=>{e.lyrics.fetch(t)})),r=(0,s.useEventCallback)((()=>{i&&e.lyrics.fetch(i)})),n=(0,s.useEventCallback)((()=>{a&&e.lyrics.fetch(a)}));return(0,o.useMemo)((()=>({fetchCurrent:l,fetchPrev:r,fetchNext:n})),[l,r,n])}},641705:(e,t,i)=>{i.d(t,{useLyricsStore:()=>r});var o=i(296540),s=i(651927),a=i(313225),l=i(542795);function r({audioPlayer:e,audio:t,prevAudio:i,nextAudio:r}){const[n,d]=(0,o.useState)((()=>e.lyrics.get((0,s.getAudioTupleFullId)(t))));(0,o.useEffect)((()=>{const i=(0,s.getAudioTupleFullId)(t);e.lyrics.fetch(t),d(e.lyrics.get(i));const o=e.lyrics.listen(i,d);return()=>{o()}}),[t]);const u=(0,l.useLyricsActions)({audioPlayer:e,audio:t,prevAudio:i,nextAudio:r});return(0,o.useMemo)((()=>{const{status:e,data:t}=n;return{isLoading:e===a.EAudioLyricsStatus.Loading||e===a.EAudioLyricsStatus.Pending,isError:e===a.EAudioLyricsStatus.Error,data:t||null,actions:u}}),[n])}},735574:(e,t,i)=>{i.d(t,{useAdjacentAudios:()=>a});var o=i(296540),s=i(535609);function a({audioPlayer:e,audio:t}){const i=(0,s.useMountedStateRef)(),a=(0,o.useRef)(null),[l,r]=(0,o.useState)(null),[n,d]=(0,o.useState)(null);return(0,o.useEffect)((()=>{const o=e.getPlaylistQueue(),s=e.isRepeatAll();a.current=t,Promise.all([o.getPrevAudio(t,{ignoreClaimed:!0,repeat:s}).catch((()=>null)),o.getNextAudio(t,{ignoreClaimed:!0,repeat:s}).catch((()=>null))]).then((([e,o])=>{i.current&&a.current===t&&(r(e),d(o))}))}),[t]),[l,n]}},592548:(e,t,i)=>{i.d(t,{useAdsState:()=>a});var o=i(296540),s=i(514640);function a({audioPlayer:e}){const[t,i]=(0,o.useState)((()=>!!e.ads?.isActive));return(0,o.useEffect)((()=>{const t=e.on(null,s.AudioPlayerEventType.AD_STARTED,(()=>{i(!0)})),o=e.on(null,s.AudioPlayerEventType.AD_COMPLETED,(()=>{i(!1)}));return()=>{t(),o()}}),[]),t}},46131:(e,t,i)=>{i.d(t,{usePlayerActions:()=>s});var o=i(304888);function s({audioPlayer:e,audio:t,playlist:i,context:s,isPlaying:a,isCurrentAudio:l}){return{togglePlaying:(0,o.useEventCallback)((()=>{a?e.pauseByButton():l?e.playByButton():e.playByButton({audio:t,playlist:i,context:s})})),playPrev:(0,o.useEventCallback)((()=>{e.playPrevByButton()})),playNext:(0,o.useEventCallback)((()=>{e.playNextByButton()})),changeProgress:(0,o.useEventCallback)((t=>{l&&!e.ads?.isActive&&e.seekBySlider(t)}))}}},58265:(e,t,i)=>{i.d(t,{usePlayerProgress:()=>r});var o=i(296540),s=i(52574),a=i(735477),l=i(514640);function r({audioPlayer:e,audio:t,isCurrentAudio:i,isAds:r}){const[n,d]=(0,o.useState)((()=>i?r?e.ads.getCurrentProgress():e.getCurrentProgress():0)),[u,_]=(0,o.useState)((()=>!i||r?0:e.getCurrentBuffered())),[c,h]=(0,o.useState)((()=>i?(0,a.audioTupleToAudioObject)(t).duration:0));(0,o.useLayoutEffect)((()=>{h(i?(0,a.audioTupleToAudioObject)(t).duration:0)}),[i,t]),(0,o.useLayoutEffect)((()=>{_(i&&!r?e.getCurrentBuffered():0)}),[i,r,e]),(0,o.useEffect)((()=>{if(!i)return;const t=e.on(null,l.AudioPlayerEventType.PROGRESS,((e,t,i)=>{d(t),h(i)})),o=e.on(null,l.AudioPlayerEventType.BUFFERED,((e,t)=>{_(t)}));return()=>{t(),o()}}),[i,t,e]);const p=Math.round(n*c*1e3);return{time:(0,s.formatAudioTime)({progress:n,duration:c}),progress:n,buffered:u,duration:c,ms:p}}},656145:(e,t,i)=>{i.d(t,{usePlayerStore:()=>u});var o=i(296540),s=i(514640),a=i(735477),l=i(592548),r=i(735574),n=i(58265),d=i(46131);function u({audioPlayer:e,audio:t,playlist:i,context:u,setAudio:_}){const c=e,[h,p]=(0,o.useState)((()=>c.getCurrentAudio())),[y,A]=(0,r.useAdjacentAudios)({audioPlayer:e,audio:t}),g=(0,o.useMemo)((()=>(0,a.audioTupleToAudioObject)(t)),[t]),P=(0,o.useMemo)((()=>{if(!h)return!1;return(0,a.audioTupleToAudioObject)(h).fullId===g.fullId}),[g,h]),[f,m]=(0,o.useState)(P),[E,w]=(0,o.useState)((()=>P&&c.isPlaying()));(0,o.useLayoutEffect)((()=>{m((e=>e||P))}),[P]),(0,o.useEffect)((()=>c.on(null,s.AudioPlayerEventType.CURRENT_CHANGED,(()=>{const e=c.getCurrentAudio();p(e),f&&_(e)}))),[f]);const v=f&&P;(0,o.useEffect)((()=>{if(!v)return void w(!1);const e=c.on(null,s.AudioPlayerEventType.PLAY,(()=>{w(!0)})),t=c.on(null,s.AudioPlayerEventType.PAUSE,(()=>{w(!1)})),i=c.on(null,s.AudioPlayerEventType.STOP,(()=>{w(!1)}));return()=>{e(),t(),i()}}),[v]);const I=(0,l.useAdsState)({audioPlayer:e}),C=(0,n.usePlayerProgress)({audio:t,isCurrentAudio:P,isAds:I,audioPlayer:e}),b=(0,d.usePlayerActions)({audioPlayer:e,audio:t,playlist:i,context:u,isCurrentAudio:P,isPlaying:E});return(0,o.useMemo)((()=>({isPlaying:E,isPlayingMode:f,isAds:I,isCurrentAudio:P,prevAudio:y,nextAudio:A,progress:C,actions:b})),[C,b,E,f,I,P])}},677362:(e,t,i)=>{i.d(t,{useMountEventsEffect:()=>l});var o=i(296540),s=i(546661),a=i(584191);function l(e){const t=(0,s.useValueRef)(e);(0,o.useEffect)((()=>(a.AudioLyricsStatCollector.ensure().open(e.audio),()=>{a.AudioLyricsStatCollector.ensure().close(t.current.audio)})),[])}},567541:(e,t,i)=>{i.d(t,{usePrefetchEffect:()=>s});var o=i(296540);function s(e){const{player:t,lyrics:i}=e,{progress:s}=t,a=s.duration-s.progress*s.duration<5;(0,o.useEffect)((()=>{a&&i.actions.fetchNext()}),[a])}},430618:(e,t,i)=>{i.d(t,{AudioLyricsPlayerContainer:()=>l});var o=i(474848),s=i(137056),a=i(416176);function l(){const{player:{actions:e,isPlaying:t,isPlayingMode:i,isAds:l,progress:r,nextAudio:n},lyrics:{actions:d}}=(0,a.useAudioLyricsModalStore)();return(0,o.jsx)(s.AudioLyricsPlayer,{time:r.time,progress:r.progress,buffered:r.buffered,isPlaying:t,isAds:l,sliderDisabled:!i,prevDisabled:!i||l,nextDisabled:!i||l||!n,onPlayPrev:()=>{d.fetchPrev(),e.playPrev()},onPlayNext:()=>{d.fetchNext(),e.playNext()},onTogglePlaying:()=>{e.togglePlaying()},onChangeProgress:e.changeProgress})}},910459:(e,t,i)=>{i.d(t,{AudioLyricsOnboardingController:()=>r});var o=i(823875),s=i(735477),a=i(514640),l=i(812477);class r{destroy(){this.closeTooltip()}setStartupHandlers(){try{(0,o.tq)().setStartupHandler("Audio/Player/LyricsButton/OnboardinHint",(e=>{if(this.registered)return;const{target:t,data:i}=e.payload;if(!t)throw new Error("Target is not defined");const{tooltip:o}=(0,l.helpHintTooltip)(t,{content:i.content,helpHintHash:i.hash,helpHintId:i.id},{width:"215px",offset:[0,8],forceSide:"bottom",align:"right",appendToParent:!0,withCloseButton:!0,autoAdjustToViewport:!0,noAutoHideOnWindowClick:!0});this.tooltip=o,this.listenAudio()}))}catch{}}listenAudio(){if(this.unlistenAudio)return;const{audioPlayer:e}=this,t=e=>{if(!e)return!1;return!!(0,s.audioTupleToAudioObject)(e).hasLyrics&&(this.openTooltip(),this.unlistenAudio&&(this.unlistenAudio(),this.unlistenAudio=null),!0)};t(e.getCurrentAudio())||(this.unlistenAudio=e.on(null,a.AudioPlayerEventType.CURRENT_CHANGED,t))}openTooltip(){const{tooltip:e}=this;e&&e.show()}closeTooltip(){const{tooltip:e}=this;e&&e.hide()}constructor({audioPlayer:e}){this.unlistenAudio=null,this.registered=!1,this.audioPlayer=e,this.setStartupHandlers()}}},584191:(e,t,i)=>{i.d(t,{AudioLyricsStatCollector:()=>r});var o=i(581903),s=i(460055),a=i(59052);let l=null;class r{static ensure(){return l||(l=new r),l}open(e){this.logEvent(this.createEventItem(s.EAudioLyricsEventType.SHOW,e))}close(e){this.logEvent(this.createEventItem(s.EAudioLyricsEventType.HIDE,e))}changeAudioProgressByLine(e){this.logEvent(this.createEventItem(s.EAudioLyricsEventType.GO_TO_TIMECODE,e))}logEvent(e){this.actionCollector.logEvent({type:s.EVENT_ITEM_TYPE,[s.EVENT_ITEM_TYPE]:e})}createEventItem(e,t){return{event_type:e,item:{id:t[a.EAudioTupleIndex.ID],owner_id:t[a.EAudioTupleIndex.OWNER_ID]}}}constructor(){this.productionCollector=new o.ProductionStatCollector,this.actionCollector=new o.ActionStatCollector(this.productionCollector)}}},715977:(e,t,i)=>{i.d(t,{AudioPlayerLyricsUI:()=>l});var o=i(476726),s=i(969433),a=i(910459);class l{open(e){this.enabled&&(this.audioPlayer.lyrics.fetch(e.audio),this.modal.open(e))}get enabled(){return(0,o.partConfigEnabled)("audio_use_web_new_version_lyrics")}constructor({audioPlayer:e}){this.audioPlayer=e,this.modal=new s.AudioLyricsModalController({audioPlayer:e}),this.onboarding=new a.AudioLyricsOnboardingController({audioPlayer:e})}}},689488:(e,t,i)=>{i.r(t);var o=i(689463),s=i(317412),a=i(452314),l=i(612627),r=i(879007);const n="audio-msg-track--transcriptToggle",d="audio-msg-track--transcript_on";let u=null;function _(e){let t=(0,a.geByClass)("audio-msg-track--wave-wrapper",e),i=0;for(let e=0;e<t.length;e++){try{i=parseInt(window.getComputedStyle(t[e],null).getPropertyValue("width"))}catch(o){i=parseInt(t[e].currentStyle.width)}if(i>0)break}return i}function c(e,t){t=Math.round(t),e.length!=t&&(e=(0,l.fastResample)(e,t));let i="",o=0;for(let t=0;t<e.length;t++)o=Math.floor(10*Number(e[t])*.95),0==o&&(o=.5),i+="M"+(3*t+1)+","+(10-o)+"v"+2*o+"Z";return`<svg class="audio-msg-track--wave" width="${3*e.length}px"><path d="${i}"></path></svg>`}function h(){let e=(0,a.geByClass)("audio-msg-track");for(let t=0;t<e.length;t++){let i=(0,a.attr)(e[t],"data-wave");(0,a.hasClass)(e[t],"audio-msg-player")&&t>0&&(i=(0,a.attr)(e[t-1],"data-wave"));let o=_(e[t]);if(i&&o){i=i.split(",");let s=(0,a.geByClass)("audio-msg-track--wave",e[t]),l=c(i,o/3);for(let e=0;e<s.length;e++){let t=(0,a.ce)("div",{innerHTML:l}).firstChild;s[e].parentNode.replaceChild(t,s[e])}}}}function p(){if(!u){const e='<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button>'+(0,r.getTemplate)("sImAudioMsgPlayerASRToggle")+'<div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>',t="audio-msg-track--with-asr-toggle",i="audio-msg-track--shortened";u=new o.VoiceMessagePlayer({onListened:e=>{window.AudioMessagePlayer.events.emit("listened",e)},voiceMessageHTML:e,onInit:(e,o)=>{e.classList.contains(t)&&o.classList.add(t),e.classList.contains(i)&&o.classList.add(i),e.querySelector(`.${n}`)?.classList.contains(d)&&o.querySelector(`.${n}`)?.classList.add(d),window.AudioMessagePlayer.events.emit("initialized",e)},onPlay:e=>{window.AudioMessagePlayer.events.emit("playing",e)},onPause:e=>{window.AudioMessagePlayer.events.emit("paused",e)},onEnd:e=>{window.AudioMessagePlayer.events.emit("finished",e)},onProgress:(e,t)=>{window.AudioMessagePlayer.events.emit("progress",e,t)},fcOnPause:e=>{window.AudioMessagePlayer.events.emit("fc_paused",e)}})}return u}(0,s.addEvent)(window,"orientationchange",(()=>setTimeout(h,500))),window.mail&&window.mail.onMessagesRepainted&&(window.onDOMReady(h),window.mail.onMessagesRepainted(h)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e){let t=p(),i=t.attachTo(e);!0===i?t.play():i.then((()=>{t.play()}))},toggle:function(){p().toggle()},seek:function(e){p().seek(e)},detachPlayer:function(e){p().detach(e)},pauseGlobalMedia:function(){o.VoiceMessagePlayer.pauseGlobalMedia()},resumeGlobalMedia:function(){o.VoiceMessagePlayer.resumeGlobalMedia()},redrawWaves:h,getWave:c,toggleTranscript:function(e,t){(0,s.cancelEvent)(t),e.classList.toggle(d),this.events.emit("transcription_toggle",e)}}},807635:(e,t,i)=>{i.d(t,{WebMediaSessionAdapter:()=>o});class o{play(){return this.player.playByButton()}pause(){return this.player.pauseByMediaSession()}isPlaying(){const e=this.player.getCurrentPlaylist();return!!e?.isLive&&e.isLive()||!1}async getPrevAudio(){return this.player.getPrevAudio()}async getNextAudio(){return this.player.getNextAudio()}next(){return this.player.playNextByMediaSession()}prev(){return this.player.playPrevByMediaSession()}seek(e){return this.player.seekByButton(e)}getCurrentPlaylist(){return this.player.getCurrentPlaylist()}subscribe(e,t){return this.player.eventBus?.subscribe(e,t)}unsubscribe(e,t){return this.player.eventBus?.unsubscribe(e,t)}getCurrentAudio(){return this.player.getCurrentAudio()}getCurrentProgress(){return this.player.getCurrentProgress()}constructor(e){this.player=e,this.player.eventBus&&(this.subscriptions=this.player.eventBus.subscriptions),this.ads=this.player.ads}}},795063:e=>{e.exports=JSON.parse('{"v":"4.8.0","ip":0,"op":31,"fr":30,"w":34,"h":24,"nm":"d","assets":[],"layers":[{"ind":1,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[18,18]},{"t":30,"s":[36,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[-9,0]},{"t":30,"s":[0,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":0,"k":100},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0},{"ind":2,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[36,18]},{"t":30,"s":[24,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[0,0]},{"t":30,"s":[39,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[100]},{"t":30,"s":[50]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0},{"ind":3,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[24,18]},{"t":30,"s":[18,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[39,0]},{"t":30,"s":[69,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[50]},{"t":30,"s":[15]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0},{"ind":4,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":0,"k":[18,18]},"p":{"a":0,"k":[69,0]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[15]},{"t":30,"s":[0]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":31,"st":0}],"markers":[]}')},772957:e=>{e.exports=JSON.parse('{"v":"4.8.0","ip":0,"op":121,"fr":30,"w":34,"h":24,"nm":"n","assets":[],"layers":[{"ind":1,"ty":4,"nm":"l","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0],"y":[0]},"t":100,"s":[100]},{"t":110,"s":[0]}]},"r":{"a":0,"k":90},"p":{"a":0,"k":[18.539,11.699,0]},"a":{"a":0,"k":[4.527,1.49,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[4.501,-32.747],[4.516,44.228]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":2,"lj":3,"o":{"a":0,"k":100},"w":{"a":0,"k":18},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":95,"s":[50]},{"t":105,"s":[0]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":100,"s":[50]},{"t":110,"s":[1]}]},"o":{"a":0,"k":0},"m":2}],"ip":95,"op":111,"st":92},{"ind":2,"ty":4,"nm":"l","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0],"y":[0]},"t":100,"s":[100]},{"t":110,"s":[0]}]},"r":{"a":0,"k":90},"p":{"a":0,"k":[18.539,11.699,0]},"a":{"a":0,"k":[4.527,1.49,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[4.501,-32.747],[4.516,44.228]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":2,"lj":3,"o":{"a":0,"k":100},"w":{"a":0,"k":18},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":100,"s":[50]},{"t":110,"s":[99]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":95,"s":[50]},{"t":105,"s":[100]}]},"o":{"a":0,"k":0},"m":2}],"ip":95,"op":111,"st":92},{"ind":3,"ty":4,"nm":"N","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[17.653,12.216,0]},"a":{"a":0,"k":[1.921,1.634,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[4.526,26.978],[4.528,-23.372]],"c":false},"a":0}},{"ty":"sh","nm":"P","ind":1,"ks":{"k":{"i":[[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[4.528,-23.372],[4.497,-19.52],[2.461,-15.732],[-0.906,-14.009],[-9.719,-14]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":1,"lj":2,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":67,"s":[36]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":77,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":90,"s":[0]},{"t":100,"s":[36]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":67,"s":[36]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":77,"s":[100]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":90,"s":[100]},{"t":100,"s":[36]}]},"o":{"a":0,"k":0},"m":2},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":60,"op":121,"st":60},{"ind":4,"ty":4,"nm":"N","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[17.653,12.216,0]},"a":{"a":0,"k":[1.921,1.634,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"2","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[3.84,11.664],[-0.855,4.89],[0,0],[-10.5,0],[0,-5.375],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[-1.903,-5.78],[0.639,-3.656],[0,0],[9.376,0],[0,6.812],[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[-12.75,14.062],[-12.201,-2.907],[-10.875,-9.5],[1.125,-20.453],[14.438,-9.875],[9.805,0.862],[-11.867,21.133],[-7.828,22.906],[-14.437,23],[18.871,22.98]],"c":false},"a":0}},{"ty":"st","nm":"S","bm":0,"lc":1,"lj":3,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.333],"y":[0]},"t":38,"s":[0]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0],"y":[0]},"t":50,"s":[16]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":60,"s":[16]},{"t":70,"s":[53]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":30,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":50,"s":[100]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":60,"s":[100]},{"t":70,"s":[53]}]},"o":{"a":0,"k":0},"m":2}],"ip":30,"op":71,"st":30},{"ind":5,"ty":4,"nm":"N","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[17.653,12.216,0]},"a":{"a":0,"k":[1.921,1.634,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"N","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[-12,0],[0,0],[-10.5,0],[0,-5.375],[0,0],[0,0],[0,0],[0,-9.875],[8.172,0],[0,0]],"o":[[0,0],[12,0],[0,0],[9.376,0],[0,9.125],[0,0],[0,0],[0,0],[0,6.625],[-11.875,0],[0,0]],"v":[[-38.562,0],[-23.062,0],[-10.875,-10.875],[1.125,-20.453],[14.094,-9.875],[4.93,0.925],[-3.875,1],[4.996,0.918],[14.75,12.75],[2.25,24.25],[-12.875,13.375]],"c":false},"a":0}},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":20,"s":[24]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":30,"s":[24]},{"t":38,"s":[97]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[11]},{"t":20,"s":[97]}]},"o":{"a":0,"k":0},"m":1},{"ty":"st","nm":"S","bm":0,"lc":2,"lj":3,"o":{"a":0,"k":100},"w":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[18]},{"t":20,"s":[8]}]},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]},{"ty":"gr","nm":"N","bm":0,"it":[{"ty":"sh","nm":"P","ind":0,"ks":{"k":{"i":[[0,0],[-12,0],[0,0],[-10.5,0],[0,-5.375],[0,0],[0,0],[0,0],[0,-9.875],[8.172,0],[0,0]],"o":[[0,0],[12,0],[0,0],[9.376,0],[0,9.125],[0,0],[0,0],[0,0],[0,6.625],[-11.875,0],[0,0]],"v":[[-38.562,0],[-23.062,0],[-10.875,-10.875],[1.125,-20.453],[14.094,-9.875],[4.93,0.925],[-3.875,1],[4.996,0.918],[14.75,12.75],[2.25,24.25],[-12.875,13.375]],"c":false},"a":0}},{"ty":"tm","nm":"T","s":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[0]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":20,"s":[21]},{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":30,"s":[21]},{"t":40,"s":[100]}]},"e":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[11]},{"t":20,"s":[100]}]},"o":{"a":0,"k":0},"m":1},{"ty":"st","nm":"S","bm":0,"lc":1,"lj":3,"o":{"a":0,"k":100},"w":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[18]},{"t":20,"s":[8]}]},"c":{"a":0,"k":[0,0,0,1]}},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[0,0]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":121,"st":0},{"ind":6,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0,0],"y":[0,0]},"t":0,"s":[24,18]},{"t":20,"s":[18,18]}]},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0,"y":0},"t":0,"s":[39,0]},{"t":20,"s":[69,0]}]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[50]},{"t":20,"s":[0]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":121,"st":0},{"ind":7,"ty":4,"nm":"0","sr":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[6.97,11.66,0]},"a":{"a":0,"k":[-30.886,-653.921,0]},"s":{"a":0,"k":[34,34,100]}},"shapes":[{"ty":"gr","nm":"R","bm":0,"it":[{"ty":"rc","nm":"R","d":1,"s":{"a":0,"k":[18,18]},"p":{"a":0,"k":[69,0]},"r":{"a":0,"k":10}},{"ty":"fl","nm":"F","bm":0,"c":{"a":0,"k":[0,0,0,1]},"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0],"y":[0]},"t":0,"s":[15]},{"t":20,"s":[0]}]},"r":1},{"ty":"tr","o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[-30.886,-653.921]},"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"nm":"T","sk":{"a":0,"k":0},"sa":{"a":0,"k":0}}]}],"ip":0,"op":121,"st":0}],"markers":[]}')}}]);try{stManager.done("dist/web/chunks/audioplayer-lib.1c52d153.js")}catch(e){}