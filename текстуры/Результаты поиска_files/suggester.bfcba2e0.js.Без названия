(()=>{"use strict";var t,e,s,i={93042:(t,e,s)=>{s.d(e,{default:()=>_});var i=s(610989),o=s(452314),n=s(317412),r=s(879007),a=s(714965),h=s(476726);function u(t,e){this._inputEl=t,this.setOptions(e),this._opts.history=!!this._opts.historyItems,this._fetchTO=!1,this._candidateQuery="",this._fetchedQuery="",this._suggestions={},(0,n.addEvent)(this._inputEl,"input keyup keydown change valueChanged refresh",this._onInputValueChanged.bind(this)),(0,n.addEvent)(this._inputEl,"click",this._onInputClick.bind(this));let s=(0,o.geByClass1)("_ui_search_button_search",this._parentEl());s&&(0,n.addEvent)(s,"click",function(){this.value()&&(this._hideSuggestions(!0),this._triggerSearch(this.value(),!0)),this._inputEl.focus()}.bind(this))}u.FETCH_DELAY=250,u.FETCH_TIMEOUT=9500,u.SEARCH_TRIGGER_DELAY=200,u.prototype._onInputClick=function(){let t=this.value();!this._isSuggestionsShown()&&!t&&this._opts.history&&this._opts.historyItems&&this._showSuggestions(this._opts.historyItems,!0),!this._isSuggestionsShown()&&t&&this._suggestions[t]&&this._showSuggestions(this._suggestions[t])},u.prototype._onInputValueChanged=function(t){"valueChanged"==t.type&&(this.value()||(this._hideSuggestions(!0),this._triggerSearch(""))),"refresh"==t.type&&(this.value()||this._hideSuggestions(!0)),t.keyCode===n.KEY.DEL?(this._candidateIsNotAppropriateForUser=!0,this._candidateQuery=""):this._candidateIsNotAppropriateForUser=!1;let e=!1;if("keydown"==t.type){if(this._prevCaretPos=this._prevCaretPos||0,this._candidateQuery&&(t.keyCode==n.KEY.TAB||t.keyCode==n.KEY.RIGHT&&this._inputEl.selectionStart==this._inputEl.value.length&&this._prevCaretPos==this._inputEl.selectionStart)&&(this._opts.onlyShowSuggestions||(this._inputEl.value=this._candidateQuery),this._candidateQuery="",this._renderCandidate(),this._hideSuggestions(),this._fetchSuggestions(),t.keyCode==n.KEY.TAB&&(e=!0)),setTimeout(function(){this._prevCaretPos=this._inputEl.selectionStart}.bind(this)),(t.keyCode==n.KEY.UP||t.keyCode==n.KEY.DOWN)&&this._isSuggestionsShown())return this._selectSuggestion(t.keyCode==n.KEY.DOWN),!1;if(t.keyCode==n.KEY.ENTER){const t=this._onAcceptSuggestion();return this._cancelFetchSuggestion(),this._hideSuggestions(!0),void this._triggerSearch(this.value(),!0,void 0,t&&(0,o.domData)(t,"id"))}}else if("keyup"==t.type)switch(t.keyCode){case n.KEY.ESC:this._isSuggestionsShown()?(this._triggerSearch(this.value(),!this._candidateQuery||this._candidateQuery),this._hideSuggestions(!0)):(this._inputEl.value="",this._triggerSearch(""));break;case n.KEY.ENTER:case n.KEY.RIGHT:case n.KEY.LEFT:case n.KEY.TAB:case n.KEY.SHIFT:case n.KEY.CTRL:case n.KEY.ALT:case 35:case 36:case n.KEY.UP:case n.KEY.DOWN:break;default:let t=this.value();t.length>1?(this._fetchSuggestions(),this._renderCandidate()):this._hideSuggestions(!0),this._candidateIsNotAppropriateForUser?this._triggerSearchDelayed(t):this._triggerSearchDelayed(t,this._getFirstSuggestion(t))}if(setTimeout(function(){this.value()||(this._candidateQuery=""),this._renderCandidate()}.bind(this)),e)return!1},u.prototype._onAcceptSuggestion=function(){let t=(0,o.geByClass1)("ui_search_suggestion_selected",this._parentEl());return t&&(0,r.isFunction)(this._opts.onAcceptSuggestion)&&this._opts.onAcceptSuggestion((0,o.domData)(t,"id"),(0,o.domData)(t,"value"),t),t},u.prototype._cancelFetchSuggestion=function(){clearTimeout(this._fetchTimeout),clearTimeout(this._fetchTO),this._fetchTimeout=this._fetchTO=0},u.prototype._selectSuggestion=function(t){let e="ui_search_suggestion_selected",s=(0,o.geByClass1)(e,this._parentEl());if((0,o.removeClass)(s,e),t)s=(0,o.domNS)(s)||(0,o.geByClass1)("ui_search_sugg_list_item",this._parentEl());else{let t=(0,o.geByClass)("ui_search_sugg_list_item",this._parentEl());s=(0,o.domPS)(s)||t[t.length-1]}(0,o.addClass)(s,e),this._candidateQuery="",s&&(0,r.isFunction)(this._opts.onSelectSuggestion)&&this._opts.onSelectSuggestion((0,o.domData)(s,"id"),(0,o.domData)(s,"value"),s),this._opts.onlyShowSuggestions||(this._inputEl.value=(0,o.domData)(s,"value"),this._triggerSearchDelayed(this.value(),!0,void 0,(0,o.domData)(s,"id")))},u.prototype._parentEl=function(){return(0,o.gpeByClass)("_wrap",this._inputEl)},u.prototype._renderCandidate=function(){let t=(0,o.geByClass1)("_ui_search_suggester_shadow",this._parentEl());if(!t)return;let e=this.value();return this._candidateQuery&&0===this._candidateQuery.indexOf(e.toLowerCase())?(t.innerHTML='<span class="ui_search_suggester_shadow_hidden">'+e+"</span>"+this._candidateQuery.substring(e.length),(0,o.show)(t),!0):(t.innerHTML="",(0,o.hide)(t),!1)},u.prototype._isSuggestionsShown=function(){return!!this._suggestionsShown},u.prototype._hideSuggestions=function(t){t&&(this._candidateQuery="",this._renderCandidate());let e=(0,o.geByClass1)("_ui_search_sugg_list",this._parentEl());(0,o.hide)(e),(0,o.hide)((0,o.geByClass1)("_ui_search_suggester_shadow",this._parentEl())),this._onWindowMouseDown&&(0,n.removeEvent)(window,"mousedown",this._onWindowMouseDown),this._renderCandidate(),this._suggestionsShown=!1},u.prototype._showSuggestions=function(t,e){this._hideSuggestions(),t=t||[];let s=(0,r.trim)(this.value());if(0==t.length)return;let a=(0,o.geByClass1)("_ui_search_sugg_list",this._parentEl()),h="";e&&(h+='<div class="ui_search_sugg_history_header">'+i.getLang("global_recent_search_history")+"</div>"),h+="<div>";let u=0,_=this;(0,r.each)(t,(function(t,o){if(s==o[3]&&!_._opts.onlyShowSuggestions)return;let n="";e&&(n='<a class="ui_search_sugg_list_item_remove" data-hash="'+o[4]+'" data-id="'+o[0]+'">'+i.getLang("global_remove_history_search_item")+"</a>"),h+='<div class="ui_search_sugg_list_item '+(e?"ui_search_sugg_list_item_history":"")+'" data-value="'+o[3]+'" data-id="'+o[0]+'">'+o[1]+n+"</div>",u++})),0!=u&&(h+="</div>",a.innerHTML=h,(0,o.show)(a),(0,n.removeEvent)(a,"click"),(0,n.addEvent)(a,"click",function(t){if((0,o.hasClass)(t.target,"ui_search_sugg_list_item_remove")){let e=(0,o.domData)(t.target,"id"),s=(0,o.domData)(t.target,"hash"),i=(0,o.domChildIndex)((0,o.domPN)(t.target));return(0,o.re)((0,o.domPN)(t.target)),this._opts.historyItems.splice(i,1),0==this._opts.historyItems.length&&this._hideSuggestions(),ajax.post("al_search.php",{act:"remove_history_item",hash:s,item_id:e,type:this._opts.type}),!1}if((0,o.hasClass)(t.target,"ui_search_sugg_list_item")){let e=(0,o.domData)(t.target,"value");const s=this._onAcceptSuggestion();this._hideSuggestions(!0),this._opts.onlyShowSuggestions||(this._inputEl.value=e,this._triggerSearch(e,!0,!0,s&&(0,o.domData)(s,"id"))),(0,o.elfocus)(this._inputEl)}}.bind(this)),(0,n.removeEvent)(a,"mousemove"),(0,n.addEvent)(a,"mousemove",(function(t){(0,o.hasClass)(t.target,"ui_search_sugg_list_item")&&((0,o.removeClass)((0,o.geByClass1)("ui_search_suggestion_selected",a),"ui_search_suggestion_selected"),(0,o.addClass)(t.target,"ui_search_suggestion_selected"))})),(0,n.removeEvent)(a,"mouseleave"),(0,n.addEvent)(a,"mouseleave",(function(t){(0,o.removeClass)((0,o.geByClass1)("ui_search_suggestion_selected",a),"ui_search_suggestion_selected")})),this._candidateIsNotAppropriateForUser||e||(this._candidateQuery=t[0][3],this._renderCandidate()||(this._candidateQuery="")),(0,n.addEvent)(window,"mousedown",this._onWindowMouseDown=function(t){(0,o.domClosest)("_wrap",t.target)&&!(0,o.hasClass)(t.target,"_ui_search_params_button")||this._hideSuggestions(!0)}.bind(this)),this._suggestionsShown=!0)},u.prototype._triggerSearchDelayed=function(t,e,s,i){clearTimeout(this._triggerSearchTO);let o=this._opts.search_trigger_delay||u.SEARCH_TRIGGER_DELAY;this._triggerSearchTO=setTimeout(function(){this._triggerSearch(t,e,s,i)}.bind(this),o)},u.prototype._triggerSearch=function(t,e,s,i){t||(e=""),t=(0,r.trim)(t),!0===e&&(e=t),e=void 0!==e?(0,r.trim)(e):e,(void 0===this._lastTriggeredSearch||this._lastTriggeredSearch||t)&&(this._lastTriggeredSearch&&this._lastTriggeredSearch==t&&(this._lastTriggeredSuggestedSearch&&void 0===e||this._lastTriggeredSuggestedSearch==e)||(this._lastTriggeredSearch=t,this._lastTriggeredSuggestedSearch=e,this._opts.onSearch&&this._opts.onSearch(t,e,s,this._fetchedQuery,i)))},u.prototype.value=function(){return(0,r.trim)(this._inputEl.value)?this._inputEl.value:""},u.prototype._getFirstSuggestion=function(t){return!(!this._suggestions[t]||!this._suggestions[t][0])&&this._suggestions[t][0][3]},u.prototype._onSuggestionsFetched=function(t,e){let s=(0,r.trim)(this.value());s==t&&(this._fetchedQuery=t,this._suggestions[t]=e,this._showSuggestions(e),e.length?this._candidateIsNotAppropriateForUser?this._triggerSearch(s):this._triggerSearch(s,!this._candidateQuery||this._candidateQuery):this._triggerSearch(s,!0))},u.prototype.saveHistoryItem=function(t,e,s,i,o){if(!i||!this._opts.history)return;let n=this._opts.historyItems||[];for(let e=0,s=n.length;e<s;e++)if(n[e][1]==t)return;ajax.post("al_search.php",{act:"save_history_item",type:this._opts.type,q:t,object_owner_id:e,object_id:s,total_count:i,total_count_hash:o,hash:this._opts.saveHash},{onDone:function(t){t&&(this._opts.historyItems=t||[])}.bind(this)})},u.prototype.setOptions=function(t,e){this._opts=e?(0,r.extend)(this._opts,t):(0,r.extend)(t,{})},u.prototype._fetchSuggestions=function(){const t=(0,a.ensureAudioSearchSuggestionsService)(),e=(0,h.partConfigEnabled)("audio_search_suggestions_api_web");clearTimeout(this._fetchTO);let s=(0,r.trim)(this.value());s.length<2||((0,r.isFunction)(this._opts.fetchSuggestionsFn)?this._onSuggestionsFetched(s,this._opts.fetchSuggestionsFn(s)):this._fetchTO=setTimeout(function(){this._fetchTimeout=setTimeout(function(){this._fetchTimeout=0,this._onSuggestionsFetched(s,[])}.bind(this),u.FETCH_TIMEOUT),e&&"audio"===this._opts.type?t.fetchFx({query:s}).then((t=>{const e=t.map(((t,e)=>[e+1,t.replace(s,`<em>${s}<em>`),"",t,this._opts.type]));this._fetchTimeout&&(clearTimeout(this._fetchTimeout),this._onSuggestionsFetched(s,e))})):ajax.post("/hints.php",{act:"a_gsearch_hints",q:s,section:this._opts.type},{onDone:function(t){this._fetchTimeout&&(clearTimeout(this._fetchTimeout),this._onSuggestionsFetched(s,t))}.bind(this),cache:1})}.bind(this),u.FETCH_DELAY))};const _=u},714965:(t,e,s)=>{s.d(e,{ensureAudioSearchSuggestionsService:()=>r});var i=s(32489),o=s(942451),n=s(172186);const r=(0,o.makeSharedState)("global/audio/searchSuggestions",(()=>(0,n.createAudioSearchSuggestionsService)({domain:(0,i.createDomain)("global/audio/searchSuggestions"),name:"global/audio/searchSuggestions"})),{version:1})},172186:(t,e,s)=>{s.d(e,{createAudioSearchSuggestionsService:()=>n});var i=s(346082),o=s(94359);function n(t){const e=(0,o.getEffectorServiceDomain)(t);return{fetchFx:(0,i.createAudioSearchSuggestionsFetchFx)({domain:e})}}},346082:(t,e,s)=>{s.d(e,{createAudioSearchSuggestionsFetchFx:()=>o});var i=s(523430);function o({domain:t}){const e=(0,i.createAudioGetSearchSuggestionsFx)({domain:t});return t.createEffect((async({query:t,exps:s})=>(await e({query:{query:t,exps:s}})).suggestions))}},234810:(t,e,s)=>{var i=s(490712),o=s(93042);window.vk?.pe?.static_manager_dynamic_imports&&window.vk?.stDomain&&(s.p=window.vk.stDomain+"/dist/"),window.Suggester=o.default;try{window.stManager.done(window.jsc("web/suggester.js"))}catch(t){}requestIdleCallback((()=>{try{(0,i.statlogsValueEvent)("entries_requests",1,"suggester","web")}catch{}}),{timeout:5e3})}},o={};function n(t){var e=o[t];if(void 0!==e)return e.exports;var s=o[t]={exports:{}};return i[t].call(s.exports,s,s.exports,n),s.exports}n.m=i,t=[],n.O=(e,s,i,o)=>{if(!s){var r=1/0;for(_=0;_<t.length;_++){for(var[s,i,o]=t[_],a=!0,h=0;h<s.length;h++)(!1&o||r>=o)&&Object.keys(n.O).every((t=>n.O[t](s[h])))?s.splice(h--,1):(a=!1,o<r&&(r=o));if(a){t.splice(_--,1);var u=i();void 0!==u&&(e=u)}}return e}o=o||0;for(var _=t.length;_>0&&t[_-1][2]>o;_--)t[_]=t[_-1];t[_]=[s,i,o]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},s=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,n.t=function(t,i){if(1&i&&(t=this(t)),8&i)return t;if("object"==typeof t&&t){if(4&i&&t.__esModule)return t;if(16&i&&"function"==typeof t.then)return t}var o=Object.create(null);n.r(o);var r={};e=e||[null,s({}),s([]),s(s)];for(var a=2&i&&t;"object"==typeof a&&!~e.indexOf(a);a=s(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>t[e]));return r.default=()=>t,n.d(o,r),o},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.e=()=>Promise.resolve(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="/dist/",(()=>{var t={42357:0};n.O.j=e=>0===t[e];var e=(e,s)=>{var i,o,[r,a,h]=s,u=0;if(r.some((e=>0!==t[e]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(h)var _=h(n)}for(e&&e(s);u<r.length;u++)o=r[u],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(_)},s=self.webpackChunkvkweb=self.webpackChunkvkweb||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var r=n.O(void 0,[50560,762,35623,81765,23592],(()=>n(234810)));r=n.O(r)})();