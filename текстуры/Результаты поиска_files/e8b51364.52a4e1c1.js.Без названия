"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[61717],{73514:(e,t,n)=>{n.d(t,{API_DEFAULT_TIMEOUT:()=>r,API_GET_FOLDERS_TYPES:()=>g,API_GET_HELP_HINTS:()=>_,API_GET_INFO_FIELDS:()=>h,API_GET_MULTI_FIELDS:()=>p,API_GROUP_FIELDS:()=>f,API_MAX_RETRY_TIMEOUT:()=>u,API_MIN_RETRY_TIMEOUT:()=>c,API_USER_FIELDS:()=>m,CALL_JOIN_LINK_URL_BASE:()=>q,CALL_JOIN_SHORTENED_LINK_URL_BASE:()=>Q,CHANNELS_GLPH_TIMEOUT:()=>D,CHANNELS_PER_PAGE:()=>v,CHAT_INVITE_LINK_URL_BASE:()=>K,CLIENT_ID:()=>i,COMMENTS_PER_PAGE:()=>E,COMMENTS_REFRESH_INTERVAL:()=>d,CONVOS_PER_PAGE:()=>k,EDU_ACHIEVEMENTS_MINI_APP_ID:()=>he,EDU_HELP_CONVO_ID:()=>Z,EDU_INTEGRATION_BANNER_ID:()=>ge,EDU_INTEGRATION_BANNER_LIMIT:()=>ke,EDU_LK_SFERUM_MINI_APP_ID:()=>Ie,EDU_SYSTEM_INTEGRATION_MINI_APP_ID:()=>_e,EMPLOYEE_CARD_MINI_APP_ID:()=>B,ENGINE_VERSION:()=>s,GIFTS_RANDOM_STICKER_PACK_GIFT_ID:()=>Ce,HELPDESK_MINIAPP_ID:()=>z,ID_VK_COM_BASE:()=>te,INVITE_TO_CHAT_VISIBLE_MESSAGES_COUNT:()=>H,ISOLATED_CALL_JOIN_LINK_URL_BASE:()=>X,ISOLATED_CALL_JOIN_SHORTENED_LINK_URL_BASE:()=>Y,LIKE_PEERS_FIRST_LOAD:()=>P,LIKE_PEERS_PER_PAGE:()=>w,MAX_COMMENT_SIZE:()=>me,MAX_INT32:()=>l,MAX_MESSAGES_FORWARD_LEVEL:()=>T,MAX_MESSAGE_ATTACHES:()=>W,MAX_MESSAGE_SIZE:()=>V,MAX_VIDEO_FORWARD_LEVEL:()=>L,MEMBERS_SEARCH_COUNT:()=>ve,MESSAGES_PER_PAGE:()=>C,POSTS_PER_PAGE:()=>I,POST_ADS_MINIAPP_ID:()=>fe,REACTIONS_REFRESH_INTERVAL:()=>a,SEARCH_CHANNELS_COUNT:()=>b,SEARCH_CONVOS_COUNT:()=>A,SEARCH_DEBOUNCE_MS:()=>S,SEARCH_MESSAGES_COUNT:()=>M,SEARCH_POSTS_COUNT:()=>N,SFERUM_DOMAIN:()=>ce,SFERUM_RELATED_DOMAINS:()=>ue,SFERUM_VERIFICATION_LINK:()=>le,STATIC_BASE_URL:()=>o,STICKER_IMAGE_EDITOR_MINI_APP_ID:()=>x,STORAGE_APP_UNAVAILABLE_KEY:()=>oe,STORAGE_DB_NAME:()=>ee,STORAGE_DEVICE_ID_KEY:()=>pe,STORAGE_OWNER_ID_KEY:()=>ne,STORAGE_VIEWER_ID_KEY:()=>ie,THREAD_COMMENTS_COUNT:()=>y,TYPING_EXPIRATION_TIME:()=>R,UGC_STICKERS_APP_ID:()=>O,UGC_STICKERS_MINI_APP_ID:()=>$,VIDEO_COMMENTS_PER_PAGE:()=>F,VKME_APP_INSTALL_LINK:()=>J,VKME_CHAT_INVITE_LINK_URL_BASE:()=>j,VK_DOMAINS:()=>ae,VK_PAY_APP_ID:()=>U,VK_RELATED_DOMAINS:()=>de,VK_TERMS_URL:()=>se,VMOJI_CONSTRUCTOR_APP_ID:()=>G,WEB_VK_ME_DOMAIN:()=>re});const i=7694673,o="https://vk.com",s=19,r=1e4,a=15e3,d=15e3,c=500,u=2e4,l=2**31-1,m=["id","first_name","first_name_gen","first_name_acc","last_name","last_name_gen","last_name_acc","sex","has_photo","photo_id","photo_50","photo_100","photo_200","contact_name","occupation","bdate","city","screen_name","online_info","verified","blacklisted","blacklisted_by_me","can_call","can_write_private_message","can_send_friend_request","can_invite_to_chats","friend_status","followers_count","profile_type","contacts","employee_mark","employee_working_state","is_service_account","image_status","photo_base","educational_profile"],f=["id","name","screen_name","type","photo_id","photo_50","photo_100","members_count","member_status","verified","is_closed","can_message","online_info","deactivated","activity","ban_info","is_messages_blocked","can_post_donut","site","reposts_disabled","description","action_button","menu","role","unread_count"],h=["messages_recommendation_list_hidden","show_only_not_muted_messages","messages_multiline_input","messages_auto_unarchive","messages_transcript_auto_show","business_notify","messages_show_banner_teacher_verification","conversations_bar"],p=["profile_type","photo_100","is_service_account"],_=["im:transcript_autoshow_setting","im:channels_onboarding","im:web_send_options","im:web_archive_location","im:web_return_to_previous_chat","voice_assistant:add_to_group_chat"],g=["channels"],k=20,v=20,C=30,I=20,E=50,y=2,M=20,N=20,A=100,b=25,S=500,w=30,P=6,R=5e3,D=3e4,T=2,L=4,U=7131443,O=51538586,G=7929683,F=20,x=7754294,B=7631183,$=51538586,V=4096,W=10,H=250,K="https://vk.me/join/",j="https://web.vk.me/#/join/",q="https://vk.com/call/join/",Q="https://web.vk.me/call/",J="https://vk.me/app",X="https://web.vk.me/#/call/join/",Y="https://sferum.ru/",z=6126832,Z=-222277107,ee="reforged-storage-db-v1",te="https://id.vk.com",ne="reforged-owner-id",ie="reforged-viewer-id",oe="reforged-app-unavailable",se="https://vk.com/terms",re="web.vk.me",ae=["vk.com","vk.ru"],de=[...ae,"vk.me","vk.cc"],ce="sferum.ru",ue=[ce,"me.sferum.ru"],le=`https://${ce}/?s=me`,me=16384,fe=51707812,he=51751619,pe="reforged-device-id",_e=51833161,ge=1,ke=1,ve=50,Ce=10101,Ie=51938986},520828:(e,t,n)=>{n.d(t,{addAttach:()=>h,count:()=>v,docsWithPreview:()=>A,docsWithoutPreview:()=>b,fromAddableAttach:()=>f,generatePollBackgroundGradientStyle:()=>g,hasPublicVideo:()=>N,ids:()=>d,isAddableAttach:()=>u,isGame:()=>y,isMiniAppAvailable:()=>E,kindsCount:()=>k,last:()=>c,overrideUrlForPreview:()=>I,preview:()=>a,rearrangeAttaches:()=>_,removeAttach:()=>p,resolveMiniAppId:()=>s,resolveMiniAppStatus:()=>C,toggleStickerIsPopupAutoplayed:()=>S});var i=n(401193),o=n(175953);const s=e=>e,r=[-1,0,1,2];function a(e,t=0,n=0,i=!1){const o=["o","p","q","r"];if("Curator"===e.kind)return e.image?.find((e=>e.height>n&&e.width))||null;if("Story"===e.kind)if(e.photo)e=e.photo;else{if(!e.video)return null;e=e.video}if("Video"===e.kind||"Gift"===e.kind||"PollBackgroundPhoto"===e.kind||"VideoMessage"===e.kind||"Narrative"===e.kind||"MiniApp"===e.kind){const i="MiniApp"===e.kind?e.images:e.image;return i&&(i.find((({width:e,height:i})=>e>=t&&i>=n))||i.reduce(((e,t)=>!e||t.width*t.height>e.width*e.height?t:e)))||null}const s="Photo"===e.kind?e.sizes:e.image;return s?i?Array.from(s.entries()).find((([e,{width:i,height:s}])=>o.includes(e)&&i>=t&&s>=n))?.[1]||s.get("r")||s.get("q")||s.get("p")||s.get("o")||null:Array.from(s.entries()).find((([e,{width:i,height:s}])=>!o.includes(e)&&i>=t&&s>=n))?.[1]||s.get("w")||s.get("z")||s.get("y")||s.get("x")||s.get("m")||s.get("s")||null:null}function d(e){const t=[];for(const n of e.photos||[])t.push(`photo${n.ownerId}_${n.id}`);for(const n of e.videos||[])t.push(`video${n.ownerId}_${n.id}`);for(const n of e.audios||[])t.push(`audio${n.ownerId}_${n.id}`);for(const n of e.audioPlaylists||[])t.push(`audio_playlist${n.ownerId}_${n.id}`);e.artist&&t.push(`artist${e.artist.id}`),e.podcast&&t.push(`podcast${e.podcast.ownerId}_${e.podcast.id}`),e.market&&t.push(`market${e.market.ownerId}_${e.market.id}`),e.marketAlbum&&t.push(`market_album${e.marketAlbum.ownerId}_${e.marketAlbum.id}`);for(const n of e.docs||[])t.push(`doc${n.ownerId}_${n.id}`);e.voice&&t.push(`doc${e.voice.ownerId}_${e.voice.id}`),e.event&&t.push(`event${o.toRealId(e.event.id)}`),e.wall&&t.push(`wall${e.wall.ownerId}_${e.wall.id}`);for(const n of e.narratives||[])t.push(`narrative${n.ownerId}_${n.id}`);e.wallReply&&t.push(`wall_reply${e.wallReply.ownerId}_${e.wallReply.id}`),e.poll&&t.push(`poll${e.poll.ownerId}_${e.poll.id}`),e.story&&t.push(`story${e.story.ownerId}_${e.story.id}`),e.link&&t.push(`${e.link.url}`),e.stickerPack&&t.push(`${e.stickerPack.url}`),e.inviteLink&&t.push(`invite_link${e.inviteLink.url}`),e.donutLink&&t.push(`donut_link${e.donutLink.ownerId}`),e.widget&&t.push(`widget${e.widget.id}`),e.ugcSticker&&t.push(`ugc_sticker${e.ugcSticker.item.owner_id}_${e.ugcSticker.id}`);for(const n of e.curator||[])t.push(`curator${n.id}`);e.question&&t.push(`question${e.question.ownerId}_${e.question.id}`),e.album&&t.push(`album${e.album.ownerId}_${e.album.id}`),e.article&&t.push(`article${e.article.ownerId}_${e.article.id}_${e.article.accessKey}`),e.wallHistory&&t.push(`wall${e.wallHistory.ownerId}_${e.wallHistory.id}`);for(const n of e.miniApps||[])t.push(`mini_app${n.id}`);return t}function c(e){return 0===Object.keys(e).length?null:e.widget||e.wallReply||e.wall||e.poll||e.donutLink||e.moneyTransfer||e.moneyRequest||e.miniApps?.slice(-1)?.[0]||e.miniAppWidgets?.slice(-1)?.[0]||e.article||e.artist||e.audioPlaylists?.slice(-1)?.[0]||e.podcast||e.audios?.slice(-1)?.[0]||e.voice||b(e.docs)?.slice(-1)?.[0]||e.narratives?.slice(-1)?.[0]||e.event||e.geo||e.story||e.marketAlbum||e.market||e.album||e.inviteLink||e.link||e.stickerPack||e.curator?.slice(-1)?.[0]||e.graffiti||e.videoMessage||e.ugcSticker||e.sticker||e.finishedCall||e.activeCall||e.gift||e.question||A(e.docs)?.slice(-1)?.[0]||e.videos?.slice(-1)?.[0]||e.photos?.slice(-1)?.[0]||null}function u(e){switch(e.kind){case"Artist":case"Audio":case"Doc":case"Geo":case"Link":case"Photo":case"Poll":case"Video":case"Voice":case"StickerPack":return!0;case"ActiveCall":case"Article":case"AudioPlaylist":case"Album":case"DonutLink":case"Event":case"FinishedCall":case"Gift":case"Graffiti":case"InviteLink":case"Market":case"MarketAlbum":case"MiniApp":case"MiniAppWidget":case"MoneyRequest":case"MoneyTransfer":case"Narrative":case"Podcast":case"Question":case"Sticker":case"Story":case"UgcSticker":case"VideoMessage":case"Wall":case"WallHistory":case"WallReply":case"Widget":case"Curator":case"Unknown":return!1;default:(0,i.exhaustivenessCheck)(e)}}function l(e){switch(e.kind){case"Artist":case"Geo":case"Link":case"Poll":case"Voice":case"Market":return!0;case"Audio":case"Doc":case"Photo":case"Video":return!1;default:(0,i.exhaustivenessCheck)(e)}}function m(e){switch(e.kind){case"Photo":return"photos";case"Video":return"videos";case"Artist":return"artist";case"Audio":return"audios";case"Doc":return"docs";case"Geo":return"geo";case"Link":return"link";case"Poll":return"poll";case"Voice":return"voice";case"Market":return"market";default:(0,i.exhaustivenessCheck)(e)}}function f(e){const t=Array.isArray(e),n=t?e[0]:e;return{[m(n)]:l(n)||t?e:[e]}}function h(e,t){t.photos&&(e.photos=[...e.photos||[],...t.photos]),t.videos&&(e.videos=[...e.videos||[],...t.videos]),t.audios&&(e.audios=[...e.audios||[],...t.audios]),t.docs&&(e.docs=[...e.docs||[],...t.docs]),t.voice&&(e.voice=t.voice),t.geo&&(e.geo=t.geo),t.poll&&(e.poll=t.poll),t.market&&(e.market=t.market),t.link&&(e.link=t.link)}function p(e,t,n){switch(t.kind){case"Audio":if(!e.audios)break;const o=M(e.audios,t.id,n);o?e.audios=o:delete e.audios;break;case"AudioPlaylist":if(!e.audioPlaylists)break;const s=M(e.audioPlaylists,t.id,n);s?e.audioPlaylists=s:delete e.audioPlaylists;break;case"Podcast":e.podcast&&delete e.podcast;break;case"Doc":if(!e.docs)break;const r=M(e.docs,t.id,n);r?e.docs=r:delete e.docs;break;case"Photo":if(!e.photos)break;const a=M(e.photos,t.id,n);a?e.photos=a:delete e.photos;break;case"Video":if(!e.videos)break;const d=M(e.videos,t.id,n);d?e.videos=d:delete e.videos;break;case"Voice":e.voice&&delete e.voice;break;case"Poll":e.poll&&delete e.poll;break;case"Wall":e.wall&&delete e.wall;break;case"WallReply":e.wallReply&&delete e.wallReply;break;case"Article":e.article&&delete e.article;break;case"Link":e.link&&delete e.link;break;case"StickerPack":e.stickerPack&&delete e.stickerPack;break;case"InviteLink":e.inviteLink&&delete e.inviteLink;break;case"Geo":e.geo&&delete e.geo;break;case"MiniApp":if(!e.miniApps)break;const c=(0,i.toNonEmpty)(e.miniApps.filter((e=>e.id!==t.id)));c?e.miniApps=c:delete e.miniApps;break;case"MiniAppWidget":if(!e.miniAppWidgets)break;const u=(0,i.toNonEmpty)(e.miniAppWidgets.filter((e=>e.cmid!==t.cmid)));u?e.miniAppWidgets=u:delete e.miniAppWidgets;break;case"Story":e.story&&delete e.story;break;case"Curator":if(!e.curator)break;const l=(0,i.toNonEmpty)(e.curator.filter((e=>e.id!==t.id)));l?e.curator=l:delete e.curator;break;case"Market":e.market&&delete e.market;break;case"Narrative":if(!e.narratives)break;const m=(0,i.toNonEmpty)(e.narratives.filter((e=>e.id!==t.id)));m?e.narratives=m:delete e.narratives;break;case"Event":e.event&&delete e.event;break;case"MarketAlbum":e.marketAlbum&&delete e.marketAlbum;break;case"DonutLink":e.donutLink&&delete e.donutLink;break;case"Artist":e.artist&&delete e.artist;break;case"Album":e.album&&delete e.album;break;case"Question":break;default:(0,i.exhaustivenessCheck)(t)}}function _(e,{currentPosition:t,newPosition:n},o){switch(o){case"photos":const s=e[o];if(!s)return;const r=s[t];if(!r)return;s.splice(t,1),s.splice(n,0,r),e[o]=s;break;case"videos":const a=e[o];if(!a)return;const d=a[t];if(!d)return;a.splice(t,1),a.splice(n,0,d),e[o]=a;break;case"audios":const c=e[o];if(!c)return;const u=c[t];if(!u)return;c.splice(t,1),c.splice(n,0,u),e[o]=c;break;case"audioPlaylists":const l=e[o];if(!l)return;const m=l[t];if(!m)return;l.splice(t,1),l.splice(n,0,m),e[o]=l;break;case"docs":const f=e[o];if(!f)return;const h=f[t];if(!h)return;f.splice(t,1),f.splice(n,0,h),e[o]=f;break;case"narratives":const p=e[o];if(!p)return;const _=p[t];if(!_)return;p.splice(t,1),p.splice(n,0,_),e[o]=p;break;default:(0,i.exhaustivenessCheck)(o)}}function g(e){const t=e.angle-90,{points:n}=e,i=[];for(let e=0;e<n.length;e++){const t=n[e],o=100*e/(n.length-1);i.push(`${t} ${o}%`)}return`linear-gradient(${t}deg, ${i.join(", ")})`}function k(e){return Object.keys(e).length}function v(e){return Object.values(e).reduce(((e,t)=>e+(Array.isArray(t)?t.length:1)),0)}function C(e){return function(e){return r.includes(e)}(e)?e:-1}function I(e,t){const n=new URL(e.url);return n.searchParams.delete("api_preview"),n.searchParams.delete("no_preview"),n.searchParams.delete("api"),t?(n.searchParams.set("no_preview","1"),n.searchParams.set("api","1")):n.searchParams.set("from_module","vkmsg_desktop"),n.toString()}function E(e){return 1===e.status}function y(e){return"type"in e&&("game"===e.type||"html5_game"===e.type)}function M(e,t,n){return(0,i.toNonEmpty)(e.filter(((e,i)=>!(i===n&&t===e.id))))}function N(e){const t=c(e),n=v(e);return Boolean(1===n&&"Video"===t?.kind&&"short_video"!==t.type&&(!t.isFromMessage||t.files?.external))}function A(e){return e?(0,i.toNonEmpty)(e.filter((e=>e.image))):null}function b(e){return e?(0,i.toNonEmpty)(e.filter((e=>!e.image))):null}function S(e,t){"attaches"in e&&e.attaches.sticker&&(e.attaches.sticker.isPopupAutoplayed=t)}},510632:(e,t,n)=>{function i(e){const[t,...n]=e;if(!t)throw Error("Сегмент не может быть пустым");return{elements:[t,...n]}}function o(e,t){const n=e.segments.findIndex((({elements:e})=>e.find((e=>e.id===t))));if(!(n<0))return n}function s(e,t){for(const{elements:n}of e.segments){const e=n.find((e=>e.id===t));if(e)return e}}function r(e,t,n=u){const o=[];let s=i(t),r=0;for(;r<e.segments.length;){const t=e.segments[r];if(!t)throw Error("Вышли за границы отрезка.");const i={left:s.elements[0],right:s.elements[s.elements.length-1]||s.elements[0]},d={left:t.elements[0],right:t.elements[t.elements.length-1]||t.elements[0]};if(n(i.right,t.elements[0])<0)break;if(c(d,i,n)){s=a(t,s.elements,n)}else o.push(t);r++}return{segments:[...o,s,...e.segments.slice(r,e.segments.length)]}}function a(e,t,n){const i=function(e,t,n=u){const i=t[0],o=t[t.length-1];if(!i||!o)return e;const s=e.length;let r=0,a=0;for(;r<e.length;){const t=e[r];if(!t)throw Error("Вышли за границы отрезка.");if(n(i,t)<=0)break;r++}for(;a<e.length;){const t=e[a];if(!t)throw Error("Вышли за границы отрезка.");if(n(o,t)<0)break;a++}return[...e.slice(0,r),...t,...e.slice(a,s)]}(e.elements,t,n),[o,...s]=i;if(!o)throw Error("Сегмент не может быть пустым");return{elements:[o,...s]}}function d(e,t){const n=o(e,t);if(void 0===n)return;const s=e.segments[n];if(!s)return;const r=s.elements.filter((e=>e.id!==t));0===r.length?e.segments=[...e.segments.slice(0,n),...e.segments.slice(n+1,e.segments.length)]:e.segments[n]=i(r)}function c(e,t,n=u){const i=n(e.right,t.left)>=0&&n(e.left,t.left)<=0,o=n(e.left,t.right)<=0&&n(e.right,t.left)>=0;return i||o}function u(e,t){return e.id-t.id}n.d(t,{addElements:()=>r,getElementById:()=>s,getSegmentIndexByElementId:()=>o,increaseSegment:()=>a,removeElement:()=>d})},103026:(e,t,n)=>{n.d(t,{CHANNELS_BASE_PATH:()=>l,MAX_PINNED:()=>c,allHistoryNodes:()=>Q,appendPost:()=>b,canAdmin:()=>u,cleanup:()=>O,clearMediaViewerCache:()=>j,deletePost:()=>w,deletePostponedPost:()=>P,findMediaViewerCacheItem:()=>X,findPostByCmid:()=>M,findPostInPostponedByCmid:()=>N,historyAround:()=>E,insertPostponedPosts:()=>L,insertPosts:()=>T,isChannelId:()=>m,isEmpty:()=>_,isHidden:()=>v,isPinned:()=>C,isPostponedEmpty:()=>g,isUnread:()=>k,lastPost:()=>I,merge:()=>p,postponedHistoryAround:()=>y,readUntil:()=>G,replacePost:()=>S,resetPostponed:()=>K,resolveId:()=>f,restorePost:()=>R,restorePostponedPost:()=>D,safeGet:()=>J,setAdminLevel:()=>W,setArchived:()=>F,setMembership:()=>B,setMuted:()=>x,setPhotos:()=>V,setRights:()=>H,setSortId:()=>$,toRealGroupId:()=>h});var i=n(847891),o=n(401193),s=n(175953),r=n(84113),a=n(510632),d=n(73514);const c=5;function u(e){return e.adminLevel>=3}const l="/channels";function m(e){return i.Ranges.isGroupId(e)}function f(e){return m(e)||(e=0),e}function h(e){return s.toRealId(s.resolveId(e))}function p(e,t){if(e.id!==t.id)throw new Error("Channel.merge вызван на 2 разных каналах");const n=t.history;return t.history=e.history,T(t,n.confirmed),t}function _(e){return r.isEmpty(e.history)}function g(e){return e.postponed.loaded&&0===e.postponed.history.segments.length}function k(e){return e.unreadCount>0}function v(e){return e.majorSortId<=0&&e.minorSortId<=0}function C(e){return e.majorSortId>0}function I({channel:e,withPending:t}){return r.lastNode({history:e.history,withPending:t,withDeleted:!1,withFailed:!0})?.item}function E(e,t){return r.around(e.history,t)}function y(e,t){const n=a.getSegmentIndexByElementId(e.postponed.history,t);if(void 0===n)return{slice:void 0,hasAfter:!1,hasBefore:!1};const i=e.postponed.history.segments,o=n+1,s=n-1,r=o<i.length?i[o]:null,d=s>=0?i[s]:null;return{slice:i[n],hasAfter:e.postponed.hasMore||Boolean(r),hasBefore:Boolean(d)}}function M(e,t){const n=r.findNodeByCmid(e.history,t);if("Node"===n.node?.kind||"DeletedNode"===n.node?.kind)return n.node}function N(e,t){return a.getElementById(e.postponed.history,t)?.content}function A(e,t){return!!e.mediaViewerCache.items.find((e=>e.cmid===t))}function b(e,t,n){const i=r.findNodeByCmid(e.history,t.cmid),o=r.lastCmid(e.history);if(void 0!==o&&o>=t.cmid&&"Deleted"===i.status&&"Normal"===t.kind)return void R(e,t.cmid,t);const s=function(e,t){const n=e.history.pending.find((e=>e.item.cmid===t));void 0!==n&&r.removePending(e.history,n.item.randomId);return n}(e,t.cmid)?.item,a=s?.attaches.link;a&&(t.attaches.link?t.attaches.link={...t.attaches.link,image:t.attaches.link.image||a.image,title:t.attaches.link.title||a.title}:t.attaches.link=a),e.mediaViewerCache.hasNext=!0,r.append(e.history,t,n)}function S(e,t){A(e,t.cmid)&&j(e),r.replace(e.history,t)}function w(e,t,n){A(e,t)&&j(e),r.remove(e.history,t,n)}function P(e,t){const n=a.getElementById(e.postponed.history,t);n&&(n.content.markDeleted=!0)}function R(e,t,n){r.restore(e.history,t,n),j(e)}function D(e,t){const n=a.getElementById(e.postponed.history,t);n&&delete n.content.markDeleted}function T(e,t){r.insert(e.history,t)}function L(e,t){t.length&&(e.postponed.hasMore||!e.postponed.history.segments[0]||1!==e.postponed.history.segments.length?e.postponed.history=a.addElements(e.postponed.history,t,U):e.postponed.history.segments=[a.increaseSegment(e.postponed.history.segments[0],t,U)])}const U=function(e,t){switch(!0){case e.content.cmid===t.content.cmid:return 0;case e.content.sentAt===t.content.sentAt:return e.content.cmid-t.content.cmid;default:return e.content.sentAt-t.content.sentAt}};function O(e){const t=e.unreadCount>0?e.inReadCmid:void 0;r.cleanup(e.history,1.5*d.POSTS_PER_PAGE,t)}function G(e,t,n){if(void 0===n){const i=e.history.confirmed.filter((n=>"Node"===n.kind&&function(e,t){return t.cmid>e.inReadCmid}(e,n.item)&&n.item.cmid<=t)).length;n=Math.max(0,e.unreadCount-i)}e.inReadCmid=t,e.unreadCount=n}function F(e,t){e.isArchived=t,t&&(e.unreadCount=0,e.majorSortId=0)}function x(e,t){e.isMuted=t}function B(e,t){e.isMember=t,t||(e.majorSortId=0)}function $(e,t){void 0!==t.majorSortId&&(e.majorSortId=t.majorSortId),void 0!==t.minorSortId&&(e.minorSortId=t.minorSortId)}function V(e,t){e.photo||(e.photo={}),e.photo.photo50=t.photo50,e.photo.photo100=t.photo100,e.photo.baseUrl=t.photo,e.photo.thumbhashUrl=t.thumbHashUrl}function W(e,t){0!==t&&1!==t&&2!==t&&3!==t||(e.adminLevel=t)}function H(e,t){e.rights={...e.rights,...t}}function K(e){e.postponed.hasMore=!1,e.postponed.loaded=!1,e.postponed.history.segments=[]}function j(e){e.mediaViewerCache={items:[],hasPrev:!0,hasNext:!0}}function q(e){return e.history.confirmed.reduce(((e,t)=>("Node"===t.kind&&e.push(t),e)),[])}function Q(e){return[...q(e),...e.history.pending]}function J(e,t){const n=e.get(t);if(n)return n;if(o.isDev)throw new Error(`Канал ${t} не найден в кэше! Обрати внимание на то как загружаются недостающие данные в сторе.`);return e.get(f(0))}function X(e,t,n){return e.mediaViewerCache.items.find((e=>t===e.id&&n===e.cmid))}},358096:(e,t,n)=>{n.d(t,{addIncognitoMembers:()=>_,addMembers:()=>l,allowMemberToWrite:()=>v,getIncognitoMember:()=>p,getMember:()=>f,isAdmin:()=>u,isMemberRestrictedToWrite:()=>k,removeIncognitoMember:()=>g,removeMember:()=>m,reset:()=>r,resetMembers:()=>a,resolveIncognitoMemberId:()=>o,restrictMemberToWrite:()=>C,setAdmin:()=>d,setCount:()=>s,unsetAdmin:()=>c});var i=n(175953);const o=e=>e;function s(e,t){e.count=t}function r(e){e.count=0,e.adminIds=new Set,a(e)}function a(e){e.incognitoMembers=new Map,e.invitedIds=new Set,e.members=new Map,e.memberIds=new Set}function d(e,t){e.adminIds.add(t)}function c(e,t){e.adminIds.delete(t)}function u(e,t){return(i.isUserPeerId(t)||i.isGroupPeerId(t))&&e.adminIds.has(t)}function l(e,t,n){for(const n of t){const{peerId:t,isMessageRequest:i}=n;e.members.set(t,n),i?e.invitedIds.add(t):e.memberIds.add(t)}e.count=n||e.memberIds.size+h(e)}function m(e,t){const n=e.members.get(t);n&&(e.members.delete(t)&&(e.count=e.count-1),n.isMessageRequest?e.invitedIds.delete(t):e.memberIds.delete(t))}function f(e,t){return e.members.get(t)}function h(e){return e.incognitoMembers?[...e.incognitoMembers?.values()].filter((e=>!e.memberId)).length:0}function p(e,t){return e.incognitoMembers.get(t)}function _(e,t){e.incognitoMembers||(e.incognitoMembers=new Map),t.forEach((t=>{e.incognitoMembers?.set(t.id,t)})),e.count=e.count+h(e)}function g(e,t){const n=e.incognitoMembers?.get(t);e.incognitoMembers?.delete(t)&&!n?.memberId&&(e.count=e.count-1)}function k(e,t){return Boolean(e.members.get(t)?.isRestrictedToWrite)}function v(e,t){if(!i.isChatPeerId(t)){const n=e.members.get(t);n&&(n.isRestrictedToWrite=!1)}}function C(e,t){if(!i.isChatPeerId(t)){const n=e.members.get(t);n&&(n.isRestrictedToWrite=!0)}}},856562:(e,t,n)=>{n.d(t,{CASPER_MESSAGE_DELETE_TTL:()=>c,DEFAULT_CHAT_PERMISSIONS:()=>m,MAX_PINNED:()=>u,PEER_FLAGS:()=>l,addFolder:()=>Ke,allConfirmedHistoryNodes:()=>f,allHistoryNodes:()=>p,allQueuedMessages:()=>K,allowViewerToWrite:()=>We,appendMessage:()=>ae,appendQueuedMessage:()=>de,canAddToFolder:()=>T,canCreateChatBasedOnCurrent:()=>E,canDelete:()=>O,canDeleteMessageForAll:()=>G,canFinishCall:()=>D,canForwardFrom:()=>S,canForwardTo:()=>w,canInviteTo:()=>P,canPin:()=>U,canReadMembers:()=>X,canSendReactions:()=>ee,canUseMassMentions:()=>R,changeQueuedMessageEntrypoint:()=>Ne,changeUserState:()=>He,cleanup:()=>_e,clearChatDataOnLeave:()=>Re,clearMediaViewerCache:()=>qe,deleteMessage:()=>le,description:()=>ze,findHistoryNodeByCmid:()=>g,findMediaViewerCacheItem:()=>Ze,findMessageByCmid:()=>k,findMessageByRandomId:()=>v,firstUnreadReactionCmid:()=>Q,flowHistory:()=>_,forbidWritingForAll:()=>tt,getConvoFailedMessagesCount:()=>j,getFirstUnreadMentionCmid:()=>q,getMRSenderPeerId:()=>b,hasBirthdayBanner:()=>it,hasPeerFlag:()=>Ye,hasUnreadExpireables:()=>B,hasUnreadMentions:()=>V,hasUnreadReactions:()=>$,hideBanner:()=>Qe,insertMessages:()=>fe,isBusinessNotify:()=>A,isCasper:()=>I,isDeleted:()=>M,isDisabled:()=>nt,isEmpty:()=>W,isForbidedWritingForAll:()=>et,isHidden:()=>z,isInFolder:()=>Z,isIncognitoChat:()=>Te,isMR:()=>y,isMessageUnread:()=>J,isMuted:()=>C,isNew:()=>H,isPendingMR:()=>N,isPinned:()=>L,isPromo:()=>ie,isUnread:()=>F,isUnreadOut:()=>x,lastEditableMessage:()=>h,markRead:()=>ge,merge:()=>oe,pinMessage:()=>Fe,readInUntil:()=>ke,readOutUntil:()=>ve,readReactions:()=>Ee,rejectMR:()=>$e,removeFolder:()=>je,removeInitialGroupConvoGap:()=>he,removePending:()=>re,replaceExpiredReplies:()=>ue,replaceInviteLinks:()=>Ge,replaceMessage:()=>ce,replaceUnreadReactions:()=>Ce,resolvePrecreatedConvoId:()=>Y,restoreMessage:()=>me,restrictViewerToWrite:()=>Ve,safeGet:()=>Je,setChatPermissions:()=>Le,setConvoState:()=>Be,setDescription:()=>Ue,setPeerFlag:()=>Xe,setStickersParams:()=>Oe,setUnreadReaction:()=>Ie,shouldShortPollReactions:()=>te,unpinMessage:()=>xe,updateAcl:()=>De,updateFlags:()=>we,updateIsDrafted:()=>be,updateIsNew:()=>Se,updateIsStickersPopupAutoplayDisabledByUser:()=>st,updateMessageFlags:()=>Pe,updatePush:()=>se,updateSendingFail:()=>Me,updateSortId:()=>Ae});var i=n(175953),o=n(649166),s=n(401193),r=n(73514),a=n(84113),d=n(358096);const c=144e5,u=5,l={isMarkedUnread:20,isArchived:23,isBusinessNotify:13,DONT_USE_isMuted:4},m={invite:"all",change_info:"all",change_pin:"all",use_mass_mentions:"all",see_invite_link:"all",call:"all",change_style:"all",change_admins:"owner",stickers_popup_autoplay:"on"};function f(e){return e.history.confirmed.reduce(((e,t)=>("Node"===t.kind&&e.push(t),e)),[])}function h(e){const t=f(e);for(let e=t.length-1;e>=0;e--){const n=t[e]?.item;if("Normal"===n?.kind&&o.isEditable(n,Date.now()))return n}}function p(e){return[...f(e),...e.history.pending]}function _(e,t,n,i=!1){let o=!1;return e.map(((r,a)=>{const d=e[a-1],c="DeletedNode"===r.kind?r.restorable:r.item;if(!d){const e="DeletedNode"!==r.kind&&"Normal"===c.kind&&t<c.cmid;return e&&!o&&(o=!0),{kind:"split",atUnread:e&&n,atDate:!0}}const u="DeletedNode"===d.kind?d.restorable:d.item,l=["gift","graffiti","finishedCall"],m=!(0,s.isSameDate)(u.sentAt,c.sentAt),f="Queued"!==u.kind&&"Queued"!==c.kind&&!c.isOut&&c.cmid>t&&!o;f&&!o&&(o=!0);const h=("Normal"===u.kind||i&&"Queued"===u.kind)&&("Normal"===c.kind||i&&"Queued"===c.kind)&&u.authorId===c.authorId&&!u.expireTTL&&!c.expireTTL&&!c.replyMessage&&!l.some((e=>void 0!==u.attaches[e]))&&!l.some((e=>void 0!==c.attaches[e]))&&!u.attaches.sticker,p="Expired"===u.kind&&"Expired"===c.kind;return!m&&!f&&c.sentAt-u.sentAt<=3e5&&(h||p)?{kind:"continue"}:{kind:"split",atUnread:f,atDate:m}}))}function g(e,t){return a.findNodeByCmid(e.history,t)}function k(e,t){const{node:n}=g(e,t);return"Node"===n?.kind?n.item:void 0}function v(e,t){const n=a.findPendingNode(e.history,t);return n?n.item:void 0}function C(e){return"everything"!==e.push.mode}function I(e){return("ChatConvo"===e.kind||"MessageRequestChatConvo"===e.kind)&&e.isCasper}function E(e,t){if("ChatConvo"!==e.kind)return!1;const n=d.isAdmin(e.members,t),o=e.ownerId===t,s=e.members.count>0;return!i.isFavorites(e.peerId,t)&&s&&(n||o)}function y(e){return"MessageRequestChatConvo"===e.kind||"MessageRequestUserConvo"===e.kind}function M(e){switch(e.kind){case"ChatConvo":return e.isDeleted;case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"BusinessNotify":return!1;default:(0,s.exhaustivenessCheck)(e)}}function N(e){return("MessageRequestChatConvo"===e.kind||"MessageRequestUserConvo"===e.kind)&&"pending"===e.MRStatus}function A(e){return"BusinessNotify"===e.kind}function b(e){return"MessageRequestUserConvo"===e.kind?e.peerId:e.inviterPeerId}function S(e){return!I(e)}function w(e){return"MessageRequestChatConvo"!==e.kind&&!A(e)}function P(e){return"ChatConvo"===e.kind&&e.acl.canInvite}function R(e){return"ChatConvo"===e.kind&&e.acl.canUseMassMentions}function D(e){return Boolean("ChatConvo"===e.kind&&e.activeCall?.canFinishCall&&e.activeCall.id)}function T(e){return!(y(e)||A(e)||("ContactConvo"===e.kind||"UserConvo"===e.kind)&&0===e.history.confirmed.length)}function L(e){return[4,5,6].some((t=>(e.majorSortId&1<<t)>0))}function U(e,t){return!("Group"===t.kind||Ye(e,l.isArchived)||W(e)||y(e)||I(e))}function O(e){switch(e.kind){case"ChatConvo":return!0;case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"BusinessNotify":return!1;default:(0,s.exhaustivenessCheck)(e)}}function G(e,t,n,s){const r=i.isUserPeerId(t.authorId)||i.isGroupPeerId(t.authorId),a="ChatConvo"===e.kind&&d.isAdmin(e.members,n),c=t.authorId===n,u=!(!r||"ChatConvo"!==e.kind)&&d.isAdmin(e.members,t.authorId),l="ChatConvo"!==e.kind||"in"===e.state;if(s.vkm_admin_can_delete_message){if(a&&c)return!0;if(a&&!u)return!0}switch(!0){case!e.canWrite.allowed:case!l:case o.isCall(t):case i.isFavorites(e.peerId,n):return!1;case c:return!0;case Date.now()-t.sentAt>864e5:return!1;case a&&!u:return!0;default:return!1}}function F(e){return e.unreadCount>0||Ye(e,l.isMarkedUnread)}function x(e){if("MessageRequestChatConvo"===e.kind)return!1;const t=a.lastNode({history:e.history,withDeleted:!0,withPending:!0,withFailed:!0}),n="DeletedNode"===t?.kind?t.restorable:t?.item;return void 0!==n&&(n.isOut&&J(e,n))}function B(e){return e.unreadExpireables.size>0}function $(e){return e.unreadReactions.size>0}function V(e){switch(e.kind){case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"BusinessNotify":return!1;case"ChatConvo":return e.unreadMentions.size>0;default:return(0,s.exhaustivenessCheck)(e)}}function W(e){return a.isEmpty(e.history)}function H(e){return e.isNew}function K(e){return e.history.pending.map((e=>e.item))}function j(e){return K(e).filter((e=>e.hasFailed)).length}function q(e){const t=Math.min(...e.unreadMentions.values());return t===1/0?void 0:o.resolveCmid(t)}function Q(e){const t=Math.min(...e.unreadReactions.keys());return t===1/0?void 0:o.resolveCmid(t)}function J(e,t){if(t.peerId!==e.peerId)throw new Error("Передано сообщение не принадлежащее беседе");return"Queued"===t.kind||(t.isOut?t.cmid>e.outReadBy:t.cmid>e.inReadBy)}function X(e){return e.canWrite.allowed||!e.canWrite.allowed&&"no_access"!==e.canWrite.reason}function Y(e){return e}function z(e){return e.majorSortId<=0&&e.minorSortId<=0&&0===e.history.pending.length}function Z(e,t){return e.folderIds.has(t)}function ee(e){if(I(e)||"message_request_banner"===e.convoBanner?.name)return!1;switch(e.kind){case"UserConvo":case"GroupConvo":return e.canWrite.allowed;case"ChatConvo":return"in"===e.state&&e.acl.canSendReactions&&(e.canWrite.allowed||"forbid_writing_for_all"===e.canWrite.reason)&&!e.isGroupChannel;case"BusinessNotify":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"ContactConvo":return!1;default:(0,s.exhaustivenessCheck)(e)}}function te(e){return!("ChatConvo"!==e.kind||!e.shouldShortPollReactions)}function ne(e,t){return!!e.mediaViewerCache.items.find((({cmid:e})=>e===t.cmid))}function ie(e){return"GroupConvo"===e.kind&&e.isPromo}function oe(e,t,{invalidateHistory:n}={}){if(void 0!==t){if(t?.peerId!==e.peerId)throw new Error("Convo.merge вызван на 2 разных чатах");if(!n){const n=e.history;e.history=t.history,pe(e,n.confirmed),a.insert(e.history,n.confirmed)}0===e.majorSortId&&(e.majorSortId=t.majorSortId),e.isDrafted||(e.isDrafted=t.isDrafted),"ChatConvo"===e.kind&&"ChatConvo"===t.kind&&(e.members=t.members,e.stickersParams=t.stickersParams,e.inviteLinks=t.inviteLinks)}}function se(e,t){e.push=t}function re(e,t){a.removePending(e.history,t)}function ae(e,t,n,i,o){if(t.peerId!==e.peerId)throw new Error("Передано сообщение не принадлежащее беседе");e.minorSortId<n&&(e.minorSortId=n);const r=a.lastCmid(e.history),d=void 0===r||r<t.cmid;if(!t.isOut&&d&&J(e,t)&&(e.unreadCount++,"ChatConvo"===e.kind&&i&&e.unreadMentions.add(t.cmid),"Normal"===t.kind&&t.expireTTL&&e.unreadExpireables.add(t.cmid)),ye(t.isOut,e),o){switch(o.kind){case"InputKeyboardUpsertEvent":e.currentKeyboard=o.keyboard;break;case"InputKeyboardDeleteEvent":delete e.currentKeyboard;break;default:return(0,s.exhaustivenessCheck)(o)}e.currentKeyboard="InputKeyboardUpsertEvent"===o.kind?o.keyboard:void 0}e.mediaViewerCache.hasNext=!0,a.append(e.history,t,"randomId"in t?t.randomId:void 0)}function de(e,t){a.appendPending(e.history,t),ye(t.isOut,e)}function ce(e,t,n){"ChatConvo"===e.kind&&(e.unreadMentions.delete(t.cmid),n&&J(e,t)&&e.unreadMentions.add(t.cmid)),e.unreadExpireables.delete(t.cmid),("Normal"===t.kind&&t.expireTTL||"Expired"===t.kind)&&J(e,t)&&e.unreadExpireables.add(t.cmid),ne(e,t)&&qe(e),a.replace(e.history,t)}function ue(e,t){e.history.confirmed.forEach((e=>{if("Node"!==e.kind||"Normal"!==e.item.kind)return;const{replyMessage:n}=e.item;void 0!==n&&"ForeignExpired"!==n.kind&&n.cmid===t&&(e.item.replyMessage=o.expireForeign(n))}))}function le(e,t,n){if(!t.isOut&&J(e,t)&&(e.unreadCount=Math.max(0,e.unreadCount-1)),"ChatConvo"===e.kind&&e.unreadMentions.delete(t.cmid),e.unreadExpireables.delete(t.cmid),e.unreadReactions.delete(t.cmid),e.inReadBy===t.cmid){const n=a.findNodeByCmid(e.history,t.cmid);if("Node"===n.status){const t=e.history.confirmed[n.index-1];void 0!==t&&"GapNode"!==t.kind&&(e.inReadBy=a.nodeCmid(t))}}ne(e,t)&&qe(e),ot(e,t.cmid,!0),a.remove(e.history,t.cmid,n)}function me(e,t,n){a.restore(e.history,t.cmid,t),"Normal"===t.kind&&ot(e,t.cmid,!1),"ChatConvo"===e.kind&&n&&e.unreadMentions.add(t.cmid),qe(e)}function fe(e,t,n){const i=[];t.reverse().forEach(((t,s,r)=>{if(0===s&&t.cmid>1&&n.backward&&i.push({kind:"GapNode",fromCmid:o.resolveCmid(1),toCmid:o.resolveCmid(t.cmid-1)}),i.push({kind:"Node",item:t}),s===r.length-1&&n.forward){const n=a.lastCmid(e.history);void 0!==n&&t.cmid<n&&i.push({kind:"GapNode",fromCmid:o.resolveCmid(t.cmid+1),toCmid:o.resolveCmid(n)})}})),pe(e,i),0===i.length?1===e.history.confirmed.length&&"GapNode"===e.history.confirmed[0]?.kind&&(e.history.confirmed=[]):a.insert(e.history,i)}function he(e){"GroupConvo"===e.kind&&1===e.history.confirmed.length&&"GapNode"===e.history.confirmed[0]?.kind&&(e.history.confirmed=[])}function pe(e,t){t.forEach((t=>{const n="Node"===t.kind&&"randomId"in t.item?t.item.randomId:void 0;n&&re(e,n)}))}function _e(e){const t=e.unreadCount>0?e.inReadBy:void 0;a.cleanup(e.history,1.5*r.MESSAGES_PER_PAGE,t)}function ge(e){Xe(e,l.isMarkedUnread,!1)}function ke(e,t,n){if(!(e.inReadBy>t)){if(void 0===n){const i=a.lastCmid(e.history);if(i&&t>=i)n=0;else{const i=e.history.confirmed.filter((n=>{if("Node"!==n.kind)return!1;const i=n.item;return!i.isOut&&J(e,i)&&i.cmid<=t})).length;n=Math.max(0,e.unreadCount-i)}}switch(e.inReadBy=t,e.unreadCount=n,0===n&&Xe(e,l.isMarkedUnread,!1),e.kind){case"UserConvo":case"GroupConvo":case"ContactConvo":case"MessageRequestUserConvo":case"MessageRequestChatConvo":case"BusinessNotify":break;case"ChatConvo":for(const n of e.unreadMentions)n<=t&&e.unreadMentions.delete(n);break;default:(0,s.exhaustivenessCheck)(e)}for(const n of e.unreadExpireables)n<=t&&e.unreadExpireables.delete(n)}}function ve(e,t){e.outReadBy>=t||(e.outReadBy=t)}function Ce(e,t){e.unreadReactions=t.reduce(((t,n)=>(t.set(n,e.unreadReactions.get(n)),t)),new Map)}function Ie(e,t,n){e.unreadReactions.has(t)&&e.unreadReactions.set(t,n)}function Ee(e,t){e.unreadReactions.delete(t)}function ye(e,t){e&&t.currentKeyboard?.oneTime&&delete t.currentKeyboard}function Me(e,t,n){const i=a.findPendingNode(e.history,t);void 0!==i&&o.updateFailedStatus(i.item,n)}function Ne(e,t,n){const i=a.findPendingNode(e.history,t);void 0!==i&&o.updateEntrypoint(i.item,n)}function Ae(e,t){"majorSortId"in t?e.majorSortId=t.majorSortId:e.minorSortId=t.minorSortId}function be(e,t){e.isDrafted=t}function Se(e,t){e.isNew=t}function we(e,t,n){let i;switch(t){case"unset":i=e.peerFlags&~n;break;case"replace":i=n;break;case"set":i=e.peerFlags|n;break;default:(0,s.exhaustivenessCheck)(t)}e.peerFlags=i}function Pe(e,t,n,i){const s=a.findNodeByCmid(e.history,t).node;if(void 0===s||"GapNode"===s.kind)return;const{isDeleted:r,isDeletedForAll:d,isSpam:c}=o.updateFlags(s,n,i);if((r||c)&&"DeletedNode"!==s?.kind||d){le(e,"DeletedNode"===s.kind?s.restorable:s.item,{isRestorable:!1})}}function Re(e){e.state="left",e.acl={canChangeInfo:!1,canChangeInviteLink:!1,canChangePin:!1,canInvite:!1,canPromoteUsers:!1,canSeeInviteLink:!1,canModerate:!1,canCopyChat:!1,canCall:!1,canUseMassMentions:!1,canChangeServiceType:!1,canChangeStickersPopupAutoplay:!1,canChangeStyle:!1,canSendReactions:!1},d.reset(e.members),delete e.inviteLinks}function De(e,t){e.acl=t}function Te(e){return Boolean(e.isIncognito)}function Le(e,t,n){e.permissions=t,e.isService=n}function Ue(e,t){e.description=t}function Oe(e,t){e.stickersParams=t}function Ge(e,t){e.inviteLinks=t}function Fe(e,t){if(e.pinnedMessage){const t=k(e,e.pinnedMessage.cmid);"Normal"===t?.kind&&o.unpinMessage(t)}e.pinnedMessage=t;const n=k(e,t.cmid);"Normal"===n?.kind&&o.pinMessage(n)}function xe(e){const t=e.pinnedMessage;if(!t)return;delete e.pinnedMessage;const n=k(e,t.cmid);return"Normal"===n?.kind&&o.unpinMessage(n),t}function Be(e,t){e.state=t}function $e(e){return"UserConvo"===e.kind?{...e,kind:"MessageRequestUserConvo",MRStatus:"rejected",canWrite:{allowed:!1,reason:"mr_rejected"}}:{...e,MRStatus:"rejected",canWrite:{allowed:!1,reason:"mr_rejected"}}}function Ve(e,t,n){e.canWrite={allowed:!1,reason:t,until:n}}function We(e){e.canWrite={allowed:!0}}function He(e,t){e.state=t}function Ke(e,t){e.folderIds.add(t)}function je(e,t){e.folderIds.delete(t)}function qe(e){e.mediaViewerCache={items:[],hasPrev:!0,hasNext:!0}}function Qe(e){e.convoBanner=void 0}function Je(e,t){const n=e.get(t);if(n)return n;if(s.isDev)throw new Error(`Беседа ${t} не найдена в кэше! Обрати внимание на то как загружаются недостающие данные в сторе.`);return e.get(i.resolveId())}function Xe(e,t,n){e.peerFlags=n?e.peerFlags|1<<t:e.peerFlags&~(1<<t)}function Ye(e,t){return(e.peerFlags&1<<t)>0}function ze(e){switch(e.kind){case"ChatConvo":case"GroupConvo":return e.description;default:return}}function Ze(e,t,n,i){return e.mediaViewerCache.items.find((e=>`${n}-${t}-${i}`==`${e.cmid}-${e.id}-${e.position}`))}function et(e){return"ChatConvo"===e.kind&&!!e.forbidedWritingForAll&&e.forbidedWritingForAll.value}function tt(e,t,n){"ChatConvo"===e.kind&&(e.forbidedWritingForAll={value:t,until:n})}function nt(e){switch(e.kind){case"ChatConvo":return e.isCommunityChat&&!e.canWrite.allowed&&"chat_disabled"===e.canWrite.reason;case"BusinessNotify":case"ContactConvo":case"GroupConvo":case"MessageRequestChatConvo":case"MessageRequestUserConvo":case"UserConvo":return!1;default:(0,s.exhaustivenessCheck)(e)}}function it(e){return"birthday"===e.convoBanner?.name}function ot(e,t,n){e.history.confirmed.forEach((e=>{"Node"===e.kind&&"Normal"===e.item.kind&&(e.item=o.updateForeignAvailableStatus(e.item,t,n))}))}function st(e,t){e.isStickersPopupAutoplayDisabledByUser=t}},728921:(e,t,n)=>{n.d(t,{FOLDER_NAME_LIMIT:()=>a,convertFlags:()=>b,deleteFolder:()=>k,empty:()=>m,getLockId:()=>f,getSublistsPeerIds:()=>u,getSupportedTypes:()=>c,isConvoInSublist:()=>h,isLoaded:()=>l,push:()=>_,refresh:()=>g,reorderFolders:()=>M,replaceFolder:()=>y,resolveId:()=>d,setHasMore:()=>C,setName:()=>E,setSublists:()=>I,setUnreadCounters:()=>v,sorter:()=>p,updateFlags:()=>S});var i=n(856562),o=n(84113),s=n(401193),r=n(73514);const a=16;function d(e){return e}function c(e){let t=[...r.API_GET_FOLDERS_TYPES];return e.vkm_business_folder&&t.push("business"),e.vkm_personal_folder&&t.push("personal"),e.me_channels||(t=t.filter((e=>"channels"!==e))),t.join(",")}function u(e,t){return t.reduce(((t,n)=>(e.sublists.has(n.type)&&t.push(...Array.from(n.peerIds)),t)),[])}function l(e,t){return e[t].boundaryMinorId!==1/0}function m(){return[]}function f(e,t){return`folder_${e}_${t}`}function h(e,t,n){for(const i of t)if(e.sublists.has(i.type)&&i.peerIds.has(n.peerId))return!0;return!1}function p(e,t){if(e.isDrafted!==t.isDrafted)return Number(t.isDrafted)-Number(e.isDrafted);const n=o.lastNode({history:e.history,withDeleted:!1,withPending:!0,withFailed:!1})?.item,i=o.lastNode({history:t.history,withDeleted:!1,withPending:!0,withFailed:!1})?.item;return"Queued"===n?.kind||"Queued"===i?.kind?(i?.sentAt??0)-(n?.sentAt??0):t.minorSortId!==e.minorSortId?t.minorSortId-e.minorSortId:t.peerId-e.peerId}function _(e,t,n,o,s,r){const a=e.find((e=>e.id===t));if(a){for(const s of o)if(r.vkm_new_convo_folder_logic)w(a,n,s);else{if(!i.isInFolder(s,t))continue;w(a,n,s),g(e,s)}a[n].hasMore=s,a[n].hasMore||(a[n].boundaryMinorId=1)}}function g(e,t){if(!t.spaceId)for(const n of e)n.all.peerIds.delete(t.peerId),n.unread.peerIds.delete(t.peerId),i.isDeleted(t)||i.isInFolder(t,n.id)&&(t.minorSortId>=n.all.boundaryMinorId&&n.all.peerIds.add(t.peerId),i.isUnread(t)&&t.minorSortId>=n.unread.boundaryMinorId&&n.unread.peerIds.add(t.peerId))}function k(e,t){const n=e.findIndex((e=>e.id===t));-1!==n&&e.splice(n,1)}function v(e,t,n,i){const o=e.find((e=>e.id===t));o&&(o.unreadCount=n,o.unreadUnmutedCount=i)}function C(e,t,n){e[t].hasMore=n}function I(e,t){e.sublists=new Set(t)}function E(e,t){e.name=t}function y(e,t){const n=e.findIndex((e=>e.id===t.id));-1!==n&&e.splice(n,1,t)}function M(e,t){e.sort(((e,n)=>t.indexOf(e.id)-t.indexOf(n.id)))}const N={default:0,business:1,channels:2,unread:3,personal:4,managed_groups:5},A={hasSublist:0};function b(e){if("number"==typeof e){const t={};for(const n of Object.keys(A))t[n]=(e&1<<A[n])>0;const n=(14&e)>>1;let i="default";for(const e of Object.keys(N))switch(e){case"default":case"channels":case"business":case"unread":case"personal":case"managed_groups":N[e]===n&&(i=e);break;default:(0,s.exhaustivenessCheck)(e)}return{...t,type:i}}let t=0;for(const n of Object.keys(e))if("type"===n)t|=N[e.type]<<1;else e[n]&&(t|=1<<A[n]);return t}function S(e,t){const n=b(t);for(const t of Object.keys(n))switch(t){case"type":case"hasSublist":e[t]=n[t];break;default:(0,s.exhaustivenessCheck)(t)}}function w(e,t,n){e[t].boundaryMinorId>n.minorSortId&&(e[t].boundaryMinorId=n.minorSortId),"all"===t&&w(e,"unread",n)}},84113:(e,t,n)=>{n.d(t,{append:()=>m,appendPending:()=>p,around:()=>c,cleanup:()=>I,findClosestNodeInSlice:()=>l,findNodeByCmid:()=>d,findPendingNode:()=>u,insert:()=>E,isEmpty:()=>s,lastCmid:()=>a,lastNode:()=>r,nodeCmid:()=>N,nodeSentAt:()=>A,remove:()=>h,removePending:()=>_,replace:()=>f,restore:()=>g});var i=n(401193),o=n(679005);function s(e){const{confirmed:t,pending:n}=e;return 0===t.length&&0===n.length}function r({history:e,withPending:t,withDeleted:n,withFailed:o}){const{confirmed:s,pending:r}=e;if(t)for(let e=r.length-1;e>=0;e--){const t=r[e];if(t&&(o||!t.item.hasFailed))return t}for(let e=s.length-1;e>=0;e--){const t=s[e];if(!t)throw new Error("item по индексу не существует");switch(t.kind){case"Node":return t;case"DeletedNode":if(n)return t;continue;case"GapNode":return;default:return(0,i.exhaustivenessCheck)(t)}}}function a(e){const t=function(e){const{confirmed:t}=e;return t[t.length-1]}(e);if(void 0!==t)switch(t.kind){case"GapNode":return t.toCmid;case"Node":case"DeletedNode":return N(t);default:return(0,i.exhaustivenessCheck)(t)}}function d(e,t){const{confirmed:n}=e,o=n.findIndex((e=>{switch(e.kind){case"GapNode":return e.fromCmid<=t&&e.toCmid>=t;case"Node":case"DeletedNode":return N(e)===t;default:return(0,i.exhaustivenessCheck)(e)}})),s=n[o];return"Node"===s?.kind?{status:"Node",node:s,index:o}:void 0===s||"DeletedNode"===s.kind?void 0!==s&&void 0!==o?{status:"Deleted",node:s,index:o}:{status:"Deleted"}:{status:"NotLoaded",node:s,index:o}}function c(e,t){const{confirmed:n,pending:i}=e,o=n[0];if(!o)return{nodes:[],pendingNodes:i.length>0?i:void 0};if("GapNode"===o.kind&&o.toCmid>=t)return;let s,r=!1,a=0,d="GapNode"===o.kind?o:{kind:"GapNode",fromCmid:Math.min(t-1,0),toCmid:Math.min(t-1,0)};for(s=a;s<n.length;s++){const e=n[s];if(!e)throw new Error("item по индексу не существует");if("GapNode"===e.kind){if(d.toCmid<t&&e.fromCmid>t){r=!0;break}a=s,d=e}else if(s===n.length-1&&d.toCmid<t){r=!0;break}}return r?n.slice(a,s+1).reduce(((e,t,n,o)=>{if("GapNode"===t.kind){if(0===n)e.topGap=t;else{if(n!==o.length-1)throw new Error("В середине результата History.around не может быть гэпов");e.bottomGap=t}return e}return e.nodes.push(t),n===o.length-1&&void 0===e.bottomGap&&i.length>0&&(e.pendingNodes=i),e}),{nodes:[]}):void 0}function u(e,t){const{pending:n}=e;return n.find((e=>e.item.randomId===t))}function l(e,t,n=!1){for(let i=0;i<e.nodes.length;i++){const o=e.nodes[i];if(!o)continue;const s=N(o),r=e.nodes[i+1],a=r&&N(r);if(0===i&&t<s||i===e.nodes.length-1&&t>s||t===s)return o;if(a&&s<t&&t<a)return n?r:o}}function m(e,t,n){const i=(0,o.castDraft)(t);void 0!==n&&_(e,n),y(e,k([{kind:"Node",item:i}],a(e)))}function f(e,t){const{confirmed:n}=e,s=(0,o.castDraft)(t),{status:r,node:a,index:c}=d(e,s.cmid);if("NotLoaded"!==r){if("Deleted"!==r)return n[c]={kind:"Node",item:s},a.item;if(i.isDev)throw new Error("Попытка заменить удаленный узел истории")}}function h(e,t,n){const{confirmed:i}=e,{status:o,node:s,index:r}=d(e,t);"NotLoaded"!==o&&"Deleted"!==o&&(n.isRestorable?"Node"===s.kind&&(i[r]={kind:"DeletedNode",isSpam:n.isSpam,restorable:s.item}):i.splice(r,1))}function p(e,t){const{pending:n}=e;n.push({kind:"PendingNode",item:(0,o.castDraft)(t)})}function _(e,t){const{pending:n}=e,i=n.findIndex((e=>e.item.randomId===t));-1!==i&&n.splice(i,1)}function g(e,t,n){const{confirmed:i}=e,{status:o,node:s,index:r}=d(e,t);if("NotLoaded"!==o&&"Node"!==o)if(void 0===n)void 0!==s&&(i[r]={kind:"Node",item:s.restorable});else{y(e,k([{kind:"Node",item:n}],a(e)))}}function k(e,t){const n=e[0],i=n&&N(n),o=e[e.length-1],s=o&&N(o);return{topGap:void 0!==i&&i>1?{kind:"GapNode",fromCmid:1,toCmid:i-1}:void 0,nodes:e,bottomGap:void 0!==t&&void 0!==s&&s<t?{kind:"GapNode",fromCmid:s+1,toCmid:t}:void 0}}const v=.2,C=.2;function I(e,t,n){const{confirmed:i}=e;if(i.length<t)return;const o=a(e);if(void 0===o)return;const s=Math.floor(t/1.5),r={confirmed:[{kind:"GapNode",fromCmid:1,toCmid:o}],pending:[]},d=void 0===o?void 0:c(e,o),u=void 0===n?void 0:c(e,n);if(void 0!==d){y(r,k(void 0===u?d.nodes.slice(-s):d.nodes.slice(-Math.floor(s*v)),o))}if(void 0!==u){const e=u.nodes.findIndex((e=>N(e)===n));if(-1!==e){const t=Math.max(e-Math.floor(s*C),0);y(r,k(u.nodes.slice(t,e+Math.floor(s*(1-C-(void 0===d?0:v)))),o))}}e.confirmed=r.confirmed}function E(e,t){if(0===t.length)return void(e.confirmed=[]);if(0===e.confirmed.length)return void(e.confirmed=(0,o.castDraft)(t));!function(e,t){const{confirmed:n}=e,i=n[n.length-1],o=t[t.length-1];if(void 0===i||void 0===o)return;const s="GapNode"===o.kind?o.toCmid:N(o),r="GapNode"===i.kind?i.toCmid:N(i);"GapNode"!==i.kind&&r>s&&("GapNode"===o.kind?o.toCmid=r:t.push({kind:"GapNode",fromCmid:s+1,toCmid:r}));s>r&&("GapNode"===i.kind?i.toCmid=s:n.push({kind:"GapNode",fromCmid:r+1,toCmid:s}))}(e,t);t.reduce(((e,n,i)=>(0===i&&"GapNode"!==n.kind&&e.push(-1),i===t.length-1&&"GapNode"!==n.kind&&e.push(t.length),"GapNode"===n.kind&&e.push(i),e)),[]).forEach(((n,i,o)=>{const s=o[i+1];if(void 0!==s){const i=t[n],o=t[s],r=t.slice(n+1,s).reduce(((e,t)=>{if("GapNode"===t.kind)throw new Error("Не может быть гэп узлов между гэпами");return e.push(t),e}),[]);if(void 0!==i&&"GapNode"!==i.kind)throw new Error("Не гэп используется как гэп");if(void 0!==o&&"GapNode"!==o.kind)throw new Error("Не гэп используется как гэп");y(e,{topGap:i,bottomGap:o,nodes:r})}}))}function y(e,t){const{confirmed:n}=e;let i,s=-1;if(void 0!==t.topGap){s=M(e,t.topGap.toCmid);const i=n[s];if(void 0!==i){("GapNode"===i.kind?i.fromCmid:N(i))>t.topGap.toCmid&&s--}"GapNode"===i?.kind&&i.fromCmid<=t.topGap.toCmid&&i.toCmid>t.topGap.toCmid&&(n.splice(s,0,{kind:"GapNode",fromCmid:i.fromCmid,toCmid:t.topGap.toCmid}),i.fromCmid=t.topGap.toCmid+1)}if(void 0!==t.bottomGap){i=M(e,t.bottomGap.fromCmid);const o=n[i];"GapNode"===o?.kind&&o.fromCmid<t.bottomGap.fromCmid&&(o.fromCmid=t.bottomGap.fromCmid)}const r=[...n.slice(0,s+1),...(0,o.castDraft)(t.nodes),...void 0!==i?n.slice(i):[]];e.confirmed=r}function M(e,t){const{confirmed:n}=e;for(let e=0;e<n.length;e++){const i=n[e],o=n[e-1];if(!i)return-1;if(0===e){if("GapNode"===i.kind?i.fromCmid>t:N(i)>t)return-1}if("GapNode"===i.kind&&t>=i.fromCmid&&t<=i.toCmid)return e;const s="GapNode"===i.kind?i.fromCmid:N(i);if(s===t)return e;if(void 0===o)continue;const r="GapNode"===o.kind?o.toCmid:N(o);if(s>t&&r<t)return e}return n.length}function N(e){switch(e.kind){case"Node":return e.item.cmid;case"DeletedNode":return e.restorable.cmid;default:(0,i.exhaustivenessCheck)(e)}}function A(e){switch(e.kind){case"Node":case"PendingNode":return e.item.sentAt;case"DeletedNode":return e.restorable.sentAt;default:(0,i.exhaustivenessCheck)(e)}}},649166:(e,t,n)=>{n.d(t,{MESSAGE_FLAGS:()=>P,canChangeMessagePlayedStatus:()=>D,checkMessageHasChanged:()=>B,convertFlags:()=>R,edit:()=>M,editFailed:()=>N,expireForeign:()=>k,getCmid:()=>u,getForceAutoPlay:()=>$,getMessageAttachmentsCount:()=>O,hasText:()=>G,isCall:()=>h,isEditable:()=>f,isMessageEdited:()=>L,isReactionsAvailable:()=>p,newQueued:()=>w,pinMessage:()=>E,removeEmptyForwards:()=>x,removeEmptyForwardsFromQueued:()=>F,resolveCmid:()=>d,resolveRandomId:()=>c,setCurrentUserReaction:()=>T,setReactions:()=>U,toForeign:()=>g,toPinned:()=>_,toPlainText:()=>l,toRawText:()=>m,unpinMessage:()=>y,updateCmid:()=>C,updateEntrypoint:()=>I,updateFailedStatus:()=>v,updateFlags:()=>A,updateForeignAvailableStatus:()=>S});var i=n(679005),o=n(520828),s=n(596917),r=n(401193),a=n(399332);function d(e){return Number.isNaN(e)&&(e=0),!e||e<0?0:e}function c(e){return!e||e>0?0:e}function u(e){return"Normal"===e.kind?e.cmid:"Foreign"===e.kind&&"rootCmid"in e?e.rootCmid:void 0}function l(e,t){return s.toPlainText(e.chunks,t)}function m(e){return s.toRawText(e.chunks)}function f(e,t){const n=t-e.sentAt<a.Time.Day,i=e.isOut&&e.authorId===e.peerId;return(n||e.isPinned||i)&&e.isOut&&!h(e)&&!e.attaches.voice&&!e.attaches.sticker&&!e.attaches.ugcSticker&&!e.attaches.gift&&!e.attaches.graffiti&&!e.attaches.moneyTransfer&&!e.attaches.moneyRequest&&!e.attaches.videoMessage&&!e.attaches.miniAppWidgets}function h(e){return!!e.attaches.activeCall||!!e.attaches.finishedCall}function p(e){return!e.expireTTL&&!e.deleteTTL&&!(e.attaches.gift||e.attaches.activeCall||e.attaches.finishedCall)}function _(e){const{cmid:t,peerId:n,authorId:i,chunks:o,sentAt:s,forwardedMessages:r,replyMessage:a,attaches:d}=e;return{kind:"Pinned",cmid:t,peerId:n,authorId:i,chunks:o,sentAt:s,forwardedMessages:r,replyMessage:a,attaches:d,isUnavailable:!1}}function g(e){const{message:t,...n}=e,{kind:i,randomId:o,isOut:s,isImportant:r,replyMessage:a,...d}=t;return{kind:"Foreign",...d,...n}}function k(e){const{kind:t,replyMessage:n,forwardedMessages:i,chunks:o,attaches:s,updatedAt:r,expireTTL:a,deleteTTL:d,...c}=e;return{kind:"ForeignExpired",...c}}function v(e,t,n){e.hasFailed=t,e.errorCode=n}function C(e,t){e.cmid=t}function I(e,t){e.entrypoint=t}function E(e){e.isPinned=!0}function y(e){e.isPinned=!1}function M(e,{text:t,attaches:n,keepForwarded:o}){const r=(0,i.current)(e);e.chunks=s.fromClientText(t),e.attaches=n;const a=r.editing?.originalEditedMessage||r;e.editing={status:"pending",originalEditedMessage:a},o||(e.replyMessage=void 0,e.forwardedMessages=void 0)}function N(e){e.editing&&(e.editing.status="failed")}function A(e,t,n){const i="DeletedNode"===e.kind?e.restorable:e.item,o={isOut:i.isOut,isSpam:!1,isDeleted:!1,isDeletedForAll:!1,noPush:!1,DONT_USE_ME_isUnread:!1,DONT_USE_ME_isStealth:!1,DONT_USE_ME_skipUnread:!1};let s,a;switch(i.kind){case"Normal":s=R({...o,isImportant:i.isImportant,isPlayed:!!i.isPlayed,hasReactions:"Node"===e.kind&&i.reactions.size>0});break;case"Service":case"Expired":s=R({...o,isImportant:!1,isPlayed:!1,hasReactions:!1});break;default:(0,r.exhaustivenessCheck)(i)}switch(t){case"unset":a=R(s&~n);break;case"replace":a=R(n);break;case"set":a=R(s|n);break;default:(0,r.exhaustivenessCheck)(t)}const{isImportant:d,isSpam:c,isDeleted:u,isDeletedForAll:l,isPlayed:m,isOut:f,hasReactions:h,noPush:p,DONT_USE_ME_isStealth:_,DONT_USE_ME_isUnread:g,DONT_USE_ME_skipUnread:k,...v}=a;switch(i.kind){case"Normal":i.isImportant=d,i.isOut=f,i.isPlayed=m;break;case"Service":case"Expired":break;default:(0,r.exhaustivenessCheck)(i)}return{isDeleted:u,isDeletedForAll:l,isSpam:c}}function b(e,t,n){for(let i=0;i<e.length;i++){const o=e[i];o&&(o.cmid===t&&(o.isUnavailable=n),o?.forwardedMessages?.length&&b(o.forwardedMessages,t,n))}}function S(e,t,n){return e.replyMessage||e.forwardedMessages?("Foreign"===e?.replyMessage?.kind&&e.replyMessage.cmid===t&&(e.replyMessage.isUnavailable=n),e?.forwardedMessages&&b(e.forwardedMessages,t,n),e):e}function w(e,t,n){const i=c(-e.sentAt%Math.abs(r.MIN_INT_32)),o=void 0!==t?g({message:t,rootPeerId:e.peerId,rootRandomId:i}):void 0,a=n?.map((t=>g({message:t,rootPeerId:e.peerId,rootRandomId:i})));return{...e,kind:"Queued",text:e.text,chunks:s.fromClientText(e.text),hasFailed:!1,errorCode:void 0,randomId:i,replyMessage:o,forwardedMessages:a&&(0,r.isNonEmptyArray)(a)?a:void 0}}const P={DONT_USE_ME_isUnread:0,isOut:1,isImportant:3,isSpam:6,isDeleted:7,isPlayed:12,DONT_USE_ME_isStealth:16,isDeletedForAll:17,noPush:20,DONT_USE_ME_skipUnread:23,hasReactions:24};function R(e){return(0,r.getFlagValueByBitOffset)(e,P)}function D(e){if(e.isOut)return!1;return!(!e.attaches.voice&&!e.attaches.videoMessage)&&!e.isPlayed}function T(e,t){e.reactionId=t}function L(e){return!!(e.updatedAt&&!e.attaches.voice)}function U(e,t){const n=new Set(t.map((e=>e.reactionId)));Array.from(e.reactions.keys()).filter((e=>!n.has(e))).forEach((t=>e.reactions.delete(t))),t.forEach((t=>{e.reactions.set(t.reactionId,t)}))}function O(e){let t=0;return t+=o.count(e.attaches),e.replyMessage&&"ForeignExpired"!==e.replyMessage.kind&&(t+=O(e.replyMessage)),t+=e.forwardedMessages?.reduce(((e,t)=>e+O(t)),0)??0,t}function G(e){return 0!==e.chunks.length}function F(e){return e.forwardedMessages?{...e,forwardedMessages:x(e.forwardedMessages)}:e}function x(e){return e.reduce(((e,t)=>(!G(t)&&!o.kindsCount(t.attaches)&&t.forwardedMessages?e.push(...t.forwardedMessages):e.push(t),e)),[])}function B({draft:e,message:t}){return m(t)!==e.text||e.keepForwarded!==Boolean(t.replyMessage||t.forwardedMessages?.length)||!(0,r.isShallowEqual)(o.ids(e.attaches),o.ids(t.attaches))||Boolean(e.attaches.geo)!==Boolean(t.attaches.geo)}function $(e){return"forceAutoPlayMedia"in e&&e.forceAutoPlayMedia||!1}},302551:(e,t,n)=>{n.d(t,{DONUT_DURATION:()=>a,allNormalSpreadedComments:()=>v,changeCommentsCanPost:()=>E,changeCommentsOrder:()=>C,deleteComment:()=>k,findCommentByCmid:()=>_,isDonut:()=>f,isDonutPlaceholder:()=>m,isEmpty:()=>l,merge:()=>u,newPending:()=>I,replaceComment:()=>g,resolveCmid:()=>r,toRawText:()=>d,toWallAttach:()=>c});var i=n(401193),o=n(596917),s=n(175953);function r(e){return Number.isNaN(e)&&(e=0),!e||e<0?0:e}const a=[-1,1,2,3,4,5,6,7];function d(e){return o.toRawText(e.chunks)}function c(e){return{id:e.cmid,kind:"Wall",date:e.sentAt,authorId:s.resolveId(e.channelId),ownerId:s.resolveId(e.channelId),attaches:e.attaches,chunks:e.chunks,isAds:!1,isDeleted:!1,isVisibleFor:"all",views:e.views}}function u(e,t){return void 0!==t&&"Normal"===e.kind&&(e.comments={...e.comments,history:t.comments.history,oneLevelCount:t.comments.oneLevelCount,order:t.comments.order}),e}function l(e){return!(0!==e.chunks.length||Object.keys(e.attaches).find((e=>"unknown"!==e))||"Normal"===e.kind&&e.donut?.placeholder?.text)}function m(e){return Boolean(e.donut?.placeholder)}function f(e){return Boolean(e.donut?.isDonut)}function h(e,t,n){for(let i=0;i<e.length;i++){const o=e[i];if(!o)throw new Error("Wrong comment index access");const s=!n({...t,comment:o,onLevelIndex:i}),r=!s&&!h(o.replies.history,{kind:"Comment",source:o},n);if(s||r)return!1}return!0}function p(e,t){h(e.comments.history,{kind:"Post",source:e},t)}function _(e,t){let n;return p(e,(e=>e.comment.cmid!==t||(n=e.comment,!1))),n}function g(e,t){p(e,(e=>e.comment.cmid!==t.cmid||("Post"===e.kind&&(e.source.comments.history[e.onLevelIndex]=t),"Comment"===e.kind&&(e.source.replies.history[e.onLevelIndex]=t),!1)))}function k(e,t){p(e,(e=>e.comment.cmid!==t||("Post"===e.kind&&(e.source.comments.history.splice(e.onLevelIndex,1),e.source.comments.count-=1,e.source.comments.oneLevelCount-=1),"Comment"===e.kind&&(e.source.replies.history.splice(e.onLevelIndex,1),e.source.replies.count-=1),!1)))}function v(e){const t=[];return p(e,(e=>("Normal"===e.comment.kind&&t.push(e.comment),!0))),t}function C(e,t){e.comments.history=[],e.comments.order=t,e.comments.nextFrom=void 0,e.comments.prevFrom=void 0}function I(e,t){const n=function(e){if(e>=0){if(i.isDev)throw new Error("Рандом айди поста должен быть меньше 0!");return 0}return e%2**31}(-e.sentAt);return{...e,kind:"Pending",randomId:n,chunks:o.fromClientText(t),hasFailed:!1}}function E(e,t){e.comments.canPost=t,e.comments.canView=t||"Normal"===e.kind&&0!==e.comments.count}},254335:(e,t,n)=>{n.d(t,{ROOM_NAME_MAX_LENGTH:()=>i,SECTION_NAME_MAX_LENGTH:()=>o,addMember:()=>m,isAdmin:()=>u,isMuted:()=>l,removeMember:()=>f,resolveCallId:()=>d,resolveId:()=>s,resolveRoomId:()=>a,resolveSectionId:()=>r,resolveTribuneId:()=>c,setDescription:()=>p,setName:()=>h});const i=50,o=50;function s(e){return e}function r(e){return e}function a(e){return e}function d(e){return e}function c(e){return e}function u(e){return Boolean(e.viewerData.isOwner)}function l(e){return Boolean(e.viewerData.notificationSettings?.muteTill)}function m(e,t,n){e.membersCount=n}function f(e,t,n){e.membersCount=n}function h(e,t){e.name=t}function p(e,t){e.description=t}},462700:(e,t,n)=>{n.d(t,{createSferumShortenedCallUrl:()=>r,createShortenedCallUrl:()=>a,getCallJoinHash:()=>c,getCallJoinId:()=>d,getChatJoinHash:()=>l,isSferumCallInviteLink:()=>s,isSferumChatInviteLink:()=>u,prepareLink:()=>o});var i=n(73514);function o(e,t){return function(e){return e.startsWith("mailto:")}(t)||function(e){return e.startsWith("tel:")}(t)?t:(t.startsWith("/")||t.startsWith("http://")||t.startsWith("https://")||(t="https://"+t),function(e,t){if(t.startsWith("/"))return!t.startsWith("//");try{const{hostname:n}=new URL(t);return[...i.VK_RELATED_DOMAINS,e,...i.SFERUM_RELATED_DOMAINS].some((e=>n===e||n.endsWith("."+e)))}catch(e){return!1}}(e,t)?t:function(e,t){return`https://${e}/away.php?to=${encodeURIComponent(t)}&utf=1`}(e,t))}function s(e){let t;try{t=new URL(e)}catch(e){return!1}return t.hostname===i.SFERUM_DOMAIN&&t.searchParams.has("call_link")}function r(e,t){return`${i.ISOLATED_CALL_JOIN_SHORTENED_LINK_URL_BASE}?call=${e}${t?`&p=${t}`:""}`}function a(e,t){return`${i.CALL_JOIN_SHORTENED_LINK_URL_BASE}${e}${t?`?p=${t}`:""}`}function d(e,t){let n;try{n=new URL(e)}catch(e){return}if(function(e){let t;try{t=new URL(e)}catch(e){return!1}return t.hostname===i.SFERUM_DOMAIN&&t.searchParams.has("call")}(e)){if(t){const e=n.searchParams.get("call"),t=n.searchParams.get("p")??void 0;if(!e)return;return{callJoinId:e,password:t}}}else if(n.href.startsWith(i.CALL_JOIN_SHORTENED_LINK_URL_BASE)){const[,e]=n.pathname.split("/call/"),t=n.searchParams.get("p")??void 0;if(!e)return;return{callJoinId:e,password:t}}}function c(e,t){let n;try{n=new URL(e)}catch(e){return}if(s(e))return t&&n.searchParams.get("call_link")||void 0;if(n.href.startsWith(i.CALL_JOIN_LINK_URL_BASE)){const[,e]=n.href.split("/join/");return e}}function u(e){let t;try{t=new URL(e)}catch(e){return!1}return t.hostname===i.SFERUM_DOMAIN&&"messages"===t.searchParams.get("p")&&t.searchParams.has("join")}function l(e,t){let n;try{n=new URL(e)}catch(e){return}if(u(e))return t&&n.searchParams.get("join")||void 0;if(n.href.startsWith(i.CHAT_INVITE_LINK_URL_BASE)||n.href.startsWith(i.VKME_CHAT_INVITE_LINK_URL_BASE)){const[,e]=n.href.split("/join/");return e}}}}]);try{stManager.done("dist/web/chunks/e8b51364.52a4e1c1.js")}catch(e){}